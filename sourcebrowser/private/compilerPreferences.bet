ORIGIN '../ymer';

INCLUDE 'ymerBody';
INCLUDE '~beta/guienv/v1.3.1/controls';
INCLUDE '~beta/guienv/v1.3.1/fields';

-- fragmentBrowserLib: Attributes --
compilerPrefDialog: window
  (# compilerSwitches: ^text;
     switchWidth: @integer;
     height,distance,windowWidth,windowHeight: @integer;
     setFrame:
       (# 
       do
          recalc;
          (if more then
              8*height+4*distance->windowHeight;
              (windowWidth,windowHeight)->size;
              
           else
              4*height+2*distance->windowHeight;
              (windowWidth,windowHeight)->size;
              
          if);
          
       #);
     recalc:
       (#  do 3->distance; (switchWidth*3)+distance*4->windowWidth;  #);
     changed:
       (# cmd: ^text
       do
          &text[]->cmd[];
          (if all then '--all'->cmd.puttext; ' '->cmd.put if);
          (if repeating then '--repeat'->cmd.puttext; ' '->cmd.put if);
          (if nolink then '--nolink'->cmd.puttext; ' '->cmd.put if);
          (if nocode then '--nocode'->cmd.puttext; ' '->cmd.put if);
          (if noexec then '--noexec'->cmd.puttext; ' '->cmd.put if);
          (if nolist then '--nolist'->cmd.puttext; ' '->cmd.put if);
          (if noquawarn then '--noquawarn'->cmd.puttext; ' '->cmd.put if);
          (if nowarnings then '--nowarnings'->cmd.puttext; ' '->cmd.put if);
          (if verbose then '--verbose'->cmd.puttext; ' '->cmd.put if);
          (if quiet then '--quiet'->cmd.puttext; ' '->cmd.put if);
          (if mute then '--mute'->cmd.puttext; ' '->cmd.put if);
          (if static then '--static'->cmd.puttext; ' '->cmd.put if);
          (if debug then '--debug'->cmd.puttext; ' '->cmd.put if);
          (if preserve then '--preserve'->cmd.puttext; ' '->cmd.put if);
          (if not (switchEdit.contents.contents).empty then
              '--switch '->cmd.puttext;
              switchEdit.contents.contents->cmd.puttext;
              ' '->cmd.put;
              '0 '->cmd.puttext
          if);
          cmd[]->compilerSwitches[]
       #);
     more,all,repeating,nolink,debug,nocode,noexec,nolist,noquawarn,nowarnings,
       verbose,quiet,mute,static,preserve: @boolean;
     (* -------------------------------------------------- *)
     bCancel: @pushButton
       (#
          setFrame:
            (# x,y,w,h: @integer
            do
               recalc;
               distance->x;
               distance->y;
               (windowWidth-3*distance)/2->w;
               height->h;
               ((x,y),(x+w,y+h))->frame;
            #);
          open::  (#  do setFrame; 'Cancel'->label #);
          eventhandler:: 
            (#
               onMouseUp::  (#  do THIS(compilerPrefDialog).hide #);
               onFatherFrameChanged::  (#  do setFrame #)
            #)
       #);
     bOk: @pushButton
       (#
          setFrame:
            (# x,y,w,h: @integer 
            do
               recalc;
               distance+(windowWidth-3*distance)/2->x;
               distance->y;
               (windowWidth-3*distance)/2->w;
               height->h;
               ((x,y),(x+w,y+h))->frame;
            #);
          open::  (#  do setFrame; 'OK'->label #);
          eventhandler:: 
            (#
               onMouseUp:: 
                 (#  do changed; THIS(compilerPrefDialog).hide #);
               onFatherFrameChanged::  (#  do setFrame #)
            #)
       #);
     switchesFrame: @labelled
       (#
          contentsType:: canvas
            (#
               nolistBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         0->x;
                         distance->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'nolist'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not nolist->nolist #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               nolinkBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         0->x;
                         (height+distance)->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'nolink'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not nolink->nolink #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               nocodeBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         0->x;
                         (height+distance)*2->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'nocode'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not nocode->nocode #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               (* -------------------------------------------------- *)
               verboseBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         switchWidth+distance->x;
                         distance->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'verbose'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not verbose->verbose #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               quietBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         switchWidth+distance->x;
                         height+distance->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'quiet'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not quiet->quiet #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               muteBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         switchWidth+distance->x;
                         (height+distance)*2->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'mute'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not mute->mute #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               (* -------------------------------------------------- *)
               moreBotton: @pushButton
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)*2->x;
                         distance->y;
                         switchWidth-distance*3->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'more choices'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp:: 
                           (# 
                           do
                              not more->more;
                              (if more then
                                  'less choices'->label;
                                  THIS(compilerPrefDialog).setFrame;
                                  switchesFrame.setFrame;
                                  debugBox.show;
                                  staticBox.show;
                                  noexecBox.show;
                                  preserveBox.show;
                                  allBox.show;
                                  repeatingBox.show;
                                  switchEdit.show;
                                  
                               else
                                  'more choices'->label;
                                  debugBox.hide;
                                  staticBox.hide;
                                  noexecBox.hide;
                                  preserveBox.hide;
                                  allBox.hide;
                                  repeatingBox.hide;
                                  switchEdit.hide;
                                  switchesFrame.setFrame;
                                  THIS(compilerPrefDialog).setFrame;
                                  
                              if);
                              true->THIS(compilerPrefDialog).update;
                              
                           #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               noquawarnBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)*2->x;
                         (height+distance)->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'noquawarn'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not noquawarn->noquawarn #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               nowarningsBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)*2->x;
                         (height+distance)*2->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; 'nowarnings'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not nowarnings->nowarnings #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               (* -------------------------------------------------- *)
               debugBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         0->x;
                         (height+distance)*3->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; hide; 'debug'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not debug->debug #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               staticBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         0->x;
                         (height+distance)*4->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; hide; 'static'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not static->static #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               (* -------------------------------------------------- *)
               noexecBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)->x;
                         (height+distance)*3->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; hide; 'noexec'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not noexec->noexec #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               preserveBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)->x;
                         (height+distance)*4->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; hide; 'preserve'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not preserve->preserve #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               (* -------------------------------------------------- *)
               allBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)*2->x;
                         (height+distance)*3->y;
                         switchWidth->w;
                         height-h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; hide; 'all'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp::  (#  do not all->all #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               repeatingBox: @checkBox
                 (#
                    setFrame:
                      (#  x,y,w,h: @integer
                      do
                         recalc;
                         (switchWidth+distance)*2->x;
                         (height+distance)*4->y;
                         switchWidth->w;
                         height->h;
                         ((x,y),(x+w,y+h))->frame;
                      #);
                    open::  (#  do setFrame; hide; 'repeating'->label #);
                    eventhandler:: 
                      (#
                         onMouseUp:: 
                           (# 
                           do
                              not repeating->repeating;
                              changed
                           #);
                         onFatherFrameChanged::  (#  do setFrame #)
                      #)
                 #);
               open:: 
                 (# 
                 do
                    nolistBox.open;
                    nolinkBox.open;
                    nocodeBox.open;
                    verboseBox.open;
                    quietBox.open;
                    muteBox.open;
                    noquawarnBox.open;
                    nowarningsBox.open;
                    moreBotton.open;
                    debugBox.open;
                    staticBox.open;
                    noexecBox.open;
                    preserveBox.open;
                    allBox.open;
                    repeatingBox.open;
                    
                 #)
            #);
          setFrame:
            (#  x,y,w,h: @integer
            do
               recalc;
               distance->x;
               distance+height->y;
               (if more then
                   windowWidth-2*distance->w;
                   height*5+distance->h; 
                else
                   windowWidth-2*distance->w;
                   height*5+distance->h; 
               if);
               ((x,y),(x+w,y+h))->frame;
            #);
          open::  (#  do setFrame; 'Switches'->label #);
          eventhandler:: 
            (# onFatherFrameChanged::  (#  do setFrame #) #)
       #);
     switchEdit: @labelled
       (#
          contentsType:: editText(# #);
          setFrame:
            (#  x,y,w,h: @integer
            do
               recalc;
               distance->x;
               height*6+distance*3->y;
               windowWidth-2*distance->w;
               height*2->h;
               ((x,y),(x+w,y+h))->frame;
            #);
          open::  (#  do setFrame; hide; 'Numeric switches'->label #);
          eventhandler:: 
            (# onFatherFrameChanged::  (#  do setFrame #) #)
       #);
     (* -------------------------------------------------- *)
     tst: @pushButton
       (#
          open:: 
            (#
               ts: ^textStyle;
               buttonLabel: (#  exit 'more choises' #);
               buttonWidth: @integer
            do
               buttonLabel->label;
               style->ts[];
               ((buttonLabel->ts.widthOfText)+5,ts.lineHeight+3)
                 ->(switchWidth,height);
               switchWidth+8->switchWidth;
               height+8->height;
               
            #)
       #);
     eventhandler:: 
       (# onAboutToClose::  (#  do false->okToClose; hide #) #);
     open::< 
       (# 
       do
          tst.open;
          (* just to get the width and height of fonts *)
          tst.hide;
          tst.close;
          setFrame;
          (50,50)->position;
          hide;
          THIS(compilerprefdialog).contents->bCancel.open;
          THIS(compilerprefdialog).contents->bOk.open;
          THIS(compilerprefdialog).contents->switchesFrame.open;
          THIS(compilerprefdialog).contents->switchEdit.open;
          'Compiler Preferences'->title;
          INNER
       #)
  #);
  
