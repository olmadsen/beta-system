ORIGIN '../ymer';

INCLUDE 'ymerBody';
INCLUDE 'semanticEditor';
INCLUDE 'workspace';
INCLUDE 'help';
INCLUDE 'separateCodeEditor';

--- menuFileHelp: dopart ---
do (# help: @helpViewer
        (# open::
             (#
             do ymerPrivate.helpDocuments.scan
                (# do (current.title[], current.path[])->registerTheme #)
             #)
        #)
   do help.open
   #)
   
--- menuFileCloseOnselect: dopart ---
do quit
   
--- menuFileQuitOnselect: dopart ---
do l:(# 
     do browsers.scan(# do (if not current.closeGroups then leave l if) #);
        browsers.scan(# where:: (# do current[]<>THIS(ymerBrowserWindow)[]->value #)
                     do current.quit
                     #);
        THIS(ymerBrowserWindow).quit;
     #);
   (* If we get to this point, not all browsers have been closed *)
   (NONE,'Quit', 'Modified buffers still exists.\nQuit anyway?')
     ->promptForBoolean(# ok:: (# do terminate #) #)
   
--- menuProjectsLoadOnselect: dopart ---
do (# f: @file; ext: ^text;
   do &fileSelectionDialog(# do 'Load Project File'->label[] #)->t[]; 
      (if t[]<>NONE then
          &browser.projects.project[]->newProj[];
          t->newProj.location;
          newProj[]->browser.projects.setupProject;
          newProj[]->browser.projects.theProjects.append;
          browser.projectsChanged;
          newProj[]->browser.setProject;
          (if browser.currentProject.groups.size=1 then
              (* automatically select it, and the first fragment form in it *)
              l: ((browser.currentProject.groups.head).elm.getfg).fragmentList.scan
                (# ff: ^mps.AST.fragmentForm;
                   (* find first FF to select it automatically *)
                do (if current.type
                    // mps.AST.formType then
                       current.open->ff[];
                      (* edenv.history.protect
                       (#
                       do *)
                          (browser.currentProject[],
                          (browser.currentProject.groups.head).elm[],
                          ff[])
                            ->browser.setFragmentForm;
                     (*  #);*)
                       leave l
                   if)
                #)
          if);
      if)
   #)
  
--- menuProjectsRelocateOnselect: dopart ---
do browser.currentProject[]->cp[];
   fileSelectionDialog(# do 'Specify new location'->label[] #)->t[];
   (if true
    // (t[]=NONE) then (* ignore: cancel pressed *)
    // t[]->fileAvailable then
       t->cp.location;
       cp[]->browser.projects.setupProject;
       (if cp.unfolded then
           cp[]->browser.foldSubprojects;
           cp[]->browser.unfoldSubprojects;
       if);
       browser.projectsChanged;
       cp[]->browser.setProject
   if)
   
--- menuProjectsDeleteOnselect: dopart ---
do browser.currentProject[]->cp[];
   (if cp.unfolded then
       cp[]->browser.foldSubprojects;
   if);
   cp[]
     ->browser.projects.theProjects.at
     ->browser.projects.theProjects.delete;
   browser.projectsChanged
   
--- menuGroupsNewOnselect: dopart ---
do (*fileSelectionDialog(# do 'New group'->label[] #)->t[];
   &browser.projects.group[]->newGroup[];
   newGroup[]->browser.currentProject.subprojects.append;
   t->newGroup.location;
   t[]->newGroup.name[];
   browser.projectsChanged*)
   
--- menuGroupsAddOnselect: dopart ---
do

-- windowsMenuOnSelect: DoPart --
do l: scan
     (# wmi: ^windowMenuItem
     do (if current##<=windowMenuItem## then
            current[]->wmi[];
            wmi.ww.title->wmi.name;
        if)
     #)

--- menuGroupsDeleteOnselect: dopart ---
do 

-- windowsMenuInsertWindow: Descriptor --
(# wmi: ^windowMenuItem
do &windowMenuItem[]->wmi[];
   win[]->wmi.ww[];
   wmi.open;
   wmi[]->append;
   win.title->wmi.name;
#)  

-- windowsMenuDeleteWindow: DoPart --
do l: scan
     (# wmi: ^windowMenuItem
     do (if current##<=windowMenuItem## then
            current[]->wmi[];
            (if wmi.ww[] = win[] then wmi[]->delete; leave l if)
        if)
     #)
   
-- windowsMenuPrivate: Attributes --
windowMenuItem: menuItem
  (# ww: ^window;
     eventhandler:: 
       (# onSelect:: (# do ww.show; ww.wriggle #) #);
  #);

-- windowsMenuSeparateBrowser: dopart --
do (&ymerBrowserWindow[]).open

-- windowsMenuSeparateCodeView: dopart --
do (#
   do browser.currentForm[]->viewSeparate
   #)
   
--- windowsMenuWorkspace: dopart ---
do (&workspace[]).open
   
--- windowsMenuSemanticViewerOnselect: dopart ---
do (# sv: @browser.semanticViewer
        (# open::
             (# 
             do browser.currentGroup.getfg->sv.fg[];
                browser.currentGroup.name[]->sv.fgName[];
             #)
        #)
   do (if browser.currentGroup[]<>NONE then
          sv.open;
      if)
   #)
 
--- windowsMenuSemanticEditorOnselect: dopart ---
do (# se: @browser.semanticEditor
        (# open::
             (#
             do browser.currentGroup.getfg->fg[];
                browser.currentGroup.name[]->fgName[];
             #)
        #);
   do (if browser.currentGroup[]<>NONE then
          se.open
      if)
   #)
