ORIGIN '../toolsMenu';

INCLUDE 'compileWindow';
INCLUDE 'ymerFileUtils';
INCLUDE '~beta/unixlib/v1.4/unixfile';
INCLUDE '~beta/basiclib/v1.4/formatio';

--- ymerApplicationLib: attributes ---
fileExecutable: 
  (# f: @unixfile
  enter f.name
  exit ('a','x')->f.entry.permission.has
  #);

-- iCompilerSlot: Descriptor --
(# win: ^compileWindow; t: @text
do
   (if (BETAexecutable[] = none) or (BETAexecutable.length=0) then
       BETAlib.copy->BETAexecutable[]; '/bin/beta'->BETAexecutable.puttext; 
   if);
   l: 
   (if (BETAexecutable[]->fileExists) and (BETAexecutable[]->fileReadable) and
   (BETAexecutable[]->fileExecutable) then
       
       &singleCompileWindow[]->win[];
       &text[]->win.arguments[];
       BETAexecutable.copy->win.BETAprogram[];
       win.open;
       
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.files[]; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.files[]; 
            // browser.currentProject.isDirectory then
                 (# d: @directory
                 do
                    (if browser.currentProject.location.empty then
                        ph.currentDirectory
                          ->browser.currentProject.location.puttext;
                        
                    if);
                    (browser.currentProject.location[],ph.currentDirectory)
                      ->ph.convertfilepath->d.name;
                    &text[]->win.files[];
                    d.scanEntries
                      (# 
                      do
                         select
                           (#
                              whenFile:: 
                                (# f: ^file; ext: ^text; location: @text
                                do
                                   thefile->f[];
                                   f.entry.path.name.suffix->ext[];
                                   f.entry.path.name->location.puttext;
                                   (if true
                                    // '.bet'->ext.equal then
                                       browser.currentProject.location[]
                                         ->location.prepend;
                                       location[]->win.files.puttext;
                                       ' '->win.files.put;
                                       
                                   if);
                                   
                                #)
                           #)
                      #)
                 #)
           if)
       if);
       win.doExecute;
       
    else
       'BETA compiler\n     "%s"\nnot available'
         ->t.putformat (#  do BETAexecutable[]->s #);
       (none ,t[],'BETA Compiler')->alertUser;
       &fileSelectionDialog
         (#  do 'Select BETA compiler executable'->label[] #)->BETAexecutable[];
       (if BETAexecutable[] <> none then restart l if)
   if)
#)  

-- iRepeatingCompilerSlot: Descriptor --
(# win: ^compileWindow; t: @text
do
   (if (BETAexecutable[] = none) or (BETAexecutable.length=0) then
       BETAlib.copy->BETAexecutable[]; '/bin/beta'->BETAexecutable.puttext; 
   if);
   l:
   (if (BETAexecutable[]->fileExists) and (BETAexecutable[]->fileReadable) and
   (BETAexecutable[]->fileExecutable) then
       
       &repeatingCompileWindow[]->win[];
       &text[]->win.arguments[];
       BETAexecutable.copy->win.BETAprogram[];
       win.open;
       
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.files[]; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.files[]; 
            // browser.currentProject.isDirectory then
                 (# d: @directory
                 do
                    (if browser.currentProject.location.empty then
                        ph.currentDirectory
                          ->browser.currentProject.location.puttext;
                        
                    if);
                    (browser.currentProject.location[],ph.currentDirectory)
                      ->ph.convertfilepath->d.name;
                    &text[]->win.files[];
                    d.scanEntries
                      (# 
                      do
                         select
                           (#
                              whenFile:: 
                                (# f: ^file; ext: ^text; location: @text
                                do
                                   thefile->f[];
                                   f.entry.path.name.suffix->ext[];
                                   f.entry.path.name->location.puttext;
                                   (if true
                                    // '.bet'->ext.equal then
                                       browser.currentProject.location[]
                                         ->location.prepend;
                                       location[]->win.files.puttext;
                                       ' '->win.files.put;
                                       
                                   if);
                                   
                                #)
                           #)
                      #)
                 #)
           if)
       if);
       win.doExecute;
       
    else
       'BETA compiler\n     "%s"\nnot available'
         ->t.putformat (#  do BETAexecutable[]->s #);
       (none ,t[],'Repeating BETA Compiler')->alertUser;
       &fileSelectionDialog
         (#  do 'Select BETA compiler executable'->label[] #)->BETAexecutable[];
       (if BETAexecutable[] <> none then restart l if)
   if)
#)  

-- iExecuteSlot: Descriptor --
(#
   win: @executeWindow (# doRepeat::  (#  do setupNewProcess #);  #);
   t: @text
do
   &text[]->win.arguments[];
   (if true
    // browser.currentGroup[] <> none then
       browser.currentGroup.location.copy->win.BETAprogram[]; 
    // browser.currentProject[] <> none then
       (if true
        // browser.currentProject.isRoot // browser.currentProject.isExtent
        // browser.currentProject.isDomain then
           browser.currentProject.location.copy->win.BETAprogram[]; 
       if)
   if);
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       win.open; win.doExecute
    else
       'Selected executable\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Execute')->alertUser
   if)
#)  

-- iDebugSlot: Descriptor --
(#
   win: @executeWindow (# doRepeat::  (#  do setupNewProcess #);  #);
   t: @text
do
   &text[]->win.arguments[];
   (if (VALHALLAexecutable[] = none) or (VALHALLAexecutable.length=0) then
       BETAlib.copy->VALHALLAexecutable[];
       '/bin/valhalla2.0'->VALHALLAexecutable.puttext;
       
   if);
   VALHALLAexecutable.copy->win.BETAprogram[];
   l:
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.arguments.puttext; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.arguments.puttext; 
           if);
           
       if);
       win.arguments[]->putline;
       (if (win.arguments[]->fileExists) and (win.arguments[]->fileReadable) and
       (win.arguments[]->fileExecutable) then
           win.open; win.doExecute
        else
           'Selected executable\n     "%s"\nnot available'
             ->t.putformat (#  do win.arguments[]->s #);
           (none ,t[],'Debug')->alertUser
       if)
    else
       'Debugger\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Debug')->alertUser;
       &fileSelectionDialog (#  do 'Select Valhalla executable'->label[] #)
         ->VALHALLAexecutable[];
       (if VALHALLAexecutable[] <> none then
           VALHALLAexecutable.copy->win.BETAprogram[]; restart l
       if)
   if)
#)  

-- iSifSlot: Descriptor --
(#
   win: @executeWindow
     (# doRepeat::  (#  do setupNewProcess #); open::  (#  do hide #)
     #);
   t: @text;
   
do
   &text[]->win.arguments[];
   (if (SIFexecutable[] = none) or (SIFexecutable.length=0) then
       BETAlib.copy->SIFexecutable[]; '/bin/sif'->SIFexecutable.puttext; 
   if);
   SIFexecutable.copy->win.BETAprogram[];
   l:
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.arguments.puttext; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.arguments.puttext; 
           if)
       if);
       '.bet'->win.arguments.puttext;
       win.open;
       win.doExecute
    else
       'Sif executable\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Edit: Sif')->alertUser;
       &fileSelectionDialog (#  do 'Select Sif executable'->label[] #)
         ->SIFexecutable[];
       (if SIFexecutable[] <> none then
           SIFexecutable.copy->win.BETAprogram[]; restart l
       if)
   if);
   
#)  

-- iFrejaSlot: Descriptor --
(#
   win: @executeWindow
     (# doRepeat::  (#  do setupNewProcess #); open::  (#  do hide #)
     #);
   t: @text;
   
do
   &text[]->win.arguments[];
   (if (FREJAexecutable[] = none) or (SIFexecutable.length=0) then
       BETAlib.copy->FREJAexecutable[]; '/bin/freja'->FREJAexecutable.puttext; 
   if);
   FREJAexecutable.copy->win.BETAprogram[];
   l:
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.arguments.puttext; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.arguments.puttext; 
           if)
       if);
       '.bet'->win.arguments.puttext;
       win.open;
       win.doExecute
    else
       'Freja executable\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Edit: Freja')->alertUser;
       &fileSelectionDialog (#  do 'Select Freja executable'->label[] #)
         ->FREJAexecutable[];
       (if FREJAexecutable[] <> none then
           FREJAexecutable.copy->win.BETAprogram[]; restart l
       if)
   if);
   
#)  

-- iInterfacebuilderSlot: Descriptor --
(#
   win: @executeWindow
     (# doRepeat::  (#  do setupNewProcess #); open::  (#  do hide #)
     #);
   t: @text;
   
do
   &text[]->win.arguments[];
   (if (INTERFACEBUILDERexecutable[] = none) or (INTERFACEBUILDERexecutable.length=0) then
       BETAlib.copy->INTERFACEBUILDERexecutable[];
       '/bin/interfacebuilder'->INTERFACEBUILDERexecutable.puttext;
       
   if);
   INTERFACEBUILDERexecutable.copy->win.BETAprogram[];
   l:
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.arguments.puttext; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.arguments.puttext; 
           if)
       if);
       '.bet'->win.arguments.puttext;
       win.open;
       win.doExecute
    else
       'Interfacebuilder executable\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Edit: Interfacebuilder')->alertUser;
       &fileSelectionDialog
         (#  do 'Select InterfaceBuilder executable'->label[] #)
         ->INTERFACEBUILDERexecutable[];
       (if INTERFACEBUILDERexecutable[] <> none then
           INTERFACEBUILDERexecutable.copy->win.BETAprogram[]; restart l
       if)
   if);
   
#)  

-- iTextEditSlot: Descriptor --
(#
   win: @executeWindow
     (# doRepeat::  (#  do setupNewProcess #); open::  (#  do hide #)
     #);
   t: @text;
   
do
   &text[]->win.arguments[];
   (if (TEXTexecutable[] = none) or (TEXTexecutable.length=0) then
       '$(EDITOR)'
         ->expandEnvVar
           (#
              defaultValue:: 
                (#  do '/usr/local/bin/emacs'->envvarvalue[] #)
           #)->TEXTexecutable[];
       
   if);
   TEXTexecutable.copy->win.BETAprogram[];
   l:
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.arguments.puttext; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.arguments.puttext; 
           if)
       if);
       '.bet'->win.arguments.puttext;
       win.open;
       win.doExecute;
       
    else
       'Text Editor\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Edit: Text Editor')->alertUser;
       &fileSelectionDialog
         (#  do 'Select TEXT EDITOR executable'->label[] #)->TEXTexecutable[];
       (if TEXTexecutable[] <> none then
           TEXTexecutable.copy->win.BETAprogram[]; restart l
       if)
   if)
#)  

-- iAnalyzeSlot: Descriptor --
(#
   win: @executeWindow
     (#
        executeStartMsg::  (#  do 'Analysis start'->value #);
        executeRestartMsg::  (#  do 'Analysis restart'->value #);
        executeAbortMsg::  (#  do 'Analysis ABORT'->value #);
        executeEndMsg::  (#  do 'Analysis terminated'->value #);
        repeatLabel::  (#  do 'Analyze again'->value #);
        doRepeat::  (#  do setupNewProcess #)
     #);
   t: @text;
   
do
   &text[]->win.arguments[];
   (if (BETAWCexecutable[] = none) or (BETAWCexecutable.length=0) then
       BETAlib.copy->BETAWCexecutable[];
       '/bin/betawc'->BETAWCexecutable.puttext;
       
   if);
   BETAWCexecutable.copy->win.BETAprogram[];
   l:
   (if (win.BETAprogram[]->fileExists) and (win.BETAprogram[]->fileReadable) and
   (win.BETAprogram[]->fileExecutable) then
       (if true
        // browser.currentGroup[] <> none then
           browser.currentGroup.location.copy->win.arguments.puttext; 
        // browser.currentProject[] <> none then
           (if true
            // browser.currentProject.isRoot // browser.currentProject.isExtent
            // browser.currentProject.isDomain then
               browser.currentProject.location.copy->win.arguments.puttext; 
           if)
       if);
       (win.arguments[],ph.currentDirectory)->ph.convertfilepath
         ->win.arguments[];
       win.open;
       win.doExecute;
       
    else
       'Analysis tool betawc\n     "%s"\nnot available'
         ->t.putformat (#  do win.BETAprogram[]->s #);
       (none ,t[],'Analyze')->alertUser;
       &fileSelectionDialog (#  do 'Select Analysis executable'->label[] #)
         ->BETAWCexecutable[];
       (if BETAWCexecutable[] <> none then
           BETAWCexecutable.copy->win.BETAprogram[]; restart l
       if)
   if)
#)  
