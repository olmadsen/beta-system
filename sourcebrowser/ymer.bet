ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/basiclib/formatio'
        '~beta/toollibs/utils/mpsinterface'
        '~beta/guienv/utils/labelled'
        '~beta/guienv/utils/streamwindow'
        '~beta/guienv/utils/interfaceObjectAdds'
        '~beta/dependency/dependency'
        'sourcebrowser'
        'ymerInterface'
        '~beta/containers/arrayContainer'
        'aboutwindow';
LIB_DEF 'srcbrwymer' '../lib';
BODY 'private/ymerBody'
     'private/ymerMenus'
     'private/parseProjects'
     'private/splitDependency';
(*
 * COPYRIGHT
 *   Copyright Mjolner Informatics, 1995-96
 *   All rights reserved.
 *)
-- guienvlib: Attributes --
ymerBrowserWindow: window
  (#
     <<SLOT fragmentBrowserLib:Attributes>>;
     ymerYmerBrowserInterface:
      ymerBrowserInterface
       (#
          addProject:: 
            (#  do location[]->THIS(ymerBrowserWindow).addProject;  #);
          appendProject:: 
            (#  do location[]->THIS(ymerBrowserWindow).appendProject;  #);
          appendDone::  (#  do THIS(ymerBrowserWindow).appendDone;  #);
          loadProject:: 
            (#  do (* project[]->THIS(ymerBrowserWindow).loadproject*)  #);
          WindowsMenuInsertWindow:: 
            (#  do win[]->(theMenuBar).windowsMenu.insertWindow #);
          getWindowsMenu:: 
            (#  do (theMenubar).windowsMenu[]->windowsMenu[] #);
          findOrCreateGroupEditor:: 
            (#  <<SLOT findOrCreateGroupEditor:DoPart>> #);
          selectNode:: 
            (# 
            do
               (root[],node[],separate)
                 ->browser.selectnode
            #);
          selectFragmentForm:: 
            (# 
            do
               (fgName[],formName[])
                 ->
                   browser.
                     selectFragmentForm
            #);
          selectFragmentGroup:: 
            (#  do fgName[]->browser.selectFragmentGroup #);
          projectMenuLoad:: 
            (# t: ^text; (* try with addtogroupcache? *) 
            <<SLOT projectMenuLoaddp:DoPart>>
            (* ->(themenubar).projectMenu.iLoad.theEventHandler.onSelect*)
            #);
          dumpmenuLoad::  (#  <<SLOT dumpMenuLoad:DoPart>> #);
          findAndSelect:: 
            (# 
            do
               node[]
                 ->edenv.ymercallback.findAndSelect
            #);
          quitBrowser:: 
            (# 
            do
               (themenubar).fileMenu.iQuit.
                 theEventhandler.onSelect
            #);
          updateToolbar::  (#  <<SLOT updateToolbar:DoPart>> #);
          updateBrowser:: 
            (# (* cbg: ^browser.projects.group; *)
               
            <<SLOT updateBrowser:DoPart>>
            #);
          propertySelected:: 
            (# 
            do browser.propertySelected->value
            #);
          
       #);
     Interface: ^ymerBrowserInterface;
     CreateInterface:
       (# 
       <<SLOT ymerbrowserWindowCreateInterface:DoPart>>
       exit Interface[]
       #);
     browserTitle:<
       (# title: ^text do 'Mjolner'->title[]; INNER exit title[] #);
     workspace:< ymerLocalWindow
       (#
          cfe: ^codeeditor;
          workspacePrivate: @<<SLOT workspacePrivate:Descriptor>>;
          menubarType::< 
            (#
               fileMenu: @menu
                 (#
                    closeItem: @menuItem
                      (#
                         eventHandler:: 
                           (#
                              onSelect:: 
                                (# 
                                <<SLOT workspaceFileCloseSelect:DoPart>>
                                #)
                           #);
                         open::  (#  do 'w'->key; 'Close'->name #)
                      #);
                    open::  (#  <<SLOT workspaceFileOpen:DoPart>> #);
                    setup:
                      (# 
                      do
                         open;
                         fileMenu[]
                           ->
                             THIS(menubarType).
                               append
                      #);
                    
                 #);
               importMenu: @menu
                 (#
                    iImportCurrentGroup: @menuItem
                      (#
                         eventhandler:: 
                           (#
                              onStatus:: 
                                (# 
                                <<SLOT workspaceImportAllStatus:DoPart>>
                                #);
                              onSelect::
                               
                                (# 
                                <<SLOT workspaceImportAllSelect:DoPart>>
                                #);
                              
                           #);
                         
                      #);
                    refresh:
                     <<SLOT workspaceRefreshImportMenu:Descriptor>>;
                    <<SLOT workspaceImportItems:Attributes>>;
                    open::  (#  <<SLOT workspaceImportOpen:DoPart>> #);
                    setup:
                      (# 
                      do
                         open;
                         importMenu[]
                           ->
                             THIS(menubarType
                             ).append
                      #);
                    
                 #);
               closeMenu: @menu
                 (#
                    <<SLOT workspaceCloseItems:Attributes>>;
                    open:: 
                      (# 
                      do 'Close'->name
                      #);
                    setup:
                      (# 
                      do
                         open;
                         closeMenu[]
                           ->
                             THIS(
                             menubarType).append
                      #);
                    
                 #);
               scrollMenu: @menu
                 (#
                    <<SLOT workspaceScrollItems:Attributes>>;
                    open:: 
                      (# 
                      do 'Scroll'->name
                      #);
                    setup:
                      (# 
                      do
                         open;
                         scrollMenu[]
                           ->
                             THIS(
                             menubarType).append
                      #);
                    
                 #);
               
            #);
          UI: @<<SLOT workspaceUI:Descriptor>>;
          eventhandler:: 
            (#
               onAboutToClose:: 
                 (# 
                 <<SLOT workspaceOnAboutToClose:DoPart>>
                 #);
               onActivate::  (#  do (theMenubar).importMenu.refresh #);
               
            #);
          open::<  (#  <<SLOT workspaceOpen:DoPart>> #);
          
       #)
       (* workspace *)
       ;
     codeViewWindow:< ymerLocalWindow
       (#
          ff: ^mpsInterface.AST.fragmentForm;
          menu1: ^codeViewMenuAction;
          menu2: ^codeViewMenuAction;
          fe: ^codeeditor;
          codeViewWindowPrivate:
            @<<SLOT codeViewWindowPrivate:Descriptor>>;
          menubarType::< 
            (#
               fileMenu: @menu
                 (#
                    closeItem: @menuItem
                      (#
                         eventHandler:: 
                           (#
                              onSelect:: 
                                (# 
                                <<SLOT codeViewWindowFileClose:DoPart>>
                                #)
                           #);
                         open:: 
                           (# 
                           do
                              'w'->key;
                              'Close'
                                ->name
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'File'->name;
                         closeItem.open;
                         closeItem[]
                           ->append
                      #);
                    setup:
                      (# 
                      do
                         open;
                         fileMenu[]
                           ->
                             THIS(
                             menubarType).append
                      #)
                 #);
               buffersMenu: @menu
                 (#
                    <<SLOT codeViewWindowBuffersMenu:Attributes>>;
                    open:: 
                      (# 
                      do
                         'Buffers'
                           ->name
                      #);
                    setup:
                      (# 
                      do
                         open;
                         buffersMenu[]->THIS(menubarType).append
                      #)
                 #);
               setupMenus:
                 (# getCfe: @getcfecallback (#  do fe[]->cfe[] #)
                 do
                    filemenu.setup;
                    edenv.ymercallback.newCodeViewWindow->menu1[];
                    (if menu1[] <> none then
                        (THIS(window)[],THIS(menubar)[],getcfe[])->menu1
                    if);
                    buffersMenu.setup
                 #)
            #);
          closeDown::<  (#  <<SLOT codeViewWindowCloseDown:DoPart>> #);
          eventhandler::< 
            (#
               onAboutToClose::< 
                 (# 
                 <<SLOT codeViewWindowOnAboutToClose:DoPart>>
                 #)
            #);
          open::<  (#  <<SLOT codeViewWindowOpen:DoPart>> #);
          
       #);
     viewSeparate:
       (#
          ff: ^mpsinterface.AST.fragmentForm;
          node: ^mpsinterface.AST.ast;
          cVW: ^codeViewWindow;
          
       enter (ff[],node[])
       <<SLOT viewSeparate:DoPart>>
       exit cVW[]
       #);
     edenv: ^editorEnv;
     onCodeViewOpen:<
       (# theCodeView: ^codemoveableeditor; 
       enter theCodeView[]
       do
          INNER ;
          (if interface.debuggerExternalInterface[] <> none then
              theCodeView[]->interface.debuggerExternalInterface.onCodeViewOpen;
              (* Allow Valhalla to append action *)
              
          if);
          
       #);
     ymerLocalWindow: window
       (#
          opened: @boolean;
          open::< 
            (# 
            do
               true->opened;
               INNER ;
               (if opened then
                   (if THIS(ymerBrowserWindow)[]->ymer.browsers.has then
                       THIS(ymerLocalWindow)[]
                         ->
                           (THIS(ymerBrowserWindow).theMenubar).windowsMenu.
                             insertWindow
                   if)
               if);
               
            #);
          eventhandler::< 
            (#
               onActivate::<  (#  do true->ymer.isActive; INNER #);
               onDeactivate::<  (#  do false->ymer.isActive; INNER #);
               onAboutToClose::< 
                 (# 
                 do
                    INNER ;
                    (if okToClose then
                        THIS(ymerLocalWindow).closeDown->okToClose; 
                    if)
                 #)
            #);
          closeDown:<
            (# okToClose: @boolean
            do
               true->okToClose;
               (if THIS(ymerBrowserWindow)[]->ymer.browsers.has then
                   THIS(ymerLocalWindow)[]
                     ->
                       (THIS(ymerBrowserWindow).theMenubar).windowsMenu.
                         deleteWindow
               if);
               INNER closeDown;
               
            exit okToClose
            #);
          close::<  (#  do THIS(ymerLocalWindow).closeDown; false->opened #)
       #);
     loadSettings: (#  <<SLOT ymerLoadSettings:DoPart>> #);
     loadProject:
       (#
       (* proj: ^browser.projects.project
        enter proj[]*) 
       <<SLOT ymerLoadProject:DoPart>>
       #);
     appendProject:
       (#
          location: ^text;
          (* newProj (*private* ) : ^browser.projects.project;  *)
          
       enter location[]
       <<SLOT ymerAppendProject:DoPart>>
       #);
     appendDone:
       (# 
       <<SLOT ymerAppendDone:DoPart>>
       #);
     addProject:
       (# location: ^text; 
       enter location[]
       <<SLOT ymerAddProject:DoPart>>
       #);
     browser: @browserType;
     browserType:< ymerSourceBrowser;
     ymerSourceBrowser: sourcebrowser
       (#
          <<SLOT browserLib:Attributes>>;
          browserEditMode::  (#  do ymer.editmode->value #);
          selectNode::  (#  <<SLOT browserSelectNode:DoPart>> #);
          followLink:: 
            (# 
            do
               groupname[]->selectFragmentGroup
            #);
          fileEdit::  (#  <<SLOT browserFileEdit:DoPart>> #);
          projectInfoType:: 
            (#
               <<SLOT projectInfoLib:Attributes>>;
               formList: list (# element::  (# location: @text #) #);
               projectList:: 
                 (#
                    <<SLOT parseDefn:Attributes>>;
                    parseProjectFile:
                      (#
                         projectFile: ^text;
                         newProj: ^project
                      enter
                      (projectFile[],newProj[])
                      <<SLOT ymerParseProjectFile:DoPart>>
                      #)
                 #);
               theProjects: @projectList;
               project:: 
                 (#
                    superProject: ^project;
                    level: @integer;
                    unfolded,isLoaded: @boolean;
                    copy:
                      (# newProj: ^project
                      do
                         &project[]->newProj[];
                         name.copy->newProj.name[];
                         location->newProj.location;
                         isDirectory->newProj.isDirectory;
                         isDotDotDirectory->newProj.isDotDotDirectory;
                         isProjectFile->newProj.isProjectFile;
                         isRoot->newProj.isRoot;
                         isExtent->newProj.isExtent;
                         isDomain->newProj.isDomain;
                         hasSubprojects->newProj.hasSubprojects;
                         subprojects->newProj.subprojects;
                         groups->newProj.groups;
                         unfolded->newProj.unfolded;
                         none ->newProj.superProject[];
                         0->newProj.level;
                         
                      exit newProj[]
                      #);
                    scanGroupsImpl:: 
                      (#
                         newGroup: ^group;
                         dependencyPrivate:
                           @<<SLOT dependencyPrivate:Descriptor>>;
                         dependencyInit:
                           (#  <<SLOT dependencyInit:DoPart>> #);
                         dependencyRegister:
                           (# fgName: ^text
                           enter fgName[]
                           <<SLOT dependencyRegister:DoPart>>
                           #);
                         dependencyCreateSubprojects:
                           (# selectedProj: ^projects.project; 
                           do
                              THIS(project)[]->selectedProj[];
                              selectedProj.subProjects.clear;
                              <<SLOT dependencyCreateSubprojects:Descriptor>>
                           #);
                         
                      <<SLOT scanGroupsImpl:DoPart>>
                      #)
                 #);
               group:: 
                 (#
                    temporary: @boolean;
                    forms: @formList;
                    close::
                    (* remove all entries from history, and
                     * deselect project
                     *)  (#  <<SLOT ymerGroupClose:DoPart>> #);
                    getfg:: 
                      (#
                         doRealOpen:
                           (#
                              g:
                                ^mpsinterface.AST.
                                   FragmentGroup
                           enter g[]
                           <<SLOT ymerGroupDoRealOpen:DoPart>>
                           #);
                         recheck:: 
                           (#
                              allowReload:
                                @boolean;
                              t: @text;
                              cg: ^group
                           <<SLOT ymerGroupRecheck:DoPart>>
                           #)
                      <<SLOT ymerGroupGetFg:DoPart>>
                      #);
                    getDomain::  (#  <<SLOT ymerGroupGetDomain:DoPart>> #);
                    getExtent:: 
                      (# 
                      <<SLOT ymerGroupGetExtent:DoPart>>
                      #)
                 #);
               scanProjectsImpl:: 
                 (# 
                 do theProjects.scan (#  do current[]->thescan.foreach #)
                 #);
               init::  (#  do theProjects.init;  #);
               
            #);
          projectsLabel::  (#  do 'Projects'->t[] #);
          emptyProjectListLabel::  (#  do 'Groups'->t[] #);
          emptyGroupViewLabel::  (#  do 'Fragments'->t[] #);
          emptyCodeViewLabel::  (#  do 'Form'->t[] #);
          onProjectListOpen::  (#  <<SLOT onProjectListOpen:DoPart>> #);
          onGroupListOpen:: 
            (# 
            <<SLOT onGroupListOpen:DoPart>>
            #);
          onCodeViewOpen::< 
            (# 
            do thecodeview[]->THIS(ymerBrowserWindow).onCodeViewOpen; INNER
            #);
          onFragmentgroupViewOpen:: 
            (#  <<SLOT onFragmentgroupViewOpen:DoPart>> #);
          onCurrentProjectChange:: 
            (# 
            <<SLOT onCurrentProjectChange:DoPart>>
            #);
          onCurrentGroupChange:: 
            (#  <<SLOT onCurrentGroupChange:DoPart>> #);
          onCurrentFormChange:: 
            (# 
            <<SLOT onCurrentFormChange:DoPart>>
            #);
          (*selectFragmentGroup:
           (# fgName: ^text
           enter fgName[]
           <<SLOT selectFragmentGroup:DoPart>>
           #);
           selectFragmentForm:
           (#
           fgName: ^text;
           formName: ^text
           enter (fgName[],formName[])
           <<SLOT selectFragmentForm:DoPart>>
           #);*)
          eventhandler:: 
            (#
               onFatherFrameChanged:: 
                 (#  do THIS(ymerBrowserWindow).size->size #)
            #);
          open::  (# w,h: @integer <<SLOT browserOpen:DoPart>> #);
          editorEncloserType::< 
            (#
               tryclose::< 
                 (# 
                 do
                    INNER ;
                    (if okToClose then
                        THIS(ymerBrowserWindow).close
                    if)
                 #);
               onHighLight:: 
                 (# 
                 do edenv.wriggleWindows->THIS(ymerBrowserWindow).wriggle
                 #);
               getAST::  (#  do mps.AST[]->AST[] #);
               getBETACFL::  (#  do mps.BETACFL[]->BETACFL[] #);
               
            #);
          setupToolbar::  (#  <<SLOT setuptoolb:DoPart>> #)
       #);
     eventhandler::< 
       (#
          onActivate::< 
            (# 
            do true->ymer.isActive; INNER
            #);
          onDeactivate::< 
            (# 
            do false->ymer.isActive; INNER
            #);
          onAboutToClose::< 
            (# 
            <<SLOT ymerOnAboutToClose:DoPart>>
            #)
       #);
     close::< 
       (# 
       <<SLOT ymerClose:DoPart>>
       #);
     closeGroups: booleanValue (#  <<SLOT ymerCloseGroups:DoPart>> #);
     quit:< (# okToClose: @boolean <<SLOT ymerQuit:DoPart>> #);
     onTerminateApplication:<
     (* is called when this fragmentbrowser is terminated. You
      * can for example further bind this control whether
      * actually to terminate by assigning false to okToTerminate
      *)
       (# okToTerminate: @boolean
       do true->okToTerminate; INNER
       exit okToTerminate
       #);
     open::<  (#  do <<SLOT ymerOpen:Descriptor>> #);
     menubarType::< 
       (#
          fileMenu: @fileMenuType;
          fileMenuType:< menu
            (#
               iSaveSettings: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (# 
                           <<SLOT menuFileSaveSettingsOnselect:DoPart>>
                           #)
                      #);
                    open::  (#  do 'Save settings'->name #)
                 #);
               iReloadSettings: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (# 
                           <<SLOT menuFileReloadSettingsOnselect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Reset settings'->name
                      #)
                 #);
               iClose: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (#  <<SLOT menuFileCloseOnstatus:DoPart>> #);
                         onSelect:: 
                           (# 
                           <<SLOT menuFileCloseOnselect:DoPart>>
                           #)
                      #);
                    open::  (#  do 'w'->key; 'Close'->name #)
                 #);
               iQuit: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (#  <<SLOT menuFileQuitOnselect:DoPart>> #);
                         onStatus:: 
                           (# 
                           <<SLOT menuFileQuitOnStatus:DoPart>>
                           #);
                      #);
                    open::  (#  do 'q'->key; 'Quit'->name #)
                 #);
               open:: 
                 (# sep: ^menuItem
                 do
                    'File'->name;
                    INNER ;
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append;
                    iSaveSettings.open;
                    iSaveSettings[]->append;
                    iReloadSettings.open;
                    iReloadSettings[]->append;
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append;
                    (* moved to ymersiflib:
                     * iClose.open;
                     * iClose[]->append; 
                     *)
                    iQuit.open;
                    iQuit[]->append
                 #);
               setup: (#  do open; fileMenu[]->THIS(menubarType).append #);
               
            #);
          projectMenu: @menu
            (#
               iLoad: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (#
                              theTitle,t: ^text;
                              (*newProj: ^browser.projects.project;*)
                              
                           enter theTitle[]
                           <<SLOT menuProjectsLoadOnselect:DoPart>>
                           #)
                      #);
                    open::  (#  do 'Open...'->name #)
                 #);
               iNew: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                              false
                              (*((browser.currentProject[] = none ) or
                               browser.currentProject.hasSubProjects)*) ->value
                           #);
                         onSelect:: 
                           (# (* cp: ^browser.projects.project; *)
                              newProjectWindow: @ymerLocalWindow
                                (#
                                   switchWidth: @integer;
                                   height,distance,windowWidth,windowHeight:
                                     @integer;
                                   setFrame:
                                     (# 
                                     do
                                        recalc;
                                        8*height+4*distance->windowHeight;
                                        (windowWidth,windowHeight)->size;
                                        
                                     #);
                                   recalc:
                                     (# 
                                     do
                                        3->distance;
                                        (switchWidth*3)+distance*4->windowWidth;
                                        
                                     #);
                                   bCancel: @pushButton
                                     (#
                                        setFrame:
                                          (# x,y,w,h: @integer
                                          do
                                             recalc;
                                             distance->x;
                                             distance->y;
                                             (windowWidth-3*distance) / 2->w;
                                             height->h;
                                             ((x,y),(x+w,y+h))->frame;
                                             
                                          #);
                                        open:: 
                                          (# 
                                          do setFrame; 'Cancel'->label
                                          #);
                                        eventhandler:: 
                                          (#
                                             onMouseUp:: 
                                               (# 
                                               do newProjectWindow.hide
                                               #);
                                             onFatherFrameChanged:: 
                                               (#  do setFrame #)
                                          #)
                                     #);
                                   bOk: @pushButton
                                     (#
                                        setFrame:
                                          (# x,y,w,h: @integer
                                          do
                                             recalc;
                                             distance+(windowWidth-3*distance)
                                               ->x;
                                             distance->y;
                                             (windowWidth-3*distance) / 2->w;
                                             height->h;
                                             ((x,y),(x+w,y+h))->frame;
                                             
                                          #);
                                        open:: 
                                          (#  do setFrame; 'OK'->label #);
                                        eventhandler:: 
                                          (#
                                             onMouseUp:: 
                                               (# 
                                               do
                                               (*  switchEdit.contents.contents
                                                ->cp.name[];
                                                (if browser.currentProject[] =
                                                none then
                                                cp[]
                                                ->
                                                browser.projects.
                                                theProjects.append;
                                                
                                                else
                                                (if
                                                browser.currentProject.
                                                hasSubProjects then
                                                cp[]
                                                ->
                                                browser.
                                                currentProject.
                                                subProjects.
                                                append
                                                if)
                                                if);
                                                browser.projectsChanged;
                                                cp[]->browser.setProject;*)
                                                  newProjectWindow.close
                                               #);
                                             onFatherFrameChanged:: 
                                               (#  do setFrame #)
                                          #)
                                     #);
                                   switchesFrame: @labelled
                                     (#
                                        contentsType:: canvas
                                          (#
                                             projectFileBox: @radioButton
                                               (#
                                                  setFrame:
                                                    (# x,y,w,h: @integer
                                                    do
                                                       recalc;
                                                       0->x;
                                                       distance->y;
                                                       switchWidth->w;
                                                       height->h;
                                                       ((x,y),(x+w,y+h))->frame;
                                                       
                                                    #);
                                                  open:: 
                                                    (# 
                                                    do
                                                       setFrame;
                                                       'project file'->label
                                                    #);
                                                  eventhandler:: 
                                                    (#
                                                       onMouseUp:: 
                                                         (# 
                                                         do
                                                         (*true
                                                          ->cp.isProjectFile*) 
                                                         #);
                                                       onFatherFrameChanged:: 
                                                         (#  do setFrame #)
                                                    #)
                                               #);
                                             rootBox: @radioButton
                                               (#
                                                  setFrame:
                                                    (# x,y,w,h: @integer
                                                    do
                                                       recalc;
                                                       0->x;
                                                       height+distance->y;
                                                       switchWidth->w;
                                                       height->h;
                                                       ((x,y),(x+w,y+h))->frame;
                                                       
                                                    #);
                                                  open:: 
                                                    (# 
                                                    do
                                                       setFrame;
                                                       'root project'->label
                                                    #);
                                                  eventhandler:: 
                                                    (#
                                                       onMouseUp:: 
                                                         (#
                                                         (* do true->cp.isRoot *)
                                                         
                                                         #);
                                                       onFatherFrameChanged:: 
                                                         (#  do setFrame #)
                                                    #)
                                               #);
                                             subProjectBox: @radioButton
                                               (#
                                                  setFrame:
                                                    (# x,y,w,h: @integer
                                                    do
                                                       recalc;
                                                       0->x;
                                                       (height+distance)*2->y;
                                                       switchWidth->w;
                                                       height->h;
                                                       ((x,y),(x+w,y+h))->frame;
                                                       
                                                    #);
                                                  open:: 
                                                    (# 
                                                    do
                                                       setFrame;
                                                       'sub project'->label
                                                    #);
                                                  eventhandler:: 
                                                    (#
                                                       onMouseUp:: 
                                                         (# 
                                                         do
                                                         (*true
                                                          ->
                                                          cp.
                                                          hasSubprojects*) 
                                                         #);
                                                       onFatherFrameChanged:: 
                                                         (#  do setFrame #)
                                                    #)
                                               #);
                                             open:: 
                                               (# 
                                               do
                                                  projectFileBox.open;
                                                  rootBox.open;
                                                  subProjectBox.open;
                                                  
                                               #)
                                          #);
                                        setFrame:
                                          (# x,y,w,h: @integer
                                          do
                                             recalc;
                                             distance->x;
                                             distance+height->y;
                                             windowWidth-2*distance->w;
                                             height*5+distance->h;
                                             ((x,y),(x+w,y+h))->frame;
                                             
                                          #);
                                        open:: 
                                          (# 
                                          do setFrame; 'Project Type'->label
                                          #);
                                        eventhandler:: 
                                          (#
                                             onFatherFrameChanged:: 
                                               (#  do setFrame #)
                                          #)
                                     #);
                                   switchEdit: @labelled
                                     (#
                                        contentsType:: editText;
                                        setFrame:
                                          (# x,y,w,h: @integer
                                          do
                                             recalc;
                                             distance->x;
                                             height*6+distance*3->y;
                                             windowWidth-2*distance->w;
                                             height*2->h;
                                             ((x,y),(x+w,y+h))->frame;
                                             
                                          #);
                                        open:: 
                                          (# 
                                          do setFrame; 'Project name'->label
                                          #);
                                        eventhandler:: 
                                          (#
                                             onFatherFrameChanged:: 
                                               (#  do setFrame #)
                                          #)
                                     #);
                                   tst: @pushButton
                                     (#
                                        open:: 
                                          (#
                                             ts: ^textStyle;
                                             buttonLabel:
                                               (#  exit 'more choises' #);
                                             buttonWidth: @integer
                                          do
                                             buttonLabel->label;
                                             style->ts[];
                                             ((buttonLabel->ts.widthOfText)+5,
                                              ts.lineHeight+3)
                                               ->(switchWidth,height);
                                             switchWidth+8->switchWidth;
                                             height+8->height;
                                             
                                          #)
                                     #);
                                   open::< 
                                     (# 
                                     do
                                        tst.open;
                                        tst.hide;
                                        tst.close;
                                        setFrame;
                                        newProjectWindow.contents->bCancel.open;
                                        newProjectWindow.contents->bOk.open;
                                        newProjectWindow.contents
                                          ->switchesFrame.open;
                                        newProjectWindow.contents
                                          ->switchEdit.open;
                                        'New Project'->title;
                                        hide;
                                        INNER
                                     #)
                                #);
                              
                           do (* &browser.projects.project[]->cp[]; *)
                              newProjectWindow.open;
                              newProjectWindow.showmodal;
                              
                           #)
                      #);
                    open::  (#  do 'New...'->name #)
                 #);
               iSave: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                           (*
                            false and (browser.currentProject[] <> none )
                            ->value*) 
                           #);
                         onSelect::  (#  do  #)
                      #);
                    open::  (#  do 'Save'->name #)
                 #);
               iSaveAs: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                           (*(browser.currentProject[] <> none ) and
                            (browser.currentProject.isProjectFile)->value*) 
                           #);
                         onSelect:: 
                           (# (*cp: ^browser.projects.project; t: ^text *) 
                           do <<SLOT menuProjectsSaveAsOnselect:Descriptor>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Save As...'->name
                      #)
                 #);
               iRename: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do (*  browser.currentProject[] <> none ->value*) 
                           #);
                         onSelect:: 
                           (# (*cp: ^browser.projects.project;*) t: ^text
                           do <<SLOT menuProjectsRenameOnSelect:Descriptor>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Rename...'->name
                      #)
                 #);
               iReload: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do (* browser.currentProject[] <> none ->value *) 
                           #);
                         onSelect:: 
                           (# (* cp: ^browser.projects.project*) 
                           <<SLOT menuProjectsReloadOnSelect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Reload'
                           ->name
                      #)
                 #);
               iDelete: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                           (*browser.
                            currentProject[] <> none ->value *) 
                           #);
                         onSelect:: 
                           (# (* cp: ^browser.projects.project *) 
                           <<SLOT menuProjectsDeleteOnselect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Close'->name
                      #)
                 #);
               iTxtFiles: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                           (* (browser.currentProject[] <> none ) and
                            browser.currentProject.showTxtFiles->checked;
                            browser.currentProject[] <> none ->value*) 
                           #);
                         onSelect:: 
                           (# (* cp: ^browser.projects.project *) 
                           <<SLOT menuProjectsTxtFilesOnselect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Show Text Files'->name
                      #)
                 #);
               open:: 
                 (# sep: ^menuItem
                 do
                    'Project'->name;
                    iNew.open;
                    iNew[]->append;
                    iLoad.open;
                    iLoad[]->append;
                    iReload.open;
                    iReload[]->append;
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append;
                    iSave.open;
                    iSave[]->append;
                    iSaveAs.open;
                    iSaveAs[]->append;
                    iRename.open;
                    iRename[]->append;
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append;
                    iDelete.open;
                    iDelete[]->append;
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append;
                    iTxtFiles.open;
                    iTxtFiles[]->append;
                    
                 #);
               setup:
                 (#  do open; projectMenu[]->THIS(menubarType).append #);
               
            #);
          groupMenu: @menu
            (#
               iNew: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                           (*(browser.currentProject[] <> none ) and
                            (browser.currentProject.isProjectFile or
                            browser.currentProject.isDirectory)->value *) 
                           #);
                         onSelect:: 
                           (#
                              t: ^text;
                              (* newGroup: ^browser.projects.group;  *)
                              
                           <<SLOT menuGroupsNewOnselect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do 'New group'->name
                      #)
                 #);
               iAdd: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                           (* (browser.
                            currentProject[] <> none ) and
                            (browser.currentProject.isProjectFile)->value *) 
                           #);
                         onSelect:: 
                           (#  <<SLOT menuGroupsAddOnselect:DoPart>> #)
                      #);
                    open:: 
                      (# 
                      do 'Add group'->name
                      #)
                 #);
               iDelete: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                              true
                              (*(browser.currentProject[]<>NONE) and
                               (browser.currentProject.isProjectFile or
                               browser.currentProject.isDirectory)*) ->value
                           #);
                         onSelect:: 
                           (#  <<SLOT menuGroupsDeleteOnselect:DoPart>> #)
                      #);
                    open:: 
                      (# 
                      do
                         'Delete group'
                           ->name
                      #)
                 #);
               open:: 
                 (# sep: ^menuItem
                 do
                    'Group'->name;
                    iNew.open;
                    iNew[]->append;
                    iAdd.open;
                    iAdd[]->append;
                    iDelete.open;
                    iDelete[]->append;
                    
                 #);
               setup:
                 (# 
                 do
                    open;
                    groupMenu[]
                      ->
                        THIS(menubarType
                        ).append
                 #);
               
            #);
          historyMenu: @menu
            (#
               <<SLOT historyMenuLib:Attributes>>;
               histElement:
                 (#
                    name: ^text;
                    elm: ^object
                 #);
               HistCont: @arrayContainer
                 (#
                    element:: histElement;
                    less:: 
                      (# 
                      do
                         (if right[] <> none
                          then
                             (if left[] <> none then
                                 (if right.name[] <> none then
                                     left.name[]->right.name.less->value; 
                                 if);
                                 
                             if);
                             
                         if)
                      #);
                    
                 #);
               protected: @ (* private *) boolean;
               open::  (#  <<SLOT historyMenuOpen:DoPart>> #);
               setup:
                 (# 
                 do
                    open;
                    historyMenu[]
                      ->THIS(menubarType).append
                 #);
               
            #);
          windowsMenu: @menu
            (#
               <<SLOT windowsMenuPrivate:Attributes>>;
               eventhandler:: 
                 (# onSelect::  (#  <<SLOT windowsMenuOnSelect:DoPart>> #)
                 #);
               insertWindow:
                 (# win: ^window
                 enter win[]
                 do
                    <<SLOT windowsMenuInsertWindow:Descriptor>>
                 #);
               deleteWindow:
                 (# win: ^window
                 enter win[]
                 <<SLOT windowsMenuDeleteWindow:DoPart>>
                 #);
               istatus: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (# 
                           <<SLOT windowsmenustatus:DoPart>>
                           #)
                      #)
                 #);
               ishowNode: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (#  <<SLOT windowsmenushownode:DoPart>> #)
                      #)
                 #);
               iSeparateBrowser: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (# 
                           <<SLOT windowsMenuSeparateBrowser:DoPart>>
                           #)
                      #);
                    open::  (#  do 'Open Separate Browser'->name #)
                 #);
               iGraphBrowser: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do (* browser.currentGroup[] <> none ->value*) 
                           #);
                         onSelect:: 
                           (#  <<SLOT windowsMenuGraphBrowser:DoPart>> #)
                      #);
                    open:: 
                      (# 
                      do
                         'Open Dependency Graph Browser'->name
                      #)
                 #);
               iSeparateCodeView: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus::  (#  do browser.cfe <> none ->value #);
                         onSelect:: 
                           (#  <<SLOT windowsMenuSeparateCodeView:DoPart>> #)
                      #);
                    open::  (#  do 'Open Separate Code Viewer'->name #)
                 #);
               iWorkspace: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onSelect:: 
                           (#  <<SLOT windowsMenuWorkspace:DoPart>> #)
                      #);
                    open:: 
                      (# 
                      do
                         'Open Workspace'
                           ->name
                      #)
                 #);
               iSemanticViewer: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do
                              Interface.
                                currentGroup[] <> none ->value
                           #);
                         onSelect:: 
                           (# 
                           <<SLOT windowsMenuSemanticViewerOnselect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Open Semantic Errors Viewer'->name
                      #)
                 #);
               iSemanticEditor: @menuItem
                 (#
                    eventhandler:: 
                      (#
                         onStatus:: 
                           (# 
                           do Interface.currentGroup[] <> none ->value
                           #);
                         onSelect:: 
                           (# 
                           <<SLOT windowsMenuSemanticEditorOnselect:DoPart>>
                           #)
                      #);
                    open:: 
                      (# 
                      do
                         'Open Semantic Errors Editor'->name
                      #)
                 #);
               iLogWindow: @menuItem
                 (#
                    iLogMenu: @menu
                      (#
                         ishow: @item
                           (#
                              eventhandler:: 
                                (#
                                   onStatus:: 
                                     (# 
                                     do
                                        true->value;
                                        (if ymer.logwin.isOpen then
                                            ymer.logwin.visible->checked; 
                                         else
                                            false->checked; 
                                        if);
                                        
                                     #);
                                   onSelect:: 
                                     (# 
                                     do
                                        not checked->checked;
                                        (if ymer.logwin.visible then
                                            ymer.logwin.hide; 
                                         else
                                            ymer.logwin.show;
                                            ymer.logwin.bringtofront;
                                            
                                        if);
                                        
                                     #)
                                #);
                              open:: 
                                (# 
                                do
                                   'Show Log Window'->name;
                                   (specKeys.F6,false,false,false)->specialKey
                                #)
                           #);
                         iflush: @menuitem
                           (#
                              eventhandler:: 
                                (# onSelect::  (#  do ymer.logwin.flush #)
                                #);
                              open::  (#  do 'Flush Log'->name #)
                           #);
                         isaveas: @menuitem
                           (#
                              eventhandler:: 
                                (# onSelect::  (#  do ymer.logwin.saveas #)
                                #);
                              open::  (#  do 'Save Log As...'->name #)
                           #);
                         open:: 
                           (# 
                           do
                              ishow.open;
                              ishow[]->append;
                              iflush.open;
                              iflush[]->append;
                              isaveas.open;
                              isaveas[]->append
                           #);
                         
                      #);
                    eventhandler:: 
                      (# onStatus::  (#  do true->value #);  #);
                    open:: 
                      (# 
                      do 'Log'->name; iLogMenu.open; iLogMenu[]->submenu
                      #)
                 #);
               open:: 
                 (# sep: ^menuItem; 
                 do
                    'Windows'->name;
                    iWorkspace.open;
                    iWorkspace[]->append;
                    iSeparateBrowser.open;
                    (*iGraphBrowser.open;
                     iGraphBrowser[]->append;*)
                    iSeparateBrowser[]->append;
                    iSeparateCodeView.open;
                    iSeparateCodeView[]->append;
                    iSemanticViewer.open;
                    iSemanticViewer[]->append;
                    (*                     iSemanticEditor.open;
                     *                     iSemanticEditor[]->append;*)
                    (*iStatus.open;
                     iStatus[]->append; *)
                    (* iShowNode.open;
                     iShowNode[]->append; *)
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append;
                    iLogWindow.open;
                    iLogWindow[]->append;
                    &separator[]->sep[];
                    sep.open;
                    sep[]->append
                 #);
               setup:
                 (#  do open; windowsMenu[]->THIS(menubarType).append #);
               
            #);
          helpMenu: @menu
            (#
               doc_dir_present: @boolean;
               use_local_files: @boolean;
               lookForDocDir: <<SLOT LookForDocDir:Descriptor>>;
               openURL:
                 (#
                    path,url: ^text;
                    is_doc_url: @boolean
                 enter (path[],is_doc_url)
                 <<SLOT OpenURL:DoPart>>
                 #);
               helpi: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onStatus::  (#  do true->value;  #);
                         onSelect::  (#  do ('index.html',true)->openURL #)
                      #);
                    open:: 
                      (# 
                      do
                         docMenu.open;
                         docMenu[]->submenu;
                         'Web Documentation'->name
                      #)
                 #);
               docMenu: @menu
                 (#
                    docIndex: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (#  do ('index.html',true)->openURL #)
                           #);
                         open:: 
                           (# 
                           do
                              'Mjlner System Documentation'->name;
                              ('h',false,true,true)->specialKey;
                              
                           #)
                      #);
                    mjolnerOverview: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (# 
                                do
                                   ('mjolner-overview/index.html',true)->openURL
                                #)
                           #);
                         open::  (#  do 'Mjlner Tool Overview'->name #)
                      #);
                    mjolnerTutorial: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (# 
                                do ('mjolner-tut/index.html',true)->openURL
                                #)
                           #);
                         open::  (#  do 'Mjlner Tool Tutorial'->name #)
                      #);
                    mjolnerWorkshop: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (# 
                                do
                                   ('mjolner-workshop/index.html',true)->openURL
                                #)
                           #);
                         open::  (#  do 'Mjlner Tool Workshop'->name #)
                      #);
                    mjolnerReference: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (# 
                                do ('mjolner/index.html',true)->openURL
                                #)
                           #);
                         open::  (#  do 'Mjlner Tool Reference'->name #)
                      #);
                    betaFAQ: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (# 
                                do ('faq/beta-language-faq.html',true)->openURL
                                #)
                           #);
                         open::  (#  do 'BETA Language FAQ'->name #)
                      #);
                    mjolnerWWW: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus::  (#  do true->value;  #);
                              onSelect:: 
                                (# 
                                do
                                   ('http://www.mjolner.com/index.html',false)
                                     ->openURL
                                #)
                           #);
                         open::  (#  do 'Mjlner Informatics'->name #)
                      #);
                    tryLocal: @menuitem
                      (#
                         eventhandler:: 
                           (#
                              onStatus:: 
                                (# 
                                do
                                   doc_dir_present->value;
                                   doc_dir_present and use_local_files->checked;
                                   
                                #);
                              onSelect:: 
                                (# 
                                do not use_local_files->use_local_files
                                #)
                           #);
                         open:: 
                           (# 
                           do
                              'Use Local Files'->name;
                              LookForDocDir;
                              doc_dir_present->use_local_files;
                              
                           #)
                      #);
                    open:: 
                      (# sep: ^separator; 
                      do
                         mjolnerOverview.open;
                         mjolnerOverview[]->append;
                         mjolnerReference.open;
                         mjolnerReference[]->append;
                         mjolnerTutorial.open;
                         mjolnerTutorial[]->append;
                         mjolnerWorkshop.open;
                         mjolnerWorkshop[]->append;
                         &separator[]->sep[];
                         sep.open;
                         sep[]->append;
                         docIndex.open;
                         docIndex[]->append;
                         betaFAQ.open;
                         betaFAQ[]->append;
                         &separator[]->sep[];
                         sep.open;
                         sep[]->append;
                         mjolnerWWW.open;
                         mjolnerWWW[]->append;
                         &separator[]->sep[];
                         sep.open;
                         sep[]->append;
                         tryLocal.open;
                         tryLocal[]->append;
                         
                      #)
                 #);
               abouti: @menuitem
                 (#
                    eventhandler:: 
                      (#
                         onStatus::  (#  do true->value #);
                         onSelect:: 
                           (# w: @aboutWindow (#  #);  do w.open;  #)
                      #);
                    open::  (#  do 'About Mjolner'->name #)
                 #);
               open:: 
                 (# 
                 do
                    'Help'->name;
                    helpi.open;
                    helpi[]->append;
                    abouti.open;
                    abouti[]->append
                 #);
               setup: (#  do open; helpMenu[]->THIS(menubarType).append #);
               
            #);
          <<SLOT additionalMenus:Attributes>>;
          
       #);
     insetDisplay:
       (# p: @point; r: @rectangle
       enter p
       do
          (((0,0),p),screenRectangle)
            ->r.intersection;
          (0,50)->r.inset;
          
       exit r.size
       #);
     ymerBrowserPrivate: (* GRAM hmm!!!!! *)
       @<<SLOT ymerBrowserPrivate:Descriptor>>;
     ymer: ^ymerEnv;
     myYmerCall: ^ymerCall;
     mps: ^ymermps;
     init: (#  enter (ymer[],mps[]) #);
     
  #);
  

-- lib: Attributes --
ymerEnv:
  (#
     <<SLOT ymerEnvLib:Attributes>>;
     ymerVersion:
       (#  exit '1.1.1 (rev. 1.65)' #);
     mps: @mpsType;
     mpsType: ymermps
       (#
          onGroupNotFound::< 
            (# t: @text; doneInInner: @boolean
            <<SLOT ymerMPSonGroupNotFound:DoPart>>
            #);
          onOldGroup::< 
            (# t: @text; doneInInner: @boolean
            <<SLOT ymerMPSonOldGroup:DoPart>>
            #);
          onParseErrors::< 
            (# 
            <<SLOT ymerMPSparseErrors:DoPart>>
            #);
          onFatalParseError::<  (#  do true->continue; INNER #);
          onUncheckedGroup::< 
            (#  do true->continue; true->allowChecking; INNER #);
          onNewGroup::< 
            (#  do true->continue; true->allowNewGroup; INNER #);
          onOtherError::< 
            (# doneInInner: @boolean <<SLOT ymerMPSonOtherError:DoPart>> #);
          onReadError::<  (#  <<SLOT ymerMPSonReadError:DoPart>> #);
          onWriteError::< 
            (# 
            do true->continue; INNER
            #);
          onWriteLstError::< 
            (# 
            do true->continue; INNER
            #);
          onOpenGroupDone::< 
            (# 
            <<SLOT ymerMPSOnOpenGroupDone:DoPart>>
            #);
          init::<  (#  <<SLOT ymerMPSinit:DoPart>> #);
          
       #);
     browsers: @list
       (# element:: (*ymerBrowser*) gui.Window
       #);
     browserCount: @integer (* private *) ;
     isActive: @boolean
     (* true, iff any of ymer's windows are active *) ;
     editMode:< (* trueObject => all code views are read only *) booleanObject;
     readOnlyMode: booleanObject (#  do true->value #);
     writeMode: booleanObject (#  do false->value #);
     silentInfoView: @boolean;
     loadEditorEnv: (#  <<SLOT loadEditorEnv:DoPart>> #);
     insetDisplay:
       (# p: @point; r: @rectangle
       enter p
       do
          (((0,0),p),gui.screenRectangle)
            ->r.intersection;
          (0,50)->r.inset;
          
       exit r.size
       #);
     currentcodemoveableeditor:
       ^guienv.window.codemoveableeditor;
     ymerPrivate:
       @<<SLOT ymerPrivate:Descriptor>>;
     BETAexecutable,SIFexecutable,FREJAexecutable,INTERFACEBUILDERexecutable,
       VALHALLAexecutable,TEXTexecutable,BETAWCexecutable: ^text;
     userGrammarInit:< object;
     init:< (#  enter gui[] do <<SLOT ymerInit:Descriptor>> #);
     gui: ^guienv;
     logwin: ^logWindow;
     logWindow: gui.streamwindow
       (#
          lt: @gui.timer
            (# action::  (#  do stop; hide #)
            #);
          wasvisible: @boolean;
          savestate:
            (# 
            do
               (if visible then
                   true->wasvisible
                else
                   false->wasvisible
               if)
            #);
          popstate:
            (# 
            do
               (if not wasvisible then
                   5000->lt.start
               if)
            #);
          open:: 
            (# 
            do
               hide;
               'Mjolner: Log Window'->title;
               'mjolner.log'->logfilename[];
               (550,350)->size;
               thestream[]->screen[];
               true->hideOnCloseByUser
            #)
       #);
     (*GRAM*)
     yi: @ymerEnvInterface
       (#
          AddMenuAction:: 
            (# 
            do ma[]->MenuActionList.append; 
            #);
          AddFileMenuAction:: 
            (# 
            do ma[]->fileMenuActionList.append
            #);
          openParseEditor:: 
            (# 
            do
               <<SLOT ymerEndOpenParseEditor:Descriptor>>
            #);
          showLogwindowPushState:: 
            (#  do logwin.savestate; logwin.show;  #);
          logWindowPopState::  (#  do logwin.popstate #)
       #);
     getInterface: (#  do mps[]->yi.mps[]; gui[]->yi.gui[];  exit yi[] #);
     newbrowser: (*GRAM*)
       (#
          browserWindow: ^guienv.ymerbrowserwindow;
          BrowserInt: ^ymerBrowserInterface;
          bwm: ^guienv.ymerbrowserwindow.menubarType;
          onOpen:< Object
       <<SLOT ymerNewBrowserDopart:DoPart>>
       #);
     fileMenuActionList: @list
       (#
          element:: gui.menuAppendItemAction
       #);
     MenuActionList: @list (# element:: gui.menubarAppendMenuAction #);
     newBrowserCallBack: ^guienv.BrowserCallBack;
     
  do INNER ymerEnv
  #);
  

