ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/persistentstore/persistentstore';
INCLUDE '~beta/sysutils/objinterface';
INCLUDE 'texthashtable';

--- program : descriptor ---
(# PS: @persistentstore(# allowLazyFetch::(# do false->value #) #);
   H: ^textHashTable;
   
do PS.init;
   'largeStore' -> PS.openRead;
   'opened first time' -> putLine; screen.newline;
   
   'Getting...' -> screen.putText;
   ('TextTable', textHashTable##) -> PS.get -> H[];
   
   'Scanning...' -> screen.putLine;
   H.scan (# do current[] -> putText; ','->put #);
   'scan done first time.\n' -> PutLine;
   
   'Closing...' -> screen.putText;
   PS.close 
   (# danglersExists::< 
        (# 
        do fetch -> toDo;
           'danglersExists called. Fetching danglers' -> screen.putLine;
        #)
   #);
   
   'largeStore' -> PS.openRead;
   'opened second time' -> putLine; screen.newline;
   
   'Getting...' -> screen.putText;
   ('TextTable', textHashTable##) -> PS.get -> H[];
   
   'Scanning...' -> screen.putLine;
   H.scan (# do current[] -> putText; ','->put #);
   'scan done second time.\n' -> PutLine;
   
   (# c: @char; do PS.close; #)
#)
