ORIGIN '~beta/persistentstore/persistentstore';
--LIB: attributes--
LinkedList: 
  (# elm: @Integer;
     next: ^LinkedList;
  exit this(LinkedList)[]
  #)
--PROGRAM: descriptor--
(# l, l2, l3: ^LinkedList;
   PS: @persistentstore(# allowLazyFetch::(# do true->value #) #);
do 
   PS.init;
   
   'refequalStore' -> PS.openWrite
   (# notFound::
        (# 
        do 'Creating...' -> screen.putLine;
           name[] -> PS.create;
           &LinkedList[]->l[];
           (l[],'mylist') -> PS.put;
           true -> continue
        #);
   do 'Opening...' -> screen.putLine;
      ('mylist', LinkedList##) -> PS.get -> l[];
   #);
   
   (# xx:@Integer;
      d0: (# 
          do
             'next is none'->screen.putLine;
             &LinkedList[]->l.next[]->l3[];
             l[]->l3.next[];
          #);
      d1: (# 
          do l.next[] -> l3[];
             l.next->l2[];
             (if l.next[] <> l3[] then
                 'l.next and l3 differ'->screen.putLine;
             if);
             (if l.next[] <> l2[] then
                 'l.next and l2 differ'->screen.putLine;
             if);
          #);
   do (if l.next[] = none then
          &d0;
       else 
          &d1;
      if);
   #);
   PS.close;
#)

