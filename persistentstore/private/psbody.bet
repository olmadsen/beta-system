ORIGIN '../persistentstore';
-- PStoreInit: DoPart --
do
   callRebinder##->registerRebinderFunc;
   &rebindSpecialReference[]->rebinderItem[];
   callOpenCrossStore##->registerOpenCrossStoreFunc;
   &openpstore[]->openCrossStoreItem[];
   (%getLongAt (@@ theProgram))->registerBETAENVandPROGRAM;
   INNER  

-- PStoreOpen: DoPart --
do
   (if path[] = none then
       (if (hostName,name)->openFunc
        // (NOTFOUNDERROR) then
           name[]->notFound
        // (ACCESSERRORERROR) then
           name[]->accessError
        else
           name[]->path[]; hostName->host[]; INNER
       if)
    else
       name[]->alreadyOpen; 
   if);
     

-- PStoreCreate: DoPart --
do
   (if path[] = none then
       (if (hostName,name)->createExt
        // (EXISTSERROR) then
           name[]->exists; 
        // (CREATIONERRORERROR) then
           name[]->creationError
        else
           hostName->host[]; name[]->path[]; 
       if)
    else
       name[]->alreadyOpen; 
   if);
   INNER  

-- PStoreCheckpoint: DoPart --
do setForceAOAGC; doGC;   

-- PStoreClose: DoPart --
do INNER ; checkpoint; (host,path)->closeExt; none ->path[]; none ->host[];   

-- PStoreGet: DoPart --
do
   (@@ theObject,((host,path,name)->getExt))->assignRef;
   (if theObject[] = none then notFound if);
   INNER  

-- PStorePut: DoPart --
do
   (%getLongAt (@@ obj))->forceObjectToAOA;
   doGC;
   (if ((dooverwrite,host,path,name,(%getLongAt (@@ obj)))->putExt)
    // (ALREADYTHEREERROR) then
       AlreadyThere; (if dooverwrite then HasOverWritten if)
   if);
   INNER  

-- PStoreRegisterSpecialObject: DoPart --
do
   'registerSpecialObject: Registering of special objects and instances'
     ->screen.putLine;
   'is implemented differently in the new persistence implementation.'
     ->screen.putLine;
   'This call has no effect, and should be removed.'->screen.putLine;
   INNER  

