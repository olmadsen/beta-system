ORIGIN '../psfullnamepatch';

INCLUDE '~beta/objectserver/execGroupTable';
INCLUDE '~beta/sysutils/objinterface';
INCLUDE '~beta/basiclib/external';

--- lib:attributes ---

newExecGroupTable: ExecGroupTable
  (# newInit: 
       (# getGroups:
            (# new: ^standardEGTE;
               current: ^group_header;
            do 
               loop:
                 (if (current[] -> NextGroup -> current[])<>NONE then
                     &standardEGTE[] -> new[];
                     &Text[]->new.groupName[];
                     current[]->NameOfGroup->new.address->extGetCstring->new.groupName;
                     nextInx -> new.inx;
                     (%getLongAt(current.protoTableAdr)) -> new.len;
                     (* Above line tos_converted from: current.protoTableAdr -> tos'%adrGetLong' -> new.len; *)
                     current.protoTableAdr + 4 -> new.ptListAdr;
                     new[]->nameHash.insert;
                     (new[],new.address) -> adrHash.insert;
                     restart loop;
                 if);
            #);
       do nameHash.init; 
          adrHash.init;
          getGroups;
       #)
  #)

--- psfullnamepatchimpl:descriptor ---
(# egte: ^newExecGroupTable;
do &newExecGroupTable[]->egte[];
   egte.newInit;
   egte[]->objectPool.put;
#)
