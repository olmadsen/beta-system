ORIGIN '~beta/objectbrowser/v2.0/mpsinterface';

(* Nedenstaaende er stjaalet fra ~beta/editor/v5.0/cv.bet med passende
 * rettelser. Operationen tilbydes vel paa et tidspunkt som et
 * standard interface af Elmer (?) *)

--- mpsinterfacelib: Attributes ---
betaGrammarInit:
  (# theMetaGrammar: ^AST.treelevel;
     grammarWithPath,help: ^text;
     gg: ^AST.fragmentGroup;
     bobsfile: @file
  do
     &AST.metaGrammar[]->theMetaGrammar[]->AST.grammarTable.meta[];
     theMetaGrammar.init;
     '~beta/grammars/metagram/v4.4/metagrammar'->grammarWithPath[];
     ('-meta'->grammarWithPath.copyAppend,screen[])->AST.top.open->gg[];
     (if gg[]
      // none then
         'Could not open: '->screen.putText;
         '-meta'->grammarWithPath.copyAppend->screen.putLine;
         (failure,'')->stop;
      else
         ('metagrammar',screen[])->gg.open->theMetagrammar.grammarAst[];
         (if theMetagrammar.grammarAst[]
          // none then
             'No grammarAst for '->screen.putText;
             grammarWithPath[]->screen.putLine;
             (failure,'')->stop;
          else
             grammarWithPath[]->AST.expandToFullPath->help[];
             '-parser'->help.append;
             AST.parserFileExtension->help.append;
             help[]->bobsFile.name;
             (if bobsFile.entry.exists
              // true then
                 bobsFile.name->theMetagrammar.parser.initialize;
              else
                 'No parser available: '->screen.putText;
                 bobsFile.name->screen.putLine;
             if)
         if);
     if);
     '~beta/grammars/beta/v2.4/beta'->grammarWithPath[];
     ('-meta'->grammarWithPath.copyAppend,screen[])->AST.top.open->gg[];
     (if gg[]
      // none then
         'Could not open: '->screen.putText;
         '-meta'->grammarWithPath.copyAppend->screen.putLine;
         (failure,'')->stop;
      else
         ('beta',screen[])->gg.open->BETACFL.grammarAst[];
         (if BETACFL.grammarAst[]
          // none then
             'No grammarAst for '->screen.putText;
             grammarWithPath[]->screen.putLine;
             (failure,'')->stop;
          else
             '-parser'->help[];
             AST.parserFileExtension->help.append;
             help[]->grammarWithPath.copyAppend->AST.expandToFullPath
               ->bobsFile.name;
             (if bobsFile.entry.exists
              // true then
                 bobsFile.name->BETACFL.parser.initialize;
                 ('objectdescriptor','descriptor')
                   ->BETACFL.parser.privatePart.b.defineNonTAlias;
                 ('attributedecl','attributes')
                   ->BETACFL.parser.privatePart.b.defineNonTAlias;
              else
                 'No parser available: '->screen.putText;
                 bobsFile.name->screen.putLine;
             if)
         if);
     if);
  #);
