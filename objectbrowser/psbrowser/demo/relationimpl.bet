ORIGIN 'hierarchy';
[[
-- Lib: Attributes --
dyt: (#  #)

-- doAttach: Descriptor --
(# do e[] -> thisEntity[]; #)

-- doCheckMember: Descriptor --
(#
do
   (for i:NumRelated repeat
        (if relates[i][]//e[] then true -> isRelated if)
   for)
#)

-- doRelate: Descriptor --
(# 
do
   (if r.thisEntity[] -> isRelate//true 
       then
    else
       (if (NumRelated=relates.range)//true then 1 -> relates.extend if);
       r.thisEntity[] -> relates[NumRelated+1 -> NumRelated][];
   if);
   (if thisEntity[] -> r.isRelate//true 
       then
    else
       (if r.NumRelated=r.relates.range//true then 1 -> r.relates.extend if);
       thisEntity[] -> r.relates[r.NumRelated+1 -> r.NumRelated][];
   if);
#)


-- doScan: Descriptor --
(#
do
   (if theEntity[]//none
       then
       (for i:NumRelated repeat
            relates[i][] -> current[];
            inner Scan;
       for);
    else
       (for i:NumRelated repeat
            (if relates[i][]//theEntity[] then
                relates[i][] -> current[];
                inner Scan;
            if);
       for);
   if);
#)

--]]

