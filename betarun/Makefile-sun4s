
#########  betarun.o / betarun.a / betarun_pe.o ########

betarun.o: C/c.common.o CRUN/c.run.o GC/c.gc.o
	ld -dn -r -o betarun.o C/c.common.o CRUN/c.run.o GC/c.gc.o

betarun.a: C/c.common.o CRUN/c.run.o GC/c.gc.o
	rm C/c.common.o CRUN/c.run.o GC/c.gc.o betarun.a
	ar -r betarun.a C/*.o GC/*.o CRUN/*.o

betarun_pe.o: C/c.common.o GC/c.gc.o CRUN/c.run.o
	ld -dn -r -o betarun_pe.o C/c.common.o GC/c.gc.o CRUN/c.run.o

pe:
	rm -f C/c.common.o C/initialize.o
	PE="-DPE"; export PE; make betarun_pe.o
	rm -f C/c.common.o C/initialize.o

C/c.common.o: ALWAYS
	cd C;  make PROF="$(PROF)" PE=$(PE)

CRUN/c.run.o: ALWAYS
	cd CRUN; make PROF="$(PROF)"

GC/c.gc.o: ALWAYS
	cd GC; make PROF="$(PROF)" 

######### betarun_v.o / betarun_v.a  #########

betarun_v.o: C/c.common.valhalla CRUN/c.run.valhalla GC/c.gc.valhalla
	ld -dn -r -o betarun_v.o C/c.common.valhalla CRUN/c.run.valhalla GC/c.gc.valhalla

betarun_v.a: C/c.common.valhalla CRUN/c.run.valhalla GC/c.gc.valhalla
	rm C/c.common.valhalla CRUN/c.run.valhalla GC/c.gc.valhalla betarun_v.a
	ar -r betarun_v.a C/*.o GC/*.o CRUN/*.o

C/c.common.valhalla: ALWAYS
	cd C;  make valhalla PROF="$(PROF)" PE=$(PE)

CRUN/c.run.valhalla: ALWAYS
	cd CRUN; make valhalla PROF="$(PROF)"

GC/c.gc.valhalla: ALWAYS
	cd GC; make valhalla PROF="$(PROF)"

valhalla: betarun_v.o

######### betarun_mt.o / betarun_mt.a  #########

betarun_mt.o: C/c.common.mt CRUN/c.run.mt GC/c.gc.mt
	ld -dn -r -o betarun_mt.o C/c.common.mt CRUN/c.run.mt GC/c.gc.mt

betarun_mt.a: C/c.common.mt CRUN/c.run.mt GC/c.gc.mt
	rm C/c.common.mt CRUN/c.run.mt GC/c.gc.mt betarun_mt.a
	ar -r betarun_mt.a C/*.o GC/*.o CRUN/*.o

C/c.common.mt: ALWAYS
	cd C;  make mt PROF="$(PROF)" PE=$(PE)

CRUN/c.run.mt: ALWAYS
	cd CRUN; make mt PROF="$(PROF)"

GC/c.gc.mt: ALWAYS
	cd GC; make mt PROF="$(PROF)"

mt: betarun_mt.o

######### betarun_debug_mt.o / betarun_debug_mt.a  #########

betarun_debug_mt.o: C/c.common.debug_mt CRUN/c.run.debug_mt GC/c.gc.debug_mt
	ld -dn -r -o betarun_debug_mt.o C/c.common.debug_mt CRUN/c.run.debug_mt GC/c.gc.debug_mt

betarun_debug_mt.a: C/c.common.debug_mt CRUN/c.run.debug_mt GC/c.gc.debug_mt
	rm C/c.common.debug_mt CRUN/c.run.debug_mt GC/c.gc.debug_mt betarun_debug_mt.a
	ar -r betarun_debug_mt.a C/*.o GC/*.o CRUN/*.o

C/c.common.debug_mt: ALWAYS
	cd C;  make debug_mt PROF="$(PROF)" PE=$(PE)

CRUN/c.run.debug_mt: ALWAYS
	cd CRUN; make debug_mt PROF="$(PROF)"

GC/c.gc.debug_mt: ALWAYS
	cd GC; make debug_mt PROF="$(PROF)"

debug_mt: betarun_debug_mt.o

######### betarun_debug.o ##########

debug: betarun_debug.o

betarun_debug.o: C/c.common.debug CRUN/c.run.debug GC/c.gc.debug
	ld -dn -r -o betarun_debug.o C/c.common.debug CRUN/c.run.debug GC/c.gc.debug

C/c.common.debug: ALWAYS
	cd C; make debug PROF="$(PROF)"

CRUN/c.run.debug: ALWAYS
	cd CRUN; make debug PROF="$(PROF)" 

GC/c.gc.debug: ALWAYS
	cd GC; make debug PROF="$(PROF)"

########## All ###########

all:
	make clean
	make
	make pe
#
	make clean
	make valhalla
#
	make clean
	make mt
#
	make clean
	make debug_mt
#
	make clean
	make debug

########## Misc ##########

tags:
	etags GC/*.[hc] CRUN/*.[hc] C/*.[hc] C/data.gen Makefile-* C/Makefile-* GC/Makefile-* CRUN/Makefile-*

clean: ALWAYS
	/bin/rm -f *~
	cd C; make clean
	cd CRUN; make clean
	cd GC; make clean
	sh -c 'if [ -d TST ]; then cd TST; make clean; fi'

commit:
	cvscom

com:
	cvscom

ALWAYS:
	@echo ""