# Makefile used on UNIX for cross platform development
# of NTI runtime system - typically on fraxinus.
# Notice the Makefile_nti files in the different
# directories - these are used on the PC.

RUNDEPS= \
RUN/AllocateComponent.run \
RUN/AllocateDopartObject.run \
RUN/AllocateItem.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/AllocateObjectRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/DataRegs.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run

tar: ntidebug.asm nti.asm
	tar cvhf nti.tar ntidebug.asm nti.asm Makefile \
                 C/*.h C/data.gen C/*.c C/Makefile C/ymakefile-C C/xmakefile\
                 GC/*.h GC/*.c GC/Makefile GC/ymakefile-GC GC/xmakefile

asm: nti.asm

debugasm: ntidebug.asm

nti.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	- ../GEN/nti/gen -o nti.asm RUN/nti

ntidebug.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	- ../GEN/nti/gen -debug -o ntidebug.asm RUN/nti

gen:
	cd ../GEN/nti; make

tags:
	etags RUN/*.run GC/*.[hc] C/*.[hc] C/data.gen

clean: ALWAYS
	cd C; make clean
	cd GC; make clean
	- rm -f *.group *.lst core *~ \#*
	- rm -f RUN/*.group RUN/*~ RUN/*.lst RUN/core

ALWAYS:

