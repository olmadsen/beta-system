RUNDEPS= \
RUN/AllocateComponent.run \
RUN/AllocateDopartObject.run \
RUN/AllocateItem.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/AllocateObjectRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/DataRegs.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run

betarun.o: nti.o C/c.common.o GC/c.gc.o 
	ld -x -r -o betarun.o C/c.common.o GC/c.gc.o nti.o

betarun.debug: C/c.common.debug GC/c.gc.debug ntidebug.o
	ld -r -o betarun.debug C/c.common.debug GC/c.gc.debug ntidebug.o

nti.o: nti.asm
	as -o nti.o nti.asm

ntidebug.o: ntidebug.asm
	as -o ntidebug.o ntidebug.asm

nti.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	- ../GEN/nti/gen -o nti.asm RUN/nti

ntidebug.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	- ../GEN/nti/gen -debug -o ntidebug.asm RUN/nti

pe:
	rm -f C/c.common.o C/initialize.o
	DEMO="-DPE"; export DEMO; make betarun.pe
	rm -f C/c.common.o C/initialize.o

debug: betarun.debug

asm: ntidebug.asm

gen:
	cd ../GEN/nti; make

C/c.common.debug: ALWAYS
	cd C; make debug

GC/c.gc.debug: ALWAYS
	cd GC; make debug

C/c.common.o: ALWAYS
	cd C; make

GC/c.gc.o: ALWAYS
	cd GC; make

tags:
	etags RUN/*.run GC/*.[hc] C/*.[hc] C/data.gen

check:
	@echo generating list of undefined labels
	@nm betarun.o | grep ' U ' > .new-undefined
	@echo find difference between .old-undefined and .new-undefined
	@diff .old-undefined .new-undefined

gendef:
	@echo generating list of undefined labels
	@nm betarun.o | grep ' U ' > .old-undefined

clean: ALWAYS
	cd C; make clean
	cd GC; make clean
	- rm -f *.group *.lst core *~ \#*
	- rm -f RUN/*.group RUN/*~ RUN/*.lst RUN/core

tar: ntidebug.asm nti.asm
	tar cvhf nti.tar ntidebug.asm nti.asm Makefile \
                 C/*.h C/data.gen C/*.c C/Makefile C/ymakefile-C C/xmakefile\
                 GC/*.h GC/*.c GC/Makefile GC/ymakefile-GC GC/xmakefile

ALWAYS:

