MAKE=nmake /nologo

BASEDIR=.

RUNDEPS= \
..\GEN\nti\gen.exe \
RUN/AllocateComponent.run \
RUN/AllocateDopartObject.run \
RUN/AllocateItem.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/Callback.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/COM.run \
RUN/Constant.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/RunAlloc.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run \
RUN/ntiadditions.run


all:	
	if exist *.lib del *.lib
	$(MAKE) -f Makefile-nti_ms clean 
	$(MAKE) -f Makefile-nti_ms betarun.lib 
	$(MAKE) -f Makefile-nti_ms clean 
	$(MAKE) -f Makefile-nti_ms betarun_v.lib 
#	$(MAKE) -f Makefile-nti_ms clean 
#	$(MAKE) -f Makefile-nti_ms betarun_ugc.lib
	$(MAKE) -f Makefile-nti_ms clean 
	$(MAKE) -f Makefile-nti_ms betarun_debug.lib

debug:	
	if exist betarun_debug.lib del betarun_debug.lib
	$(MAKE) -f Makefile-nti_ms betarun_debug.lib
sym:	
	if exist betarun_sym.lib del betarun_sym.lib
	$(MAKE) -f Makefile-nti_ms betarun_sym.lib
ugc:	
	if exist betarun_ugc.lib del betarun_ugc.lib
	$(MAKE) -f Makefile-nti_ms betarun_ugc.lib
valhalla:
	if exist betarun_v.lib del betarun_v.lib
	$(MAKE) -f Makefile-nti_ms betarun_v.lib 


betarun.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\P
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj $(BASEDIR)\P\*.obj

betarun_v.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\P
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj $(BASEDIR)\P\*.obj

betarun_ugc.lib: nti_ugc.asm
	ml /Zi /c /coff /Cp /nologo /w /Fonti_ugc.obj /Tanti_ugc.asm
	cd C
	$(MAKE) -nologo -f Makefile-nti_ms $@
	cd ..\P
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile-nti_ms $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\nti_ugc.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj  $(BASEDIR)\P\*.obj

betarun_debug.lib: ntidebug.asm
	ml /Zi /c /coff /Cp /nologo /w /Fontidebug.obj /Tantidebug.asm
	cd C
	$(MAKE) -nologo -f Makefile-nti_ms $@
	cd ..\P
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile-nti_ms $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\ntidebug.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj  $(BASEDIR)\P\*.obj

betarun_sym.lib: nti_sym.asm
	ml /Zi /c /coff /Cp /nologo /w /Fonti_sym.obj /Tanti_sym.asm
	cd C
	$(MAKE) -nologo -f Makefile-nti_ms $@
	cd ..\P
	$(MAKE) -nologo -f Makefile-nti_ms  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile-nti_ms $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\nti_sym.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj  $(BASEDIR)\P\*.obj

nti.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	..\GEN\nti\gen -o nti.asm RUN\nti

nti_sym.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	..\GEN\nti\gen -o nti_sym.asm RUN\nti

nti_ugc.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	..\GEN\nti\gen -debug -ugc -o nti_ugc.asm RUN\nti

ntidebug.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
	..\GEN\nti\gen -debug -o ntidebug.asm RUN\nti

gen:
	cd ..\GEN\nti
	make
	cd ..\..\nti_ms

tags:
        etags RUN\*.run GC\*.c C\*.h C\*.c C\data.gen P\*.c P\*.h

runclean:
	DEL nti.asm ntidebug.asm *~ #*# RUN\*~ RUN\*.lst RUN\*.astL &

clean:  runclean
	cd C
	$(MAKE) -f Makefile-nti_ms clean
	cd ..\GC
	$(MAKE) -f Makefile-nti_ms clean
	cd ..\P
	$(MAKE) -f Makefile-nti_ms clean
	cd ..
