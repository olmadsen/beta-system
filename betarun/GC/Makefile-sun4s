#
# Generic Makefile for betarun/GC
#

CPP  = gcc -E
MAKE = make

all: xmakefile
	$(MAKE) -f xmakefile\
        "C_FLAGS  = -I../C"\
        "C_OPT    = -O6 $(PROF)" \
	"MAIN     = c.gc.o"

valhalla: xmakefile
	$(MAKE) -f xmakefile\
        "C_FLAGS  = -I../C -DRTVALHALLA"\
        "C_OPT    = -O6 $(PROF)" \
	"MAIN     = c.gc.valhalla"

mt: xmakefile
	csh -f -c 'make -f xmakefile\
        "C_FLAGS = -I../C -DMT" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.gc.mt" |& egrep -v "(call-clobbered|included from|                 from )"'

debug_mt: xmakefile
	csh -f -c 'make -f xmakefile\
        "C_FLAGS = -I../C -DMT -DRTDEBUG" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.gc.debug_mt" |& egrep -v "(call-clobbered|included from|                 from )"'

v_mt: xmakefile
	csh -f -c 'make -f xmakefile\
        "C_FLAGS = -I../C -DMT -DRVALHALLA" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.gc.v_mt" |& egrep -v "(call-clobbered|included from|                 from )"'

debug: xmakefile
	$(MAKE) -f xmakefile\
        "C_FLAGS  = -I../C -DRTDEBUG"\
        "C_OPT    = -O6 -g $(PROF)" \
	"MAIN     = c.gc.debug"

xmakefile: ymakefile-GC
	rm -f xmakefile
	cp ymakefile-GC ymakefile.c
	$(CPP) ymakefile.c |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile
	rm ymakefile.c

clean: xmakefile
	$(MAKE) -f xmakefile clean MAIN=dummy
	-rm -f xmakefile *.o *.valhalla *.debug *.mt

ymakefile-GC:
	touch ymakefile-GC
