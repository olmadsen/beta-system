/*
 * BETA RUNTIME SYSTEM, Copyright (C) 1991 Mjolner Informatics Aps.
 * Mod: ymakefile, rel: 1, date: 03/02/92, SID: 1.9
 * by Lars Bak
 */
MAKEFILE = Makefile

MAIN     = gc.o

ORD_SRC  = block.c scavenging.c misc.c aoa.c aoatoioa.c\
           copyobject.c objectsize.c lvra.c

#ifdef sun
#  ifndef sparc
#    define sun3
#  endif
#endif

GEN_SRC  = ../C/data.gen ../C/export.h ../C/declare.h
INC_SRC  = ../C/macro.h ../C/beta.h ../C/define.h ../C/constant.h \
           ../C/heap.h ../C/object.h ../C/function.h

RST_SRC  =

ORD_OBJ  = $(ORD_SRC:.c=.o)

SOURCES  = $(Makefile) $(ORD_SRC)
OBJFILES = $(ORD_OBJ)

#ifdef hpux
CC       = cc
CPP      = /lib/cpp -P $(C_FLAGS)
#endif

#ifdef sun3
CC       = cc
CPP      = /usr/lib/cpp -P $(C_FLAGS)
#endif

#ifdef sparc
CC       = cc
CPP      = /usr/lib/cpp -P $(C_FLAGS)
#endif

#ifdef apollo
CC       = cc
CPP      = /usr/lib/cpp -P $(C_FLAGS)
#endif

#ifdef macintosh
CC       = C
CPP      = /lib/cpp -P -Dmacintosh $(CPP_FLAGS)
#endif

INCLUDES = $(INC_SRC) ../C/data.h

CC_OPT  = -I../C $(C_OPT) $(C_FLAGS) 

$(MAIN): $(OBJFILES)
#ifdef macintosh
	lib -o $@ $(OBJFILES)
#else
	ld -r -o $@ $(OBJFILES)
#endif

$(ORD_OBJ): $($@:.o=.c) $(INCLUDES)
#ifdef macintosh
	$(CC) -o $@ $(CC_OPT) $(@:.o=.c)
#else
	$(CC) -c $(CC_OPT) $(@:.o=.c)
#endif

$(SOURCES):
	sccs get $@
clean: 
	sccs clean
	-rm -f $(OBJFILES) *~

srclist:
	@echo $(SOURCES) | tr -s " " "\012"
