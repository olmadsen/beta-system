# Top level makefile for making BETA runtime.  This makefile 
# is designed to be used by the mbs_make script using the vpath
# feature.

# This makefile requires GNU make or compatible.  If your make
# program barfs on it then that may be the problem.  Set your
# GNUMAKE variable and try again.

export ARCH
export BETALIB
export BETARUN
export RUNTYPE
export PROF
export GNUC

VPATH=$(BETARUN)

all: nodebug debug nodebug_g novalhalla # ugc

clean: nodebug_clean debug_clean debug_g_clean
	rm *.a *.o

# Normal betarun, which includes hooks for BETA debugging

nodebug::
	-@mkdir nodebug
	(cd nodebug; $(MAKE) UGC=no VALHALLA=yes RTDEBUG=no CDEBUG=no -f $(BETARUN)/Makefile-vpath)

nodebug_clean::
	-@mkdir nodebug
	(cd nodebug; $(MAKE) -f $(BETARUN)/Makefile-vpath clean)

# Debugging betarun, which is very slow

debug::
	-@mkdir debug
	(cd debug; $(MAKE) UGC=no VALHALLA=yes RTDEBUG=yes CDEBUG=yes -f $(BETARUN)/Makefile-vpath)

debug_clean::
	-@mkdir debug
	(cd debug; $(MAKE) -f $(BETARUN)/Makefile-vpath clean)

# Debugging betarun, which is very slow, with uconditional GC

ugc::
	-@mkdir ugc
	(cd ugc; $(MAKE) UGC=yes VALHALLA=yes RTDEBUG=yes CDEBUG=yes -f $(BETARUN)/Makefile-vpath)

ugc_clean::
	-@mkdir ugc
	(cd ugc; $(MAKE) -f $(BETARUN)/Makefile-vpath clean)

# Nondebugging betarun, which is fast but has symbols for C debugger

nodebug_g::
	-@mkdir nodebug_g
	(cd nodebug_g; $(MAKE) UGC=no VALHALLA=yes RTDEBUG=no CDEBUG=yes -f $(BETARUN)/Makefile-vpath)

nodebug_g_clean::
	-@mkdir nodebug_g
	(cd nodebug_g; $(MAKE) -f $(BETARUN)/Makefile-vpath clean)

# Nondebugging betarun, no symbols for C debugger, no valhalla support

novalhalla::
	-@mkdir novalhalla
	(cd novalhalla; $(MAKE) UGC=no VALHALLA=no RTDEBUG=no CDEBUG=no -f $(BETARUN)/Makefile-vpath)

novalhalla::
	-@mkdir novalhalla
	(cd novalhalla; $(MAKE) -f $(BETARUN)/Makefile-vpath clean)
