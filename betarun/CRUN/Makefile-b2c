#
# OPTIONS
#  RTINFO:   Allow the runtime system to write out information during pe.
#  RTDEBUG:  Allow consistency check during pe.
#

CPP  = gcc -E
MAKE = make

all: xmakefile
# use of setenv because of silicon graphics.
	csh -f -c '\
        setenv C_FLAGS "-I../C -undef -Dcrts -DRTINFO -DRTLAZY"; \
        setenv C_OPT " -O6 $(PROF)"; \
	setenv MAIN "c.run.o"; \
	make -f xmakefile |& egrep -v "(call-clobbered|included from)"'

debug: xmakefile
	csh -f -c '\
        setenv C_FLAGS "-I../C -undef -Dcrts -DRTINFO -DRTLAZY -DRTDEBUG"; \
        setenv C_OPT " -O6 -g $(PROF)"; \
	setenv MAIN "c.run.debug"; \
	make -f xmakefile |& egrep -v "(call-clobbered|included from)"'

xmakefile: ymakefile-CRUN
	rm -f xmakefile
	cp ymakefile-CRUN ymakefile-CRUN.c
	$(CPP) -undef -Dcrts ymakefile-CRUN.c |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile
	rm ymakefile-CRUN.c

clean: xmakefile
	$(MAKE) -f xmakefile clean "MAIN = dummy"
	-rm -f xmakefile *.o *.debug

ymakefile-CRUN:
