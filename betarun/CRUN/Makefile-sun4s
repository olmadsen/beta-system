#
# Generic Makefile for betarun/CRUN.
#

CPP  = gcc -E
MAKE = make

all: xmakefile
	@make -f xmakefile\
        "C_FLAGS = -I../C" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.run.o"

valhalla: xmakefile
	@make -f xmakefile\
        "C_FLAGS = -I../C -DRTVALHALLA" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.run.valhalla"

mt: xmakefile
	@make -f xmakefile\
        "C_FLAGS = -I../C -DMT" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.run.mt"

debug_mt: xmakefile
	@make -f xmakefile\
        "C_FLAGS = -I../C -DMT -DRTDEBUG" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.run.debug_mt"

v_mt: xmakefile
	@make -f xmakefile\
        "C_FLAGS = -I../C -DMT -DRVALHALLA" \
        "C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.run.v_mt"

debug: xmakefile
	@make -f xmakefile \
	"C_FLAGS = -I../C -DRTDEBUG" \
	"C_OPT   = -O6 -g $(PROF)" \
	"MAIN    = c.run.debug"

fastdebug: xmakefile
	@make -f xmakefile \
	"C_FLAGS = -I../C -DRTDEBUG -DFASTDEBUG" \
	"C_OPT   = -O6 $(PROF)" \
	"MAIN    = c.run.fastdebug"

xmakefile: ymakefile-CRUN
	@echo "Making xmakefile"
	@rm -f xmakefile
	@cp ymakefile-CRUN ymakefile.c
	@$(CPP) ymakefile.c |\
		sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
		sed -n -e '/^..*$$/p' > xmakefile
	@rm ymakefile.c

clean: xmakefile
	@$(MAKE) -f xmakefile clean MAIN=dummy
	@-rm -f xmakefile *.o *.valhalla *.debug *.mt

ymakefile-CRUN:
	touch ymakefile-CRUN

fp-check: xmakefile
	-@make -f xmakefile CheckGCable
save-check: xmakefile
	-@make -f xmakefile CheckSave
