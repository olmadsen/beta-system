betarun.o: C/c.common.o CRUN/c.run.o GC/c.gc.o
	ld -x -r -o betarun.o C/c.common.o CRUN/c.run.o GC/c.gc.o

betarun.pe: C/c.common.o GC/c.gc.o CRUN/c.run.o
	ld -x -r -o betarun.pe C/c.common.o GC/c.gc.o CRUN/c.run.o

C/c.common.o: ALWAYS
	cd C;  make

CRUN/c.run.o: ALWAYS
	cd CRUN; make

GC/c.gc.o: ALWAYS
	cd GC; make

betarun.demo: C/c.common.o CRUN/c.run.o GC/c.gc.o
	ld -x -r -o betarun.demo C/c.common.o CRUN/c.run.o GC/c.gc.o

demo:
	rm -f C/c.common.o C/initialize.o
	DEMO="-DDEMO"; export DEMO; make betarun.demo
	rm -f C/c.common.o C/initialize.o

pe:
	rm -f C/c.common.o C/initialize.o
	DEMO="-DPE"; export DEMO; make betarun.pe
	rm -f C/c.common.o C/initialize.o

debug: betarun.debug

betarun.debug: C/c.common.debug CRUN/c.run.debug GC/c.gc.debug
	ld -r -o betarun.debug C/c.common.debug CRUN/c.run.debug GC/c.gc.debug

C/c.common.debug: ALWAYS
	cd C; make debug

CRUN/c.run.debug: ALWAYS
	cd CRUN; make debug

GC/c.gc.debug: ALWAYS
	cd GC; make debug

########## All ###########

all:
	cvs update
	make clean
	make 
	make clean
	make debug

tags:
	etags GC/*.[hc] CRUN/*.[hc] C/*.[hc] C/data.gen CRUN/*.S

clean: ALWAYS
	cd C; make clean
	cd CRUN; make clean
	cd GC; make clean
	sh -c 'if [ -d TST ]; then cd TST; make clean; fi'

commit:
	cvscom

com:
	cvscom

ALWAYS:
