#
# OPTIONS
#  RTINFO:   Allow the runtime system to write out information during pe.
#  RTDEBUG:  Allow consistency check during pe.
#

CPP  =  /lib/cpp -P -Dmacintosh
MAKE = /bin/make

betarun: xmakefile betarun.make
	@-$(MAKE) -f xmakefile -n \
        "C_FLAGS= -D RTINFO -D RTDEBUG" \
        "CPP_FLAGS= -DRTINFO -DRTDEBUG" \
	"MAIN = betarun.o" \
        "C_OPT  = -m -mc68020" | egrep -v '^	C |^	lib' | sh

betarun.make:
	@/bin/echo 'Making betarun.make ... \c'
	@/bin/echo 'COBJECTS= \0266' >../betarun.make
	@make srclst >>../betarun.make
	@(cd ../GC; make srclst) >>../betarun.make
	@/bin/echo '	:C:data.c.o' >>../betarun.make
	@/bin/echo '' >>../betarun.make
	@/bin/echo 'AOBJECTS = mac.a.o' >>../betarun.make
	@/bin/echo '' >> ../betarun.make
	@/bin/echo 'betarun \0304\0304 :C:c.betarun.o {AOBJECTS}' >>../betarun.make
	@/bin/echo '	lib -o betarun.o :C:c.betarun.o mac.a.o' >>../betarun.make
	@/bin/echo '' >>../betarun.make
	@/bin/echo ':C:c.betarun.o \0304\0304 {COBJECTS}' >>../betarun.make
	@/bin/echo '	lib -o :C:c.betarun.o {COBJECTS}' >>../betarun.make
	@/bin/echo '' >>../betarun.make
	@/bin/echo '.c.o \0304 .c' >>../betarun.make
	@/bin/echo '	C -r -mc68020 -m -D RTINFO -i :C: {Default}.c -o {Default}.c.o' >>../betarun.make
	@/bin/echo '' >>../betarun.make
	@/bin/echo '.a.o \0304 .a' >>../betarun.make
	@/bin/echo '	Asm -wb {Default}.a -o {Default}.a.o' >>../betarun.make
	@/bin/echo done.

debug.make:
	@/bin/echo 'Making debug.make ... \c'
	@/bin/echo 'COBJECTS= \0266' >../debug.make
	@make srclst >>../debug.make
	@(cd ../GC; make srclst) >>../debug.make
	@/bin/echo '	:C:data.c.o' >>../debug.make
	@/bin/echo '' >>../debug.make
	@/bin/echo 'AOBJECTS = mac.a.o' >>../debug.make
	@/bin/echo '' >> ../debug.make
	@/bin/echo 'debug \0304\0304 :C:c.debug.o {AOBJECTS}' >>../debug.make
	@/bin/echo '	lib -sym on -o betarun.debug :C:c.debug.o mac.a.o' >>../debug.make
	@/bin/echo '' >>../debug.make
	@/bin/echo ':C:c.debug.o \0304\0304 {COBJECTS}' >>../debug.make
	@/bin/echo '	lib -sym on -o :C:c.debug.o {COBJECTS}' >>../debug.make
	@/bin/echo '' >>../debug.make
	@/bin/echo '.c.o \0304 .c' >>../debug.make
	@/bin/echo '	C -sym on -mc68020 -m -D RTINFO -D RTDEBUG -i :C: {Default}.c -o {Default}.c.o' >>../debug.make
	@/bin/echo '' >>../debug.make
	@/bin/echo '.a.o \0304 .a' >>../debug.make
	@/bin/echo '	Asm -sym on -wb {Default}.a -o {Default}.a.o' >>../debug.make
	@/bin/echo done.

demo.make:
	@/bin/echo 'Making demo.make ... \c'
	@/bin/echo 'COBJECTS= \0266' >../demo.make
	@make srclst >>../demo.make
	@(cd ../GC; make srclst) >>../demo.make
	@/bin/echo '	:C:data.c.o' >>../demo.make
	@/bin/echo '' >>../demo.make
	@/bin/echo 'AOBJECTS = mac.a.o' >>../demo.make
	@/bin/echo '' >> ../demo.make
	@/bin/echo 'demo \0304\0304 :C:c.demo.o {AOBJECTS}' >>../demo.make
	@/bin/echo '	lib -o betarun.demo :C:c.demo.o mac.a.o' >>../demo.make
	@/bin/echo '' >>../demo.make
	@/bin/echo ':C:c.demo.o \0304\0304 {COBJECTS}' >>../demo.make
	@/bin/echo '	lib -o :C:c.demo.o {COBJECTS}' >>../demo.make
	@/bin/echo '' >>../demo.make
	@/bin/echo '.c.o \0304 .c' >>../demo.make
	@/bin/echo '	C -r -mc68020 -m -D RTINFO -D DEMO -i :C: {Default}.c -o {Default}.c.o' >>../demo.make
	@/bin/echo '' >>../demo.make
	@/bin/echo '.a.o \0304 .a' >>../demo.make
	@/bin/echo '	Asm -wb {Default}.a -o {Default}.a.o' >>../demo.make
	@/bin/echo done.

srcs: xmakefile
	$(MAKE) -f xmakefile \
	"C_FLAGS= -D RTINFO" \
	"CPP_FLAGS= -DRTINFO" \
	"C_OPT  = -m -mc68020 " \
	"MAIN = betarun.o" \
	srclist;

srclst:
	@make srcs | perl -ne 'if ( /(\w+)\.c/){ print "\t\:C\:$$1.c.o \266\n";}' 

xmakefile: ymakefile-C
	rm -f xmakefile
	$(CPP) ymakefile-C |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile

clean:
	-rm -f xmakefile data.c data.h *.o
	-rm -f \#* *~
