#
# OPTIONS
#  RTINFO:   Allow the runtime system to write out information during pe.
#  RTDEBUG:  Allow consistency check during pe.
#

CPP  = /usr/ccs/lib/cpp -P -Dmacintosh
MAKE = /usr/ccs/bin/make
ECHO = /usr/5bin/echo

betarun: xmakefile betarun.make scramble.make
	@-$(MAKE) -f xmakefile -n \
        "C_FLAGS= -D RTINFO -D RTLAZY -D RTDEBUG" \
        "CPP_FLAGS= -DRTINFO -DRTLAZY -DRTDEBUG" \
	"MAIN = betarun.o" \
        "C_OPT  = -m -mc68020" | egrep -v '^C |^lib' | sh

scramble.make:
	@$(ECHO) 'Making scramble.make ...'
	@$(ECHO) 'OBJECTS = :C:scramble.c.o' >../scramble.make
	@$(ECHO) '' >>../scramble.make
	@$(ECHO) 'scramble \0304\0304 scramble.make  {OBJECTS}' >>../scramble.make
	@$(ECHO) '        Link -d -c 'MPS ' -t MPST \0266' >>../scramble.make
	@$(ECHO) '                {OBJECTS} \0266' >>../scramble.make
	@$(ECHO) '                "{CLibraries}"StdClib.o \0266' >>../scramble.make
	@$(ECHO) '                "{Libraries}"Stubs.o \0266' >>../scramble.make
	@$(ECHO) '                "{Libraries}"Runtime.o \0266' >>../scramble.make
	@$(ECHO) '                "{Libraries}"Interface.o \0266' >>../scramble.make
	@$(ECHO) '               -o scramble' >>../scramble.make
	@$(ECHO) '' >>../scramble.make
	@$(ECHO) ':C:scramble.c.o <9F> scramble.make :C:scramble.c' >>../scramble.make
	@$(ECHO) '         C -r  :C:scramble.c' >>../scramble.make
	@$(ECHO) 'done'

betarun.make:
	@$(ECHO) 'Making betarun.make ... '
	@$(ECHO) 'COBJECTS= \0266' >../betarun.make
	@make srclst >>../betarun.make
	@(cd ../GC; make srclst) >>../betarun.make
	@$(ECHO) '	:C:data.c.o' >>../betarun.make
	@$(ECHO) '' >>../betarun.make
	@$(ECHO) 'AOBJECTS = mac.a.o' >>../betarun.make
	@$(ECHO) '' >> ../betarun.make
	@$(ECHO) 'betarun \0304\0304 :C:c.betarun.o {AOBJECTS}' >>../betarun.make
	@$(ECHO) '	lib -o betarun.o :C:c.betarun.o mac.a.o {BetaLinkFloatLibs} {BetaLinkLibs}' >>../betarun.make
	@$(ECHO) '' >>../betarun.make
	@$(ECHO) ':C:c.betarun.o \0304\0304 {COBJECTS}' >>../betarun.make
	@$(ECHO) '	lib -o :C:c.betarun.o {COBJECTS}' >>../betarun.make
	@$(ECHO) '' >>../betarun.make
	@$(ECHO) '.c.o \0304 .c' >>../betarun.make
	@$(ECHO) '	C -model far -r -mc68020 -m -D RTINFO -D RTLAZY -i :C: {Default}.c -o {Default}.c.o' >>../betarun.make
	@$(ECHO) '' >>../betarun.make
	@$(ECHO) '.a.o \0304 .a' >>../betarun.make
	@$(ECHO) '	Asm -wb -model far {Default}.a -o {Default}.a.o' >>../betarun.make
	@$(ECHO) done.

debug.make:
	@$(ECHO) 'Making debug.make ... \c'
	@$(ECHO) 'COBJECTS= \0266' >../debug.make
	@make srclst >>../debug.make
	@(cd ../GC; make srclst) >>../debug.make
	@$(ECHO) '	:C:data.c.o' >>../debug.make
	@$(ECHO) '' >>../debug.make
	@$(ECHO) 'AOBJECTS = mac-debug.a.o' >>../debug.make
	@$(ECHO) '' >> ../debug.make
	@$(ECHO) 'debug \0304\0304 :C:c.debug.o {AOBJECTS}' >>../debug.make
	@$(ECHO) '	lib -sym on -o betarun.debug :C:c.debug.o mac-debug.a.o {BetaLinkFloatLibs} {BetaLinkLibs}' >>../debug.make
	@$(ECHO) '' >>../debug.make
	@$(ECHO) ':C:c.debug.o \0304\0304 {COBJECTS}' >>../debug.make
	@$(ECHO) '	lib -sym on -o :C:c.debug.o {COBJECTS}' >>../debug.make
	@$(ECHO) '' >>../debug.make
	@$(ECHO) '.c.o \0304 .c' >>../debug.make
	@$(ECHO) '	C -model far -sym on -mc68020 -m -D RTINFO -D RTLAZY -D RTDEBUG -i :C: {Default}.c -o {Default}.c.o' >>../debug.make
	@$(ECHO) '' >>../debug.make
	@$(ECHO) '.a.o \0304 .a' >>../debug.make
	@$(ECHO) '	Asm -model far -sym on -wb {Default}.a -o {Default}.a.o' >>../debug.make
	@$(ECHO) done.

demo.make:
	@$(ECHO) 'Making demo.make ... \c'
	@$(ECHO) 'COBJECTS= \0266' >../demo.make
	@make srclst >>../demo.make
	@(cd ../GC; make srclst) >>../demo.make
	@$(ECHO) '	:C:data.c.o' >>../demo.make
	@$(ECHO) '' >>../demo.make
	@$(ECHO) 'AOBJECTS = mac.a.o' >>../demo.make
	@$(ECHO) '' >> ../demo.make
	@$(ECHO) 'demo \0304\0304 :C:c.demo.o {AOBJECTS}' >>../demo.make
	@$(ECHO) '	lib -o betarun.demo :C:c.demo.o mac.a.o {BetaLinkFloatLibs} {BetaLinkLibs}' >>../demo.make
	@$(ECHO) '' >>../demo.make
	@$(ECHO) ':C:c.demo.o \0304\0304 {COBJECTS}' >>../demo.make
	@$(ECHO) '	lib -o :C:c.demo.o {COBJECTS}' >>../demo.make
	@$(ECHO) '' >>../demo.make
	@$(ECHO) '.c.o \0304 .c' >>../demo.make
	@$(ECHO) '	C -model far -r -mc68020 -m -D RTINFO -D RTLAZY -D DEMO -i :C: {Default}.c -o {Default}.c.o' >>../demo.make
	@$(ECHO) '' >>../demo.make
	@$(ECHO) '.a.o \0304 .a' >>../demo.make
	@$(ECHO) '	Asm -model far -wb {Default}.a -o {Default}.a.o' >>../demo.make
	@$(ECHO) done.

srcs: xmakefile
	$(MAKE) -f xmakefile \
	"C_FLAGS= -D RTINFO -D RTLAZY" \
	"CPP_FLAGS= -DRTINFO -DRTLAZY" \
	"C_OPT  = -m -mc68020 " \
	"MAIN = betarun.o" \
	srclist;

srclst:
	@make srcs | perl -ne 'if ( /(\w+)\.c/){ print "\t\:C\:$$1.c.o \266\n";}' 

xmakefile: ymakefile-C
	rm -f xmakefile
	$(CPP) ymakefile-C |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile

clean:
	-rm -f xmakefile data.c data.h *.o
	-rm -f \#* *~
