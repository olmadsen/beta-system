#
# Generic Makefile for betarun/C
#

CPP  = gcc -E
MAKE = make

all: xmakefile
	$(MAKE) -f xmakefile\
        "C_OPTA = -O6 $(PROF) $(PE)" \
        "C_OPTB = -O6 $(PROF) $(PE)" \
	"MAIN  = c.common.o"

valhalla: xmakefile
	$(MAKE) -f xmakefile\
        "C_FLAGS   = -DRTVALHALLA"\
        "C_OPTA    = -O6 $(PROF) $(PE)" \
        "C_OPTB    = -O6 $(PROF) $(PE)" \
	"MAIN     = c.common.valhalla"

debug: xmakefile
	$(MAKE) -f xmakefile \
        "C_FLAGS  = -DRTDEBUG"\
        "C_OPTA    = -O6 -g $(PROF)" \
        "C_OPTB    = -O6 -g $(PROF)" \
	"MAIN     = c.common.debug"

xmakefile: ymakefile-C
	rm -f xmakefile
	cp ymakefile-C ymakefile.c
	$(CPP) ymakefile.c |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile
	rm ymakefile.c

clean: xmakefile
	$(MAKE) -f xmakefile clean MAIN=dummy
	-rm -f xmakefile *.o *.debug *.valhalla data.h data.c tmpdata.c scramble

ymakefile-C:
	touch ymakefile-C

