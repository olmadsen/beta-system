#
# Generic Makefile for betarun/P
#

CPP  = cc -E
MAKE = make

all: xmakefile
	@$(MAKE) -f xmakefile\
        "C_FLAGS  = -I../C -I../P"\
        "C_OPTA    = -O2 -fullwarn -w2 $(ABI) $(PROF)" \
        "C_OPTB    = -O2 -fullwarn -w2 $(ABI) $(PROF)" \
	"MAIN     = c.p.o"

valhalla: xmakefile
	@$(MAKE) -f xmakefile\
        "C_FLAGS  = -I../C -I../P -DRTVALHALLA"\
        "C_OPTA    = -O2 -fullwarn -w2 $(ABI) $(PROF)" \
        "C_OPTB    = -O2 -fullwarn -w2 $(ABI) $(PROF)" \
	"MAIN     = c.p.valhalla"

debug: xmakefile
	@$(MAKE) -f xmakefile\
        "C_FLAGS  = -I../C -I../P -DRTDEBUG"\
        "C_OPTA    = -g3 -O2 -fullwarn -w2 $(ABI) $(PROF)" \
        "C_OPTB    = -g3 -O0 -fullwarn -w2 $(ABI) $(PROF)" \
	"MAIN     = c.p.debug"

xmakefile: ymakefile-P
	@rm -f xmakefile
	@cp ymakefile-P ymakefile.c
	@$(CPP) ymakefile.c |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile
	@rm ymakefile.c

clean: xmakefile
	@$(MAKE) -f xmakefile clean MAIN=dummy
	-@rm -f xmakefile *.o *.valhalla *.debug

ymakefile-P:
	touch ymakefile-P
