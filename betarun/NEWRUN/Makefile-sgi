
CPP  = cc -E
MAKE = make

all: xmakefile
	make -f xmakefile\
        "C_FLAGS = -I../C" \
        "C_OPT   = -O2 -fullwarn $(PROF)" \
	"MAIN    = c.run.o" 

valhalla: xmakefile
	make -f xmakefile\
        "C_FLAGS = -I../C -DRTVALHALLA" \
        "C_OPT   = -O2 -fullwarn $(PROF)" \
	"MAIN    = c.run.valhalla" 

debug: xmakefile
	make -f xmakefile \
	"C_FLAGS = -I../C -DRTDEBUG" \
	"C_OPT   = -g3 -O2 -fullwarn $(PROF)" \
	"MAIN    = c.run.debug"

xmakefile: ymakefile-NEWRUN
	rm -f xmakefile
	cp ymakefile-NEWRUN ymakefile.c
	$(CPP) ymakefile.c |\
	sed -e 's/^#.*//' -e 's/^[ \f\t][ \f\t]*$$//' -e 's/^ //' |\
	sed -n -e '/^..*$$/p' > xmakefile
	rm ymakefile.c

clean: xmakefile
	$(MAKE) -f xmakefile clean MAIN=dummy
	-rm -f xmakefile *.o *.valhalla *.debug

ymakefile-NEWRUN:
	touch ymakefile-NEWRUN
