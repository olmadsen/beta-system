RUNDEPS= \
RUN/AllocateComponent.run \
RUN/AllocateItem.run \
RUN/AllocateDopartObject.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/DataRegs.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run


tar: apollo.asm builds
	rm -f C/data.h C/data.c
	tar -cvf betarun.tar apollo.asm build build.debug C

demo:
	make tar

apollo.asm: RUN/apollo.run RUN/apolloadditions.run $(RUNDEPS)
	make asm

asm: 
	- ../GEN/apollo/gen -o apollo.asm RUN/apollo

builds: 
	@echo MAKING BUILD SCRIPTS ---------
	echo echo assembling apollo.asm > build
	echo asm apollo.asm >> build
	echo echo compiling C sources >> build
	echo echo assembling apollo.asm > build.demo
	echo asm apollo.asm >> build.demo
	echo echo compiling C sources >> build.demo
	echo echo assembling apollo.asm > build.debug
	echo asm apollo.asm >> build.debug
	echo echo compiling C sources >> build.debug
	cd C; make clean; make
	DEMO="-DDEMO"; export DEMO; cd C; make clean; make
	cd GC; make clean; make
	echo echo linking betarun.o >> build
	echo ld -r -o betarun.o C/c.common.o GC/c.gc.o apollo.bin >> build
	echo echo linking betarun.demo >> build.demo
	echo ld -r -o betarun.demo C/c.common.o GC/c.gc.o apollo.bin >> build.demo
	echo echo linking betarun.debug >> build.debug
	echo ld -r -o betarun.debug C/c.common.o GC/c.gc.o apollo.bin >> build.debug

gen:
	cd ../GEN/apollo; make

tags:
	etags *.run RUN/*.run GC/*.[hc] CRUN/*.[hc] C/*.[hc] C/data.gen

clean: ALWAYS
	cd C; make clean
	cd GC; make clean
	- rm -f *.group apollo.asm apollo.tar build build.demo build.demo
	- rm -f *~ \#*
	- rm -f RUN/*.group RUN/*~

commit:
	cvscom

com:
	cvscom



ALWAYS:

