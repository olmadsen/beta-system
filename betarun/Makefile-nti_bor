BASEDIR=.

RUNDEPS= \
..\GEN\nti_gen.exe \
RUN/AllocateComponent.run \
RUN/AllocateDopartObject.run \
RUN/AllocateItem.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/Constant.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/DataRegs.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/RunAlloc.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run

bor:	clean
	$(MAKE) -f Makefile-nti_bor clean 
	$(MAKE) -f Makefile-nti_bor betarun.lib 
	$(MAKE) -f Makefile-nti_bor clean 
	$(MAKE) -f Makefile-nti_bor betarun_v.lib 
	$(MAKE) -f Makefile-nti_bor clean 
	$(MAKE) -f Makefile-nti_bor betarun_pe.lib
	$(MAKE) -f Makefile-nti_bor clean 
	$(MAKE) -f Makefile-nti_bor betarun_debug.lib

betarun_pe.lib: nti.asm
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) -f Makefile-nti_bor  betarun_pe.lib
	cd ..\GC
	$(MAKE) -f Makefile-nti_bor  betarun_pe.lib
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

betarun_v.lib: nti.asm
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) -f Makefile-nti_bor  $@
	cd ..\GC
	$(MAKE) -f Makefile-nti_bor  $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

betarun.lib: nti.asm
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) -f Makefile-nti_bor  $@
	cd ..\GC
	$(MAKE) -f Makefile-nti_bor  $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

betarun_debug.lib: ntidebug.asm
	tasm32 -zi -ml -m -t -w-res ntidebug.asm
	cd C
	$(MAKE) -f Makefile-nti_bor  $@
	cd ..\GC
	$(MAKE) -f Makefile-nti_bor  $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\ntidebug.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

nti.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
       ..\GEN\nti_bor\gen -o nti.asm RUN\nti

ntidebug.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
       ..\GEN\nti_bor\gen -debug -o ntidebug.asm RUN\nti

gen:
	cd ..\GEN\nti_bor 
	make
	cd ..\..\nti_bor

tags:
        etags RUN\*.run GC\*.[hc] C\*.[hc] C\data.gen

runclean:
	del nti.asm ntidebug.asm *~ #*# RUN\*~ RUN\*.lst RUN\*.astL >& NUL:

clean:  runclean
	cd C
	$(MAKE) -f Makefile-nti_bor clean
	cd ..\GC
	$(MAKE) -f Makefile-nti_bor clean
	cd ..
