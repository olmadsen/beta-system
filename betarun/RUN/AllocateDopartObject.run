------- AllocateDopartObject: System ----
AlloDO: public
  (#
     { Allocate a DopartObject. }
     
     { Input variable. }
     Size:      Long          = DataReg1;     { The Size of the body part in BYTES. (d7) }
     ArgOrigin: Object        = RegObj;       { Origin for new object (a0) }
     
     { Output variable. }
     theObj:    DopartObject  = RegObj;       { New object (a0) }
     
     { Used variable.  }
     newTop:    DataArea      = AddrReg1;
     Origin:    DataArea      = DataRegA;
     tmp:       DataArea      = DataRegB;
  do
     ArgOrigin -> Origin;
     
     again: { restart here after GC }
     
     IOATop -> theObj; { destroys ArgOrigin }
     theObj[16+Size][] -> newTop;
     (if newTop > IOALimit then goto GC if);
     newTop -> IOATop;
     
     { The new Object is now allocated, but not initialized yet!}
     
     { Initialize the structual part of the DopartObject. }
     
     -9     -> theObj.ProtoType;
     1      -> theObj.Age;
     Origin -> theObj.Origin;
     Size   -> theObj.Size;
     
     { The DopartObject is not zeroed. }
    
     return;
     
     GC:
     { The IOA heap is full, so we need a garbage collection. }
     Size -> tmp; { Set the requested Object Size.         }
     4 -> tmp/;
     4 -> tmp+;
     tmp -> ReqObjectSize;
     call DoGC;               { Call the Garbage Collector.               }
     goto again;              { Go back to the beginning of this routine. }
  #)

