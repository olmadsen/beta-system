BASEDIR=.

RUNDEPS= \
..\GEN\nti\gen.exe \
RUN/AllocateComponent.run \
RUN/AllocateDopartObject.run \
RUN/AllocateItem.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/Constant.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/DataRegs.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run

bor:	clean
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti bor\betarun.lib 
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti bor\betarun_v.lib 
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti bor\betarun_pe.lib 
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti bor\betarun_debug.lib

ms:	clean
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti ms\betarun.lib 
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti ms\betarun_v.lib 
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti ms\betarun_pe.lib 
	$(MAKE) -f Makefile_nti clean 
	$(MAKE) -f Makefile_nti ms\betarun_debug.lib

borpe:  clean bor\betarun_pe.lib

mspe:	clean ms\betarun_pe.lib

bor\betarun_pe.lib: nti.asm
	-md bor
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) -f Makefile_nti  bor\betarun.pe
	cd ..\GC
	$(MAKE) -f Makefile_nti  bor\betarun.pe
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

bor\betarun_v.lib: nti.asm
	-md bor
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) -f Makefile_nti  $@
	cd ..\GC
	$(MAKE) -f Makefile_nti  $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

bor\betarun.lib: nti.asm
	-md bor
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) -f Makefile_nti  $@
	cd ..\GC
	$(MAKE) -f Makefile_nti  $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

bor\betarun_debug.lib: ntidebug.asm
	tasm32 -zi -ml -m -t -w-res ntidebug.asm
	cd C
	$(MAKE) -f Makefile_nti  $@
	cd ..\GC
	$(MAKE) -f Makefile_nti  $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\ntidebug.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\floats.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sockets.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\C\dot.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 


ms\betarun_pe.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) -nologo -f Makefile_nti  ms\betarun.pe
	cd ..\GC
	$(MAKE) -nologo -f Makefile_nti  ms\betarun.pe
	cd ..
	-md ms
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

ms\betarun.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) -nologo -f Makefile_nti  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile_nti  $@
	cd ..
	-md ms
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

ms\betarun_v.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) -nologo -f Makefile_nti  $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile_nti  $@
	cd ..
	-md ms
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

ms\betarun_debug.lib: ntidebug.asm
	ml /Zi /c /coff /Cp /nologo /w /Fontidebug.obj /Tantidebug.asm
	cd C
	$(MAKE) -nologo -f Makefile_nti $@
	cd ..\GC
	$(MAKE) -nologo -f Makefile_nti $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\ntidebug.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

nti.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
       - ..\GEN\nti\gen -o nti.asm RUN\nti

ntidebug.asm: RUN\nti.run RUN\ntiadditions.run $(RUNDEPS)
       - ..\GEN\nti\gen -debug -o ntidebug.asm RUN\nti

gen:
	cd ..\GEN\nti 
	make
	cd ..\..\nti

tags:
        etags RUN\*.run GC\*.[hc] C\*.[hc] C\data.gen

runclean:
	-del /Q nti.asm nti-debug.asm *~ #*# RUN\*~ RUN\*.lst RUN\*.astL

clean:  runclean
	cd C
	$(MAKE) -f Makefile_nti clean
	cd ..\GC
	$(MAKE) -f Makefile_nti clean
	cd ..
