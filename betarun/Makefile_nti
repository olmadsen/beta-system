BASEDIR=.

RUNDEPS= \
../GEN/nti/gen \
RUN/AllocateComponent.run \
RUN/AllocateDopartObject.run \
RUN/AllocateItem.run \
RUN/AllocateRefRep.run \
RUN/AllocateStackObject.run \
RUN/AllocateValRep.run \
RUN/Attach.run \
RUN/AttachBasicComponent.run \
RUN/Basics.run \
RUN/CInterface.run \
RUN/CheckReferenceAssignment.run \
RUN/ComponentStack.run \
RUN/Constant.run \
RUN/CopyCText.run \
RUN/CopyRefRep.run \
RUN/CopySliceRefRep.run \
RUN/CopySliceValRep.run \
RUN/CopyText.run \
RUN/CopyValRep.run \
RUN/DataRegs.run \
RUN/Declaration.run \
RUN/ExitObjects.run \
RUN/ExtendRefRep.run \
RUN/ExtendValRep.run \
RUN/MakeTextObj.run \
RUN/Misc.run \
RUN/NewRefRep.run \
RUN/NewValRep.run \
RUN/PerformGC.run \
RUN/Structure.run \
RUN/Qua.run \
RUN/Suspend.run

all:    bor borpe ms mspe

bor:	bor\betarun.lib bor\betarun_v.lib bor\betarun_debug.lib

ms:	ms\betarun.lib ms\betarun_v.lib ms\betarun_debug.lib

borpe:  bor\betarun_pe.lib

mspe:	ms\betarun_pe.lib

bor\betarun_pe.lib:
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) clean $@
	cd ..\GC
	$(MAKE) clean $@
	cd ..
	-mkdir bor
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

bor\betarun_v.lib: bor\betarun.lib
        copy bor\betarun.lib bor\betarun_v.lib

bor\betarun.lib:
	tasm32 -m5 -ml -m -t -w-res nti.asm
	cd C
	$(MAKE) clean $@
	cd ..\GC
	$(MAKE) clean $@
	cd ..
	-mkdir bor
	tlib /E /C $@ -+$(BASEDIR)\nti.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 

bor\betarun_debug.lib:
	tasm32 -zi -ml -m -t -w-res ntidebug.asm
	cd C
	$(MAKE) clean $@
	cd ..\GC
	$(MAKE) clean $@
	cd ..
	tlib /E /C $@ -+$(BASEDIR)\ntidebug.obj
	tlib /E /C $@ -+$(BASEDIR)\C\end.obj
	tlib /E /C $@ -+$(BASEDIR)\C\initialize.obj
	tlib /E /C $@ -+$(BASEDIR)\C\betaenv.obj
	tlib /E /C $@ -+$(BASEDIR)\C\outpattern.obj
	tlib /E /C $@ -+$(BASEDIR)\C\argument.obj
	tlib /E /C $@ -+$(BASEDIR)\C\property.obj
	tlib /E /C $@ -+$(BASEDIR)\C\exit.obj
	tlib /E /C $@ -+$(BASEDIR)\C\cbfa.obj
	tlib /E /C $@ -+$(BASEDIR)\C\wordsort.obj
	tlib /E /C $@ -+$(BASEDIR)\C\sighandler.obj
	tlib /E /C $@ -+$(BASEDIR)\C\data.obj
	tlib /E /C $@ -+$(BASEDIR)\C\lazyref_gc.obj
	tlib /E /C $@ -+$(BASEDIR)\C\scanobjects.obj
	tlib /E /C $@ -+$(BASEDIR)\C\heapview.obj
	tlib /E /C $@ -+$(BASEDIR)\C\group.obj 
	tlib /E /C $@ -+$(BASEDIR)\GC\block.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\ioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\stack.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\misc.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\aoatoioa.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\copyobject.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\objectsize.obj
	tlib /E /C $@ -+$(BASEDIR)\GC\lvra.obj 


ms\betarun_pe.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) clean $@
	cd ..\GC
	$(MAKE) clean $@
	cd ..
	-mkdir ms
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

ms\betarun.lib: nti.asm
	ml /c /coff /Cp /nologo /w /Fonti.obj /Tanti.asm
	cd C
	$(MAKE) clean $@
	cd ..\GC
	$(MAKE) clean $@
	cd ..
	-mkdir ms
	lib -verbose -out:$@ $(BASEDIR)\nti.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

ms\betarun_v.lib: ms\betarun.lib
        copy ms\betarun.lib ms\betarun_v.lib

ms\betarun_debug.lib: ntidebug.asm
	ml /Zi /c /coff /Cp /nologo /w /Fontidebug.obj /Tantidebug.asm
	cd C
	$(MAKE) clean $@
	cd ..\GC
	$(MAKE) clean $@
	cd ..
	lib -verbose -out:$@ $(BASEDIR)\ntidebug.obj $(BASEDIR)\C\*.obj $(BASEDIR)\GC\*.obj

nti.asm: RUN/nti.run RUN/ntiadditions.run $(RUNDEPS)
       - ..\GEN\nti\gen -o nti.asm RUN\nti

ntidebug.asm: RUN\nti.run RUN\ntiadditions.run $(RUNDEPS)
       - ..\GEN\nti\gen -debug -o ntidebug.asm RUN\nti

#gen:
#       cd ..\GEN\nti && make

#tags:
#       etags RUN\*.run GC\*.[hc] C\*.[hc] C\data.gen

#clean: ALWAYS
#       @echo Do \'cvs update\' on a SUN
#       cd C; make clean
#       cd GC; make clean
#       - rm -f *.group *.lst core *~ \#*
#       - rm -f RUN\*.group RUN\*~ RUN\*.lst RUN\core

#tar: ntidebug.asm nti.asm
#	tar cvhf nti.tar ntidebug.asm nti.asm Makefile \
#		 C\*.h C\data.gen C\*.c C\Makefile C\ymakefile-C C\xmakefile\
#		 GC\*.h GC\*.c GC\Makefile GC\ymakefile-GC GC\xmakefile

ALWAYS:

