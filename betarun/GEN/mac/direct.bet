ORIGIN '../GENERATOR/asmfile'
[[
---- Machine:descriptor ----
  (# do 'mac' -> name[] #)

---- ToCName:descriptor ----
  (# do  #)

---- Prolog:descriptor ----
(# do 
   'Prolog mac' -> CommentLine;
   '\tSEG ''BETARUN'' \n'                     -> putText;
   '\tMACHINE MC68020 \n'                     -> putText;
   '\tCASE ON \n'                             -> putText;
   '\tPROC\t\t\t\t; MacsBug\n'                -> putText;
   '\tCODE\t\t\t\t; MacsBug\n'                -> puttext;
   '\tbetarun:\t\t\t; MacsBug dummy symbol\n' -> puttext;
   '\tRTS\t\t\t\t; MacsBug\n'                 -> puttext;
   '\tDC.B\t$80, ''betarun'', 0\t; MacsBug\n' -> puttext;
   '\tDC.W\t$0000\t\t\t; MacsBug\n'           -> puttext;
#)

---- EndRoutine:descriptor ----
(# (* insert macsbug symbol *)
do '\tRTS\t\t\t; MacsBug dummy rts\n' -> puttext;
   '\tDC.B $80, ''' -> puttext; 
   name[] -> puttext; 
   '''\t; MacsBug\n' -> puttext;
   (if (name.length mod 2) // 1 then
       '\tDC.B $00\t\t; MacsBug\n' -> puttext;
   if);
   '\tDC.W $0000\t\t; MacsBug\n' -> puttext;
   newline;
#)

---- BeginCode:descriptor ----
  (# do
    '	CODE'              -> putText; newLine;
    '	DATAREFS ABSOLUTE' -> putText; newLine
  #)

---- EndCode:descriptor ----
  (# do #)

---- BeginData:descriptor ----
  (# do 
    '	DATA'              -> putText; newLine;
    '	DATAREFS ABSOLUTE' -> putText; newLine
  #)

---- EndData:descriptor ----
  (# do     '	CODE'              -> putText; newLine #)

---- Epilog: descriptor ----
  (# do
    '	ENDPROC' -> putText; newLine;
    '   END'     -> putText; newLine;
    'Epilog for mac' -> CommentLine
  #)

---- DefinePublic:descriptor ----
  (# do 
     'Public routine' -> CommentLine;
     labOp[] -> ExportLabel; labOp[] -> DefineLabel;
  #)

---- DefineLocalLabel:descriptor ----
  (# do op.out; ':' -> put; newLine #)

---- NewLocalLabel:descriptor ----
  (# name:@text
  do
     'L' -> name.put; LabelNo + 1 -> LabelNo -> name.putInt;
     (4, name[], 0) -> NewLabel -> op[]; newLine
  #)

---- ExportLabel:descriptor ----
  (# do '	EXPORT	' -> putText; labOp.name[] -> putText; newLine #)

---- ImportLabel:descriptor ----
  (# do '	IMPORT  ' -> putText; labOp.name[] -> putText; newLine #)

---- DefineLabel:descriptor ----
  (# do labOp.name[] -> putText; ':' -> put; newLine #)

---- CommentLine:descriptor ----
  (# do '	; ' -> putText; comment[] -> putText; newLine #)

----]]
