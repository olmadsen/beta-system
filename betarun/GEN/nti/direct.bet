ORIGIN '../GENERATOR/asmfile'
[[

---- Machine:descriptor ----
(# do 'nti' -> name[] #)

---- ToCName:descriptor ----
(# do '_'-> name.prepend #)

---- Prolog:descriptor ----
(# i : @integer;
do
   '\tTITLE\tBetaRuntimeSystem\n'->putText;
   '.386P\n'->putText;
   'ifdef ??version\n'->putText;
   'model\tflat\n'->putText;
   '_TEXT\tsegment dword public use32 ''CODE''\n'->putText;
   '_TEXT\tends\n'->putText;
   '_DATA\tsegment dword public use32 ''DATA''\n'->putText;
   '_DATA\tends\n'->putText;
   '_BSS\tsegment dword public use32 ''BSS''\n'->putText;
   '_BSS\tends\n'->putText;
   'DGROUP\tgroup\t_BSS,_DATA\n'->putText;
   'else\n'->putText;
   'if @Version gt 510\n'->putText;
   '.model\tflat\n'->putText;
   'if @Version ge 610\n'->putText;
   'option\tnokeyword:<leS>\n'->putText;
   'endif\n'->putText;
   'else\n'->putText;
   '_TEXT\tSEGMENT PARA USE32 PUBLIC ''CODE''\n'->putText;
   '_TEXT\tENDS\n'->putText;
   '_DATA\tSEGMENT DWORD USE32 PUBLIC ''DATA''\n'->putText;
   '_DATA\tENDS\n'->putText;
   'CONST\tSEGMENT DWORD USE32 PUBLIC ''CONST''\n'->putText;
   'CONST\tENDS\n'->putText;
   '_BSS\tSEGMENT DWORD USE32 PUBLIC ''BSS''\n'->putText;
   '_BSS\tENDS\n'->putText;
   '_TLS\tSEGMENT DWORD USE32 PUBLIC ''TLS''\n'->putText;
   '_TLS\tENDS\n'->putText;
   'FLAT\tGROUP _DATA, CONST, _BSS\n'->putText;
   'ASSUME\tCS: FLAT, DS: FLAT, SS: FLAT\n'->putText;
   'endif\n'->putText;
   'endif\n'->putText;
   '_DATA\tSEGMENT\n'->putText;
   endData;
#)

---- EndRoutine:descriptor ----
(# do newLine #)

---- BeginCode:descriptor ----
(# do ';begincode\n'->putText #)

---- EndCode:descriptor ----
(# do ';endcode\n'->putText #)

---- BeginData:descriptor ----
(# do ';begindata\n_TEXT\tENDS\n_DATA\tSEGMENT\n'->putText #)

---- EndData:descriptor ----
(# do ';enddata\n_DATA\tENDS\n_TEXT\tSEGMENT\n'->putText #)

---- Epilog: descriptor ----
(# do '_TEXT\tENDS\n\tEND\n'->putText #)

---- DefinePublic:descriptor ----
(# do 
   'Public routine' -> CommentLine;
   labOp[] -> ExportLabel; labOp[] -> DefineLabel;
#)

---- DefineLocalLabel:descriptor ----
(# do op.out; ':' -> put; newLine #)

---- NewLocalLabel:descriptor ----
(# name:@text
do
   'L' -> name.put; LabelNo + 1 -> LabelNo -> name.putInt;
   (4, name[],0) -> NewLabel -> op[]
#)

---- ExportLabel:descriptor ----
(# do 'public\t' -> putText; labOp.out; newLine #)

---- ImportLabel:descriptor ----
(# do 'extrn\t' -> putText; labOp.out;
   (if labOp.subtype
    //ExternFunc then ':proc'->putText;
    //ExternVar then ':dword'->putText;
   if);
   newLine
#)

---- DefineLabel:descriptor ----
(# do labOp.out; ':' -> put; newLine #)

---- CommentLine:descriptor ----
(# do '; ' -> putText; comment[] -> putText; newLine #)

----]]
