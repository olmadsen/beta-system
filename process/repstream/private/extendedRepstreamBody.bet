ORIGIN '../extendedRepstream';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1992-94
 *       All rights reserved.
 *)
[[
--- ExtendedRepStreamgetTextBody:descriptor ---
(# l: @Integer;
do
   &text[] -> t[];
   getInt -> l;
   (# x: [l]@char
   do (for i: l repeat (r,pos*4+i-1) -> TOS'%inxGetByte' -> x[i] for);
      pos+(l-1) div 4+1 -> pos;
      x -> t
   #);
   (if (pos>lgth)//true then
       'get beyond end of stream' -> repException;
   if)
#)

--- ExtendedRepStreamPutTextBody:descriptor ---
(# l: @Integer;
do
   (if t[]//NONE then 0 -> l else t.length -> l if);
   l -> putInt;
   (if (pos+(l-1) div 4+1 >=r.range) // true
       then (r.range,1000+pos+(l-1) div 4+1) -> max -> r.extend;
   if);
   (for i: l repeat (r,pos*4+i-1,t.t[i]) -> TOS'%inxPutByte' for);
   pos+(l-1) div 4+1 -> pos;
   (if (pos>lgth)//true then pos->lgth if);
#)

---]]
