ORIGIN '../extendedRepstream';

(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1992-95
 *       All rights reserved.
 *)

--- ExtendedRepStreamPrivate:descriptor ---
(#
   l: @integer;
#)

--- ExtendedRepStreamgetTextBody:dopart ---
do
   &text[] -> t[];
   getInt -> private.l;
   (# x: [private.l]@char
   do (for i: private.l repeat (r,pos*4+i-1) -> TOS'%inxGetByte' -> x[i] for);
      pos+(private.l-1) div 4+1 -> pos;
      x -> t
   #);
   (if pos>lgth then
       'get beyond end of stream' -> repException;
   if)


--- ExtendedRepStreamPutTextBody:dopart ---
do
   (if t[]=NONE then 0 -> private.l else t.length -> private.l if);
   private.l -> putInt;
   (if pos+(private.l-1) div 4+1 >=r.range
       then (r.range,1000+pos+(private.l-1) div 4+1) -> max -> r.extend;
   if);
   (for i: private.l repeat (r,pos*4+i-1,t.t[i]) -> TOS'%inxPutByte' for);
   pos+(private.l-1) div 4+1 -> pos;
   (if pos>lgth then pos->lgth if);

