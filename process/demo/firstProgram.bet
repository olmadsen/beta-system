ORIGIN '~beta/basiclib/systemenv';
INCLUDE '~beta/process/processmanager';
INCLUDE '~beta/process/streamgenerator';

--- program:descriptor ---
systemEnv
(#	
   application: @process;
   inSocket: ^StreamSocket;
   Generator: @socketGenerator;
   aText: ^Text;
do	
   (* launch 'otherProgram' *)
   'otherProgram' -> application.init;
   application.start; 
   
   (* communicate via socket using number 5123 *)
   5123 -> Generator.bind; 
   
   (* establish connection *)
   waitForever -> Generator.getStreamConnection -> inSocket[];
   screen.newline;
   
   (* send a text via the socket *)
   'aText to the active program' -> aText[];
   'firstProgram sends: ' -> screen.puttext; aText[] -> screen.putline;
   aText[] -> inSocket.putText; inSocket.newline;
   
   (* inSocket.flush is done automatically by inSocket.newline *)
   
   (* close down *)
   application.awaitStopped; (* client first: avoids address-in-use error *)
   inSocket.close;
   Generator.close;
#)
