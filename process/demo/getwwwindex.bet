ORIGIN '~beta/basiclib/systemenv';
INCLUDE '~beta/process/streamgenerator';

--- program:descriptor ---
systemEnv
(# 
   s: @StreamSocket;
   index: @Text;
   ch: @Char;
   servername: ^Text;
   serverport: @Integer;
   pagename: ^Text;
   
do 'www.daimi.au.dk'->servername[];
   80->serverport;
   '~beta/index.html'->pagename[];
   
   (10, servername[], serverport)
     ->s.connect
   (# 
      error::
        (# 
        do (failure, 'problem connecting to server, quitting')->Stop;
        #)
   #);
   
   'GET /'->s.putText; pagename[]->s.putText;s.newLine;
   
   s.flush;
   L: (# 
      do (if not s.EOS then 
             s.Get -> index.put; 
             restart L
         if)
      #);
   s.close;
   
   index[]->screen.putLine;
#)
