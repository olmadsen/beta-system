ORIGIN '~beta/basiclib/v1.5/systemenv';
INCLUDE '~beta/process/v1.6/streamgenerator';

--- program:descriptor ---
systemEnv
(# 
   counter: IntegerObject
     (# 
     do value+1 -> value
     #);
   
   port: (# exit 7899 #);
   
   streamGen: @SocketGenerator;
   clientSock: ^StreamSocket;
   aCounter: @counter;
   
   
do port -> streamGen.bind;   (* The port chosen for this service. *)
   cycle
   (# 
   do waitForever -> streamGen.getStreamConnection -> clientSock[];
      'My count is now: '->clientSock.putText;
      aCounter -> clientSock.putInt;
      clientSock.newLine;
      clientSock.close;
   #)
#)
   
   
