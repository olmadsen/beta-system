ORIGIN '~beta/process/streamsocket';
BODY 'private/protocolstreambody';
--- systemlib: attributes ---
protocolStream: streamSocket
  (# <<SLOT protocolstreamlib: attributes>>;
     name:<
       (# value: ^text do INNER exit value[] #);
     communicationPort:<
       integervalue;
     command:
       (* all protocol commands will be subpatterns of this pattern,
        * giving all commands the same exception handling
        * possibilities
        *)
       (# <<SLOT protocolstreamcommandlib: attributes>>;
          protocolException:< exception
            (# protocolError: error
                 (# status, result: ^text   
                 enter (status[],result[])
                 <<SLOT protocolerror: dopart>>
                 #);
               serverNotFound:< error
                 (# server: ^text; port: @integer
                 enter (server[],port)
                 do 'Unknown server: '->msg.puttext; server[]->msg.puttext;
                    ' at port: '->msg.puttext; port->msg.putint; msg.newline
                 #);
            do INNER protocolException
            #);
          error:< (* private *)
            (# status, result: ^text
            enter (status[],result[])
            do INNER error
            #);
       do INNER command
       #);
     server:< command
       (* connect this(protocolStream) with the server specified by
        * "domain".  The connection will be established to this server
        * at the port specified by "communicationPort" above
        *)
       (# domain: ^text;
          okStatus:< (* private *) (# value: ^text do INNER exit value[] #);
       enter domain[]
       <<SLOT protocolserver: dopart>>
       #);
  #)
