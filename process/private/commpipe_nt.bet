ORIGIN 'commpipe';

(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics 1995
 *       All rights reserved.
 *)


INCLUDE '~beta/win32lib/v1.6/ntinterface';
INCLUDE 'sysFdStream';
INCLUDE 'sysFdStream_nt';

--- PipePrivate:descriptor ---
(#
   descriptors: ^ntPipe;
   readCh: @readChannel;
   writeCh: @writeChannel;

   init: (# do (* !!! IOstate/timeHandler for pipes? *) #);
#)

--- PipeInit:dopart ---
do
   initSockets;
   INNER Init;
   (* get OS level pipe object *)
   &ntPipe[] -> private.descriptors[];
   (if (private.descriptors[] -> &openPipe)
    // -1 then 'failed to open pipe' -> error;
   if);
   private.init;

   (* make readCh/writeCh wrap the pipe *)
   private.descriptors.writeIndex -> private.writeCh.private.Index;
   private.descriptors.readIndex -> private.readCh.private.Index;
(*   private.readCh.openRead;
   private.writeCh.openWrite; *)

   (* initialize interface *)
   private.readCh[] -> readEnd[];
   private.writeCh[] -> writeEnd[];

