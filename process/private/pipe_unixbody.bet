ORIGIN 'systemComm_unixbody';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1994
 *       All rights reserved.
 *)
[[
--- include '~beta/unixlib/v1.5/unixinterface'
--- include 'sysFdStream'
--- include 'sysFdStreamBody'

(* !!! BEGIN "Not yet updated wrt systemenv" -- EE/940323 *)

--- PipePrivate:descriptor ---
(#
   readCh: @readChannel;
   writeCh: @writeChannel;

   init: (# do (* !!! IOstate/timeHandler for pipe? *) #);
#)

--- PipeInit:descriptor ---
(#
   descriptors: ^unixPipe;
do
   initSockets;
   INNER Init;
   (* get OS level pipe object *)
   &unixPipe[] -> descriptors[];
   (if (descriptors[] -> &openPipe)
    // -1 then 'failed to open pipe' -> error;
   if);
   private.init;

   (* make readCh/writeCh wrap the pipe *)
   descriptors.writeIndex -> private.writeCh.private.Index;
   descriptors.readIndex -> private.readCh.private.Index;
   private.readCh.openRead;
   private.writeCh.openWrite;

   (* initialize interface *)
   private.readCh[] -> readEnd[];
   private.writeCh[] -> writeEnd[];
#)

(* !!! END "Not yet updated wrt systemenv" -- EE/940323 *)

---]]
