ORIGIN '~beta/basiclib/v1.4/basicsystemenv';

INCLUDE '~beta/containers/v1.4/list';

--- systemlib:attributes ---

idSchedElement:
  (#
     suspend_sem: @semaphore;
     id: @integer;
  #);

idScheduler:
  (#
     isElement:< idSchedElement;
     elements: @list(# element::< idSchedElement #);
     
     id_suspend:
       (# id: @integer;
          elm: ^isElement;
       enter id
       do
          &isElement[]->elm[];
          id->elm.id;
          elm[]->elements.append;
          elm.suspend_sem.P;
          INNER;
       #);
     id_resume:
       (# found:< object;
          not_found:< object;
          id: @integer;
          elm: ^isElement;
       enter id
       do
          L: (#
             do
                elements.iterate (* !!! optimize alert *)
                (#
                do
                   (if current.elm.id // id then 
                       current.elm[]->elm[];
                       current[]->elements.delete;
                       found;
                       elm.suspend_sem.V;
                       leave L;
                   if);
                #);

                (* tell user no element had the right 'id' *)
                not_found;
             #);
       #);
     
  #);

