ORIGIN '../runAlloc';

MUST BE REWRITTEN TO CONTAIN ASSEMBLY CODE IN DEDICATED ASSEMBLY FILES.
THIS IS NECESSARY FOR BINARY CODE GENERATOR TO WORK

[[
--- include '~beta/sysutils/v1.4/objinterface'

--- allocByteRepBody:descriptor ---
(# DoAlloVR1: @
     (# objAddress,offset,range: @integer
     enter (objAddress,offset,range)
     do (code
        '   LDW 16(%r3),%r9 ; offset to DataRegA
        LDW 20(%r3),%r10 ; range to DataRegB
        .IMPORT AlloVR1,CODE
        BL AlloVR1,%r2
        LDW 12(%r3),%r3  ; objAddress to RegObj'
        code)
     #);
do (@@ori -> tos'%adrGetLong', offset, high) -> DoAlloVR1;
#)

--- allocWordRepBody:descriptor ---
(# DoAlloVR2: @
     (# objAddress,offset,range: @integer
     enter (objAddress,offset,range)
     do (code
        '   LDW 16(%r3),%r9 ; offset to DataRegA
        LDW 20(%r3),%r10 ; range to DataRegB
        .IMPORT AlloVR2,CODE
        BL AlloVR2,%r2
        LDW 12(%r3),%r3  ; objAddress to RegObj'
        code)
     #);
do (@@ori -> tos'%adrGetLong', offset, high) -> DoAlloVR2;
#)

--- allocValRepBody:descriptor ---
(# DoAlloVR4: @
     (# objAddress,offset,range: @integer
     enter (objAddress,offset,range)
     do (code
        '   LDW 16(%r3),%r9 ; offset to DataRegA
        LDW 20(%r3),%r10 ; range to DataRegB
        .IMPORT AlloVR4,CODE
        BL AlloVR4,%r2
        LDW 12(%r3),%r3  ; objAddress to RegObj'
        code)
     #);
do (@@ori -> tos'%adrGetLong', offset, high) -> DoAlloVR4;
#)

--- allocDoubleRepBody:descriptor ---
(# DoAlloVR8: @
     (# objAddress,offset,range: @integer
     enter (objAddress,offset,range)
     do (code
        '   LDW 16(%r3),%r9 ; offset to DataRegA
        LDW 20(%r3),%r10 ; range to DataRegB
        .IMPORT AlloVR8,CODE
        BL AlloVR8,%r2
        LDW 12(%r3),%r3  ; objAddress to RegObj'
        code)
     #);
do (@@ori -> tos'%adrGetLong', offset, high) -> DoAlloVR8;
#)

--- allocRefRepBody:descriptor ---
(# DoAlloRR: @
     (# objAddress,offset,range: @integer
     enter (objAddress,offset,range)
     do (code
        '   LDW 16(%r3),%r9 ; offset to DataRegA
        LDW 20(%r3),%r10 ; range to DataRegB
        .IMPORT AlloRR,CODE
        BL AlloRR,%r2
        LDW 12(%r3),%r3  ; objAddress to RegObj'
        code)
     #);
do (@@ori -> tos'%adrGetLong', offset, high) -> DoAlloRR;
#)

--- allocStructureBody:descriptor ---
(# DoAlloS: @
     (# origin, proto: @Integer;
        s: @Integer;
     enter (origin, proto)
     do (code
        '   LDW 12(%r3),%r5    ; origin in r5
        .IMPORT AlloS,CODE
        BL AlloS,%r2
        LDW 16(%r3),%r4    ; protoAddress in r4
        STW %r4,20(%r3)    ; result in r4'
        code)
     exit s
     #)
do 
   ((@@obj -> tos'%adrGetLong') + offset, (@@iOrigin -> tos'%adrGetLong', iProto) -> DoAlloS)
     -> AssignRef;
#)

--- allocItemBody:descriptor ---
(# DoAlloI: @
     (# origin, proto: @Integer;
        o: @Integer;
     enter (origin, proto)
     do (code
        '   LDW 12(%r3),%r5    ; origin in r5
        .IMPORT AlloI,CODE
        BL AlloI,%r2
        LDW 16(%r3),%r4    ; protoAddress in r4
        STW %r4,20(%r3)    ; result in r4'
        code)
     exit o
     #)
do 
   (@@o, (@@ori -> tos'%adrGetLong', proto) -> DoAlloI)
     -> AssignRef;
#)

---]]
