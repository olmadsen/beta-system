ORIGIN '../palette';
INCLUDE '~beta/guienv/v1.3.1/utils/tableview';
INCLUDE '~beta/guienv/v1.3.1/utils/loadraster';
INCLUDE '../../objectsstore/objectdata';
INCLUDE '~beta/guienv/v1.3.1/utils/guienvadds';

-- GUIENVpaletteOpen: doPart --
do true -> border.visible;
   borderStyles.shadowOut -> border.style;
   this(palette)[] -> private.theTableView.open;
   inner;

-- GUIENVpaletteAddPaletteItem: doPart --
do (# theItem: ^private.theTableView.paletteItem;
   do &private.theTableView.paletteItem[] -> theItem[];
      theItem.init;
      icon[] -> theItem.icon;
      name[] -> theItem.name;
      type -> theItem.type;
   #);
   
-- GUIENVpaletteEventHandlerOnMouseDown: doPart --
do (* (if doubleClick then
    *        private.toggleShrinkState;
    *     else
    *        drag;
    *    if);
    *)
   drag;
   
-- GUIENVpalettePrivate: descriptor --
(# 
   width,  height: @integer;
   fitToContents:
     (#
     do theTableView.fitToContents;
        (4, 10) -> theTableView.position;
        theTableView.size -> (width, height);
        (* (36 + 4 + 6 -> width, height) -> theTableView.size; *)
        width + 2*4 -> width;
        height + 4 + 10 -> height;
        (width, height) -> size;
        true -> theTableView.bindRight;
        true -> theTableView.bindBottom;
     #);
   shrinked: @boolean;
   toggleShrinkState:
     (# 
     do (if shrinked then
            (width,  height) -> size;
            false -> shrinked;
         else
            (2*4 + 36 + 6 + 4, height) -> size;
            true -> shrinked;
        if);
     #);
   theTableView: @tableView
     (# paletteItem: tableItem
          (# type: @integer;
             onMouseDown::<
               (# p: @point;
               do (theEvent.localPosition, theTableView[], this(palette)[]) 
                    -> translate -> p; 
                  (type, name, p, theEvent[]) -> mouseDownInItem;
               #);
          #);
        open::
          (# 
          do true -> border.visible;
             borderStyles.shadowIn -> border.style;
          #);
     #);
#)



-- GUIENVControlpaletteOpen: doPart --
do ('button' -> loadRaster, 'PushButton', pushButtonType) -> addPaletteItem;
   ('checkbox' -> loadRaster, 'CheckBox',  checkBoxType) -> addPaletteItem;
   ('radiobutton' -> loadRaster, 'RadioButton', radioButtonType) -> addPaletteItem;
   ('statictext' -> loadRaster, 'StaticText', staticTextType) -> addPaletteItem;
   ('edittext' -> loadRaster, 'EditText', editTextType) -> addPaletteItem;
   ('iconbutton' -> loadRaster, 'IconButton', iconButtonType) -> addPaletteItem;
   ('optionbutton' -> loadRaster, 'OptionButton', optionButtonType) -> addPaletteItem;
   ('scrollbar' -> loadRaster, 'ScrollBar', scrollBarType) -> addPaletteItem;
   ('scrollbarv' -> loadRaster, 'ScrollBar', scrollBarType) -> addPaletteItem;
   ('separatorh' -> loadRaster, 'Separator', separatorType) -> addPaletteItem;
   ('separatorv' -> loadRaster, 'Separator', separatorType) -> addPaletteItem;
   private.fitToContents;
   private.toggleShrinkState;
   inner;
   
-- GUIENVViewPaletteOpen: doPart --
do (none, 'Canvas', canvasType ) -> addPaletteItem;
   (none, 'Scroller', scrollerType) -> addPaletteItem;
   (none, 'TextEditor', textEditorType) -> addPaletteItem;
   (none, 'ScrollList', textScrollListType) -> addPaletteItem;
   (none, 'TextField', textFieldType) -> addPaletteItem;
   private.fitToContents;
   inner;
   
-- toolPaletteOpen: doPart --
do ('select' -> loadRaster, 'Select', 1) -> addPaletteItem;
   ('hierarki' -> loadRaster, 'Hierarki', 2) -> addPaletteItem;
   private.fitToContents;
   private.toggleShrinkState;
   inner open;
