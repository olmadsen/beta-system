
ORIGIN '~beta/guienv/v1.3.1/guienvall';
BODY 'private/graphicaleditorbody';
BODY 'private/windowitemdialogsbody';
INCLUDE '~beta/interfacebuilder/v1.1/objectsstore/objectdata';
INCLUDE '~beta/interfacebuilder/v1.1/astcommunication/astcommunication';
INCLUDE '~beta/mps/v4.9.1/astlevel';
INCLUDE '~beta/betaast/v4.9.1/betacfl';
INCLUDE '../asteditor/asteditor';
INCLUDE '../container/doublelinkedlist';

-- guienvLib: attributes --

graphicalEditorEnv:
  (# <<SLOT graphicalEditorEnvLib: attributes>>;
     
     
     showParseErrors:<
       (# msg: ^text;
       enter msg[]
       do inner;
       #);
     
     theAstEditorEnv: @astEditorEnv
       (# showParseErrors::<
            (# 
            do msg[] -> this(graphicalEditorEnv).showParseErrors;
            #);
       #);
     
     openAstEditorMethod:
       (# node: ^astInterface.AST;
          title: ^text;
       enter (node[], title[])
       do inner;
       #);
     openSeparateAstEditorMethod: openAstEditorMethod
       (# 
       <<SLOT graphicalEditorEnvOpenSeparateAstEditorMethod: doPart>>
       #);
     openAstEditor:< openAstEditorMethod;
     
     
     init:<
       (# <<SLOT graphicalEditorEnvInit: doPart>> #);
     
     find:
       (# node: ^astInterface.beta.attributeDecl;
          editor: ^graphicalEditor;
       enter node[]
       <<SLOT graphicalEditorEnvFind: doPart>>
       exit editor[]
       #);
     

     graphicalEditor: window
       (# <<SLOT graphicalEditorLib: attributes>>;
          theObjectStore: ^objectDataStore;
          MPS: ^astInterface;
          betaGram: ^astInterface.beta;
          
          body:
            (# group: ^astInterface.fragmentGroup;
            enter (# enter group[] <<SLOT GraphicalEditorEnterBody: doPart>> #)
            exit (# <<SLOT GraphicalEditorExitBody: doPart>> exit group[] #)
            #);
          privateAttributes:
            (# value: @boolean
            enter (# enter value <<SLOT GraphicalEditorEnterPrivateAttributes: doPart>> #)
            exit (# <<SLOT GraphicalEditorExitPrivateAttributes: doPart>> exit value #)
            #);
          privateDoParts:
            (# value: @boolean
            enter (# enter value <<SLOT GraphicalEditorEnterPrivateDoParts: doPart>> #)
            exit (# <<SLOT GraphicalEditorExitPrivateDoPart: doPart>> exit value #)
            #);
          
          astControl: @astController
            (# 
               onReplaced::<
                 (# <<SLOT GraphicalEditorAstControlReplaced: doPart>> #);
            #);
          
          windowItemEditorList: doubleLinkedList
            (# element:: windowItemEditor;
               position:: (#  #);
               copy:
                 (# theCopy: ^windowItemEditorList;
                 <<SLOT windowItemEditorListCopy: doPart>>
                 exit theCopy[]
                 #);
               set:
                 (# theOther: ^windowItemEditorList;
                 enter theOther[]
                 <<SLOT windowItemEditorListSet: doPart>>
                 #);
            #);
          
          windowitemEditor: 
            (# <<SLOT windowitemEditorLib: attributes>>;
               astControl: @astController
                 (# 
                    onReplaced::<
                      (# <<SLOT WindowitemEditorAstControlReplaced: doPart>> #);
                    onDeleted::<
                      (# <<SLOT GraphicalEditorWindowItemEditorDeleted: doPart>> #);
                    onAncestorReplaced::<
                      (# <<SLOT GraphicalEditorWindowItemdEditorAncestorReplaced: doPart>> #);
                 #);
               owner: ^canvasEditor;
               windowitemType:< windowitem;
               theWindowitem: ^windowitemType;
               dataType:< windowItemData;
               data: ^dataType;
               
               showInfoDialog:
                 (# <<SLOT GraphicalEditorWindowItemEditorShowInfoDialog: doPart>> #);
               
               codeDialog: ^codeDialogType;
               showCodeDialog:
                 (# <<SLOT GraphicalEditorWindowItemEditorShowCodeDialog: doPart>> #);
               
               
               editAttributes:
                 (#  <<SLOT GraphicalEditorWindowItemEditorEditAttributes: doPart>> #);
               editVirtual:
                 (# name: ^text;
                 enter name[]
                 <<SLOT GraphicalEditorWindowItemEditorEditVirutal: doPart>>
                 #);
               
               init:<
                 (# theAttribute: ^astInterface.beta.attributeDecl;
                 enter (owner[], theAttribute[], data[])
                 <<SLOT GraphicalEditorWindowItemEditorInit: doPart>>
                 #);
               new:< 
                 (# type: @integer;
                    newData:<
                      (# <<SLOT GraphicalEditorWindowItemEditorNewData: doPart>> #);
                 enter (owner[], type)
                 <<SLOT windowitemEditornew: doPart>> 
                 #);
               close:<
                 (# <<SLOT GraphicalEditorWindowItemEditorClose: doPart>> #);
               mousedown:<
                 (# done: @boolean;
                    theEvent: ^windowItem.eventHandler.mouseDown;
                 enter theEvent[]
                 <<SLOT windowitemEditorMousedown: doPart>>
                 #);
               select:
                 (# <<SLOT windowItemEditorSelect: doPart>> #);
               deSelect:
                 (# <<SLOT windowItemEditorDeSelect: doPart>> #);
               applyObjectData:<
                 (# 
                 <<SLOT IBwindowitemEditorapplyObjectData: doPart>>
                 #);
               findEditor:<
                 (# pt: @point;
                    ignoreEditor: ^windowItemEditor;
                    theEditor: ^windowItemEditor;
                 enter (pt, ignoreEditor[])
                 <<SLOT graphicalEditorWindowItemEditorFindEditor: doPart>>
                 exit theEditor[]
                 #);
               getPublicAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes;
                 <<SLOT windowItemEditorGetPublicAttributes: doPart>>
                 exit theAttributes[]
                 #);
               getPrivateAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes;
                 <<SLOT windowItemEditorGetPrivateAttributes: doPart>>
                 exit theAttributes[]
                 #);
               getMainAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes;
                 <<SLOT windowItemEditorGetMainAttributes: doPart>>
                 exit theAttributes[]
                 #);
               getMainNode:<
                 (# theNode: ^astInterface.beta.attributeDecl;
                 do astControl.node[] -> theNode[];
                    inner;
                 exit theNode[]
                 #);
               createTheWindowItem:<
                 (# initial: @boolean;
                 enter initial
                 <<SLOT GraphicalEdioterWindowItemEditorCreateWindowItem: doPart>> 
                 #);
               private: @<<SLOT windowitemEditorPrivate: descriptor>>;
            #);
          canvasEditor: windowitemEditor
            (# <<SLOT canvasEditorLib: attributes>>;
               children: @windowItemEditorList;
               newEditor:
                 (# type: @integer;
                    theEditor: ^windowitemEditor;
                 enter type
                 <<SLOT graphicalEditorNewEditor: doPart>>
                 exit theEditor[]
                 #);
               windowitemType::< canvas;
               getMainCanvas:<
                 (# theCanvas: ^canvas;
                 do theWindowItem[] -> theCanvas[];
                    inner;
                 exit theCanvas[]
                 #);
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorCanvasEditorNewData: doPart>> #);
                 <<SLOT canvasEditornew: doPart>> 
                 #);
               init::< (# <<SLOT canvasEditorInit: doPart>> #);
               close::<
                 (# <<SLOT GraphicalEditorCanvasEditorClose: doPart>> #);
               mousedown::< (# <<SLOT canvasEditorMousedown: doPart>> #);
               dataType::< windowItemData;
               applyObjectData::<
                 (# 
                 <<SLOT IBcanvasEditorapplyObjectData: doPart>>
                 #);
               findEditor:: (# <<SLOT graphicalEditorCanvasEditorFindEditor: doPart>> #);
               private: @<<SLOT canvasEditorPrivate: descriptor>>;
               createTheWindowItem::<
                 (# <<SLOT GraphicalEditorCanvasEditorCreateTheWindowItem: doPart>> #);
            #);
          abstractScrollerEditor: canvasEditor
            (# 
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorAbstractScrollerEditorNewData: doPart>> #);
                 <<SLOT abstractScrollerEditornew: doPart>> 
                 #);
            #);
          scrollerEditor: abstractScrollerEditor
            (# 
               windowitemType::< scroller;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorScrollerEditorNewData: doPart>> #);
                 <<SLOT scrollerEditornew: doPart>> 
                 #);
               getMainAttributes::<
                 (# <<SLOT scrollerEditorGetMainAttributes: doPart>> #);
               getMainNode::<
                 (# <<SLOT ScrollerEditorGetMainNode: doPart>> #);
               getMainCanvas::<
                 (# <<SLOT ScrollerEditorGetMainCanvas: doPart>> #);
               createTheWindowItem::<
                 (# <<SLOT GraphicalEditorScrollerEditorCreateTheWindowItem: doPart>> #);
            #);
          textEditorEditor: abstractScrollerEditor
            (# 
               windowitemType::< textEditorPict;
               init::<
                 (# <<SLOT GraphicalEditorTextEditorEditorInit: doPart>> #);
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorTextEditorEditorNewData: doPart>> #); 
                 <<SLOT textEditorEditornew: doPart>> 
                 #);
               createTheWindowItem::<
                 (# <<SLOT GraphicalEditorTextEditorEditorCreateTheWindowItem: doPart>> #);
            #);
          separatorEditor: windowItemEditor
            (# windowitemType::< separator;
               dataType::< separatorData;
               
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorSeparatorEditorNewData: doPart>> #); 
                 <<SLOT SeparatorEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBSeparatorApplyObjectData: doPart>>
                 #);
            #);
          controlEditor: windowitemEditor
            (# 
               windowitemType::< control;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorControlEditorNewData: doPart>> #); 
                 <<SLOT controlEditornew: doPart>>
                 #);
            #);
          buttonEditor: controlEditor
            (# windowitemType::< button;
               dataType::< buttonData;
               
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorButtonEditorNewData: doPart>> #); 
                 <<SLOT buttonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBbuttonApplyObjectData: doPart>>
                 #);
            #);
          pushButtonEditor: buttonEditor
            (# 
               windowitemType::< pushButton;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorPushButtonEditorNewData: doPart>> #); 
                 <<SLOT pushButtonEditornew: doPart>> 
                 #);
            #);
          iconButtonEditor: buttonEditor
            (# 
               windowitemType::< iconButton;
               dataType::< iconButtonData;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorIconButtonEditorNewData: doPart>> #); 
                 <<SLOT iconButtonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBiconButtonapplyObjectData: doPart>>
                 #);
            #);
          optionButtonEditor: buttonEditor
            (# 
               windowitemType::< optionButton;
               dataType::< optionButtonData;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorOptionButtonEditorNewData: doPart>> #); 
                 <<SLOT optionButtonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBoptionButtonapplyObjectData: doPart>>
                 #);
            #);
          staticTextEditor: buttonEditor
            (# 
               windowitemType::< staticText;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorStaticTextEditorNewData: doPart>> #); 
                 <<SLOT staticTextEditornew: doPart>> 
                 #);
            #);
          toggleButtonEditor: buttonEditor
            (# 
               windowitemType::< toggleButton;
               dataType::< toggleButtonData;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorToggleButtonEditorNewData: doPart>> #);
                 <<SLOT toggleButtonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBtoggleButtonapplyObjectData: doPart>>
                 #);
            #);
          radioButtonEditor: toggleButtonEditor
            (# 
               windowitemType::< radioButton;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorRadioButtonEditorNewData: doPart>> #);
                 <<SLOT radioButtonEditornew: doPart>> 
                 #);
            #);
          checkBoxEditor: toggleButtonEditor
            (# 
               windowitemType::< checkBox;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorCheckBoxEditorNewData: doPart>> #);
                 <<SLOT checkBoxEditornew: doPart>> 
                 #);
            #);
          scrollbarEditor: controlEditor
            (# 
               windowitemType::< scrollbar;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorScrollBarEditorNewData: doPart>> #);
                 <<SLOT scrollbarEditornew: doPart>> 
                 #);
               dataType::< scrollBarData;
               applyObjectData::<
                 (# 
                 <<SLOT IBscrollBarapplyObjectData: doPart>>
                 #);
            #);
          editTextEditor: controlEditor
            (# 
               windowitemType::< editText;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorEditTextEditorNewData: doPart>> #);
                 <<SLOT editTextEditornew: doPart>> 
                 #);
               dataType::< editTextData;
               applyObjectData::<
                 (# 
                 <<SLOT IBeditTextapplyObjectData: doPart>>
                 #);
            #);
          textFieldEditor: windowitemEditor
            (# 
               windowitemType::< textField;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorTextFieldEditorNewData: doPart>> #);
                 <<SLOT textFieldEditornew: doPart>> 
                 #);
            #);
          scrollListEditor: windowitemEditor
            (# 
               windowitemType::< textEditorPict;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorScrollListEditorNewData: doPart>> #);
                 <<SLOT scrollListEditornew: doPart>> 
                 #);
               dataType::< scrollListData;
               applyObjectData::<
                 (#
                 <<SLOT IBscrollListapplyObjectData: doPart>>
                 #);
            #);
          textScrollListEditor: windowitemEditor
            (# 
               windowitemType::< textEditorPict;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorTextScrollListEditorNewData: doPart>> #);
                 <<SLOT textScrollListEditornew: doPart>> 
                 #);
               dataType::< textScrollListData;
               applyObjectData::<
                 (# 
                 <<SLOT IBtextScrollListapplyObjectData: doPart>>
                 #);
            #);
          
          (* 
           * Mode
           *)
          
          selectMode: (# exit 1 #);
          hierarkiMode: (# exit 2 #);
          resizeMode: (# exit 3 #);
          
          mode:
            (# value: @integer;
            enter (# enter value <<SLOT graphicalEditorEnterMode: doPart>> #)
            exit (# <<SLOT graphicalEditorExitMode: doPart>>  exit value #)
            #);
          (*
           * Init
           *)
          
          init:<
            (# node: ^astInterface.beta.attributeDecl;
            enter node[]
            <<SLOT GraphicalEditorInit: doPart>>
            #);
          new:<
            (# theAttribute: ^astInterface.beta.attributeDecl;
            enter theAttribute[]
            <<SLOT GraphicalEditorNew: doPart>>
            #);
          
          (*
           * Selection
           *)
          
          
          canUndo: booleanValue
            (# <<SLOT graphicalEditorCanUndo: doPart>> #);
          undo:
            (# 
            <<SLOT graphicalEditorUndo: doPart>>
            #);
          undoText:
            (# value: ^text;
            <<SLOT graphicalEditorUndoText: doPart>>
            exit value[]
            #);
          canRedo: booleanValue
            (# <<SLOT graphicalEditorCanRedo: doPart>> #);
          redo:
            (# 
            <<SLOT graphicalEditorRedo: doPart>>
            #);
          redoText:
            (# value: ^text;
            <<SLOT graphicalEditorRedoText: doPart>>
            exit value[]
            #);
          canPaste: booleanValue
            (# 
            <<SLOT graphicalEditorCanPaste: doPart>>
            #);
          paste:
            (# 
            <<SLOT graphicalEditorPaste: doPart>>
            #);
          showCode:
            (# <<SLOT graphicalEditorShowCode: doPart>> #);
          selection: @windowItemEditorList
            (# <<SLOT selectionLib: attributes>>;
               append::
                 (#
                 <<SLOT selectionAppend: doPart>>
                 #);
               prepend::
                 (# 
                 <<SLOT selectionPrepend: doPart>>
                 #);
               delete::
                 (#
                 <<SLOT selectionDelete: doPart>>
                 #);
               clear::
                 (# 
                 <<SLOT selectionClear: doPart>>
                 #);
               
               (* Actions *)
               deleteAll:
                 (# <<SLOT GraphicalEditorSelectionDelete: doPart>> #);
	       showInfo:
                 (# <<SLOT GraphicalEditorSelectionShowInfo: doPart>> #);
	       showCode:
                 (# <<SLOT GraphicalEditorSelectionShowCode: doPart>> #);
               fitToContents:
                 (# <<SLOT GraphicalEditorSelectionFitToContents: doPart>> #);
               alignLeft:
                 (# <<SLOT GraphicalEditorSelectionAlignLeft: doPart>> #);
               alignRight:
                 (# <<SLOT GraphicalEditorSelectionAlignRight: doPart>> #);
               alignTop:
                 (# <<SLOT GraphicalEditorSelectionAlignTop: doPart>> #);
               alignBottom:
                 (# <<SLOT GraphicalEditorSelectionAlignBottom: doPart>> #);
               alignHorCenter:
                 (# <<SLOT GraphicalEditorSelectionAlignHorCenter: doPart>> #);
               alignVerCenter:
                 (# <<SLOT GraphicalEditorSelectionAlignVerCenter: doPart>> #);
               showSpacingDialog:
                 (# <<SLOT GraphicalEditorSelectionShowSpacingDialog: doPart>> #);
               doCopy:
                 (# <<SLOT graphicalEditorSelectionDoCopy: doPart>> #);
               doCut:
                 (# <<SLOT graphicalEditorSelectionDoCut: doPart>> #);
            #);

          open::<
            (# width, height: @integer;
            enter (width, height)
            <<SLOT graphicalEditorOpen: doPart>> 
            #);
          close::<
            (# <<SLOT graphicalEditorClose: doPart>> #);
          eventHandler::<
            (# onMouseDown::<
                 (# <<SLOT graphicalEditorOnMouseDown: doPart>> #);
            #);
          private: @<<SLOT graphicalEditorPrivate: descriptor>>;
       #);
     
     private: @<<SLOT graphicalEditorEnvPrivate: descriptor>>;
  #);

-- graphicalEditorLib: attributes --


textEditorPict: canvas
  (# <<SLOT textEditorPictLib: attributes>>;
     open::<
       (# <<SLOT textEditorPictOpen: doPart>> #);
     private: @<<SLOT textEditorPictPrivate: descriptor>>;
  #);

CodeDialogType: window
  (# <<SLOT CodeDialogTypeLib: attributes>>;
     editor: ^windowItemEditor;
     updateFields:
       (# <<SLOT GraphicalEditorCodeDialogTypeUpdateFields: doPart>> #);
     open::<
       (#  <<SLOT GraphicalEditorCodeDialogTypeOpen: doPart>> #);
     close::<
       (# <<SLOT CodeDialogTypeClose: doPart>> #);
     private: @<<SLOT GraphicalEditorCodeDialogTypePrivate: descriptor>>;
     menubarVisible::< (# do false -> value #);
  #);

