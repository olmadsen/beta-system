ORIGIN '~beta/guienv/v1.3.1/guienvall';
BODY 'private/graphicaleditorprivate';
BODY 'private/windowitemdialogsbody';
BODY 'private/documentbody';

INCLUDE '../resourcesupport/parameters';
INCLUDE '~beta/mps/v5.0.1/astlevel';
INCLUDE '~beta/betaast/v5.0.1/betacfl';
INCLUDE '../asteditor/asteditor';
INCLUDE '../fragmenthandler/fragmenthandler';
INCLUDE '~beta/datastructures/v0.1/doublelinkedlist';
INCLUDE '~beta/datastructures/v0.1/set';

-- guienvLib: attributes --

graphicalEditorEnv:
  (# <<SLOT graphicalEditorEnvLib: attributes>>;
     
     MPS: ^astInterface;
     betaGram: ^astInterface.beta;
     pretty: ^astInterface.prettyPrinter;
     
     showParseErrors:<
       (# msg: ^text;
       enter msg[]
       do inner;
       #);
     save:<
       object;
     
     theAstEditorEnv: @astEditorEnv
       (# showParseErrors::<
            (# 
            do msg[] -> this(graphicalEditorEnv).showParseErrors;
            #);
       #);
 
     openAstEditorMethod:
       (# node: ^astInterface.AST;
          title: ^text;
       enter (node[], title[])
       do inner;
       #);
     openSeparateAstEditorMethod: openAstEditorMethod
       (# 
       <<SLOT graphicalEditorEnvOpenSeparateAstEditorMethod: doPart>>
       #);
     openAstEditor:< openAstEditorMethod;
     
     theFragServer: ^fragmentServer;
     
     init:<
       (# 
       enter (theFragServer[], MPS[], betaGram[], pretty[])
       <<SLOT graphicalEditorEnvInit: doPart>> 
       #);
     
     find:
       (# node: ^astInterface.beta.attributeDecl;
          editor: ^graphicalEditor;
       enter node[]
       <<SLOT graphicalEditorEnvFind: doPart>>
       exit editor[]
       #);
     
     (*
      * Document interface
      *)
     
     document:
       (# interfaceGroup: ^astInterface.fragmentGroup;
          bodyGroups: @set
            (# element:: MPS.fragmentGroup;
            #);
          defaultBodyGroup:
            (# group: ^astInterface.fragmentGroup;
            <<SLOT documentDefaultBodyGroup: doPart>>
            exit group[]
            #);
          theParameterStore: ^parameterStore;
          name: ^text;
          open:
            (# error:<
                 (# msg: ^text;
                 enter msg[]
                 do inner;
                 #);
            enter name[]
            <<SLOT documentOpen: doPart>>
            #);
          new:
            (# error:<
                 (# msg: ^text;
                 enter msg[]
                 do inner;
                 #);
            enter name[]
            <<SLOT documentNew: doPart>>
            #);
          save:
            (# 
            <<SLOT documentSave: doPart>>
            #);
       #);
     findDocument:
       (# name: ^text;
          theDocument: ^document;
       enter name[]
       <<SLOT graphicalEditorEnvFindDocument: doPart>>
       exit theDocument[]
       #);
     scanDocuments:
       (# current: ^document;
       <<SLOT graphicalEditorEnvScanDocuments: doPart>>
       #);
     (*
      * END of document interface
      *)
     
     graphicalEditor: window
       (# <<SLOT graphicalEditorLib: attributes>>;
          menubarType::<
            (# open::<
                 (# <<SLOT InterfaceBuilderGraphicalEditorWindowMenubarOpen: doPart>> #);
            #);
          
          theDocument: ^document;
          
          node: ^astInterface.beta.attributeDecl;
          
          privateAttributes:
            (# value: @boolean
            enter (# enter value <<SLOT GraphicalEditorEnterPrivateAttributes: doPart>> #)
            exit (# <<SLOT GraphicalEditorExitPrivateAttributes: doPart>> exit value #)
            #);
          privateDoParts:
            (# value: @boolean
            enter (# enter value <<SLOT GraphicalEditorEnterPrivateDoParts: doPart>> #)
            exit (# <<SLOT GraphicalEditorExitPrivateDoPart: doPart>> exit value #)
            #);
          
          (* astControl: @astController
           *             (# 
           *                onReplaced::<
           *                  (# <<SLOT GraphicalEditorAstControlReplaced: doPart>> #);
           *             #);
           *)
          
          windowItemEditorList: doubleLinkedList
            (# element:: windowItemEditor;
               position:: (#  #);
               copy:
                 (# theCopy: ^windowItemEditorList;
                 <<SLOT windowItemEditorListCopy: doPart>>
                 exit theCopy[]
                 #);
               set:
                 (# theOther: ^windowItemEditorList;
                 enter theOther[]
                 <<SLOT windowItemEditorListSet: doPart>>
                 #);
            #);
          
          windowitemEditor: 
            (# <<SLOT windowitemEditorLib: attributes>>;
               
               node: ^astInterface.beta.attributeDecl;
               owner: ^canvasEditor;
               windowitemType:< windowitem;
               theWindowitem: ^windowitemType;
               data: ^parameters;
               
               showInfoDialog:
                 (# <<SLOT GraphicalEditorWindowItemEditorShowInfoDialog: doPart>> #);
               
               codeDialog: ^codeDialogType;
               showCodeDialog:
                 (# <<SLOT GraphicalEditorWindowItemEditorShowCodeDialog: doPart>> #);
               
               
               editAttributes:
                 (#  <<SLOT GraphicalEditorWindowItemEditorEditAttributes: doPart>> #);
               editVirtual:
                 (# name: ^text;
                 enter name[]
                 <<SLOT GraphicalEditorWindowItemEditorEditVirutal: doPart>>
                 #);
               
               init:<
                 (# theAttribute: ^astInterface.beta.attributeDecl;
                 enter (owner[], theAttribute[], data[])
                 <<SLOT GraphicalEditorWindowItemEditorInit: doPart>>
                 #);
               new:< 
                 (# type: @integer;
                    newData:<
                      (# <<SLOT GraphicalEditorWindowItemEditorNewData: doPart>> #);
                    newNode:<
                      (# <<SLOT windowItemEditorNewNode: doPart>> #);
                 enter (owner[], type)
                 <<SLOT windowitemEditornew: doPart>> 
                 #);
               close:<
                 (# <<SLOT GraphicalEditorWindowItemEditorClose: doPart>> #);
               mousedown:<
                 (# done: @boolean;
                    theEvent: ^windowItem.eventHandler.mouseDown;
                 enter theEvent[]
                 <<SLOT windowitemEditorMousedown: doPart>>
                 #);
               select:
                 (# <<SLOT windowItemEditorSelect: doPart>> #);
               deSelect:
                 (# <<SLOT windowItemEditorDeSelect: doPart>> #);
               applyObjectData:<
                 (# 
                 <<SLOT IBwindowitemEditorapplyObjectData: doPart>>
                 #);
               findEditor:<
                 (# pt: @point;
                    ignoreEditor: ^windowItemEditor;
                    theEditor: ^windowItemEditor;
                 enter (pt, ignoreEditor[])
                 <<SLOT graphicalEditorWindowItemEditorFindEditor: doPart>>
                 exit theEditor[]
                 #);
               getPublicAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes;
                 <<SLOT windowItemEditorGetPublicAttributes: doPart>>
                 exit theAttributes[]
                 #);
               getPrivateAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes;
                 <<SLOT windowItemEditorGetPrivateAttributes: doPart>>
                 exit theAttributes[]
                 #);
               getMainAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes;
                 <<SLOT windowItemEditorGetMainAttributes: doPart>>
                 exit theAttributes[]
                 #);
               getMainNode:<
                 (# theNode: ^astInterface.beta.attributeDecl;
                 do node[] -> theNode[];
                    inner;
                 exit theNode[]
                 #);
               createTheWindowItem:<
                 (# initial: @boolean;
                 enter initial
                 <<SLOT GraphicalEdioterWindowItemEditorCreateWindowItem: doPart>> 
                 #);
               private: @<<SLOT windowitemEditorPrivate: descriptor>>;
            #);
          canvasEditor: windowitemEditor
            (# <<SLOT canvasEditorLib: attributes>>;
               children: @windowItemEditorList;
               newEditor:
                 (# type: @integer;
                    theEditor: ^windowitemEditor;
                 enter type
                 <<SLOT graphicalEditorNewEditor: doPart>>
                 exit theEditor[]
                 #);
               windowitemType::< canvas;
               getMainCanvas:<
                 (# theCanvas: ^canvas;
                 do theWindowItem[] -> theCanvas[];
                    inner;
                 exit theCanvas[]
                 #);
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorCanvasEditorNewData: doPart>> #);
                 <<SLOT canvasEditornew: doPart>> 
                 #);
               init::< (# <<SLOT canvasEditorInit: doPart>> #);
               close::<
                 (# <<SLOT GraphicalEditorCanvasEditorClose: doPart>> #);
               mousedown::< (# <<SLOT canvasEditorMousedown: doPart>> #);
               applyObjectData::<
                 (# 
                 <<SLOT IBcanvasEditorapplyObjectData: doPart>>
                 #);
               findEditor:: (# <<SLOT graphicalEditorCanvasEditorFindEditor: doPart>> #);
               private: @<<SLOT canvasEditorPrivate: descriptor>>;
               createTheWindowItem::<
                 (# <<SLOT GraphicalEditorCanvasEditorCreateTheWindowItem: doPart>> #);
            #);
          abstractScrollerEditor: canvasEditor
            (# 
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorAbstractScrollerEditorNewData: doPart>> #);
                 <<SLOT abstractScrollerEditornew: doPart>> 
                 #);
            #);
          scrollerEditor: abstractScrollerEditor
            (# 
               windowitemType::< scroller;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorScrollerEditorNewData: doPart>> #);
                 <<SLOT scrollerEditornew: doPart>> 
                 #);
               getMainAttributes::<
                 (# <<SLOT scrollerEditorGetMainAttributes: doPart>> #);
               getMainNode::<
                 (# <<SLOT ScrollerEditorGetMainNode: doPart>> #);
               getMainCanvas::<
                 (# <<SLOT ScrollerEditorGetMainCanvas: doPart>> #);
               createTheWindowItem::<
                 (# <<SLOT GraphicalEditorScrollerEditorCreateTheWindowItem: doPart>> #);
            #);
          textEditorEditor: abstractScrollerEditor
            (# 
               windowitemType::< textEditorPict;
               init::<
                 (# <<SLOT GraphicalEditorTextEditorEditorInit: doPart>> #);
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorTextEditorEditorNewData: doPart>> #); 
                 <<SLOT textEditorEditornew: doPart>> 
                 #);
               createTheWindowItem::<
                 (# <<SLOT GraphicalEditorTextEditorEditorCreateTheWindowItem: doPart>> #);
            #);
          separatorEditor: windowItemEditor
            (# windowitemType::< separator;
               
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorSeparatorEditorNewData: doPart>> #); 
                 <<SLOT SeparatorEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBSeparatorApplyObjectData: doPart>>
                 #);
            #);
          controlEditor: windowitemEditor
            (# 
               windowitemType::< control;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorControlEditorNewData: doPart>> #); 
                 <<SLOT controlEditornew: doPart>>
                 #);
            #);
          buttonEditor: controlEditor
            (# windowitemType::< button;
               
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorButtonEditorNewData: doPart>> #); 
                 <<SLOT buttonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBbuttonApplyObjectData: doPart>>
                 #);
            #);
          pushButtonEditor: buttonEditor
            (# 
               windowitemType::< pushButton;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorPushButtonEditorNewData: doPart>> #); 
                 <<SLOT pushButtonEditornew: doPart>> 
                 #);
            #);
          iconButtonEditor: buttonEditor
            (# 
               windowitemType::< iconButton;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorIconButtonEditorNewData: doPart>> #); 
                 <<SLOT iconButtonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBiconButtonapplyObjectData: doPart>>
                 #);
            #);
          optionButtonEditor: buttonEditor
            (# 
               windowitemType::< optionButton;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorOptionButtonEditorNewData: doPart>> #); 
                 <<SLOT optionButtonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBoptionButtonapplyObjectData: doPart>>
                 #);
            #);
          staticTextEditor: buttonEditor
            (# 
               windowitemType::< staticText;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorStaticTextEditorNewData: doPart>> #); 
                 <<SLOT staticTextEditornew: doPart>> 
                 #);
            #);
          toggleButtonEditor: buttonEditor
            (# 
               windowitemType::< toggleButton;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorToggleButtonEditorNewData: doPart>> #);
                 <<SLOT toggleButtonEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBtoggleButtonapplyObjectData: doPart>>
                 #);
            #);
          radioButtonEditor: toggleButtonEditor
            (# 
               windowitemType::< radioButton;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorRadioButtonEditorNewData: doPart>> #);
                 <<SLOT radioButtonEditornew: doPart>> 
                 #);
            #);
          checkBoxEditor: toggleButtonEditor
            (# 
               windowitemType::< checkBox;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorCheckBoxEditorNewData: doPart>> #);
                 <<SLOT checkBoxEditornew: doPart>> 
                 #);
            #);
          scrollbarEditor: controlEditor
            (# 
               windowitemType::< scrollbar;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorScrollBarEditorNewData: doPart>> #);
                 <<SLOT scrollbarEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBscrollBarapplyObjectData: doPart>>
                 #);
            #);
          editTextEditor: controlEditor
            (# 
               windowitemType::< editText;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorEditTextEditorNewData: doPart>> #);
                 <<SLOT editTextEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBeditTextapplyObjectData: doPart>>
                 #);
            #);
          textFieldEditor: windowitemEditor
            (# 
               windowitemType::< textField;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorTextFieldEditorNewData: doPart>> #);
                 <<SLOT textFieldEditornew: doPart>> 
                 #);
            #);
          scrollListEditor: windowitemEditor
            (# 
               windowitemType::< textEditorPict;
               new::< 
                 (# newData::< (# <<SLOT GraphicalEditorScrollListEditorNewData: doPart>> #);
                 <<SLOT scrollListEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (#
                 <<SLOT IBscrollListapplyObjectData: doPart>>
                 #);
            #);
          textScrollListEditor: windowitemEditor
            (# 
               windowitemType::< textEditorPict;
               new::< 
                 (#  newData::< (# <<SLOT GraphicalEditorTextScrollListEditorNewData: doPart>> #);
                 <<SLOT textScrollListEditornew: doPart>> 
                 #);
               applyObjectData::<
                 (# 
                 <<SLOT IBtextScrollListapplyObjectData: doPart>>
                 #);
            #);
          
          (* 
           * Mode
           *)
          
          selectMode: (# exit 1 #);
          hierarkiMode: (# exit 2 #);
          resizeMode: (# exit 3 #);
          
          mode:
            (# value: @integer;
            enter (# enter value <<SLOT graphicalEditorEnterMode: doPart>> #)
            exit (# <<SLOT graphicalEditorExitMode: doPart>>  exit value #)
            #);
          (*
           * Init
           *)
          
          init:<
            (#
            enter node[]
            <<SLOT GraphicalEditorInit: doPart>>
            #);
          new:<
            (# 
            enter node[]
            <<SLOT GraphicalEditorNew: doPart>>
            #);
          
          (*
           * Selection
           *)
          
          
          canUndo: booleanValue
            (# <<SLOT graphicalEditorCanUndo: doPart>> #);
          undo:
            (# 
            <<SLOT graphicalEditorUndo: doPart>>
            #);
          undoText:
            (# value: ^text;
            <<SLOT graphicalEditorUndoText: doPart>>
            exit value[]
            #);
          canRedo: booleanValue
            (# <<SLOT graphicalEditorCanRedo: doPart>> #);
          redo:
            (# 
            <<SLOT graphicalEditorRedo: doPart>>
            #);
          redoText:
            (# value: ^text;
            <<SLOT graphicalEditorRedoText: doPart>>
            exit value[]
            #);
          canPaste: booleanValue
            (# 
            <<SLOT graphicalEditorCanPaste: doPart>>
            #);
          paste:
            (# 
            <<SLOT graphicalEditorPaste: doPart>>
            #);
          showCode:
            (# <<SLOT graphicalEditorShowCode: doPart>> #);
          selection: @windowItemEditorList
            (# <<SLOT selectionLib: attributes>>;
               append::
                 (#
                 <<SLOT selectionAppend: doPart>>
                 #);
               prepend::
                 (# 
                 <<SLOT selectionPrepend: doPart>>
                 #);
               delete::
                 (#
                 <<SLOT selectionDelete: doPart>>
                 #);
               clear::
                 (# 
                 <<SLOT selectionClear: doPart>>
                 #);
               
               (* Actions *)
               deleteAll:
                 (# <<SLOT GraphicalEditorSelectionDelete: doPart>> #);
	       showInfo:
                 (# <<SLOT GraphicalEditorSelectionShowInfo: doPart>> #);
	       showCode:
                 (# <<SLOT GraphicalEditorSelectionShowCode: doPart>> #);
               fitToContents:
                 (# <<SLOT GraphicalEditorSelectionFitToContents: doPart>> #);
               alignLeft:
                 (# <<SLOT GraphicalEditorSelectionAlignLeft: doPart>> #);
               alignRight:
                 (# <<SLOT GraphicalEditorSelectionAlignRight: doPart>> #);
               alignTop:
                 (# <<SLOT GraphicalEditorSelectionAlignTop: doPart>> #);
               alignBottom:
                 (# <<SLOT GraphicalEditorSelectionAlignBottom: doPart>> #);
               alignHorCenter:
                 (# <<SLOT GraphicalEditorSelectionAlignHorCenter: doPart>> #);
               alignVerCenter:
                 (# <<SLOT GraphicalEditorSelectionAlignVerCenter: doPart>> #);
               showSpacingDialog:
                 (# <<SLOT GraphicalEditorSelectionShowSpacingDialog: doPart>> #);
               doCopy:
                 (# <<SLOT graphicalEditorSelectionDoCopy: doPart>> #);
               doCut:
                 (# <<SLOT graphicalEditorSelectionDoCut: doPart>> #);
            #);

          open::<
            (# width, height: @integer;
            enter (width, height)
            <<SLOT graphicalEditorOpen: doPart>> 
            #);
          close::<
            (# <<SLOT graphicalEditorClose: doPart>> #);
          eventHandler::<
            (# onMouseDown::<
                 (# <<SLOT graphicalEditorOnMouseDown: doPart>> #);
               onAboutToClose::<
                 (# <<SLOT graphicalEditorOnAboutToClose: doPart>> #);
            #);
          private: @<<SLOT graphicalEditorPrivateAttributes: descriptor>>;
       #);
     
     private: @<<SLOT graphicalEditorEnvPrivate: descriptor>>;
  #);

-- graphicalEditorLib: attributes --


textEditorPict: canvas
  (# <<SLOT textEditorPictLib: attributes>>;
     open::<
       (# <<SLOT textEditorPictOpen: doPart>> #);
     private: @<<SLOT textEditorPictPrivate: descriptor>>;
  #);

CodeDialogType: window
  (# <<SLOT CodeDialogTypeLib: attributes>>;
     editor: ^windowItemEditor;
     updateFields:
       (# <<SLOT GraphicalEditorCodeDialogTypeUpdateFields: doPart>> #);
     open::<
       (#  <<SLOT GraphicalEditorCodeDialogTypeOpen: doPart>> #);
     close::<
       (# <<SLOT CodeDialogTypeClose: doPart>> #);
     private: @<<SLOT GraphicalEditorCodeDialogTypePrivate: descriptor>>;
     menubarVisible::< (# do false -> value #);
  #);

