ORIGIN '~beta/guienv/v1.6/guienvall';
INCLUDE '../resourcesupport/parameters'
        'dictionary'
        '../resourcesupport/easyinterface'
        '~beta/mps/v5.2/astlevel'
        '~beta/betaast/v5.2/betacfl'
        '../asteditor/asteditor'
        '../dialogs/textlist'
        '../fragmenthandler/fragmenthandler'
        '~beta/containers/v1.6/list'
        '~beta/containers/v1.6/sets'
        'editorwindow'
        '../support/draganddrop';
BODY 'private/graphicaleditorprivate';
-- lib: Attributes --
entryExists: booleanValue
  (# name: ^text;  enter name[] <<SLOT entryExistsBody:DoPart>> #);
entryReadable: booleanValue
  (# name: ^text; 
  enter name[]
  <<SLOT entryReadableBody:DoPart>>
  #);
entryWriteable:
 booleanValue
  (# name: ^text;  enter name[] <<SLOT entryWriteAbleBody:DoPart>> #);
  

-- guienvLib: Attributes --
displayMessage:
  (# msg: ^text;  enter msg[] do (none ,msg[],'Alert')->noteUser;  #);
graphicalEditorEnv:
  (#
     <<SLOT graphicalEditorEnvLib:Attributes>>;
     dynamicCompilationAvailable:< booleanValue
       (#
       do INNER;
       #);
     evaluateFile:<
       (#
          name: ^text;
          theOrigin: ^object;
          P: ##object;
          
       enter (name[],theOrigin[])
       do INNER ; 
       exit P##
       #);
     makeFragmentForm:
       (#
          frag:
            ^astInterface.fragmentForm;
          
       do betaGram[]->mps.newFragmentForm->frag[]; 
       exit frag[]
       #);
     platform: integerValue (#  <<SLOT graphicalEditorPlatform:DoPart>> #);
     winnt: (#  exit 1 #);
     mac: (#  exit 2 #);
     X11: (#  exit 3 #);
     attributeList: list
       (#
          element::
           betaGram.attributeDecl;
          
       #);
     imperativeList: list
       (# element:: betaGram.imp; 
       #);
     checkIdentifier: booleanValue
       (#
          name: ^text;
          frag:
            ^astInterface.fragmentForm;
          nameDecl:
            ^astInterface.beta.nameDcl;
          
       enter name[]
       <<SLOT checkIdentifierDoPart:DoPart>>
       #);
     createSourceFile:<
       (#
          fileName,fragName: ^text;
          group: ^astInterface.fragmentGroup;
          frag: ^astInterface.fragmentForm;
          
       enter (fileName[],fragName[])
       <<SLOT createSourceFile:DoPart>>
       exit frag[]
       #);
     prettyPrintGroup:<
       (#
          group: ^astInterface.fragmentGroup;
          name: ^text
       enter (group[],name[])
       do INNER
       #);
     createNewWindow:
       (# name: ^text
       enter name[]
       <<SLOT createNewWindow:DoPart>>
       #);
     createWindow:
       (# frag: ^astInterface.fragmentForm; name,className: ^text; 
       enter (frag[],name[],className[])
       <<SLOT friggApplicationCreateWindow:DoPart>>
       #);
     MPS: ^astInterface;
     betaGram: ^astInterface.beta;
     pretty: ^astInterface.prettyPrinter;
     astFileExists: booleanValue
       (# name: ^text;  enter name[] <<SLOT astFileExistsBody:DoPart>> #);
     astFileReadable: booleanValue
       (# name: ^text; 
       enter name[]
       <<SLOT astFileReadAbleBody:DoPart>>
       #);
     astFileWriteAble: booleanValue
       (# name: ^text; 
       enter name[]
       <<SLOT astFileWriteAbleBody:DoPart>>
       #);
     showParseErrors:<
       (# msg: ^text; 
       enter msg[]
       do INNER ; 
       #);
     autoSaveGroup:<
       (#
          fg: ^astInterface.fragmentGroup; 
       enter fg[]
       do INNER ; 
       #);
     theAstEditorEnv: @astEditorEnv
       (#
          showParseErrors::< 
            (# 
            do
               msg[]
                 ->
                   THIS(graphicalEditorEnv).
                     showParseErrors;
               
            #);
          
       #);
     openAstEditorMethod:
       (# node: ^astInterface.AST; title: ^text; 
       enter (node[],title[])
       do INNER ; 
       #);
     openSeparateAstEditorMethod: openAstEditorMethod
       (#  <<SLOT graphicalEditorEnvOpenSeparateAstEditorMethod:DoPart>> #);
     openAstEditor:< openAstEditorMethod;
     onGroupOpen:<
       (# fg: ^astInterface.fragmentGroup;  enter fg[] do INNER ;  #);
     onGroupChanged:<
       (# fg: ^astInterface.fragmentGroup;  enter fg[] do INNER ;  #);
     onGroupSaved:<
       (# fg: ^astInterface.fragmentGroup;  enter fg[] do INNER ;  #);
     saveFragmentGroup:<
       (# fg: ^astInterface.fragmentGroup;  enter fg[] do INNER ;  #);
     quitApplication:<
       (# do INNER #);
     theFragServer: ^fragmentServer;
     init:<
       (# 
       enter (theFragServer[],MPS[],betaGram[],pretty[])
       <<SLOT graphicalEditorEnvInit:DoPart>>
       #);
     find:
       (# node: ^astInterface.beta.attributeDecl; editor: ^graphicalEditor; 
       enter node[]
       <<SLOT graphicalEditorEnvFind:DoPart>>
       exit editor[]
       #);
     classData:
       (#
          theAttributes: ^attributeList;
          theImperatives:
            ^imperativeList;
          node:
            ^astInterface.beta.
               attributeDecl;
          superClassData: ^classData;
          className: ^text;
          vertical: @boolean;
          init:
            (# group: ^astInterface.fragmentGroup; 
            enter (node[],group[])
            <<SLOT classDataInit:DoPart>>
            #);
          
       #);
     getClassData:
       (#
          node: ^astInterface.beta.attributeDecl;
          theClassData: ^classData;
          
       enter node[]
       <<SLOT getClassDataDoPart:DoPart>>
       exit theClassData[]
       #);
     instantiator:
       (#
          <<SLOT instantiatorLib:Attributes>>;
          init:<
            (# 
            <<SLOT instantiatorInit:DoPart>>
            #);
          copyName:
            (# newName: ^text; copy: ^instantiator
            enter newName[]
            <<SLOT instantiatorCopyName:DoPart>>
            exit copy[]
            #);
          scanAttributes:
            (#
               whenPartObject:<
                 (#
                    current:
                      ^astInterface.beta.
                         attributeDecl
                 enter current[]
                 do INNER
                 #)
            <<SLOT instantiatorScanAttributes:DoPart>>
            #);
          theGraphicalEditor:
            ^graphicalEditor;
          editorType:< theGraphicalEditor.windowItemEditor;
          theWindowItemEditor: ^editorType;
          name: ^text;
          grouping: ^text;
          node: ^astInterface.beta.patternDecl;
          path: ^text;
          icon: ^pixmap;
          width,height: @integer;
          scripts: ^textList;
          
       enter theGraphicalEditor[]
       do &editorType[]->theWindowItemEditor[]; none ->theGraphicalEditor[]; 
       exit theWindowItemEditor[]
       #);
     factory:
       (#
          insert:
            (#
               name: ^text;
               grouping: ^text;
               inst: ^instantiator;
               icon: ^pixmap;
               scripts: ^textList;
               path: ^text;
               width,height: @integer;
               
            enter (icon[],name[],inst[],path[],grouping[],width,height)
            do
               name[]->inst.name[];
               icon[]->inst.icon[];
               path[]->inst.path[];
               grouping[]->inst.grouping[];
               width->inst.width;
               height->inst.height;
               inst.init;
               (name[],inst[])->insts.define;
               
            #);
          scan:
            (# current: ^instantiator
            do
               insts.storage.scan
                 (#  do current.elm[]->THIS(scan).current[]; INNER scan #)
            #);
          instantiate:
            (#
               theGraphicalEditor: ^graphicalEditor;
               name: ^text;
               theWindowItemEditor: ^graphicalEditor.windowItemEditor;
               
            enter (theGraphicalEditor[],name[])
            <<SLOT factoryInstantiate:DoPart>>
            exit theWindowItemEditor[]
            #);
          defined: booleanValue
            (# name: ^text;  enter name[] <<SLOT factoryDefined:DoPart>> #);
          lookup:
            (# name: ^text; theInstantiator: ^instantiator; 
            enter name[]
            <<SLOT factoryLookup:DoPart>>
            exit theInstantiator[]
            #);
          init:
            (#  <<SLOT factoryInit:DoPart>> #);
          insts:
            @dictionary (# element:: instantiator;  #);
          
       #);
     graphicalEditor: editorWindow
       (#
          <<SLOT graphicalEditorLib:Attributes>>;
          readOnly: @boolean;
          menubarType::< 
            (#
               open::< 
                 (# 
                 <<SLOT InterfaceBuilderGraphicalEditorWindowMenubarOpen:DoPart>>
                 #);
               
            #);
          mousedownInItem:: 
            (#  <<SLOT graphicalEditorMousedownInItem:DoPart>> #);
          (*
           * theDocument: ^document;
           *)
          node: ^astInterface.beta.attributeDecl;
          privateAttributes:
            (# value: @boolean
            enter
              (# 
              enter value
              <<SLOT GraphicalEditorEnterPrivateAttributes:DoPart>>
              #)
            exit
              (# 
              <<SLOT GraphicalEditorExitPrivateAttributes:DoPart>>
              exit value
              #)
            #);
          privateDoParts:
            (# value: @boolean
            enter
              (# 
              enter value
              <<SLOT GraphicalEditorEnterPrivateDoParts:DoPart>>
              #)
            exit
              (# 
              <<SLOT GraphicalEditorExitPrivateDoPart:DoPart>>
              exit value
              #)
            #);
          (* astControl: @astController
           *             (# 
           *                onReplaced::<
           *                  (# <<SLOT GraphicalEditorAstControlReplaced: doPart>> #);
           *             #);
           *)
          windowItemEditorList: sequence
            (#
               element:: windowItemEditor;
               copy:
                 (# theCopy: ^windowItemEditorList; 
                 <<SLOT windowItemEditorListCopy:DoPart>>
                 exit theCopy[]
                 #);
               set:
                 (#
                    theOther:
                      ^windowItemEditorList;
                    
                 enter theOther[]
                 <<SLOT windowItemEditorListSet:DoPart>>
                 #);
               
            #);
          windowitemEditor:
            (#
               <<SLOT windowitemEditorLib:Attributes>>;
               node: ^astInterface.beta.attributeDecl;
               className: ^text;
               owner: ^canvasEditor;
               windowitemType:< windowitem;
               theWindowitem: ^windowitemType;
               accept:< booleanValue
                 (# dragee: ^proxy enter dragee[] do INNER #);
               recieve:<
                 (# dragee: ^proxy; bounds: ^rectangle; 
                 enter (bounds[],dragee[])
                 do INNER ; 
                 #);
               wrapper: reciever
                 (#
                    drageeType:: proxy;
                    hilite::  (#  <<SLOT wrapperHilite:DoPart>> #);
                    lowlite:: 
                      (# 
                      <<SLOT wrapperLowlite:DoPart>>
                      #);
                    accept:: 
                      (# 
                      do dragee[]->THIS(windowItemEditor).accept->value
                      #);
                    recieve:: 
                      (# 
                      do (bounds[],dragee[])->THIS(windowItemEditor).recieve
                      #);
                    eventHandler::< 
                      (#
                         handlingChildFrameChanged: @boolean;
                         onFrameChanged::< 
                           (# 
                           do
                              (if not handlingChildFrameChanged then
                                  size->theWindowItem.size
                              if)
                           #);
                         onChildFrameChanged::< 
                           (# 
                           do
                              true->handlingChildFrameChanged;
                              theWindowItem.size->size;
                              false->handlingChildFrameChanged
                           #)
                      #)
                 #);
               item: ^wrapper;
               vertical: @boolean;
               defaultData,data: ^parameters;
               theClassData: ^classData;
               privateFrag: ^astInterface.fragmentForm;
               showInfoDialog:
                 (# 
                 <<SLOT GraphicalEditorWindowItemEditorShowInfoDialog:DoPart>>
                 #);
               editAttributes:
                 (# 
                 <<SLOT GraphicalEditorWindowItemEditorEditAttributes:DoPart>>
                 #);
               editVirtual:
                 (# name: ^text; 
                 enter name[]
                 <<SLOT GraphicalEditorWindowItemEditorEditVirtual:DoPart>>
                 #);
               init:<
                 (#
                    inherited: @boolean;
                    initialize:<
                      (# done: @boolean; 
                      <<SLOT windowItemEditorInitialize:DoPart>>
                      #);
                    
                 enter
                 (owner[],node[],
                  data[],inherited,theClassData[],privateFrag[])
                 <<SLOT GraphicalEditorWindowItemEditorInit:DoPart>>
                 #);
               newData:<
                 (# data: ^parameters; name: ^text; 
                 enter name[]
                 <<SLOT GraphicalEditorWindowItemEditorNewData:DoPart>>
                 exit data[]
                 #);
               createInitImps:<
                 (#
                    frag: ^astInterface.fragmentForm;
                    initImps: ^astInterface.beta.imperatives;
                    override:< booleanValue;
                    
                 enter frag[]
                 <<SLOT GraphicalEditorWindowItemEditorCreateInitImps:DoPart>>
                 exit initImps[]
                 #);
               createOpen:<
                 (# newImps: ^astInterface.beta.imperatives; 
                 <<SLOT windowItemEditorCreateOpen:DoPart>>
                 #);
               new:<
                 (#
                    newNode:<
                      (# 
                      <<SLOT windowItemEditorNewNode:DoPart>>
                      #);
                    
                 enter (owner[],className[],theClassData[])
                 <<SLOT windowitemEditornew:DoPart>>
                 #);
               initDopart:<
                 (# theDoPart: ^astInterface.beta.doPart
                 enter theDoPart[]
                 <<SLOT windowItemEditorInitDopart:DoPart>>
                 #);
               close:<
                 (# 
                 <<SLOT GraphicalEditorWindowItemEditorClose:DoPart>>
                 #);
               mousedown:<
                 (#
                    done: @boolean;
                    theEvent: ^windowItem.eventHandler.mouseDown;
                    pt: @point;
                    
                 enter (theEvent[],pt)
                 <<SLOT windowitemEditorMousedown:DoPart>>
                 #);
               select: (#  <<SLOT windowItemEditorSelect:DoPart>> #);
               deSelect: (#  <<SLOT windowItemEditorDeSelect:DoPart>> #);
               applyObjectData:<
                 (# 
                 <<SLOT IBwindowitemEditorapplyObjectData:DoPart>>
                 #);
               findEditor:<
                 (#
                    pt: @point;
                    ignoreEditor: ^windowItemEditor;
                    theEditor: ^windowItemEditor;
                    
                 enter (pt,ignoreEditor[])
                 <<SLOT graphicalEditorWindowItemEditorFindEditor:DoPart>>
                 exit theEditor[]
                 #);
               getPublicAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes; 
                 <<SLOT windowItemEditorGetPublicAttributes:DoPart>>
                 exit
                 theAttributes[]
                 #);
               getPrivateAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes; 
                 <<SLOT windowItemEditorGetPrivateAttributes:DoPart>>
                 exit
                 theAttributes[]
                 #);
               getMainAttributes:<
                 (# theAttributes: ^astInterface.beta.attributes; 
                 <<SLOT windowItemEditorGetMainAttributes:DoPart>>
                 exit
                 theAttributes[]
                 #);
               getMainNode:<
                 (# theNode: ^astInterface.beta.attributeDecl; 
                 do node[]->theNode[]; INNER ; 
                 exit theNode[]
                 #);
               outline:< booleanValue
                 (#  <<SLOT windowItemEditorOutline:DoPart>> #);
               createTheWindowItem:<
                 (# initial: @boolean; 
                 enter initial
                 <<SLOT GraphicalEdioterWindowItemEditorCreateWindowItem:DoPart>>
                 #);
               makeDelegateMousedownAction:
                 (# aWindowItem: ^windowItem; enclosing: ^windowItemEditor; 
                 enter (aWindowItem[],enclosing[])
                 <<SLOT makeDelegateMousedownAction:DoPart>>
                 #);
                 
               hasBorder:< booleanValue (# do true -> value; inner #);
               hasBindings:< booleanValue (# do true -> value; inner #);
               private: @<<SLOT windowitemEditorPrivate:Descriptor>>;
               
            #);
          canvasEditor: windowitemEditor
            (#
               <<SLOT canvasEditorLib:Attributes>>;
               children:
                 @windowItemEditorList;
               locked: @boolean;
               newEditor:
                 (#
                    theEditor: ^windowitemEditor;
                    theClassData: ^classData;
                    className: ^text;
                    
                 enter (theClassData[],className[])
                 <<SLOT graphicalEditorNewEditor:DoPart>>
                 exit theEditor[]
                 #);
               windowitemType::< canvas;
               getMainCanvas:<
                 (# theCanvas: ^canvas; 
                 do theWindowItem[]->theCanvas[]; INNER ; 
                 exit theCanvas[]
                 #);
               newData::< 
                 (#  <<SLOT GraphicalEditorCanvasEditorNewData:DoPart>> #);
               new::< 
                 (# 
                 <<SLOT canvasEditornew:DoPart>>
                 #);
               init::< 
                 (#
                    initialize::< 
                      (#  <<SLOT canvasEditorInitialize:DoPart>> #);
                    
                 <<SLOT canvasEditorInit:DoPart>>
                 #);
               close::< 
                 (#  <<SLOT GraphicalEditorCanvasEditorClose:DoPart>> #);
               mousedown::< 
                 (# 
                 <<SLOT canvasEditorMousedown:DoPart>>
                 #);
               applyObjectData::< 
                 (#  <<SLOT IBcanvasEditorapplyObjectData:DoPart>> #);
               findEditor:: 
                 (# 
                 <<SLOT graphicalEditorCanvasEditorFindEditor:DoPart>>
                 #);
               private: @<<SLOT canvasEditorPrivate:Descriptor>>;
               createTheWindowItem::< 
                 (# 
                 <<SLOT GraphicalEditorCanvasEditorCreateTheWindowItem:DoPart>>
                 #);
               accept::  (#  <<SLOT recievingCanvasEditorAccept:DoPart>> #);
               recieve:: 
                 (# 
                 <<SLOT recievingCanvasEditorRecieve:DoPart>>
                 #);
               createOpen::<  (#  <<SLOT CanvasEditorCreateOpen:DoPart>> #)
            #);
          proxy:
            (#
               palette: @boolean;
               moveTo:<
                 (#
                    theCanvasEditor:
                      ^canvasEditor;
                    newFrame: ^rectangle;
                    
                 enter (theCanvasEditor[],newFrame[])
                 do INNER ; 
                 #);
               
            #);
          windowEditor: canvasEditor
            (#
               newData::<  (#  <<SLOT windowEditorNewData:DoPart>> #);
               applyObjectData::< 
                 (# 
                 <<SLOT windowEditorApplyObjectData:DoPart>>
                 #);
               hasBorder::< (# do false -> value; inner #);
               hasBindings::< (# do false -> value; inner #);
               
            #);
          (* 
           * Mode
           *)
          selectMode: (#  exit 1 #);
          hierarkiMode: (#  exit 2 #);
          resizeMode: (#  exit 3 #);
          mode:
            (# value: @integer; 
            enter
              (#  enter value <<SLOT graphicalEditorEnterMode:DoPart>> #)
            exit
              (# 
              <<SLOT graphicalEditorExitMode:DoPart>>
              exit value
              #)
            #);
          (*
           * Init
           *)
          init:< (#  enter node[] <<SLOT GraphicalEditorInit:DoPart>> #);
          new:<
            (# 
            enter node[]
            <<SLOT GraphicalEditorNew:DoPart>>
            #);
          (*
           * Selection
           *)
          canUndo: booleanValue
            (#  <<SLOT graphicalEditorCanUndo:DoPart>> #);
          undo:
            (# 
            <<SLOT graphicalEditorUndo:DoPart>>
            #);
          undoText:
            (# value: ^text; 
            <<SLOT graphicalEditorUndoText:DoPart>>
            exit value[]
            #);
          canRedo: booleanValue
            (# 
            <<SLOT graphicalEditorCanRedo:DoPart>>
            #);
          redo: (#  <<SLOT graphicalEditorRedo:DoPart>> #);
          redoText:
            (# value: ^text; 
            <<SLOT graphicalEditorRedoText:DoPart>>
            exit value[]
            #);
          canPaste: booleanValue
            (#  <<SLOT graphicalEditorCanPaste:DoPart>> #);
          paste:
            (# 
            <<SLOT graphicalEditorPaste:DoPart>>
            #);
          selection: @windowItemEditorList
            (#
               <<SLOT selectionLib:Attributes>>;
               append:: 
                 (# 
                 <<SLOT selectionAppend:DoPart>>
                 #);
               prepend::  (#  <<SLOT selectionPrepend:DoPart>> #);
               delete:: 
                 (# 
                 <<SLOT selectionDelete:DoPart>>
                 #);
               clear::  (#  <<SLOT selectionClear:DoPart>> #);
               (* Actions *)
               deleteAll:
                 (# 
                 <<SLOT GraphicalEditorSelectionDelete:DoPart>>
                 #);
               showInfo:
                 (#  <<SLOT GraphicalEditorSelectionShowInfo:DoPart>> #);
               fitToContents:
                 (# 
                 <<SLOT GraphicalEditorSelectionFitToContents:DoPart>>
                 #);
               alignLeft:
                 (#  <<SLOT GraphicalEditorSelectionAlignLeft:DoPart>> #);
               alignRight:
                 (# 
                 <<SLOT GraphicalEditorSelectionAlignRight:DoPart>>
                 #);
               alignTop:
                 (#  <<SLOT GraphicalEditorSelectionAlignTop:DoPart>> #);
               alignBottom:
                 (# 
                 <<SLOT GraphicalEditorSelectionAlignBottom:DoPart>>
                 #);
               alignHorCenter:
                 (# 
                 <<SLOT GraphicalEditorSelectionAlignHorCenter:DoPart>>
                 #);
               alignVerCenter:
                 (# 
                 <<SLOT GraphicalEditorSelectionAlignVerCenter:DoPart>>
                 #);
               showSpacingDialog:
                 (# 
                 <<SLOT GraphicalEditorSelectionShowSpacingDialog:DoPart>>
                 #);
               changeColor:
                 (#  <<SLOT graphicalEditorChangeColor:DoPart>> #);
               doCopy:
                 (# 
                 <<SLOT graphicalEditorSelectionDoCopy:DoPart>>
                 #);
               doCut: (#  <<SLOT graphicalEditorSelectionDoCut:DoPart>> #);
               
            #);
          open::< 
            (# width,height: @integer; 
            enter (width,height)
            <<SLOT graphicalEditorOpen:DoPart>>
            #);
          close::< 
            (# 
            <<SLOT graphicalEditorClose:DoPart>>
            #);
          eventHandler::< 
            (#
               onMouseDown::< 
                 (#  <<SLOT graphicalEditorOnMouseDown:DoPart>> #);
               onAboutToClose::< 
                 (# 
                 <<SLOT graphicalEditorOnAboutToClose:DoPart>>
                 #);
               onActivate::< 
                 (#  <<SLOT graphicalEditorOnActivate:DoPart>> #);
               onDeactivate::< 
                 (# 
                 <<SLOT graphicalEditorOnDeactivate:DoPart>>
                 #)
            #);
          clearSelection:: 
            (#  <<SLOT graphicalEditorClearSelection:DoPart>> #);
          onSelectEntire::
            (# <<SLOT graphicalEditorOnSelectEntire: doPart>> #);
          private:
            @<<SLOT graphicalEditorPrivateAttributes:Descriptor>>;
          
       #);
     trace:
       (#
          xT: (# xT: ^text enter xT[] do xT[]->tracestream.putText #);
          xC: (# c: @char;  enter c do c->tracestream.put;  #);
          xI:
            (# n: @integer
            enter n
            do
               ' '->tracestream.put; n->tracestream.putint; ' '->tracestream.put
            #);
          xB:
            (# b: @boolean
            enter b
            do
               (if b then
                   ' true '->traceStream.puttext
                else
                   ' false '->traceStream.puttext
               if)
            #);
          xA:
            (# T: ^astInterface.AST; 
            enter T[]
            do
               (if T[] = none then
                   ' NONE '->traceStream.putText; 
                else
                   (T[],traceStream[])->pretty.printNode; 
               if);
               xN;
               
            #);
          xN: (#  do tracestream.newline #);
          xData:
            (# d: ^parameters
            enter d[]
            do
               d.data.storage.scan
                 (# 
                 do
                    current.key[]->xT;
                    (if current.value.type
                     // textType then
                        (current.value.asTextAtom).value[]->xT; xN
                     // boolType then
                        (current.value.asBoolAtom).value->xB; xN
                     // intType then
                        (current.value.asIntAtom).value->xI; xN
                    if)
                 #)
            #);
          no: @integer;
          
       enter no
       do (if switch[no] then Xn; '$'->xC; no->xI; ':'->xC; INNER ;  if); 
       #);
     traceStream: ^stream;
     switch: [255] @boolean;
     private: @<<SLOT graphicalEditorEnvPrivate:Descriptor>>;
     
  #);
  

-- graphicalEditorLib: Attributes --
textEditorPict: canvas
  (#
     <<SLOT textEditorPictLib:Attributes>>;
     open::< 
       (# 
       <<SLOT textEditorPictOpen:DoPart>>
       #);
     private: @<<SLOT textEditorPictPrivate:Descriptor>>;
     
  #);
verScrollbar: scrollbar
  (#
     vertical:: 
       (#  do true->value #);
     
  #);
verSeparator: separator
  (#
     vertical:: 
       (#  do true->value #);
     
  #);
  

