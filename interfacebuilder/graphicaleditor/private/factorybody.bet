ORIGIN '../graphicaleditor';
INCLUDE '../../guienvstuff/loadbitmap'
        '../../code/generate'
        '../icons'
        '../../code/match';
-- factoryInstantiate: DoPart --
do
     (# inst: ^instantiator; theName: ^text; 
     do
        name.copy->theName[];
        theName.makeLC;
        theName[]->insts.lookup->inst[];
        (if inst[] <> none then
            theGraphicalEditor[]->inst->theWindowItemEditor[]; 
        if);
        
     #);
     

-- factoryLookup: DoPart --
do name[]->insts.lookup->theInstantiator[]  

-- factoryDefined: DoPart --
do
     (# theName: ^text; 
     do
        name.copy->theName[];
        theName.makeLC;
        (theName[]->insts.lookup) <> none ->value;
        
     #)  

-- instantiatorLib: Attributes --
makeScripts:
  (# scripts: ^textList
  do &textList[]->scripts[]; scripts.init; INNER
  exit scripts[]
  #);
makeInterfaceObjectScripts: makeScripts
  (# 
  do
     'onMouseUp'->scripts.append;
     'onMouseDown'->scripts.append;
     'onKeyDown'->scripts.append;
     'onRefresh'->scripts.append;
     'onActivate'->scripts.append;
     'onDeactivate'->scripts.append;
     INNER
  #);
makeWindowScripts: makeInterfaceObjectScripts
  (#  do 'onAboutToClose'->scripts.append; INNER #);
makeWindowItemScripts: makeInterfaceObjectScripts
  (# 
  do
     'onFrameChanged'->scripts.append;
     'onFatherFrameChanged'->scripts.append;
     'onEnableTarget'->scripts.append;
     'onDisableTarget'->scripts.append;
     'onHiliteChanged'->scripts.append;
     'onVisibleChanged'->scripts.append;
     'onEnableChanged'->scripts.append;
     INNER
  #);
makeCanvasScripts: makeWindowItemScripts
  (#  do 'onChildFrameChanged'->scripts.append; INNER #)  

-- factoryInit: DoPart --
do insts.init;

-- instantiatorCopyName: DoPart --
do
     (# type: ##instantiator
     do
        THIS(instantiator)##->type##;
        &type[]->copy[];
        newName[]->copy.name[];
        none ->copy.path[];
        scripts[]->copy.scripts[];
        icon[]->copy.icon[];
        width->copy.width;
        height->copy.height
     #)  

-- instantiatorScanAttributes: DoPart --
do
     (#
        theAttributes: ^astInterface.beta.attributes;
        partObjectProto: ^astInterface.AST
     do
        5->trace (#  do 'instantiator.scanAttributes'->xT #);
        (if node[] <> none then
            node[]->betaGram.getAttributes->theAttributes[];
            (if theAttributes[] <> none then
                5->trace (#  do 'has attributes'->xT #);
                (makeFragmentForm,
                 '<<nameDcl>>: @ <<prefix>> (# <<attributes>> #)',
                 betaGram.simpleDecl)->parseText->partObjectProto[];
                theAttributes.newScan
                  (# 
                  do
                     5->trace (#  do '.'->xT #);
                     (if (mps[],current[],partObjectProto[])->match then
                         5->trace (#  do 'does match'->xT #);
                         current[]->whenPartObject
                     if)
                  #)
            if)
        if)
     #)  

-- instantiatorInit: DoPart --
do makeWindowItemScripts->scripts[]; INNER  

