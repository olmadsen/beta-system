ORIGIN '~beta/interfacebuilder/v1.0d/editorenv/editorenv';
INCLUDE 'graphicaleditor';
INCLUDE '~beta/interfacebuilder/v1.0d/code/generate';

-- program: descriptor --
editorEnv
(# 
   theGraphicalEditor: @graphicalEditor;
   fg: ^MPS.fragmentGroup;
   theObjectStore: @objectDataStore;
   theFile: @file;
do 
   theObjectStore.init;
   'guifile.gui' -> theFile.name;
   theFile.openRead;
   theFile[] -> theObjectStore.read;
   theFile.close;
   'Opening group objects' -> putLine;
   l: ('objects',screen[]) -> MPS.top.open 
   (# 
      startingParsing::< 
        (# 
        do 'Parsing...' -> putLine;
        #);
      astOverflow::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      fragmentNotExisting::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      grammarNotFound::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      badFormat::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      parseErrors::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      fatalParseError::<
        (# 
        do leave l;
           msg[] -> putLine;
        #);
      doubleFormDeclaration::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      readAccessError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      writeAccessError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      writeAccessOnLstFileError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      EOSError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      noSuchFileError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      fileExistsError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      noSpaceLeftError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
      otherFileError::<
        (# 
        do msg[] -> putLine;
           leave l;
        #);
   #)
     -> fg[];
   (if fg[]//none then
       'The group does not exist' -> putLine;
    else
       'Done' -> putLine;
       (# ff: ^MPS.fragmentForm;
          theAttributesForm: ^betaGram.attributesForm;
          theAttributes: ^betaGram.attributes;
          anAttribute: ^betaGram.attributeDecl;
          c: ^mps.comment;
       do
          ('windowLib',screen[]) -> fg.fragmentList.open -> ff[];
          (if ff[]<>None then
              ff.root.symbol -> putInt;
              newLine;
              ff.root[] -> theAttributesForm[];
              theAttributesForm.getAttributes -> theAttributes[];
              theObjectStore[] -> theGraphicalEditor.theObjectStore[];
              ('testCanvas','canvas',theAttributes[]) -> theGraphicalEditor.new;
          if);
       #);
   if);
   
   
#)
