ORIGIN '~beta/basiclib/basicsystemenv';
INCLUDE 'friggapplication'
        '~beta/guienv/guienvsystemenv'
        '~beta/compiler/DYN/dynlib'
        'graphicaleditor/loaderview'
        'dialogs/progressdialog'
        'additional/additional';
BODY '~beta/editor/private/nocompiler'
     '~beta/editor/private/nouser';
-- program: Descriptor --
systemenv
  (#
     frigg: @friggApplication
       (# 
          onStartApplication::
            (#
            do 
            #);
          theLoaderView: @loaderView;
          init:: 
            (# 
            do
               'frigg init'->putLine;
               (DC[],theGraphicalEditorEnv[])->theLoaderView.open;
               theGraphicalEditorEnv.insertAdditionalSuite;
               
            #);
          initializeDynamicCompiler:: 
            (#
               theProgressDialog: @progressDialog
                 (#
                    onStart::  (#  do 1->t.start;  #);
                    open:: 
                      (# 
                      do 'Initializing Compiler'->message; showModal; 
                      #);
                    
                 #);
               t: @timer
                 (#
                    action:: 
                      (#  do stop; DC.initDyn; theProgressDialog.close;  #);
                    
                 #);
               
            do theProgressDialog.open; 
            #);
          dynamicCompilationAvailable::  (#  do true->value;  #);
          evaluateFile:: 
            (# ok: @boolean; imp: ^imagePair; pt: @integer; 
            do
               'compiling '->putText;
               name[]->putLine;
               name[]->DC.compileAndLoad->(ok,imp[]);
               (if OK then
                   'it was ok'->putLine;
                   (if imp[] <> none then
                       'foo'->imp.namedOff->pt;
                       (theOrigin[],pt)->DC.makeStruc->P##;
                       
                    else
                       'but the imp was none'->putLine; 
                   if);
                   
               if);
               
            #);
          compilePattern:: 
            (#
               ok: @boolean;
               imp: ^imagePair;
               pt: @integer;
               fname: ^text;
               pname: ^text;
               
            do
               (node.frag.father).fullname->fname[];
               node[]->frigg.MPS.betacfl.getName->pname[];
               fname[]->DC.compileAndLoad->(ok,imp[]);
               (if OK then
                   (if imp[] <> none then
                       pname[]->imp.namedOff->pt;
                       (theOrigin[],pt)->DC.makeStruc->structure##;
                       
                   if);
                   
               if);
               
            #);
          compileFile:: 
            (#
               ok: @boolean;
               imp: ^imagePair;
               pt: @integer;
               fname: ^text;
               pname: ^text;
               
            do
               fname[]->DC.compileAndLoad->(ok,imp[]);
               (if OK then
                   (if imp[] <> none then
                       pname[]->imp.namedOff->pt;
                       (theOrigin[],pt)->DC.makeStruc->structure##;
                       
                   if);
                   
               if);
               
            #);
          
       do 'frigg dopart'->putLine
       #);
     DC: @frigg.MPS.AST.dynamicCompiler
       (#
          initDyn:: 
            (# thisExecutable: ^text; 
            do
               screen[]->info[];
               'Hello'->putLine;
               screen[]->traceStream[];
               (1->Arguments->thisExecutable[],screen[])->NT.dotsInit;
               (thisExecutable[],none )->DynamicTranslate;
               (* to initialize 
                * dependency graph *)
               
            #);
          
       #);
     setWindowEnv::  (#  do frigg[]->theWindowEnv[] #);
     
  do 'main dopart'->putLine
  #)  

