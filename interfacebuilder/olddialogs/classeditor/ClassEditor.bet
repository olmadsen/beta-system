ORIGIN '~michael/groupeditor/groupeditor';
BODY 	'private/ClassEditorBody';
[[
-- Include '~michael/asteditor/AstEditor'
-- GroupEditorLib: Attributes --

ClassKind: (# exit 1 #);
SingularKind: (# exit 2 #);

InterfaceObjectEditor:
	(# Node: ^BetaGram.AttributeDecl;
		
		Init:< 
			(# <<SLOT InterfaceObjectEditorInitLib: Attributes>>;
				theResource: @Integer; (* A Handle *)
				Offset: @Integer; (* The resource data read so far. *)
				CollectAttributesInfo:< BooleanObject;
				AttributeInfo:
					(# theAst: ^MPS.Ast;
						Inherited: @Boolean;
						ID: @Integer;
						ResourceName: ^Text;
					#);
				AttributeInfoList: @List
					(# Element::< AttributeInfo;
					#);
				ImperativeInfo:
					(# ID: @Integer;
					#);
				ImperativeInfoList: @List
					(# Element::< ImperativeInfo;
					#);
			enter Node[]
			do <<SLOT InterfaceObjectEditorInit: Descriptor>>;
			#);
		New:< 
			(# SuperClass,Name,ResourceName: ^Text;
				theAttributes: ^BetaGram.Attributes;
				Kind: @Integer; (* ClassKind or SingularKind *)
				ResourceID: @Integer;
			enter (SuperClass[],Name[],theAttributes[],Kind,ResourceName[],ResourceID)
			do <<SLOT InterfaceObjectEditorNew: Descriptor>>;
			#);
		Save:< 
			(# theResource: @Integer; (* A Handle *)
				Offset: @Integer; (* The resource data written so far. *)
			do Inner;
			#);
		EditAttributes:< 
			(#
			do <<SLOT InterfaceObjectEditorEditAttributes: Descriptor>>
			#);
		EditMethod:< 
			(# Name: ^Text;
			enter Name[] 
			do <<SLOT InterfaceObjectEditorEditMethod: Descriptor>> 
			#);
		EditLayout:< Object;
		GenerateOpen:< 
			(#
			do <<SLOT InterfaceObjectEditorGenerateOpen: Descriptor>>
			#);
		
		Privates: ^BetaGram.Attributes;
		FindPrivateAttributes:
			(#
			do <<SLOT InterfaceObjectEditorFindPrivateAttributes: Descriptor>>;
			#);
		DemandPrivateAttributes:
			(#
			do <<SLOT InterfaceObjectEditorDemandPrivateAttributes: Descriptor>>
			#);
		
		ResourceID:
			(# ID: @Integer
			do <<SLOT InterfaceObjectEditorGetResourceID: Descriptor>>
			exit ID
			#);
		ChangeResourceID:<
			(# OldID,NewID: @Integer;
				Changed: @Boolean;
			enter NewID
			do <<SLOT InterfaceObjectEditorChangeResourceID: Descriptor>>;
			exit Changed
			#);
		
		UpdateSlotNames:
			(* When the name of a node changes, the SlotNames
			 * should be updated whith this method.
			 *)
			(# 
			do <<SLOT InterfaceObjectEditorUpdateSlotNames: Descriptor>>;
			#);
		AddDescriptor:
			(* Adds a descriptor to the Attribute declaration, if
			 * it does not already have one.
			 *)
			(#
			do <<SLOT InterfaceObjectEditorAddDescriptor: Descriptor>>
			#);
		ResourceType:<
			(# theType: ^Text;
			do Inner
			exit theType
			#);
		
	#);

ClassEditor: InterfaceObjectEditor
	(* The contents in a ClassEditor is an ast, which is a
	 * subclass of the InterfaceObject class.
	 *)
	(# <<SLOT ClassEditorLib: Attributes>>;
		ClassAst:
			(#
			enter Node[]
			exit Node[]
			#);
		Group: ^MPS.FragmentGroup;	
			(* The fragmentgroup where ClassAst belongs. *)
		EditorWindowDesc:< Window
			(# Open::< (# do <<SLOT ClassEditorOpen: Descriptor>>; #);
				Close::< (# do <<SLOT ClassEditorClose: Descriptor>>; #);
				EventHandler::<
					(# AboutToClose::< (# do <<SLOT ClassEditorAboutToClose: Descriptor>>; #);
						Activate::< (# do <<SLOT ClassEditorActivate: Descriptor>>; #);
						Deactivate::< (# do <<SLOT ClassEditorDeactivate: Descriptor>> #);
					#);
				OpenHidden::< TrueObject;
				HasClose::< TrueObject;
			#);
		EditorWindow: @EditorWindowDesc;
		
		Init::<
			(#  CollectAttributesInfo::< TrueObject;
			do <<SLOT ClassEditorInit: Descriptor>>;
			#);
		Save::< 
			(* Save first parses all the asteditors. If this fails
			 * because of parse-errors, saving is aborted and false
			 * is returned.
			 *)
			(# DidSave: @Boolean
			do <<SLOT ClassEditorSave: Descriptor>>;
			exit DidSave
			#);
		New::<
			(# 
			do <<SLOT ClassEditorNew: Descriptor>>;
			#);
		EditAttributes::< (# do <<SLOT ClassEditorEditAttributes: Descriptor>> #);
		EditPrivateAttributes:< (# do <<SLOT ClassEditorEditPrivateAttributes: Descriptor>> #);
		EditMethod::< 
			(# 
			do <<SLOT ClassEditorEditMethod: Descriptor>> 
			#);
		GenerateOpen::<
			(# theImperatives: ^MPS.List;
			do <<SLOT ClassEditorGenerateOpen: Descriptor>> 
			#);
			
		InstanceEditor: InterfaceObjectEditor
			(# <<SLOT InstanceEditorLib: Attributes>>;
				Init::<
					(#
					do <<SLOT InstanceEditorInit: Descriptor>>;
					#);
				New::<
					(#
					do <<SLOT InstanceEditorNew: Descriptor>>;
					#);
				Save::< (# do <<SLOT InstanceEditorSave: Descriptor>> #);
				Delete:<
					(#
					do <<SLOT InstanceEditorDelete: Descriptor>>;
					#);
				EditAttributes::< (# do <<SLOT InstanceEditorEditAttributes: Descriptor>> #);
				EditMethod::< 
					(#
					do <<SLOT InstanceEditorEditMethod: Descriptor>> 
					#);
				GenerateOpen::<
					(# theImperatives: ^MPS.List;
					do <<SLOT InstanceEditorGenerateOpen: Descriptor>> 
					#);
				IsPrivate:
					(# Value: @Boolean;
					enter (# enter Value do <<SLOT InstanceEditorSetIsPrivate: Descriptor>> #)
					exit (# do <<SLOT InstanceEditorGetIsPrivate: Descriptor>> exit Value #)
					#);
				Inherited: @Boolean;
				MakePrivate:< (# do <<SLOT InstanceEditorMakePrivate: Descriptor>> #);
				MakePublic:< (# do <<SLOT InstanceEditorMakePublic: Descriptor>> #);
			#);
		InstanceEditorList: List
			(# <<SLOT InstanceEditorListLib: Attributes>>;
				Element::< InstanceEditor;
			#);
			
		ClassAstEditor: FormEditor
			(# Open::< (# do <<SLOT ClassAstEditorOpen: Descriptor>> #);
				Close::< (# do <<SLOT ClassAstEditorClose: Descriptor>> #);
				Parse::< (# do <<SLOT ClassAstEditorParse: Descriptor>> #);
				EventHandler::<
					(# Activate::< (# do <<SLOT ClassAstEditorActivate: Descriptor>> #);
						Deactivate::< (# do <<SLOT ClassAstEditorDeactivate: Descriptor>> #);
					#);
			#);
		AstEditors: @List
			(* List of AstEditors, whose contents is sub-asts of
			 * the contents of this(ClassEditor).
			 *)
			(# Element::< ClassAstEditor;
			#);
		
		FindEventHandler:
			(# theEventHandler,theAttributeDecl: ^MPS.Expanded;
			enter theAttributeDecl[]
			do <<SLOT ClassEditorFindEventHandler: Descriptor>>;
			exit theEventHandler[]
			#);
		DemandEventHandler: FindEventHandler
			(# 
			do <<SLOT ClassEditorDemandEventHandler: Descriptor>>;
			#);
		
		EditResourceID:< Object;
		ChangeResourceID::< (* Private *) (# do <<SLOT ClassEditorChangeResourceID: Descriptor>> #);
		
		PrivateDoParts,PrivateAttributes: @Boolean;
		ClassEditorPrivate: @<<SLOT ClassEditorPrivate: Descriptor>>;
	#);
	
--]]
