ORIGIN '~beta/guienv/v1.6/guienv';
INCLUDE '~beta/guienv/v1.6/private/datastructures/sequence'
        '~beta/guienv/v1.6/controls'
        '~beta/guienv/v1.6/graphics'
        '~beta/guienv/v1.6/utils/guienvadds';
-- windowLib: Attributes --
tabControl: canvas
  (#
     <<SLOT tabControlLib:Attributes>>;
     myPage: canvas
       (#
          name: ^text;
          myButton: @radioButton
            (#
               open:: 
                 (# 
                 do
                    (10,40)->position;
                    (70,18)->size;
                    'Highlight'->label;
                    
                 #);
               
            #);
          eventHandler:: 
            (#
               onRefresh:: 
                 (# 
                 do
                    graphics
                      (# 
                      do
                         (20,20)->moveTo;
                         (if name[] <> none
                          then
                             name[]->drawText; 
                         if);
                         
                      #);
                    
                 #);
               
            #);
          open::  (#  do True->border.visible; myButton.open;  #);
          
       #);
     makePage:
       (# name: ^text; thePage: ^myPage
       enter name[]
       do &myPage[]->thePage[]; thePage.open; name[]->thePage.name[]
       exit thePage[]
       #);
     add:
       (#
          theCanvas: ^canvas;
          theLabel: ^text;
          theIcon: ^pixmap;
          theTab: ^tab;
          
       enter (theCanvas[],theLabel[],theIcon[])
       do &tab[]->theTab[]; (theLabel[],theCanvas[])->theTab.init; 
       #);
     delete: (# theCanvas: ^canvas;  enter theCanvas[] do  #);
     open::< 
       (# create::<  (#  do  #); 
       do tabs.init; (461,333)->size; INNER ; 
       #);
     close::<  (#  do  #);
     select: (# theCanvas: ^canvas;  enter theCanvas[] do  #);
     onBeforeSelect:<
     (* Called when the selection is about to change;
      * Assign FALSE to allow to prevent the selection from changing.
      *) (# allow: @boolean;  do TRUE->allow; INNER ;  exit allow #);
     onSelect:< (* Called when the selection has been changed by the end user *)
     (# theCanvas: ^canvas;  enter theCanvas[] do INNER ;  #);
     selection:
       (# theCanvas: ^canvas; 
       enter (#  enter theCanvas[] do  #)
       exit (#  do  exit theCanvas[] #)
       #);
     eventHandler::< 
       (#
          onMouseUp::<  (#  do  #);
          onMouseDown::<  (#  do  #);
          onFatherFrameChanged::<  (#  do  #);
          onActivate::<  (#  do  #);
          
       #);
     tab:
       (#
          page: ^canvas;
          lab: ^text;
          init:
            (# width,height: @integer
            enter (lab[],page[])
            do
               THIS(tabControl)[]->tb.open;
               (0,20)->page.position;
               size->(width,height);
               (width,height-20)->page.size;
               THIS(tab)[]->tabs.append
            #);
          tb: @tabButton;
          tabButton: pushButton
            (#
               fitToContents:: 
                 (# width,height: @integer; 
                 do
                    label->(style).widthOfText->width;
                    (width+5,20)->size;
                    true->doneInInner
                 #);
               open:: 
                 (# width,height: @integer; 
                 do
                    lab[]->label;
                    fitToContents;
                    (currentPosition,0)->position;
                    size->(width,height);
                    currentPosition+width->currentPosition
                 #);
               eventHandler::< 
                 (# onMouseUp::<  (#  do page.bringToFront #) #)
            #);
          
       exit THIS(tab)[]
       #);
     currentPosition: @integer;
     tabs: @sequence (# element:: tab #);
     
  #)  

