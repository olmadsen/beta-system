ORIGIN 'tableview';

-- lib: attributes --


user:
	(# name: ^text;
		ID: @integer;
		kind: @integer;
	#);

guestKind: (# exit 1 #);
ownerKind: (# exit 2 #);
networkKind: (# exit 3 #);

userManager:
	(# lastID: @integer;
		
		
		addUser:
			(# name: ^text;
				kind: @integer;
				theUser: ^user;
			enter (name[], kind)
			do lastID + 1 -> lastID;
				&user[] -> theUser[];
				lastID -> theUser.ID;
				name[] -> theUser.name[];
				kind -> theUser.kind;
				theUser[] -> users.append;
			#);
			
		make:
			(# name: ^text;
			do ('Michael Lassen', ownerKind) -> addUser;
				('Guest', guestKind) -> addUser;
				('Ole Lehrmann', networkKind) -> addUser;
				('J¿gen Lindskov', networkKind) -> addUser;
				('Flemming Gram', networkKind) -> addUser;
				('Elmer Sandvad', networkKind) -> addUser;
				('Peter Andersen', networkKind) -> addUser;
				(for inx: 1000 repeat
					&text[] -> name[];
					'User ' -> name.putText;
					inx -> name.putInt;
					(name[], networkKind) -> addUser;
				for);
			#);
			
		users: @list
			(# element:: user;
			#);
	#);
	
-- windowLib: attributes --

userTable: tableView
	(# userIcon: @pixmap;
		theUserManager: ^userManager;
		kindColumn: @simpleColumn
			(# open::
					(#
					do 'Kind' -> title;
						100 -> width;
					#);
			#);
		idColumn: @simpleColumn
			(# open::
					(#
					do 'ID' -> title;
						50 -> width;
						alignRight -> alignment;
					#);
			#);
			
			
		tableItemType::
			(# theUser: ^user;
				open::
					(# txt: ^text;
					enter theUser[]
					do theUser.name[] -> mainText;
						&text[] -> txt[];
						theUser.ID -> txt.putInt;
						(idColumn[], txt[]) -> setColumnText;
						(if theUser.kind
							//ownerKind then
								(kindColumn[], 'Owner') -> setColumnText;
							//guestKind then
								(kindColumn[], 'Guest') -> setColumnText;
							//networkKind then
								(kindColumn[], 'Network') -> setColumnText;
								userIcon[] -> icon;
						if);
					#);
			#);
		init:
			(# item: ^tableItemType;
			enter theUserManager[]
			do theUserManager.users.scan
					(#
					do &tableItemType[] -> item[];
						current[] -> item.open;
						item[] -> append;
					#);
			#);
		open::
			(#
			do 'user' -> userIcon.read;
				'Name' -> mainColumn.title;
				200 -> mainColumn.width;
				kindColumn.open;
				kindColumn[] -> appendColumn;
				idColumn.open;
				idColumn[] -> appendColumn;
			#);
	#);
-- program: descriptor --
GUIenv
(# 

	w: @window
		(# theUserTable: @userTable
				(#
				#);
			theUserManager: @userManager;
			open::
				(#
				do theUserManager.make;
					theUserTable.open;
					theUserManager[] -> theUserTable.init;
					(10, 10) -> theUserTable.position;
					(600, 300) -> theUserTable.size;
					(620, 340) -> size;
					true -> theUserTable.bindRight;
					true -> theUserTable.bindBottom;
				#);
		#);	
do 
	w.open;
#)