ORIGIN '../recomputeslotchain';

-- FragmentFormRecomputeSlotChain: doPart --
do (# theExpanded: ^expanded;
      
   do 0 -> firstSlot;
      (if root.kind = kinds.interior then
          root[] -> theExpanded[];
          unExpanded -> theExpanded.suffixWalkForProd
          (# scanCat:: unExpanded;
             theSlot: ^slotDesc;
          do (if current.isSlot then
                 current.theSlot -> theSlot[];
                 firstSlot -> a[theSlot.index + offset.usage];
                 theSlot.index -> firstSlot;
             if);
          #);
      if);
   #);
