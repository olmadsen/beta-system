ORIGIN '~beta/mps/astlevel';

INCLUDE '~beta/betaast/betacfl';
INCLUDE '~beta/betaast/betasematt';
INCLUDE '~beta/mps/metagrammarcfl';
INCLUDE '~beta/mps/findgrammar';


-- lib: attributes --
astEnv: astInterface
(# defaultGrammarFinder::< findGrammar;
   gram: @beta;
   BetaGrammarName: 
     (# t: ^Text;
     do '~beta/grammars/beta/beta' -> t[];
     exit t[]
     #);
   BetaParserName: 
     (# t: ^Text;
     do '~beta/grammars/beta/beta' -> ExpandToFullPath -> t[];
        '-parser.btab' -> t.append;
     exit t[]
     #);
   MetaGrammarName: 
     (# t: ^Text;
     do '~beta/grammars/metagram/metagrammar' -> t[];fragmentMarkAsChangedBody:Descriptor>>
     exit t[]
     #);
   theMetaGrammar: @metaGrammar;
   
   
   g: ^fragmentGroup;
do theMetaGrammar[] -> grammarTable.insertMetaGrammar;
   (MetaGrammarName,screen[]) -> top.open -> g[];
   ('meta', screen[]) -> g.open -> g[];
   ('metagrammar', screen[]) -> g.open -> theMetaGrammar.grammarAst[];
   theMetaGrammar.Init;
   gram[] -> GrammarTable.Beta[];
   (BetaGrammarName,screen[]) -> Top.Open -> g[];
   ('meta', screen[]) -> g.open -> g[];
   ('beta', screen[]) -> g.open -> gram.grammarAst[];
   gram[] -> grammarTable.t[grammarTable.noOfKnownGrammars+1][];
   grammarTable.noOfKnownGrammars+1 -> grammarTable.noOfKnownGrammars;
   gram.init;
   BetaParserName -> gram.parser.Initialize;
   inner;
#)
