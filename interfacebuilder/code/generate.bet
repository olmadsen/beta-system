ORIGIN '~beta/betaast/v4.9.1/betacfl';
INCLUDE '~beta/sysutils/v1.4/objinterface';
BODY 'private/generatebody';
-- betaAttributes: attributes --

generate:
  (* Superpattern for all ast creating methods *)
  (# frag: ^fragmentForm;
     ASTtype:< AST;
     theAst: ^ASTtype;
     failure:< exception
       (# 
       do 'failed to create ast in call of ' -> msg.putText;
          this(generate)[] -> getPatternName -> msg.putText;
          inner;
       #);
  enter frag[]
  <<SLOT MPSDoGenerate: doPart>>
  exit theAst[]
  #);

newObjectDescriptor: generate
  (# ASTtype::< objectDescriptor;
     prefixName: ^text; (* prefix = none means empty *)
  enter prefixName[]
  <<SLOT MPSnewObjectDescriptor: doPart>>
  #);
newDescriptorForm: generate
  (# ASTtype::< descriptorForm;
     prefixName: ^text;
  enter prefixName[]
  <<SLOT MPSnewDescriptorForm: doPart>> 
  #);
newNameApl: generate
  (#  ASTtype::< nameApl;
     name: ^text;
  enter name[]
  <<SLOT MPSnewNameApl: doPart>>
  #);
newNameDcl: generate
  (# ASTtype::< nameDcl;
     name: ^text;
  enter name[]
  <<SLOT MPSnewNameDcl: doPart>>
  #);
newNames: generate
  (# ASTtype::< names;
     name: ^text;
  enter name[]
  <<SLOT MPSnewNames: doPart>>
  #);
newComment: generate
  (# ASTtype::< comment;
     theText: ^text;
  enter theText[]
  <<SLOT MPSnewComment: doPart>>
  #);

generateAttribute: generate
  (# name: ^text;
     prefixName: ^text;
     ASTtype::< attributeDecl;
  enter (name[],prefixName[])
  do inner
  #);
newStaticAttribute: generateAttribute
  (* returns a new attributeDecl like name: @prefix  *)
  (# ASTtype::< simpleDecl;
  <<SLOT MPSnewStaticAttribute: doPart>>
  #);
newSingularItem: generateAttribute
  (* returns a new attributeDecl like name: @prefix (#  #) *)
  (# ASTtype::< simpleDecl;
  <<SLOT MPSnewSingularItem: doPart>>
  #);
newVirtualDefinition: generateAttribute
  (* returns a new attribute like name :< [prefix] (# #);  *)
  (# ASTtype::< virtualDecl;
  <<SLOT MPSnewVirtualDefinition: doPart>>
  #);
newVirtualBinding: generateAttribute
  (* returns a new attributeDecl like name ::< [prefix] (#  #)  *)
  (# ASTtype::< bindingDecl;
  <<SLOT MPSnewVirtualBinding: doPart>>
  #);
newPatternAttribute: generateAttribute
  (# ASTtype::< patternDecl;
  <<SLOT MPSnewPatternAttribute: doPart>>
  #);

find:
  (# name: ^text;
     theAttributes: ^attributes;
     theAttributeDecl: ^attributeDecl;
  enter (theAttributes[],name[])
  <<SLOT MPSfind: doPart>>
  exit theAttributeDecl[]
  #);

manipulateAttribute:
  (# theAttributeDecl: ^AttributeDecl;
     failure:< exception;
  enter theAttributeDecl[]
  do inner;
  #);
appendAttribute: manipulateAttribute
  (# theAttribute: ^AttributeDecl;
  enter theAttribute[]
  <<SLOT MPSappendAttribute: doPart>>
  #);
setObjectDescriptor: manipulateAttribute
  (# theObjectDescriptor: ^objectDescriptor;
  enter theObjectDescriptor[]
  <<SLOT MPSsetObjectDescriptor: doPart>>
  #);
getObjectDescriptor: manipulateAttribute
  (# theObjectDescriptor: ^objectDescriptor;
  <<SLOT MPSgetObjectDescriptor: doPart>>
  exit theObjectDescriptor[]
  #);
setName: manipulateAttribute
  (# name: ^text;
  enter name[]
  <<SLOT MPSAttributeSetName: doPart>>
  #);
getName: manipulateAttribute
  (# name: ^text;
  <<SLOT MPSAttributeGetName: doPart>>
  exit name[]
  #);
setPrefix: manipulateAttribute
  (# prefixName: ^text;
  enter prefixName[]
  <<SLOT MPSAttributeSetPrefix: doPart>>
  #);
getPrefix: manipulateAttribute
  (# prefixName: ^text;
  <<SLOT MPSAttributeGetPrefix: doPart>>
  exit prefixName[]
  #);
getAttributes: manipulateAttribute
  (# theAttributes: ^attributes;
  <<SLOT MPSattributeGetAttributes: doPart>>
  exit theAttributes[]
  #);
findAttribute: manipulateAttribute
  (# name: ^text;
     foundAttribute: ^attributeDecl;
  enter name[]
  do <<SLOT MPSAttributeFindAttribute: descriptor>>
  exit foundAttribute[]
  #);

manipulateObjectDescriptor:
  (# theObjectDescriptor: ^objectDescriptor;
  enter theObjectDescriptor[]
  do inner;
  #);
setDopart: manipulateObjectDescriptor
  (# theDoPart: ^doPart
  enter theDoPart[]
  <<SLOT MPSsetDopart: doPart>>
  #);
getDopart: manipulateObjectDescriptor
  (# theDopart: ^doPart;
  <<SLOT MPSgetDopart: doPart>>
  exit theDopart[]
  #);

newDopart: generate
  (# ASTtype::< doPart;
  <<SLOT MPSnewDoPart: doPart>> 
  #);
newOpenStatement: generate
  (# objectName: ^text;
     ASTtype::< imp;
  enter objectName[]
  <<SLOT MPSnewOpenStatement: doPart>>
  #);
newInitFromResourceStatement: generate
  (# objectID: @integer;
     ASTtype::< imp;
  enter objectID
  <<SLOT MPSnewInitFromResourceStatement: doPart>>
  #);

-- listLib: attributes --
removeEmptySons:
  (# <<SLOT MPSlistRemoveEmptySons: doPart>> #);
prepend:
  (# son: ^sonCat;
  enter son[]
  <<SLOT MPSlistPrepend: doPart>>
  #);

-- fragmentGroupLib: attributes --

originProperty:
  (# value: ^text;
  enter (# enter value[] <<SLOT MPSSetOriginProperty: doPart>> #)
  exit (# <<SLOT MPSGetOriginProperty: doPart>> exit value[] #)
  #);
deleteFragment:
  (# frag: ^fragmentForm;
  enter frag[]
  do frag.name -> fragmentList.deleteLocalName;
  #);
findFragment:
  (# name: ^text;
     frag: ^fragmentForm;
  enter name[]
  <<SLOT MPSFragmentGroupFindFragment: doPart>>
  exit frag[]
  #);

-- astInterfaceLib: attributes --

safeOpen:
  (# name: ^text;
     group: ^fragmentGroup;
  enter name[]
  <<SLOT AstInterfaceSafeOpen: doPart>>
  exit group[]
  #);
