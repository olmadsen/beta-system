ORIGIN '~beta/betaast/v5.1/betacfl';
INCLUDE '~beta/betaast/v5.1/gram';
INCLUDE '../datastructures/sequence';
BODY 'private/patternbody';


-- betaAttributes: attributes --

getPrivateFragment:
  (# node: ^astInterface.beta.attributeDecl;
     frag: ^astInterface.fragmentForm;
  enter node[]
  <<SLOT patternGetPrivateFragment: doPart>>
  exit frag[]
  #);


-- lib: attributes --



attributeList: sequence
  (# MPS: ^astInterface;
     element:: MPS.ast;
  #);

imperativeList: sequence
  (# MPS: ^astInterface;
     element:: MPS.ast;
  #);

astWrapper:
  (# <<SLOT astWrapperLib: attributes>>;
     node: ^astInterface.AST;
     gram: @grammar;
     
     expand:<
       (# theExpanded: ^astInterface.expanded;
       <<SLOT astWrapperExpand: doPart>> 
       #);
     
     init:<
       (# 
       enter node[]
       <<SLOT astWrapperInit: doPart>>
       #);
  #);

attribute: astWrapper
  (# <<SLOT attributeLib: attributes>>;
     init::<
       (# 
       <<SLOT attributeInit: doPart>>
       #);
     
     name:
       (# theName: ^text;
       enter (# enter theName[] <<SLOT attributeEnterName: doPart>> #)
       exit (# <<SLOT attributeExitName: doPart>> exit theName[] #)
       #);
     
     theNames: @astWrapper
       (# expand::
            (# <<SLOT attributeTheNamesExpand: doPart>> #);
          
          first:
            (# theName: ^text;
            enter (# enter theName[] <<SLOT attributeTheNamesEnterFirst: doPart>> #)
            exit (# <<SLOT attributeTheNamesExitFirst: doPart>> #)
            #);
       #);
  #);

pattern: attribute
  (# <<SLOT patternLib: attributes>>;
     
     
     init::<
       (# 
       <<SLOT patternInit: doPart>>
       #);
     
     super:
       (# superPattern: ^pattern;
       enter (# enter superPattern[] <<SLOT patternEnterSuper: doPart>> #)
       exit (# <<SLOT patternExitSuper: doPart>> exit superPattern[] #)
       #);
     prefix:
       (# thePrefix: ^text;
       enter (# enter thePrefix[] <<SLOT patternEnterPrefix: doPart>> #)
       exit (# <<SLOT patternExitPrefix: doPart>> exit thePrefix[] #)
       #);
     
     theDescriptor: @descriptor;
     
     
     inherits: booleanValue
       (# name: ^text;
       enter name[]
       <<SLOT patternInherits: doPart>>
       #);
     
     expand::
       (# <<SLOT patternExpand: doPart>> #);
  #);

item: attribute
  (# 
     theDescriptor: ^descriptor;
     
     super:
       (# superPattern: ^pattern;
       enter (# enter superPattern[] <<SLOT itemEnterSuper: doPart>> #)
       exit (# <<SLOT itemExitSuper: doPart>> exit superPattern[] #)
       #);
     prefix:
       (# thePrefix: ^text;
       enter (# enter thePrefix[] <<SLOT itemEnterPrefix: doPart>> #)
       exit (# <<SLOT itemExitPrefix: doPart>> exit thePrefix[] #)
       #);
  #);

descriptor:
  (# <<SLOT descriptorLib: attributes>>;
     node: ^astInterface.AST;
     
     init:<
       (# 
       enter node[]
       <<SLOT descriptorInit: doPart>>
       #);
     
     virtuals:
       (# theVirtuals: ^attributeList;
       <<SLOT descriptorVirtuals: doPart>>
       exit theVirtuals[]
       #);
     simpleDecls:
       (# theSimpleDecls: ^attributeList;
       <<SLOT descriptorSimpleDecls: doPart>>
       exit theSimpleDecls[]
       #);
     initImperatives:
       (# theInitImperatives: ^imperativeList;
       <<SLOT descriptorInitImperatives: doPart>>
       exit theInitImperatives[]
       #);
     openImperatives:
       (# theInitImperatives: ^imperativeList;
       <<SLOT descriptorOpenImperatives: doPart>>
       exit theInitImperatives[]
       #);
  #);
