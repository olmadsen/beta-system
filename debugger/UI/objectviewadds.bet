ORIGIN '~beta/objectbrowser/UI/objectview';
INCLUDE '~beta/toollibs/UI/moveable'
        '~beta/objectbrowser/objectdumper';
(*
 * COPYRIGHT
 *   Copyright Mjolner Informatics, 1995-96
 *   All rights reserved.
 *)
-- guienvlib: Attributes --
showStack: (# comp: ^betaObject;  enter comp[] do INNER #);
showCode: (# ast: ^astinterface.ast;  enter ast[] do INNER #);
showRefs: (# obj: ^betaObject;  enter obj[] do INNER #);
showRefDiag: (# obj: ^betaObject;  enter obj[] do INNER #);
showHeapView: (#  do INNER ;  #);
  

-- moveableObjectViewLib: Attributes --
addObjectViewactionedMenuItems:
  (#
     show:< showStack;
     ssp: @movMenu.showStackParam
       (#
          getbo::  (#  do THIS(moveableObjectView).theBo[]->bo[] #);
          show:: 
            (#  do comp[]->THIS(addObjectViewactionedMenuItems).show #);
          
       #);
     showC:< showCode;
     scp: @movMenu.showCodeParam
       (#
          getast:: 
            (# bo: ^betaObject; 
            do
               THIS(moveableObjectView).theBo[]->bo[];
               bo[]->bo.dumper.betaObjectObjectDescriptor->ast[];
               
            #);
          show:: 
            (#  do ast[]->THIS(addObjectViewactionedMenuItems).showC #);
          
       #);
     showR:< showRefs;
     srp: @movMenu.showRefsParam
       (#
          getbo::  (#  do THIS(moveableObjectView).theBo[]->bo[] #);
          show:: 
            (#  do obj[]->THIS(addObjectViewactionedMenuItems).showR #)
       #);
     showRD:< showRefDiag;
     srdp: @movMenu.showRefDiagParam
       (#
          getbo::  (#  do THIS(moveableObjectView).theBo[]->bo[] #);
          show:: 
            (#  do obj[]->THIS(addObjectViewactionedMenuItems).showRD #);
          
       #);
     showHV:< showHeapView;
     shvp: @movMenu.showHeapViewParam
       (# show:: (#  do THIS(addObjectViewactionedMenuItems).showHV;  #); 
       #);
     
  do
     (movMenu.showStackAction##,movMenu.showStackOnStatus##,ssp[],
      'Show component stack')->(&movMenu.actionedMenuItem[]).open;
     (movMenu.showCodeAction##,movMenu.showCodeOnStatus##,scp[],'Show Code')
       ->(&movMenu.actionedMenuItem[]).open;
     (movMenu.showRefsAction##,movMenu.showRefsOnStatus##,srp[],
      'Show References')->(&movMenu.actionedMenuItem[]).open;
     (movMenu.showRefDiagAction##,movMenu.showRefDiagOnStatus##,srdp[],
      'Show ref diagram')->(&movMenu.actionedMenuItem[]).open;
     (movMenu.showHeapViewAction##,movMenu.showHeapViewOnStatus##,shvp[],
      'Show Heap')->(&movMenu.actionedMenuItem[]).open;
     
  #);
  

-- objectViewLib: Attributes --
addObjectViewItemMenuItems:
  (#
     show:< showStack;
     ssp: @itemMenu.showStackParam
       (#
          getbo:: 
            (# 
            do
               (if itemMenu.targetatt.attType = StatCompRefAttribute then
                   (itemMenu.targetatt[]->Qua (# as:: complexAttribute #)).bo[]
                     ->bo[];
                   
               if);
               
            #);
          show::  (#  do comp[]->THIS(addObjectViewItemMenuItems).show #);
          
       #);
     showC:< showCode;
     scp: @itemMenu.showCodeParam
       (#
          getast:: 
            (# bo: ^betaObject; 
            do
               (if (itemMenu.targetatt.attType = StatCompRefAttribute) or
               (itemMenu.targetatt.attType = StatRefAttribute) then
                   (itemMenu.targetatt[]->Qua (# as:: complexAttribute #)).bo[]
                     ->bo[];
                   bo[]->bo.dumper.betaObjectObjectDescriptor->ast[];
                   
               if);
               
            #);
          show::  (#  do ast[]->THIS(addObjectViewItemMenuItems).showC #)
       #);
     showR:< showRefs;
     srp: @itemMenu.showRefsParam
       (#
          getbo:: 
            (# 
            do
               (if itemMenu.targetatt.attType = StatCompRefAttribute then
                   (itemMenu.targetatt[]->Qua (# as:: complexAttribute #)).bo[]
                     ->bo[]
               if)
            #);
          show::  (#  do obj[]->THIS(addObjectViewItemMenuItems).showR #)
       #);
     showRD:< showRefDiag;
     srdp: @itemMenu.showRefDiagParam
       (#
          getbo:: 
            (# 
            do
               (if itemMenu.targetatt.attType = StatCompRefAttribute then
                   (itemMenu.targetatt[]->Qua (# as:: complexAttribute #)).bo[]
                     ->bo[];
                   
               if);
               
            #);
          
       #);
     showHV:< showHeapView;
     shvp: @itemMenu.showHeapViewParam;
     
  do
     (itemMenu.showStackAction##,itemMenu.showStackOnStatus##,ssp[],
      'Show component stack')->(&itemMenu.actionedMenuItem[]).open;
     (itemMenu.showCodeAction##,itemMenu.showCodeOnStatus##,scp[],'Show Code')
       ->(&itemMenu.actionedMenuItem[]).open;
     (itemMenu.showRefsAction##,itemMenu.showRefsOnStatus##,srp[],
      'Show References')->(&itemMenu.actionedMenuItem[]).open;
     (itemMenu.showRefDiagAction##,itemMenu.showRefDiagOnStatus##,srdp[],
      'Show ref diagram')->(&itemMenu.actionedMenuItem[]).open;
     (itemMenu.showHeapViewAction##,itemMenu.showHeapViewOnStatus##,shvp[],
      'Show heap')->(&itemMenu.actionedMenuItem[]).open;
     
  #);
  

-- menuLib: Attributes --
showStackParam:
  (#
     getbo:< (# bo: ^betaObject;  do INNER exit bo[] #);
     show:< showStack;
     
  #);
showStackAction: actionedMenuItemAction
  (# paramType:: showStackParam; 
  do (if param[]->showStackOnStatus then param.getbo->param.show;  if); 
  #);
showStackOnStatus: actionedMenuItemOnStatus
  (# paramType:: showStackParam; bo: ^betaObject; 
  do
     param.getbo->bo[];
     (if bo[] <> none then bo.IsComponentObject->value if);
     
  #);
showCodeParam:
  (#
     getast:< (# ast: ^astInterface.ast;  do INNER exit ast[] #);
     show:< showCode;
     
  #);
showCodeAction: actionedMenuItemAction
  (# paramType:: showCodeParam; 
  do (if param[]->showCodeOnStatus then param.getast->param.show;  if); 
  #);
showCodeOnStatus: actionedMenuItemOnStatus
  (# paramType:: showCodeParam; ast: ^astInterface.ast; 
  do param.getast->ast[]; (if ast[] <> none then TRUE->value;  if); 
  #);
showRefsParam:
  (#
     getbo:< (# bo: ^betaObject;  do INNER exit bo[] #);
     show:< showRefs
  #);
showRefsAction: actionedMenuItemAction
  (# paramType:: showRefsParam; 
  do (if param[]->showRefsOnStatus then param.getbo->param.show;  if); 
  #);
showRefsOnStatus: actionedMenuItemOnStatus
  (# paramType:: showRefsParam; bo: ^betaObject; 
  do param.getbo->bo[]; (if bo[] <> none then true->value if)
  #);
showRefDiagParam:
  (#
     getbo:< (# bo: ^betaObject;  do INNER exit bo[] #);
     show:< showRefDiag;
     
  #);
showRefDiagAction: actionedMenuItemAction
  (# paramType:: showRefDiagParam
  do (if param[]->showRefDiagOnStatus then param.getbo->param.show;  if); 
  #);
showRefDiagOnStatus: actionedMenuItemOnStatus
  (# paramType:: showRefDiagParam; bo: ^betaObject; 
  do param.getbo->bo[]; (if bo[] <> none then true->value if)
  #);
showHeapViewParam: (# show:< showHeapView;  #);
showHeapViewAction: actionedMenuItemAction
  (# paramType:: showHeapViewParam; 
  do (if param[]->showHeapViewOnStatus then param.show;  if); 
  #);
showHeapViewOnStatus: actionedMenuItemOnStatus
  (# paramType:: showHeapViewParam do true->value;  #)  

