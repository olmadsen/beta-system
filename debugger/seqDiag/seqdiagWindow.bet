ORIGIN '~beta/guienv/guienv';
INCLUDE 'seqdiagRenderer'
        '~beta/mps/astlevel'
        '~beta/sysutils/objinterface'
        '~beta/betaast/betasematt';
-- guienvLib: Attributes --
seqdiagWindow: window
  (#
     onMsg:<
       (#
          desc: ^astinterface.ast;
          msg,objName: ^text;
          isExit: @boolean;
          objdesc: ^astInterface.BETA.objectdescriptor;
          patdecl: ^astInterface.BETA.PatternDecl;
          firstname: ^astInterface.BETA.nameDcl;
          names: ^astInterface.BETA.names
       enter (desc[],msg[],isExit)
       do
          desc.father->patdecl[];
          patdecl.getson1->names[];
          thisScan: names.newscan
            (#  do current[]->firstname[]; leave thisScan #);
          firstname.getText->objName[];
          objName[]->putline;
          'SDTracepointHit: desc.ast=%d, msg=%s,isexit=%d, son:%s\n'
            ->screen.putformat
              (#  do desc.index->d; msg[]->s; isExit->d; objName[]->s #);
          INNER
       #);
     n: @integer;
     isOpen: @boolean;
     assertOpen: (#  do (if not isOpen then open if) #);
     open:: 
       (# 
       do
          true->isOpen;
          (100,100)->position;
          (400,300)->size;
          'Sequence diagram test'->title;
          (0xffff,0xffff,0xffff)->backgroundColor;
          sequenceDiagram.open;
          (50,50,20)->sequenceDiagram.init
       #);
     close::  (#  do false->isOpen #);
     show: (#  do assertOpen; THIS(window).show #);
     eventhandler:: 
       (#
          onMouseDown:: 
            (# obj1,obj2,obj3: ^objectColumnRenderer
            do
               ('object 1',none )->sequenceDiagram.addObject->obj1[];
               ('object 2',none )->sequenceDiagram.addObject->obj2[];
               ('object 3',none )->sequenceDiagram.addObject->obj3[];
               (obj1[],obj2[],'foo','right')->sequenceDiagram.addMsg;
               (obj1[],obj2[],'bar','right')->sequenceDiagram.addMsg;
               (obj2[],obj1[],'baz','left')->sequenceDiagram.addMsg
            #)
       #);
     sequenceDiagram: @seqdiagRenderer (# open::<  (#  #) #)
  #)  

