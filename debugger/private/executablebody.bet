ORIGIN '../processInterface';
INCLUDE '~beta/toollibs/utils/options'
        '~beta/toollibs/labelnametable/address_to_name_table'
        '~beta/basiclib/formatio'
        '~beta/containers/arrayContainer';
LIB_ITEM 'valhallaprocess';
-- executableInit: DoPart --
do
   (getObjectPrefs).getBoolean (#  do 'ReadLabelsOnStartUp'->name[] #)
     ->execPrivate.readLabelsOnStartup;
   (getEXECNAMEparam).copy->execPrivate.execFile.name;
   (if execPrivate.execFile.entry.exists then
       execPrivate.execFile.entry.modTime->modTime;
       (if execPrivate.readLabelsOnStartup then
           execPrivate.labelTable.forknm; 
       if);
       
    else
       execPrivate.execFile.name->notFound; 
   if);
     

-- executableFinishInit: DoPart --
do
   (if execPrivate.readLabelsOnStartup then
       (if not execPrivate.labelTable.initialized then
           execPrivate.labelTable.readFromExecutable
       if);
       
   if);
     

-- executableReInit: DoPart --
do (* ... *)
   (getObjectPrefs).getBoolean (#  do 'ReadLabelsOnStartUp'->name[] #)
     ->execPrivate.readLabelsOnStartup;
   doreinit:
   (if execPrivate.execFile.entry.exists then
       (**
	   (if execPrivate.execFile.entry.modTime <> modTime then
           execPrivate.execFile.name->modTimeChanged; leave doreinit; 
       if);
	   **)
       (if execPrivate.readLabelsOnStartup then
           (if not execPrivate.labelTable.initialized then
               execPrivate.labelTable.forknm; 
           if);
           
       if);
       
    else
       execPrivate.execFile.name->notFound; 
   if);
     

-- labelNameToAddress: DoPart --
do   

-- labelAddressToName: DoPart --
do address->execPrivate.labelTable.findNearestLabel->(name[],value);   

-- executableKill: DoPart --
do   

-- executablePrivate: Descriptor --
(#
   execFile: @File;
   readLabelsOnStartup: @Boolean;
   labelTable: @address_to_name_table
     (#
        startLabelRead:: onlabelread;
        doneLabelRead:: onLabelReadDone;
        execfilename::  (#  do execFile.name->name[] #);
        forknm:: 
          (#  do processComm.get_main_physical->get_process_offset #);
        
     #);
   
#)  

