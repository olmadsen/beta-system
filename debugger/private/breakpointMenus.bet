ORIGIN '../valhalla';
INCLUDE 'valhallabody';
INCLUDE '../breakpointOperations';
INCLUDE '~beta/editor/v5.1/codeeditor';
INCLUDE '~beta/sourcebrowser/v1.1/private/ymerPrivate';
(*
 * COPYRIGHT
 *   Copyright Mjolner Informatics, 1995-96
 *   All rights reserved.
 *)

--- onCodeViewOpen: dopart ---
do &thecodeview.contents.action
   (# eventtype:: thecodeview.contents.theeventhandler.mouseDown;
      breakpointsMenu: @breakpointController
        (# getFocus::
             (# i: @integer
             do thecodeview.sifviewer.cs->(node[],i,i,i)
             #);
           getCfe::
             (#
             do (if thecodeview.sifviewer[]<>NONE then
                    thecodeview.sifviewer[]->fe[]
                if)
             #);
           infoMsg:: (# do msg[]->browser.infoView.msg #);
           newCodeView:: (# do node[]->newcodemoveable #);
           m: ^menu;
        #)
   do (if not theevent.doubleClick then
          (if theevent.buttonstate=3 then
              (if theevent.shiftkey then
                  (* Motif bug: does not install translations for popup menu
                   * until activated the first time
                   *)
                  (if thecodeview.sifViewer.thePopupMenu[]=NONE then
                      &codeEditorPopupMenu[]
                        ->thecodeview.sifViewer.thePopupMenu[];
                      thecodeview.sifViewer[]
                        ->thecodeview.sifViewer.thePopupMenu.attach;
                      thecodeview.sifViewer.thePopupMenu.open
                  if);
                  (1,theevent.localposition,thecodeview.contents[])
                    ->thecodeview.sifViewer.thePopupMenu.popup;
               else
                  (* Motif bug: does not install translations for popup menu
                   * until activated the first time
                   *)
                  (if breakPointsMenu.m[]=NONE then
                      breakpointsMenu.init;
                      &breakPointsMenu.breakPopupMenu[]->breakPointsMenu.m[];
                      breakPointsMenu.m.open;
                  if);         
                  (1,theevent.localposition,thecodeview.contents[])
                    ->breakPointsMenu.m.popup;
              if)
          if)
      if)
   #)[]->thecodeview.contents.appendAction;
   
--- mycodeviewOpen: dopart ---
do &action
   (# eventtype:: contents.editor.contents.theeventhandler.mouseDown;
      breakPointsMenu: @gui.breakpointController
        (# getFocus:: (# i: @integer do private.cfe.cs->(node[],i,i,i) #);
           getCfe:: (# do private.cfe[]->fe[] #);
           infoMsg:: (# do msg[]->gui.putinfo #);
           newCodeView:: (# do node[]->newcodemoveable #);
           m: ^gui.menu;
        #)
   do contents.editor[]->lastEditor[];
      (if not theevent.doubleClick then
          (if theevent.buttonstate=3 then
              (if theevent.shiftkey then
                  (* Motif bug: does not install translations for popup menu
                   * until activated the first time
                   *)
                  (if contents.editor.sifViewer.thePopupMenu[]=NONE then
                      &gui.main.codeEditorPopupMenu[]
                        ->contents.editor.sifViewer.thePopupMenu[];
                      contents.editor.sifViewer[]
                        ->contents.editor.sifViewer.thePopupMenu.attach;
                      contents.editor.sifViewer.thePopupMenu.open
                  if);
                  (1,theevent.localposition,contents[])
                    ->contents.editor.sifViewer.thePopupMenu.popup;
               else
                  (* Motif bug: does not install translations for popup menu
                   * until activated the first time
                   *)
                  (if breakPointsMenu.m[]=NONE then
                      breakpointsMenu.init;
                      &breakPointsMenu.breakPopupMenu[]->breakPointsMenu.m[];
                      breakPointsMenu.m.open;
                  if);         
                  (1,theevent.localposition,contents.editor.contents[])
                    ->breakPointsMenu.m.popup;
              if)
          if)
      if)
   #)[]->contents.editor.contents.appendAction;
   
   
--- guiMenubarTypeOpen: dopart ---
do fileMenu.setup;
   projectMenu.setup;
   &(# viewMenu: @codeEditorViewMenu
         (# formEditorExists::
              (# do this(ymerBrowserWindow).browser.cfe[]->cfe[] #);
            setup:
              (# 
              do true->BETAsif; open;
                 THIS(viewMenu)[]->THIS(menubarType).append
              #)
         #);
    do viewMenu.setup
    #);
   &(# breakPointsMenu: @breakpointController
         (# getFocus:: (# i: @integer do browser.cfe.cs->(node[],i,i,i) #);
            getCfe:: (# do browser.cfe[]->fe[] #);
            infoMsg:: (# do msg[]->gui.putinfo #);
            newCodeView:: (# do node[]->newcodemoveable #);
            m: ^gui.menu;
         #)
    do breakpointsMenu.init;
       &breakpointsMenu.controlMenu[]->breakpointsMenu.m[];
       breakpointsMenu.m.open; 'Control'->breakpointsMenu.m.name;
       breakpointsMenu.m[]->append;
       &breakpointsMenu.breakPulldownMenu[]->breakpointsMenu.m[];
       breakpointsMenu.m.open; 'BreakPoints'->breakpointsMenu.m.name;
       breakpointsMenu.m[]->append;
    #);
   historyMenu.setup;
   windowsMenu.setup
   
--- mainTypeMenubarTypeOpen: dopart ---
do  &(# breakPointsMenu: @breakpointController
          (# getFocus::
               (# i: @integer 
               do lastEditor.sifviewer.cs->(node[],i,i,i)
               #);
             getCfe::
               (#
               do (if lastEditor[]<>none then
                      lastEditor.sifviewer[]->fe[]
                  if)
               #);
             infoMsg:: (# do msg[]->gui.putinfo #);
             newCodeView:: (# do node[]->newcodemoveable #);
             m: ^gui.menu;
          #)
     do breakpointsMenu.init;
        &breakpointsMenu.controlMenu[]->breakpointsMenu.m[];
        breakpointsMenu.m.open; 'Control'->breakpointsMenu.m.name;
        breakpointsMenu.m[]->append;
        &breakpointsMenu.breakPulldownMenu[]->breakpointsMenu.m[];
        breakpointsMenu.m.open; 'BreakPoints'->breakpointsMenu.m.name;
        breakpointsMenu.m[]->append;
     #)
   
   
--- workspaceMenubarOpen: dopart ---
do fileMenu.setup;
   &(# viewMenu: @codeEditorViewMenu
         (# formEditorExists::
              (# do this(workspace).cfe[]->cfe[] #);
            setup:
              (# 
              do true->BETAsif; open;
                 THIS(viewMenu)[]->THIS(menubarType).append
              #)
         #);
    do viewMenu.setup
    #);
   &(# breakPointsMenu: @breakpointController
          (# getFocus::
               (# i: @integer 
               do this(workspace).cfe.cs->(node[],i,i,i)
               #);
             getCfe::
               (#
               do this(workspace).cfe[]->fe[]
               #);
             infoMsg:: (# do msg[]->gui.putinfo #);
             newCodeView:: (# do node[]->newcodemoveable #);
             m: ^gui.menu;
          #);
     do breakpointsMenu.init;
       &breakpointsMenu.controlMenu[]->breakpointsMenu.m[];
        breakpointsMenu.m.open; 'Control'->breakpointsMenu.m.name;
        breakpointsMenu.m[]->append;
        &breakpointsMenu.breakPulldownMenu[]->breakpointsMenu.m[];
        breakpointsMenu.m.open; 'BreakPoints'->breakpointsMenu.m.name;
        breakpointsMenu.m[]->append;
     #);
   importMenu.setup;
   scrollMenu.setup;
   closeMenu.setup;

--- codeViewWindowMenubarOpen: dopart ---
do fileMenu.setup;
   &(# viewMenu: @codeEditorViewMenu
         (# formEditorExists::
              (# do fe[]->cfe[] #);
            setup:
              (# 
              do true->BETAsif; open;
                 THIS(viewMenu)[]->THIS(menubarType).append
              #)
         #);
    do viewMenu.setup
    #);
    &(# breakPointsMenu: @breakpointController
          (# getFocus::
               (# i: @integer 
               do this(codeViewWindow).fe.cs->(node[],i,i,i)
               #);
             getCfe::
               (# do this(codeViewWindow).fe[]->fe[] #);
             infoMsg:: (# do msg[]->gui.putinfo #);
             newCodeView:: (# do node[]->newcodemoveable #);
             m: ^gui.menu;
          #)
     do breakpointsMenu.init;
        &breakpointsMenu.controlMenu[]->breakpointsMenu.m[];
        breakpointsMenu.m.open; 'Control'->breakpointsMenu.m.name;
        breakpointsMenu.m[]->append;
        &breakpointsMenu.breakPulldownMenu[]->breakpointsMenu.m[];
        breakpointsMenu.m.open; 'BreakPoints'->breakpointsMenu.m.name;
        breakpointsMenu.m[]->append;
     #);
   buffersMenu.setup;
  
