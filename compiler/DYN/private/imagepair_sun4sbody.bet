ORIGIN 'imagepairbody';
INCLUDE '../../GENERATOR/SPARC/sparc';
BODY '../../GENERATOR/SPARC/SPARCmachine';
INCLUDE '~beta/unixlib/dlfcn';

--RelocateMapOffset: dopart--
do (value - 1) * 4 -> value
   
---NeedsGOT:doPart---
do false -> value
   
--- FlushCodeCache:descriptor---
(#   #)

--RelocateBody: descriptor--
(# 
do false->dump;
   (if mark
    // callMark then
       (* ((adr-off)->CALL) %putLongAt (off);  *)
       ((xAdr-absAdr)->CALL, relativeOff) -> patch
    // setHiMark then
       (*(%getLongAt (off))->instr;
        (instr %bor (adr->HI)) %putLongAt (off)*)
       relativeOff -> getItem-> instr;
       (instr %bor (xAdr->HI), relativeOff) -> patch
    // setLoMark // setLoMarkSt // setLoMarkJmp // setLoMarkLd
    // setLoMarkLdd then
       (*(%getLongAt (off))->instr;
        (instr %bor (adr->LO)) %putLongAt (off)*)
       relativeOff ->  getItem -> instr;
       (instr %bor (xAdr->LO), relativeOff) -> patch
    // wordMark then
       (*(adr) %putLongAt (off); *)
       (xAdr,relativeOff) -> patch
    // jmpMark then
       'OBS! Missing relocation for jmpMark!'->putline
    // bgtuMark then
       'OBS! Missing relocation for bgtuMark!'->putline
    else
       'OBS! Missing relocation for unknown mark!'->putline
   if);
#)

---PatchGOT:descriptor---
(# #)
