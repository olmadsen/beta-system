ORIGIN  'compiler';
INCLUDE '~beta/basiclib/systemenv';
INCLUDE '~beta/sysutils/envstring';
BODY 'SYNTHESIZER/synthesizer';
BODY 'CONTROL/translate_asmbody';
BODY 'GENERATOR/BYTECODE/bytecodebackend';
BODY 'GENERATOR/BYTECODE/bytecodetarget';

BODY 'GENERATOR/BYTECODE/bytecodebackend_clrbody';

-----program: descriptor---
systemEnv
(# IC: @ClrInteractiveCompiler;
   
   ClrInteractiveCompiler: InteractiveCompiler
     (# ActivateCompiler::
          (* Force regeneration of rootfragment, assuming it has program slot *)
          (# objdir: @directory
               (# delfile: @deletefile
                    (# nosuch::(# do true->continue #);
                       error::(# do true->continue #);
                    #)
               #);
             e: @diskentry;
          do 'clr' -> objdir.name;
             rootfragment[] -> e.path;
             (if objdir.entry.exists then
                 '.il' -> (e.path.name.prefix).append -> objdir.delfile;
                 '.clst' -> (e.path.name.prefix).append -> objdir.delfile;
                 '.bin' -> (e.path.name.prefix).append -> objdir.delfile;
                 '.dll' -> (e.path.name.prefix).append -> objdir.delfile;
                 'program.il' -> objdir.delfile;
                 'program.clst' -> objdir.delfile;
                 'program.bin' -> objdir.delfile;
                 'program.dll' -> objdir.delfile;
             if);
          #);
     #);
                              
do true -> IC.comp.trans.common.switch[120];
   true -> IC.comp.trans.common.switch[121];
   true -> IC.comp.trans.common.switch[122];
   true -> IC.comp.trans.common.switch[129];
   true -> IC.comp.trans.common.switch[182];
   true -> IC.comp.trans.common.switch[184];
   true -> IC.comp.trans.common.switch[189];
   true -> IC.comp.trans.common.switch[188];
   true -> IC.comp.trans.common.switch[23]; (* Save job file *)
   true -> IC.comp.trans.common.switch[14]; (* NO refNone check *)
   true -> IC.comp.trans.common.switch[327];(* Use Component.cs *)
   (if ('$(ROTOR_DIR)'->expandEnvVar).length > 0 then
       true -> IC.comp.trans.common.switch[328];
   if);
   'clr' -> IC.comp.targetMachine;
   IC
#)
