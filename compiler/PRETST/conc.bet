origin 'minienv';
include 'Queue';
include 'scheduler' 
---program:descriptor---
ConcurrentSystem
(# P1: @| cThread
     (# foo: (# n: @integer enter n do V+n -> V #);
        V: @integer
     do L:
          (#
          do (for i: 100 repeat i-> foo for);
             '/'->out.put;
             (if V < 500000 then restart L if)
     #)#);
   
   P2: @| cThread
     (# bar: (# n: @integer enter n do  V + n*n -> V #);
        V: @integer
     do L:
          (#
          do (for i: 100 repeat i -> bar for); 
             '+'->out.put;
             (if V < 500000 then restart L if)
     #)#);
   P3: @| cThread
     (# bar: (# n: @integer enter n do  V + n*2 -> V #);
        V: @integer
     do L:  
          (#
          do (for i: 100 repeat i -> bar for); 
             '*'->out.put;
             (if V < 500000 then restart L if)
     #)#); 

do p1[] -> p1.thisThread[]; 
   p2[] -> p2.thisThread[];
   p3[] -> p3.thisThread[];
   'before'->out.puttext; 
   P1.fork;
   '\nbetween'->out.puttext;
   P2.fork; 
   P3.fork;
   '\nend'->out.puttext
#)

             
 
