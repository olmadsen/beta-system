ORIGIN 'tstenv'   
[[--include 'tstlib'
---lib:attributes---
TstLVRA:
  (# 
     R: [1777]@integer;
     S: [1]@integer;
     T: [10]@integer;
     ch: [400]@char;
     sh: [401]@shortint;
     in: [402]@integer;
     dum:[401]@integer;
     re: [403]@real;
     sum: @integer;
     fail: @boolean;
     txt: @text;
  do 
     (* AlloVR1, AlloVR2, AlloVR4, AlloVR8 *)
     (if (ch.range=400) and (sh.range=401) and (in.range=402) and (re.range=403)
      //true then 'a' -> put 
     if);
     (for i:ch.range repeat 'x' -> ch[i] for);
     (for i:sh.range repeat i+7 -> sh[i] for);
     (for i:in.range repeat -i-i-i -> in[i] for);
     (for i:re.range repeat i*4.2 -> re[i] for);  
     false -> fail;
     (for i:400 repeat (if ch[i]<>'x'//true then true -> fail if) for);
     (for i:1 repeat (if sh[i]<>i+7//true then true -> fail if) for);  
     (for i:402 repeat (if in[i]<>-3*i//true then true -> fail if) for);
     (for i:403 repeat 
          (if (re[i]-i*4.2)*(re[i]-i*4.2)>0.0001 // true then true->fail if) 
     for);
     (if fail//true then '!' -> put else 'b' -> put if);
     
     (for i:R.range repeat i->R[i] for);
     (for i:R.range repeat R[i]+R[i] -> R[i] for);
     false -> fail;
     (for i:R.range repeat (if R[i]<>i+i//true then true -> fail if) for);
     (if fail//true then '!' -> put else 'c' -> put if);
     
     (* ExtVR *)
     R.range-S.range -> S.extend;
     (if S.range//1777 then 'd' -> put else '!' -> put if);
     (for i:S.range repeat R[i] -> S[i] for);
     0 -> sum;
     (for i:S.range repeat sum+S[i] -> sum for);
     (if sum//(S.range)*(S.range+1) then 'e' -> put else '!' -> put if);
     
     (* CopyVR *)
     S -> T;
     0 -> sum;
     (for i:T.range repeat T[i]->T[i]; sum+T[i] -> sum for);
     (if sum//(T.range)*(T.range+1) then 'f' -> put else '!' -> put if);
     
     (* NewVR *)
     1222 -> T.new;
     (if T.range//1222 then 'g' -> put else '!' -> put if);
     false -> fail;
     (for i:T.range repeat (if T[i]<>0//true then true -> fail if) for);
     (if fail//true then '!' -> put else 'h' -> put if);
     
     (* CopySVR *) (* Doesn't currently allocate in LVRA, actually *)
     R[318:1654] -> T; 
     (if T.range//1337 then 'i' -> put else '!' -> put if);
     false -> fail;
     (for i:T.range repeat (if T[i]<>R[i+317]//true then true -> fail if) for);
     (if fail//true then '!' -> put else 'j' -> put if);
     
     (* CopyT *)
     'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa' -> txt;
     (if txt.T.range//888 then 'k' -> put else '!' -> put if);
     false -> fail;
     (for i:txt.T.range repeat (if txt.T[i]<>'a'//true then 
                                   newline; i->putint; ' '->put; txt.T[i]->put;
          true -> fail if) for);
     (if fail//true then '!' -> put else 'l' -> put if);
     
     'm' -> fill;
  #)
---]]
