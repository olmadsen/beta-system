ORIGIN 'tstenv';   
BODY 'tstlibbody';       
(*LIBRARY 'tstlib'*)
--LIB: attributes--
error:
  (# <<SLOT Error:Dopart>> #);
chk:
  (# v,r: @integer; ch: @char
  enter(v,r,ch)
  do <<SLOT chkx:descriptor>>
  #);
chkBool:
  (# v,r: @boolean; ch: @char
  enter(v,r,ch)
  <<SLOT chkBool:doPart>>
  #);
chkR: 
  (* Note that comparions of reals as in X+Y
   * does in general not work satisfactory for floating point numbers.
   * E.g 1.11->x; 3.33->y; y-x->z; x=2.22 may be false.
   * Moved here by datpete to make it easier making small
   * real test programs with origin in tstenv.
   *) 
  (# x,y,z: @real; ch: @char; i: @integer;
  enter(x,y,ch) 
  do x-y->z; (* The difference should be close to zero *)
     z->i;   (* round to nearest integer, should be zero *)
     (if i<0 //true then -i->i if); 
     (if i//0 then ch->put else error if)
  #);
eqR:  
  (# R1,R2: @real; N: @integer; B: @boolean; 
  enter(R1,R2) 
  do R1-R2 -> N; 
     (if N < 0 then -N -> N if);
     N = 0  -> B
  exit B 
  #);
fill: 
  (# ch: @char 
  enter ch 
  do <<SLOT xfill:descriptor>>
  #);

exe:
  (# T: ^text;
     preExe: (# dummy: [10]@char; S: ^text do T[] -> S[]; Inner #);
  enter T[]
  do <<SLOT exe: descriptor>>
  #);

isBigEndian:
  (# X: @integer; b: @boolean 
  do 0x01000000->X; 
     0->X.%getByte->b; (*
     '\ntstlib:MISSING:0->X.%getByte->b;' -> putline;*)
     (* for testing the checker: 
      * 0->X.%ggetbyte;  (x %putBits 12)->x; x -> (14 %band 15);
      *)
  exit b
  #);



isHpux9pa: isPlatform
  (# 
  do (MT.T.range = 7) and (MT.T[1] = 'h') -> b
  #);
isSun4s: isPlatform
  (# 
  do (MT.T.range = 5) and (MT.T[1] = 's') -> b
  #);
isSgi: isPlatform
  (# 
  do (MT.T.range = 3) and (MT.T[1] = 's') -> b
  #);
isPpcmac: isPlatform
  (# 
  do (MT.T.range = 6) and (MT.T[1] = 'p') -> b
  #);          
isLinux: isPlatform
  (# 
  do (MT.T.range = 5) and (MT.T[1] = 'l') -> b
  #);
isX86sol: isPlatform
  (# 
  do (MT.T.range = 6) and (MT.T[1] = 'x') -> b
  #);
isNTI_ms: isPlatform 
  (#
  do (MT.T.range = 6) and (MT.T[1] = 'n') -> b
  #);
isNTI_gnu: isPlatform 
  (#
  do (MT.T.range = 7) and (MT.T[1] = 'n') -> b
  #);
isMACOSX: isPlatform 
  (#
  do (MT.T.range = 6) and (MT.T[1] = 'm') -> b
  #);
isNTI: 
  (# exit isNTI_ms or isNTI_gnu #);
isINTEL: 
  (# exit isNTI or isLinux or isX86sol #);
isMAC:
  (# exit isPpcmac #);
isUNIX: 
  (# exit (not isINTEL) and (not isMAC) #);
isNEWRUN: 
  (# exit isPPCMAC or isMACOSX or isSGI #);
