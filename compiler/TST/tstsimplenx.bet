origin 'tstenv'    
---lib:attributes---
trace:
  (# T: ^ text
  enter t[]
  do (if false then t[] -> putline if)
  #);
tstsimplenx:
  (# ch: @char;
     chx: @ 
       (# 
       do (if ch 
           // 'z' then '0' -> ch
           // '9' then 'a'-> ch
           else
              ch+1 -> ch
          if)
       exit ch  
       #);
     obj2list:
       (# Q: (# wQ: @char; 
             do 'Q'->trace
             exit(T,T)
             #); 
          T: (# eT:@char
             do 'T' -> trace
             exit(S,S)  
             #);       
          T2: 
            (# eT2:@char; S1,S2: @ S 
            do 'T2' -> trace
            exit S1  
            #);    
          T3: @
            (# eT3:@char; S1,S2: @ S
            do 'T3' -> trace
            exit S1 
            #);
          S: (# q1,q2,q3,qS: @integer 
             do 'S' -> trace;
                ch+1 -> q1; ch+2-> q2; ch+3 -> q3 -> ch
             exit(q1,q2,q3)
             #);
          W: (# R: ^T; aW: @char 
             do &T[]->R[]; chx ->a 
             exit (R[],a) 
             #);
           
          a,b,c,d,e,f,g,h,i,j,k,l: @integer; 
          R1: ^ T; 
          WW: (# R: [3] @ char; i,iWW: @integer   
              do chx -> R[1]; chx -> R[2]; chx -> R[3];
                 1 -> i
              exit(R[i],R[i+1],R[i+2])  
              #);
       do 'a'-1->ch;
          S -> (a,b,c);
          a -> put; b -> put; c -> put; 
          '\n'->trace;
          
          'c'->ch;
          T ->  ((a,b,c),(d,e,f)); 
          a -> put; b -> put; c -> put; 
          d -> put; e -> put; f -> put; 
          '\n'->trace;
          
          'i'->ch;
          Q -> (((a,b,c),(d,e,f)),((g,h,i),(j,k,l))) ;
          a -> put; b -> put; c -> put; 
          d -> put; e -> put; f -> put; 
          g -> put; h -> put; i -> put; 
          '\n'->trace;
          
          'r'->ch;
          T2 ->  (a,b,c); 
          a -> put; b -> put; c -> put; 
          '\n'->trace;
          
          'u'->ch;
          T3 ->  (a,b,c); 
          a -> put; b -> put; c -> put; 
          '\n'->trace;
          
          (# x: @char do  WW ->(a,b,c); #); 
          a -> put; b -> put; c -> put; 
          '\n'->trace;
          
          W -> (R1[],ch);
          ch -> put; 
          R1-> ((a,b,c),(d,e,f));  
          a -> put; b -> put; c -> put; 
          d -> put; e -> put; f -> put;
          '\n'->trace;     
       #);
     obj2listB:
       (# A: (# aB: ^B  
             enter(B,B->((x,y),(q,w),aB[]))
             do
             exit(B,B->((x,y),(q,w),aB[]))
             #);
          B: (# u,v: @char
             enter(C,C->(u,v))
             do
             exit(C,C->(u,v),this(B)[])
             #);  
          C: (# z1,z2: @char
             enter z1
             do chx -> z1; chx -> z2;
             exit(z1,z2) 
             #); 
          q,w,x,y,u,v: @char;
          a1,a2,a3,a4,a5,a6,a7,a8: @char;
          aB: ^B
       do 'a'-1 -> ch;      
          B -> ((a1,a2),(a3,a4),aB[]);   
          a1 -> put; a2 -> put; a3 -> put; a4 -> put; 
          (if a3 = aB.u then aB.u+2 -> put else error if);  
          (if a4 = aB.v then aB.v+2 -> put else error if);
          '\n'->trace;
          ch+2 -> ch;
          A -> (((a1,a2),(a3,a4),aB[]),((a5,a6),(a7,a8),aB[])); 
          a1 -> put; a2 -> put; a3 -> put; a4 -> put;
          a5 -> put; a6 -> put; a7 -> put; a8 -> put;
       #);
     list2obj:
       (# Q: (# w1: @char;
             enter(T,T)
             do 'Q'->trace
             exit(T,T)
             #);
          T: (# e1:@char 
             enter(S,S,e1)  
             do e1 -> put; 'T' -> trace 
             exit(S,S)
             #); 
          T2: 
            (# e2:@char; S1,S2: @ S  
            enter S1 
            do 'T2' -> trace   
            exit S1
            #); 
          T3: @    
            (# e3:@char; S1,S2: @ S
            enter S1 
            do 'T3' -> trace 
            exit S1
            #);
          S: (# q1,q2,q3: @integer 
             enter(q1,q2,q3) 
             do 'S' -> trace;
                q1 -> put; q2 -> put; q3 -> put;
             exit(q1,q2,q3)
             #);
          W: (# R: ^T2; a: @char
             enter (R[],a) 
             do R;  a -> put
             exit(R[],a) 
             #);
          
          a,b,c,d,e,f,f1,g,h,i,j,k,l: @integer;
          R1: ^ T2; 
          WW: (# R: [3] @ char; 
              enter(R[i],R[i+1],R[i+2])  
              do  R[1]->put; R[2]->put; R[3]->put;          
              #);
          
       do 'a'-1->ch;    
          
          chx -> a; chx -> b; chx -> c;   
          (a,b,c) ->  S;   

          chx -> a; chx -> b; chx -> c;  
          chx -> d; chx -> e; chx -> f;
          ((a,b,c),(d,e,f),chx) -> T; (* 'd' - 'j' *)
          
          chx -> a; chx -> b; chx -> c;    
          chx -> d; chx -> e; chx -> f; chx -> f1;
          chx -> g; chx -> h; chx -> i; 
          chx -> j; chx -> k; chx -> l;    

          (((a,b,c),(d,e,f),f1),((g,h,i),(j,k,l),chx)) -> Q ;
          
          
          chx -> a; chx -> b; chx -> c;    
          (a,b,c) -> T2;  (* 'v' - 'x' *)
          
          chx -> a; chx -> b; chx -> c;   
          (a,b,c) -> T3; 
          
          chx -> a; chx -> b; chx -> c;   
          1 -> i;
          (a,b,c) -> WW; 
          
          &T2[] -> R1[]; 
          chx -> a; chx -> b; chx -> c;   
          (a,b,c) -> R1;    
          chx -> ch;
          (R1[],ch) -> W;
       #);
     obj2obj:
       (# X1: (# q1,q2,q3,qX1: @integer 
              do 'X1' -> trace;
                 chx -> q1; chx-> q2; chx-> q3;
                 '!' -> trace
              exit(q1,q2,q3)
              #);
          X2: (# qX2: @char
              do 
              exit(X1,X1)
              #); 
          N1: (# w1,w2,w3,wN1: @char 
              enter(w1,w2,w3)  
              do '('->trace; 
                 w1 -> put; w2->put; w3 -> put;
                 ')' -> trace
              #);
          N2: (#  qN2: @integer 
              enter(N1,N1)
              do
              #);
          AAA: (# q1: @char do chx -> q1 exit q1 #)
       do 'a'-1 -> ch;   
          X1 -> N1;  
          '\n'->trace;
          X2 -> N2;   
          '\n'->trace;
          AAA -> ch;
          ch -> put; 
          '\n'->trace;
       #)

  do obj2list;
     newline;
     obj2listB;
     newline;
     list2obj; 
     newline;
     obj2obj;
  #)
---program:descriptor---
(#
do tstsimplenx  
#)
 
