origin 'tstenv' ;
INCLUDE 'tstsystemenv';
---program:descriptor---
systemEnv
(#  eat:
     (# n: @integer;
        allocsome: (# i:@Integer #);
        printf: external
          (# fmt: [1]@char;
             i: @integer;
          enter (fmt, i)
          #);
     enter n
     do (for i:n repeat (*('%d\n', i) -> printf;*) allocsome for);
             (*(if N > 0 then n-1 -> eat if)*)
     #);

   m: @Semaphore;
   
   S1: sysHead
     (# p: @put; 
     do (for i: 100 repeat 
             m.P;
             1000->eat;
             '.'->&put; 
             m.V;
             1000->eat 
        for); 
        ')'->put; 
     #);
   S2: sysHead
     (# p:@put; 
     do (for i: 100 repeat 
             m.P;
             1000->eat; 
             ','->&put;
             m.V;
             1000->eat 
        for);
        ']' -> put; 
     #); 
   main:: 
     (#
     do m.V;
        &|S1[] -> fork;
        &|S2[] -> fork;
        (* L: (#do  '*'->put; suspend; restart L #) *)
     #)
#)



