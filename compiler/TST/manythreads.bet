ORIGIN 'tstenv';
--PROGRAM: descriptor--
(# thread: 
     (# my_inx: @integer;
        my_tid: @integer;
        t:@Integer;
        spawn:
          (# attToProcessor: external
               (# comp: @integer;
                  tid: @integer;
               enter comp
               exit tid
               #);
          enter my_inx
          do (* FIXME: my_inx is a kludge.
              * Preferably:
              *   @@THIS(thread-component) -> attToProcessor 
              *)
             (%getLongAt (@@threads[my_inx]))->attToProcessor->my_tid;
          #);
     do L: 
          (# 
          do (for 1000000 repeat 
                  1->t;
             for);
             'a'+my_inx-1->put;
             restart L
          #)
     #);
   
   numthreads: (# exit 3 (* FIXME: fails for larger values #);
   thread_ids: [numthreads]@integer;
   threads:    [numthreads]^|thread; 
   (* FIXME: cannot use static repetitions - not yet implemented *)
   
do (for i:numthreads repeat
        (* FIXME: fails: i -> (&|thread[]->threads[i][]).spawn; *)
        &|thread[]->threads[i][];
        i -> threads[i].spawn
   for);
#)
