ORIGIN 'tstenv' ;
INCLUDE 'tstlib'
---lib:attributes---
TstRefRep:
  (# smartchar: (# rep: @char;
		   putC: (# do rep->put #);
		enter rep
		exit rep
		#);
  
     R: [1] ^smartchar; S: [10] @char;
     addZ: (# i: @integer enter i do i+'0'->i exit i #);
     R1,R2: [10] ^smartchar;
     R3: [2] ^smartchar;
     R4: [2] @integer;
     Stext:
       (# R: [1] @ Char; len: @integer
       enter (# enter R do R.range->len #)
       exit R[1:len]
       #);
     T1,T2: @ Stext;
     c: ^smartchar;
  do (for i: 26 repeat 
          (if (i>R.range)//true then R.range->R.extend if);
          &smartchar[]->R[i][]; 'a'-1+i->R[i] 
     for);
     (if R.range>26 //true then 26-R.range->R.extend if);
     (for i: R.range repeat R[i].putC for);  
     (for i: s.range repeat i->addZ->S[i] for);
     (for i: s.range repeat S[i]-1->R[i] for);
     (for i: s.range repeat R[i].putC for);
     newl;
     (for i: 10 repeat &smartchar[]->R1[i][]; 'a'-1+i->R1[i] for);
     R1->R2; (for i:R2.range repeat R2[i].putC for);
     7->R3.new; (for i:R3.range repeat &smartchar[]->R3[i][];   
		    i+'k'-1->R3[i]; R3[i].putC;
		 for);
     R1[2:5]->R2; (for i:R2.range repeat
		     R2[i]+16->R2[i];
		     R2[i].putC 
		  for); 
     
     18->S.new; '!vwxyz0123456789$'->S; S[2:15]->puttext;
     13->R4.new; 177->R4[13];
     (if R4[13] // 177 then '9'->put; else '!'->put; if);
  #)
