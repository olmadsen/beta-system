ORIGIN 'tstenv'     
---LIB:attributes---
tstComp:
  (# x,y,z: @char;
     C1: @ |
       (# P: (# ch: @char; N: @integer
             enter(ch,N)
             do (ch+1)->put; SUSPEND; 
                (if N// 4 then else N+1->N; (ch+1)->ch; (ch,N)->&P if) 
             #);
	  dum: @P;
          ch1,ch2: @char
       enter(ch1,ch2)
       do ch1->put; SUSPEND; ch2->put;
          (ch2,1)->&P ;
       #);
     
     CP:
       (# M: @(#do y->put; SUSPEND; z->put #);
       do x->put; SUSPEND; M
       #);
     
     rC: ^ | CP;
     
     C2: @ | 
       (# a,b: @char; q: @ (# c: @char #)
       do a->put; SUSPEND; q.c-> put; 'm'->put; 'n'->b
       #);
     C3,C4: @ |
       (# x,y: @char
       enter(x,y)
       do SUSPEND
       exit(x,y)
       #); 
     x1,x2: @char;
     
     CQ: (# ch1,ch2: @char enter(ch1,ch2) do ch1->put; ch2->put #);
     rCQ: ^| CQ; rCQI: ^CQ;
     CQQ: (# ch1: @char enter ch1 do ch1->put; exit ch1 #);
     rCQQ: ^| CQQ; rCQQI: ^CQQ
  do 'Q'->C1.ch1;  
     ('a','b')-> C1; 
     (for i:4 repeat C1; for); 
     'g'->x;   
     &|CP; 
     &|CP[]->rC[];
     'h'->x; 'i'->y; 'j'->z;
     rC; rC; rC;
     'k'->C2.a; C2;
     'l'->C2.q.c; C2;
     C2.b->put;
     ('o','p')->C3->C4->(x1,x2);
     x1->put; x2->put;
     (# qCP: @ | (# do 'q'->x; CP (* test that CP also can generate an item*)#)
     do qCP
     #);
     &|CQ[]->rCQ[]; ('r','s')->rCQ;
     &CQ[]->rCQI[]; ('t','u')->rCQI; (* CQ as item *)
     
     &|CQQ[]->rCQQ[]; 'v'->rCQQ->x; (if x//'v' then 'w'->put else '!'->put if);
     &CQQ[]->rCQQI[]; 'x'->rCQQI->x;  (* CQQ as item *)
     (if x//'x' then 'y'->put else '!'->put if);
     
     'z0123456789'->puttext
  #)
