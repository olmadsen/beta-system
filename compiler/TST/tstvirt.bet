ORIGIN 'tstenv'; 
INCLUDE 'tstlib';
---LIB:attributes---
TstVirt:
  (# A1: (# do 'c'->put; INNER; 'd'->put #);
     B: (# a,b: @char;
           V1:< (#do 'a'->put; INNER; 'b'->put #);
           V2:< A1;
        do V1; V2
        #);
     
     D1: (# do x->put; INNER; (if c1//'l' then y->put if);z->put #);
     D2: D1(#do y->put; INNER #);
     x,y,z: @char;
     
     c1: @char;
     T: (# a,b,c: @char;
           V1:< 
             (#do a->put; INNER; 
                (if c1//'l'//'s' then b->put; b+1->put if);
                c->put 
             #);
           V2:< D1;
           set:< object
        do c1->a; a+1->b; b+2->c; c+1->x; x+1->y; y+1->z;
           (# R: ^object do set; &set[]->R[] #);
           INNER;
           V1; 
           V2; 
        #);
     
     TT: T(# V1::<(#do b->put; INNER; d->put #);
             V2::< D2;
             d: @char
          do b+1->d
          #);
     TTT: T(# q: @integer #);
     TTTT: T(# V2::< D2; #);
     D: (# V: < (# do INNER #); 
           x: @V;
           W:<(# ch: @char enter ch do INNER #);
           z: @ | W
        do x; 'g'->z; 'h'->z; 'ijklmnopqrstuvwxyz0123456789'->puttext
        #);
     DD: D(# V::< (#do 'abcdef'->puttext #);
             W::< (#do ch->put; SUSPEND; ch->put #)
          #)
  do B;
     'e'->c1; TT;  
     'l'->c1; TTT;
     's'->c1; TTTT;
     'z'->fill; newl;
     DD; 
  #)
