ORIGIN 'tstenv'; (*'~beta/basiclib/v1.6/betaenv';*)            
BUILD sun4s '$$/useBETAaccount.o' 'useBETAaccount.c' '\$CC -g -c -o $0 $1';
---lib:attributes--- 
(* An example of a COM object written in BETA and passed to a C function *)
Account: COM 
  (# init:<  
       (# (*name: [1] @char; *) initialAmount: @integer
       enter initialAmount
       do (*name -> this(Account).name;  *)
          'Init account: \t'-> puttext;
          initialAmount -> print;
          initialAmount -> balance; 

       exit balance
       #);     
     deposit:<  
       (# amount: @integer   
       enter amount   
       do 'Deposit: \t'->puttext;
          amount->print;
          balance + amount -> balance 
       exit balance
       #);       
     withdraw:< 
       (# amount,id: @integer    
       enter amount 
       do 'Withdraw: \t'->puttext;
          amount -> print;
          balance - amount -> balance  
       exit balance  
       #);  
     display:< 
       (# d: @integer
       enter d
       do 'Balance: \t'->puttext; balance -> print 
       #);
     print: (# a : @integer enter a do a -> putint; newline #);
     name: @text; 
     balance: @integer;
  #);     
PutAccount: external(# R: ^Account enter R[] #);

--program:descriptor---
(# R: ^Account; am: @integer
do &Account[] -> R[];    
   5000 -> R.init;
   1200 -> R.deposit -> am;  
   2100 -> R.withdraw -> am; 
   0 -> R.display ; (* if no enter param, no call is made??*)
   R[] -> PutAccount;  
   0 -> R.display ;
#) 
  


