ORIGIN 'tstenv';
BODY 'basicsystemenvbody';
---lib:attributes---
BasicSystemEnv:
  (#
     Semaphore:
       (# P: (# <<SLOT SemaphoreP:dopart>> #);
          V: (# <<SLOT SemaphoreV:dopart>> #);
          init:
            (# count: @integer
            enter count
            <<SLOT SemaphoreInit:dopart>> 
            #);
          private: @<<SLOT SemaphorePrivate:descriptor>>;
       #);
     Fork:
       (# S: ^| object;
          my_tid: @integer;
       enter S[]
       <<SLOT basicSystemEnvFork:doPart>>
       exit my_tid
       #);
     Wait:
       (# go: (# do #)
       do (for i: 100000 repeat  for)
       #);
     IO: @ 
       (# m: @semaphore;
          entry: (# do m.P; INNER; m.V #);
          init: (#do m.V #);
          putC: entry
            (# ch: @char
            enter ch
            do ch -> put
            #);
          putT: entry
            (# S: ^text
            enter S[]
            do S[] -> puttext2
            #);
          putI: entry
            (# i: @integer
            enter i
            do i -> putint
            #);
       #);
     
  do 'Start' -> putline;
     IO.init;
     INNER
  #)
