CHANGES for compiler version 5.4

-----------------------------------------------------------------------------

OLM: 22/10/97:	Compiler version number for main tip upgraded to 5.4(0).

OLM: 31/10/97:	Bug fix for SGI; introduced machine slot 
		SubDescriptoSlotEntry to handle a cleaner and more
		correct handling of GP calculation for prefixed descriptor
		slots. Replaced a call to computeGP in jmpT of MIPSmachine.

OLM:  2/11/97:	Introduced switch 73 for SGI: each object file is made
		into a shared object file. 

OLM:  5/11/97:	Bug fix for x.%getByte/Short. 2 problems:
		* support for int8, uint8, etc for sparc gave a sign error;
		  all XXXmachine should support signed ldByte, etc. Currently
		  only sparc support this. When a platform is modified to
		  support signed, a change is necessary in evval2:
			primGet, primGet2, primInxGet
		* intel makes use of size in addres in ldByte, ldHalf, etc.
		  size is set in evval2:primIndex. Note, however, that it
		  is NOT very consistent - see comment
		* superflous clear instructions have been eliminated

PA: 5/11/97:	Added support for signed ldByte etc in INTELBmachine
		via pattern MovAddressToRegOp.
		Currently a hack in ldSignedVl, which temporarily sets
		op1.signed to true for this to work.
		NOT changed for NTImachine (Borland).

OLM: 9/11/97:	Eliminated ldSignedVl from compiler; i.e. it is not
		called anymore. Can be removed from machine and
		XXXmachine.
		Removed a number of gClr call. 
		Fixed signed for SGI. PPCMAC seems OK.
		int8,int8u,int16,int16u,int32 should now be ok for
		sun4s, intel, sgi and ppcmac. Only hp is missing
		int32u may not work. 
		int64 and int64u will definitely NOT work.

OLM: 12/11/97:	Fixed a number of minor syntax errors in the HP assembler
		code generated by the compiler to be able to run on
		HP UX 10. Remaining problems:
		- Beta script must recognise HP UX 10
		- Switch 74 needed to select correct assembler which for
		  HP UX 10 is in /usr/ccs/bin/as
		- Instruction generated in tstreal
			LDO	RR'L$C159,(%r1),%r1  problem with RR'L$C159
			Registers %fr21, etc are not accepted 

		Added support for int8, int8u, int16, int16u.

OLM: 13/11/97:	Added '-32' to CC in SGIasmlink

		Fixed the remaining HP-UX 10 fata error:

			LDO	RR'L$C159,(%r1),%r1  problem with RR'L$C159

		tst.bet can now translate,assemble and execute. There are
		1 error in tstreal and several in tstcproc; the latter
		due mainly to external float arguments. All the errrors
		are also present in HP-UX 9.
		There are a large number of warnings due to 
			Registers %fr21, etc are not accepted 
		The r4.2/compiler can translate and assemble. Linking not
		tested due to missing betarun

OLM: 16/11/97:	Removed ldSignedVl slot and all forms.

		Added support for transferring a wtext to/from an 
		COM virtual. New primitives: CopyWT  CopyCWT are introduced.
		See UniCode.html for a description.

PA: 12/12/97:	Started on support for DYN on linux.
		Fixed DYN/external/labelnametable.c for all platforms
		but nti. This file should be replaced with the one in
		debugger/private/external.
		Fixed BUILD directives.
		Restructurings to prevent inclusion of SPARCmachine in
		DYN/linkobject:
		  1. Created DYN/private/link_sun4sbody.bet
		  2. Created GENERATOR/image.bet, which defines
		     pattern Image.
		  3. Changed SPARCmachine to define a pattern
		     SparcImage, which has prefix Image.
		     Changed usages of Image to SparcImage in 
		     SPARCmachine and SUN4Self.
		  4. Created 4 desriptor slots in DYN/linkobject,
		     which are now bound in DYN/private/link_sun4sbody.bet
		Corresponding changes can now be made for linux.
		linkobject.bet now no longer include SPARCmachine.

PA: 15/12/97:	Added DYN/private/link_linuxbody.bet and removed
		(unnecessary) include of SPARCmachine in guienv.bet.
		Added MDBODY for binding asmlink fragments.
		guidynenv now compiles on linux, but fails during
		dynamic link.

PA: 15/12/97:	DYN:
		Fixed link_linuxbody:
		Major problem was, that image.buffer uses BYTE
		indexing on intel, but LONG indexing on sparc (:-(
		So image abstraction became even smaller (:-(.
		guidynenv now works for programs like
		  (# do 1->putint #) and (# do'x'->put #)
		but fails for
                  (# do 'fisk' ->putline #).
                Probably a bug in cross-segment locallab relocation.

PA: 16/12/97:	(Dantes 3 year birthday (:-)).
		DYN:
		Reorganized INTELmstate, so that the emit routines now
		use %get and %put operations to access the image
		buffers.
		This allows the buffer to be declared as an integer
		array, despite the byte addressing in INTELmstate, and
		thus to move the buffer declaration into the common
		image.bet. This allowed for elimination of one
		fragment in link_xxxbody.
		Fixed typo in link_linuxbody -- the program
		(# do 'fisk' -> putline #) now works in linux
		guidynenv too!
		Added function log2phys in betaLink.c, which can
		possibly be used for implementing DYN on nti.

OLM: 16/12/97:	Integrated MIPSmachine with image.bet. A RiscImage should
		be made in RISCmachine.bet

PA: 17/12/97:	Added DYN/private/link_ntibody.bet.
		Not yet tested!
		Requires that nametable lookup is modified to
		add the variable logical2physical_offset to all
		results. This is 0 on UNIX, and can thus safely be
		added on all platforms.
		Fixed BUILD directive in nametable.bet for nti (uses
		the full version of labelnametable.c in the debugger
		directory).

OLM: 17/12/97:	Created RiscImage in image.bet. Integrated with MipsImage
		and SparcImage. Can also be integrated with PPCImage.

PA: 18/12/97:	Fixed additions of logical2physical_offset in
		link_ntibody. There is now no known lacks in this
		implementation, but it has not yet been tested.

OLM: 18/12/97: 	Bug fix for (1,2,3,4,5) -> (r1,r2,r3,r4,r5) where ri: @real

OLM: 25/12/97:	Bug fix in INTELBmachine:gDiv; to fix error in 
			((i mod 100) div 10)
		It is, however, NOT known why the fix eliminates the error;
		the fix also eliminates an error reported by the consistency
		check in dumpR.
		We SHOULD understand why the error is fixed by the change 
		to gDiv!!!


PA: 26/12/97:	Eliminated GENERATOR/INTEL/INTELnotrace.
		File can be deleted in other workspaces (not done by RCM).
		Eliminated off-by-one error in INTELtrace.bet.
		Added comments to misc. INTEL files.

PA: 29/12/97:	Minor fixes to make DYN/guidynenv compile on nti.
		Fixed BUILDs and MDBODIES in DYN/linkobject,
		DYN/nameTable, DYN/guidynenv.
		guidynenv now compiles on nti, but there are 12
		undefined external symbols (in betarun, linkobject.c,
		and labelnametable.c).

OLM: 30/12/97:  Experiments with generating X-entry points for
		exit-lists; to avoid push of thisObject, since this
		may confuse beta.dump and give code gen error for ntes
		levae/restart. In addition less code may be
		generated. However, more entry-points will be
		generated!

PA: 5/1/98:	Changes for DYN: Now uses the updated labelnametable.c
		from debugger (a copy of it with the restriction for T
		and N entry points removed).  This implies, that the
		DC_ prefix on the externals is abandoned.
		However, this will cause a naming conflict, when 
		DYN is later used with the debugger (:-(.
		Ideally the nametable from the debugger should be 
		separated from the debugger. However, there is the
		difference in how many of the entry points are used,
		and also the debugger performs address-to-name lookup,
		whereas DYN needs name-to-address lookup.
		But an abstraction with both features should be
		possible to make (e.g. in toollibs/utils).
		Also the initialization of the nametable was changed:
		Now tests for address=-1 for stop-condition, instead
		of name='_end' (this is unix specific).
		Also appended '.exe' to binary being scanned for
		symbols (using toolibs/utils/fileExtensions).

PA: 5/1/98:	Changed DYN/guidynenv to set up SDK for compiler.
		There is a strange thing, in that
		comp.common.targetMachineId is 0 after comp.init?
		So I have written the code, so that it will work on
		unix too (since I cannot make a target check), unless
		you set SDK on unix.
		Ideally the stuf for setting up sdk etc should be
		done by the compiler itself. The full code can be
		found in GENERATOR/NTI/NTIBbeta.

PA: 6/1/98:	NTI DYN now works! (at least guidynenv and dynenv --gui).
		Changed DYN/external/labelnametable.c to support
		reading of ALL symbols, if compiled with -D DYN.
		Copied these changes to labelnametable.c in
		debugger/v2.3 - these two C files are now identical
		but using the one from ~beta/debugger here is
		difficult because BUILD currently does not expand
		'~beta' in source file of BUILD.
		One remaining thing is the setup of SDK in NTI
		front-ends to the compiler. Currently this code is
		more or less replicated in (at least):
		  compiler/GENERATOR/NTI/NTIBbeta.bet
		  compiler/GENERATOR/NTI/NTIbeta.bet
		  compiler/DYN/guidynenv.bet
		  compiler/DYN/dynenv.bet
		  editor/private/compiler_ntibody.bet
		  editor/private/acompiler_ntibody.bet
		Preferably the code from
		compiler/GENERATOR/NTI/NTIBbeta.bet should be executed
		automatically by the compiler, when starting up (on
		nti only).
	OLE>>>	In compiler/DYN/(gui)dynenv.bet is a test for nti,
		that does not work (search for FIXME:). I do not know
		why.
		TODO: Probably it is only necassary with symbols from 
		.data and .text. If other symbols are eliminated from
		labelnametable, a speedup may be obtained, especially
		on nti, which is currently rather slow.

PA: 6/1/98:	Eastetic changes in DYN:
		Initial descriptor now inserted in text windows.
		Target set to text window.
		Added option --tracebifrost to dynenv.
		Implemented rePaint in figures.bet using the "cheap"
		bifrost operation (damage/repair).
		
OLM: 31/1/98:	Bug fix for COM stuff: when tstenv.bet was compiled together
		with a file using COM, COM was not handled properly. 

OLM: 7/2/98:	Bug fix for compare list problem in an exp like: 
			getMaxID+1
		where getMaxId has 2 exit values, 1 in super and 1 in main.
		See FEJL/miksenRdb.bet

OLM: 7/2/98:	Bug fix for (a.get).r[1], which gave semantic error;.
		See FEJL/mariusRep.bet

OLM: 7/2/98:	Bug fix when checking dependent descriptor forms in the 
		same file: FEJL/pjc3.bet

OLM: 7/2/98:	Bug fix for missing check in 'Q: @this(P).hej'. Computed
		remote is NOT allowed to describe part objects.

OLM: 7/2/98:	Bug fix when semantic errors in V::< W where W is virtual.
			FEJL/thal

PA: 10/2/98:	Fix in GENERATOR/NTI/WIN32coff: External undefined
		*functions* in PE-COFF object files need to be
		declared as IMAGE_SYM_DTYPE_FUNCTION.
		See DOC/WindowsCOFF.html#IMAGE_SYM_DTYPE_FUNCTION.

OLM: 10/2/98:	Bug fix for this(P) where P is a prefix; new index attribute:
		onForThis introduced; see isEnclosing.


PA: 13/2/98:	Optimization in GENERATOR/ELF/elfread implementation,
		using a cache. gave approx. 50% speed-up, but e.g. the
		test program 'nmcommand' is still very slow compared
		to the corresponding 'nm' command.
		See comment in start of elfread.bet for other
		alternatives.

PA: 14/2/98:	More optimization on elfread:
		Now sections are read into BETA in one chunk from
		file, at the first access of the section.
		(still missing for relocation sections, though).
		Gave 50% speedup again (75% total for yesterday+today
		optimization). Is still a factor ~5 slower than nm,
		though (:-(

OLM: 18/2/98:	Bug fix for 'do L: (# S: ^L do S.kuk #)'; FEJL/dammNoWay.bet

OLM: 12/3/98:	Bug fix for R.%getLong, etc., where R is real.

PA: 28/3/98:	Moved stuff from RISCmachine/INTELmstate to image.bet
		Added GENERATOR/imageread.bet, GENERATOR/imagereadbody.bet
		GENERATOR/SUN4S/SUN4Simageread.bet with a preliminary
		implementation of reading SPARC ELF files into a
		machine-image.

PA: 30/3/98:	Extracted EntryPoints.element pattern into a separat 
		EntryPointInfo pattern in machine. Used for qualifying
		in Image.epElm array.
		Moved EntryPointInfo.m.LIP into EntryPointInfo.LIP.
		Reading of object files into images now only depends
		on the machine-independent parts of EntryPointInfo.
		Replaced all occurrences of EntryPoints.element with
		EntryPointInfo. Replaced occurrences of m.LIP with
		LIP. 

		Implemented rest of SUN4S/SUN4Simageread. NOT tested.


PA: 31/3/98:	Image reading on sun4s now works according to test
		prints

PA: 1/4/98:	Adapted image changes to compilers for linux, nti,
		ppcmac and sgi, which now work again (except that 
		the sgi compiler does not link - other error?).

		Abstracted SUN4S/SUN4Simageread into ELF/ELFimageread
		and implemented imageread for linux and sgi too.
		Both seems OK according to test prints.

		Abstracted most of new link_sun4s up into
		linkobject and adapted link_sun4s and link_linux
		to this new implementation.
		Now both dynamic compilation & linking and Load File
		in dynenv works on both linux and sun4s.
		nti should be fairly simple, but is not yet done.

OLM: 1/4/98:	Many changes to dynenv, etc. to handle load of files;
		clean-up of various interfaces. A loadFile button
		has been added; loads the selected file and displays
		available patterns; double click on a pattern executes
		the pattern. Bifrost file figures can be loaded, but
		execution of figure items currently fails.

PA: 2/4/98:	Updated DYN/private/link_sgibody.
		But dynlink on sgi still fails (never worked yet).
		Added empty bodies for imagereading on NTI and PPCMAC.
		Updated nti dynlink - it now works again.


PA: 3/4/98:	CODEmachine.bet:CreateDataFile:
		Double NULL termination of BETA_DATA list to allow 
		for extension of list by runtime routine.

OLM: 5/4/98:	Major reorganisation of dynlib,dynenv and compiler;
		see DOC/compiler.html for some of it.
		
OLM: 7/4/98:	More reorganisation and dynenv changes.

		The following variables in system.bet have been changed
		 	targetMachine		is now a pattern
			targetDirectory		has been moved to common

		The following pattern has been added to machine

			GetImages

		Each XXXmachine must define a corresponding slot

PA: 7/4/98:	Fixed code generation error in INTELBmachine
		which caused 
			aShort -> aRefRep.new
		to load aShort using 'movl'.
		Fixed by splitting up MovAddressToRegOp into
		MovAddressToRegOp, MovAddressToPrimReg, and
		MovAddressToPhysicalReg.
	
OLM: 7/4/98:	Factored dynlib into interface and dynlibbody file.
		Added comments to dynlib.
		Added dynamicTranslate to compiler in system.bet;
		to be used by e.g. Midgaard
		
PA: 8/4/98:	Added GENERATOR/COFF/coffread and friends which
		is analogues to GENERATOR/ELF/elfread, but for
		coff files.
		Works for at least the simple helloworld object
		file on NTI.
		Should be easy to implement reading of images on
		NTI using coffread.
		coffread is implemented for ppcmac too, but image
		reading will probably be a bit harder to implement
		(because of the many AUX symbols).

OLM: 13/4/98: 	A number of changes to dynlib and dynenv to be able
		to compile fragments with origin in objects where
		the corresponding descriptor does not have a slot.
		

PA: 14/4/98:	Added buffer_ptr and buffer_size to image (image.bet).
		And changed image.types to have element type char
		instead of integer (saves space, and max value is 18).
		Changes in ELF and DYN to allocate data and code segments
		directly when reading them from file.

PA: 15/4/98:	Implemented GENERATOR/COFF/COFFimageread and
		GENERATOR/NTI/WIN32imageread.
		According to test prints, image reading on nti
		is *almost* correct.
		Awaiting correction of two known intel codegeneration
		errors before fixing remaining details.

PA: 16/4/98:    Fixed remaining (known) errors in NTI image reading.
		According to test prints, NTI image reading is now
		correct.

MG: 23/4/98:	Removed all version numbers

PA: 23/4/98:	DYN: Fixed name table lookup speed: 
		   1. reinserted initialization of hashfunction
		      which had been removed when dlopen was 
		      introduced.
		   2. Expanded hash table from 25 to 5879 (large
		      prime)
		Now relocation is hardly noticeable (:-)

OLM: 26/4/98:	Eliminated 'AST.' as in  'AST.pathhandler';
		'AST.index' has been changed to 'ASTindex';
		'index in 'betaast/index.bet' has been renamed to 'ASTindex'.
		A number of none checks are therefore eliminated.
		Removed declaration of 'AST: ^AstInterface'.

OLM: 26/4/98:	Removed warning for 'R: ^myData'.

OLM: 27/4/98:	Merged binarystream with corresponding file from valhalla
		and placed it in sysutils.

OLM: 28/4/98:	Eliminated initterm_dynamic.bet (DYN stuff), etc.

OLM: 2/5/98:	Fixed bugs for final2virt (FEJL/final?/bet)

OLM: 7/5/98:	Fixed another final2virt bug (FEJL/listQua.bet).
 		It must be tested if these bug fixes work for Intel!

OLM: 8/5/98:	The final2virt bugs have now been tested and fixed for Intel
		as well. One change was necessary in INTELBmachine.
--------->      Peter: a similar change was made in LINUXmachine, but NOT
		tested.

OLM: 9/5/98:	Bug fix for Data pattern: in some situations R: ^someData
		gave an error message.
		In addition a data pattern may now hold references to
		Holder objects.

OLM: 11/5/98:	The following is now legal as a step towards COM.
----->		BUT IT MUST BE RECONSIDERED.
		- static data-objects are legal in external procedures
		  currently ONLY the checker accept this in declarations
		  of externals and COM virtuals. For externals a checker
		  error comes when calling the external. For COM virtuals
		  only dummy code is generated.
		- a data object may hold a reference to a COM object

OLM: 12/5/98:	COM stuff for linux/nti; AllocObj in INTELBmachine, etc.
		must be reconsidered.

OLM: 16/5/98:	COM stuff; fixed remaining known problems with BETA COM
		server for Intel and SPARC; but I am sure new ones
		will pop up:-)
		The entry code for a virtual COM MUST be fixed to save
-->		BetaStackTop, etc. as for call back.

OLM: 17/5/98:	Added support for STATE patterns.

OLM: 26/5/98:	First part of support for nti_ms and nti_gnu.

		Added the machine types nti_ms and nti_gnu to com.bet.

		Added GENERATOR/NTI_GNU/NTIGNUbeta.bet
		               /NTI_MS/NTIMSbeta.bet

		Added MDBODY for the new ones to compiler.bet

		Updated r4.2.boot/configuration/mjolnerrc to
		contain nti_ms and nti_gnu.

		Also made changes to dependency/private/controlbody
		for supporting match of nti_ms and nti_gnu with nti.
		See dependency/CHANGES; 
		For test, you may use dependency/test/testbuild.
		(as of today NOT checked out in r4.2)

		Missing:

		1.	NTI_GNU/NTIGNUasmlink.bet
		        NTI_MS/NTIMSasmlink.bet
		  	should be added. 
			Currently NTI/NTIBasmlink.bet is used

		2.	r4.2/configuration/mjolnerc must be updated

		3.	betarun/nti_gnu/betarun* 
			betarun/nti_ms/betarun*
			must be added. 
			Must implement  'machine_typeexternal'

		4.	more?

		To bootstrap run a current nti compiler as e.g.

			beta -t nti_ms beta

		I think! But I am not sure that this will work since
		it is some time ago that a new target has been bootstrapped.

MG: 28/5/98:	Added rcm version number for top component 'compiler' to
		the version number printed at startup of the compiler.
		Requires rcm v2.5.5 to work, which is installed 
		in ~beta/bin and on Blaalys+GuldTuborg+Glendronach.

MG: 11/6/98:	(Rcm 433) sdk=gnu now uses command.com for BAT files, 
		not SH for SH-scripts in the jobfile.  There is no limit on
		the link-length, as the objectfiles are listed in a
		seperate file, just like bor+ms.  
		windres support for resource files added, though
		preliminary and untestet.


MG: 12/6/98:	(Rcm:434) nti_gnu now generates its "main" as 'gnu_main'
		rather than 'main'.
		New switch, temporarily 71:  When set, link without 
		console on nti_gnu and nti_ms
		(Rcm:435) nti_gnu:  Now generates a shorter "windres" line,
		by cd'ing to the rcfiles directory.  The previous version
		generated a line that was more than 180 chars for editor.
		The resourcefiles must use '/' not '\' internally when
		specifying filenames for icons, etc.

MG: 16/6/98:	(Rcm:445) nti_gnu now strips executable upon option d
		(Switch[37]) by running external strip program after 
		linking.

OLM: 16/6/98:	(Rcm:446) Bug fix for HPUX to fix various errors in 
		assembler files; job file, and to work on HP UX 10. 
		There are still a few errors left.

OLM: 20/6/98:	(Rcm: 454) Bug fix for HP floating point; for nested external
		calls, the '.CALL' directive was not saved/restored.
		There are still problems with external calls with more
		float arguments than registers.

OLM: 25/6/98:	Bug fix for remaining (known) HP float errors. 
rcm: 461        Now all of tst works for HP.
		------
		First version of new design for shared libraries with
		LIB_DEF and LIB_ELM. Works for tstnx*.bet and bobs

OLM: 3/7/98:	Changed dynamic link to perform relocation in beta image
		buffers instead of memory buffers. To prepare for Valhalla.
		Dynamic load of files will have to be fixed.
		Intel will have to fixed.

OLM: 6/7/98:	Implemented dynamic load and link for SGI.
rcm: 474
		
OLM: 9/7/98:   	Completed OLM:3/7/98 for Intel; Linux works for dynamically
rcm: 476	compiled objects; load of files gives malloc error;
		Status:		compiledObject		loadFile
	  	------------------------------------------------
		sun4s		   OK			  OK
		sgi		   OK			  (1)
		linux		   OK			  (2)
		nti		   (3)			  (3)
		valhalla(sun4s)    (4)			  (4)
		
		(1) must allocate GOT table
		(2) malloc error
		(3) not tested
		(4) being tested 

OLM: 9/7/98:	Fixed (1) above; However, SGI load file sometimes crash!
rcm: 477

OLM: 16/7/98:	Major restructuring of dynlib/imagepair, primarily to
rcm: 486	support Dynamic Valhalla. (4) above is now OK.

		Bug fix for expressions like (FEJL/lowcase.bet)

			(if (c1->lowcase[i]) <> (c1->lowcase[i]) then ...

OLM: 19/7/98:	Change shared libraries on SGI to generate files of the form:

			.../lib/sgi/libfoo.so

		i.e. prepended by 'lib', and link directive of the form

			-L .../lib/sgi/ -lfoo

		But -L should not be necessary

PA: 21/7/98:	Minor clean-up in DYN/private/betaLink.c alignment
rcm: 495	code.

PA+MG: 22/7/98:	Fixes for NTI DYN:
rcm: 500 	1. Strip of .exe in thisExecutable name after NT.init
		   to prevent parsing of dynenv.exe in initialization
		   of dynamic compiler.
		2. Construction of object file name mkObjectFileName
		   was very UNIX dependent.
		   Now fixed (including a lot of SDK crab, which will
		   soon be removed again (when SDK is dropped).
		3. Fixed paths in INCLUDEs in generated OBJxxx.bet
		   files.
		NTI dynenv now works with dynamic compilation of
		objects, AND with load of object files. However
		symbols in DLLs referered from loaded object files
		currently cannot be found - requires loading of
		DLL.

PA+MG: 23/7/98:	DYN changes for NTI:
		1. Fixed relocation of IOA+4 as in "cmp reg,IOA+4"
		2. Implemented nametable.lookupnative by loading all
		   DLL's, that are mentioned in link directive using
		   the LoadLibrary API function, and then using the 
		   GetProcAddress API function.
		   The LoadLibrary call increments the reference count
		   of the DLL, so at some time we should insert a
		   FreeLibrary calle for the DLL's we have loaded.
		   Alternatively we could use GetModuleHandle, which
		   does not increment reference count(?)
		3. Fixed relocation of call memory indirect.
		   This is used when calling DLL entries via a stub in
		   a static library. But when an address is obtained
		   using GetProcAddress, we get the final address in
		   the DLL, and not the stub address. To make the call
		   memory indirect instruction perform correctly we
		   thus allocate a long (using malloc - will not work 
		   out-of-process) and put the DLL address into this
		   cell, and finally returns the malloced address to
		   patch into the call instruction.
		   An alternative would be to patch the call memory
		   indirect instruction to a call direct instruction
		   and using the DLL address directly.
		4. Attempted to used GetModuleHandle(0) to get access
		   to symbols of executable itself (to eliminate the
		   need for nm). This fails since only symbols
		   exported from DLL's can be found by GetProcAddress.
		5. Major cleanup in lookup code: The FindInSelfLibrary
		   function does the same as nametable.lookupnative.
		   But it is a method of imagepair, resulting in
		   dlopen(0) being preformed once for every objectfile
		   that is loaded. So FindInSelfLibrary was eliminated
		   and replaced by using nametable.lookupnative.

		Current status of NTI DYN is:
		a. dynenv works, both with object evaluation and
		   loadfile
		b. Problems:
		   1. symbols in static libraries (e.g. LIBC.LIB),
		      which are NOT used by dynenv itself, but are
		      used by loaded object files cannot be found
		      by using GetProcAddress.
		      Currently there is a hack in nametable_ntibody,
		      where we call fabs, acos etc to get these
		      symbols (used by bifrost) resolved at loadtime.
		   2. Out-of-process DYN will not work. There is at
		      least these problems:
		      - call-memory-indirect is currently relocated
			using malloc. Will have to do a VOP_MEMALLOC
			in valhalla
		      - symbols in DLL's needed by out-of-process
		        loadfile cannot be loaded into outside process
			using LoadLibrary. We will probably need 
			a VOP_LOADLIBRARY and VOP_RESOLVESYMBOL for
			this.
		
		The above explantions will have to be copied into
		code and/or web-documentation!

PA+MG: 23/7/98:	Current status of DYN:

		compiledObject				loadFile
	  	------------------------------------------------
		sun4s		   OK			  OK
		sgi		   OK			  (1)
		linux		   OK			  (2)
		nti		   OK			  (3)
		valhalla(sun4s)    (4)			  (4a)
		valhalla(linux)    (5)			  (5a)
		valhalla(sgi)      (6)			  (6a)
		valhalla(nti)      (7)			  (7)

		(1)  sometimes crashes. Probably because elfreadbody
		     uses 'malloc' instead of 'memalign'. Should be fixed.
		(2)  malloc error - caused by code gen error for 
		     elfreadbody.
		     Temporary fix inserted in elfreadbody
		(3)  OK except for symbols in non-DLL's
		(4)  seems to work
		(4a) How about symbols found via dlsym? 
		(5)  seems to work
		(5a) How about symbols found via dlsym? 
		(6)  ought to work - tested?
		(5a) How about symbols found via dlsym? 
		(7)  See identified problems above.

PA: 24/7/98:	Changed use of malloc to memalign in elfreadbody.
		Tested on sparc only.
		Possibly fixes problem (1) above.

OLM: 24/7/98:	Fixed a bug in dynamic link for SGI; use of memalign was not enough.
rcm: 504	(1) above is now OK in the sense that no problems are known.

OLM: 28/7/98:	Removed 'never tested' in evval2:primIndex and added
rcm: 506	case to tstnewprim.

		Fixed bug in computed remote that might loop: FEJL/row.bet.

		Fixed bug for SUN4S with respect to passing 4 floats as
		arguments to C.
	
		Fixed bug in testing i[] -> o[] where i: @integer.

OLM: 30/7/98: 	Fixed bug introduced by OLM: 28/7/98
rcm: 507

OLM: 2/8/98:	Added file GENERATOR/disass and corresponding body
rcm: 509	files for SGI and SUN4s and a default file empty_disass.bet.
		The purpose is to be able to assemble dynamic compiled
		objects in Valhalla.

		Completed first succesful implementation of Dynamic Valhalla
		on SGI. This required allocation of GOT table in debuggee
		and thus a number of changes in Valhalla.
		The last problem was due to the call of 'nm' in
		nametable_unixbody for sgi which returned wrong absolute
		addresses. After changing parameters to the same as for sun4s,
		Dynamic Valhalla is now starting to work - no known problems.
		(6) above, now works. The 'ought to work - tested?' comment
		turned out to be a lot of work:-)

OLM: 9/8/98:	Introduced more LIB props.

OLM: 11/8/98:	Fix in shared library handling for SGI due to bug in SGI
rcm: 517	linker. Too many '-L path' directives can make the linker 
		crash with a segmentation fault.

OLM: 12/9/98:	Bug fix in genlib:genprefix. Computation of originOff might
rcm: 518	crash the compiler when the originDesc was a doPart slot.
		Furthermore originOff has not been in use for a long time.
		All uses of bAdr.originOff has thus been eliminated.

OLM: 13/8/98:	Bug fix for:
rcm:519		   do (# do (for i: 10 repeat 'hest' -> putline for) #)
		the descriptor is no longer inlined in this case.
		A more clever check may improve this.
		The insertable check in chkdesc and chkevalbody should
		be moved to initterm.

OLM: 15/8/98:	Bound exceptions underflow and overflow in 
rcm: 520		chkevalbody:getnumber.
		Comments around low level debug code.

OLM: 16/8/98:	Bug fix to be able to handle '-2147483648' (minInt)
rcm: 521	as unary exp. However minInt in
			E - 2147483648 
		will not work. Can be fixed, but a bit more complicated
		and we are too close to a freezing r4.2.

OLM: 16/8/98:	Bug fix to eliminate qua check in FEJL/hmlqua,
rcm: 522	but only effective with switch 199 since we are
		close to freezing r4.2.
	
OLM: 21/8/98:	Bug fix for COM/holder types.
rcm: 528	Who has made the changes from 522 -> 528 and
		what are they?

		Codegen of run-time routines for sgi: xCopySVR, xQua, ...
		Must be checked and then changed to CopySVR, Qua, ...

rcm: 529-533	Who has made these changes and what are they?

OLM: 23/8/98:	Fix for SGI to handle Qua errors such that Valhalla can
rcm: 534	shown the code correctly. These corrections are also
		made for CopySVR1, etc.

OLM: 23/8/98:	Extra fix for SGI, Qua, Valhalla problem to avoid GC
rcm: 535	problems.

??? 23/8/98	More SGI valhalla GC fix. (MIPSmachine)
rcm: 536

??? 23/8/98		
rcm: 537	MIPSmachine: SGI Qua problem

MG: 24/8/98	Removed support for SDK and target=nti.
		SDK is now gone for good 
rcm: 538

??? 24/8/98	Made small changes to macspecific body file
henryml?	PPCmachine.bet:  Added -- getImages: doPart --
		PPCMACasmlink.bet:  Added containerList because
                list have been shadowed by list in MPS

rcm: 539

??? 25/8/98	PPCmachine:  call to saveDbgInf added.
rcm: 540

MG: 27/8/98	Removed hack to remove jobfile, as it also removed
		the jobfile berofre sif could execute it.  The problem
		with jobfiles sticking around should be solved elsewhere.
rcm: 541 (r4.2a)

PA: 1/9/98:	In the case of call-by-value of structs for COM a trap
rcm: 542	is now generated to make sure, that spurious
		non-deterministic errors do not occur because of the
		missing code generation. Now (on intel at least) an
		unconditional break will occur to indicate the error.
		The result on sparc will be a "tle 17" instruction,
		since I did not want to change the trap code on sparc
		close to release freeze. Added comment in SPARCmachine
		with this.
		Affected files:
		  SYNTHESIZER/computedAdrVal.bet (ComputedAdrVal.asgToItem)
		  GENERATOR/INTEL/INTELBmachine.bet (trap)
		  GENERATOR/INTEL/intel.bet (int3 instruction)
		  GENERATOR/SPARC/SPARCmachine.bet (comment)
		  CHANGES

PA 2/9/98	Comment on how to build profiling betarun
rcm: 543

OLM: 3/9/98: 	Bug fix for missing push of NONE for wtext
rcm: 544

OLM: 6/9/98	Fixing some comments in DYN
rcm: 545

PA: 9/9/98:	Introduction of symbolic conditions in com.bet
rcm: 546	Use of symbolic conditions in entire INTELBmachine.bet
		(cond_ne etc).
		Moved definition of process_offset from
		DYN/private/betaLink.c to
		DYN/external/labelnametable.c.

PA: 9/9/98:	Fixed DYN to use external lookup of symbols in case of
rcm: 547	out_of_process linking (valhalla).
		Tested for SGI.

PA: 9/9/98:	Added -ldl in link directive on sun4s if not nodebug
rcm: 548	runtime system. This is needed because of the rcm-547
		change. May be needed om other unix'es as well (code
		may be duplicated from SUN4SBasmlink).
		Affected: GENERATOR/SUN4S/SUN4SBasmlink.bet.

(rcm:549 is r4.2b branch)

MG: 10/9/98	Changed versionnumer of compiler to 5.4.4 to distinguish
rcm:550,551	it from 5.4.3 that is used in the branch for r4.2b

PA: 10/9/98:	Fixed LINUXBasmlink the same way as (rcm:548).
rcm:552		Allowed external exit type 7 (stdCallBackExt) to be 
		treated as C return on MIPS (as on SPARC).
		Affected:
			GENERATOR/LINUX/LINUXBasmlink-libraries:descriptor
			GENERATOR/MIPS/MIPSmachine-getXres:descriptor

PA: 15/9/98:	Changes to fix valhalla dynlink (evaluators).
rcm:556->558	Minor changes in DYN/nameTable and
		DYN/private/nametable_unixbody (mainly improved
		tracing).
		Fix in GENERATOR/LINUX/LINUXBasmlink-libraries to
		include -export-dynamic when using -ldl.

		(The coming rcm number is hard to figure out when
		there's an active branch. I used 'vg a' to see
		all version and could see that the highest number in
		the branch was 557. So assuming no-one reaches to
		commit things in the branch before I am done writing
		this, it should be correct, that my change results in
		version 558. Tedious...)

		BTW: This change should be made in the branch too.

PA: 15/9/98:	Fix in DYN/private/imagepair_linuxbody to handle
rcm:558->559	relocation of 
			   cmpl IOA+4,%esi
		correctly.

		BTW: This change should be made in the branch too.

OLM: 21/09/98:	Bug fix for 'maersk' problem with 'f: (#exit(#exit true#)#)'.
rcm: 560	Bug fix for '(for ... repeat origin.x ... for)'; added
		tstOrigin to tst.bet.

PA:		Added SynchronizeFPU pattern for debug purposes.
rcm: 563,564

PA:		Moved DYN/nameTable et.al. out of compiler and into
rcm: 656->567	toollibs/labelnametable. The code in there will later
		be merged with almost identical code in debugger and
		betarun (to avoid maintaining 3 copies and to supply
		generally usable abstractions for labelname lookups.

		Also moved DOC/PDF into 
		http://www.daimi.aau.dk/~devise/Internal/beta/PDF
		and removed (recursively) this component from RCM.

		Since RCM does not delete associated files when
		components/files are removed from a component, you
		should remove the following files from your
		local workspace after 'gettip':

		DYN/nameTable.*
		DYN/external/
		DYN/private/nametable_*
		DOC/PDF/

OLM: 9/10/98:	Added switch 76 to generate virtual dispatch as if
rcm:568		all prototypes are in COM format.
		See gen1body.bet:newvirt:  grep switch[76]

MG: 9/10/98:	Added -rpath (on linux,sgi) and -R (Sun4s) to link
rcm: 570,571	statement for every -L directive.  This makes it 
		unnecessary to set LD_LIBRARY_PATH unless the libraries
		the executable depend on are moved.
rcm 573		Removed that -rpath code again, it forbids moving the 
		libraries...

PA: 12/10/98	Execution of job file is now donw even when 
		--nolink is specified. 
		Affected:
			GENERATOR/asmlink.bet

PA: 12/10/98	Unconditional generation of .db files.
rcm: 573->574	Cleanup in switches related to valhalla.
		There was previously 3 switches related to valhalla:
		  37 specified that stabs should NOT be generated
		  55 specified that object files should be called foo.go
		  41 specified that .db files should be generated.
		Other related properties, such as whether application
		should be stripped, whether to use betarun with
		valhalla support and whether to call BeginMpart etc
		when generating code was then derived from these 3
		switches in a non-standard way.
		Both switch 55 and 37 expressed obsolete features.
		I have now 
		  Eliminated switch 37 and 55
		  Defined switch 41 to mean:
		  41: Use runtime system with valhalla support
		      (betarun_v) and do not strip executable for 
		      debug symbols.

		Affected:
			GENERATOR/HPUXPA/SNAKEasmlink.bet
			GENERATOR/HPUXPA/SNAKEmachine.bet
			GENERATOR/LINUX/LINUXBasmlink.bet
			GENERATOR/LINUX/LINUXasmlink.bet
			GENERATOR/MIPS/MIPSmachine.bet
			GENERATOR/NTI/NTIBasmlink.bet
			GENERATOR/NTI/WIN32coff.bet
			GENERATOR/SGI/SGIasmlink.bet
			GENERATOR/SPARC/SPARCmachine.bet
			GENERATOR/PPC/PPCmachine.bet
			GENERATOR/PPCMAC/PPCMACasmlink.bet
			GENERATOR/PPCMAC/PPCMACxcoff.bet
			GENERATOR/PPCMAC/PPC_appendToBC.bet
			GENERATOR/SUN4S/SUN4SBasmlink.bet
			GENERATOR/CODEmachine.bet
			GENERATOR/asmlink.bet
			GENERATOR/machinebody.bet
			CONTROL/systembody.bet
			CONTROL/interactive.bet
			SYNTHESIZER/dobody.bet
			SYNTHESIZER/prototypebody.bet
			SYNTHESIZER/synthesizerbody.bet
			DOC/Switches.html

PA:  14/10/98	Fxi LIB_ITEM in GENERATOR/ELF/elf.bet
rcm: 575#

MG:  14/10/98   Always include -L/usr/X11R6/lib in link.
rcm: 576

PA: 14/10/98	Fixed typo introduced in LINUXBasmlink in rcm:574.

PA: 19/10/98	Fixed linkTrailer for sun4s and linux to remove
rcm: 578	temporary files *after* having tested linker status
		code.

PA: 20/10/98:	Removed unused log2phys function from
rcm: 579+580	DYN/private/betaLink.c

PA: 20/10/98:	NTIBasmlink: Preserve rsp file if switch[23].
rcm: 581

PA: 20/10/98:	NTIBasmlink: typo committed from unix, since I cannot
rcm: 582	use RCM on NT.

PA: 20/10/98:	NTIBasmlink: another typo committed from unix, since I cannot
rcm: 583	use RCM on NT.

PA: 20/10/98:	LINUXBasmlink: Now tests for /usr/lib/crtbegin.o and
rcm: 584	/usr/lib/crtend.o before attempting to link these for 
		debug purposes (bacause DAIMI changed delirium set-up (:-())

PA: 28/10/98:	SUN4SBasmlink: Now links with 
rcm: 585	betarun.a/betarun_v.a/betarun_debug.a archive files
		instead of object files. Gives slightly smaller
		executables and faster linking, since unrefererenced
		parts of betarun are not linked in.
		Requires that you do a 'cvs update; make all' in your
		sun4s betarun directory.

MG: 30/10/98	NTI{MS|GNU}beta:  Use expandWildcardsArgumentHandler.
rcm: 586

PA: 2/11/98:	Changes for COM prototypes (switch[76]).
rcm: 587	1. SYNTHESIZER/gen1body-NewVirt:Descriptor
		   Fixed off-by-one error in rcm568 change.
		2. SYNTHESIZER/gen1body-exeTop:descriptor
		   Added switch[76] code for calling reference
		   qualified by Object.
		3. SYNTHESIZER/dobody-GenDo:doPart
		   Added switch[76] code for calling INNER.
		4. SYNTHESIZER/gen-generator:descriptor
		   Added comment to exeTop (please check).
		TST/tst now runs when compiled with switch[76]
		and linked with betarun with COM defined (C/define.h).
		Also with BETART=IOA=35, which causes (IOA) GC's.

PA: 4/11/98:	Changes for COM prototypes (switch[76]).
rcm: 588	1. SYNTHESIZER/gen1body-exeTop:descriptor
		   Added switch[76] code for calling reference
		   qualified by Object in b2c case.
		   Is 'b2c' really used for sgi???
		tst now runs on sgi with COM prototypes too.
		OLM: 'b2c' is NOT used by sgi.

OLM: 6/11/98:	Renamed foo-betadata.obj to foo.ast.<modtime>.obj (.s)
rcm: 589	which is removed after execution of the job-file.
		Note, <modtime>..db is also generated and removed.
		switch '-p' does NOT remove these files.
		Started to use toollibs/utils/fileExtensions. Will
		slowly introduce it everywhere. THUS BE AWARE of problems
		with file extensions and dependency analysis.
		Changes are in translate_controlbody and asmlink.

OLM: 6/11/98:	Eliminated warning for using a virtual in a final2virt
rcm: 590	binding (warning 99).

OLM: 10/11/98:	Fixed bug in OLM:6/11/98.
rcm: 591

HML: 12/11/98:  Fixed the path for the beta-data file in
rcm 592         translate_controlbody. Now the path is
                a full path instead of a local path.

OLM: 15/11/98:	HP: In calls of AlloI, etc., the delay slot is now
rcm: 594	used to load 2. half of prototype to CallReg.
		Same optimization have for a long time been done on sun4s.

PA: 16/11/98:	Added taddcc, taddcc_i, taddcctv, taddcctv_i, tsubcc, 
rcm: 594+	tsubcc_i, tsubcctv, tsubcctv_i to
		GENERATOR/SPARC/sparc.bet
		To be used for persistence experiment. NOT TESTED!.
		[cannot check in from root, since other components
		are rcm-locked by other users]

OLM: 16/11/98:	Added Switch 77 to (Desarte) experiments with persistence.
rcm: 595	In R.foo where R: ^ T, none check for R is replaced with
		a memory read for the value of R. This will give a read
		at adr zero if ref is none. Switch 77 will also give
		a ref none check of this form for constant references:
		virtual part objects, and part objects described by 
		descriptor slots. No none chcek has been introduced 
		for origin references.

OLM: 16/11/98:	Added .LEVEL 1.1 to head of assembler files generated by
rcm 596		the HP compiler to avoid floating point reg warnings.
		.LEVEL 1.1 specifies that the assembler assumes (at least?) 
		PA-RISC 1.1 architecture. For the compiler, the main
		difference is that 1.1 has 32 floating point registers 
		whereas 1.0 only has 16.

rcm: 597:	Not described.

PA: 23/11/98:	Activated instruction counting in
rcm: 598	GENERATOR/HPUX9PA/SNAKEmachine 
		(pattern GenerateDbgInfo).

OLM: 29/11/98:	Made support in CHECKER/scanBetaText for handling
rcm: 600		lexical string units of the form
			'abcde'  'fghij' 'klmn'

OLM: 29/11/98:	Fixed real bug for expressions like: (-4.0) - (-8.0)
rcm: 601

OLM: 30/11/98:	Replaced a number of occurences of "''"(double quotes)
rcm: 602	in strings by "\'".

OLM: 30/11/98:	Clean-up plus fix of ref. is none if no origin.
rcm: 603

PA: 1/12/98:	Reversed meaning of switch[76]: Now means pre-COM
rcm: 604	prototype layout.

PA: 1/12/98:	Changed compiler version to 5.4.5.
rcm: 605	

OLM: 5/12/98:	Included (OLM: 16/8/98: rcm: 522) without switch 199.
rcm: 606

OLM: 6/12/98:	Fixed a virtual problem /FEJL/hohn1
rcm: 607

PA: 8/12/98:	Disassociated the files
rcm: 608	  abeta.bet
		  acompiler.bet
		which are not used anymore.
		Please remove abeta.* and acompiler.* manually
		from RCM workspaces.

OLM: 9/12/98:	Fixed problem with jobfilepermissions (ChangePermError:  
RCM: 609	Under what conditions does the execption ChangePermError be called? 
		Most access problems to the job file gets handled in openWrite.)
		Added new file GENERATOR/UNIXasmlink; general unix related stuff
		should be move here from XXXasmlink. So far only done for SGI and SUN4S.


OLM: 12/12/98:	Fixed syntexerrror problem with 'beta -s 12 13f foo'.
rcm: 611	Added switch 78 to FORCE compiler to crash with refIsNone.

MG:  14/12/98:	Fixed BetaMake in LINUXBasmlink.  There were two ''
rcm: 612	in strings that should be \'

OLM: 14/12/98:	Fixed OLM:9/12/98 also for LINUX and HPUXPA;
rcm: 613:	Added missing exceptions to lstFile in translate_controlbody.

PA: 15/12/98:	Changed LIB_DEF in image and imagebody to avoid
rcm: 614	warning.

PA: 18/12/98:	Added purify instrumentation when using switch 37.
rcm: 615

PA: 18/12/98:	Modified purify instrumentation.
rcm: 616

OLM: 20/12/98:	STATE experiments
rcm: 617

PA: 28/12/98:	Minor fix in GENERATOR/SGI/SGIasmlink, where resent
rcm: 618	change (by me) caused .so files generated in sgi
		directory (e.g. sgi/valhalla1..so) to be removed
		after linkage!

OLM: 29/12/98:	Fix of storage allocation problems for mainPart slots.
rcm: 619	There is now no know errors for mainPart slots.

OLM: 31/12/98:	More on mainPart slots.
rcm: 621

OLM: 2/1/99a:	Bug fix for inner in static items (FEJL/staticinner)
OLM: 2/1/99b:	Added new compiler exception: otherFileError,	
rcm: 622	Added call of otherError for lstFile

olm: 3/1/99:	Switch 180 fix; problem with repetitions in FEJL/zrep.bet.
rcm: 623	Critical changes in machine on frozen,addOff,release,...
		
olm: 4/1/99:	Bug fix for attach of components in exit-part on sgi
rcm: 624	OBS! This should also be a problem on PPC, but I cannot
		see now (tired:-) how to fix it on PPC. This MUST be
>>>>>>>>>	checked later.

PA: 5/1/99:	Split up DOC/NewPrim.html into DOC/lowlevel.html
rcm: 625	(public) and DOC/unsafe.html (secret).

OLM: 5/1/99:	Separated part of switch 61 into switch 79; for passing
rcm: 626	SP and this to Qua, CopySVRx, etc. 

PA: 7/1/99:	More changes to DOC/lowlevel.html.
rcm: 627	Added descrition of wrapper frames in DOC/SGI.html.

OLM: 20/1/99:	Experiments with repetition improvements.
rcm: 634	Clean-up necessary in chklst and listVal:asgToRep, etc.

OLM: 31/01/99:	Further experiments with repetition improvements.
rcm: 635-637	Clean-up for CopyT calls - a mistake here may give errors
		on SGI and MAC. SGI compiler has been tested.

PA: 4/2/99:	Fix for -dld link on LINUX and SUN4S:
rcm: 641	We have to include -ldl all the time: Even when using -d.
		The reason is that when a Personal Edition is sent to
		people, both betarun.o and betarun_v.o will in fact be
		betarun_pe.o, which now refers the dlXXX symbols.
		So if we do not include -ldl, people will get
		unresolved symbols when using 'beta -d'.

PA: 5/2/98:	Moved DOC/lowlevel.html to general BETA documentation
rcm: 642	(http://www.daimi.au.dk/~beta/doc/beta/lowlevel.html).
		File should be removed manually from RCM work spaces.

OLM: 15/02/99:	Further work on switch 180: new enter/exit format with
rcm: 643	N- and X-entry points for complex enter- exit-parts.

OLM: 21/02/99:	Bug fix for error made in OLM:31/01/98;
rcm: 644-646	Fixed symbol type for TextProto, BetaStacktop, _environ,
		to eliminate linker warnings for Solaris 2.7.

OLM: 23/02/99:	Integrated use of betaast/scanBetatext;
rcm: 647	Bug fix for  (intObj div 2) -> R.%getShort

PA+MG: 24/2/99: Changed INTELBmachine:tstNone to generate trap on 
rcm: 648	NONE if using switch 77.
		Also added 32 bit float instructions to intel.bet
		(fadds, fsubs, ...).

PA: 24/02/99:	Call of function in RTS in case of call-by-value of
rcm: 649	struct in COM virtual instead of unconditional trap.
		
OLM: 25/02/99:	Changes to handle cStruct/data call by value from
rcm: 650-651	external COM


MG: 26/02/99:	Changes Repetitions to be marked as offline parts in
rcm: 652	GCTables.  Eksperimental, it is not clear if this is
		sufficient or breaks other stuff.  (For Desarte)

OLM: 09/03/99:	Bug fix for mainparts.
rcm: 653	Implementation of cstruct value parameters for COM
		(only for Ixx processor). tstcom gives '!' on other
		platforms.
		Further repetition constructor implementation.
		Various restructuring.
===========>	There are some problems with this version and perhaps
		earlier compiler versions. On sun4s seg. faults happen
		frequently when compiling a compiler. So be careful
		with this version. 

OLM: 18/03/99:	Fixed CopyT problem for SGI.
rcm: 654

OLM: 22/03/99:	Reorganization in machine.bet to prepare for generation
rcm: 655	intermediate form.

OLM: 23/03/99:	More reorganization; bug fix for various COM errors.
rcm: 656

OLM: 24/03/99:	Fixed 'boolean' in initterm to be 'unsigned'; 
rcm: 657	This change is related to a previous change since
		in R.S, the address was always signed, but should
		be unsigned. This was an error if e.g. S: @int16u.
		The same error applied to boolean, since boolean is
		essential int8u. However signed or not does not make
		a difference for boolean. Boolean has always been marked
		signed, but this has now been changed to unsigned.

OLM: 3/4/99:	Continued reorganization of machine to prepare for generation
rcm: 657	of intermediate form. 	
		NOTE: initialization of floatStackUnit has been move; MUST
		be tested for INTEL, but today is not possible to log into
		delirium.

OLM: 6/4/99:	Fixed missing else-bug introduced when adding switch 80
rcm: 658	to select betarun_ugc.

OLM: 8/4/99:	Introduced test for NULL pointer for COM holders.
rcm: 659

OLM: 25/4/99	Finished first implementation of call-by-value
rcm: 660	for data/struct as enter/exit parameters. 
		NOTE: only for INTEL - not for SPARC;
                      ONLY as interface to external; a BETA COM component
		      cannot have data as call by value enter/exit.
		Fixed problem with illegal registers for holders on intel.
		More reorganization to prepare for gen. of intermediate form.

OLM: 26/04/99	Bug fix for registeroverflow for FEJL/kasper1.bet
rcm: 661

OLM: 3/5/99	Bug fix for mainPart slots (bdraw/dialog)
rcm: 662	More reorganisation to prepare for gen. of intermediate form.

OLM: 5/5/99	Bug fix for mainpart slots. Virtuals and part objects
rcm: 663	in mainpart (another bdraw problem)

OLM: 6/5/99:	More reorganisation to prepare for gen. of intermediate form.
rcm: 664	For MIPS/SGI external result.

OLM: 13/5/99:	(I guess that 665 is Mac corrections by HML?)
rcm: 666	Completed reorganisation for gen. of intermediate code.
		Checked compiler for: sun4s, sgi, linux and hp.
		Nti and Mac must be checked also. A few problems are
		known for the Mac and being fixed.
		The most drastic change is with respect to code gen. for
		getting the result of an external function. The interface
		has been simplified. The pattern getXres has been replaced by
		several patterns: getSimpleXres, etc. GetXres is still
		in the code, but will be eliminated.
		There is a need for cleaning-up the code since placement
		of slots in files is more or less arbitrary.
		--------------
		Fixed a number for bugs for switch 180: new code gen. for
		complex enter/exit lists. tst*.bet works with switch 80 on:
		sun4s, sgi, linux and hp. An r5.0.x compiler can be compiled
		and the resulting compiler can compile tst*.bet. It cannot
		compile mjolnertool. The problem is known.

OLM: 16/5/99:	Fixed 2 bugs for switch 180: register overflow and another
rcm: 667	missing ChkRA. Th errors made a compiler compiled with
		switch 180 break (dispite the statement in OLM: 13/6/99:-()
		Now it does NOT break. Tested with IOA=4 (it breaks when
		compiling tstreal, but so does a compiler with no switch 180;
		with IOA=8 it completes compilation). 
		For switch 180, the only known problem is the one reported 
		above: problems with compiling mjolnertool. 
		The problem is virtual patterns in N/X parts.
		----
		Fixed 2 bugs in new code for getting external results for
		PPC (Macintosh). Not yet tested.

OLM: 16/5/99:	Two bug fixes for new code for external results (text and 
rcm: 668	dataRef). Now tst*.bet works for for PPC also.


OLM: 23/5/99:	PA: fixed SPARC stack problem for primtive operations like QUA;
rcm: 669-670	is not yet installed, but controlled by a switch.
		More bug fixes for switch 180; to handle probmes with compilting
		mjolnertool. There are still some bugs to fix.
		Fixed new error introduced for stdCall for SPARC.

PA: 28/5/99:	Enabled gcc_frame_size, which makes SPARC beta frames look
rcm: 671	like gcc frmaes. This eliminates old errors, that
		could cause local variables in functions called from
		beta to be overwritten at a sparc register window
		flush.

OLM: 29/5/99:	Minor optimization for CopyCT for SPARC for returning an
rcm: 672	external text.

rcm: 673?

PA: 15/6/99:	Fixed handling of floating point registers on SPARC stack.
rcm: 674	Previously two strategies were used:
		1. When calling BETA PushDataReg pushed all float regs
		   (from %fr0 to the last busy one) one at a time and
		   then a tag indicating to the GC that these should 
		   not be considered roots.
		2. When calling externals, one chunk of stack was
		   allocated in initExternalCall and saveFloat then
		   saved all busy registers using offsets into this
		   stack area. No tag was pushed.
		I have now cleaned up this so that strategy 2 is used
		in both PushDataReg and initExternalCall AND a tag is
		pushed in both cases.
		This was necessary since the quick solution made in
		rcm 669-671 (which tried to eliminate solution 2)
		turned out to make cpn demos fail.
		Now tst (even with unconditional GC) and cpn
		prototypes work.
		I have updated the large comment in initExternalCall
		which explains this strategy.

PA: 21/6/99:	Experimenting with generating n32 object files for SGI,
rcm: 675	since this will allow linking with gcc produced files
		(and since it is unknown how long SGI will support o32
		format).
		Using switch[84].
		Also changed a little in jobfile output in case of
		shared libraries - now suggests a LD_LIBRARY_PATH
		setting.

PA: 21/6/99:	Changed SGIasmlink to generate temporary shared
rcm: 676	libraries directly in the directory where they should 
		eventually be put. And so_locations file is generated
		there too. This is done by changing directory to the
		target directory before linking, and then back
		afterwards. See ldUNIXtmpfile.
		It is hoped that this will make rld handle the .so
		files better (and thus possibly speed up runtime
		link).

PA: 25/6/99:	Added support for switch[77] for MIPS, PPC, HPPA.
rcm: 677	Has not been tested for any of these platforms.

MG: 06/7/99:	Fixed doGC for MIPS. Appears to work...
rcm: 678	Changed linkdirective on linux for RedHat 6.0. Untestet.

MG: 09/7/99:	Made switch 77 default on all platforms.
rcm: 679	

MG: 09/7/99:	Fixed switch 77 code on HP: (Missing parenthesis)
rcm: 680+681	

PA: 19/7/99:	1. Implemented SPARC mul/div using SPARC V8
rcm: 682	instructions.
	FIXME:	Uses three flags (sparc_v7, sparc_v8, sparc_v9)
		which should not be hard coded, but should each
		exit a common.switch[??].

	FIXME:	2. SPARCmachine: Analyzed use of temporary float
                registers. Comments marked with
                "datpete-tmpFloatAlloc:" identify places to change in
                order to get fully allocated/deallocated sparc tmp
                float registers. This will lead to fewer save/restore
                of floating point registers during calls, since once a
                tmpFloat has been used once in the current solution,
		one of the two tmpFloat registers remain busy the rest
                of the time.

		3. Attempt to fix stack saving of floating point
                registers and busy %o-registers in general.
		Major restructuring of XInitOreg, XFreeOreg,
                PushDataReg, PopDataReg. Eliminated saveFloat,
                restoreFloat, PushOregisters, PopOregisters.
		Added SaveBusyReg, RestoreBusyReg.
		These are documented in 
		http://www.daimi.au.dk/~beta/doc/betarun/internal/SparcStack.html
		which ./SPARCstack.html now redirects to.
	FIXME:	The above changes does NOT work!!!
		They have been committed to make shared debugging
                available.
		
PA/OLM: 20/7/99 Fixed (2) and (3) above. We hope:-)
rcm: 683

PA: 20/7/99:	Fixed bug in sparc divide.
rcm: 684

OLM: 24/7/99:	Final elimination of getXres - was not use anymore, except
rcm: 685	in PPCmachine.bet:ConvertInt2Float; here getFloatXres
		is used; MUST be checked on the MAC.

OLM: 26/7/99:	Added basic COM support for SGI/MIPS - started on HPUX9PA,
rcm: 686	but there are apparently problems with compiling ctstcom.c.

OLM: 27/7/99:	Removed some unused code from SNAKEmachine to handle
rcm: 687	cases where external calls could happen without a call
		of initExternalCall. This can no longer happen.
		Changes mainly in pushCparameter.

OLM: 28/7/99:	Eliminated old debug slots like debugImpInfo.
rcm: 688

OLM: 1/8/99:	Added support for in64 values as external arguments/return 
rcm: 689	values for sun4s, sgi, hpux9pa, ppc. ppc is NOT tested.
                Cannot test linux and nti, but they should work in principle.
		However, int64 values may need to be pushed in reverse order.
                Currently 2 32-bit values are pushed. On Intel the order
		may have to be reversed.

		Changed none-test on hpux to use a real register
		instead of %r0. However, it does not seem to catch none errors.

		Fixed some COM problems with cal-by-value of data/struct
		for MIPS.

OLM: 5/8/99:	Added support for struct call-by-value return from external
rcm: 690	for nti to handle cases when size=4,8. NOT tested.

MG: 5/8/99:	Removed use of 's' 't' string concat, as bootcompiler
rcm: 691	cannot handle it. (SPARCmachine)

OLM: 8/8/99:	Fixed problem with missing pop of stack space allocated
rcm: 692	for a call-by-value-struct for a COM virtual (Intel).
		Added support for save/restore of float regs on Intel.

PA: 10/08/99:	Fixed bug in SPARCmachine-XFreeOreg.
rcm: 693	The bug caused the newly added GlEllipse pattern in
		TST/tstreal to give segmentation fault on sparc
		because the stack was broken.

OLM: 16/8/99:	Bug fix: a real value transferred to an external with
rcm: 694	integer argument was NOT converted to an int. Tested
		on sun4s and Linux.

PA: 16/8/99:	Fixed bug in SPARCmachine-SaveBusyReg.AllocateSpace.
rcm: 695	Necessary to keep more track of who
		allocates/deallocates stack space (XinitOreg or
		PushDataReg).
		Fixes bug that caused newly added realAndText in
		TST/tstreal to crash on sparc.

OLM: 21/8/99:	Fixed bug in save/restore of float regs on Intel (rcm 692).
rcm: 696	Status: used 695 to compile the 696 on sun4s, sgi, 
		linux and hpux9pa; used resulting compiler to compile and run
		tst on all these platforms: tstint8 has problem with a64 on 
		hpux9pa. In addition there are well known problems with 
		call-by-value of struct.

OLM: 23/8/99:	Fixed bug introduced in itemevval:asgToCproc in one of the
rcm: 697	above corrections since 688. tst tried on sun4s and linux.

PA:  27/8/99:	Minor change in asmlink+SGIasmlink in attempt to
rcm: 698	prevent double occurences of -L linker directives, when
		only difference in paths are slashes.
		Addition of -L directive for each component in LD_LIBRARY_PATH.
	
OLM: 29/8/99:	Turned off a number of internal tests.
rcm: 699

OLM: 30/8/99:	Bug fix for error introduced in 699:-(
rcm: 700

OLM: 2.9.99:    Added component ABSTRACT to GENERATOR. Moved 
rcm: 701	INTERMEDIATEmachine.bet to ABSTRACT. ABSTRACT is ONLY 
		used by Flemming and Anders for their thesis project on 
		code optimization. It is NOT called by a normal compiler.

MG: 3/9/99:	Enabled both switch 77 and old RefNone test on HP.
rcm 702+703	

FG: 3/9/99:	New file: HPimageread, used in DYN, but empty.
rcm 704

OLM: 4/9/99:	Fixed bug in rcm 702+703 in SNAKEmachine tstnone.
rcm 705:

FG: 6/9/99:	New File, imagepair_hpux9pabody, but empty.
rcm 706		Also hacked nametoaddresstable and debuggers coreaccess.

OLM: 8/9/99:	One more fix for call-by-value-data/struct for COM on NT.
rcm: 707:	Attempt to fix correct pop of stack for R->proto->g5(R,q).
		There are stil problems with return of struct-value.

OLM: 8/9/99:	Attempt to fix yet another bug for return of struct for
rcm: 708	COM on NT. A missing pop of the returned struct was added.
		There is still a problem with a wrong 4-offset to the
		struct. 

OLM: 17/9/99:	First attempt to generate wrappers for Qua, etc.
rcm: 709	for Valhalla Adaption on PowerMac.

OLM: 27/9/99:	Attempt to fix save of float stack on Intel using 
rcm: 710	fnsave/frestor. Currently switch 85 must be used
		to test this fix. If it works switch 85 must be eliminated
		before freezing.

MG: 27/9/99:	Fixed error in 710: The tag pushed to keep the floats
rcm: 711	away from the GC was too large.
		Also enabled switch 85 by default in systembody.

