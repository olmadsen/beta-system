<html>
<head>
<TITLE>BETA.NET Implementation Notes </TITLE>

<body>

Currently quite incomplete!

<h1> Introduction </h1>
This page is for collecting notes regarding low level
implementation of byte code generation.

<h3>Order of Arguments on Evaluation Stack</h3>

The BETA compiler has to be tuned in order to place arguments on the
evaluation stack in the order expected by the (Java) VM.
<p>
The Java VM has the following instructions:
<ul>
<li>
istore index
<br>
which stores the value on top of the stack in the local value at
'index'.
The compiler generes code in the right order for storing 
local variables of methods.

<li>
putfield field
<br>
which expects the following on the stack
<br>
...,objectref,value
<br>
The value 'value' is stored in the field 'field'
of the object refrerred by 'objectref'.
Note that on the stack, the object reference is below the value to be stored.
<p>
The BETA compiler does not handle this correctly.

</ul>

For the BETA compiler we must consider the following cases
to ensure a correct evaluation order with respect to the stack:

<p>
<ul>
<li>
10 -> x
<li>
y -> x
<li>
x+y -> z
<li>
(e1,e2,e3) -> foo -> x
<li>
e -> foo -> x
</ul>

<h3>Accesing global fields in enclosing objects</h3>
A nested class has an extra field, origin, which is a reference to the
enclosing object. Origin is defined by the constructor of the class.

<p>
Extra fields have been added to Address-objects:
<ul>
<li>isOrigin: true if this is the address of an origin-object
<li>ONlevel: the number of block levels from name application
to this address.
<li>isRef: true of this is the address of a reference to an object
</ul>

<p>
To access enclosing objects via origin, we need the name of the enclosing 
class to generate a correct type for Jasmin.
The bookkeeping for such names is done
in BCmachineBody.
The ONlevel of an Address-object is used to get the class-name.


</body>
</head>
</html>
