<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<title>Source Level Debugging</title>
<link rev="made" href="mailto:beta@daimi.au.dk">
<LINK REL="stylesheet" HREF="http://www.daimi.au.dk/~beta/doc/style/miadoc.css" TYPE="text/css">
</HEAD>

<BODY>

One of the advantages of using JVM and .NET is that if we generate
sufficient debug information the execution platforms directly support
source-level debugging of BETA code in their respective tools.

Below are preliminary examples of this for both .NET and JVM.

<UL>
<LI><A HREF="#dotnet">BETA.NET source level debugging</A></LI>
<UL>
<LI><A HREF="#vsnet">Debugging using Visual Studio .NET</A></LI>
<LI><A HREF="#dbgclr">Debugging using DbgCLR.exe</A></LI>
<LI><A HREF="#cordbg">Debugging using CorDBG.exe</A></LI>
<LI><A HREF="#il">IL debugging</A></LI>
</UL>
<LI><A HREF="#java">BETA.Java Source Level Debugging</A></LI>
<UL>
<LI><A HREF="#jdb">Using jdb</A></LI>
</UL>
</UL>


<H2><A NAME="dotnet">BETA.NET source level debugging</A></H2>

You can source level debug BETA programs compiled for .NET with both
the free stand alone debuggers <CODE>DbgCLR.exe</CODE> (graphical) and 
<CODE>CorDBG.exe</CODE> (textual) supplied with the 
<A HREF="http://msdn.microsoft.com/downloads/default.asp?url=/downloads/sample.asp?url=/msdn-files/027/000/976/msdncompositedoc.xml">.NET Framework SDK</A>
as well as with the built-in debugger in Visual Studio .NET.

<H3><A NAME="vsnet">Debugging using Visual Studio .NET</A></H3>

To use Visual Studio .NET for BETA source level debugging, do this:

<OL>
<LI>To debug foo.exe produced from foo.bet, you first choose menu item
    <CODE>[File->Open Solution...]</CODE>.
   
<LI>In the dialog that appears, you choose 
    <CODE>Files of types: All project files</CODE> and navigate to <CODE>foo.exe</CODE>.
    Double click <CODE>foo.exe</CODE>.

<LI>Now set a breakpoint at the beginning of the program:
    From menu item <CODE>[Debug->New Breakpoint (Ctrl-B)]</CODE> specify
    breakpoint in Function <CODE>program.do</CODE>.

<LI>Now start the program using menu item <CODE>[Debug->Start (F5)]</CODE>.
    The program will now stop at the do-part of the <CODE>PROGRAM</CODE> fragment.
    You can now single step, inspect variables etc. at BETA source
    level.
</OL>

Below is a screen shot showing a debugging session (slightly reduced
size; click image to see it in full size in a separate window):

<BLOCKQUOTE>
<A HREF="visual_studio_net_debug.jpg" TARGET="_blank">
<IMG SRC="visual_studio_net_debug.jpg" WIDTH="80%" HEIGHT="80%" ALT="Visual Studio .NET Debugging Session">
</A>
</BLOCKQUOTE>

As can be seen, a breakpoint has been set in <CODE>program.do</CODE>
(as described above) as well as in line 12 and 17. The latter two were
set using the contextual right button menu in the SuperFields.bet
source window.<BR>
The breakpoint at line 12 (in the <CODE>get</CODE> method has been
hit, and a single Step-into command has been issued, thus executing
the statement <CODE>x + y -&gt; z</CODE> (the maroon indication of the
staement seems to be off by one - we'll check this later (:-)).<BR>
As can be seen from the red 77 in the locals window, this assignment
caused the local variable named z to get the new value 77.


<H3><A NAME="dbgclr">Debugging using DbgCLR.exe</A></H3>

Along with the free .NET framework comes a stand alone source level
debugger named <CODE>DbgCLR.exe</CODE>. It typically resides in 
<CODE>C:\Program Files\Microsoft.Net\FrameworkSDK\GuiDebug\DbgCLR.exe</CODE>

<OL>
<LI>
Open <CODE>DbgCLR.exe</CODE> by double clicking its icon in the Windows Explorer.

<LI>
Given that <CODE>foo.bet</CODE> has been compiled to <CODE>foo.exe</CODE>, you may now
specify <CODE>foo.exe</CODE> in menu item <CODE>[Debug->Program to debug]</CODE>.

<LI>
Now set a breakpoint at the beginning of the program:
From menu item <CODE>[Debug->New Breakpoint (Ctrl-B)]</CODE> specify
breakpoint in Function <CODE>program.do</CODE>.

<LI>
Now start the program using menu item <CODE>[Debug->Start (F5)]</CODE>.
The program will now stop at the do-part of the <CODE>PROGRAM</CODE> fragment.
You can now single step, inspect variables etc. at BETA source
level.

</OL>

Below is a screen dump showing the same debugging session as above in
Visual Studio .NET.

<BLOCKQUOTE>
<A HREF="dbgclr.jpg" TARGET="_blank">
<IMG SRC="dbgclr.jpg" WIDTH="80%" HEIGHT="80%" ALT="DbgCLR Debugging Session">
</A>
</BLOCKQUOTE>

<H3><A NAME="cordbg">Debugging using CorDBG.exe</A></H3>

There is also a command line debugger included in the .NET
Framework.<BR>
It is named <CODE>cordbg.exe</CODE> and is normally automatically accessible
from your shell (as the .NET Framework Installer will have included
the path to it in your search path).
<P>
If you compiled with <CODE>nbeta -d</CODE>, <CODE>cordbg</CODE> is very useful for debugging
IL code. It automatically breaks a the main entry point when run as
<PRE class=beta>
&gt; cordbg foo.exe
</PRE>
The syntax for breaking in the do method of calls program is
<PRE class=beta>
(cordbg) b program::do
</PRE>
You may also use cordbg for source level debug, and specify, e.g.,
<PRE class=beta>
(cordbg) b foo.bet:16
</PRE>
to make it break in line 16 of <CODE>foo.bet</CODE>. In this case foo should be
compiled without the <CODE>-d</CODE> option. To get more help on using <CODE>cordbg</CODE>
type this:
<PRE class=beta>
(cordbg) help
</PRE>


<H3><A NAME="il">IL debugging</A></H3>
<P>
If you want to debug at IL level instead of BETA source level, you
can compile with:
<PRE class=beta>
&gt; nbeta -d foo
</PRE>
or (forcing total recompile):
<PRE class=beta>
&gt; nbeta -s 12 -d foo
</PRE>
In this situation, the debuggers may need "help" to find the IL files
- this will not be described here.


<H2><A NAME="java">BETA.Java Source Level Debugging</A></H2>

<H3><A NAME="jdb">Using jdb</A></H3>

The standard 
<A HREF="http://java.sun.com/j2se/1.4/download.html">J2SE SDK version 1.4</A> 
includes the textual debugger called
<CODE>jdb</CODE>.
Below is a session showing BETA source level debugging using this
debugger (notice that the class files generated by the BETA compiler
are placed in a sub directory named <CODE>javabc</CODE>, and the
currently the <CODE>main</CODE> function is placed in a file always
named <CODE>program.class</CODE>):

<PRE class=beta>
tcsh&gt; cd javabc
tcsh&gt; jdb program
Initializing jdb ...
&gt; use ..
&gt; stop in SuperFieldsSub.get
Deferring breakpoint SuperFieldsSub.get.
It will be set after the class is loaded.
&gt; run
run program
&gt; 
VM Started: OK.
Set deferred breakpoint SuperFieldsSub.get
33
44

Breakpoint hit: "thread=main", SuperFieldsSub.get(), line=12 bci=0
12           do x + y -&gt; z

main[1] locals
Method arguments:
Local variables:
z = 0
</PRE>

(The source for the program can be seen in the Visual Studio .NET
screen dump above)


</BODY>
</HTML>