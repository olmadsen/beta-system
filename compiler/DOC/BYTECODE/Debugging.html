<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<title>Source Level Debugging</title>
<link rev="made" href="mailto:beta@daimi.au.dk">
<LINK REL="stylesheet" HREF="http://www.daimi.au.dk/~beta/doc/style/miadoc.css" TYPE="text/css">
</HEAD>

<BODY>

One of the advantages of using JVM and .NET is that if we generate
sufficient debug information the execution platforms directly support
source-level debugging of BETA code in their respective tools.

Below are preliminary examples of this for both .NET and JVM.

<H2>BETA.NET source level debugging</H2>

You can source level debug BETA programs compiled for .NET with both
the free stand alone debuggers <CODE>DbgCLR.exe</CODE> (graphical) and 
<CODE>CorDBG.exe</CODE> (textual) supplied with the 
<A HREF="http://msdn.microsoft.com/downloads/default.asp?url=/downloads/sample.asp?url=/msdn-files/027/000/976/msdncompositedoc.xml">.NET Framework SDK</A>
as well as with the built-in debugger in Visual Studio .NET.

To use Visual Studio .NET for BETA source level debugging, do this:

<OL>
<LI>To debug foo.exe produced from foo.bet, you first choose menu item
    <CODE>[File->Open Solution...]</CODE>.
   
<LI>In the dialog that appears, you choose 
    <CODE>Files of types: All project files</CODE> and navigate to <CODE>foo.exe</CODE>.
    Double click <CODE>foo.exe</CODE>.

<LI>Now set a breakpoint at the beginning of the program:
    From menu item <CODE>[Debug->New Breakpoint (Ctrl-B)]</CODE> specify
    breakpoint in Function <CODE>program.do</CODE>.

<LI>Now start the program using menu item <CODE>[Debug->Start (F5)]</CODE>.
    The program will now stop at the do-part of the <CODE>PROGRAM</CODE> fragment.
    You can now single step, inspect variables etc. at BETA source
    level.
</OL>

Below is a screen shot showing a debugging session (slightly reduced
size; click image to see it in full size in a separate window):

<BLOCKQUOTE>
<A HREF="visual_studio_net_debug.jpg" TARGET="_blank">
<IMG SRC="visual_studio_net_debug.jpg" WIDTH="80%" HEIGHT="80%" ALT="Visual Studio .NET Debugging Session">
</A>
</BLOCKQUOTE>

As can be seen, a breakpoint has been set in <CODE>program.do</CODE>
(as described above) as well as in line 12 and 17. The latter two were
set using the contextual right button menu in the SuperFields.bet
source window.<BR>
The breakpoint at line 12 (in the <CODE>get</CODE> method has been
hit, and a single Step-into command has been issued, thus executing
the statement <CODE>x + y -&gt; z</CODE> (the maroon indication of the
staement seems to be off by one - we'll check this later (:-)).<BR>
As can be seen from the red 77 in the locals window, this assignment
caused the local variable named z to get the new value 77.

<H2>BETA.Java Source Level Debugging</H2>
The standard 
<A HREF="http://java.sun.com/j2se/1.4/download.html">J2SE SDK version 1.4</A> 
includes the textual debugger called
<CODE>jdb</CODE>.
Below is a session showing BETA source level debugging using this
debugger (notice that the class files generated by the BETA compiler
are placed in a sub directory named <CODE>javabc</CODE>, and the
currently the <CODE>main</CODE> function is placed in a file always
named <CODE>program.class</CODE>):

<PRE class=beta>
tcsh&gt; cd javabc
tcsh&gt; jdb program
Initializing jdb ...
&gt; use ..
&gt; stop in SuperFieldsSub.get
Deferring breakpoint SuperFieldsSub.get.
It will be set after the class is loaded.
&gt; run
run program
&gt; 
VM Started: OK.
Set deferred breakpoint SuperFieldsSub.get
33
44

Breakpoint hit: "thread=main", SuperFieldsSub.get(), line=12 bci=0
12           do x + y -&gt; z

main[1] locals
Method arguments:
Local variables:
z = 0
</PRE>

(The source for the program can be seen in the Visual Studio .NET
screen dump above)


</BODY>
</HTML>