----------------------

------------------------------------------------------------------------------
OLM: 1/11/95:	Bug fix for short-circuit boolean expressions for
		Linux; In  (if (x <> y) and (z > x) then ... if),
		the float stack was NOT popped when evaluating expressions
		like (x <> y). The error was correted by adding an
		extra 'pop' parameter to mch.cmpAndJmpFloat, and fixing
		this slot in LINUXmachine.

>>>>>>>>>>>	The ERROR MUST also be corrected for NT and INTELB
		(INTELB fixed 2/11/95).
		(NTImachine fixed 8/2/96)

PA: 1/11/95:	Changed compilernumberioBody.bet:
		Removed use of short-circuit and simple ifs involving
		reals in toReal, since this cannot be correctly compiled 
		by beta5.0. This prevents simple bootstrap of beta5.1.
		When we start using basiclib/v1.5, compilernumberio should
		no longer be used.

PA: 2/11/95:	Changes in LINUXmachine and INTELBmachine:
		Improved Olm's solution in cmpAndJmpFloat (much less code).
		Changed popFstack to be a little faster.
		Changed negFloat to use fchs.
		Changed fBle and fBge to only use one jump.

>>>>>>>>>>>	These changes should be done in NTImachine too.
		(fixed 20/12/95)

PA: 2/11/95:	Changed version number to 5.1.1 in systembody.

OLM: 2/11/95:	New option 61 introduced to handle new primitive interface;
		used in itemevval to delay call of mch.initPrimCall.

OLM: 12/11/95:	Checked in version of MIPS*.bet which generates elf code for
		the Indy/mips. All test programs, some betaenv demo programs
		an all containers/v1.5/demo*.bet programs work. 
		Is based on simplied betarun.c in ~olm/beta/system/v5.1.1/TST.
		For documentation see 

			~olm/beta/system/v5.1.1/SGI.doc

PA: 13/11/95:	Added directory COFF containing coff.bet, coff_ms.bet, 
		cofffile.bet, cofffilebody.bet.
		To be used as a backend for binary generation on windows95/NT
		using microsoft PE/COFF object-file format.
		Checkout using:
		(assuming the compiler is already checked out in ~/beta/system/v5.1.1)
			cd ~/beta/system
			cvs get -d v5.1.1/COFF system/COFF  # check out the new directory
			cd v5.1.1/COFF
			cvs update			    # get the new files
		(I think :-)

OLM: 13/11/95:	Bug fix for missing float operations used with repetitions,e.g.
		FloatExp -> R.extend.
		New mch.float2int operation added.
>>>>>>>		Must be added to all other platforms; 
		only MIPS, sun4, sun4s, hpuxXmc have been fixed;
		missing: snake, mac, linux, nt.

		(fixed for NTI and LINUX in PA: 9/2/96).


OLM: 13/11/95:	Bug fix; evval1:simpleEvVal:pushCpar; use of integer variables
		as arguments to floating point externals gave ref. is none;
			FEJL/jlkfloat2int1.bet

OLM: 14/11/95:	beta5.1 checks for blanks in external entry-points and gives a
		warning for such blanks. Warnings are NO longer given if blanks
		appear in PascalTraps like: '{ $3FC, $00o4 }'->pascalTrap.
		This fix is only relevant for Macintosh.

OLM: 14/11/95	A number of unused machine slots have been removed:
>>>>>>		callPrimitive, copyText, bitfield, relativeAdr, ldLabAdr;
		op2 in gGetDataByte/word have been eliminated - was NOT used.

OLM: 30/11/95:	A case 3 has been introduced in mch.getPrimRes; may be
		used to return result of primOp in the return register
		of the platform instead of allocating a dataReg.
		Is only used, when the compiler immediatley move the result
		from the resultRegister. 
>>>>>		MUST be handled on ALL platforms!! Has been updated, but
		NOT tested on all platforms except MAC and NT.
		BUT, MUST BE CHECKED ON ALL PLATFORMS.

OLM:  1/12/95	99% of MIPS code generation finished. Only parts (know to be:-)
		missing are interface-related to garbage collector

OLM:  7/12/95:	A new machine slot SPtoPrimReg was added to handle special
		MIPS problem.

OLM: 11/12/95:	Bug fix: controller. If a .ast-file was removed while a
		recursive compiler was running, the .bet-feil was NOT parsed.
		See controller: (* from KJM: 10.12.95 *)

OLM: 11/12/95:	1st version of PPC compiler checked in. Files
		PPCbeta, PPCmachine, etc. Code is generated for almost
		all slots in PPCmachine. Nothing has been tested, since
		the PowerPC machine is not usable.

OLM: 11/12/95:  For XXasmlink on UNIX the following is emitted in the .job-file:
			CC=${CC-"gcc -O6"}
		except for MIPS where this is emitted:
			CC=${CC-"cc -O2 -non_shared"}

OLM: 10/12/95	New machine slot: ExternalMark. Called before calling 
		M-entry point of beta call-back routine. May currently be
		empty for all other platforms than SGI/MIPS and PPC

OLM: 10/12/95:	For SGI, for all makefiles: "foo", the file "foo_sgi" is
		used if it exists. If it does not exits "foo" is used.
		This is necessary since sgi-specific make files are needed
		in basiclib/v1.4. In basiclib/v1.5 all make files will be
		changed to work for all (unix?) platforms.

OLM: 16/12/95:  Moved MC68machine slot jsrReg to HPmachine since argument
		qualification has been made stronger.
		MUST also be made for MAC!

OLM: 16/12/95:	New machine slot Final2VirtJump; needed for handling
		Final to virtual binding s for MC68 and Ix86. Empty
		for all other platforms.
		Only made for MC68machine

OLM: 17/12/95:	Bug fix for HPMC and LINUX/NT; Problem with codegen for
		final2virtual bindings ( W::V; V:< ...).  The same problem
		must also exist for the Mac; but should be fixed since
		the fix was in MC68machine.
		LINUX has been updated; NTI/INTELB NOT updated.

OLM: 17/12/95:	LINUXbeta brought up-to-date. Can compile tst*.bet.
		HOWEVER: machine-slot float2int has NOT been filled out.

PA: 20/12/95:	Fixed the stuff in "PA: 2/11/95" for NTImachine.

OLM: 23/12/95:	Code is now generated fo all stand-alone expressions that
		may have side-effects; e.g. (e1,e2,e3), e1 or e2.
		TST/tstsingleeval

OLM: 23/12/95	Switch "--mute" now also sets "nowarn". If later e.g.
		"--verbose" is set, "warn" is NOT set automatically,
		since this will require that the state of warn is remembered
		from when "mute" was set. "warn" must thus be set explicitly.
		Note: to get warnings during a mute session, a setting in the
		order "--mute --warn" should work.

OLM: 23/12/95:	Bug fix in struc comparison in if-imp; FEJL/strucif.bet

OLM: 23/12/95	New machine slot CallRegInPrimReg2; see comment in machine.
		Category of slot CallRegBusy changed to doPart.

OLM: 25/12/95:	Bug fix for Qua check in  "S[] -> R[]", where "R: ^A.P" and
		"P" is a pattern.

OLM: 25/12/95:	Fix in controlbody as proposed by ESS: handle situation
		where other tools, e.g. Valhalla, may already have set origin.

OLM: 26/12/95:	Added various file exceptions to job-file and ..db-file (in
		binarystreambody.bet + machinebody.bet)
		In addition some apparently missing mps exceptions were added
		to AST.top.open in controlbody.

OLM: 27/12/95:	Bug fix refevval:refevval:toTmp; a ref.is.none was generated 
		in FEJL/refasg.bet FEJL/pagh.bet

OLM: 27/12/95:	Bug fix evbody:booleaxEval: floatregoverflow in complicated
		boolean expresions with real operands; FEJL/addbez.bet
		changed to work for all (unix?) platforms.

OLM: 29/12/95: 	Bug fix virtual.bet; to handle situation with x: ^V.W, 
		where V:< ...; FEJL/mads.bet

OLM: 29/12/95	Integer/boolean compatibility gave en error for
		   (if anInt < aBool ... if). Now only a warning is given.
		Note that the error only came if anInt<aBool was in if-imp.

OLM:  8/1/96	Started adding support for int8, int8u, etc.
		Is not completed. And  currently only for SPARC.

OLM:  12/1/95:	Changed MIPS codegeneration to Position-independent-code (PIC).

OLM:  17/1/95:	Added support for linking shared objects on MIPS.
		a: via splitting linking into several link directives, using
		   the feature already there for large link directives.
		b: using LIBRARY property of fragment system. A bug was
		   fixed here. In addition the option '--shared' must
		   be used.

OLM: 17/1/95:	Fixed the TraceXcall for MIPS and added TraceXres

OLM: 18/1/95:	Fixed C-interface bug (R[i] -> foo); after this X programs
		can be compiled and run!! Major milestone!!

OLM: 26/1/96:	A number of SGI related stuff.

OLM: 27/1/96:	Fixed (hopefully) last details about job-file and use
		of LD_LIBRARY_PATH. A BETA executable using shared libraries
		is organized as follows:

		Assume that the foo.bet is in  /users/kalle/mysys.
		The executable and shared object files for foo are then:

			/users/kalle/mysys/foo
			/users/kalle/mysys/sgi/foo1..gso
			/users/kalle/mysys/sgi/foo2..gso
			/users/kalle/mysys/sgi/foo3..gso

		3 is just an example. There may be from 0 to n shared files.
		(gso is for code with debug-info; so is used when no debug).

		When foo is executed from other directories than where it is
		compiled, LD_LIBRARY_PATH MUST include

			/users/kalle/mysys/sgi

OLM:  4/2/96:	Changes to creation of job-file name due to various problems:
		1. remote-exe always placed job-file in top-dir
		2. beta -o sun4s/tst tst gave wrong job-file
		...
		Previously the job-file was always based on objFile; now
		it is based on rootFragment, which is the source file
		being translated. So job-file is placed relatively
		to rootFragment.
		If remote-exe, then full path is used for objFile.

OLM:  4/2/96:	Moved all code that explicitly refers to targetDir, like
		'sun4s', 'sgi', ... to com.bet. I.e. when adding a new
		target, the changes adding the dir-name should be in com.bet

OLM:  5/2/96: 	Bug fix; Qua check error might appear when a descriptor-slot
		pattern was used as prefix; FEJL/ernst.bet

OLM:  5/2/96:	Infinite parsing happened if no BETA code in last form:
		FEJL/loop.bet

OLM:  5/2/96:	Fix of Qua-check parameters for SGI + code-gen for DoGC.

PA: 8/2/96:	Changed impl. of elf and elffile.
		Does not use pattern data anymore (old way could
		cause GC seg. fault - the well-known pattern data error).

PA: 8/2/96:	Fixed error-reporting from A_OUT/*.bet to go to
		the screen instead of the a.out file!

PA: 8/2/96:	Added fragments float2int, SPtoPrimReg and Final2VirtJump
		to INTELBmachine.

PA: 8/2/96:	Incorporated changes from v5.1 on Tuborg to
		NTIasmlink and NTImachine.

PA: 8/2/96:	Fixed qualification error bug in
		gdiv.op1ToEBX in NTImachine.

PA: 8/2/96:	Fixed test for pop in cmpAndJmpFloat in NTImachine.

OLM: 8/2/96:	Checked in files PPCMACbeta.bet, PPCOS2beta.bet, etc.
		Code can be generated, but no testing has been made.

OLM: 9/2/96:	Fragment float2int fixed for hpux9pa.

PA: 9/2/96:	Implemented slot float2int in LINUXmachine and NTImachine
		by using mstate.tmplab.
		Changed slot intReg2float in both files to use
		mstate.tmplab too.

PA: 9/2/96:	Changed to use of mps/v5.0.1 and sysutils/v1.4.2.

OLM: 11/2/96:	Mad an interface for generating 'beta-data'-files to be 
		used for persistence. To replace the old representation 
		using BETA_data1, BETA_dat2, etc. that relied on 
		data-segments being consecutive. 
		Based on the code for b2c in controlbody. 
>>> KIM >>>	The new interface is via machine. The b2c code should 
		be opgraded to use this interface also.

OLM: 11/2/96:	Eliminated the variables targetMach and targetMachId from
		machine. Instead common.targetMachine and 
		targetMachineId can be used. 
		Similar variables in system will be replaced
		in a similar way, i.e. use only the ones in common.

PA: 12/2/96:	Changes in NTImachine:
		Copied final2virtjump from LINUXmachine.
		Fixed addressSize bug in cmpAndJmpFloat.
		Added empry slot SPtoPrimReg.

OLM: 12/2/96:	Fix of hasProgramSlot and switch[6] in translate such
		that beta *.bet will only link fragments with program 
		slots

PA: 13/2/96:	Fix in NTIasmlink: added -q tofirst invocation of
		nmake.
------------------------------------------------------------------------------
beta5.1.2:

OLM: 18/2/96:	Added machine slot entryPointsEqual - empty for all platforms
		except PPCMACbeta.

OLM: 20/2/96:	First ppcmac program can link and run!

OLM: 22/2/96:	Fixed show-stopper in v5.1.2 AND v5.1.1: checker error
		when using this as reported by lennert: FEJL/lesthis.
		Changes to:

			checklibbody.bet
			systembody.bet  v5.1.1(1) -> v5.1.1(2)
			TST/tstthis.bet

OLM: 22/2/96:	Fixed sgi code-gen bug for forms
			---x:descriptor--- A (# ... #)
		No code for computing GP was generated.
		NOTE! The fix relize on mch.jmpT is ONLY called from 
		gen2body:specialInitDesc. The name jmpT should be changed

OLM: 2/3/96:	CHANGED allocation of INNER-dispatch table. It is NO longer
		allocated before the prototype, using negative offsets.
		Instead an entry is alloacted in the virtual dispatch
		table for each INNER. This means that all references
		to the INNER dispatch table must be changed, in the code
		and the run-time system. The layout of the prototype is 
		as follows:

                         Let D : D1 (# ... #)
                             D1: D0 (# ... #)

                         Then the prototype for D or a sub of D has the form:

                                       0:
                                       4:
                                       8:
                                      12:
                                      16:
                                      20: 0 or externalEntryLab
                                      24: Mentry for D0
                                      28: ...
                                        : ... virtuals declared in D0
                          20+D0.virtSize: M-entry for D1
                                        : ... virtuals declared in D1
                          20+D1.virtSize: M-entry for D
                                        : ... virtuals declared in D
                          20+D.virtSize : RETURN or M-entry for sub of D
                                        : ...

		virtSize is an attribute in the AST for descriptor nodes.

		If R denotes an object then 
			R[0] -> PT is the prototype for the object, and
			PT[24] is the top-level M-entrypoint for the object.
		I.e.  call R[0][24] will execute the object.

		Similarly call R[0][20+D.virtSize] will execute inner for
		the descriptor D.
                              
		The M-entry point for D is NOT directly accessible from the
		prototype! This may be a problem!!

		Note that externalEntryLab is always present. Perhaps we can 
		put the M-entry point here when it is not used.

		Currently space is always allocated for INNER in the virtual
		dispatch table. It is only used when switch 66 is used.
		The 'old' inner table is currently always generated since the
		run-rime system is using it. This should be changed!!

PA: 6/3/96:	Changes to INTELBmachine:
		Implemented slots float2int and Final2VirtJump.
		Fixed bug in slot Push (made tstcproc fail) and
		added handling of one more operand type to
		slot Pop (for Final2VirtJump).

		Changes to LINUXBasmlink:
		Changed BinExt into the same as other unix platforms.

PA: 6/3/96:	Added NTIBbeta.bet and NTIBasmlink.bet.

PA: 6/3/96:	Changes in Cbeta, Casmlink and Cmachine:
		Added some new fragments and removed some obsolete ones.
		Changed group_header generation to match generic 
		betarun/v2.8 solution.
 >>>KIM>>>	All changes are marked with "datpete 6/3/96", and should
		be checked.
		Cbeta is now linkable on sun4s.

PA: 8/3/96:	Changes to LINUXmachine, NTImachine, INTELBmachine:
		Replaced "unorderedFval" function (that was previously
		defined in betaenv on linux and betarun on nti - none
		of them worked correctly) by "UoFV" (always defined 
		in betaenv).
		A kludge had to be made in LINUXmachine, since I cannot
		start code-generation for betaenv/v1.4 on linux.
		So on linux both UoFV and unorderedFval is currently 
		used. This is marked with "FIXME" and should be fixed
		when basiclib/v1.5 is used.

PA: 8/3/96:	Changes to NTImachine:
		Eliminated unneeded imports from assembler-header,
		since borland assembler will complain about
		FailureExit when generating betaenv (both declared
		as default import, and imported as standard external).

PA: 8/3/96:	Changes to INTELBmachine:
		reimplemented floatconst to use the "value" parameter.
		A hack was needed to get around bug in LINUXbeta,
		that fails to generate correct code for
		(if aReal // 1.0 // 1.1 then if).
		This new floatconst implementation requires
		that beta5.1.1 is used for compiling LINUXBbeta.

OLM: 10/3/96:	Bug fix for address register used for Qua-check; on e.g.
		Linux, the register referred into an object, which may give
		GC problems. On e.g. SPARC there is no problem since the
		involved register on Sparc is NOT a GC-root. 
>>>>		A new machine slot: isObjectReg is needed to check whether or
		not a given register must refer a whole object. It should
		always refer false for dataRegs. For adrRegs it may always
		refer TRUE, which will be safe, but result in more code to
		be generated. If a given platform uses and adrReg which is
		never a GC-root, it may return FALSE for these registers.
		On Sparc %I5 is an example of this.
		FEJL/quaReg2.bet

OLM: 10/3/96:	SGI corrections:
		1) "-delay_load" eliminated before "-lm"
		2) mv of ".gso/.so" files moved to  case "0)" in job-file.
		3) the BETA_DATA file is handled specially to avoid it being
	 	   in a shared lib. A new asmlink-kind: BetaDataKind is
		   introduced. Note: BetaDataKind is NOT introduced for b2c.

OLM: 11/3/96:	SGI bug fix; errorneous  clearStackTop in bindVirtual-code;
		problem with Valhalla & Ymer.

OLM: 16/3/96:	Correction of SGI ..db-counting; constantly 8 wrong.

OLM: 19/3/96:	In the prototype, the field "form" (word at byte off 14:)
		is now the byte index of the top M-entry point. If zero,
		then the descriptor has NO do-part. Used together with
		OLM 2/3/96 "CHANGED allocation of INNER-dispatch table".
		
OLM: 23/3/96:	SGI details: (1) Code is now generated for HandleIndexErr to
		pass SP, and other parameters to BetaError; (2) missing SP
		for CpkSV and CpkSVT; (3) correct handling of C variables
		with respect to relocation (e.g. with option 22 for tracing
		external C calls); (4) bug with betadata and -o option; (5)
		this is pushed on refStack before calling Qua, but is NOT
		popped, since no GC can happen in Qua!

OLM: 24/3/96:	Added support for inter-fragment leave/restart as in

			foo.bet:
			ORIGIN 'betaenv'; BODY 'foobody'
    			--program:descriptor---
			(# do L: <<SLOT LL:descriptor>> #)

			foobody.bet:
			ORIGIN 'foo'
			--LL:descriptor--
			(#do leave L #)

		The reason for sonsidering this was that it was thought
		to be a problme for sgi since the GP-pointer was not
		properly handled when crossing fragment boundaries.
		It turned out that inter-fragment leave/restart apparently
		NEVER worked on any other platform!!! The problem with this
		was that local labels (pattern localLab) were not visible
		accross fragment boundaries.

		The compiler now generate localLab's that are visible across
		fragment boundaries. For a label like L above, the code
		and labes look as follows:
			M11FOO:  ...
				 ...
			R11FOO8: ...
				 ...
			L11FOO9: ...
				 ...
		The lable L is supposed to be in a descriptor with entrypoint
		M11FOO. The restartlabel used to be e.g. L8 and the leave
		label L9. These labels are now R11FOO8 and L11FOO9.
		I.e. leave L jumps to R11FOO8 and leave L jumps to L11FOO9

		To handle the new labels, a cleanup of localLab booleans
		has been initiated. Booleans like betaLabel an isTextAdr
		will be replaced by the variable type. The possible values
		for type are described in machine.bet pattern localLab.
		Note: the cleanup has just been initaited and is NOT complete!

		Inter-fragment leave/restart is complicated and one should
		errors to show up when using this code. Also only sun4s
		and sgi have been completed.

		A new machine slot, LocalLabAsText, has been introduced.

		SaveSP has been renamed to BeginLabel and a new slot
		EndLabel has been moved form CODEmachine to Xmachine.

OLM: 24/3/96:	Changed v5.1.2 to be compatible with v5.1.1.
		Using switch 66 will merge inner-dispatch with 
		virtual-dispatch. NOTE: using switch 66 may create incompatible
		fragments AST's. I.e. all fragments in a program MUST be 
		compiled (including checking) either with 66 ON or 66 OFF.
		It is necessary to keep 66 for use with ppcmac.
			
OLM: 28/3/96:	Bug fix for SGI when passing combination of int and float
		arguments to external C-routines. tstcproc extended.

OLM: 1/4/96:	Bug fix for byteSwap

PA: 2/6/96:	Changes to INTELBmachine, INTELelf, INTELmstate, 
		NTIBasmlink, WIN32coff.
		tst now almost links on nti using binary compiler.

PA: 2/6/96:	Change in misk.bet: Use of dirCh instead of
		explicit '\\' in nti case in InsertSubDir.
		This simplifies cross-platform nti code-generation.

-----------------------
Change after first freeze of beta5.1.2

OLM: 22/4/96:	Changed BETA_DATA handling to use local paths instead
		of full paths. Necessary in order to move compiled
		object files for sgi to other places than daimi/~beta.
----------------------