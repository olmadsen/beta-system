<HTML>

<HEAD>
<TITLE>Several Work Spaces</TITLE>
<LINK REV="made" HREF="mailto:olm@daimi.aau.dk">
</HEAD>

<BODY>
<H1>Several Work Spaces</H1>

<PRE>
							olm 29.3.97

[Just et indlæg i debatten om mere fleksible workspaces affødt af at
jeg pt. bruger Henrik Bærbaks rcm. Men en forbedret workspace model
vil også være en fordel selvom man ikke bruger rcm.  Vedlagte notat er
en opsamling og en videre bearbejdning af tidligere diskussioner.  Det
skal selvfølgelig tænkes godt igennem og diskuteres og prioriteres
mellem alt mulig andet!

---olm]

Better support for several MBS work spaces
------------------------------------------

Most developers of an MBS component have a local (CVS) copy of that
component to be able to make modifications. Such a component refers to
other MBS components via ORIGIN, INCLUDE , etc. using '~beta'.

This works well if one only modifies one component at a time and if
the component being modified is not recursively dependent on other MBS
components.

1.	In some cases it might be desirable to be able to modify
	several components at a time. It may e.g. be desirable
	to modify the compiler, betaast and mps at the same time. This
	is only possible if '~beta' paths in these components are
	modified to refer the local versions.

2.	For 'editor' it is always necessary to have a local copy of
	'ymer', since they are mutually dependent.

The following is a suggestion for handling this:

The compiler (pathhandler) interprets '~beta' according to a workspace
descriptor that e.g. may look as follows:

	~beta:
		/users/beta/r4.0.2
		/users/devise/beta
		/users/olm/beta

When the compiler sees a path like:

	'~beta/betaast/v5.1/index'

it looks for 'betaast/v5.1' in 

	/users/olm/beta, /users/devise/beta, /users/beta/r4.0.2

in that order. 

This means that a local copy can be present in '/users/olm/beta' or
'/users/devise/beta'.

Shared 'devise' versions can be present in /users/devise/beta.

(A workspace descriptor may be hold in the environment variable
BETALIB or be created by combining a number of '.'-files. This has to
be settled in order to be as flexible as needed without being too
complicated to setup).

Implementation
--------------

It should be possible to implement this by modifying the pathhandler.
When the pathhandler sees a path like:

	'~beta/betaast/v5.1/index'

It must check if the directory

		betaast/v5.1

is present in one of 

	/users/olm/beta, /users/devise/beta, /users/beta/r4.0.2

and expand '~beta' to the first one that has 'betaast/v5.1'.

LocalPath must be modified in a similar way.


Limitations
-----------

There are some limitations on such a mechanism! 

	Let WS = "~beta be ws1, ws2, ..., wsn"
	be a works-space list. I.e. components are searched in 
	the order wsn, ... ws2, ws1.
 
	A component in wsi being compiled using WS
	may NOT refer (via ORIGIN, INCLUDE, etc) to
	components in wsi+1, ... wsn.

For the example above, components in '/users/olm/beta' can refer
to components anywhere. Components in '/users/devise/beta' cannot refer
components in '/users/olm/beta'. And '/users/beta/r4.0.'2 cannot
refer components in '/users/devise/beta' and  '/users/olm/beta'.

Note! The restriction is only when a component is being translated
using WS. Components in '~beta/r4.0.2' can of course refer other
components by using other workspace lists.

The restriction is necessary ensure that a compiled ast in '~beta' does
not have links to to ast's in '~olm/beta'.


			------------------------
			|  /users/beta/r4.0.2  |
			------------------------
			     ^			^
			     |			|
		----------------------		------------------------
		| /users/devise/beta |		| /users/roen/speciale |
		----------------------		------------------------
		   ^		   ^
		   |		   |
	-------------------    	-------------------
	| /users/olm/beta |	| /users/ess/beta |
	-------------------	-------------------

The AST dependency graph may not create loops in the supergraph
restricted to workspaces. 


Tool support
------------

To be able to use such a mechanism in a safe way, it is necessary
to have some tool support that ensures that the work space list is
set in a meaningful way. When a component is checked-out in a workspace
it must be checked that it does NOT refer fragments in other workspaces
that refer back to the component.

It should be possible to implement a set of basic tools that can
support this and be used to extend Henriks Bærbaks rcm-tool.


Support for projects in general
------------------------------

It would be possible to extend this to handle several projects
in the style of:

	~beta:
		/users/beta/r4.0.2
		/users/devise/beta
		/users/olm/beta

	~devise:
		/users/devise
		/users/olm/devise

	~maersk:
		/users/maersk/beta
		/users/olm/maersk


I.e. it will be possible to have things like:

	INCLUDE '~devise/oodb/...';
	INCLUDE '~maersk/gcss/...';

</PRE>

</BODY>
</HTML>
