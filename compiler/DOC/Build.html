<HTML>

<HEAD>
<TITLE>BUILD property</TITLE>
<LINK REV="made" HREF="mailto:olm@daimi.aau.dk">
</HEAD>

<BODY>
<H1>BUILD property</H1>

<PRE>
The BUILD property unifies the old OBJFILE and MAKE properties.
The BUILD property is used to specify rules for keeping external 
(i.e. non-BETA) sources up to date, and to include the external files
in the link directive.

Syntax:
------

BUILD &lt;machine&gt; '&lt;objectfile&gt;' '&lt;dep1&gt;' '&lt;dep2&gt;', ... '&lt;depN&gt;' '&lt;command&gt;';

where

&lt;machine&gt;     is the target machine specification (see MDBODY description)

&lt;objectfile&gt;  is the external objectfile to include and possibly maintain. 
              A $$ in this specification is expanded to the machine type.
              This is unlike other properties, like MDBODY, where a single
              $ is expanded to the machine type.
              If a backslash (\) or a newline must be included literally in the 
              specification, it must be quoted with backslash.

&lt;dep1&gt;
&lt;dep2&gt;
...
&lt;depN&gt;        Are source files, that the &lt;objectfile&gt; depends on. 
      
&lt;command&gt;     is a command (sequence) that is executed by the 
              compiler as it is, except for the following substitutions:

	      $$ is expanded to the machine type, as explained above.
              $0 is expanded to &lt;objectfile&gt;
              $1 is expanded &lt;dep1&gt;
              $2 is expanded &lt;dep2&gt;
              ...
              $N is expanded &lt;depN&gt;

              If a backslash (\) or a newline must be included literally in 
              the commands, it must be quoted with backslash.

Functionality:
--------------

The &lt;objectfile&gt; is included in the link directive.
The compiler will execute &lt;commands&gt; if and only if
   a. &lt;objectfile&gt; does not exist
or b. any of the files &lt;dep1&gt;, &lt;dep2&gt;, ... &lt;depN&gt; are newer than an existing
      &lt;objectfile&gt;
The compiler will execute &lt;commands&gt; from the directory in which 
the file containing the BUILD property resides.


Example
-------

If the object file foo.o (foo.obj) is to be generated from the foo.c file
in the external directory, but also depends on the foo.h file in the 
external directory, you could specify this as:

BUILD nti     '$$/foo.obj' 'external/foo.c' 'external/foo.h' 
              'cl -c $1 -Fo$0 -nologo -w -O2 -Zd -Zp4'
      macppc  ':$$:foo.obj' ':external:foo.c' ':external:foo.h' 
              'MrC -D MAC -o $0 $1'
      default '$$/foo.o'   'external/foo.c' 'external/foo.h' 
              '$CC -o $1 $2';

Notice, that regular environment variables may be used in the &lt;commands&gt;
specification, e.g. in the default (UNIX) specification, the variable
CC are used (on UNIX, this is always set to an appropriate value in the job-file).

More than one build pr. fragment
--------------------------------

In general, more than one build pr. fragment will not work.
The reason is that the meta-programming system combines all build directives 
into one directive (property). This means that:

	BUILD sun4s 'cc1' default 'cc2';
	BUILD sun4s 'cc3' default 'cc4'

means the same as:

	BUILD sun4s 'cc1' default 'cc2' sun4s 'cc3' default 'cc4'

BUILD 'executes' all entries for a given plaform. This means that
the 2 sun4s entries will be executed for sun4s. The 2 default entries
will be executed for all other platforms.
 
If the following two build entries are used:

	BUILD sun4s 'cc1' default 'cc2';
	BUILD sgi   'cc3' default 'cc4'

ONLY cc1 will be executed for sun4s and ONLY cc3 for sgi, and
the 2 default entries for all other platforms. This is probably not
what is intedended: For sun4s you would expect cc1 and cc4
to be executed and sgi, cc2 and cc3.

To fix this, changes in the meaning of properties in MPS must be changed.

Summary: more than one build directive in a fragment file will work if
they have the same structure with respect to platform.

Alternative

It would be easy to implementa build directives on the form:

	BUILD1 sun4s 'cc1' default 'cc2';
	BUILD2 sgi   'cc3' default 'cc4'
	  
This will give different properties and the compiler can be made to handle
this. It is, however, not an ideal solution.

</PRE>

</BODY>
</HTML>