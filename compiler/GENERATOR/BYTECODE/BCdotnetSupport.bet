ORIGIN 'BCmachineBody'; 
INCLUDE '~beta/basiclib/formatio'; 

(* Support classes needed by the generated .NET code.
 * Generated as part of compiling basic BETA environment.
 *)


--BCmachineLib: attributes--

sigStructure:
  (# T: ^Text;
  do &Text[] -> T[];
     'class [\'%s\']\'Structure\'' -> T.putformat(# do common.StructureLocation->s #);
  exit T[]
  #);

sigBetaArray:
  (# T: ^Text;
  do &Text[] -> T[];
     'class [\'%s\']\'BetaArray\'' -> T.putformat(# do common.BetaArrayLocation->s #);
  exit T[]
  #);


GenerateClassExOException:
  (# 
  do out.indent.save;
     0 -> out.indent.set;
     out.indent.inc;
     '\n'
     '//********************************************\n'
     '//*       Class: ExOException\n'
     '//********************************************\n'
     '.class public auto ansi beforefieldinit ExOException\n'
     '       extends [mscorlib]System.Exception\n'
     '{' -> out.putln;
     '.field public object exitobj' -> out.putln;
     '.field public int32 labno' -> out.putln;
     out.putln;
     '.method public hidebysig specialname rtspecialname '
     'instance void  .ctor(object e, int32 l) cil managed'
       -> out.putln;
     out.indent.inc;
     '{' -> out.putln;
     '.maxstack  2' -> out.putln;
     'ldarg.0' -> out.putln;
     'call  instance void [mscorlib]System.Exception::.ctor()' -> out.putln;
     'ldarg.0' -> out.putln;
     'ldarg.1' -> out.putln;
     'stfld  object ExOException::exitobj' -> out.putln;
     'ldarg.0' -> out.putln;
     'ldarg.2' -> out.putln;
     'stfld  int32 ExOException::labno' -> out.putln;
     'ret' -> out.putline;
     out.indent.dec;
     out.indent;
     '}' -> out.putline;
     out.indent.dec;
     out.indent;
     '}' -> out.putline;
     out.indent.restore;
  #);

GenerateClassStructure:
  (# 
  do out.indent.save;
     0 -> out.indent.set;
     out.indent.inc;
     '\n'
     '//********************************************\n'
     '//*       Class: Structure\n'
     '//********************************************\n'
     '.class public auto ansi beforefieldinit Structure\n'
     '  extends [mscorlib]System.Object\n'
     '{' -> out.putln;
     '.field public class [mscorlib]System.Object iOrigin' -> out.putln;
     '.field public class [mscorlib]System.Type iProto' -> out.putln;
     '.field private class [mscorlib]System.Reflection.ConstructorInfo iConstructor' -> out.putln;
     out.nl;
     
     '.method public hidebysig specialname rtspecialname instance void .ctor(class [mscorlib]System.Object, class [mscorlib]System.Type) cil managed' 
       -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  call instance void [mscorlib]System.Object::.ctor()' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  stfld  object Structure::iOrigin' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.2' -> out.putln;
     '  stfld  class [mscorlib]System.Type Structure::iProto' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldnull' -> out.putln;
     '  stfld  class [mscorlib]System.Reflection.ConstructorInfo Structure::iConstructor' -> out.putln;
     '  ret' -> out.putln;
     '} ' -> out.putln;
     out.nl;
     
     '.method public hidebysig static class Structure AlloS(class [mscorlib]System.Object o, class [mscorlib]System.Type p) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  3' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  newobj  instance void Structure::.ctor(object, class [mscorlib]System.Type)' -> out.putln;
     '  ret' -> out.putln;
     '  } ' -> out.putln;
     out.nl;
     
     '.method public hidebysig static class Structure '
     'ObjS(class [mscorlib]System.Object o) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  3' -> out.putln;
     '  .locals init ([0] class [mscorlib]System.Type proto,' -> out.putln;
     '  [1] class [mscorlib]System.Reflection.FieldInfo origin_field,' -> out.putln;
     '  [2] class [mscorlib]System.Object origin)' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()' -> out.putln;
     '  stloc.0' -> out.putln;
     '  ldloc.0' -> out.putln;
     '  ldstr  "origin"' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Reflection.FieldInfo [mscorlib]System.Type::GetField(class [mscorlib]System.String)' -> out.putln;
     '  stloc.1' -> out.putln;
     '  ldloc.1' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Object [mscorlib]System.Reflection.FieldInfo::GetValue(class [mscorlib]System.Object)' -> out.putln;
     '  stloc.2' -> out.putln;
     '  ldloc.2' -> out.putln;
     '  ldloc.0' -> out.putln;
     '  newobj  instance void Structure::.ctor(class [mscorlib]System.Object,' -> out.putln;
     '  class [mscorlib]System.Type)' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     '.method public hidebysig instance class [mscorlib]System.Object AlloSI() cil managed' -> out.putln;
     '  {' -> out.putln;
     '  .maxstack  4' -> out.putln;
     '  .locals init ([0] class [mscorlib]System.Reflection.ConstructorInfo[],' -> out.putln;
     '  [1] int32,' -> out.putln;
     '  [2] class [mscorlib]System.Reflection.ParameterInfo[],' -> out.putln;
     '  [3] class [mscorlib]System.Object[])' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Type Structure::iProto' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Reflection.ConstructorInfo[] [mscorlib]System.Type::GetConstructors()' -> out.putln;
     '  stloc.0' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Reflection.ConstructorInfo Structure::iConstructor' -> out.putln;
     '  brtrue.s  L1' -> out.putln;
     
     '  ldc.i4.0' -> out.putln;
     '  stloc.1' -> out.putln;
     '  br.s  L2' -> out.putln;
     
     'L4:' -> out.putln;  '  ldloc.0' -> out.putln;
     '  ldloc.1' -> out.putln;
     '  ldelem.ref' -> out.putln;
     '  callvirt   instance class [mscorlib]System.Reflection.ParameterInfo[] [mscorlib]System.Reflection.MethodBase::GetParameters()' -> out.putln;
     '  stloc.2' -> out.putln;
     '  ldloc.2' -> out.putln;
     '  ldlen' -> out.putln;
     '  conv.i4' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  bne.un.s  L3' -> out.putln;
     
     '  ldloc.2' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ldelem.ref' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Type [mscorlib]System.Reflection.ParameterInfo::get_ParameterType()' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Object Structure::iOrigin' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()' -> out.putln;
     '  callvirt  instance bool [mscorlib]System.Type::IsAssignableFrom(class [mscorlib]System.Type)' -> out.putln;
     '  brfalse.s  L3' -> out.putln;
     
     '  ldarg.0' -> out.putln;
     '  ldloc.0' -> out.putln;
     '  ldloc.1' -> out.putln;
     '  ldelem.ref' -> out.putln;
     '  stfld  class [mscorlib]System.Reflection.ConstructorInfo Structure::iConstructor' -> out.putln;
     '  br.s  L1' -> out.putln;
     
     'L3:' -> out.putln;  '  ldloc.1' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  add' -> out.putln;
     '  stloc.1' -> out.putln;
     'L2:' -> out.putln;  '  ldloc.1' -> out.putln;
     '  ldloc.0' -> out.putln;
     '  ldlen' -> out.putln;
     '  conv.i4' -> out.putln;
     '  blt.s  L4' -> out.putln;
     
     'L1:' -> out.putln; '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Reflection.ConstructorInfo Structure::iConstructor' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  newarr  [mscorlib]System.Object' -> out.putln;
     '  stloc.3' -> out.putln;
     '  ldloc.3' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Object Structure::iOrigin' -> out.putln;
     '  stelem.ref' -> out.putln;
     '  ldloc.3' -> out.putln;
     '  callvirt   instance object [mscorlib]System.Reflection.ConstructorInfo::Invoke(object[])' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     '.method public hidebysig static bool eqS(class Structure arg1, class Structure arg2) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  brtrue.s  L1' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  brtrue.s  L2' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  ret' -> out.putln;
     'L2:' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     'L1:' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  brtrue.s  L3' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     'L3:' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Type Structure::iProto' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  ldfld  class [mscorlib]System.Type Structure::iProto' -> out.putln;
     '  beq.s  L4' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     'L4:' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Object Structure::iOrigin' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  ldfld  class [mscorlib]System.Object Structure::iOrigin' -> out.putln;
     '  beq.s  L5' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     'L5:' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     '.method public hidebysig static bool  neS(class Structure arg1, class Structure arg2) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  call  bool Structure::eqS(class Structure, class Structure)' -> out.putln;
     '  ldc.i4.0' -> out.putln;
     '  ceq' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     '.method public hidebysig static bool  leS(class Structure arg1, class Structure arg2) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  call  bool Structure::eqS(class Structure, class Structure)' -> out.putln;
     '  brtrue.s  L1' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  call  bool Structure::ltS(class Structure, class Structure)' -> out.putln;
     '  ret' -> out.putln;
     'L1:' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     
     '.method public hidebysig static bool  geS(class Structure arg1, class Structure arg2) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  call  bool Structure::eqS(class Structure, class Structure)' -> out.putln;
     '  brtrue.s  L1' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  call  bool Structure::gtS(class Structure, class Structure)' -> out.putln;
     '  ret' -> out.putln;
     'L1:' -> out.putln;
     '  ldc.i4.1' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     '.method public hidebysig static bool  gtS(class Structure arg1, class Structure arg2) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  call  bool Structure::ltS(class Structure, class Structure)' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     out.nl;
     
     '.method public hidebysig static bool  ltS(class Structure arg1, class Structure arg2) cil managed' -> out.putln;
     '{' -> out.putln;
     '  .maxstack  2' -> out.putln;
     '  .locals init ([0] class [mscorlib]System.Type proto1,' -> out.putln;
     '  [1] class [mscorlib]System.Type proto2,' -> out.putln;
     '  [2] class [mscorlib]System.Object newObject,' -> out.putln;
     '  [3] class [mscorlib]System.Reflection.FieldInfo origin_field)' -> out.putln;
     '  ldarg.0' -> out.putln;
     '  brtrue.s  L1' -> out.putln;
     
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     
     'L1:' -> out.putln; '  ldarg.1' -> out.putln;
     '  brtrue.s  L2' -> out.putln;
     
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     
     'L2:' -> out.putln; '  ldarg.0' -> out.putln;
     '  ldfld  class [mscorlib]System.Type Structure::iProto' -> out.putln;
     '  stloc.0' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  ldfld  class [mscorlib]System.Type Structure::iProto' -> out.putln;
     '  stloc.1' -> out.putln;
     '  ldloc.0' -> out.putln;
     '  ldloc.1' -> out.putln;
     '  bne.un.s  L3' -> out.putln;
     
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     
     'L3:' -> out.putln; '  ldloc.0' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Type [mscorlib]System.Type::get_BaseType()' -> out.putln;
     '  stloc.0' -> out.putln;
     '  br.s  L4' -> out.putln;
     
     'L6:' -> out.putln;'  ldloc.0' -> out.putln;
     '  ldloc.1' -> out.putln;
     '  bne.un.s  L5' -> out.putln;
     
     '  ldarg.0' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Object Structure::AlloSI()' -> out.putln;
     '  stloc.2' -> out.putln;
     '  ldloc.0' -> out.putln;
     '  ldstr  "origin"' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Reflection.FieldInfo [mscorlib]System.Type::GetField(class [mscorlib]System.String)' -> out.putln;
     '  stloc.3' -> out.putln;
     '  ldloc.3' -> out.putln;
     '  ldloc.2' -> out.putln;
    '   callvirt   instance class [mscorlib]System.Object [mscorlib]System.Reflection.FieldInfo::GetValue(object)' -> out.putln;
     '  ldarg.1' -> out.putln;
     '  ldfld  class [mscorlib]System.Object Structure::iOrigin' -> out.putln;
     '  ceq' -> out.putln;
     '  ret' -> out.putln;
     
     'L5:' -> out.putln; '  ldloc.0' -> out.putln;
     '  callvirt  instance class [mscorlib]System.Type [mscorlib]System.Type::get_BaseType()' -> out.putln;
     '  stloc.0' -> out.putln;
     'L4:' -> out.putln; '  ldloc.0' -> out.putln;
     '  brtrue.s  L6' -> out.putln;
     
     '  ldc.i4.0' -> out.putln;
     '  ret' -> out.putln;
     '}' -> out.putln;
     
     out.indent.dec;
     out.indent;
     '}' -> out.putline;
     out.indent.restore;
  #);
