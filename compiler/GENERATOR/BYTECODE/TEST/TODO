BETA Bytecode TODO
==================

A. General
==========

1. Problem med overskrivning af program.il/program.J for hvert
   program.
    -> Muligvis lave subdirectory til denne navngivet udfra exefilen

2. Dependency analyse for .il/.J/.dll/.class filer

3. Correct variable names instead of F12 etc


B. Java specific
================

1. Generere .class filer direkte (udenom jasmin)


C. .NET specific
================

1. [OLM/PA]
   Jeg måtte udkommentere en række af de basale patterns i tstenv, da
   der genereres ikke-verificerbart kode fir disse. Primært fordi der
   er void funktioner, der efterlader noget på stakken. Det er
   f.eks. state, cstruct, der har problemet. Ikke nogen showstopper,
   da disse ikke kaldes.
 
2. [OLM]
   Derimod er det ikke så godt at vi stadig har main() i
   tstenv.il. Dette giver en "DLL initialization routine failed" fejl
   når man prøver at bruge BETA filer som library fra C# (den var svær
   at finde - elendig .NET fejlbesked!). Jeg har lavet et medledtidig
   workaround, og beskrevet det i README-dotnet.txt.
 
3. [OLM]
   Der er nogle lidt forkerte locations i tstenv.il (forhindrer
   verification, men åbenbart ikke execution (?)).  Det er i
   forbindelse med SLOTs, hvor der f.eks. genereres følgende i
   put.enter() i tstenv.il:
 
      .method public virtual void 'enter'(char) cil managed 
       {
         .maxstack 8
         ldarg.0 /*1*/
         ldarg.1
         stfld char class [put]put::F12 
         ret
      }
 
   Problemet er at det angives, at F12 ligger i klassen put i location
   put (dvs i put.dll), men F12 feltet er i class put i tstenv.il.
   Der er en 4-5 stykker af denne type fejl i put, newline, putInt.

   Desuden er der nogle *manglende locations* ved oversættelse af
   TST/btst (uden tstvirt2):

       assembling ~beta/compiler/TST/dotnet/slot_fill.il
       ...
       Error: Reference to undefined class 'preFill' (token 0x01000002)
       Error: Reference to undefined class 'fill' (token 0x01000005)
       ...
       assembling ~beta/compiler/TST/dotnet/slot_chk.il
       ...
       Error: Reference to undefined class 'chk' (token 0x01000006)


4. [OLM]
   GENERATOR/BYTECODE/TEST/multiple fejler
     -> bruger dup_x1/dup_x2
5. [OLM]
   Ved oversættelse af TST/hello.bet bruges [isPlatform]isPlatform
   som origin-argument til instantiering af slot_isPlatform i class
   isPlatform metode slot_isPlatform. Skulle være [tstenv]isPlatform
   eller blot isPlatform.

6. [OLM]
   Ved oversættelse af TST/btst crasher compiler under kodegenerering af
   tstvirt2.
   Sker både med nbeta og jbeta på pc men ikke med nogen af dem på sun
     -> Muligvis et problem med fil-stier

7. [OLM]
   tstlib refereres, men importeres ikke ved oversættelse af f.eks. 
   TST/tstarith.
     -> manglende import ved INCLUDE?
   Der er andre manglende imports - jeg må hardkode følgende:
   (skal nok lave liste af hvem der refererer hvis ikke de alle
   forsvinder med tstlib fejl rettelsen):

        '.assembly extern tstlib {}\n'
        '.assembly extern tstarith {}\n'
        '.assembly extern tstrelop {}\n'
        '.assembly extern tstbool {}\n'
        '.assembly extern tstblock {}\n'
        '.assembly extern tstvirt {}\n'
        '.assembly extern exe {}\n'
        '.assembly extern fill {}\n'
        '.assembly extern chk {}\n'
        '.assembly extern isPlatform {}\n'
        '.assembly extern tstenv {}\n'

8. [PA]
   All source files constituting an executable must currently reside
   in the same directory.
   We intent to generate strong assemblies and config files and/or use
   the Global Assembly Cache for solving this later.

9. [OLM]
   Vi skal kunne specificere fil location for en externalclass, og
   denne fil location skal med ind i import listen.
   Senere: Compiler skal kunne læse .Net assemblies direkte, så man ikke
   behøver at skulle erklære eksterne klasser og procedurer [PA]

10.[OLM/PA]
   Der er et problem som jeg kun ser ved oversættelse af
   TST/tstlibbody:
   Ved generering af slot_exe.il fås pludselig en pushVal med et
   offset som er 8 lige inden kaldet
     callvirt instance void slot_exe::do_2()
   i slot_exe::do_1(). Det er kaldt med hasFieldName=true, men med
   fieldnavnet "NoFieldName".
   Dette resulterer i en "ldloc.-1" instruktion, som er ulovlig.
   jbeta genererer en "iload_0" her(!)
