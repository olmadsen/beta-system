
BETA Bytecode TODO
==================

Prioriteter: *** Høj
	     **  Mellem
	     *   Lav

A. General
==========

1. Problem med overskrivning af program.il/program.J for hvert
   program.
    -> Muligvis lave subdirectory til denne navngivet udfra exefilen

2. Dependency analyse for .il/.J/.dll/.class filer


B. Java specific
================

1. Generere .class filer direkte (udenom jasmin)


C. .NET specific
================

1. ** [OLM/PA] 
   Jeg måtte udkommentere en række af de basale patterns i tstenv, da
   der genereres ikke-verificerbart kode for disse. Primært fordi der
   er void funktioner, der efterlader noget på stakken. Det er
   f.eks. state, cstruct, der har problemet. 
   Detaljer (verificeret statig tilstede 31/5)

   ------------------------------------------------------------------------------------
   CStruct::.ctor] [offset 0x0000000D] [opcode callvirt] Stack empty:
   
     .method public rtspecialname specialname hidebysig instance void .ctor(class ['tstenv']'tstenv')
     {
	   ldarg.0
	   call    instance void [mscorlib]System.Object::.ctor()
   
	   ldarg.0
	   ldarg.1
	   stfld   class ['tstenv']'tstenv' class ['tstenv']'CStruct'::origin
	   callvirt instance int32 class ['tstenv']'CStruct'::'byteSize'(int32)
	   ldarg.0
	   newarr int32
	   stfld   int32[] 'CStruct'::F12
	   ret
     }

   ------------------------------------------------------------------------------------
   CStruct_Byte::exit] [offset 0x00000000] [opcode dup] Stack underflow:
   
     .method public virtual int32 'exit'() cil managed
     {
	   .maxstack 8
	   dup
	   ldstr "FIXME: IL has no dup_x1/dup_x2 instructions"    <--------
	   call void [mscorlib]System.Console::WriteLine(string)
	   ret
     }
   
   Skulle åbenbart have været dup_x1, men det ville jo også give stack
   underflow
   
   ------------------------------------------------------------------------------------
   Samme er i Cstruct_long.

2. FIXED!
 
3. FIXED!

4. *** [OLM]
   GENERATOR/BYTECODE/TEST/multiple fejler
     -> bruger dup_x1/dup_x2

5. FIXED!

6. ** [OLM/PA]
   Ved oversættelse af TST/btst crasher compiler under kodegenerering af
   tstvirt2.
   Sker både med nbeta og jbeta på pc men ikke med nogen af dem på sun
     -> Muligvis et problem med fil-stier

7. FIXED!

8. [PA]
   All source files constituting an executable must currently reside
   in the same directory.
   We intent to generate strong assemblies and config files and/or use
   the Global Assembly Cache for solving this later.

9. * [OLM]
   Vi skal kunne specificere fil location for en externalclass, og
   denne fil location skal med ind i import listen.
   Senere: Compiler skal kunne læse .Net assemblies direkte, så man ikke
   behøver at skulle erklære eksterne klasser og procedurer [PA]

10. FIXED!

11. *** [OLM]
    Problem med slot_exe og exe:
      assembling ~beta/compiler/TST/dotnet/slot_exe.il
      Error: Reference to undefined class 'exe_preExe' (token 0x01000002)
      Error: Reference to undefined class 'exe' (token 0x01000006)
       
      Problemerne med 'exe_preExe'  skyldes:
      1. 'exe_preExe'   importeres - men der er ikke en fil med dette i.
      2. 
          .class public auto ansi 'slot_exe' extends exe_preExe{
                                                     ^^^^^^^ her mangler location ['tstlib'] ved superklasse
          ...
          .method public rtspecialname specialname hidebysig instance void .ctor(class ['tstlib']'exe')
          {
            ....
            call instance void exe_preExe::.ctor(class ['tstlib']'exe')
                               ^^^^^^^ her mangler location ['tstlib']
          Senere i filen er der en korrekt
            ldfld class ['tstenv']'text' class ['tstlib']'exe_preExe'::'S'
          Underligt?
       
      Problemerne med 'exe' skyldes:
      1. /********************************************/
          /*        Class slot_exe                    */
          /********************************************/
          .class public auto ansi 'slot_exe' extends exe_preExe{
          ....
         .method public virtual void 'do_1'() cil managed 
         {
               ....
               ldfld   class ['tstlib']'exe' class 'slot_exe'::origin 
               ldfld   class ['tstenv']'tstenv' class 'exe'::origin 
                                                      ^^^^^^^ her mangler location (['tstlib'])  
         Underligt: den er i forrige linie
      2. Samme problem kommer lidt senere i samme metode.
 
