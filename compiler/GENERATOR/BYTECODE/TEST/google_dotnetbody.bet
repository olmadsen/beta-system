ORIGIN 'google';
--LIB: attributes--

String: ExternalClass
  (# toCharArray: proc
       (# result: [0]@char
       exit result
       #);
  do '[mscorlib]System.String' -> className;
  #);
ResultElement: ExternalClass
  (# URL: proc
       (# result: ^String;
       exit result[]
       #);
  do '[GoogleSearchService]ResultElement' -> className;
  #);
GoogleSearchResult: ExternalClass
  (# resultElements: [0]^ResultElement;
  do '[GoogleSearchService]GoogleSearchResult' -> className;
  #);
GoogleSearchService: ExternalClass
  (# 
     doGoogleSearch: proc
       (# key: [0]@char; (* ^String *)
          q: [0]@char; (* ^String *)
          start: @int32;
          maxResults: @int32;
          filter: @boolean;
          restrict: [0]@char; (* ^String *)
          safeSearch: @Boolean;
          lr, ie, oe: [0]@char; (* ^String *)
          result: ^GoogleSearchResult;
       enter (key, q, start, maxResults, filter, restrict, safeSearch, lr, ie, oe)
       exit result[]
       #) 
  do '[GoogleSearchService]GoogleSearchService' -> className;
  #);

--DoSearchGoogle: dopart--
do (# google: ^GoogleSearchService;
      result: ^GoogleSearchResult;
      url: ^String;
   do &GoogleSearchService[] -> google[];
      (BetaLicenseKey, query, 0, 10, false, '', false, '', 'latin1', 'latin1')
        -> google.doGoogleSearch
        -> result[];
      (for i:result.resultElements.range repeat
           &text[] -> current[];
           result.resultElements[i].URL -> url[];
           url.toCharArray -> current;
           INNER SearchGoogle;
      for);
   #)
