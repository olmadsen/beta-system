LIB_ITEM 'betaenv'; 
ORIGIN 'tstenv';
(*INCLUDE 'javastring';*)
--lib: attributes--

String: ExternalClass
  (# 
  do 'java/lang/String' -> className;
  #);
writeI: External   
  (# ch: @char
  enter ch
  do 'java/io/PrintStream/print(I)V' -> callC 
  #);
writeC: External   
  (# ch: @char
  enter ch
  do 'java/io/PrintStream/print(C)V' -> callC 
  #);
readC: External   
  (# ch: @integer
  do 'java/io/InputStream/read()I' -> callC 
  exit ch
  #);
(* BufferedReader: ExternalClass
 *   (# _init:
 *        (# r: ^InputStreamReader {* really a reader *}
 *        enter r[]
 *        #);
 *      readLine: proc
 *        (# result: ^String;
 *        exit result[]
 *        #);
 *   do 'java/io/BufferedReader' -> classname;
 *   #);
 * Reader: ExternalClass
 *   (# 
 *   do 'java/io/Reader' -> classname;
 *      INNER;
 *   #);
 * InputStreamReader: ExternalClass {*Reader*} 
 *   (# _init:
 *        (# s: ^InputStream
 *        enter s[]
 *        #);
 *   do 'java/io/InputStreamReader' -> classname;
 *   #);
 * System: ExternalClass
 *   (# in: ^InputStream;
 *   do 'java/lang/System' -> classname;
 *   #);
 * InputStream: ExternalClass
 *   (# 
 *   do 'java/io/InputStream' -> classname;
 *   #);
 *)
---put:doPart--
do ch -> writeC
---putint:doPart--
do n -> writeI 
---newline:doPart---
do '\n' -> put
--get:doPart--
do readC -> ch;
   
--getline:doPart--
do (* (# reader: ^BufferedReader;
    *    inputreader: ^InputStreamReader;
    *    sys: ^System; (* FIXME: System.in is a static field * )
    * do sys.in[] -> &InputStreamReader[] -> inputreader[];
    *    inputreader[] -> &BufferedReader[] -> reader[];
    *    reader.readLine -> T[];
    * #);
    *)
   &text[] -> T[]; 
   
   (* Here is how to in java, but references static fields of System.
    * How do we load them i BETA?
    * 
    * Maybe make a simple implementation using get instead?
    * 
    * import java.io.*;
    * 
    * class readline {
    *   public static String ReadLine(){
    * 	  BufferedReader reader;
    * 	  reader = new BufferedReader(new InputStreamReader(System.in));
    * 	  try {
    * 	    return reader.readLine();
    * 	  } catch (IOException e) {
    *       return "";
    *     }
    * }
    * 
    * Bytecode:
    * 
    * Method name:"ReadLine" public static Signature: 27=()java.lang.String                    
    * Attribute "Code", length:71, max_stack:5, max_locals:2, code_length:27                   
    *   0: new #2=<Class java.io.BufferedReader>                                               
    *   3: dup                                                                                 
    *   4: new #3=<Class java.io.InputStreamReader>                                            
    *   7: dup                                                                                 
    *   8: getstatic #4=<Field java.lang.System.in java.io.InputStream>                        
    *  11: invokespecial #5=<Method java.io.InputStreamReader.<init> (java.io.InputStream)void>
    *  14: invokespecial #6=<Method java.io.BufferedReader.<init> (java.io.Reader)void>        
    *  17: astore_0                                                                            
    *  18: aload_0                                                                             
    *  19: invokevirtual #7=<Method java.io.BufferedReader.readLine ()java.lang.String>        
    *  22: areturn                                                                             
    *  23: astore_1                                                                            
    *  24: ldc #9=<String "">                                                                  
    *  26: areturn                                                                             
    *)
   















