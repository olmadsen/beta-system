LIB_DEF 'tstenv' 'lib';   
mdbody 
   javabc  'javabctstenvbody'
   dotnet  'dotnettstenvbody';
------------tstenv: descriptor--------------   
(* Note: this form MUST be called tstenv in order 
 * NOT to confuse bytecode compiler
 *)
(************************************************)
(*           Minimal BETA environment           *)
(************************************************)
(# program: <<SLOT Program: descriptor>>;  
   
   <<SLOT LIB: attributes>>;
   xput: 
     (# ch: @char;     
     enter ch    
     <<SLOT put:doPart>> 
     #);       

   put: external
     (# ch: @char;     
     enter ch    
     #);      
   putint: external      
     (# V: @integer   
     enter V  
     #);   
   newline: external (# #) ; 

   putText: external     
     (# T: [1] @char
     enter T
     #); 
   putLine: external     
     (# T: [1] @char
     enter T
     #);  
   text: (# T: [1] @char; lgth,pos: @integer enter T exit T #);
   BOOLEAN: (#  #);
   FALSE: BOOLEAN(# #);
   TRUE: BOOLEAN(# #);  
   int8: (# #);
   CHAR: (# #); int8u: (# #);
   int16: (# #);
   int16u: (# #); shortInt: (# #);
   int32: (# #); INTEGER: (# #); 
   int32u: (# #);
   int64: (# #);
   int64u: (# #);    
   real: (# x,y: @integer enter(x,y) exit(x,y) (* realdesc *) #);
   External:
     (# CallC,CallStd,CallPascal,Pascal,PascalTrap,
  	cExternalEntry,PascalExternalEntry: @text;
        procname: @text; (* name to call with - derive arguments from enter list *)
        signature: @text; (* full signature *)
     #); 
   ExternalClass:
     (# classname: @text;
     #);
   class: (# (*classname: @text;*) #);    
   proc: (# (*procname: @text;*) #); 
   data: (# #); 
   Object:  
     (# _Struc:  
          (# (* Changed 12/8/97 by datpete: 
              * eliminates need for runtime routine ThisS
              *)  
             (* R: ##Object do TOS'ThisS'->R## exit R## *)
          exit THIS(Object)## 
          #);
        _state:
          (# S: ##object
          enter S##    
          do (# R: ^object; 
                A,B,P: @integer
             do this(object)[] -> R[];
                (%getLongAt @@S) -> A; (* address of S *)
                (* copy prototype *)
                (%getLongAt (A+12)) -> P; (* the prototype of S*)
                (%getLongAt @@R) -> B; (* address of R*)
                (P+24) %putLongAt (B); (* with COM prototypes, point to the VDT*)
                (* copy origin *)
                (%getLongAt (A+8)) -> P;  
                (*(P) %putLongAt (B+8);*);
             #)
          #);
     do INNER    
     #); 
   repetition:       
     (* pattern describing repetitions.
      * Do NOT use as superpattern!!! 
      *) 
     (# range: (* exit the range of THIS(rep) *)
          (# n: @ integer exit N #);
        new: 
          (* allocate a new repetition of N elements
           * the current elements in THIS(rep) becomes inaccessible
           *)
          (# n: @integer enter n #);
        extend: (* extend THIS(rep) by N elements *)
          (# N: @integer enter N #);  
     #);
   
do (* currently this  do-part is ignored by
    * the byte code platforms; the program-form
    * is executed directly as Main
    *)
   'O'->put;  
   'K'->puttext;
   '.'->puttext; 
   newline;
   program;     
   newline
#) 


 
    


 
 


 
