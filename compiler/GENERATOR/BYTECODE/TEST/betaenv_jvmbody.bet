ORIGIN 'betaenvbody';

--LIB: attributes--

writeI: External   
  (# ch: @char
  enter ch
  do 'java/io/PrintStream/print(I)V' -> callC 
  #);
writeC: External   
  (# ch: @char
  enter ch
  do 'java/io/PrintStream/print(C)V' -> callC 
  #);
readC: External   
  (# ch: @integer
  do 'java/io/InputStream/read()I' -> callC 
  exit ch
  #);

JavaConsole: Stream
  (# Eos::< 
       (# do true->value #); 
     OtherError::< 
       (# do 'Screen error'->msg.puttext #);
     Get::< 
       (# do 'Warning: attempt to Get from the Screen' -> screen.putline; #);
     Put::< 
       (# do ch -> writeC; #);
     PutText::< 
       (# 
       do (* FIXME *)
          (for i: txt.lgth repeat
               txt.T[i] -> put
          for)
       #);
  #);
JavaKeyBoard: Stream
  (# Eos::<
       (# do false -> value (* FIXME *) #);
     OtherError::< 
       (# do 'Keyboard error'->msg.puttext #);
     Put::< 
       (# do 'Warning: attempt to Put to the Keyboard' -> screen.putline; #);
     Get::<
       (# do readC -> ch #);
     GetAtom::<
       (# 
       do (* FIXME *)
       #);
     GetLine::<
       (# 
       do (* FIXME *)
       #);
     Peek::<
       (# (* FIXME *) #);
  #);

--betaenv_machine_type: dopart--
do 'jvm' -> T;

--- betaenvStop: dopart ---
do 
   
--- betaenv_state:doPart ---
do 
 
--- betaenvInfReal: dopart ---
do 
   
--- betaenvDoGC: dopart ---
do 
   
--betaenvbodyMDInitAscii: descriptor-- 
(#
do
   (* 
    * FIXME: bytecode verification problems
    *    
    *    {* Initialize private.NonWhiteSpace. Offsett by one to allow test for
    *     * isNonWhiteSpace(0)
    *     *}
    *    {* From '!'(33) to '~'(126) is NonWhiteSpace *}
    *    (for ch: (126-33+1) repeat true->private.NonWhiteSpace[ch+33] for);
    *    {* From <inverted exclamation>(161) to <y umlaut>(255) is NonWhiteSpace 
    *     * (iso8859, Latin-1)
    *     *}
    *    (for ch: (255-161+1) repeat true->private.NonWhiteSpace[ch+161] for);
    *)

#)
--betaenvInitEnv: descriptor--
(# 
do ascii.init;
   ascii.nl-> ascii.newline;
   &JavaConsole[]->screen[]; 
   &JavaKeyboard[]->keyboard[];
#)

--betaenvTerminateEnv: descriptor--
(##)

--- betaenvNoOfArguments: dopart ---
do
   
--- betaenvArguments: dopart ---
do 
   
--- betaenvExpandArgumentsprivate: descriptor ---
(##)

--- betaenvExpandNoOfArguments: dopart ---
do 
   
--- betaenvExpandArguments: dopart ---
do  

--- betaenvPrivate: descriptor ---
(##)

--- exceptionMain: dopart ---
do    
--- exceptTryHandlerWhenContinue: dopart ---
do 
--- exceptTryHandlerWhenRetry: dopart ---
do 
--- exceptTryHandlerWhenPropagate: dopart ---
do    
--- exceptTryHandlerWhenAbort: dopart ---
do    
--- exceptTryHandlerWhen: descriptor ---
(##)
--- exceptTryHandlerPrivate: descriptor ---
(##)
--- exceptTryPrivate: descriptor ---
(##)
--- exceptTryHandle: descriptor ---
(##)
--- exceptTry: dopart ---
do
--- exceptThrowPrivate: descriptor ---
(##)

--- exceptThrow: dopart ---
do 
