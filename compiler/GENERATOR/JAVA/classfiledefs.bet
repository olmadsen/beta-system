ORIGIN '~beta/basiclib/betaenv';
--LIB: attributes--

(* classfiledefs.bet:
 *   Patterns for manipulating Java class files.
 * 
 *   See http://java.sun.com/docs/books/vmspec/2nd-edition/html/ClassFile.doc.html
 *
 *   $Id: classfiledefs.bet,v 1.1 2002-06-11 14:10:09 datpete Exp $
 *)

JAVA_MAGIC: (# exit 0xcafebabe #);
JAVA_MAJOR: (# exit 3 #);
JAVA_MINOR: (# exit 45 #);

(* Access flags *)
ACC_PUBLIC: (# exit 0x0001 #);
ACC_PRIVATE: (# exit 0x0002 #);
ACC_PROTECTED: (# exit 0x0004 #);
ACC_STATIC: (# exit 0x0008 #);
ACC_FINAL: (# exit 0x0010 #);
ACC_SYNCHRONIZED: (# exit 0x0020 #);
ACC_SUPER: (# exit 0x0020 #);
ACC_VOLATILE: (# exit 0x0040 #);
ACC_TRANSIENT: (# exit 0x0080 #);
ACC_NATIVE: (# exit 0x0100 #);
ACC_INTERFACE: (# exit 0x0200 #);
ACC_ABSTRACT: (# exit 0x0400 #);
ACC_STRICT: (# exit 0x0800 #);

ACC_VISIBILITY:
  (# exit (ACC_PUBLIC %Bor ACC_PRIVATE %Bor ACC_PROTECTED) #);

(* Constant types *)

CONSTANT_Class: (# exit 7 #);
CONSTANT_Fieldref: (# exit 9 #);
CONSTANT_Methodref: (# exit 10 #);
CONSTANT_InterfaceMethodref: (# exit 11 #);
CONSTANT_String: (# exit 8 #);
CONSTANT_Integer: (# exit 3 #);
CONSTANT_Float: (# exit 4 #);
CONSTANT_Long: (# exit 5 #);
CONSTANT_Double: (# exit 6 #);
CONSTANT_NameAndType: (# exit 12 #);
CONSTANT_Utf8: (# exit 1 #);
CONSTANT_Unicode: (# exit 2 #);

DEFAULT_CLASS_PATH:
  (# exit '.' #);

(* /* Extract a character from a Java-style Utf8 string.
 *  * PTR points to the current character.
 *  * LIMIT points to the end of the Utf8 string.
 *  * PTR is incremented to point after the character that gets returned.
 *  * On an error, -1 is returned. */
 * #define UTF8_GET(PTR, LIMIT) \
 *   ((PTR) >= (LIMIT) ? -1 \
 *    : *(PTR) < 128 ? *(PTR)++ \
 *    : {*(PTR)&0xE0) == 0xC0 && ((PTR)+=2)<=(LIMIT) && ((PTR)[-1]&0xC0) == 0x80 \
 *    ? (((PTR)[-2] & 0x1F) << 6) + ((PTR)[-1] & 0x3F) \
 *    : {*(PTR) & 0xF0) == 0xE0 && ((PTR) += 3) <= (LIMIT) \
 *    && ((PTR)[-2] & 0xC0) == 0x80 && ((PTR)[-1] & 0xC0) == 0x80 \
 *    ? (((PTR)[-3]&0x0F) << 12) + (((PTR)[-2]&0x3F) << 6) + ((PTR)[-1]&0x3F) \
 *    : ((PTR)++, -1))
 * 
 *)
