ORIGIN '../javaimage';

--program: descriptor--
(# jcf: @JavaImage(# init:: (# do true->traceclassfile #)#);
do 'Writing Pi.class ... ' -> puttext;
   'Pi.class' -> jcf.init;

   'Pi'
     -> jcf.constant_pool.classes.addtext
     -> jcf.thisClassIndex;
   'java/lang/Object'
     -> jcf.constant_pool.classes.addtext 
     -> jcf.superClassIndex;
   
   (* Method: <init> *)
   (ACC_PUBLIC, '<init>', '()V',  1,  1) -> jcf.currentmethod.new;
   aload_0       -> jcf.emit;
   invokespecial -> jcf.emit; ('java/lang/Object', '<init>', '()V') -> jcf.emitMethodRef;
   return        -> jcf.emit;
   
   (* Method: main *)
   (ACC_PUBLIC %Bor ACC_STATIC, 'main', '([Ljava/lang/String;)V',  3,  1) -> jcf.currentmethod.new;
   getstatic     -> jcf.emit; ('java/lang/System', 'out', 'Ljava/io/PrintStream;')->jcf.emitFieldRef;
   ldc2_w        -> jcf.emit; 3.1415 -> jcf.emitDoubleConstant;
   invokevirtual -> jcf.emit; ('java/io/PrintStream', 'println', '(D)V') -> jcf.emitMethodRef;
   return        -> jcf.emit;
   
   (* Now write the class file *)
   jcf.emitToFile;
   
   'done' -> putline;
#)

