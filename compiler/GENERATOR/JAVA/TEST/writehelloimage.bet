ORIGIN '../javaimage';

(* Writes file HelloWorld.class identical to 
 * the file written by compiling helloworld.java
 * without debug info, USING JAVAIMAGE.
 * 
 *)

--program: descriptor--
(# jcf: @JavaImage;
do 'Writing HelloWorld.class ... ' -> puttext;
   'HelloWorld.class' -> jcf.init;
   true -> jcf.traceClassFile;

   'HelloWorld'
     -> jcf.constant_pool.classes.addtext
     -> jcf.thisClassIndex;
   'java/lang/Object'
     -> jcf.constant_pool.classes.addtext 
     -> jcf.superClassIndex;
   
   (* Method: <init> *)
   (ACC_PUBLIC, '<init>', '()V',  1,  1) -> jcf.currentmethod.new;
   aload_0       -> jcf.emit;
   invokespecial -> jcf.emit; ('java/lang/Object', '<init>', '()V') -> jcf.emitMethodRef;
   return        -> jcf.emit;
   
   (* Method: main *)
   (ACC_PUBLIC %Bor ACC_STATIC, 'main', '([Ljava/lang/String;)V',  2,  1) -> jcf.currentmethod.new;
   getstatic     -> jcf.emit; ('java/lang/System', 'out', 'Ljava/io/PrintStream;')->jcf.emitFieldRef;
   'Hello Image World!' -> jcf.emitLoadString;
   invokevirtual -> jcf.emit; ('java/io/PrintStream', 'println', '(Ljava/lang/String;)V') -> jcf.emitMethodRef;
   return        -> jcf.emit;
   
   (* Now write the class file *)
   jcf.emitToFile;
   
   'done' -> putline;
#)

