ORIGIN 'classfile';
INCLUDE '~beta/sysutils/endian';

--ClassFileWrite: dopart--
do (if trace then ('magic',magic)->TracePosValue if);
   magic -> htonl -> putLong;
   (if trace then ('minor',minor)->TracePosValue if);
   minor -> htons -> putShort;
   (if trace then ('major',major)->TracePosValue if);
   major -> htons -> putShort;
   (if trace then 'constant pool'->TracePos if);
   constant_pool.write;
   (if trace then ('access_flags',access_flags)->TracePosValue if);
   access_flags -> htons -> putShort;
   (if trace then ('this_class',this_class)->TracePosValue if);
   this_class -> htons -> putShort;
   (if trace then ('super_class',super_class)->TracePosValue if);
   super_class -> htons -> putShort;
   (if trace then 'interfaces'->TracePos if);
   interfaces.write;
   (if trace then 'fields'->TracePos if);
   fields.write;
   (if trace then 'methods'->TracePos if);
   methods.write;
   (if trace then 'attributes'->TracePos if);
   attributes.write;
   (if trace then
       'You may want to compare dumps of the class with the\n'
       'corresponding Java generated class by dumping each with:\n'
         -> screen.puttext;
       '  od -A x -x ' -> screen.puttext; name -> screen.putline;
       'or:' -> screen.putline;
       '  ./dump ' -> screen.puttext; name -> screen.putline;
   if);
