ORIGIN '~beta/basiclib/systemenv';
INCLUDE '~beta/process/streamsocket';
INCLUDE '~beta/process/processmanager';

--- program:descriptor ---
systemEnv
(# 
   port: (# exit 6133 #);
   host: (# exit 'localhost' #);
   
   s: @StreamSocket
     (# error::
          (# 
          do true->SocketFailedFlag;
             errCB_abortOperation->value;
          #)
     #);
   SocketFailedFlag: @Boolean;
   arg: ^Text;
   
   startNewMjolner:
     (# p: @Process;
     do 'mjolner'->p.init;
        arg[]->p.argument.append;
        p.start;
     #);
        
do (if noOfArguments<2 then
       'Usage: mjolnerdoit "<Command> <Arguments>+"'->screen.putLine;
       'Commands include "OpenFile <filename>"'->screen.putLine;
       (normal, NONE)->Stop;
   if);
   &Text[]->arg[];
   (for i: noOfArguments-1 repeat
        i+1->arguments->arg.putText;
        (if i<>noOfArguments-1 then
            ' '->arg.put;
        if)
   for);
   s.init;
   (2, host, port) -> s.connect;
   (if SocketFailedFlag then
       startNewMjolner;
    else
       arg[]->s.putLine;
       s.close;
   if);
#)
