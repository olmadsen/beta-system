ORIGIN 'collection';
LIB_DEF 'contsets' '../lib';
BODY 'private/setsBody';
(*
 * COPYRIGHT
 *       Copyright (C) Aarhus University
 *       All rights reserved.
 *)
--- lib: attributes ---
multiSet: collection
  (* MultiSet is a data structure for collecting elements (dublicates
   * are allowed of the same element).  Defines no new operations.
   * MultiSet is the superpattern for Set, which ignores dublicates.
   * The available subpatterns are (indentation specifies
   * specialization): 
   *       multiSet
   *          set
   *             classification
   *)
  (# <<SLOT multiSetLib: attributes>>;
     theScanner::<  (* private *)
       (# 
       <<SLOT multiSetTheScannerDoPart: doPart >>
       #);
     find::
       (# 
       <<SLOT multiSetFindDopart: doPart >>
       #);
     copy::<
       (# 
       <<SLOT multiSetCopyDoPart:doPart >>
       #);
     empty::<
       (# 
       <<SLOT multiSetEmptyDopart:doPart >>
       #);
     capacity::<
       (# 
       <<SLOT multiSetCapacityDopart:doPart>>
       #);
     has::<
       (# myEqual:@equal;
       <<SLOT multiSetHasDopart:doPart>>
       #);
     clear::< (# <<SLOT multiSetClearDopart: dopart>> #);
     size::< (# <<SLOT multiSetSizeDopart: dopart>> #);
     insert::< 
       (* inserting in a multiSet is somewhat dependent on the
        * particular subpattern.  In some cases, insertion in only
        * done if the element is not already in the multiSet
        * (e.g. sets).  The local attribute, allowedToInsert, controls
        * whether the element is actually inserted in the multiSet.
        *)
       (# allowedToInsert: @boolean;
          multiSetInsertPrivate: @ (* O(1) amort. *)
            <<SLOT multiSetInsertPrivate: descriptor>>
       do true->allowedToInsert; 
          INNER; 
          (if allowedToInsert then multiSetInsertPrivate if)
       #);
     delete::< 
       (# multiSetDeletePrivate: @<<SLOT multiSetDeletePrivate: descriptor>> 
       do multiSetDeletePrivate; 
          INNER 
       #);
     theCellType::< (* Private *)
       (# pred, succ: (* Private *) ^theCellType;
       do INNER #);
     doEnter::<
       (# containerType::<multiSet;
       <<SLOT multiSetDoEnter:DoPart>>
       #);
     private:@<<SLOT multiSetPrivate:descriptor>>;
  do INNER
  #) (* multiSet *);

(*------------------------------------------------------------*)
(*--- set: multiSet ------------------------------------------*)
(*------------------------------------------------------------*)

set: multiSet
  (* A set is a multiSet in which dublicates are removed (ie. not inserted).  
   * Defines no new operations.
   *)
  (# <<SLOT setLib: attributes>>;
     insert::< 
       (* Inserts only the element if it is not in the set already *)
       (# <<SLOT setInsertDopart: dopart>> #);
     doEnter::<
       (# containerType::<Set;
       do INNER
       #);
  do INNER
  #) (* set *);
