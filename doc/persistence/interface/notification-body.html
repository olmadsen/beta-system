<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<!-- Autogenerated file - do not edit -->
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE>Notification Interface</TITLE>
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">

<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/hashfromparent.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript">
<!--
    CheckParent("notification");
//-->
</SCRIPT>
<BASE TARGET="_parent">
</HEAD>
<BODY onLoad='HashFromParent()'>
<H1><A name="notification">Notification Interface</A></H1>

<PRE CLASS=interface>
ORIGIN 'clientinterface';
INCLUDE '~beta/sysutils/time'
        'samefile'
        '~beta/sysutils/pathhandler';
(* File notification.bet
 * =====================
 * This file is a library containing the declarations used
 * when using notifications. This file has to be included by
 * the clients, if they want to subscribe to notifications.
*)
-- shellEnvLib: Attributes --
<B>NPSclient</B><A name="NPSclient.1(71)"></A>: PSclient
  (#
     <B>notify</B><A name="NPSclient.1.notify.2(72)"></A><A name="notify.2(72)"></A>: entry
       (# theNotification: ^notification; 
       enter theNotification[]
       do theNotification[]-&gt;notifyImpl; 
       #);
     <B>notifyImpl</B><A name="NPSclient.1.notifyImpl.2(73)"></A><A name="notifyImpl.2(73)"></A>:&lt;
       (# theNotification: ^notification; 
       enter theNotification[]
       do INNER
       #)
  #);
<B>Create</B><A name="Create.1(74)"></A>: (#  exit 1 #);
<B>Open</B><A name="Open.1(75)"></A>: (#  exit 2 #);
<B>Close</B><A name="Close.1(76)"></A>: (#  exit 3 #);
<B>Update</B><A name="Update.1(77)"></A>: (#  exit 4 #);
<B>Lock</B><A name="Lock.1(78)"></A>: (#  exit 5 #);
<B>Unlock</B><A name="Unlock.1(79)"></A>: (#  exit 6 #);
<B>WaitforLock</B><A name="WaitforLock.1(80)"></A>: (#  exit 7 #);
<B>event</B><A name="event.1(81)"></A>:
  (#
     <B>type</B><A name="event.1.type.2(82)"></A><A name="type.2(82)"></A>: @integer;
     <B>info</B><A name="event.1.info.2(83)"></A><A name="info.2(83)"></A>:&lt; (#  #);
     <B>theinfo</B><A name="event.1.theinfo.2(84)"></A><A name="theinfo.2(84)"></A>: @info;
     <B>display</B><A name="event.1.display.2(85)"></A><A name="display.2(85)"></A>:&lt;
       (# 
       do 'Eventtype: '-&gt;puttext;
          (if type
           // Create then
              'CREATE'-&gt;putline; 
           // Open then
              'OPEN'-&gt;putline; 
           // Close then
              'CLOSE'-&gt;putline; 
           // Update then
              'UPDATE'-&gt;putline; 
           // Lock then
              'LOCK'-&gt;putline; 
           // Unlock then
              'UNLOCK'-&gt;putline; 
           // WaitforLock then
              'WAIT FOR LOCK'-&gt;putline; 
           else
              'Unknown'-&gt;putline; 
          if);
          INNER ;
          
       #);
     <B>match</B><A name="event.1.match.2(86)"></A><A name="match.2(86)"></A>:&lt;
       (# theEvent: ^event; ok: @boolean; 
       enter theEvent[]
       do false-&gt;ok; (if (type = theEvent.type) then true-&gt;ok; INNER if); 
       exit ok
       #);
     
  do INNER ; 
  #);
<B>PSevent</B><A name="PSevent.1(87)"></A>: event
  (#
     <B>info</B><A name="PSevent.1.info.2(88)"></A><A name="info.2(88)"></A>::&lt;  (# PSname: ^text;  #);
     <B>display</B><A name="PSevent.1.display.2(89)"></A><A name="display.2(89)"></A>::&lt; (#  do 'Name of PS: '-&gt;puttext; theinfo.PSname[]-&gt;putline;  #);
     <B>match</B><A name="PSevent.1.match.2(90)"></A><A name="match.2(90)"></A>::&lt; 
       (# thePSEvent: ^PSevent; 
       do theEvent[]-&gt;thePSEvent[];
          false-&gt;ok;
          (if
          (((theinfo.PSname[],thePSEvent.theinfo.PSname[])-&gt;sameFile) or
           ('all'-&gt;theinfo.PSname.equal)) then
              true-&gt;ok; 
          if);
          
       #);
     
  do INNER ; 
  #);
<B>subscription</B><A name="subscription.1(91)"></A>:
  (#
     <B>theEvent</B><A name="subscription.1.theEvent.2(92)"></A><A name="theEvent.2(92)"></A>: ^event;
     (*the event to be notified about*)
     <B>user</B><A name="subscription.1.user.2(93)"></A><A name="user.2(93)"></A>: ^text;
     (*the user/s of interest*)
     <B>theClient</B><A name="subscription.1.theClient.2(94)"></A><A name="theClient.2(94)"></A>: ^NPSclient;
     (*the subsribing client*)
     <B>display</B><A name="subscription.1.display.2(95)"></A><A name="display.2(95)"></A>:
       (# 
       do 'Subscribed to user/s: '-&gt;puttext;
          user[]-&gt;putline;
          'Subscribing client: '-&gt;puttext;
          theClient.ri.shellAdr.astext-&gt;putline;
          theEvent.display;
          
       #);
     
  #);
<B>notification</B><A name="notification.1(96)"></A>:
  (#
     <B>theEvent</B><A name="notification.1.theEvent.2(97)"></A><A name="theEvent.2(97)"></A>: ^event;
     <B>theUser</B><A name="notification.1.theUser.2(98)"></A><A name="theUser.2(98)"></A>: ^text;
     (*the user/s of interest*)
     <B>timestamp</B><A name="notification.1.timestamp.2(99)"></A><A name="timestamp.2(99)"></A>: @integer;
     (* the time at what the event happened*)
     <B>display</B><A name="notification.1.display.2(100)"></A><A name="display.2(100)"></A>:
       (# ch: @char; 
       do (* ascii.bel-&gt;put; *)
          newline;
          '**********Notification**************************'-&gt;putline;
          'Timestamp: '-&gt;puttext;
          timestamp-&gt;formattime-&gt;puttext;
          newline;
          'User which caused the event: '-&gt;puttext;
          theUser[]-&gt;putline;
          theEvent.display;
          '************************************************'-&gt;putline;
          
       #);
     
  #);
<B>subscribetoEvent</B><A name="subscribetoEvent.1(101)"></A>:
  (# (*theServer: ^PersistentStoreManager;*)
     <B>theClient</B><A name="subscribetoEvent.1.theClient.2(102)"></A><A name="theClient.2(102)"></A>: ^NPSclient; <B>user</B><A name="subscribetoEvent.1.user.2(103)"></A><A name="user.2(103)"></A>: ^text; <B>theSubscription</B><A name="subscribetoEvent.1.theSubscription.2(104)"></A><A name="theSubscription.2(104)"></A>: ^subscription; 
  enter (theClient[], (*theServer[],*) user[])
  do &amp;subscription[]-&gt;theSubscription[];
     theClient[]-&gt;theSubscription.theClient[];
     user[]-&gt;theSubscription.user[];
     INNER ;
     (*theSubscription[]-&gt;theServer.subscribeNotification;*)
     
  exit theSubscription[]
  #);
<B>subscribetoPSEvent</B><A name="subscribetoPSEvent.1(105)"></A>: subscribetoEvent
  (# <B>PSname</B><A name="subscribetoPSEvent.1.PSname.2(106)"></A><A name="PSname.2(106)"></A>: ^text; <B>fullname</B><A name="subscribetoPSEvent.1.fullname.2(107)"></A><A name="fullname.2(107)"></A>: ^text; <B>theEvent</B><A name="subscribetoPSEvent.1.theEvent.2(108)"></A><A name="theEvent.2(108)"></A>: ^PSEvent; <B>thetype</B><A name="subscribetoPSEvent.1.thetype.2(109)"></A><A name="thetype.2(109)"></A>: @integer
  enter (PSname[],thetype)
  do &amp;PSEvent[]-&gt;theEvent[];
     (if (not ('all'-&gt;PSname.equal)) then
         PSname[]-&gt;getfullname-&gt;fullname[];
         fullname[]-&gt;theEvent.theinfo.PSname[];
         
      else
         'all'-&gt;theEvent.theinfo.PSname[]; 
     if);
     thetype-&gt;theEvent.type;
     INNER ;
     theEvent[]-&gt;theSubscription.theEvent[];
     
  #);
<B>unsubscribefromEvent</B><A name="unsubscribefromEvent.1(110)"></A>:
  (# (*theServer: ^PersistentStoreManager;*)
     <B>theClient</B><A name="unsubscribefromEvent.1.theClient.2(111)"></A><A name="theClient.2(111)"></A>: ^NPSclient; <B>user</B><A name="unsubscribefromEvent.1.user.2(112)"></A><A name="user.2(112)"></A>: ^text; <B>theSubscription</B><A name="unsubscribefromEvent.1.theSubscription.2(113)"></A><A name="theSubscription.2(113)"></A>: ^subscription; 
  enter (theClient[], (*theServer[],*) user[])
  do &amp;subscription[]-&gt;theSubscription[];
     theClient[]-&gt;theSubscription.theClient[];
     user[]-&gt;theSubscription.user[];
     INNER ;
     (*theSubscription[]-&gt;theServer.unsubscribeNotification;*)
     
  exit theSubscription
  #);
<B>unsubscribefromPSEvent</B><A name="unsubscribefromPSEvent.1(114)"></A>: unsubscribefromEvent
  (#
     <B>PSname</B><A name="unsubscribefromPSEvent.1.PSname.2(115)"></A><A name="PSname.2(115)"></A>: ^text; <B>fullname</B><A name="unsubscribefromPSEvent.1.fullname.2(116)"></A><A name="fullname.2(116)"></A>: ^text; <B>theEvent</B><A name="unsubscribefromPSEvent.1.theEvent.2(117)"></A><A name="theEvent.2(117)"></A>: ^PSEvent; <B>thetype</B><A name="unsubscribefromPSEvent.1.thetype.2(118)"></A><A name="thetype.2(118)"></A>: @integer; 
  enter (PSname[],thetype)
  do &amp;PSEvent[]-&gt;theEvent[];
     (if (not ('all'-&gt;PSname.equal)) then
         PSname[]-&gt;getfullname-&gt;fullname[];
         fullname[]-&gt;theEvent.theinfo.PSname[];
         
      else
         'all'-&gt;theEvent.theinfo.PSname[]; 
     if);
     thetype-&gt;theEvent.type;
     INNER ;
     theEvent[]-&gt;theSubscription.theEvent[];
     
  #);
<B>sendNotification</B><A name="sendNotification.1(119)"></A>:
  (#
     <B>theClient</B><A name="sendNotification.1.theClient.2(120)"></A><A name="theClient.2(120)"></A>: ^NPSclient;
     (*theServer: ^PersistentStoreManager;*)
     <B>user</B><A name="sendNotification.1.user.2(121)"></A><A name="user.2(121)"></A>: ^text;
     <B>theNotification</B><A name="sendNotification.1.theNotification.2(122)"></A><A name="theNotification.2(122)"></A>: ^notification;
     
  enter (theClient[], (*theServer[],*) user[])
  do &amp;notification[]-&gt;theNotification[];
     user[]-&gt;theNotification.theUser[];
     systemTime-&gt;theNotification.timestamp;
     INNER ;
     (*(theClient[],theNotification[])-&gt;theServer.notify;*)
     
  exit theNotification[]
  #);
<B>sendPSNotification</B><A name="sendPSNotification.1(123)"></A>: sendNotification
  (# <B>PSname</B><A name="sendPSNotification.1.PSname.2(124)"></A><A name="PSname.2(124)"></A>: ^text; <B>theEvent</B><A name="sendPSNotification.1.theEvent.2(125)"></A><A name="theEvent.2(125)"></A>: ^PSEvent; <B>thetype</B><A name="sendPSNotification.1.thetype.2(126)"></A><A name="thetype.2(126)"></A>: @integer; 
  enter (PSname[],thetype)
  do &amp;PSEvent[]-&gt;theEvent[];
     PSname[]-&gt;theEvent.theinfo.PSname[];
     thetype-&gt;theEvent.type;
     INNER ;
     theEvent[]-&gt;theNotification.theEvent[]
  #);
<B>getfullname</B><A name="getfullname.1(127)"></A>:
  (# <B>name</B><A name="getfullname.1.name.2(128)"></A><A name="name.2(128)"></A>,<B>fullname</B><A name="getfullname.1.fullname.2(129)"></A><A name="fullname.2(129)"></A>: ^Text; <B>dirname</B><A name="getfullname.1.dirname.2(130)"></A><A name="dirname.2(130)"></A>: ^text; <B>ph</B><A name="getfullname.1.ph.2(131)"></A><A name="ph.2(131)"></A>: @PathHandler; 
  enter name[]
  do ph.init;
     name.copy-&gt;fullname[];
     (fullname[],ph.CurrentDirectory)-&gt;ph.convertFilePath-&gt;fullname[];
     fullname.copy-&gt;dirName[];
     (*(if fullname.t[fullname.lgth] &lt;&gt; ph.directoryChar then 
      fullname.lgth -&gt; fullname.pos;
      ph.directoryChar -&gt; fullname.put;
      if);*)
     
  exit dirname[]
  #)
</PRE>
<P></P>
<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<HR>
<P></P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left"><ADDRESS>Notification Interface</ADDRESS></TD>
<TD width="20%" align="center"><FONT size="-1">&#169; <A HREF="http://www.mjolner.com" TARGET="_top">Mj&oslash;lner Informatics</A></FONT>
</TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
</BODY>
</HTML>
