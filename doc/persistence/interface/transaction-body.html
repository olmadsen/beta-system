<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<!-- Autogenerated file - do not edit -->
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE>Transaction Interface</TITLE>
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">

<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/hashfromparent.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript">
<!--
    CheckParent("transaction");
//-->
</SCRIPT>
<BASE TARGET="_parent">
</HEAD>
<BODY onLoad='HashFromParent()'>
<H1><A name="transaction">Transaction Interface</A></H1>

<PRE CLASS=interface>
ORIGIN 'sharedpersistentstore';     
(* File transaction.bet
 * =====================
 * This file is a transaction library for the shared PS.
 * It has to be included by the clients if they want to use transactions.
 *)
--- sharedpersistentstoreLib: attributes ---

<B>transaction</B><A name="transaction.1(61)"></A>:
  (#      
     <B>LockMode</B><A name="transaction.1.LockMode.2(62)"></A><A name="LockMode.2(62)"></A>:&lt; IntegerValue (# do Read -&gt; value; INNER #);
     <B>LockPolicy</B><A name="transaction.1.LockPolicy.2(63)"></A><A name="LockPolicy.2(63)"></A>:&lt; IntegerValue (# do exclusive -&gt; value; INNER #);
     <B>timeoutvalue</B><A name="transaction.1.timeoutvalue.2(64)"></A><A name="timeoutvalue.2(64)"></A>:&lt; IntegerValue (# do -1 -&gt; value; INNER #);
     
     (*operations concerning overall transaction management*)
     
     <B>start</B><A name="transaction.1.start.2(65)"></A><A name="start.2(65)"></A>: (# do 'Transaction start'-&gt;putline;
                this(sharedPersistentStore).getlock
                (# LockMode::(# do this(transaction).LockMode-&gt;value #);
                   LockPolicy::(# do this(transaction).LockPolicy-&gt;value #);
                   timeoutvalue::(# do this(transaction).timeoutvalue-&gt;value #);
                #);
                (if not haslock then abort if);
                (if (LockMode = Read) then
                    'The ps is accessed for reading'-&gt;putline;
                 else
                    'The ps is accessed for writing'-&gt;putline;
                if);
                this(sharedPersistentStore).access;
             #);
     
     <B>checkpoint</B><A name="transaction.1.checkpoint.2(66)"></A><A name="checkpoint.2(66)"></A>:(# do 'Transaction checkpoint...'-&gt;putline;
                   (if WriteLock then
                       this(sharedPersistentStore).checkpoint;
                   if);
                 #);
     
     <B>commit</B><A name="transaction.1.commit.2(67)"></A><A name="commit.2(67)"></A>: (# do 'Transaction commit...'-&gt;putline;
                 (if (not WriteLock) then
                     this(sharedPersistentStore).commit (# doCheckpoint::&lt; (# do false -&gt; value #)#); 
                  else
                     this(sharedPersistentStore).commit;
                 if);
                 this(sharedPersistentStore).releaselock;
              #);
     
     <B>abort</B><A name="transaction.1.abort.2(68)"></A><A name="abort.2(68)"></A>:&lt; (# do 'Transaction abort...'-&gt;putline;
                (if not committed then
                    (if WriteLock then
                        this(sharedPersistentStore).commit 
                        (# doUpdateInMemoryObjects::&lt;(# do true-&gt;value #);
                           docheckpoint ::&lt; (# do false-&gt;value #) #);
                     else (* a reader is assumed not to change persistent objects in memory*)
                        this(sharedPersistentStore).commit 
                        (# doUpdateInMemoryObjects::&lt;(# do false-&gt;value #);
                           docheckpoint ::&lt; (# do false-&gt;value #) #);
                    if);
                if);
                (if haslock then
                    this(sharedPersistentStore).releaselock;
                if);
                
                INNER;
                theShell.kill;
             #);
     
     (*manipulating objects*)
     
     <B>get</B><A name="transaction.1.get.2(69)"></A><A name="get.2(69)"></A>:(# name:^text;
            type:##Object;
            theObject:^Object;
         enter (name[], type##)
         do doget: 
              (# do (name[], type##)-&gt;this(sharedPersistentStore).get-&gt;theObject[];
              #);
         exit theObject[]
         #);
     
     <B>reget</B><A name="transaction.1.reget.2(70)"></A><A name="reget.2(70)"></A>: (# do (if haslock then
                    'Transaction reget...'-&gt;putline;
                   this(sharedPersistentStore).reget;
               if);
            #);
     
     <B>put</B><A name="transaction.1.put.2(71)"></A><A name="put.2(71)"></A>:(# dooverwrite:&lt; BooleanValue 
              (# do false -&gt; value; INNER #);
            obj: ^Object; name: ^text;
         enter (obj[],name[])
         do (if (not WriteLock) then
                'No Write access, the put operation is not possible'-&gt;putline;
             else
                (obj[],name[])-&gt;
                this(sharedPersistentStore).put
                (# dooverwrite::&lt; (# 
                                  do this(put).dooverwrite -&gt; value 
                                  #)
                #);
            if);    
         #);
     
     <B>scanRootNames</B><A name="transaction.1.scanRootNames.2(72)"></A><A name="scanRootNames.2(72)"></A>:        
       (# current: ^Text;
       do (if haslock then
              this(SharedPersistentStore).scanrootnames
              (#
              do current[] -&gt; this(scanRootNames).current[];
                 INNER scanRootNames;
              #);
           else
              'You have to obtain a lock before accessing the ps'-&gt;putline; 
          if);    
       #);
     
  do start;
     INNER;
     commit;
  #)
</PRE>
<P></P>
<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<HR>
<P></P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left"><ADDRESS>Transaction Interface</ADDRESS></TD>
<TD width="20%" align="center"><FONT size="-1">&#169; <A HREF="http://www.mjolner.com" TARGET="_top">Mj&oslash;lner Informatics</A></FONT>
</TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
</BODY>
</HTML>
