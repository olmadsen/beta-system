<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> Multi-User Shared Persistent Store Fragments</TITLE>
<LINK REL=stylesheet HREF="../style/miadoc.css" TYPE=text/css>
</HEAD>
<BODY>

<H1> Multi-User Shared Persistent Store Fragments</H1>

The multi-user persistent store is implemented in the form of a number
of fragments, augmenting the single-user persistent store with
facilities for concurrency control, transactions, and notifications.
<P>

These fragments can be split up into several groups:

<ol>
<li> The <code>persistentstore</code> library. See the section 'The persistent store library' below for more details.
<li> Libraries important to the application programmer when implementing the client programs. These libraries are listed in the section called 'Configuration of the Client'.
<li> Libraries important to the application programmer when implementing/configuring the server program. These libraries are listed in the section called 'Configuration of the Server'. 
<li> Libraries used by the latter two groups of libraries. These libraries are not important to application programmers. They are listed in the section called 'Utilities'.
<li> Example implementations for both client and server programs can be found in the directory called 'examples'. One example is described in detail in appendix~\ref{bygexample}. Before running the examples,
make sure that an ensemble deamon is running on the host(s) involved.
</ol>

<H2> The Persistent Store Library</H2> 

The multi-user persistentstore library is augmented with the
<code>reget</code>- and <code>commit</code>-operations.


<H2> Configuration of the Client</H2>
<ul>
<li> <code>clientinterface.bet</code>:
This file describes the interface to a client using
the shared persistent store (named <code>PSclient</code>). This interface file has to be included by
all client programs. The <code>PSClient</code> pattern is subclassed in the
<code>notification.bet</code> file in order to yield the <code>NPSClient</code>
pattern. This pattern has to be used instead of the <code>PSClient</code> pattern, when the client
wants to subscribe to notifications.

<li> <code>serverinterface.bet</code>:
This file contains the interface to the server, the <code>PersistentStoreManager</code>. This interface file has to be included in
all client and server programs.

<li> <code>sharedpersistentstore.bet</code>: 
This file contains the <code>sharedpersistentstore</code> library. It provides
concurrency control for a persistent store. This library has to be
included by the client program, if a persistent store is being
accessed in a multi-user environment.

<li> <code>transaction.bet</code>:
This file contains the <code>transaction</code> library for the shared
persistent store.  It has to be included by the clients if they want
to use transactions.

<li> <code>notification.bet</code>:
This file is a library containing the declarations used
when using notifications. This file has to be included by
the clients, if they want to subscribe to notifications.
</ul>


<H2> Configuration of the Server</H2>

<ul>
<li> <code>serverinterface.bet</code>:
This file contains the interface to the server, the <code>PersistentStoreManager</code>. This interface file has to be included in
all client and server programs.

<li> <code>notificationmanager.bet</code>:
This file contains the interface to a notification manager serving
notification control. A server wishing to provide notification control
has to include this file in order to run an instance of the
<code>notificationmanager</code>.

<li> <code>lockmanager.bet</code>:
This file contains the interface to a lock manager serving concurrency
control. This file is included by the file <code>serverinterface.bet</code>,
because every server starts a <code>lockmanager</code>.
</ul>

<H2> Utilities</H2>
<ul>

<li> <code>samefile.bet</code>: This file contains the method <code>samefile</code>, which returns true, if
the two entered files are the same and false otherwise. This library
is used instead of <code>file1name[]->file2name.equal</code> because the same
file can have different names depending on the machine, where a
process starts.  F.eks. <code>/a/home/scandium9/jojo/speciale/pstore1</code> and
<code>~jojo/speciale/pstore1</code> are the same files, but would result in false,
if using the <code>equal</code>-operation.

<li> <code>perslib.bet</code>:
This fragment is a library containing the pattern declarations used to
save the lock information on disk. This is done in order to facilitate
recovery from a server crash.

<li> <code>sharedPSnotifications.bet</code>:
This file is included by the <code>sharedpersistentstore</code> library
in order to send notifications to the server.
Notifications are only sent if a <code>notificationmanger</code> is started by the
server. If a <code>notificationmanager</code> is started, notifications are sent
automatically by the shared persistent store and not explicitly by the user.

</ul>

<H2> Example Programs</H2>

<ul>
<li> <code>PSManager.bet</code>:
This file contains an example implemenation of the server, the <code>PersistentStoreManager</code>.  It provides only a lock manager, no extra
functionality. This is the smallest possible server implementation.

<li> <code>NPSManager.bet</code>:
This file contains an example implemenation of the server, the <code>PersistentStoreManager</code>.  
It provides not only a lock manager, but also
a notification manager serving notfication control.

<li> <code>recordlib.bet</code>:
This fragment is a library containing the declarations
of <code>record</code>, <code>person</code> and <code>register</code>. It is used in order to
store registers containing persons in a persistentstore.
The client example implementations use this library.

<li> <code>simpleclient.bet</code>:
This file contains an example implementation of the client. The client opens
a shared persistent store. The client does not make use of transactions or
notifications.  The user can determine the used lock mode and
lock policy.

<li> <code>notclient.bet</code>:
This file contains an example implementation of the client. It opens
a shared persistent store and subscribes to
UPDATE and WAITFORLOCK notifications for it. When being notified, the
client displays the notification on the screen. The access to the
persistent store is done using transactions.  The user can determine
the used lock mode and lock policy.

<li> <code>regetclient.bet</code>:
This file contains an example implementation of the client. The client opens
a shared persistent store. The client subscribes to UPDATE
events. When receiving a notification about an UPDATE, the client
regets the in-memory objects of the updated persistent store. Note:
This is only done, when the client is accessing the persistent store
at the same time, where the persistent store is updated (only possible if the
lock policy is MRSW).
</ul>

</BODY>
</HTML>
