<H2><INX>Combining Shapes</INX></H2>
<P> When constructing complex shapes, it is often
convenient to define the shape as simpler shapes and then combining
the simpler shapes into the complex shape<EM><A REL=FOOTNOTE
HREF="#FOOTNOTE-2">[2]</A></EM>. Shape is a subclass of Segment. This
makes it possible to combine simple shapes into more complex ones in
Bifrost: shapes can be treated as segments. Notice, that it was not
shown in the 
<A HREF="bifrost-ref-10.html#FIG_seghier">segment hierarchy figure</A>
that Shape is a subclass of Segment<EM><A REL=FOOTNOTE
HREF="#FOOTNOTE-3">[3]</A></EM>.</P>

<P> The shape to be combined with another shape will be called the
source shape, and the shape that receives the source shape will be
known as the destination shape. Shapes inside another shape is
referred to as subshapes. Four different semantics are possible for
combining two shapes:</P>

<DL>

<DT><B><INX>AppendShape</INX></B>.
<DD>
The source shape is automatically translated in such a way that
FirstPoint comes to coincide with the LastPoint of the destination
shape

<DT><B><INX>ConnectShape</INX></B>.
<DD>
A transformation matrix is supplied that defines how the source shape
should be transformed into the destination shape. LastPoint of the
destination shape is connected to FirstPoint of the source shape with
a line segment

<DT><B><INX>ConnectShapeSmooth</INX></B>. 
<DD>
Like ConnectShape except that the two shapes are connected with a
spline segment

<DT><B><INX>CombineShape</INX></B>.
<DD>
A supplied transformation matrix transforms
the source shape into the coordinate system of the destination
shape. The two shapes do not become connected

</DL>

<P> All operations make a copy of the source shape, and use this copy in the operation. It is important to notice that it is not all kinds of shapes that can be used as source shapes in all of the above four ways of combining shapes: the first three cannot take as argument a shape that only consist of circular spline segments. The reason is that a circular spline segment does not have a well-defined FirstPoint or a LastPoint. CombineShape cannot take an open shape as argument if it is open itself.</P>
<P> A shape is defined in its own coordinate system, which defaults to
the CCS coordinate system. A shape has only one coordinate system,
implying that all subshapes of a shape are defined in the same
coordinate system as the destination shape itself. This is done by transforming the control points of the source shape into destination shape coordinates when shapes are combined.</P>
<P> The reason for only having one coordinate system for a shape is to limit the computing overhead and complication that would otherwise result by defining shapes with many coordinate systems within the same shape. This restriction does not reduce the power of the shape construction language, since nothing is gained by having more than one coordinate system in the same shape. Shapes in different graphical objects may each have different coordinate systems related to the graphical objects.</P>
<P> For each combination operation, there are four cases to consider, depending on the state of the source shape and of the destination shape:</P>
<OL>
<LI> Open source shape and open destination shape
<LI> Closed source shape and closed destination shape
<LI> Open source shape and closed destination shape
<LI> Closed source shape and open destination shape
</OL>
<P> Each case is illustrated with examples in the description of each combination operation below. The underlying philosophy of the four shape combination operations is to have consistent semantics in an operation. This can result in some combinations of shapes that do not seem useful. The most useful combinations are:</P>
<UL>
<LI> AppendShape with open shapes
<LI> ConnectShape and ConnectShapeSmooth with any kind of shape
<LI> Combine with closed shapes.
</UL>

<A NAME=HEADING16-23></A>
<H3><INX>AppendShape</INX></H3>
<P> The source shape is automatically translated in such a way that FirstPoint comes to coincide with the LastPoint of the destination shape. After the operation the following two statements holds:</P>
<OL>
<LI> FirstPoint of the source shape is equal to LastPoint of the destination shape
<LI> LastPoint of the resulting shape is the translated LastPoint of the source shape
</OL>

<P> In the examples below, FirstPoint of the source shape, LastPoint
of the destination shape, and LastPoint of the resulting shape are
marked with bullets (<IMG ALIGN=MIDDLE SRC="images/bullet.gif" ALT="[bullet]">).</P>

<P> </P>
<CENTER><IMG ALIGN=TOP SRC=images/appendshape-matrix.gif></CENTER>
<P> </P>

<P> Notice, that in the two cases where the source shape is closed, FirstPoint and LastPoint coincide, which means that the LastPoint of the resulting shape remains unchanged (i.e. the same as LastPoint of the destination shape).</P>
<A NAME=HEADING16-32></A>

<H3><INX>ConnectShape</INX></H3>
<P>The supplied transformation matrix transforms the source shape into the coordinate system of the destination shape. LastPoint of the source shape is connected to the FirstPoint of the destination shape with a line segment. After the operation the following statement holds:</P>
<OL>
<LI> LastPoint of the resulting shape is the transformed LastPoint of the source shape
</OL>
<P> In the examples below, FirstPoint of the source shape, LastPoint of the destination shape, and LastPoint of the resulting shape are marked with bullets. In all four cases the same transformation matrix is used. It performs rotation, scaling, and translation of the source shape.</P>
<P> </P>
<CENTER><IMG ALIGN=TOP SRC=images/connectshape_matrix.gif></CENTER>
<P> </P>
<P> </P>
<P> Notice, that in the two cases where the source shape is closed, FirstPoint and LastPoint coincide, which means that LastPoint of the resulting shape remains unchanged (i.e. the same as LastPoint of the destination shape). Notice also, that when both the source and the destination shapes are closed the resulting shape is open (FirstPoint &lt;&gt; LastPoint).</P>
<A NAME=HEADING16-41></A>

<H3><INX>ConnectShapeSmooth</INX></H3>
<P>The supplied transformation matrix transforms the source shape into the coordinate system of the destination shape. LastPoint of the source shape is connected to the FirstPoint of the destination shape with a spline segment. After the operation the following statement becomes true:</P>
<OL>
<LI> LastPoint of the resulting shape is the transformed LastPoint of the source shape
</OL>
<P> In the examples below, FirstPoint of the source shape, LastPoint of the destination shape, and LastPoint of the resulting shape are marked with bullets. In all four cases the same transformation matrix is used. It performs rotation, scaling, and translation of the source shape.</P>
<P> </P>
<P> </P>
<CENTER><IMG ALIGN=TOP SRC=images/connectshapesmooth-matrix.gif></CENTER>
<P> </P>
<P> Notice, that in the cases where the destination shape is closed, two of the control points defining the spline segment, that connects the two shapes, are from the destination shape: LastPoint, and the control point prior to LastPoint. The third and last control point that defines the spline segment is FirstPoint of the source shape. Notice also, that when both the source and the destination shapes are closed the resulting shape is open (FirstPoint &lt;&gt; LastPoint).</P>
<A NAME=HEADING16-50></A>

<H3><INX>CombineShape</INX></H3>
<P> The supplied transformation matrix transforms the source shape into the coordinate system of the destination shape. The two shapes do not become connected. Notice, that it is an error if both source and destination shape are open, since the resulting shape would otherwise not be connected. After the operation, only one of the following statements holds:</P>
<OL>
<LI> LastPoint of the destination shape is LastPoint of the resulting shape
<LI> LastPoint of the source shape is LastPoint of the resulting shape
</OL>
<P> The latter statement only holds if the source shape is open and the destination shape is closed. The reason for this seemingly strange behavior is that the resulting shape can then be combined further in a consistent way. One can also think of this situation in terms of which shape is open after the operation - in this particular situation it is the source shape that is open.</P>
<P> In the examples below, FirstPoint of the source shape, LastPoint of the destination shape, and LastPoint of the resulting shape are marked with bullets.</P>
<P> </P>
<CENTER><IMG ALIGN=TOP SRC=images/combineshape-matrix.gif></CENTER>
<P> </P>
<P> Notice the last situation that is commented on above.</P>


<HR>

<A NAME=FOOTNOTE-2>[2] </A>
 This implements a limited form of graphics modelling. Later the concept of picture is defined as a more powerful way of doing graphics modelling.
<HR>

<A NAME=FOOTNOTE-3>[3] </A>
 The discussion of the Shape inheritance hierarchy is deferred until
the presentation of predefined shapes, see 
<A HREF="bifrost-ref-36.html">Chapter 9</A>.







