<H2>Interaction Model</H2>
<P> Bifrost abstracts input devices used in interaction in a general
<INX>interaction model</INX>. The input device is
typically a pointing device like a mouse. The model is defined in
pattern <INX>InteractionHandler</INX> of the
canvas. InteractionHandler defines a series of virtual attributes and
a general interaction loop. The usage of the interaction handler is to
execute an instance of a specialization of InteractionHandler with
some of the virtual attributes further bound. The attributes are:</P>


<DL>
<DT>
<B>Initialize</B>.
<DD>
Specify what to do before the interaction loop starts. Also changes
the canvas' drawing mode to be <INX>XOR</INX>, to allow
for immediate feedback, see below.

<DT>
<B>Motion</B>.
<DD>
Specify what to do when the user moves the pointer.

<DT>
<B>ButtonPress</B>.
<DD>
Specify what to do when the user presses a button of the
pointer. ButtonInfo is a local attribute in ButtonPress that may
contain device specific information, e.g. which button was pressed.

<DT>
<B>ButtonRelease</B>.
<DD>
Specify what to do when the user releases a button of the pointer.

<DT>
<B>KeyPress</B>.
<DD>
Specify what to do when the user presses a key on the keyboard.

<DT>
<B>KeyRelease</B>.
<DD>
Specify what to do when the user releases a key on the keyboard.

<DT>
<B>TerminateCondition</B>.
<DD>
Specify a condition for ending the interaction handler. Default is
when the rightmost button on the pointer is released.

<DT>
<B>Terminated</B>.
<DD>
Specify what to do when the user has terminated the interaction
loop. Also changes the canvas' drawing mode back to normal
</DL>

<P>In addition to these attributes the handler provides three support
functions:</P> 

<DL>
<DT>
<B>GetPointerLocation</B>.
<DD>
Returns the current position of the pointer.

<DT>
<B>IsModifierOn</B>.
<DD>
Returns True if the modifier entered was ON in last user action
(Motion, ButtonPress, ButtonRelease, KeyPress or KeyRelease).

<DT>
<B>DoubleClick</B>.
<DD>
Returns True if the last button press was a double click.
</DL>


<P> The action part of an instance of the pattern InteractionHandler
performs the following sequence of code:</P>

<BETA>
(#
do Initialize;
   Loop and call Motion, ButtonPress, ButtonRelease, KeyPress or
   KeyRelease, depending on user action, until 
   TerminateCondition returns True;
   Terminated;
#)
</BETA>
<P> As the reader migth have noticed, the interaction handler, when excuted, temporarily replaces the event handler of the canvas and processes all events until terminated.</P>
<P> The InteractionHandler pattern is used to implement the interaction operations of the shapes. The following is an example of how the feedback for InteractiveCreate might be implemented for the predefined shape LineShape, using an InteractionHandler:</P>

<BETA>
RubberLine: InteractionHandler
  (# mousePoint, anchorPoint: @Point; (* Device coords *)
     themodifier: @modifier; (* the modifier used for constrains *)
     stopinteraction: @boolean; (* stop when true *)
     x,y: @integer; (* temporary variables *)

     Initialize:: 
       (# do (anchorpoint, mousePoint) -> immediateLine #);
     Motion::
       (#
       do (anchorpoint, mousePoint) -> immediateLine;
          GetPointerLocation -> mousePoint;
          (if themodifier -> isModifierOn then 
             (* constrain the angles *)
             (mousepoint.x-anchorpoint.x) -> abs -> x;
             (mousepoint.y-anchorpoint.y) -> abs -> y;
             (if y &gt; x then (* constrain to vertical *) 
                 anchorpoint.x -> mousepoint.x
              else (* constrain to horizontal *) 
                 anchorpoint.y -> mousepoint.y
             if)
          if);
          (anchorpoint, mousePoint) -> immediateLine;
       #);
     ButtonPress:: (# do true -> stopinteraction #);
     TerminateCondition:: (# do stopinteraction -> res #);
     Terminated::
       (# do (anchorpoint, mousePoint) -> immediateLine #);
enter (anchorpoint, mousepoint, themodifier)
exit  mousepoint
#);
</BETA>
<P> The interaction obtained by the above handler works as follows: a rubberband line is spanned between the anchorpoint point and the pointer location, following the pointer movements. In case the modifier is on (e.g. Shift is down) then the angle of the line is constrained to multiples of 90 degrees. The interaction terminates when the pointer button is pressed again.</P>





