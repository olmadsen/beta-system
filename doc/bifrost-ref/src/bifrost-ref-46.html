<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> 10.1 Interaction Model</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING46></A>


<P><A HREF=bifrost-ref-47.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=bifrost-ref-45.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=bifrost-ref-45.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P> 10 Interaction</P>


<A NAME=HEADING46-0></A>
<H1> 10.1 Interaction Model</H1>
<P> Bifrost abstracts input devices used in interaction in a general
interaction model<A NAME=MARKER-2-178></A>. The input device is
typically a pointing device like a mouse. The model is defined in
pattern InteractionHandler<A NAME=MARKER-2-179></A> of the
canvas. InteractionHandler defines a series of virtual attributes and
a general interaction loop. The usage of the interaction handler is to
execute an instance of a specialization of InteractionHandler with
some of the virtual attributes further bound. The attributes are:</P>


<DL>
<DT>
<B>Initialize</B>.
<DD>
Specify what to do before the interaction loop starts. Also changes
the canvas' drawing mode to be XOR<A NAME=MARKER-2-180></A>, to allow
for immediate feedback, see below.

<DT>
<B>Motion</B>.
<DD>
Specify what to do when the user moves the pointer.

<DT>
<B>ButtonPress</B>.
<DD>
Specify what to do when the user presses a button of the
pointer. ButtonInfo is a local attribute in ButtonPress that may
contain device specific information, e.g. which button was pressed.

<DT>
<B>ButtonRelease</B>.
<DD>
Specify what to do when the user releases a button of the pointer.

<DT>
<B>KeyPress</B>.
<DD>
Specify what to do when the user presses a key on the keyboard.

<DT>
<B>KeyRelease</B>.
<DD>
Specify what to do when the user releases a key on the keyboard.

<DT>
<B>TerminateCondition</B>.
<DD>
Specify a condition for ending the interaction handler. Default is
when the rightmost button on the pointer is released.

<DT>
<B>Terminated</B>.
<DD>
Specify what to do when the user has terminated the interaction
loop. Also changes the canvas' drawing mode back to normal
</DL>

<P>In addition to these attributes the handler provides three support
functions:</P> 

<DL>
<DT>
<B>GetPointerLocation</B>.
<DD>
Returns the current position of the pointer.

<DT>
<B>IsModifierOn</B>.
<DD>
Returns True if the modifier entered was ON in last user action
(Motion, ButtonPress, ButtonRelease, KeyPress or KeyRelease).

<DT>
<B>DoubleClick</B>.
<DD>
Returns True if the last button press was a double click.
</DL>


<P> The action part of an instance of the pattern InteractionHandler
performs the following sequence of code:</P>

<PRE CLASS=beta>
(#
do Initialize;
   Loop and call Motion, ButtonPress, ButtonRelease, KeyPress or
   KeyRelease, depending on user action, until 
   TerminateCondition returns True;
   Terminated;
#)
</PRE>
<P> As the reader migth have noticed, the interaction handler, when excuted, temporarily replaces the event handler of the canvas and processes all events until terminated.</P>
<P> The InteractionHandler pattern is used to implement the interaction operations of the shapes. The following is an example of how the feedback for InteractiveCreate might be implemented for the predefined shape LineShape, using an InteractionHandler:</P>

<PRE CLASS=beta>
RubberLine: InteractionHandler
  (# mousePoint, anchorPoint: @Point; (* Device coords *)
     themodifier: @modifier; (* the modifier used for constrains *)
     stopinteraction: @boolean; (* stop when true *)
     x,y: @integer; (* temporary variables *)

     Initialize:: 
       (# do (anchorpoint, mousePoint) -&gt; immediateLine #);
     Motion::
       (#
       do (anchorpoint, mousePoint) -&gt; immediateLine;
          GetPointerLocation -&gt; mousePoint;
          (if themodifier -&gt; isModifierOn then 
             (* constrain the angles *)
             (mousepoint.x-anchorpoint.x) -&gt; abs -&gt; x;
             (mousepoint.y-anchorpoint.y) -&gt; abs -&gt; y;
             (if y &gt; x then (* constrain to vertical *) 
                 anchorpoint.x -&gt; mousepoint.x
              else (* constrain to horizontal *) 
                 anchorpoint.y -&gt; mousepoint.y
             if)
          if);
          (anchorpoint, mousePoint) -&gt; immediateLine;
       #);
     ButtonPress:: (# do true -&gt; stopinteraction #);
     TerminateCondition:: (# do stopinteraction -&gt; res #);
     Terminated::
       (# do (anchorpoint, mousePoint) -&gt; immediateLine #);
enter (anchorpoint, mousepoint, themodifier)
exit  mousepoint
#);
</PRE>
<P> The interaction obtained by the above handler works as follows: a rubberband line is spanned between the anchorpoint point and the pointer location, following the pointer movements. In case the modifier is on (e.g. Shift is down) then the angle of the line is constrained to multiples of 90 degrees. The interaction terminates when the pointer button is pressed again.</P>




<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>Bifrost - Reference Manual</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
<P>
<P><A HREF=bifrost-ref-47.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=bifrost-ref-45.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=bifrost-ref-45.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
