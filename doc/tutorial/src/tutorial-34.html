<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> 17 Graphical User Interface</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING34></A>


<P><A HREF=tutorial-36.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=tutorial-33.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html#_toc><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P>Libraries Tutorial</P>


<A NAME=HEADING34-0></A>
<H1> 17 Graphical User Interface<A NAME=MARKER-2-102></A></H1>
<P> In this section we will show how to use two different graphical user interface libraries. The first example uses the device independent library called GUIEnv and the second example uses the X11 specific MotifEnv library.</P>




<A NAME=HEADING35-0></A>
<H2> 17.1 GUIEnv<A NAME=MARKER-2-103></A></H2>
<P> GUIEnv is a device independent graphical user interface library,
intended for making applications with graphical user interfaces
running on:</P>

<UL>
<LI>Macintosh<A NAME=MARKER-2-104></A>
<LI>X Window System<A NAME=MARKER-2-105></A> (Motif Widgets)
<LI>Windows<A NAME=MARKER-2-106></A> (Win32)
</UL>

<P> GUIenv realizes user interfaces of many different look-and-feels. GUIenv allows construction of portable user interfaces in such a way that the look-and-feel of the applications, will conform to the standardized look-and-feel of the specific platform. </P>
<P> The basic GUI library is defined in the file '~beta/guienv/guienv'. An application with a graphical user interface, thus must have origin in this file. The guienv library defines a pattern also called guienv in which all the user interface attributes, operations, and patterns are available. So every GUIEnv application typically has the following outline:</P>

<PRE CLASS=beta>
ORIGIN  '~beta/guienv/guienv';
-- program: descriptor --
guienv
  (# (* write GUI code here *)
  #)
</PRE>
<P> </P>

<P> Our task will be to develop a simple texteditor that can open a text file, edit the file and save the file. We would like an application that looks like the following (Motif version):</P>
<P> <IMG ALIGN=TOP SRC=texteditor-motif.gif></P>

<P> We will need a window to display the text in. guienv defines a window pattern, that we can use. We would like that this window is opened when the application starts up, so in the do part of the specialization of guienv we open the window.</P>
<PRE CLASS=beta>
guienv
(# theWindow: @window
     (# ...
      #);
do theWindow.open;
#);
</PRE>

<P> Inside the window we want a texteditor that can contain the text from the file. guienv supplies a textEditor for this purpose: </P>
<PRE CLASS=beta>
theWindow: @window
  (# thetextEditor: @textEditor
       (# open:: 
            (# 
            do theWindow.size -&gt; Size; 
               True -&gt; bindBottom; True -&gt; bindRight 
            #)
       #);
     open::(# do thetextEditor.open #);
  #);
do theWindow.open;
</PRE>
<P> The lines:</P>
<PRE CLASS=beta>
open:: 
  (#
  do theWindow.size -&gt; Size; 
     True -&gt; bindBottom; True -&gt; bindRight 
  #);
</PRE>
<P> means that we extend the open virtual of textEditor, set the size of the textEditor to be same size as the window, and bind the textEditor to the bottom and right corners of the window.</P>

<P> The next thing we need to do, to complete the user interface is to make a menu. The application should have a menu with three items: open a file, save the file, and quit the application. guienv supplies a standard menubar on each window for this purpose. We extend the standard menubar with one menu called File, and we make three items in this menu called Open, Save, and Quit.</P>
<PRE CLASS=beta>
menubarType::
  (# fileMenu: @menu
       (# openItem: @menuitem
            (# ... #);
          saveItem: @menuitem
            (# ... #);
          quitItem: @menuitem
            (# ... #);
          open::
            (# 
            do 'File' -&gt; name;
               openItem.open; openItem[] -&gt; append;
               saveItem.open; saveItem[] -&gt; append;
               quitItem.open; quitItem[] -&gt; append;
       #)#);
     open::(# do fileMenu.open; fileMenu[] -&gt; append #);
  #);
</PRE>
<P> Like the textEditor, we extend the open virtual of the File menu to open and append the three items and to give the menu a title.</P>

<P> Each menuitem has two virtuals that needs to be extended: eventHandler and open. For the quit item we do the following:</P>
<PRE CLASS=beta>
quitItem: @menuitem
  (# eventHandler:: 
       (# onSelect::(# do Terminate #)
       #);
     open::(# do 'Quit' -&gt; name #);
  #);
</PRE>
<P> The eventHandler has a virtual called onSelect that is invoked whenever this menuitem is selected. We call Terminate (defined in guienv) to stop execution. The open virtual is extended to give the item a name.</P>

<P> Finally, we need to do some file handling in the open and save items. The open item does the following when selected</P>
<PRE CLASS=beta>
onSelect::
  (# theText: @StyledText;
  do theWindow[] -&gt; fileSelectionDialog -&gt; textFile.name;
     textFile.openRead;
     textFile.scan
       (# while:: (# do true-&gt;value #);
       do ch -&gt; theText.put
       #);
     theText[]-&gt;theTextEditor.contents.contents;
     textFile.close;
  #)
</PRE>

<P> First we call fileSelectionDialog that opens a standard file open dialog and returns a name of a file that we can open (we ignore errors, pressing cancel, etc.). We open the file, read all the file content into a StyledText and sets the StyledText as the content of the textEditor. StyledText is a specialization of Text with specification of face, font, size, etc.</P>

<P> The save item does the following when selected:</P>
<PRE CLASS=beta>
onSelect::
  (# theText: @Text;
  do textFile.openWrite;
     theTextEditor.contents.contents-&gt;textFile.puttext;
     textFile.close;
  #)
</PRE>
<P> Because StyledText is a specialization of Text we can write the StyledText contents of the TextEditor directly to the file using the puttext operation.</P>
<P> We open the same file, write the textEditor content into the file and close the file.</P>
<P> The complete code needed for this application is shown below.</P>

<A NAME=HEADING35-43></A>
<H4 CLASS=betacaption><A NAME="fig:Program 17.1: TextEditor.bet"> Program 17.1: TextEditor.bet</A></H4>
<PRE CLASS=beta>
ORIGIN  '~beta/guienv/guienv';
INCLUDE '~beta/guienv/fields'
        '~beta/guienv/stddialogs'
        '~beta/basiclib/file';
-- program: descriptor --
guienv (* inherit from guienv *)
(# theWindow: @window (* make a window *)
     (# menubarType:: (* extend the menubar *)
          (# fileMenu: @menu (* make a file menu *)
               (# textFile: @file; (* the file we open and save *)
                  openItem: @menuitem (* make an open item *)
                    (# eventHandler:: 
                         (* extend the virtual that is called when 
                          * this menu item is selected *)
                         (# onSelect::
                              (# theText: @StyledText;
                              do theWindow[] -&gt; fileSelectionDialog 
                                   -&gt; textFile.name;
                                 textFile.openRead;
                                 textFile.scan
                                   (# while:: (# do true-&gt;value #);
                                   do ch -&gt; theText.put
                                   #);
                                 theText[]-&gt;
                                   theTextEditor.contents.contents;
                                 textFile.close;
                         #)#);
                       open:: (# do 'Open' -&gt; name #);
                    #);
                  saveItem: @menuitem (* make a save item *)
                    (# eventHandler::
                         (# onSelect:: 
                              (# theText: @Text;
                              do textFile.openWrite;
                                 theTextEditor.contents.contents-&gt;
                                    textFile.puttext;
                                 textFile.close;
                         #)#);
                       open:: (# do 'Save' -&gt; name #);
                    #);
                  quitItem: @menuitem (* make a quit item *)
                    (# eventHandler::
                         (# onSelect:: (# do Terminate #) #);
                       open:: (# do 'Quit' -&gt; name #);
                    #);
                  open:: (* extend the open virtual of filemenu 
                          * to open the items *)
                    (# 
                    do 'File' -&gt; name;
                       openItem.open; openItem[] -&gt; append;
                       saveItem.open; saveItem[] -&gt; append;
                       quitItem.open; quitItem[] -&gt; append;
               #)#);
             open:: (* extend the open virtual of the menubar
                     * to open the filemenu *) 
               (# do fileMenu.open; fileMenu[] -&gt; append #);
          #);
        thetextEditor: @textEditor (* our text editor *)
          (# open:: (* extend the open virtual 
                     * to set the size and the placement *)
             (# do theWindow.size -&gt; Size; 
                   True -&gt; bindBottom; True -&gt; bindRight 
        #)#);
        open:: (* extend the window open virtual
                * to open the textEditor *)
          (# do thetextEditor.open #);
     #);
do theWindow.open; (* open the window when the appl. start up *)
#)
</PRE>
<P> The two screen snapshots following below show how this application
appears on Windows NT and Macintosh after the program has loaded its
own source code for editing, and with the menu opened. The Motif
version was shown above.</P>
<center><P> <B>Windows NT</B></P>
<P> <IMG ALIGN=TOP SRC=texteditor-nt.gif></P>
<P> <B>X Window System - Motif</B></P>
<P> <IMG ALIGN=TOP SRC=texteditor-motif.gif></P>
<P> <B>Macintosh</B></P>
<P> <IMG ALIGN=TOP SRC=texteditor-mac.gif></P>
</center>

<P> More details and examples about the GUIEnv libraries can be found in <A HREF="../bibliography/index.html#mia94-27">[MIA 94-27]</A>.</P>









<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>Libraries Tutorial</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
<P>
<P><A HREF=tutorial-36.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=tutorial-33.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html#_toc><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
