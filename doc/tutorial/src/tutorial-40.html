<H1> 19 The Fragment System<A NAME=MARKER-2-129></A></H1>
<P> Every BETA program uses the Fragment System. A fragment can be viewed as a piece of a BETA program ist of one or more fragments.</P>
<P> The basic BETA environment, called betaenv, supplies basic BETA patterns, such as integer, char, boolean, and text. In order to use these basic patterns, the program must specify that the betaenv environment is to be used. The following example illustrates how:</P>
<A NAME=HEADING40-4></A>
<H4 CLASS=betacaption><A NAME="fig:Program 19.1: HelloWorld.bet"> Program 19.1: HelloWorld.bet</A></H4>
<PRE CLASS=beta>
ORIGIN '~beta/basiclib/betaenv'
---program: descriptor---
(#
do 'Hello World!'-&gt;putline;
#)
</PRE>
<P> The example consists of two parts, the specification of ORIGIN and the descriptor<EM><A REL=FOOTNOTE HREF="#FOOTNOTE-4">[4]</A></EM> called program.</P>

<P> The specification of ORIGIN tells that the program uses the fragment file ~beta/basiclib/betaenv. The descriptor program tells that following the line</P>

<PRE CLASS=beta>
---program: descriptor---
</PRE>
<P> comes a BETA descriptor, i.e. (# ... #), that will be named program. The name is used to identify the descriptor for the purpose of binding it to an unbound hole in the betaenv environment. A simple betaenv environment could have the following outline:</P>

<PRE CLASS=beta>
(* The basic BETA environment betaenv *)
(# ...
   put: (# c: @char; enter c do ... #);
   puttext: (# t: ^text; enter t[] do ... #);
   putline: (# t: ^text; enter t[] do t[]-&gt;puttext; newline #);
   newline: (# do ... #);
   text: (# ... #);
   ...
   &lt;&lt;SLOT LIB: Attributes&gt;&gt;
   ...
do (* initialize for execution *)
   &lt;&lt;SLOT program: descriptor&gt;&gt;
   (* terminate execution *)
#)
</PRE>

<P> The betaenv environment consists of a single descriptor with two holes&Ntilde;slots. One named program of type descriptor and one named LIB of type Attributes. </P>
<P> The program slot is empty and can be filled (or bound) by a BETA program by defining an descriptor like:</P>
<PRE CLASS=beta>
---program: descriptor---
(# ... #)
</PRE>
<P> as illustrated above. Every BETA program must have exactly one such construct in order to fill the empty slot in betaenv. </P>

<P> Filling a slot can be compared to a textual replacement<EM><A REL=FOOTNOTE HREF="#FOOTNOTE-5">[5]</A></EM>. The Hello World example program above, thus replaces the program slot in betaenv, resulting in the following expanded BETA program:</P>
<A NAME=HEADING40-21></A>
<H4 CLASS=betacaption><A NAME="fig:Program 19.2: HelloWorld with filled program slot"> Program 19.2: HelloWorld with filled program slot</A></H4>
<PRE CLASS=beta>
(* The basic BETA environment betaenv *)
(# ...
   put: (# c: @char; enter c do ... #);
   puttext: (# t: ^text; enter t[] do ... #);
   putline: (# t: ^text; enter t[] do t[]-&gt;puttext; newline #);
   newline: (# do ... #);
   text: (# ... #);
   ...
do (* initialize for execution *)
   (#
   do 'Hello World!'-&gt;putline;
   #)
   (* terminate execution *)
#)
</PRE>
<P> The LIB slot can be used to define libraries that may used in other BETA programs. If we want to add an operation called putBoxed to the basic environment, we can fill the LIB slot:</P>

<A NAME=HEADING40-25></A>
<H4 CLASS=betacaption><A NAME="fig:Program 19.3: putBoxed.bet"> Program 19.3: putBoxed.bet</A></H4>
<PRE CLASS=beta>
ORIGIN '~beta/basiclib/betaenv'
---LIB: Attributes---
  putBoxed: 
     (* print the text with a box surrounding: 
      * 'text'-&gt;putBoxed results in '[text]'
      *)
    (# t: ^Text;
    enter t[]
    do '['-&gt;put; t[]-&gt; puttext; ']'-&gt;put;
    #);
</PRE>
<P> The HelloWorld program can then use this library by including it:</P>

<A NAME=HEADING40-29></A>
<H4 CLASS=betacaption><A NAME="fig:Program 19.4: HelloWorld.bet"> Program 19.4: HelloWorld.bet</A></H4>
<PRE CLASS=beta>
ORIGIN '~beta/basiclib/betaenv';
INCLUDE<A NAME=MARKER-2-137></A> 'putBoxed'
---program: descriptor---
(#
do 'Hello World!'-&gt;putBoxed;
#)
</PRE>
<P> Resulting in the following output:</P>
<PRE CLASS=beta>
[Hello World!]
</PRE>
<P> The HelloWorld example program using the putBoxed library, results in the following expanded BETA program:</P>
<A NAME=HEADING40-34></A>
<H4 CLASS=betacaption><A NAME="fig:Program 19.5: HelloWorld with filled program and LIB slot"> Program 19.5: HelloWorld with filled program and LIB slot</A></H4>
<PRE CLASS=beta>
(* The basic BETA environment betaenv *)
(# ...
   put: (# c: @char; enter c do ... #);
   puttext: (# t: ^text; enter t[] do ... #);
   putline: (# t: ^text; enter t[] do t[]-&gt;puttext; newline #);
   newline: (# do ... #);
   text: (# ... #);
   putBoxed: 
     (* print the text with a box surrounding: 
      * 'text'-&gt;putBoxed results in '[text]'
      *)
    (# t: ^Text;
    enter t[]
    do '['-&gt;put; t[]-&gt; puttext; ']'-&gt;put;
    #);
   ...
do (* initialize for execution *)
   (#
   do 'Hello World!'-&gt;putline;
   #)
   (* terminate execution *)
#)
</PRE>
<P> The program can be made even more simpler by having ORIGIN in the putBoxed.bet file:</P>
<PRE CLASS=beta>
ORIGIN 'putBoxed'
---program: descriptor---
(#
do 'Hello World!'-&gt;putBoxed;
#)
</PRE>
<P> This works because the putBoxed.bet has ORIGIN in the betaenv environment, so the HelloWorld program will also have access to the betaenv environment.</P>
<P> The ---LIB: Attributes--- may be multiply specified in the same file or in different files. The way to make libraries in BETA is thus to define the pattern declarations in a fragment called LIB. The file containing the ---LIB: Attributes--- fragment can then be included in your program and the declarations can be used.</P>






<HR>

<A NAME=FOOTNOTE-4>[4] </A>
 descriptor is an alias for ObjectDescriptor, i.e. <BR>--program:ObjectDescriptor-- is also legal.
<HR>

<A NAME=FOOTNOTE-5>[5] </A>
 Textual replacement is not exactly correct due to the scope rules. Please see the BETA book chapter 17 for a description of these rules.














