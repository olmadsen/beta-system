<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> 18 Concurrent Library</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING37></A>


<P><A HREF=tutorial-39.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=tutorial-36.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html#_toc><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P>Libraries Tutorial</P>


<A NAME=HEADING37-0></A>
<H1> 18 Concurrent Library</H1>
<P> Concurrent<A NAME=MARKER-2-116></A> programming in BETA is supported by the systemenv<A NAME=MARKER-2-117></A> library. This library contains patterns for describing the BETA concepts of concurrent systems. The basic ideas are:</P>

<UL>
<LI>1. Components (coroutine<A NAME=MARKER-2-119></A>s) can be executed concurrently.
<LI>2. A primitive semaphore<A NAME=MARKER-2-120></A> pattern is available for synchronization. The operations on a semaphore is executed as an indivisible unit.
<LI>3. An abstract pattern Monitor<A NAME=MARKER-2-121></A> similar to the monitor proposed by Hoare and Brinch-Hansen.
</UL>

<UL>
<LI>4. An abstract pattern System is defined. System defines communication between systems by means of synchronized rendezvous. A concurrency imperative conc and an alternation imperative alt are defined for system. 
</UL>




<A NAME=HEADING38-0></A>
<H2> 18.1 Example</H2>
<P> The following example of using the systemenv library makes three concurrent coroutines that each sleeps for a specified number of seconds and then prints out the seconds elapsed since startup. All three systems inherit from a generic system:</P>

<PRE CLASS=beta>
everyNthSecond: System
  (* inherit from System: can run concurrently *)
  (# N:&lt; IntegerValue;
     now: @Integer;
  do cycle 
       (# 
       do INNER everyNthSecond;
          N -&gt; sleep; (* sleep for N seconds *)
          now+N -&gt; now; (* accumulate time *)
       #)
  #)
</PRE>
<P> everyNthSecond inherits from system, i.e. it is able to run concurrently. The do-part consists of a loop that calls INNER, then sleeps for N seconds, and when activated again, updates the time, and calls INNER again. Notice, that N is defined as an IntegerValue. </P>
<P> Now we can make a coroutine that inherits from everyNthSecond like this:</P>
<PRE CLASS=beta>
fourth: @| everyNthSecond
       (* a co-routine that inherits from everyNthSecond *)
  (# N:: (# do 4 -&gt; value #); (* sleep for 4 seconds *)
  do 'fourth: ' -&gt; puttext; now -&gt; screen.putint; newline
  #)
</PRE>

<P> A coroutine<A NAME=MARKER-2-124></A> is declared using the '|' symbol. The declaration '@|' means that we declare fourth to be a static reference to a coroutine. The do-part will be called every 4'th second since fourth inherits from everyNthSecond and extends the IntegerValue N to be 4.</P>
<P> Finally, we need to start the coroutines concurrently. This is done by starting the coroutine inside a conc pattern like this:</P>
<PRE CLASS=beta>
conc (* execute concurrently: *)
  (# do ... fourth[]-&gt;start; ... #)
</PRE>
<P> The execution of conc will not terminate until all the systems executed inside it has terminated.</P>
<P> The complete program with three concurrent systems is shown in Program 18.1. Notice, that the program never terminates.</P>
<A NAME=HEADING38-14></A>
<H4 CLASS=betacaption><A NAME="fig:Program 18.1: Seconds.bet"> Program 18.1: Seconds.bet</A></H4>
<PRE CLASS=beta>
ORIGIN '~beta/basiclib/systemenv'
--- program: descriptor ---
systemenv (* inherits from systemenv *)
(# 
   (* everyNthSecond calls INNER every N'th second. *)
   everyNthSecond: System
     (* inherit from System: can run concurrently *)
     (# N:&lt; IntegerValue;
        now: @Integer;
     do cycle 
          (# 
          do INNER everyNthSecond;
             N -&gt; sleep; (* sleep for N seconds *)
             now+N -&gt; now; (* accumulate time *)
          #);
     #);
   every: @| everyNthSecond 
         (* a co-routine that inherits from everyNthSecond *)
     (# N::&lt; (# do 1 -&gt; value #);  (* sleep for 1 second *)
     do 'every: ' -&gt; puttext; now -&gt; screen.putint; newline;
     #);
   fourth: @| everyNthSecond
          (* a co-routine that inherits from everyNthSecond *)
     (# N::&lt; (# do 4 -&gt; value #); (* sleep for 4 seconds *)
     do 'fourth: ' -&gt; puttext; now -&gt; screen.putint; newline;
     #);
   eighth: @| everyNthSecond 
          (* a co-routine that inherits from everyNthSecond *)
     (# N::&lt; (# do 8 -&gt; value #); (* sleep for 8 seconds *)
     do 'eighth: ' -&gt; puttext; now -&gt; screen.putint; newline;
     #);
do 
   conc (* execute concurrently: *)
     (# do every[]-&gt;start; fourth[]-&gt;start; eighth[]-&gt;start #);
   (* terminates when all systems stops. In this case: never *)
#)
</PRE>
<P> Output of running Program 18.1 for 20 seconds:</P>
<PRE CLASS=beta>
nil% Seconds
every: 0
fourth: 0
eighth: 0
every: 1
every: 2
every: 3
fourth: 4
every: 4
every: 5
every: 6
every: 7
eighth: 8
fourth: 8
every: 8
every: 9
every: 10
every: 11
fourth: 12
every: 12
every: 13
every: 14
every: 15
eighth: 16
fourth: 16
every: 16
every: 17
every: 18
every: 19
fourth: 20
</PRE>













<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>Libraries Tutorial</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
<P>
<P><A HREF=tutorial-39.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=tutorial-36.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html#_toc><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
