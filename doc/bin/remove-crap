#!/usr/local/bin/perl

@files = split "\n", `ls -1 *.html`;

foreach $file (@files){
    $all = &read_file($file);
    print STDERR "Processing $file (backup in $file~)\n";
    system "mv $file $file~";
    if ($all =~ m%<H[1-6]%is){
	$before = $`;
	$match  = $&;
	$after  = $';
	if ($before =~ m%^<!DOCTYPE%i){
	    print STDERR "***Deleting from start of file to first heading\n";
	    $all = $match . $after;
	}
    }
    if ($all =~ m%^(.*)<HR>%is){
	$good   = $1;
	$match  = $&;
	$after  = $';
	if ($after =~ m/^\s*<P>\s*<TABLE border=0 width="100%">/is){
	    print STDERR "***Deleting from last <HR> (just before table) to end of file\n";
	    $all = $good ."\n";
	}
    }

    &write_file($file,$all);
}

sub write_file
{
    local ($filename, $line) = @_;
    if (!open(FILE, ">$filename")){
	print "***Cannot open $filename for writing: $!\n";
	return ""
    }
    print FILE $line;
    close (FILE);
}

sub read_file
{
    local ($filename) = @_;
    local ($line);
    if (!open(FILE, "$filename")){
	print "***Cannot open $filename for reading: $!\n";
	return ""
    }

    $line="";
    while (<FILE>) {
	$line .= $_;
    };
    close (FILE);
    return $line;
}
