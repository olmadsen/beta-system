#!/usr/local/bin/perl -s

sub usage
{
    print "usage: makedoc [-v] <manual>.book\n";
    print"   -v   verbose output\n";
    print"   -d   debug makedoc script\n";
    exit(1);
}

sub read_book_file
{
    if ($#ARGV == 0){ 
	$book_file_name = $ARGV[0];
    } else {
	&usage();
    };
    
    open SEQUENCE, $book_file_name || die "Cannot open \"$book_file_name\" file: !$\n";
    #push @sequence, "title.html";
    while (<SEQUENCE>){
	chomp;
	# remove comments
	s/\#.*$//;
	# skip blank lines
	next if (m/^\s*$/);
	if (-f $_){
	    push @sequence, $_;
	} else {
	    if (m/^date:\s*(.*)$/){ $date = $1 };
	    if (m/^mia:\s*(.*)$/){ $mia = $1 };
	    if (m/^title:\s*(.*)$/){ $title = $1 };
	    if (m/^copyright:\s*(.*)$/){ $copyright = $1 };
	    if (m/^pdf:\s*(.*)$/){ $pdf= $1 };
	    if (m/^int:\s*(.*)$/){ push @interfaces, $1 };
	}
    }
    if ($debug){
	print "read book file $book_file_name.\n";
	print "  date:      $date\n";
	print "  mia:       $mia\n";
	print "  title:     $title\n";
	print "  copyright: $copyright\n";
	print "  pdf:       $pdf\n";
	print "  sequence:\n";
	print join("\n    ",@sequence);
	print "  interfaces:\n";
	print join("\n    ",@interfaces);
    }
}

### main #######

# Command line options
$verbose = 1 if (defined($v));
$debug = 1 if (defined($d));

&read_book_file;
