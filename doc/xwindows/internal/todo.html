<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>

<HEAD>
<TITLE>TODO</TITLE>
<LINK REV="made" HREF="mailto:pa@mjolner.com">
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">
</HEAD>

<BODY>
<H1>X TODO</H1>

<PRE>
--- Kopier Motif 1.2 includes til ~beta/X11.
    Ret env.(c)sh så disse bruges altid på sparc.

--- Test Motif version i motifint.c, så problemer med forkerte motif
    versioner ikke opstår.

--- 
0) Use final bindins as often as possible.

1)  XrmOptionsRec.add must check for overflow in the R repetition.

2)  Add comments to eventProcessors: Describe what events they are
    used for. The ones that are used for many event types: Describe 
    the different types (O'Reilly p. 216 ff).

Fra xtenv.bet:

               ResizeRedirect: eventProcessor
                 (# mask::<(# do XResizeRedirectmask->eventMask #);
                    eventDesc::< XResizeRequestEvent;
                 do INNER
                 #);
               SubstructureNotify: eventProcessor
                 (# mask::< (# do XSubstructureNotifymask->eventMask #);
                 do INNER
                 #);

Bem{rk at eventDesc er videre bundet i ResizeRedirect. Det er fordi masken
XResizeRedirectmask svarer til netop een event type: XResizeRequestEvent.

Den du skal bruge er den event, der hedder XConfigureEvent (events.bet).
Denne bruger masken XSubstructureNotifyMask. Det er der imidlertid mange andre
event typer, der g|r, bla. CreateNotify osv. Derfor er den ikke bundet i
eventProcessoreren SubstructureNotify.

G|r s}dan:

    resize: @SubstructureNotify
      (# eventDesc::< XConfigureNotifyEvent;
      do (if event.type//XConfigureNotify then
             go for it...
         else
             glem det: en af de andre events fanget af denne maske
         if)
      #)

    resize.enable;

5)  Remove callback entries like in DestroyEvent the following places
     actions.destroy
     eventhandler.disable
     workproc.stop
     timer.stop

6)  Error in resourcelist and options: Use externally declared strings.

7)  To allow passing resource args to XtCreateWidget, possibly change
    XtObject.init to 
       init:< (# resources:< (# "recources set at creation" #); ... #);

8)  There is an error in Motif command. The following program gives segmentation
    fault. It happens in XtGetValues, which seems to be called with correct
    arguments. 

ORIGIN '~beta/Xt/v1.8/motifenv'
-- INCLUDE '~beta/Xt/v1.8/motif/panedwindow'
-- INCLUDE '~beta/Xt/v1.8/motif/rowcolumn'
-- INCLUDE '~beta/Xt/v1.8/motif/command'
-- INCLUDE '~beta/Xt/v1.8/motif/pushbutton'
-- PROGRAM: descriptor --
MotifEnv
(# rowcol: @RowColumn
     (# getcom: @PushButton
          (# activateCallback::<
               (# printf: external
                    (# fmt: [1]@char;
                       val: @integer;
                    enter (fmt, val)
                    #);
               do ('widget: %d\n', com) -> printf;
                  'Current Item:'->putline;
                  com.command -> putline; (* works *)
                  com.textString -> putline; (* Segmentation fejl *)
               #);
          #);
        com: @Command(# #);
        init::<
          (# 
          do getcom.init;
             com.init;
          #);
     #);              
do rowcol.init;
#)

The following C-program works:

#include <stdio.h>
#include <X11/Intrinsic.h>
#include <X11/StringDefs.h>	/* Get standard string definations. */

#include <Xm/RowColumn.h>	
#include <Xm/Command.h>	
#include <Xm/PushB.h>	

Widget toplevel, rowcol, getcom, com;

XtCallbackProc GetCommand(w, call_data, client_data)
     Widget w;
     XtPointer call_data, client_data;
{
  Arg args[1];
  XmString str;
  char *p;

  printf("Reading command:\n"); 
  XtSetArg(args[0], XmNcommand, &str);
  XtGetValues(com, args, 1);
  XmStringGetLtoR(str, XmSTRING_DEFAULT_CHARSET, &p);
  printf("%s\n", p);

  printf("Reading textString:\n"); 
  XtSetArg(args[0], XmNtextString, &str);
  XtGetValues(com, args, 1);
  XmStringGetLtoR(str, XmSTRING_DEFAULT_CHARSET, &p);
  printf("%s\n", p);
  
}

main(argc, argv)
     int argc;
     char **argv;
{
  XtAppContext app_con;
  Arg args[1];
  
  toplevel = XtVaAppInitialize(&app_con, "Xcommand", NULL, 
			       0, &argc, argv, NULL, NULL);
  
  rowcol 
    = XtVaCreateManagedWidget("rowcol", xmRowColumnWidgetClass, toplevel, NULL);
  getcom 
    = XtVaCreateManagedWidget("getcom", xmPushButtonWidgetClass, rowcol, NULL);
  com    
    = XtVaCreateManagedWidget("com", xmCommandWidgetClass, rowcol, NULL);

  XtAddCallback(getcom, XmNactivateCallback, (XtCallbackProc)GetCommand, 0);

  XtRealizeWidget(toplevel);
  XtAppMainLoop(app_con);
}     


9) SNAKE: There is a problem with asciitext widgets on snake.
The following gives segmentation fault when key is pressed.

origin '~beta/Xt/v1.8/awenv'
--program: descriptor--
xtenv
(# t: @asciitext(# init::< (# do edit->editType#)#);
do t.init;
#)

</PRE>

<HR>
<P>
<TABLE cols=3 border=0 width=100%>
<TR>
<TD width="40%" align="left">
<ADDRESS>TODO</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT size=-1>&COPY; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>

</BODY>
</HTML>

