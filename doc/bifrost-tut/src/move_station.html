<H1> Moving Stations</H1> 

<P> Having created the Stations, the next task is to
make it possible to move them around. The moving of a Station is
simple to do, since a Station is a Picture which in turn is a
specialization of <INX>AbstractGraphicalObject</INX>. A
reference to an AbstractGraphicalObject can be entered to the
<INX>InteractiveMove</INX> attribute of myCanvas, that
does exactly what is needed in this case. Thus the only thing to do is
to change onMouseDown of myCanvas to handle the situation right. If
the mouse is pressed outside any existing Stations, a new one must be
created as above. If the mouse is pressed inside an existing Station,
then an interaction for moving this station should be started. One way
to find out if anything was hit is by scanning through all graphical
objects in the Picture of myCanvas, and for each graphical object
check whether the mouse position is contained within this graphical
object. An exception has to be made for the city map, which must never
be moved around. In <INX>subway4.bet</INX>, onMouseDown
becomes </P>

<INX HIDDEN>onMouseDown</INX>
<BETA>
onMouseDown:: 
  (# 
  do (* Transform mousepos to BifrostCanvas coordinates *)
     mousepos->devicetocanvas->mousepos;
      
     scan: 
       (# (* Find out what was hit - if any *)
       do thePicture.ScanGOsReverse
          (# 
          do (if (myCanvas[], mousepos)->go.containspoint then
                 (if go[]
                  // map[] then (* ignore *)
                  else
                     (* We hit a Station: Move it *)
                     (go[], mousepos, NoModifier)
                       -> interactivemove;
                     leave scan
                 if);
             if);
          #);
          (* Nothing was hit *)
          mousepos->makeStation;
       #);
  #);
</BETA>

<P> The Picture used to hold the graphical objects of myCanvas is
called thePicture. The graphical objects in thePicture are scanned
using the control pattern <INX>ScanGOsReverse</INX>. This control
pattern scans through the objects in the Picture downwards from the
top (frontmost) graphical object. Using go.containspoint it is checked
if the mouse was inside the graphical object, and if so, the scanning
is stopped, except if the graphical object was the map. If a Station
was 'hit', a reference to it is passed to interactivemove. The
<INX>Modifier</INX> parameter to interactivemove is used to specify
what keyboard modifiers should be used to constrain the
interaction. In this case <INX>NoModifier</INX> is specified, meaning
that the interaction cannot be constrained. If no Station was hit,
makeStation is invoked as before.</P> 


