<H1> <A
NAME="LINK-bifrost-tut-_Toc402456567"><A NAME=MARKER-9-79></A>Moving
Stations</A></H1> <P> Having created the Stations, the next task is to
make it possible to move them around. The moving of a Station is
simple to do, since a Station is a Picture which in turn is a
specialization of AbstractGraphicalObject<A NAME=MARKER-2-81></A>. A
reference to an AbstractGraphicalObject can be entered to the
interactivemove <A NAME=MARKER-2-82></A>attribute of myCanvas, that
does exactly what is needed in this case. Thus the only thing to do is
to change onMouseDown of myCanvas to handle the situation right. If
the mouse is pressed outside any existing Stations, a new one must be
created as above. If the mouse is pressed inside an existing Station,
then an interaction for moving this station should be started. One way
to find out if anything was hit is by scanning through all graphical
objects in the Picture of myCanvas, and for each graphical object
check whether the mouse position is contained within this graphical
object. An exception has to be made for the city map, which must never
be moved around. In subway4.bet<A NAME=MARKER-2-83></A>, onMouseDown
becomes </P>


<PRE CLASS=beta>
onMouseDown:: 
  (# 
  do (* Transform mousepos to BifrostCanvas coordinates *)
     mousepos-&gt;devicetocanvas-&gt;mousepos;
      
     scan: 
       (# (* Find out what was hit - if any *)
       do thePicture.ScanGOsReverse
          (# 
          do (if (myCanvas[], mousepos)-&gt;go.containspoint then
                 (if go[]
                  // map[] then (* ignore *)
                  else
                     (* We hit a Station: Move it *)
                     (go[], mousepos, NoModifier)
                       -&gt; interactivemove;
                     leave scan
                 if);
             if);
          #);
          (* Nothing was hit *)
          mousepos-&gt;makeStation;
       #);
  #);
</PRE>

<P> The Picture used to hold the graphical objects of myCanvas is called thePicture. The graphical objects in thePicture are scanned using the control pattern ScanGOsReverse<A NAME=MARKER-2-84></A>. This control pattern scans through the objects in the Picture downwards from the top (frontmost) graphical object. Using go.containspoint it is checked if the mouse was inside the graphical object, and if so, the scanning is stopped, except if the graphical object was the map. If a Station was &quot;hit&quot;, a reference to it is passed to interactivemove. The Modifier <A NAME=MARKER-2-85></A>parameter to interactivemove is used to specify what keyboard modifiers should be used to constrain the interaction. In this case NoModifier <A NAME=MARKER-2-86></A>is specified, meaning that the interaction cannot be constrained. If no Station was hit, makeStation is invoked as before.</P>


