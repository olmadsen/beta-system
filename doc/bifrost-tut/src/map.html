<H1> <A NAME="LINK-bifrost-tut-_Toc402456565"><A NAME=MARKER-9-38></A>Adding the City Map</A></H1>
<P> Having the program skeleton set up, the next issue considered, is
the map of the city that is to be displayed in the Canvas. One way to
display this map is to use an instance of the Predefined Graphical
Object Rect<A NAME=MARKER-2-40></A>, which describes a Rectangle, and
then fill it with a TiledSolidColor <A NAME=MARKER-2-41></A>using the
BitMap <A NAME=MARKER-2-42></A>for tiling. A TiledSolidColor is a
solid color, e.g. black, which also has a Bitmap, a so called tile<A
NAME=MARKER-2-43></A>. When filling with a TiledSolidColor, only the
bits in the tile, which are TRUE, will be painted. The tile will be
replicated as many times as needed to fill out the Shape, hence the
name.</P>

<P> Given that the bit map of the city map is in the file 
<CODE>~beta/bifrost/bitmaps/Aarhus.pbm</CODE>
 in the PBM format<A NAME=MARKER-2-44></A> discussed in 
<A HREF="../bibliography/index.html#mia91-13">[MIA 91-13]</A>, 
<A HREF="../bifrost-ref/bifrost-ref-18.html">Chapter 5</A>,  
the TiledSolidColor may be declared as follows in subway2.bet:</P>

<PRE CLASS=beta>
aarhus: @TiledSolidColor
      (# bits: @bitMap
            (#
            do 'Reading in map ... ' -&gt; puttext;
               '~beta/bifrost/bitmaps/Aarhus.pbm' 
                 -&gt; readFromPBMfile;
               'done' -&gt; putline;
               (0,0) -&gt; hotspot;
            #);   
         
         init::
            (#
            do black -&gt; name;
               bits -&gt; thetile;
            #)
      #);
</PRE>
<P> The BitMap is read from the PBM file using ReadFromPBMFile<A NAME=MARKER-2-45></A>. This may take a while, and to inform the user of what is going on, some explanatory text is written out on the screen. The hotspot <A NAME=MARKER-2-46></A>of the BitMap is set to (0,0). This is to control the placement of the BitMap within the Rect, that it will be used to fill out.</P>
<P> In the TiledSolidColor, init <A NAME=MARKER-2-47></A>simply
evaluates the BitMap, and assigns the result of the evaluation, which
is a reference to the BitMap, to the theTile <A
NAME=MARKER-2-48></A>attribute of the TiledSolidColor. It also
evaluates the pattern black <A NAME=MARKER-2-49></A>and assigns the
result to the name <A NAME=MARKER-2-50></A>attribute. This will make
the bits of the tile, which are set, appear black on the screen. The
black pattern is declared in the fragment <CODE>~beta/bifrost/ColorNames</CODE>
which must be INCLUDEd in subway2.bet.</P>

<P> With this definition of the TiledSolidColor, the Rect may then be declared as follows:</P>
<A NAME=MARKER-2-51></A>
<PRE CLASS=beta>
map: @Rect
   (# 
      init::
         (#
         do (* Make THIS(Rect) the size of the aarhus-bitmap *)
            aarhus.init;
            (0,aarhus.bits.height) -&gt; upperleft;
            aarhus.bits.width -&gt; width;
            aarhus.bits.height -&gt; height;
            aarhus[] -&gt; setpaint;
         #)
    #);
</PRE>
<P> In the Rect, init first initializes the TiledSolidColor called aarhus which in turns reads the bitmap from the PBM file as described above. Then upperleft<A NAME=MARKER-2-52></A>, width <A NAME=MARKER-2-53></A>and height <A NAME=MARKER-2-54></A>are set using the dimensions of the BitMap. Finally a reference to the TiledSolidColor is given to the setpaint <A NAME=MARKER-2-55></A>attribute of the Rect, thus making aarhus <A NAME=MARKER-2-56></A>be used as the paint to fill the Rect with. The shape of the Rect has a default hotspot in the upper left corner. When a graphical object is filled with a TiledSolidColor, the hotspot <A NAME=MARKER-2-57></A>of theTile of the TiledSolidColor is placed in the hotspot of the Shape of the graphical object, and theTile is then replicated as needed to fill out the entire Shape. Thus having defined the hotspot of aarhus.bits <A NAME=MARKER-2-58></A>to (0,0) and made the Rect have the exact dimensions of the BitMap, the BitMap will be shown exactly once within the Rect.</P>
<P> All that is needed now is to initialize and draw the Rect. It is initialized in myCanvas.open:</P>
<PRE CLASS=beta>
open:: 
  (# 
  do (* Make THIS(BifrostCanvas) the size of the map *)
     map.init;
     (map.width, map.height)-&gt;Size-&gt;theWindow.size;
  #);
</PRE>
<P> Instead of the arbitrary size used in subway1.bet, the Canvas is given the same dimensions as the Rect containing the BitMap. Now the Rect is ready to be drawn when the Canvas has become visible on the screen. Thus myCanvas.onOpen becomes: </P>
<PRE CLASS=beta>
onOpen:: (# do map[] -&gt; draw; #);
</PRE>
<P> The predefined graphical object Rect is defined in a separate fragment, <CODE>~beta/bifrost/PredefinedGO<A NAME=MARKER-2-59></A></CODE>, which must be INCLUDEd in subway2.bet<A NAME=MARKER-2-60></A>. </P>







<!-- TOC -->




