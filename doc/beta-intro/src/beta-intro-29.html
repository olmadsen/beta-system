<H1> <A NAME="LINK-beta-intro-_Toc403635903"><A NAME=MARKER-9-164></A>Coroutines</A></H1>
<P> Deterministic coroutines<A NAME=MARKER-2-166></A> have demonstrated their usefulness through many years of usage. Below we give a typical example of using coroutines.</P>
<P> Suppose we have a register for the permanent workers and another one for the hourly paid workers. Suppose also that it is possible to sort these registers according to a given criterion like the total hours worked by the employee. Suppose that we want to produce a list of names of all employees sorted according to the total hours worked. This may be done by merging the two registers. A register object has a scan operation that makes it possible to go through all elements of the register. Instead we define an operation of register in the form of a coroutine getNext, which delivers the next element of the register when called:</P>
<PRE CLASS=beta>
register:
  (# 
     getNext: | @
       (# elm: ^employee
       do scan(# do current[]-&gt;elm[]; suspend #);
          none-&gt;elm[]
       exit elm[]
       #);
  #);
  pReg: @permanentRegister; hReg: @hourlyPaidRegister;
  
  pReg.getNext-&gt;e1[]; hReg.getnext-&gt;e2[];
  L: cycle
    (#
    do (if e1[] = none then (*empty hReg*); leave L if);
       (if e2[] = none then (*empty pReg*); leave L if);
       (if e1.totalHours &lt; e2.totalHours then
           e1.print; pReg.getNext-&gt;e1[]
        else 
           e2.print; hReg.getNext-&gt;e2[]
       if)
    #)
</PRE>
<A NAME=HEADING29-4></A>
<H1> Suspending and resuming</H1>
<P> The attributes getNext of the objects pReg and hReg have their own thread of execution. When called in an imperative like pReg.getNext-&gt;e1[], the thread is executed until it either executes a suspend or terminates. If it executes a suspend<A NAME=MARKER-2-167></A>, it may be called again in which case it will resume<A NAME=MARKER-2-168></A> execution at the point of suspend. The first time getNext is called, it will start executing scan. For each element in the register, it will suspend execution and exit the current element via the exit variable elm[]. When the register is empty, NONE is returned.</P>











