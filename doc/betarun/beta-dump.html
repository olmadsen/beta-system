<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE>BETA runtime error stack dump</TITLE>
<LINK REL="stylesheet" HREF="../style/miadoc.css" TYPE="text/css">
</HEAD>

<BODY>
<H1>BETA runtime error stack dump</H1>

<P> Runtime errors are errors in the program detected during its
execution. In this case an error message is given and a dump of the
call stack of objects is generated on the file <CODE>foo.dump</CODE> 
if the program
is named <CODE>foo</CODE>.</P>

<P> Consider the following fragments (note that the name of the
fragments are complete UNIX file paths) </P>


<A NAME="mylib.bet"><H4 class=betacaption>/usr/smith/mylib.bet</H4></A>

<PRE class=beta>
ORIGIN '~beta/basiclib/betaenv'
--LIB: attributes--
lib1: (# do INNER #);
lib2: lib1 
  (# T: (# x: @integer #);
     R: ^T
  do (* &amp;T[]-&gt;R[] *) 
     111-&gt;R.x; (* R[] is NONE *)
     INNER
  #);
lib3: lib2(# do 'hello'-&gt;putLine #) 
</PRE>

<A NAME="runtimeerr.bet"><H4 class=betacaption>/usr/smith/runtimeerr.bet</H4></A>

<PRE class=beta>
ORIGIN '~beta/basiclib/betaenv'; 
INCLUDE 'mylib' 
--PROGRAM: descriptor--
(# foo1: (# do foo2 #);
   foo2: (# do foo.foo3 #);
   foo: @(# foo3: (# do lib3 #)#)
do foo1
#)
</PRE>

<P> Execution of this program on a SPARC Solaris (<CODE>sun4s</CODE>)
machine will result in the
following file:

<A NAME="runtimeerr.dump"><H4 class=betacaption>runtimeerr.dump</H4></A>

<PRE CLASS=beta>
Beta execution aborted: Reference is none.

Call chain: (sun4s)

  item lib3#&lt;lib2#&gt;lib1# in /usr/smith/mylib
  item lib3#lib2#&lt;lib1#&gt; in /usr/smith/mylib
  item &lt;foo3#&gt; in /usr/smith/runtimeerr
  item &lt;foo2#&gt; in /usr/smith/runtimeerr
  item &lt;foo1#&gt; in /usr/smith/runtimeerr
  comp &lt;PROGRAM-~&gt; in /usr/smith/runtimeerr

  basic component in ~beta/basiclib/betaenv


Low level information:

Call chain: (sun4s)

  item lib3#&lt;lib2#&gt;lib1# in /usr/smith/mylib
  { PC  0x278e8 &lt;M2MYLIB+0xc&gt;, object 0x10010b78, proto 0x56c98 "lib3#" &lt;T4MYLIB&gt; }
    -- BETAENV-~ in ~beta/basiclib/betaenv
    { Surrounding object 0x10010038, proto 0x53a98 "BETAENV-~" &lt;T1BETAENV&gt; }
  ... <EM>Rest of low level dump left out</EM> ...
</PRE>

<H2>Call Chain</H2>

<P> The information in <CODE>runtimeerr.dump</CODE> has the following meaning: </P>

<ul>

 <li> The activation stack of invoked objects is shown, one per line in
the <CODE>Call Chain</CODE>. The names shown for objects are the names
of the corresponding patterns. Anonymous patterns are shown as
<CODE>*</CODE>.
Components are marked with
<CODE>comp</CODE> at the beginning of the line,
whereas ordinary objects are marked with
<CODE>item</CODE>.
The outmost component, which executes the <CODE>betaenv</CODE> object
is marked as <CODE>basic component</CODE>.
<P>

 <li> From the above file it can be seen that the error occurred in an
instance of <CODE>lib3</CODE>. The description
<CODE>lib3#&lt;lib2#&gt;lib1</CODE> shows the 
superpattern chain of <CODE>lib3</CODE>. The braces
(<CODE>&lt;</CODE>,<CODE>&gt;</CODE>) indicates that the 
error occurred in the do-part of <CODE>lib2</CODE>.<P>

 <li>The symbol immediately after the name of an object shows its
kind. The different possibilities are:
<ol>

<li> <tt>#</tt> The descriptor belongs to a pattern, e.g. <tt>P: (#...#)</tt>

<li> <tt>~</tt> Singular named descriptor, e.g. <tt>X: @(# ... #)</tt>

<li> <tt>* </tt> Singular unnamed descriptor, e.g.  <tt>...; (# ... #);...</tt>

<li> <tt>-</tt> Descriptor SLOT.
</ol>
 Notice that, e.g. the <CODE>PROGRAM</CODE> SLOT is marked with
both <tt>-</tt>
and <tt>~</tt> since a descriptor SLOT gives rise to a singular named
descriptor.
<P>

 <li>It can be seen that <CODE>lib3</CODE> was called from <CODE>foo3</CODE>, which was called
from <CODE>foo2</CODE>, which was called from <CODE>foo1</CODE>,
etc. The bottom most objects
are defined in <CODE>betaenv</CODE>.
<P>

 <li> For each object, the corresponding fragment file is shown. The
pattern <CODE>lib3</CODE> is defined in the file <CODE>/usr/smith/mylib</CODE>

</UL>

<H2>External Activation Parts</H2>

External functions may also be involved in the call chain (not shown
in the above example):

<UL>
<LI>If a BETA program causes a runtime error in an external function call
(e.g. a C function called from BETA), the dump will show 
<CODE>[ EXTERNAL ACTIVATION PART ]</CODE> as the top of the call chain.
<P>

<LI>In case the BETA code has called some external code which has in
   turn called back into the BETA code, and the callback is still
   active at the point of the error, the intermediate call stack part
   is shown as <CODE>[ EXTERNAL ACTIVATION PART ]</CODE>
<P>
</UL>


<H2>Low Level Information</H2>

After the simple call chain follows a section titled <EM>Low level
information</EM>. 
This section shows the call chain again, but with much more details than the
simple call chain. The extra information is:

<UL>

<LI>Between the curly braces (<CODE>{</CODE>, <CODE>}</CODE>) is
shown, in both hexadecimal and symbolic form, what the current program
counter of the object was, at what address the object was placed, and
what it's <EM>prototype</EM> (type information) is. This information
is probably of no concern for the ordinary programmer, but it can be
valuable information for the people at Mjølner Informatics, if an 
<A HREF="../install/misc.html#errors">error report</A> is submitted to
Mjølner Informatics with the dump file attached.
<P>

<LI>For each active object its enclosing object is also shown, on a line
starting with '--' The encloser of e.g. <CODE>foo3</CODE> is <CODE>foo</CODE>. The rest of the
objects in the example have enclosers, which are SLOTs.
<P>
This information can sometimes be of interest for the ordinary
programmer, since it helps identify the objects.

</UL>

If the low level trace is considered more confusing than helpful, one
can prevent it from appearing in future dumps by setting the
<A HREF="BETART.html"><CODE>BETART</CODE></A> environment variable
to include <CODE>SimpleDump</CODE>. See
<A HREF="BETART.html">The BETART Environment Variable</A> for details.
<P>
The low level trace takes some time for the BETA runtime system to
produce.
The time is proportional to the size of the executable. This is the
reason that a substantial time may pass from the time the crashing
program has printed out <CODE>BETA Execution Aborted</CODE> until 
it actually exits. Please do not interrupt the process during this
time, since the dump will then be incomplete.

<P>
<!--++++++++++++++++++++++++++++++-->
<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>BETA runtime error stack dump</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>

</BODY>
</HTML>
