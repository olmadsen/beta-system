
Ole, i forb. med betarun/v3.0 oprydning:

I betaenv er der i dag f|lgende:

doGC: (# do TOS'DoGC' #).

Bl.a. p} baggrund af |nsker fra dig, vil jeg foresl}, at vi
i stedet indf|rer:

doIOAGc: (# ... #);
doAOAGc: (# ... #);
doLVRAGc: (# ... #);

Jeg skal gerne lave tre C funktioner i GC, som implementationen
af disse kan kalde (det er relativt nemt).

Fint! 
Jeg kunne ogsaa oenske mig en

        totalGC

som laver GC overalt saa der ingen doede objekter er tilbage.
Det manglede jeg fx i forbindelse med at trace memory leaks
---olm

-----------------------------------

Det er vel korrekt at der kommer en numerisk fejl her

        maxInt  = 2^31 - 1
        minInt  = - 2^31

        maxInt - minInt = 2^31 - 1 - - 2^31 = 2^62 - 1

så hvis eksemplet ikke fejler på andre platform 
(fejler ikke på sun4s)
er det vel en fejl.

---olm

> Fejlen  er nu rettet i bifrost. 
> Det viser sig at programmet
> 
> ORIGIN '~beta/basiclib/betaenv';
> --PROGRAM: descriptor--
> (# x, y: @integer;
> do maxint->x;
>    minint->y;
>    x-y->y;
> #)
> 
> reproducerer problemet: maxint-minint giver SIGFPE (floating point
> exception) på sgi.
> 
> Jeg har kodet udenom det i bifrost med et eksplicit test
> (skyldes at Freja åbenbart beder om "bounds" på et Picture,
> der ingen grafiske objekter har i sig.
> 
> Freja starter i hvert fald rigtigt op på frejalib nu.
> 
> /Peter
> 


-----------------------------------

Det skal checkes, om der stadig pushes current object i BetaStackTop[0
]
ved external-kald og callbacks. Bruges ikke af RTS.


-----------------------------------

Jeg vil gerne kunne inline SPx og SPy i component-hovederne
med en option, da dette kan fjerne noget rigtigt griseri i betarun. /P
eter


-----------------------------------

It would be nice to avoid having to check in each attach of a componen
t
whether it is the first attach or not.
It should be possible to initialize the component in AlloC so that
it can be started the same way by Attach each time.
E.g. the CallerLCS should be it's own M-entry.
There is a problem, though, to get the 'dyn' link on sgi and ppcmac
correct, since this is handled specially at the first attach.


-----------------------------------

Add support for registering Stop actions (actions to be executed when
Stop is called, but before the program terminates).
Aff|dt af Lennerts problem med at frig|re globale resourcer n} en
NT applikation stopper.


-----------------------------------

Subject: Potentielt callback/leave problem
Date: Wed, 6 Dec 1995 15:33:02 +0100 (MET)

Ved callback ser stakken som bekendt s}dan ud:

     * STACK LAYOUT at callback:
     * 
     *          |____________|<-.              _
     *          |            |  |               |
     *          |      X     |  |               |  Frame for BETA
     *          |            |  |               |  before entering C
     *     SPx->|____________|  |              _|
     *          |////////////|  |               |
     *          |////////////|  |               |  Frame for C
     *          |////////////|  |               |
     *          |------------|  |              -'
     *          |  real-dyn  |  |                Pseudo frame
     *  prevSP->|___SP-beta__|--'              _
     *          |   RTS      | = PC in C        |
     *          |   dyn      | = CALLBACKMARK   |
     *          |            |                  |
     *          |            |                  |  Frame for callback-
stub
     *          |            |                  |
     *          |            |                  |
     *          |____________|                 _|
     *      SP->|            |
     *          |            |
 
*HVIS* der i ExO er en situation, hvor exitObj er lige netop det
objekt, der har kaldt C (X) kan jeg IKKE beregne toppen af dens
stakframe (SPx). Det skyldes, at jeg ikke har nogen returnv{rdi at
bruge til beregning af prefixlevel, og dermed af SPoff.
Hvis vi som tidligere gemmer SPx i betaStackTop, s} vil dette problem
ikke v{re der, men til geng{ld vil jeg ikke kunne komme videre ned ad
stakken, da jeg stadig mangler en PC v{rdi til at beregne SPoff.

Mulige l|sning:

Compileren ved vel n}r den overs{tter koden for et 
objekt, om der kan leaves/restartes til det (kr{ver jo en label).
HVIS der er et C-kald i dette kode, kunne man putte returadressen
i BetaStackTop arrayet ogs} (og kun i dette tilf{lde).
Det vil vel v{re meget sj{ldent.

/Peter

PS. Jeg bruger stadig ikke "real-dyn" (current object f|r c-kald)
til noget - jeg kan altid finde den |verst p} refstak givet "SP-beta".

-----------------------------------

Sysutils/errorscreen.bet:

ErrorScreen.PutText kan ikke klare store tekststrenge:

Text parameter to C routine too big (max. 1000 bytes)

Det faar statistik-programmet til at gaa ned (under fejlrapportering).

Jeg kan sagtens omgaa det nu, men det boer komme paa en eller andens T
ODO liste
til efter r5.0.

Elmer

-----------------------------------


Thu, May 27, 1999 at 03:10:37PM +0200 datpete@mjolner.dk wrote:
> Manmathan Muthukumarapillai writes:
> > 
> > BUG i betarun: problem med nm kald.
> > 
> > nm kald i betarun antager at argument[0] er den korrekte sti
> > til executable. Men det er jo sjælden tilfældet og burde nok
> > fixes.
> > 
> > --mannan
> > 
> 
> Øh, hvornår er det ikke korrekt?

cd $BETALIB og køre mjolner ved at skrive "mjolner"
jeg antager at der ikke findes noget der hedder $BETALIB/mjolner
gøre noget så mjolner dumper
nm klager over at den ikke kan finde mjolner

--mannan


-----------------------------------

Subject: leave af callback
Date: Wed, 25 Jan 95 13:58:07 GMT

ExO: der skal checkes for om den frame man rammer er ActiveCallbackFra
me.
I givet fald skal ActiveCBF opdateres. CRUN+RUN.

/Peter

-----------------------------------

Intel: Sikkert nødvendigt at gemme floats henover DoGC
da GC nu kan finde på at bruge floats til f.eks. printf.

-----------------------------------


Subject: ComponentPVValue etc som enum

kan g|re "reached end of nonvoid function" fjernet.
Og kan muligvis eliminere ProtoSwitch hacket.

-----------------------------------


Eliminate LazyItem, CallLazyItem:
Change DOT to contain *handles* to BETA objects instead of
pointers as now.
Allocate LazyItem in lazyref_gc.c and add a handle to it to
DOT (then GC does not have to have special knowledge about
LazyItem, since it will be handled via DOT).

-------------------------------------
Her er lidt til TODO-listen:

   1) Hvis man er uheldig, kan AOAtoIOAReAlloc's egne AOAtoIOAInsert's
      udl|se en ny AOAtoIOAReAlloc, hvilket s} vidst jeg umiddelbart kan
      se ikke vil fungere korrekt.

   2) Det ville v{re en god ide at rense ud i AOAtoIOAtable i stedet for
      at allokere en ny og st|rre tabel. Praktiske erfaringer viser, at
      langt hovedparten af indgangene typisk er for{ldede, n}r tabellen
      l|ber fuld, fordi de udpegede objekter i mellemtiden er flyttet
      til AOA.

      Som det var f|r, lavedes der kun udrensning i tabellen ved AOAGc;
      nu sker det ogs} ved AOAtoIOAReAlloc, hvilket jo egentlig er for
      sent (men bedre end ingenting).

      Det er virkelig noget skidt, hvis tabellen vokser un|digt, da det
      |ger tiden for hver eneste IOAGc, at den skal genneml|bes; og med
      den nuv{rende heuristik s{ttes st|rrelsen aldrig ned igen.

   3) Jens Cornelius Olsen og J|rgen Greve havde problemer med at
      InfoFile gav sideeffekter p} programafviklingen. Det kan muligvis
      skyldes, at der var rod i den pga. inkonsistens skyldet min lidt
      for optimistiske udrensningsalgoritme (jeg glemte at ToSpace-
      referencer er lovlige hvis AOAtoIOAReAlloc sker ved AOAGc). Hvis
      de stadig har problemet, skal vi have set p} det.

/Jacob


-------

CInterface:
----------
Nu hvor beta char-reps allokeres som i C, s} kan CInitT undv{res, hvis
CpkVT afl|ses af at compileren beregner offset'et til 1. char.
Kr{ver dog, at der ikke kommer GC'er.


GC:
-------------------------------------
scavenging.c, aoa.c etc: use GCEntry* in steping through static GC tables 

Lad v{re med at opbygge IOAtoAOAtable under hver IOAGc, g|r det i stedet
f|r hver AOAGc vha IOAGc med flag sat.

Rutine til at kalde AOAGc direkte (foruds{tter at AOAtoIOATable laves af AOAGc direkte.

Hvis man løber tør for primes: Kopier alt til AOA.


RUN:
-------------------------------------

Make GCEntry, CBFAEntry etc. datatype. (Is now defined, not used yet)

ExitObjects.run: 
   exitObj = theObj not enough. Should be checked if it IS a reference!
   next must not be in beta heap.
   
   ORIGIN 'betaenv'
   ---program:descriptor--
   (# A:
	(#
	do 'b' -> put; 
	   L: (# S: @| (#
		       do 'c' -> put;
			  suspend;
			  'e' -> put;
			  P
		       #);
		 P: @| (# do 'f' -> put; leave L #)
	      do S; 'd'->put; S; 'q'->put
	      #);
	   'r'->put
	#);
   
   do 'a' ->put; A; 'w'->put
   #) 

RUN:
CRUN:
LVRA check missing in CopyText+CopyCText+CopySliceValRep+MakeTextObject

RUN: Passing arguments in pReg1 when DataReg1 is not used is a waste 
(e.g. AlloI).

CRUN:
=====

Clean up in SnakeAdditions.S (RefSP loaded/saved too often?).
Remove all saved{IOA,IOATopOff,RefSP} in snake code (currently undef'ed).

Dynamic allocation of ReferenceStack. Check for more than 50% filled in AlloI.


Beta.dump:
==========

See TST/tstdump/README for status.

