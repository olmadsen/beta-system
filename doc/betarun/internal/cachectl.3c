.\" $Header: /a/home/alhambra02/beta/.CVSHOME/beta_project/doc/betarun/internal/cachectl.3c,v 1.1 1999-03-23 10:13:05 datpete Exp $
.TH cachectl 3C "" "Series 300/400 Only"
.ds )H Hewlett-Packard Company
.ds ]W HP-UX Release 8.0: January 1991
.SH NAME
cachectl \- flush and/or purge the cache
.SH SYNOPSIS
.B "#include <sys/cache.h>"
.P
.B "int cachectl(int cachecmd, void *address, size_t length);"
.SH DESCRIPTION
.I cachectl
permits a program to flush or purge data in the data
and/or instruction caches.
The features provided by
.I cachectl
are not needed by most programs.
It is primarily used for programs that do dynamic loading
or contain self-modifying code.
Programs that do dynamic loading or contain self-modifying code can use the
.SM
.B CC_IPURGE
request, after the new code has been written to memory,
to ensure that the correct code will be fetched
by the instruction cache during execution.
The
.SM
.BR CC_FLUSH ,
.SM
.BR CC_PURGE ,
and
.SM
.B CC_EXTPURGE
requests should only be used by applications that are highly hardware
dependent and which have detailed knowledge of hardware internals.
.PP
The
.I cachecmd
parameter specifies what operations to carry out on the cache or chaches.
.I cachecmd
should contain one of the following values,
which are defined in
.RB < sys/cache.h >:
.RS
.TP 18
.SM
.B CC_PURGE
Purge the cache.
Dirty cache entries are discarded without being written to memory.
A ``dirty'' cache entry is an entry that has been modified, but has
not been written back to the corresponding memory location.
.TP
.SM
.B CC_FLUSH
Flush the cache.
Dirty cache entries are copied back to the corresponding memory locations.
This operation is the same as
.SM
.B CC_PURGE
on models that do not have a copyback cache.
.TP
.SM
.B CC_IPURGE
flush any dirty data cache entries,
then purge any instruction cache entries which are ``stale''.
A ``stale'' instruction cache entry is an entry
that is older than the corresponding memory location.
This can happen if the corresponding memory location
was written to (via the data cache).
This operation is useful for self-modifying code.
.RE
.PP
The following mask, defined in
.RB < sys/cache.h >,
can be
.SM OR\s0ed
together with one of the above values
in order to purge the external cache (if one exists) at the same time.
.RS
.TP 18
.B CC_EXTPURGE
purge the external cache (if any).
.RE
.PP
The
.I address
parameter specifies the start address of the area to be flushed and/or purged.
If the specified start address is a null pointer,
the operation is applied to the entire cache or caches specified by the
.I cachecmd
parameter.
Selective flushing and/or purging is not supported on all models.
Some models have restrictions
on the legal values for the address parameter.
See the
.SM DEPENDENCIES
section for details about specific hardware.
.PP
The
.I length
parameter is used only when a start address is specified.
It controls the length of the area to be flushed or purged.
.SH EXAMPLES
The following call to
.I cachectl
requests that the entire data cache be flushed,
followed by a purge of the instruction cache.
.IP
.B "cachectl (\s-1CC_IPURGE\s0, 0, 0);"
.SH RETURN VALUE
.I cachectl
returns
.B 0
if the operation succeeds, otherwise
.B \-1
is returned.
The semantics of
.IR cachectl ,
when the
.I address
parameter contains a bad address, is subject to change,
and may vary from machine to machine.
.SH ERRORS
.PP
.I cachectl
fails and sets
.B errno
to the value indicated if:
.RS
.TP 15
.SM [EINVAL]
.I cachecmd
is not a a valid request.
.RE
.SH DEPENDENCIES
.SS Series 300/400
The
.SM MC68020
and
.SM MC68030
processors do not have a copyback cache.
Selective purging is not supported for the
.SM MC68020
and
.SM MC68030
processors.
Selective
purging and flushing is supported on the
.SM MC68040
processor, but only under the following conditions:
.RS
.TP 3
\(bu
If the
.I length
parameter is 16, the cache line which includes
.I address
is flushed and/or purged
(i.e., the 4 least significant bits of the address are ignored).
.TP
\(bu
If the
.I length
parameter is 4096, the page which includes
.I address
will be flushed and/or purged
(i.e., the 12 least significant bits of the address are ignored).
If the
.I length
parameter is not 16 or 4096, the operation
is applied to the entire cache or caches specified by the
.I cachecmd
parameter.
.PP
On the
.SM MC68040
microprocessor,
.SM
.B CC_PURGE
instead performs a
.SM
.B CC_FLUSH
if the
.I length
parameter is not 16 or 4096.
.SH AUTHOR
.I cachectl
was developed by HP.
.\"
.\" index	\fIcachectl\fR \- flush and/or purge the cache 	 \fBcachectl(3C)\fR
.\" index	flush and/or purge the cache 	 \fBcachectl(3C)\fR
.\" index	purge and/or flush the cache 	 \fBcachectl(3C)\fR
.\" index	cache, flush and/or purge the 	 \fBcachectl(3C)\fR
.\"
.\" toc	\fBcachectl(3C)\fR:\0\0\fIcachectl\fR 	 flush and/or purge the cache
.\"
.\" fileset_database	cachectl.3c PROG-AUX-MAN
