<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>

<HEAD>
<TITLE>Metagrammar boot</TITLE>
</HEAD>

<BODY>
<H1>Metagrammar boot</H1>

<b>
This description is now rather out of date, since it assumes you
have two development tracks, and boot the one from the other.  The
normal way to do a metagrammar boot these days is to delete all
generated (non-CVS) files in $BETALIB/grammars, and then use the
command '<a href="devsystem.html">mbs_boottrack</a>'.
See also the documentation on
<a href="mbs_mkboot.html">mbs_mkboot</a>.
</b>

<p>

The following is a description from Morten Grouleff of a boot of both
a boot-release and a normal release, including a boot of the meta
grammar. It is not necessarily correct for releases later than r4.1.

<P>

There si also a description of what was done to get r5.0 running using
r4.2.1 and r5.0.boot. it is <A HREF="#r5_0_boot">here</A>

<P>

There are some comments from Peter Andersen, marked <CODE>datpete:</CODE>.

<PRE>

Jeg har nedenfor beskrevet hvad jeg har gjort for at boote i r4.1.boot &
r4.1 på PC.  

Der er HELT SIKKERT ting, der ikke er korrekte i det flg, da jeg ikke lige
frem er fortrolig med processen.  Ret det endelig, så vi kan få det
veldokumenteret! 


Forudsætninger:

1) Der ligger et helt r4.0.3-spor med genererede tools, så som beta, gen,
exbobs, etc.

2) r4.1.boot og r4.1 skal være up-to-date;  Det er en god ide at køre
mbs_cvscheckupdate & cvschecklocal i begge spor.

datpete: ingen grund til cvschecklocal. Husk at sætte BETALIB inden 
mbs_cvscheckupdate køres.

3) Sørg for at have et rent spor uden filer genereret af gamle tools.  Slet
derfor *.ast *.astL *.btab *.btabL *.bobs tables *.ptbl *.ptblL (Er det alt?)

datpete: Husk det i begge spor.
datpete: På PC gøres det med: 
  global /q /i del /Q *.ast *.astL *.btab *.btabL *.bobs tables *.ptbl *.ptblL

Procedure:

1) Generer grammatikker.  Meta skal igennem to gange som nedenfor:
  SET BETALIB=r4.0.3
  cd r4.1.boot
  dogram metagrammar
  dogram prettyprint
  dogram metagrammar
  SET BETALIB=r4.1.boot
  bootdogram beta
  bootdogram property

2) kopier genererede filer:
  cd r4.1.boot
  cp grammars/beta/v2.6/betacfl.bet betaast/v5.2/
  cp grammars/metagram/v4.4/metagrammarcfl.bet mps/v5.2/
  Ret ORIGIN i den sidstsnævnte til den rigtige version

datpete: Jeg mener ikke det er udelukkende i den sidstnævnte, men i begge
man skal rette ORIGIN.
  
3) Generer compiler:
  cd compiler
  bootbeta -qwl -o nti/ms/beta beta

datpete: Her kan man passende checke at TST virker.
datpete: grammars/beta/v2.5 kræves (dvs gamle version af beta grammar).

4) Generer nye tools:
  cd bobsgen/v1.6
  bootbeta -qwl -o NTItabc tabc

PC:
  cl /nologo /w /I. /O2 /Zd /DWIN32 /Dnti /Dnti_ms /Zp4 /c p2c\p2clib.c
  cl /nologo /w /I. /O2 /Zd /DWIN32 /Dnti /Dnti_ms /Zp4 /c NTIexbobs.c
  cl /FoNTIexbobs.exe /nologo /w /Zd /Zp4 NTIexbobs.obj p2clib.obj

datpete: Dette er træls at skrive. For lige netop exbobs kan man på PC bruge
mbs_compiletools (sig nej til alle andre end exbobs).

UNIX:
  ./makebobs

  cd meta/v5.2
  bootbeta -qwl -o NTIgen gen

  cd prettygen/v5.2
  bootbeta -qwl -o NTImakepretty makepretty
  bootbeta -qwl -o NTImorepretty morepretty

5) Generer et nyt betarun 3.0. (Stadig i r4.1.boot)
  Se &lt;URL:<A HREF="betarun.html#make">betarun.html#make</A>&gt;

datpete: kort sagt: bootdogram runtime; bootbeta gen; make/nmake

6) Generer grammatikker i r4.1:
  SET BETALIB=r4.1.boot
  cd r4.1
  dogram metagrammar 
  dogram prettyprint
  dogram metagrammar
  SET BETALIB=r4.1
  bootdogram beta
  bootdogram property

7) kopier genererede filer:
  cd r4.1
  cp grammars/beta/v2.6/betacfl.bet betaast/v5.2/
  cp grammars/metagram/v4.4/metagrammarcfl.bet mps/v5.2/

datpete: her er ORIGINs OK.
  
8) Generer compiler:
  cd compiler
  bootbeta -qwl -o nti/ms/beta beta

9) Generer et nyt betarun 3.0.
  Se <URL:betarun.html#make>

10) Check at compiler og TST virker.
  cd compiler
  cvs get TST
  cd TST
  beta -qwl tst
  ./tst

Dette virker pt på sun4s, så jeg antager at grunden til at det fejler på
linux skal findes i compileren/betarun, og ikke i processen her...

</PRE>


<HR>
<A NAME="r5_0_boot"><H1>r5.0 boot</H1></A>
<PRE>

1) grammars i r5.0.boot er et link til r4.2.1/grammars.

2) r5.0.boot er fuldt opdateret, dvs der er de nyeste grammarCFL.bet
filer spredt rundt i sporet.

3) skaf de nyeste grammatikker i r5.0.boot/grammars.new/

4) Ret versionsnummeret i r5.0.boot/mps/metagrammarcfl.bet 
   tilbage til 4, som det er i r4.2.1

5) Byg grammatiktools.  (mbs_compiletools -u, hvis utils er hacked til
   at bruge bootbeta altid istedte for beta, afbryd den ved psbrowser)
	
6) Brug dem i grammars.new: metagram, pretty.

7) Ret versionsnummeret frem igen i mps/metagrammarcfl.bet.

9) Byg grammatiktools igen.

10) Byg compileren.

11) Slet grammars, som var et link.

12) mv grammars.new grammars

13) Slet alle ast'er i grammars.

14) dogram i metagram.

15) dogram i pretty.

16) dogram i metagram.

17) I r5.0 er det nu muligt at udføre "mbs_bootgrammars" og
    "mbs_compiletools compiler", og "make all" i betarun, hvilket
    gør boot færdig.


Som det ses, skal grammars i r5.0.boot være et link til r4.2.1, hver
gang compileren derfra bruges.  Men når r5.0.boot bruges fra r5.0, skal
grammars i r5.0.boot være dens egne.

</PRE>

<HR>
<PRE>
$Author: datpete $
$Date: 2004-06-30 15:08:03 $
$Revision: 1.1 $
</PRE>
</BODY>
</HTML>
