<HTML>
<link rel="stylesheet" href="../../style/miadoc.css" type="text/css">
<TITLE>Building Betarun with mbs_make</TITLE>
<BODY>

<h1>Building Betarun with mbs_make</h1>

<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#invocation">Invocation</a>
</ul>

<h2><a name="intro"></a>Introduction</h2>

This document describes the thinking behind mbs_make, the utility
for building Betarun, the runtime system for BETA.  Mbs_make
sets up some variables, finds GNU make, creates a directory if necessary,
changes to that directory and calls Makefile-toplev in $BETALIB/betarun.
This in turn calls Makefile-vpath in the subdirectories.

<p>
We use the VPATH functionality of GNU make in order to separate source
and generated files in different trees.  Thus, the CVS directories in
$BETALIB/betarun/ (these are C, CRUN, GC, GEN, P and RUN) don't have
any files in them that do not come from CVS.  The other directories
(one for each architecture) do not have any files in them that cannot
be regenerated automatically.  This means different architectures do
not interfere with each other, and the architecture subdirectories
(linux, nti_gnu, nti_ms, x86sol, sun4s) can be removed and regenerated.

<p>
In addition, the architectural directories are further subdivided
into different configurations.  These configurations are documented
in comments in $BETALIB/betarun/Makefile-toplev.  The most important
ones are:

<p><b>nodebug</b>
<p>The normal betarun, which has support for running Valhalla (the
debugger in the Mjølner tool), and which the BETA compiler uses
by default.

<p><b>debug</b>
<p>The debugging betarun, which can be debugged in gdb, and which
also includes a lot of internal consistency checks.  You can use
this betarun by giving the BETA compiler the option '-s 13'.  It
runs very slowly, you can make it run rather faster by setting the
variable BETART to "FastIsObject".

<p><b>ugc</b>
<p>Unconditional GC. This version of betarun garbage collects all
the time, which is very very slow, but helps find GC-related errors.
Use '-s 80' as the BETA compiler option.

<p><b>nodebug_g</b>
<p>This is a normal betarun, but it includes debugging information for
gdb, so you can debug the parts written in C with a normal debugger.
Use '-s 88' as the BETA compiler option.

<p><b>nodebug_pg</b>
<p>Profiling version.  Works with gprof on Linux, not really tested on
other platforms. I think it works on Solaris.  Use '-s 31' on compiler.
This option has an effect on code generation (not just which betarun is
linked into the final program) so you have to recompile the whole program
with this option for best effect.

<p><b>novalhalla</b>
<p>A normal betarun except that is has no support for Valhalla, the
debugger in the Mjølner tool.

<h2><a name="invocation"></a>Invocation</h2>

mbs_make can be invoked from anywhere, it uses the $BETALIB variable
to find the correct version of betarun to compile.  If you invoke
it with no parameters, it will build all nonexperimental versions of
betarun.  If you have made only small changes to betarun this can
happen very quickly.

<p>
You can also specify as a parameter a betarun configuration (from the
list above) to compile, in which case mbs_make will make
only that configuration, leaving the others out of date.
This can be useful if you have made changes to a .h file,
which forces a longwinded recompile of large parts of Betarun.

<p>
You can specify extra parameters to mbs_make, and they will be given
to the 'make' process.  See the documentation of GNU make for details.

</BODY>
</HTML>
