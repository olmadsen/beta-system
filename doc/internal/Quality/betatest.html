<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>

<HEAD>
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">
<TITLE>Aftestning af Mjølner systemet</TITLE>

</HEAD>

<BODY>
<H1>Aftestning af Mjølner systemet</H1>

<H2>Indhold</H2>

<UL>
<LI><A HREF="#compiler">Aftestning af compiler</A>
<LI><A HREF="#runtime">Aftestning af runtimesystemet</A>
<LI><A HREF="#mjolner">Aftestning af Mjolner Tool</A>
<LI><A HREF="#psbrowser">Aftestning af psbrowser</A>
<LI><A HREF="#meta">Aftestning af meta tools</A>
<LI><A HREF="#pp">Aftestning af pp</A>
<LI><A HREF="#utils">Aftestning af utils tools</A>
<LI><A HREF="#demo">Aftestning af alle demoer</A>
</UL>

<H3>Detaljerede test beskrivelser</H3>
<UL>
<LI><A HREF="tutorialdemo.checklist.html">tutorial</A>
<LI><A HREF="toolchecklist.html">tools</A>
</UL>

<H2><A NAME="compiler">Aftestning af compiler</A></H2>

Dette foreg&aring;r ved at check CVS projektet <CODE>TST</CODE> ud og overs&aelig;tte
programmet <CODE>tst</CODE> (hvis der testes en branch, så husk at
checke branchen og ikke HEAD ud. Der vil normalt automatisk være
checket en TST ud i compiler directoriet, og i hvert betarun
directory - dog ikke i betarun under nye cvs struktur). 
<P>
Inden oversættelse af <CODE>tst</CODE> bør man checke pattern
<CODE>safeMode</CODE> i starten af <CODE>tstenv.bet</CODE>. Dette skal
være
<PRE>
safeMode: (# exit true #);
</PRE>
hvilket bevirker, at usikre/eksperimentielle elementer i TST suiten 
elimineres.
<P>
Ved en efterf&oslash;lgende k&oslash;rsel af programmet
skal det udskrive en r&aelig;kke linier, af alle bogstaver fra a-z og alle tal fra 0-9.
Led specielt efter om der er udr&aring;bstegn i outputtet - s&aring;
er der en fejl.
<P>
<EM>Bemærk:</EM> på sgi skal LD_LIBRARY_PATH sættes, som compileren
foreslår ved oversættelsen, for at <CODE>tst</CODE> kan startes.
<P>

<H2><A NAME="runtime">Aftestning af runtimesystemet</A></H2> 

En v&aelig;sentlig del af aftestningen af runtimesystemet er en
k&oslash;rsel af 
<CODE>tst</CODE> som ved 
<A HREF="#compiler">compilertest</A>. 
Man b&oslash;r generelt linke med <CODE>betarun.debug</CODE> 
(compiler switch 13), da der
s&aring; er visse konsistenscheck enabled per default.
<P>

<H3><A NAME="ioa_vary">Afpr&oslash;v forskellige IOA v&aelig;rdier</A></H3> 

Man b&oslash;r afpr&oslash;ve <CODE>tst</CODE> med forskellige
v&aelig;rdier for <CODE>IOA</CODE> sat vha <CODE>BETART</CODE>
environment variablen, e.g. 
<BLOCKQUOTE>
<CODE>setenv BETART IOA=35</CODE>
</BLOCKQUOTE>


<P>
P&aring; <CODE>NEWRUN</CODE> platforme (<CODE>sgi</CODE>, 
<CODE>ppcmac</CODE>) kan man teste, at <CODE>tst</CODE> kan k&oslash;re
igennem med <CODE>IOA=1</CODE>. 

<H3><A NAME="checkheap">Pr&oslash;v CheckHeap property</A></H3> 

G&oslash;r f&oslash;lgende:

<PRE>
beta -s 13 tst
setenv BETART IOA=35:InfoAll:DebugAll:CheckHeap:sai 
tst
</PRE>
Den sidste property vil foresage, at alle heaps scannes igennem ved 
<EM>hvert</EM> kald af rutinen <CODE>Ck</CODE>, som kaldes b&aring;de 
i starten og slutningen af hver eneste runtimerutine. 
Dette tager et par timer om at k&oslash;re!

<H3>Aftestning af garbage collectoren</H3>
Den ovenfor n&aelig;vnte aftestning af <CODE>tst</CODE> med s&aring; lille en <CODE>IOA</CODE>
heap som mulig b&oslash;r v&aelig;re den f&oslash;rste GC test. Derudover finder der en r&aelig;kke
programmer i <CODE>TST/misc</CODE>, som kan stresse GC'eren. Bl.a. skal man pr&oslash;ve 
<CODE>tstgc</CODE>, som stortset er <CODE>tst</CODE> med en l&oslash;kke omkring.
Link med <CODE>betarun.debug (-s 13)</CODE>, og check i debug udskrifterne tilsidst, at der
har v&aelig;re alle typer GC (led efter
<CODE>IOA#&lt;number&gt;</CODE> og <CODE>AOA#&lt;number&gt;</CODE> i
output). 
Hvis ikke kan <CODE>BETART</CODE> justeres, s&aring; man
trigger alle typer GC.

<P>
Efter afpr&oslash;vning af <CODE>tstgc</CODE> kan man pr&oslash;ve
hhv. <CODE>generalrep</CODE>, der bruger generelle repetitions til
at lave en ordsortering af en fil (skal gives som standard input), og
<CODE>simplerep</CODE>, der implementerer det samme med dynamiske
repetitions.

<H4>Unconditional GC</H4>

Et meget grundigt GC check kan laves vha <CODE>tst</CODE> ved
at linke med et betarun, der understøtter at der laves IOAGc i hver eneste
allokering.
Dette opnås ved at oversætte TST med <CODE>beta -s 80 tst</CODE>.
</UL>

Efter bygning <CODE>tst</CODE> s&aelig;ttes <CODE>BETART</CODE> til f.eks.
<CODE>IOA=50:DebugAll:CheckHeap:StopAtIllegal:InfoFile=tst.info</CODE>, og 
<CODE>tst</CODE> k&oslash;res - gerne fra en debugger (gdb) da der s&aring; kan
unders&oslash;ges variable etc. hvis der findes inkonsistens. Check om
den kommer helt igennem uden advarsler fra runtimesystemet, 
og om der kommer udråbstegn.
<P>
<EM>Bemærk:</EM> <CODE>hpux9pa</CODE> kan ikke køre igennen -s 80
testen; det vælter ud med warnings. Muligvis fejl i konsistenschecket.

<H3>Aftestning af beta.dump</H3>
I <CODE>TST/tstdump/</CODE> findes en r&aelig;kke programmer, som trigger alle kendte
fejlsituationer, som kan give beta.dump. Se kommentar i den enkelte fil for hvorledes
dumpet skal se ud, og se filer <CODE>README</CODE> for en oversigt over test programmerne.
<P>
Der er lavet et perl-script <CODE>run-all.perl</CODE>, der oversætter
og kører alle programmerne, samt differ deres dump filer op mod
et sæt korrekte dump filer. Dette burde virke på alle UNIX'er og windows.
Se i <CODE>README</CODE> for hvorledes status burde være for hver
platform.
<EM>Bemærk:</EM> Dumps bliver kun korrekte i forhold til reference
dumps, hvis de køres fra et TST/tstdump checket ud i
betarun/&lt;platform&gt;.
MEN under nye CVS struktur er det fra compiler/TST/tstdump, der skal testes!

<H2><A NAME="mjolner">Aftestning af Mjølnertool</A></H2>

<OL>
<LI>I treeview-delen af mjølnertoolet vælges et demo program (fx. beer)
<LI>Tryk <code>Build</code> og tryk derefter <code>Run</code>
<LI>Åbn et guienv program (fx. <code>promptsDemo</code>)
<LI>Tryk <code>Build</code> og <code>Run</code>
<LI>Tryk <code>GUI</code> og tilføj fx. en knap (men lad være med at gemme ændringerne)
<LI>Tilføj en ny linie med både syntaks og semantiske fejl (fx. 'hel->putlin) og check at mjølner
reagerer fornuftigt
<LI>Check <code>To Slot</code> og <code>Definition</code>, ved at klikke på <code>size</code>
<LI>Marker <code>&lt;&lt;SLOT windowitemLib:Attributes&gt;&gt;</code> og tryk <code>Definition</code>
<LI>Tryk <code>To Slot</code>
<LI>Byg et lille gui-program fra bunden
<LI>Åbn <code>demo/beta/recordLib</code>
<LI>Tryk på <code>UML</code> (hvis dette ikke er muligt så tryk først <code>Check</code>
</OL>


<H2><A NAME="valhalla">Aftestning af Valhalla (debugger del af mjolner)</A></H2>

<P>
<center> Valhalla<Br> Mjolner System Debugger<Br>
Draft pointwise testplan.<br>
</center>
</H1>
<P>
<u>
Try out the following:</u>
<nl>
<li>Open a project and press Debug
<li>Try "go until mark"  (find first statement)
<li>Try "go", should execute program to the end.
<li>Rerun (should close all stack & object windows )
<li>Try "Set breakpoint" + "go"
<li>Try "Set Tracepoint" + "go"
<li>Ensure that the breakpointlist in the Menu is correct.
<li>Set some breakpoint, save breakpoints. Leave Valhalla. Restart
Valhalla and try to load the breakpoints.
(FEJL: Den foreslåt intet filnavn til at gemme breakpoints i, og 
hvis man bare trykker Save crasher mjolner. 
Foreslag: skal forreslå &lt;filnavn&gt;.break og ikke crashe hvis
man kun peger på et directory)
<li>Leave valhalla. Touch the testprogram and recompile. Start
Valhalla and try to load the breakpoints. This should result in a
error msg. (FEJL: det giver fejlen for hvert breakpoint)
<li>Set som breakpoints on desc.-slots and do-parts.
<li>Try the three buttons: Object, Code,Stack. Browse. Try out the
right-button menu. 
<li>Try the stackbrowser in the windows menu.
<li>Edit-Menu: Try environment and commandline param.
<li>Use the TST/tstdump programs to ensure that Valhalla finds all runtime errors correct, with correct error messages. (see Peters remark:)
</nl>

<P>
<H3>Test all TST/tstdump programs</H3>
En rimelig bredt test kunne være at checke <CODE>TST</CODE> ud,
og oversætte <CODE>TST/tstdump/tstdump*.bet</CODE>. Disse er konstrueret
til aftestning af beta.dump i runtimesystemet, men kan også bruges til
aftestning af valhallas evne til at fange runtime fejl.
Der ligger en <CODE>README</CODE> fil, der viser hvilke typer fejl, der 
testes af de enkelte programmer.<BR>
For hver program startes dette under valhalla. Derpå konstateres om valhalla
stopper ved runtime fejlen. Og når valhalla er stoppet undersøges om current 
object og stakken ser korrekte ud.

<H3>Testing of evaluators in debuggee objects</H3>
Start valhalla as such (<EM>CURRENTLY NOT POSSIBLE!!!</EM>)
<PRE>
valhalla -bopt dynamiccompilation true &lt;debuggee&gt;
</PRE>
Then Go until e.g. a break point.
When debuggee is stopped, view current object.
Bring up the object-view menu by pressing the right mouse button
on the title bar of the object view.
In this menu select "Open Evaluator".
This brings up a simple text editor, which allows you to type in
a BETA pattern which can be evaluated in the context of the current object.
Try some different patterns:

<UL>

<LI>Simplest possible:
<PRE>
(# do 'hi'-&gt;putline #)
</PRE>

<LI>Using the current object:
<PRE>
(# do T[]-&gt;putline #)
</PRE>
(assuming <CODE>T</CODE> is a text visible from the current object)

<LI>Force GC in debuggee:
<PRE>
(# do '1'-&gt;put; (for 1000 repeat ''-&gt;puttext; for); '2'-&gt;put #)
</PRE>
Before this you may want to open the Environment Editor from the Edit
menu, specify that <CODE>BETART</CODE> for the debugge should have the value
<CODE>InfoAll</CODE>, and Rerun the program before typing in the above
evaluator. This will make the debuggee print out information about garbage
collection (in the shell, valhalla was started from). Garbage collection can also be triggered earlier if specifying <CODE>BETART: IOA=50:InfoAll</CODE>.
<BR>
<EM>Tip:</EM> The environment of the debbugge can also be specified at startup
by invoking valhalla as such:
<PRE>
valhalla -env BETART ioa=50:infoall -bopt dynamiccompilation true &lt;debuggee&gt;
</PRE>
or if you have linked with debug runtime system:
<PRE>
valhalla -bopt dynamiccompilation true -bopt debugvalhalla true -env BETART ioa=50:debugall:infoall:stopatillegal hello | &amp; tee lst
</PRE>


<LI>Several evaluators
<P>
Try using several evaluators in the same program run, with intermediate
stepping, breakpoint setting, stack viewing etc.

</UL>


<H2><A NAME="psbrowser">Aftestning af psbrowser</A></H2>

<EM>Bemærk: Dette fungerer KUN med den gamle persistens - der er ikke
lavet en ps-browser til nye implementation. Skal engang integreres i
mjolner.
</EM>

Pr&oslash;v at &aring;bne et persistent store vha Open.  Bem&aelig;rk
at det persistente store skal v&aelig;re genereret af et program, der
bruger objectbrowser/psbrowser/psfullnamepatch for at psbrowser
kan virke!

<H2><A NAME="meta">Aftestning af meta tools</A></H2>
Tag en kopi af mylang-meta.gram og k&oslash;r dogram p&aring; den:
dogram mylang
<P>
<EM>TODO</EM>

<H2><A NAME="pp">Aftestning af pp (standalone beta prettyprinter)</A></H2>
K&oslash;r programmet p&aring; en vilk&aring;rlig .bet fil:
pp foo.bet
<P>
<EM>TODO</EM>
Hvis man blot skriver pp foo, vil den begynde at parse,
det er vistnok en mps-fejl.
<H2><A NAME="utils">Aftestning af utils tools</A></H2>
<H3>betafs</H3>
K&oslash;r programmet p&aring; en vilk&aring;rlig .bet fil.<BR>
Se også <A HREF="http://www.mjolner.com/mjolner-system/documentation/manpages/betafs.html">Manual Side</A>.<BR>
<EM>TODO</EM>
<H3>betatar</H3>
K&oslash;r programmet p&aring; en vilk&aring;rlig .bet fil.
Evt. med parametrene: --full --list.
<BR>
Se også <A HREF="http://www.mjolner.com/mjolner-system/documentation/manpages/betatar.html">Manual Side</A><BR>
<EM>TODO</EM>
<H3>betawc</H3>
K&oslash;r programmet p&aring; en vilk&aring;rlig .bet fil
<P>
<BR>
Se også <A HREF="http://www.mjolner.com/mjolner-system/documentation/manpages/betawc.html">Manual Side</A>.<BR>
<EM>TODO</EM>


<H2><A NAME="demo">Aftestning af alle demoer</A></H2>

Dette foreg&aring;r fra f.eks. <CODE>BETALIB/demo/</CODE>.
Man kan f.eks. benytte f&oslash;lgende skema. Skriv det ud og
brug det til afkrydsning og notering af kommentarer for den enkelte
platform. Bem&aelig;rk, at nogle indgange ikke giver mening p&aring; 
alle platforme.
<P>
Bemærk også, at nogle run.demos scripts IKKE automatisk tester alle
programmer i current directory, og derfor skal checkes for om
eventuelle nye demoer skal integreres med ind i run.demos scriptet.
<P>
<A HREF="demochecklist.html">Demo Check Liste</A>


</BODY>
</HTML>
