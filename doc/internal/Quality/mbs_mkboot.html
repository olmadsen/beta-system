<HTML>
<link rel="stylesheet" href="../../style/miadoc.css" type="text/css">
<TITLE>How BETA track boot works</TITLE>
<BODY>

<h1>How BETA track boot works</h1>

<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#over">Overview</a>
<li><a href="#mbs_mkboot">The mbs_mkboot tool</a>
<li><a href="#betarun">Making incompatible changes to betarun</a>
<li><a href="#compiler">Making incompatible changes to the compiler</a>
<li><a href="#grammar">Making incompatible changes to the grammars</a>
</ul>

<h2><a name="intro"></a>Introduction</h2>

This document describes the thinking behind mbs_boottrack, and mbs_mkboot.
If you just want to boot a new BETA track, you should probably be reading
<a href="devsystem.html">devsystem.html</a> instead.  In fact, go and read
it anyway, then I don't have to repeat myself.

<h2><a name="over"></a>Overview</h2>

The BETA development system now contains enough executable and binary
files to allow it to boot itself out of CVS.  This means there is a
BETA compiler and a few grammar tools for each architecture.  For
Intel-based platforms there is also a copy of betarun, the runtime
system, in order that rungen, the RUN language compiler can be linked.
The details are <a href="devsystem.html">here</a> if you didn't already
read them.

<p>

Executables and other binary files take up a lot of space in the
repository, because they are stored in their entirety every time
they change.  For ASCII files, only the differences are stored.
A similar problem is that when updating, the entire binary file
must be updated if it has changed even a little bit.  This can
be frustrating on a slow internet connection.

<p>

For these reasons it is rather important that we only commit new
binary files in $BETALIB/boot when it is strictly necessary.

<h2><a name=mbs_mkboot></a>mbs_mkboot</h2>

If you need to put newer files in the $BETALIB/boot directory, the
relevant tool is mbs_mkboot.

<h3>mbs_mkboot when you have ported BETA to a new architecture or OS</h3>

If you have ported BETA to a new architecture or OS then congratulations!

<p>

You should now run mbs_mkboot on the new architecture, in order to copy
the boot files over into the $BETALIB/boot hierarchy.  Before putting
the files into CVS you need to test whether they will work, so make a
new empty track (either with a CVS command or with mbs_newtrack, which
will first check out the track, then fall over since it's a new architecture).
Copy the files from $BETALIB/boot to the new track, set BETALIB to point to
the new track, then try to run mbs_boottrack on the new track.

<p>

When this works, you should add the new files in $BETALIB/boot (remember
to use 'cvs add -kb' when adding binary files!). Then you can commit
them, and try to run mbs_newtrack all the way through.

<h3>mbs_mkboot when you need to update some files in $BETALIB/boot</h3>

If there are some files you need to update, then you can use
mbs_mkboot to copy just those files.  Remember, it is bad to
commit files that don't need updating.  Remember also that <b>mbs_mkboot
only copies files pertaining to the architecture it is started on!</b>

<h2><a name="betarun"></a>Making incompatible changes to betarun</h2>

If you make a change to betarun and the .beta files that means that
the rungen compiler can no longer be compiled with the <i>new</i> source
tree and the <i>old</i> verison of betarun, then you need to commit a new
version of betarun to the boot directory.  You do this with

<p>

mbs_mkboot -r

<p>

When you have placed the new betarun file in CVS you can test whether
it works with mbs_boottrack.  If it doesn't, you can always get back
to the old version by deleting the $BETALIB/boot/bin/arch/betarun.xxx
file and cvs updating to get it back.

<p>

mbs_mkboot only copies the betarun file from the current architecture
into $BETALIB/boot, not the betarun files from other architectures in
the same directory tree.

<h2><a name="compiler"></a>Making incompatible changes to the compiler</h2>

If you make a change to the compiler and BETA language that means the
boot compiler can no longer compile the current CVS source for itself
then you have to put a new compiler in the boot dir.  You do this
with:

<p>

mbs_mkboot -b

<p>

When you have placed the new beta file in CVS you can test whether
it works with mbs_boottrack.  If it doesn't, you can always get back
to the old version by deleting the $BETALIB/boot/bin/arch/beta
file and cvs updating to get it back.

<p>

mbs_mkboot only copies the beta compiler from the current architecture
into $BETALIB/boot, not the beta compiler from other architectures in
the same directory tree.

<p>

If your new compiler needs a new betarun to go with it, you will have
to <a href="betarun">commit a new version of betarun too</a>.

<h2><a name="grammar"></a>Making incompatible changes to the grammars</h2>

If you make some changes that mean the boot process needs new copies
of the tools gen (not rungen!), exbobs and tabc then you can move
them to $BETALIB/boot with

<p>

mbs_mkboot -g

<p>

and commit them.  In extreme cases you may have to change the
metagrammar-parser.bobs and move that with mbs_mkboot -m.  This
file is common between all architectures, since it is an ASCII
file.  There are no .ast files at all in CVS so they don't have
to be committed.

</BODY>
</HTML>
