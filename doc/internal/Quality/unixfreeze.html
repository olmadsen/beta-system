<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>

<HEAD>
<TITLE>Frysning af release til UNIX</TITLE>

</HEAD>

<BODY>
<H1>Frysning af release til UNIX</H1>


Frysning af et release til UNIX (her eksemplificeret af r5.2.1) på daimi
foregår følgende trin:

<OL>
<LI><A HREF="#mail">Send en mail</a> 
<LI><A HREF="#maskine">valg af maskine</A>
<LI><A HREF="#dirs">opremsning af directories</A>
<LI><A HREF="#version">opdatering af versionsnummer</A>
<LI><A HREF="#rebuild">Slå auto rebuild fra</A>
<LI><A HREF="#trace">Slå trace i compiler fra</A>
<LI><A HREF="#boot">Byg boot compiler</A>
<LI><A HREF="#comfix">Comlib fixes</A>
<LI><A HREF="#compile">oversættelse af libraries på alle platforme</A>
<LI><A HREF="#compiletools">oversættelse af tools på alle platforme</A>
<LI><A HREF="#aftestning">aftestning af Mjølner systemet</A>
<LI><A HREF="#clean">oprydning</A>
<LI><A HREF="#manual_gen">opdater genererede filer i documentation</A>
<LI><A HREF="#freeze">frysning</A>
<LI><A HREF="#pack">pakning af tar filer</A>
<LI><A HREF="#install">installering af /usr/local/lib/beta (studenternes BETALIB)</A>
<LI><A HREF="#tarfiles">udlægning af tar filer til FTP på mjolner</A>
<LI><A HREF="#cdlayout">Layout af CDROM til distribution</A>
<LI><A HREF="#hybrid">Bygning af hybrid CD image</A>
</OL>

<H2><a name="mail">Send en mail</a></H2>
Send en mail til <a href="mailto:mia-beta@mjolner.dk">mia-beta</a> med deadline for frysningen

<h2><a name="maskine">Valg af maskine</a></h2>
Vælg så vidt muligt en maskine med en ældre udgave af OS'et. 
Man kan søge efter maskiner af bestemt type ved f.eks.
<PRE>
/usr/local/bin/hosts -v | grep linux
</PRE>

Anbefalede maskiner: 
<OL>
<LI>rogue (RedHat 6.2)
<LI>ariel (Solaris 2.7)
<LI>dodeca (Sgi, IRIX6.5)
<LI>lisa (hppa, HP-UX 10)
</OL>

<h2><a name="boot">Bygning af boot compiler</a></h2>
Til bygning af bootcompileren (hvis den ikke er up-to-date) udfører man følgende kommandoer (på alle platforme): <BR>

<CODE>setenv BETALIB ~beta/r5.2.boot</CODE> <BR>
<CODE>mbs_rmast</CODE> <BR>
<CODE>mbs_cvsupdate</CODE> <BR>
<CODE>mbs_compiletools compiler</CODE> <BR>



<H2><A NAME="dirs">opremsning af directories</A></H2>
Til de følgende administrative ting benyttes nogle scripts, der
baserer sig på scriptet <CODE>$BETALIB/bin/admin/dirlist</CODE>,
der læser filern <CODE>$BETALIB/bin/admin/dirlist.txt</CODE>, 
indeholdende alle directories i current release.
<P>
&gt;&gt;&gt; MAN SKAL CHECKE AT <CODE>dirlist.txt</CODE> ER KORREKT INDEN MAN GÅR VIDERE.
<P>

<H2><A NAME="version">opdatering af versionsnummer</A></H2>
Check af <code>configuration/homeDirectories</code> er sat rigtigt. 
<p>
Se <CODE>basiclib/mbs_version.bet</CODE>
<p>
Der skal også rettes i<br>
<CODE>bin/admin/setup.rul.template</CODE>,<br>
<CODE>bin/admin/install_student_beta</CODE> og måske <br>
<CODE>bin/admin/env.perl</CODE>.

<P>
Ret også versionsnummeret i bitmap/objectbrowsers/mjolner-about.png.
Originalen til png filen ligger som en EPS fil i Adobe Illustrator 8
format:
<CODE>mjolner-about.eps</CODE>. Heri rettes tekster vha Illustrator 8,
derpå exporteres som <EM>GIF98a</EM> fil (ikke PNG) med adaptiv
palette, 256 farver og antialiasing slået til. Den resulterende gif
fil konverteres med et andet tool til PNG (xv3/GraphicConverter/...)
<P>

Ret versionsnummeret i toppen af <CODE>$BETALIB/doc/index.html</CODE>,
og i <CODE>$BETALIB/doc/readme/LICENCE.html</CODE> og
<CODE>$BETALIB/doc/readme/README.txt</CODE>
og sørg for at der er en indgang for versionen i
<CODE>$BETALIB/doc/manualerror/index.html</CODE>.

<P>

Ret RELEASE  i toppen af <CODE>$BETALIB/bin_unix/exectool</CODE>

<P>

Check/ret versionsnumre og datoer i
<code>$BETALIB/man/man1/*.1</code>.

<P>

Check/ret versionsnumre og årstal i toppen af hver fil i
<CODE>doc/*/*.book</CODE>

<P>

Ret "current release" i http://www.cs.au.dk/~beta/doc/Manuals/index.html

<p>Opdater evt.:<br>
<CODE>betarun/C/constant.h</CODE>,<br>
<CODE>debugger/processCommCodes.bet</CODE>,<br>

<H2><a name="rebuild">Slå auto rebuild fra</a></H2>

Ret i <CODE>~beta/.crontab.alex</CODE> og udfør <CODE>crontab
.crontab.alex</CODE> på alex som beta.

<H2><a name="trace">Slå trace i compiler fra</a></H2>

Snak med Ole.

<H2><A NAME="comfix">Comlib fixes</A></H2>

Man skal lave et specielt hack i IDL grammatikken, og derefter 
generere alle IDL filer til BETA i comlib:

<PRE>
cd $BETALIB/grammars/idl
perl do-idl-grammar.perl
cd $BETALIB/comlib
perl bidl-all.perl
</PRE>


<H2><A NAME="compile">oversættelse af libraries på alle platforme</A></H2>
For at oversætte bør man udføre følgende kommandoer: <BR><BR>

<code>setenv BETALIB ...</code> (skal pege på det spor man skal til at generere)<BR>
<code>mbs_cvsupdate</code><br>
<code>mbs_compiletools betarun</code> (Dette skal gøres på alle platforme)<br>
<code>mbs_rmcode sun4s linux sgi hpux9pa</code> (udføres kun på første platform)<BR>
<code>mbs_rmast</code> (udføres kun på første platform)<br>
(Det kan være en god ide (på sgi) at <code>unsetenv LD_LIBRARY_PATH</code> inden næste skridt)<BR>
<code>mbs_compiletools compiler</code> (Dette skal gøres på alle platforme)<br>
<code>mbs_compile >& log/mbs_compile.sgi</code>(Skal gøres på alle
platforme, hvor man erstatter fil-efternavnet med platformnavn)<Br>
Man man følge med i log filens udvikling ved
<CODE>tail -f log/mbs_compile.sgi</CODE><BR>
Når output siger at mbs_compile er færdig kill'es tail kommandoen blot.
<P>

Oversættelse foregår som vist ved at udføre scriptet
<CODE>mbs_compile</CODE> på alle
platforme. Scriptet kalder <CODE>dirlist</CODE> for at få en
liste af directories, med filer, der skal oversættes.

<p>
Efter oversættelse bør man kalde scriptet 
<CODE>mbs_checkdb</CODE>, som checker, at alle <CODE>.bet</CODE>
filer i releaset, som har en <CODE>.o</CODE> fil, også har en
<CODE>.db</CODE> fil (på alle platforme). Hvis man vil checke et
<EM>pakket</EM> directory kan man kalde den med <CODE>mbs_checkdb
&lt;dir&gt;</CODE> mens BETALIB er sat til at pege på et CVS
kontrolleret spor (et pakket spor indeholder ikke
<CODE>bin/admin/mbs_checkdb</CODE>, men det gør et CVS kontrolleret).

<H2><A NAME="compiletools">oversættelse af tools på alle platforme</A></H2>

Dette foregår med scriptet <CODE>mbs_compiletools -u</CODE> udført
på alle platforme.


<H2><A NAME="aftestning">aftestning af Mjølner systemet</A></H2>
Dette er beskrevet i <A HREF="betatest.html">betatest.html</A>.

<H2><A NAME="clean">oprydning</A></H2>

<EM>Det resterende skal først udføres når samtlige platforme på
filsystemet er førdigoversatte, som ovenfor beskrevet!</EM>
<P>
Inden frysning skal der fjernes det værste garbage i releaset.
Først kan man udføre 
<CODE>mbs_clean -f -r</CODE>, som fjerner alle 
<CODE>~</CODE>, <CODE>..job</CODE>, <CODE>..s</CODE>, <CODE>..gs</CODE>, <CODE>untitled*</CODE> , <CODE>.recentProject.pjt</CODE> filer i current release:

<PRE>
   mbs_clean -f -r
</PRE>

Dernæst skal man fjerne alt undtagen kildetekster i 
<CODE>BETALIB/demo/</CODE>:

<PRE>
   cd $BETALIB/demo/
   make clean
eller
   cd $BETALIB
   rm -rf demo
   mbs_cvsupdate
</PRE>

Dernæst bør man bygge man-pages (på ariel), samt checke at de ser ordentlige ud:

<PRE>
   cd $BETALIB/man
   make all
   setenv MANPATH $BETALIB/man
   man beta; man mjolner; ...
   man -k beta
</PRE>

Sluttelig kan man checke om alt i BETALIB, der er under CVS, er i sync
med de tilsvarende repositories:

<PRE>
   mbs_cvscheckupdate
</PRE>

Denne vil lave en <CODE>cvs -n update</CODE> i alle directories i
current release.


<H2><A NAME="manual_gen">opdater genererede filer og check links i dokumentation</A></H2>

<PRE>
cd $BETALIB/doc
make
</PRE>

(Bemærk at installations manualen refererer to directories, der hedder
<CODE>../utils/linux/</CODE> og <CODE>../utils/windows/GNU/</CODE>. 
Disse vil i et lokalt spor blive
rapporteret som forkerte links. Ignorer dette. Ofte vil eksterne links
også blive rapporteret forkerte. Dette skyldes ofte servere, der er nede)

<H2><A NAME="freeze">frysning</A></H2>

Dette foregår vha scriptet

<PRE>
$BETALIB/bin/admin/mbs_cvstag 
</PRE>

<p>der giver alle CVS moduler i current release et fast tag.

<p>Du skal også opdatere <CODE>Quality/releases.html</CODE> med kort
beskrivelse af det pakkede spor, såsom tag navn, og compiler release
nummeret.

<p>Selve frysningen består i at skrivebeskytte alle de filer og
directories, der indgår i releaset. Man benytter scriptet 
<PRE>
   $BETALIB/bin/admin/mbs_freeze
</PRE>
der gør det rigtige.

<H2><A NAME="pack">pakning af tar filer</A></H2>

Dette foregår ved først at checke filerne i 
<CODE>$BETALIB/export/files/</CODE>
der beskriver hvad der skal pakkes for hvert library.<br>

<P>
Check herefter at BETASTAT=no og BETAREPORT=no i $BETALIB/bin/*.  Selvom
stat skal slåes til i den installerede udgave på daimi, bør det ikke
pakkes som sådan, da andre brugere ikke nødvendigvis vil have det sådan.

Dernæst udføres (på ariel):

<PRE>
   cd $BETALIB/export/dotar
   ./MakeAllPE
</PRE>

som pakker alle platforme, eller (fx. til prøvepakning) 

<A NAME="pack_specific"></A>
<PRE>
   cd $BETALIB/export/dotar
   ./sgi.dotar -pe 
</PRE>

som pakker til en specifik platform (her sgi).

<P>
Se <A HREF="betapack.html#unixpack">Pakning af systemer/delpakker til
UNIX</A> for detaljer.

<P>
CHECK efterfølgende for eksistens af
<CODE>$BETALIB/export/tarfiles/*/errors.lst</CODE>. 
Hvis sådanne findes indikerer det problemer med pakning - check hvad
der rapporteres deri.

<H2><A NAME="install">installering i /usr/local/lib/beta (studenternes BETALIB)</A></H2>

Man udlægger nemmest nye ting til studenterne ved at placere sig i 
<CODE>/usr/local/lib/beta/r5.2.2a</CODE> (directorynavnet bør svare
til det, sporet er tagget med) og så pakke een eller flere af de
ovenfor pakkede tar-filer ud herfra.
<P>
Man kan bruge scriptet <CODE>$BETALIB/bin/admin/install_student_beta</CODE> til det. Bliv ikke bange hvis scriptet skriver <code>cannot create -- Permission denied</code> en masse gange.
<P>
Når man har installeret skal man ESS oprette statistik på Mjølner.  Se
<a href=statistik.txt>statistik.txt</a> for detaljer.
<P>
Check herefter om directories
<CODE>$BETALIB/lib{sgi,sun4s,linux,hpux9pa}</CODE> er blevet skabt.
Hvis ikke, så skab dem i hånden.
<P>
Når sporet er konstateret klar til brug for de studerende skal
<CODE>current</CODE>
linket i <CODE>/usr/local/lib/beta</CODE> flyttes til at pege på det
nyinstallerede directory. Og dernæst udsendes en nyhed på
<CODE>daimi.beta</CODE> og andre relevante daimi-nyhedsgrupper.
Heri skal bl.a. stå at man bør slette sine AST filer. Eksempel:

<BLOCKQUOTE>
<TABLE border=1>
<TR>
<TD>
<PRE>
<B>Newsgroups</B>: daimi.beta,daimi.dekspsys,daimi.dpass
<B>Subject</B>: New version of the Mjølner System installed

A new version, r5.2.2c, of the Mjølner System has been installed
on Daimi's Linux and Solaris machines. 

&lt;evt begrundelse for den nye install&gt;

In order not to mix compilations from the old and the new
release of the Mjølner system it is a good idea to remove old
AST files from existing BETA projects.  This can be done with
the command:

  find directoryname -name \*.ast\* | xargs rm -i

Please report bugs to support@mjolner.dk

The release will be made available for download for home computers 
in a few days.
</PRE>
</TD>
</TABLE>
</BLOCKQUOTE>

<P>
Check også siden

<BLOCKQUOTE>
<A HREF="http://www.cs.au.dk/~beta/Daimi/">/users/beta/public_html/Daimi/index.html</A>
</BLOCKQUOTE>

og sørg også for at dokumentationen i

<BLOCKQUOTE>
<A HREF="http://www.cs.au.dk/~beta/doc/">/users/beta/public_html/doc</A>
</BLOCKQUOTE>

er up-to-date, samt er genereret med BETALIB sat til det nyeste
release, som beskrevet i "<A HREF="#manual_gen">opdater genererede filer og check links i dokumentation</A>"
<P>


Ved samme lejlighed bør man opdatere 

<BLOCKQUOTE>
<A HREF="http://www.cs.au.dk/~beta/Daimi/download/">/users/beta/public_html/Daimi/download</A>
</BLOCKQUOTE>

ved at placere tar/exe/sit filer i et
underdirectory svarende til release nummeret, samt opdatere
<CODE>index.html</CODE> tilsvarende.
Se <A HREF="cd-layout.txt">cd-layout.txt</A> for skitse af directory layoutet.
<P>

<a name="daimi_download">
Dette kan man så offentliggøre ved at sende en nyhed på
<CODE>daimi.beta</CODE> og den/de relevante kursus-nyhedsgrupper a la
</a>

<BLOCKQUOTE>
<TABLE border=1>
<TR>
<TD>
<PRE>
<B>Newsgroups</B>: daimi.beta,daimi.dekspsys,daimi.dpass
<B>Subject</B>: Re: New version of the Mjølner System installed

It is now possible to get the Mjølner System for your home computers.

The packages for individual platforms can be found on

http://www.cs.au.dk/~beta/Daimi/download/

There is also a hybrid ISO CD image available from there, in case you want
to burn a CD at DAIMI containing the system (includes the platforms: windows
GNU, windows MS, linux, macintosh, sun).
</PRE>
</TD>
</TABLE>
</BLOCKQUOTE>



<H3><A NAME="tarfiles">Udlægning af tar filer til FTP på mjolner</A></H3>
 Filerne placeres i <CODE>~ftp/BETA</CODE> med samme layout som
på daimi, som beskrevet i <A HREF="cd-layout.txt">cd-layout.txt</A>.
Kopier evt. blot hele directoriet over fra daimi.

<H3><A NAME="cdlayout">Layout af CDROM til distribution</A></H3>
 
Filerne placeres med samme layout som
på daimi, som beskrevet i <A HREF="cd-layout.txt">cd-layout.txt</A>.
Kopier evt. blot hele directoriet over fra daimi eller brænd CD images
direkte fra FTP arealet (se ovenfor).

<H3><A NAME="hybrid">Bygning af hybrid cd image</a></h3>

<EM>Kun relevant, hvis der er macintosh filer med på CD'en!</EM>
<P>

Bygning af hybrid cd image foretages på linux maskinen ran vha programmet
<code>mkhybrid</code>:

<ol>
<li>først kopieres unix og pc filerne til ran vha f.eks. ftp.
Placeres f.eks. i <CODE>~beta/Deliveries/r5.2.2a</CODE>
<LI>dernæst skal macintosh filerne overføres. Dette gøres <EM>fra</EM>
en macintosh: RAN kører en service, der hedder <CODE>netatalk</CODE>,
som gør at man kan connecte til den vha AppleTalk. Så fra Macen vælger
man <CODE>Chooser</CODE> fra Apple-menuen (øverste venstre hjørne), og
vælger inde i <CODE>Chooser</CODE> ikonet <CODE>AppleShare</CODE>. 
Hvis ikke RAN fremkommer i listen over AppleTalk servere, så vælges
knappen <CODE>Server IP Address</CODE>. Heri indtastes IP nummeret (pt
<CODE>10.0.0.26</CODE>). Herefter logges ind som <CODE>beta</CODE>, og
man skifter directory til <CODE>Deliveries/r5.2.2a</CODE>.
Så kopieres Mac folderen <CODE>Mac</CODE> over ved alm. drag-and-drop.
<LI>På RAN checkes derefter for at der KUN ligger directories med navn
<CODE>.AppleDouble</CODE> i <CODE>Mac</CODE> directoriet.
<LI>På RAN udføres derefter kommandoen fra directory <CODE>Deliveries</CODE>:
<PRE>
mkhybrid -J -A 'Mjolner System r5.2.2a' -V 'Mjolner System r5.2.2a' \
-P 'Mjolner Informatics' -r -hfs -map ~beta/.mkhybrid.map --netatalk    \
-o ~beta/r5.2.2a-hybrid.iso r5.2.2a/
</PRE>
der bygger <CODE>~beta/r5.2.2a-hybrid.iso</CODE>, der er klar til brænding.
</OL>


</BODY>
</HTML>

