<H1>Mjølner BETA Low Level Primitives</H1>

<UL>
<LI><A HREF="#intro">Introduction</A></LI>
<LI><A HREF="#lowlevel">Low Level Operations</A></LI>
<LI><A HREF="#syntax">Syntax</A></LI>
<LI><A HREF="#addressing">Addressing Conventions</A></LI>
<LI><A HREF="#operations">Operations</A></LI>
<UL>
<LI><A HREF="#not">Bitwise logical complement (one's complement)</A></LI>
<LI><A HREF="#and_or_xor">Bitwise logical and, or, exclusive or</A></LI>
<LI><A HREF="#shift">Shift of a long</A></LI>
<LI><A HREF="#get">Get byte/short from a long</A></LI>
<LI><A HREF="#put">Put byte/short into a long</A></LI>
<LI><A HREF="#getbits">Get bits from a long</A></LI>
<LI><A HREF="#putbits">Put bits into a long</A></LI>
<LI><A HREF="#thiss">This object</A></LI>
</UL>
</UL>

<H2><A NAME="intro">Introduction</A></H2>

This document describes the semantics of the low-level
primitives available in the Mjølner implementation of the BETA
language.  
There are currently some syntactic
inconveniences.  
These may be fixed with a grammar change in a future version.

<H2><A NAME="lowlevel">Low Level Operations</A></H2>

Low level operations on bits, bytes and words are available as
described below. Use of these operations may in general be platform
dependent. 

<H2><A NAME="syntax">Syntax</A></H2>

The syntax is as follows

<BLOCKQUOTE>
<BETA>
%op
</BETA>
</BLOCKQUOTE>
        
i.e., the <CODE>%</CODE> indicates, that <CODE>op</CODE>
is a special low-level operation.
<P>
In the following, <CODE>E</CODE>, <CODE>val</CODE>, and
<CODE>inx</CODE>
are assumed to be integer evaluations, 
<CODE>A</CODE> is an integer object, and <CODE>R</CODE>
is a repetition object.


<H2><A NAME="addressing">Addressing Conventions</A></H2>

The addressing conventions of bytes, words, longs and bitfields follow
the big-endian (Motorola, SPARC etc.) conventions:

<P>
<TABLE align=center border=1 bgcolor="white">
<TR>
<TD>
<PRE class=opaque>

   |------------------------------------------------------------|  
   |31                         long[0]                         0|  
   |-----------------------------|------------------------------|  
   |15         word[0]          0|15          word[1]          0|  
   |--------------|--------------|--------------|---------------|  
   |7   byte[0]  0|7   byte[1]  0|7   byte[2]  0|7   byte[3]   0|  
   |--------------|--------------|--------------|---------------|  
    0                                                         31   
    BitOffset Big-endian --&gt;
                                     BitOffset Little-endian &lt;--

   |              |              |              |        
   BaseAddr       BaseAddr+1     BaseAddr+2     BaseAddr+3
</PRE>
</TD>
</TABLE>
<P>

Notice that a BitOffset is addressed from the most significant bit
on big-endian architectures, and from the the least significant bit
on little-endian architectures (<CODE>nti</CODE>, <CODE>linux</CODE>).

<H2><A NAME="operations">Operations</A></H2>

The following operations are available.

<H3><A NAME="not">Bitwise logical complement (one's complement)</A></H3>

<BLOCKQUOTE>
<BETA>
OP:      %Bnot 
usage:   %Bnot E
</BETA>
</BLOCKQUOTE>

<H3><A NAME="and_or_xor">Bitwise logical and, or, exclusive or</A></H3>

<BLOCKQUOTE>
<BETA>
OP:     %Band, %Bor, %Bxor
usage:  E1 OP E2
ex:     E1 %Band E2
</BETA>
</BLOCKQUOTE>

Note the <CODE>B</CODE> in these operations - B stands for bitwise.
A future version may use the syntax <CODE>%and</CODE>.

<H3><A NAME="shift">Shift of a long</A></H3>

<BLOCKQUOTE>
<BETA>
OP:     %srl       shift right logical
        %sll       shift left logical
        %sra       shift right arithemetic 
        %sla       shift left arithemetic 
        %ror       rotate right
        %rol       rotate left
usage   E1 OP E2
ex:     E1 %sll E2
</BETA>
</BLOCKQUOTE>


<H3><A NAME="get">Get byte/short from a long</A></H3>

<BLOCKQUOTE>
<BETA>
OP:     byteNo  -> A.%getByte
        shortNo -> A.%getShort
        longNo  -> A.%getLong
        byteNo  -> A.%getSignedByte 
        shortNo -> A.%getSignedShort
</BETA>
</BLOCKQUOTE>

where <CODE>byteNo</CODE> is an integer-evaluation in [0,3], 
<CODE>shortNo</CODE> in [0,1] and
<CODE>longNo</CODE> in [0]. <BR>

<BLOCKQUOTE>
<BETA>
Usage:  E1 -> A1.%getByte -> A2
Ex:     1 -> A.%getByte -> B
</BETA>
</BLOCKQUOTE>

<P>
Note: <CODE>byteNo -> A.%getLong</CODE> is the same as <CODE>A</CODE>.


<H3><A NAME="put">Put byte/short into a long</A></H3>

<BLOCKQUOTE>
<BETA>
OP:     (val,byteNo)  -> A.%putByte
        (val,shortNo) -> A.%putShort
        (val,longNo)  -> A.%putLong
</BETA>
</BLOCKQUOTE>

The same restrictions for <CODE>byteNo</CODE> etc. as in
<A HREF="#get">Get byte/short from a long</A> apply here.

<BLOCKQUOTE>
<BETA>
usage:  (val,E) -> A.OP
ex.:    (val,3) -> A.%putByte        
</BETA>
</BLOCKQUOTE>

The same restrictions for <CODE>byteNo</CODE> etc. as in
<A HREF="#get">Get byte/short from a long</A> apply here.

<P>
Note: <CODE>(val,E)->A.%putLong</CODE> is the same as <CODE>val->A</CODE>.

<H3><A NAME="getbits">Get bits from a long</A></H3>

<BLOCKQUOTE>
<BETA>
OP:     (pos,width) -> A.%getBits
        (pos,width) -> A.%getSignedBits
</BETA>
</BLOCKQUOTE>

where <CODE>pos</CODE>, <CODE>width</CODE> in [0,31] are integer-evaluations.

<BLOCKQUOTE>
<BETA>
usage: (pos,width) -> A.%getBits -> V
</BETA>
</BLOCKQUOTE>

<H3><A NAME="putbits">Put bits into a long</A></H3>

<BLOCKQUOTE>
<BETA>
OP:     (val,pos,width) -> A.%putBits
</BETA>
</BLOCKQUOTE>

where <CODE>pos</CODE>, <CODE>width</CODE> in [0,31] are integer-evaluations.

<BLOCKQUOTE>
<BETA>
usage:  (V,12,4) -> A.%putBits
</BETA>
</BLOCKQUOTE>

<H3><A NAME="thiss">This object</A></H3>

Note: This operation is needed in some cases where <CODE>THIS(P)</CODE> cannot
be used. E.g. inside singular objects in the do-part.<BR>
Notice that <CODE>THIS(Object)</CODE> will NOT work, you must use the
operation below:

<BLOCKQUOTE>
<BETA>
OP:     %thiss object
</BETA>
</BLOCKQUOTE>

A reference to the current object is returned.

<BLOCKQUOTE>
<BETA>
Usage:  %thiss object -> S[]
</BETA>
</BLOCKQUOTE>

where <CODE>S</CODE> is declared as <CODE>S: ^Object</CODE>.

<!--++++++++++++++++++++++++++++++-->

