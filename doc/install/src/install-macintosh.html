<H1>Installation guide for Power Macintosh</H1>

<H2>The Mj&oslash;lner System on Macintosh</H2>

<P> This page describes how to install and get started using the
Mj&oslash;lner System on Macintosh.</P>

<H3>MPW</H3>

<P> The current version of the BETA compiler on the Macintosh is
available as part of the mjolner tool 
(<A HREF="../bibliography/index.html#mia99-39">[MIA 99-39]</A>,
<A HREF="../bibliography/index.html#mia99-40">[MIA 99-40]</A>,
<A HREF="../bibliography/index.html#mia99-34">[MIA 99-34]</A>)
and as an MPW tool. MPW stands for <EM>Macintosh Programmers
Workshop</EM>, which is the official programming environment for the
Macintosh, developed by Apple, Inc. 
The BETA compiler runs as an MPW tool, that is, it is a command, that
can be invoked from the MPW Shell (command interpreter). </P>

<P> MPW 3.4 or later is needed to use BETA.  In addition to the MPW
Shell, the compiler uses the MPW <CODE>PPCLink</CODE> and
<CODE>Rez</CODE> tools to build the programs.</P>

<H2>Requirements</H2>

<UL>
<LI>
Power Macintosh (or Performa with RISC processor)
<LI>
MacOS 7 or 8
<LI>
40 MB memory recommended.
<LI>
At least 60-100 MB disk space (depending on the size of the harddisk,
if a HFS partition)
<LI>
MPW 3.4 or later
</UL>


<H2>Installation</H2>

<H3>Unpack</H3>
<P> This distribution is stored as a self-extracting archive. To
install the Mj&oslash;lner System, double-click the self-extracting
archive.</P>

<H4> Configuring the Files</H4>

<P> After the <CODE>beta5.0</CODE> folder is installed you need to move the file
<CODE class=chicago>UserStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">beta</CODE> 
in the <CODE>beta5.0</CODE> folder to the MPW folder (the folder containing the MPW
Shell). <BR>
The purpose of 

<CODE class=chicago>UserStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">beta</CODE> 

is to set up the environment used by The Mj&oslash;lner System. <BR>
When starting MPW the first time after you moved 

<CODE class=chicago>UserStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">beta</CODE> 

to the MPW folder, you will be asked to select the beta folder (<CODE>beta5.0</CODE>). 
The position of the beta folder will be remembered afterwards using
the file 

<CODE class=chicago>BetaStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">Home</CODE> 

in the MPW folder. If this file is deleted or you move or rename the
beta folder you will be prompted for the beta folder again.  

<P>

During the first startup 

<CODE class=chicago>UserStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">beta</CODE> 

also creates the file 

<CODE class=chicago>BetaStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">Menu</CODE>.
<BR>
In 

<CODE class=chicago>BetaStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">Menu</CODE> 

the <CODE CLASS=chicago>&szlig;</CODE> menu is defined as described below. You can modify
this file to suit your specific needs. <BR>
In case it is deleted a new standard 

<CODE class=chicago>BetaStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">Menu</CODE> 

is created during the next startup of the MPW.</P>


<H2>Macintosh Specific Issues</H2>

<H3>Using MPW - Macintosh Programmers Workshop</H3>
<P> This section briefly describes how to use <INX>MPW</INX> for compiling and running BETA applications.</P>

<P>As mentioned above, MPW is a program development environment for
the Macintosh computers with tools for editing, compilation and
execution of e.g. BETA programs. MPW is a command driven interface to
the Macintosh operative system (analogous to the UNIX shell).</P>


<P> MPW is centered around the concept of a <INX>worksheet</INX>, where the commands are entered and thereafter
executed. A worksheet saves its contents from session to session and
can therefore be used to contain the most often used commands such
that they can be easily executed in later sessions. The commands in
the worksheet can be edited using the usual Macintosh editing
facilities
<FOOTNOTE>Please see your Macintosh manuals for how to use your
Macintosh</FOOTNOTE>.


<P> Commands can be executed from the worksheet in two different
ways:</P>

<OL>
<LI> The text cursor is placed somewhere in the command line and the
<INX>Enter key</INX>
<FOOTNOTE>
The Enter key is located in the lower right corner of the numeric
keypad. Pressing the Return key will just insert a carriage return
</FOOTNOTE>
is pressed. The entire line will then
be executed as one command.

<LI> Some text may be selected and the Enter key is pressed. The selected text will then be executed as one command.
</OL>

<P> When starting MPW after installation, an environment is set up to
make it easy to use the BETA system. The BETA compiler can be executed
either using the script beta or by using the special 
<CODE class=chicago>&szlig;</CODE> 
menu.</P>

<P> Notice that you only need to activate the BETA compiler on the
program fragment that constitutes the application. If the program
fragment uses other fragments (libraries), these are automatically
included by the compiler and linker. If some fragments have been
changed since the last compilation, these fragments will automatically
be recompiled.</P>

<INX HIDDEN>&szlig; Menu</INX>
<H4>The <CODE class=chicago>&szlig;</CODE> Menu</H4>



<P> The BETA environment defines a 
<CODE class=chicago>&szlig;</CODE> 
menu containing items which makes it easy to use the BETA
compiler.</P>

<P> The items are:</P>

<DL>
<DT><INX><STRONG CLASS=macmenuitem>Compile {Active}</STRONG></INX> 
<DD>Compile the front most window
<DT><INX><STRONG CLASS=macmenuitem>Recompile</STRONG></INX>
<DD>Compile the previously compiled file again
<DT><INX><STRONG CLASS=macmenuitem>Compile File...</STRONG></INX> 
<DD>Prompts the user for a file, and compiles the selected file
<DT><INX><STRONG CLASS=macmenuitem>Execute</STRONG></INX> 
<DD>Execute the last compiled file
<DT><INX><STRONG CLASS=macmenuitem>Open Fragment</STRONG></INX> 
<DD>Tries to open the selection. The selection is treated as a BETA
file name, e.g. <CODE>~beta/guienv/guienv</CODE>
<DT><INX><STRONG CLASS=macmenuitem>Directory {Active}</STRONG></INX> 
<DD>Changes directory to the location of the file shown in the front most window
<DT><INX><STRONG CLASS=macmenuitem>-Application</STRONG></INX> 
<DD>Compile the BETA program as an application (default)
<DT><INX><STRONG CLASS=macmenuitem>-Tool</STRONG></INX> 
<DD>Compile the BETA program as an MPW Tool
</DL>

<P> In most cases, the <CODE CLASS=chicago>&szlig;</CODE> menu defines
the necessary interface to the BETA compiler. However, the advanced
user may prefer to use the beta script instead, please see <A
HREF="../bibliography/index.html#mia90-02">[MIA 90-02]</A> for legal
options etc.</P>

<P> When selecting <CODE CLASS=chicago>Compile {Active}</CODE> the
beta script is invoked with the active window as argument. The script
first executes the BETA compiler and then executes the job file
generated by the compiler. The job file links the compiled
application. Output during compilation is directed to a separate MPW
window.</P>

<H5> Application and Tool</H5>

<P> The options <CODE CLASS=chicago>-Application</CODE> and <CODE
CLASS=chicago>-Tool</CODE> specify whether the generated application
should be a Macintosh stand-alone application or an <INX>MPW
tool</INX>. 
The default is that the application is linked
as a Macintosh stand-alone application. If a BETA program uses the
input/output streams <CODE>keyboard</CODE> and <CODE>screen</CODE> in
<CODE>betaenv</CODE> and is executed as a stand-alone Macintosh
application, a simple console window is opened. The input/output
stream is redirected to this window. The console also defines the
standard File and Edit menus. The Cut, Copy, and Paste items in the
Edit menu are available.</P>

<P> The execution can be stopped by selecting Quit in the console File
menu.</P>

<P> Notice, that if the program is using <INX>GuiEnv</INX>, it must be compiled as a 
<INX>stand-alone application</INX>. The input/output is in this case
redirected to a special GuiEnv window.</P>

<H4> Free Download of MPW</H4>

<P> October 1997, Apple Computer, inc decided to make MPW freely
available for downloading. It can be downloaded from</P>

<BLOCKQUOTE>
<A HREF="ftp://dev.apple.com/devworld/Tool_Chest/Core_Mac_OS_Tools/MPW_etc./MPW-GM_Images/MPW-GM.img.bin">
<CODE>ftp://dev.apple.com/devworld/Tool_Chest/Core_Mac_OS_Tools/MPW_etc./MPW-GM_Images/MPW-GM.img.bin</CODE>
</A>
</BLOCKQUOTE>

<P> The above MacBinary Disk Copy archive contains the two folders</P>

<UL>
<LI>MPW
<LI>Interfaces&amp;Libraries
</UL>

<P> Please notice, that new versions may be available when you read this.</P>


<H4>CodeWarrior MPW</H4>
<P> As an alternative to Apple's MPW,  an MPW package is included in
the <INX>MetroWerks CodeWarrior</INX> package.
Information about MetroWerks can be found at</P>

<BLOCKQUOTE>
<A HREF="http://www.metrowerks.com">
<CODE>http://www.metrowerks.com</CODE>
</A>
</BLOCKQUOTE>

<P> Information about MetroWerks CodeWarrior can be found at</P>

<BLOCKQUOTE>
<A HREF="http://www.metrowerks.com/desktop/mac_os/">
<CODE>http://www.metrowerks.com/desktop/mac_os/</CODE>
</A>
</BLOCKQUOTE>

<H5>Additional Configuration for CodeWarrior MPW</H5>

<P> Using the CodeWarrior version requires additional
configuration. The name of the CodeWarrior link tool is
<INX><CODE>MWLinkPPC</CODE></INX>, whereas the name of
the linker in the MPW from Apple is <CODE>PPCLink</CODE>. The BETA
compiler must be instructed to use the <CODE>MWLinkPPC</CODE> tool
instead. This is done by inserting the following line in a MPW
UserStartup file:</P>

<beta>
set -e betaopts -s 70
</beta>

<P> A MPW UserStartup is a file with a name like 

<CODE class=chicago>BetaStartup<IMG SRC="bullet.gif" WIDTH=5 HEIGHT=5 ALT=""*"">Smith</CODE> 

located in the MPW folder. </P>

<P> An alternative method is to rename the <CODE>MWLinkPPC</CODE> tool to <CODE>PPCLink</CODE>.</P>


<H3>Getting started on Macintosh</H3>
<P> The following steps are usually performed when working with BETA
programs under MPW: </P>

<OL>
<LI>MPW is started by double clicking the MPW Shell icon or on a BETA
source file (<CODE>.bet</CODE>). This opens MPW with the worksheet
document in a window.

<LI> We now edit the BETA program text. This may be initiated in two
different ways:

<OL type="a">
<LI>We open an existing BETA file by selecting the 
<CODE class=chicago>Open...</CODE> 
entry in the 
<CODE class=chicago>File</CODE> 
menu. Or
<LI>We create a new file for the BETA program by selecting the 
<CODE class=chicago>New...</CODE> 
entry in the 
<CODE class=chicago>File</CODE> 
menu. The file name must end with <CODE>.bet</CODE>.
</OL>

<LI> Now edit the file using the ordinary Macintosh editing facilities
in the window containing the program.

<LI> Save the changed BETA program using the 
<CODE class=chicago>Save</CODE> 
entry in the 
<CODE class=chicago>File</CODE> 
menu.

<LI> Select <CODE class=chicago>Compile {Active}</CODE> in the 
<CODE class=chicago>&szlig;</CODE> menu.

<LI> Messages will now be written in the 
<CODE class=chicago>{MPW}:compilerOutput</CODE> 
window. These messages
informs about the progress of the compilation, and eventually about
syntactic and semantic errors.

<LI> The program may now be executed by selecting 
<CODE class=chicago>Execute</CODE> 
in the <CODE class=chicago>&szlig;</CODE> menu.

<LI> Close MPW using the 
<CODE class=chicago>Quit</CODE> 
entry in the 
<CODE class=chicago>File</CODE> 
menu 

</OL>

<P>Steps 3, 4, 5 and 7 may be repeated over and over, while making changes to the same program.</P>

<H3><INX>Memory Requirements</INX> </H3>

<H4>Memory Requirements to MPW Shell</H4>

<P> To ensure proper workings of MPW and the BETA compiler, you should
ensure, that enough memory is allocated for MPW. 
</P>
<P>
In order to run the
BETA compiler at least 15 MB of memory must be allocated to the MPW
Shell. The amount of memory can be set by selecting the MPW Shell icon
and using the 
<CODE class=chicago>Show Info</CODE> 
command in the Finder as illustrated in the
figure below:</P>

<P> </P>
<CENTER> 
<IMG ALIGN=TOP WIDTH=354 HEIGHT=401 SRC=MPW-info.gif ALT="MPW Shell Info: Memory: Preferred Size: 15000K">
</CENTER>
<P> </P>

<P> More memory allocated to MPW makes the compiler and especially the
linker run faster.</P>

<H4>BETA Application Memory Requirements</H4>

<P> You may also have to increase the memory requirements of a
compiled BETA application (1.5 MB for a BETA application). This is
done likewise by selecting the BETA application, and then use the 
<CODE class=chicago>Show Info</CODE> 
command in the Finder.</P>

<H3>Errors and Configuration</H3>

<H4>Memory Allocation Errors</H4>

<P> When compiling programs or running BETA applications, memory is
allocated when needed. During compilation memory is allocated in the
MPW heap and during execution of BETA applications memory is allocated
in the application heap. In case the execution runs out of memory, one
of the following messages can appear:</P>

<UL>
<LI> <INX><CODE>IOA heapspace full</CODE></INX>
<LI> <INX><CODE>Couldn't allocate ToSpace</CODE></INX>
<LI> <INX><CODE>Couldn't allocate IOA</CODE></INX>
</UL>

<P> You will then have to increase the memory heap as described
above.</P>

<H4><INX>Virus detectors</INX></H4>

<P> Some virus detectors (e.g. Vaccine and Gatekeeper) do not allow
MPW to operate correctly. Gatekeeper complains during compilation of a
BETA program. Vaccine does not complain but causes MPW to run
erroneously, typically to hang. Therefore Vaccine and Gatekeeper must
be configured to accept MPW.</P>

<H4>Problems with Memory</H4>
<P> In case the system is unable to launch an application from MPW,
the problem might be lack of memory. A solution could be to exit MPW
and activate the application from the Finder by double-clicking on the
application icon.</P>

<H4>Directories in Fragments</H4>

<P> 
<IMG SRC="../images/handright.gif" ALT="Notice!" width=24 height=13 align=left>
Please notice, that directories in <CODE>ORIGIN</CODE>,
<CODE>INCLUDE</CODE> etc. in fragments must be specified using the
<INX>UNIX directory syntax</INX>. That is, the Macintosh
file:</P>

<BETA>
{betalib}guienv:guienv.bet
</BETA>

<P> must e.g. in an <CODE>ORIGIN</CODE> property of a fragment be
specified as:</P>

<BETA>
ORIGIN '~beta/guienv/guienv'
</BETA>

<P> 
<IMG SRC="../images/handright.gif" ALT="Notice!" width=24 height=13 align=left>
Please also note, that <CODE>~beta/</CODE> is used instead of <CODE>{betalib}</CODE>.
</P>



<H3>Accessing the Macintosh Toolbox from BETA</H3>

<P> Programming the Macintosh is done through the <INX>Toolbox</INX>. The Toolbox includes a large number of routines
and they are all documented in <INX>Inside Macintosh</INX>. There exists a BETA interface to most of these
routines such that they can be used in a BETA program. </P>

<P> The fragment <CODE>maclib</CODE> in file
<CODE>{betalib}maclib:maclib</CODE> contains this toolbox
interface.</P>

<H4>BETA extensions to the Toolbox</H4>

<P> Object oriented extensions to the interface to the Macintosh
Toolbox have been built in order to make it possible to program the
Macintosh in 'the BETA way.' Using purely Toolbox interface routines
from BETA forces you to program in a Pascal-like fashion.</P>

<P> The fragments in the folder <CODE>{betalib}guienv:</CODE> contain
an environment (<INX>GuiEnv</INX>) where windows, text
editors, dialogs, menus, etc. have been lifted to 'real' BETA patterns
with an object oriented interface.</P>

<P> The GuiEnv environment is documented in 
<A HREF="../bibliography/index.html#mia95-30">[MIA 95-30]</A>
</P>

<!--
The Toolbox interface is documented in 
A HREF="../bibliography/index.html#mia90-10"[MIA 90-10]/A
-->

<P> The folder <CODE>{betalib}demo:maclib:</CODE> contains demo
programs using the Toolbox interface and the folder 
<CODE>{betalib}demo:guienv:</CODE> contains demo
programs using the object oriented extensions.</P>

<H3>Adding Resources to Applications built with the BETA
Compiler</H3>

<P> You may use macintosh resource files in your application. You do
this by specifying a <INX><CODE>RESOURCE</CODE> property</INX>, e.g.</P>

<BETA>
ORIGIN '~beta/basiclib/betaenv';
RESOURCE ppcmac 'foo.r;
-- program: descriptor --
(# do ... #)
</BETA>

<P> The BETA compiler will automatically compile all the resources in
<CODE>foo.r</CODE> into the application.  The extension
'<CODE>.r</CODE>' tells the system that the resource file is a textual
description that must be compiled using the MPW
<INX><CODE>Rez</CODE></INX>
 tool. If the extension is '<INX><CODE>.rsrc</CODE></INX>' 
the system knows that the resource is a
compiled resource file, and it will include the compiled resources
without calling the <CODE>Rez</CODE> tool.</P>

<P> You may need to use the lowlevel Toolbox interface to utilize
these resource in the current version of the libraries.</P>

<P> </P>
<H2>Additional Information for Macintosh </H2>

<H3>Limitations for Macintosh</H3>
<P>
See the BETA FAQ: 
<A HREF="http://www.daimi.au.dk/~beta/doc/faq/beta-language-faq.html#SectionV">
<CODE>http://www.daimi.au.dk/~beta/doc/faq/beta-language-faq.html#SectionV</CODE>
</A>
</P>
