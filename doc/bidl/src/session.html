<H2>A typical bidl session</H2>

The following illustrates a typical session using <CODE>bidl</CODE>.

<H3>Compiling the IDL file(s)</H3>

In this example, we will compile the 
<A HREF="Deep_Thought.idl" target=_blank><CODE>Deep_Thought.idl</CODE></A> file used in 
<A CLASS=external 
HREF="http://www.data.dti.dk/COT/pilot_application_for_com_taxono.htm#ph7">phase 7</A> 
of 
<A CLASS=external 
HREF="http://www.data.dti.dk/COT/pilot_application_for_com_taxono.htm">Pilot
application for COM Taxonomy</A>.
<P>
The file is easily compiled using this command line:
<PRE>
command&gt; bidl -f -q Deep_Thought.idl
Processing 'Deep_Thought.idl'...
      Deep_Thought.c
Processing '~beta/comlib/oaidl.idl'...
      oaidl.c
Processing '~beta/comlib/ObjIdl.Idl'...
      ObjIdl.c
Processing '~beta/comlib/Unknwn.Idl'...
      Unknwn.c
Processing '~beta/comlib/wTypes.Idl'...
      wTypes.c
Back from 's:\r4.2\comlib\wTypes.Idl'
Continuing processing of '~beta/comlib/Unknwn.Idl'...
Back from 's:\r4.2\comlib\Unknwn.Idl'
Continuing processing of '~beta/comlib/ObjIdl.Idl'...
Back from 's:\r4.2\comlib\wTypes.Idl'
Continuing processing of '~beta/comlib/ObjIdl.Idl'...
Back from 's:\r4.2\comlib\ObjIdl.Idl'
Continuing processing of '~beta/comlib/oaidl.idl'...
Back from 's:\r4.2\comlib\oaidl.idl'
Continuing processing of 'Deep_Thought.idl'...
Processing '~beta/comlib/ocidl.idl'...
      ocidl.c
Processing '~beta/comlib/OleIdl.Idl'...
      OleIdl.c
Back from 's:\r4.2\comlib\ObjIdl.Idl'
Continuing processing of '~beta/comlib/OleIdl.Idl'...
Back from 's:\r4.2\comlib\OleIdl.Idl'
Continuing processing of '~beta/comlib/ocidl.idl'...
Processing '~beta/comlib/OAIdl.Idl'...
      OAIdl.c
Back from 's:\r4.2\comlib\ObjIdl.Idl'
Continuing processing of '~beta/comlib/OAIdl.Idl'...
Back from 's:\r4.2\comlib\OAIdl.Idl'
Continuing processing of '~beta/comlib/ocidl.idl'...
Processing '~beta/comlib/ServProv.Idl'...
      ServProv.c
Back from 's:\r4.2\comlib\ObjIdl.Idl'
Continuing processing of '~beta/comlib/ServProv.Idl'...
Back from 's:\r4.2\comlib\ServProv.Idl'
Continuing processing of '~beta/comlib/ocidl.idl'...
Processing '~beta/comlib/UrlMon.Idl'...
      UrlMon.c
Back from 's:\r4.2\comlib\ObjIdl.Idl'
Continuing processing of '~beta/comlib/UrlMon.Idl'...
Back from 's:\r4.2\comlib\OleIdl.Idl'
Continuing processing of '~beta/comlib/UrlMon.Idl'...
Back from 's:\r4.2\comlib\ServProv.Idl'
Continuing processing of '~beta/comlib/UrlMon.Idl'...
Processing '~beta/comlib/MsXml.Idl'...
      MsXml.c
Back from 's:\r4.2\comlib\Unknwn.Idl'
Continuing processing of '~beta/comlib/MsXml.Idl'...
Back from 's:\r4.2\comlib\wTypes.Idl'
Continuing processing of '~beta/comlib/MsXml.Idl'...
Back from 's:\r4.2\comlib\ObjIdl.Idl'
Continuing processing of '~beta/comlib/MsXml.Idl'...
Back from 's:\r4.2\comlib\OAIdl.Idl'
Continuing processing of '~beta/comlib/MsXml.Idl'...
Back from 's:\r4.2\comlib\MsXml.Idl'
Continuing processing of '~beta/comlib/UrlMon.Idl'...
Back from 's:\r4.2\comlib\UrlMon.Idl'
Continuing processing of '~beta/comlib/ocidl.idl'...
Back from 's:\r4.2\comlib\ocidl.idl'
Continuing processing of 'Deep_Thought.idl'...
  Translated BETA file in: 'Deep_Thought.bet'
</PRE>

The output shown comes from the PC variant of bidl, which use
<CODE>cl</CODE> to preprocess the IDL files. This is the reason for
the lines like <CODE>MsXml.c</CODE>.
<P>
You will notice that bidl processes all the files imported by the
<CODE>Deep_Thought.idl</CODE> file. The <CODE>-f</CODE> option
given to <CODE>bidl</CODE> indicates that if
<CODE>Deep_Thought.bet</CODE> already exist and is newer than
<CODE>Deep_Thought.idl</CODE>, the BETA file should be generated
anyway (it will not be default). The <CODE>-q</CODE> option tells
<CODE>bidl</CODE> to be somewhat quiet (there's also a <CODE>-m</CODE>
 aka. <CODE>--mute</CODE> switch to make <CODE>bidl</CODE> be 
completely silent, and a <CODE>-v</CODE> aka. <CODE>--verbose</CODE>
option to make very verbose output (each type definition, interface
name and method name is displayed).
<P>

<H3>The generated BETA file</H3>

The generated BETA file 
<A HREF="Deep_Thought.bet" target=_blank><CODE>Deep_Thought.bet</CODE></A>
looks like this:

<PRE>
(* BETA interface generated from "Deep_Thought.idl" Wed May 13 22:58:34 1998 *)

ORIGIN '~beta/comlib/comtypes';
INCLUDE '~beta/comlib/OAIdl';
INCLUDE '~beta/comlib/OCIdl';
--LIB: attributes--

  ICalc_IID: (# exit '6FB6D32F-9E06-11D1-AE78-0020AF72F3D6' #);

  ICalc: IDispatch
    (* ICalc Interface *)
    (# &lt;&lt;SLOT ICalcLib: attributes&gt;&gt;;
       Add:&lt;
         (* method Add *)
         (# result: @int32 (* HRESULT *);
            v1: @int32 (* long *); 
            v2: @int32 (* long *); 
            res: ^int32Holder (* *long *); 
         enter (v1, v2, res[])
         do INNER;
         exit result
         #);
       Subtract:&lt;
         (* method Subtract *)
         (# result: @int32 (* HRESULT *);
            v1: @int32 (* long *); 
            v2: @int32 (* long *); 
            res: ^int32Holder (* *long *); 
         enter (v1, v2, res[])
         do INNER;
         exit result
         #);
       Multiply:&lt;
         (* method Multiply *)
         (# result: @int32 (* HRESULT *);
            v1: @int32 (* long *); 
            v2: @int32 (* long *); 
            res: ^int32Holder (* *long *); 
         enter (v1, v2, res[])
         do INNER;
         exit result
         #);
       Divide:&lt;
         (* method Divide *)
         (# result: @int32 (* HRESULT *);
            v1: @int32 (* long *); 
            v2: @int32 (* long *); 
            res: ^int32Holder (* *long *); 
         enter (v1, v2, res[])
         do INNER;
         exit result
         #);
       Modulus:&lt;
         (* method Modulus *)
         (# result: @int32 (* HRESULT *);
            v1: @int32 (* long *); 
            v2: @int32 (* long *); 
            res: ^int32Holder (* *long *); 
         enter (v1, v2, res[])
         do INNER;
         exit result
         #);
    #);

  ICalc2_IID: (# exit '08407980-9e15-11d1-ae78-0020af72f3d6' #);

  ICalc2: IDispatch
    (* ICalc2 Interface *)
    (# &lt;&lt;SLOT ICalc2Lib: attributes&gt;&gt;;
       Power:&lt;
         (* method Power *)
         (# result: @int32 (* HRESULT *);
            v: @int32 (* long *); 
            res: ^int32Holder (* *long *); 
         enter (v, res[])
         do INNER;
         exit result
         #);
    #);

  IHello_IID: (# exit 'a3985ef0-b4e6-11d1-aabb-006097636471' #);

  IHello: IDispatch
    (* IHello Interface *)
    (# &lt;&lt;SLOT IHelloLib: attributes&gt;&gt;;
       World:&lt;
         (* method World *)
         (# result: @int32 (* HRESULT *);
            res: ^BSTRHolder (* *BSTR *); 
         enter res[]
         do INNER;
         exit result
         #);
    #);

  IConv_IID: (# exit 'ed297100-9e0b-11d1-ae78-0020af72f3d6' #);

  IConv: IDispatch
    (* IConv Interface *)
    (# &lt;&lt;SLOT IConvLib: attributes&gt;&gt;;
       Hex2Dec:&lt;
         (* method Hex2Dec *)
         (# result: @int32 (* HRESULT *);
            v: @int32 (* BSTR *); 
            res: ^int32Holder (* *long *); 
         enter (v, res[])
         do INNER;
         exit result
         #);
       Dec2Hex:&lt;
         (* method Dec2Hex *)
         (# result: @int32 (* HRESULT *);
            v: @int32 (* long *); 
            res: ^BSTRHolder (* *BSTR *); 
         enter (v, res[])
         do INNER;
         exit result
         #);
    #);
  (* Calc Class *)
  Calc_CLSID: (# exit '88bc6440-ab04-11d1-b55a-00600889e712' #);
  (* Conv Class *)
  Conv_CLSID: (# exit 'bd4067e0-ab04-11d1-b55a-00600889e712' #);
  (* Deep_Thought 1.0 Type Library *)
  DEEP_THOUGHTLib_LIBID: (# exit '6FB6D322-9E06-11D1-AE78-0020AF72F3D6' #);

  (* Reference Holders *)

  ICalcHolder: refHolder
    (# type:: ICalc #);
  ICalc2Holder: refHolder
    (# type:: ICalc2 #);
  IHelloHolder: refHolder
    (# type:: IHello #);
  IConvHolder: refHolder
    (# type:: IConv #);
</PRE>

For each interface specified in the IDL file, a BETA pattern is
generated with <EM>virtuals</EM> corresponding to the member functions.
Also the <EM>interface-identifiers</EM> (IID) of each interface, and 
<EM>library-identifier</EM> (LIBID) and <EM>class-identifiers</EM>
(CLSID) from the type library are mapped by patterns.
<P>
You will notice that the parameter types in IDL, which are modelled by
this BETA code, are mentioned in comments for clarity (there is a
<CODE>-c</CODE> aka. <CODE>--compact</CODE> option for 
<CODE>bidl</CODE> which will cause such comments to be left out, as
well as generating less line breaks in the BETA code).
<P>
Notice also, that the two IDL files which are <CODE>import</CODE>ed
by <CODE>Deep_Thought.idl</CODE> yields corresponding 
<CODE>INCLUDE</CODE>s in the BETA file. Notice that the two files
are INCLUDEd from <CODE>~beta/comlib</CODE>, sice they could not be
found in the local directory.

<H3>Using the generated BETA interface</H3>

The generated BETA interface can now be used in a client, simply by
including it in the usual BETA manner. The following 
<A HREF="client7.bet" target=_blank><CODE>client7.bet</CODE></A>
is a very simple client, which obtains and uses the <CODE>IConv</CODE>
interface from the component. Notice the use of <CODE>BSTR</CODE>:

<PRE>
ORIGIN '~beta/comlib/comlib';
INCLUDE 'Deep_Thought';

--PROGRAM: descriptor--
(# CLSID_Conv: @CLSID;
   IID_IConv: @IID;
   pIConv: ^IConv;
   b: @BSTR;
   bh: @BSTRHolder;
   i: @int32Holder;
   hr: @HRESULT;
   
do 0->CoInitialize;
   
   IConv_IID -> IID_IConv; 
   Conv_CLSID -> CLSID_Conv; 
   
   'Create component and get interface IConv'->putLine;
   
   (CLSID_Conv[], NONE, CLSCTX_INPROC_SERVER, IID_IConv[])
     -> CoCreateInstance->pIConv[];
   
   'CoCreateInstance done'->putLine;

   (if pIConv[]&lt;&gt;NONE then
       'Succeeded creating component.'->putLine;
       '(17,bh[])->pIConv.dec2hex '->putText;
       (17,bh[])->pIConv.dec2hex->hr;
       (if hr.succeeded then
           '= '->putText; bh.getText->putLine;
        else
           'FAILED' -> putLine;
       if);
       '(\'ABBA\',i[])->pIConv.hex2dec '->putText;
       'ABBA' -> b.setText;
       (b, i[])->pIConv.hex2dec->hr;
       (if hr.succeeded then
           '= '->putText; i->putInt; newLine;
        else
           'FAILED' -> putLine;
       if);
       b.free;
       
       'Trying to release interface IConv'->putline;
       pIConv.Release;
       'Succeeded releasing interface IConv'->putline;
    else
       'Could not create component'->putline;
   if); 
   'CoUninitialize'->putline;
   CoUninitialize;
   'CoUninitialize done'->putline;
#)
</PRE>

Assuming that the component has been registered, this BETA program can
use one of the components made in Java or C++ (not Visual Basic, since
we are not at <CODE>IDispatch</CODE> level).
<P>
The above program has been tested with success using both the Java
server and the VC++/ATL server.
<P>
Furthermore a graphical client, which uses most of Deep_Thought has
been constructed using the 
<A CLASS=external HREF="http://www.mjolner.com/~datpete/mjolner_www/warehouse/frigg.html">
Mjølner Interface Builder
</A>.
<P>
This has also been tested with success against the Java, and VC++/ATL
servers.
<P>
<center>
<IMG SRC="calculator.gif" width=222 height=269 ALT="[Calculator Screen Dump]">
</center>

<!--++++++++++++++++++++++++++++++-->

