Subject: sgi problem med exit <component attach>
To: olm@daimi.aau.dk (Ole Lehrmann Madsen)
Date: Tue, 2 Sep 1997 17:00:53 +0200 (MET DST)
Cc: grouleff@daimi.aau.dk (Morten Grouleff),
        datpete@daimi.aau.dk (Peter Andersen)

Ole, morten opdagede i sidste |jeblik, at rettelsen i astlevel.bet
omkring  GetNextComment, som ikke l{ngere er statisk allokeret g|r at
sif/frigg p} sgi g}r ned under GC.

Problemet er }benbart at

          getNextComment:
            (# 
            do (if getNextCommentComponent[]=NONE then
                   &|getNextCommentOp[]->getNextCommentComponent[]
               if);
            exit getNextCommentComponent   <<<<<----------
            #);
          getNextCommentComponent: ^|getNextCommentOp;
          getNextCommentOp: 
            (# subcomment: ^text; n: @integer
            do ...
            exit (subcomment[],n)
            #);

(alts} en attach og evaluering af exit part i exit part) IKKE virker
p} SGI, hvis der kommer GC mens den er attachet.

I hvert fald virkede det fint, hvis vi rettede til:

          getNextComment:
            (# subcomment: ^text; n: @integer;
            do (if getNextCommentComponent[]=NONE then
                   &|getNextCommentOp[]->getNextCommentComponent[]
               if);
               getNextCommentComponent->(subcomment[],n);
            exit (subcomment[],n)
            #);
          getNextCommentComponent: ^|getNextCommentOp;
          getNextCommentOp: 
            (# subcomment: ^text; n: @integer
            do ...
            exit (subcomment[],n)
            #);

Er dette tilf{lde indbygget i TST?
Jeg h}ber p] et tidspunkt at f} lavet do_unconditional_gc til sgi ogs}
.
Og hvis den s} er i TST, s} vil den blive fanget.

Jeg ved ikke om det er en kodegenereringsfejl eller GC fejl, men der
er med stor sandsynlighed en fejl her vi skal have unders|gt.

/Peter
