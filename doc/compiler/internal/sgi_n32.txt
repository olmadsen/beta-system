Ole,

i CPN har vi brug for at linke en del ekstern kode ind til håndtering
af f.eks. trackball, text display mm.

En del af dette er ret store libraries, som er skrevet til at kunne
oversættes med gcc. Det er ikke oplagt at de "let" kan fikses til at
kunne oversættes med cc.

Som bekendt kan gcc-producerede objektfiler ikke linkes med BETA
objektfiler på sgi. Da sgi er den primære unix platform for OpenGL, så
vil jeg meget gerne køre på sgi (Michel har også en sådan på sit
skrivebord).

Jeg har derfor brugt et par timer på at undersøge om det er muligt at
skifte til det nye objektfilformat, som IRIX 6.1 og fremefter benytter
og som gcc (vistnok) også benytter.

Jeg kom ret hurtigt igennem med at kunne linke tst, hvor ctstcproc.c
var oversat med gcc.

Men det har vist sig, at der skal lidt mere til (programmet dørker med
segmentation fejl) - nemlig rettelser i kodegenereringen. Så vidt jeg
kan se, så vil det give mindre kode. 

Jeg har allokeret switch 84 til dette eksperiment.

Pga et rcm problem kan jeg ikke checke ind før jeg har talt med
Henrik, og han svarer ikke lige nu.

Men kig evt på http://www.cs.au.dk/~datpete/SGI.html#n32 hvor jeg
har samlet lidt om dette. Det nye n32 format er vældigt godt
dokumenteret, og jeg har indsat en masse links til relevant
dokumentation.

> 
> Men det er OK med mig at forsøge med det nye objekt format.
> Hvor meget er det bagud kompatibelt?
> 

Det er ikke bagudkompatibelt (så kunne gamle objektfiler have været 
linket sammen med nye (såsom gcc) vha den nye linker). Desværre nej.
Der er dog kun få rettelser:

1. Der bruges nu op til 8 registre til argumenter ved kald (tidligere 
4)
2. $gp skal nu gemmes af callee i stedet for caller
   (det er grunden til at min tst segmentation fejler allerede i main
   lige efter kald af BETA_main).
3. Alle registre er 64 bit (kan have betydning for sign extend)
4. Alle floating point registre kan bruges nu (tidligere kun hver
   anden)

Herudover er der tilføjet mulighed for større GOT, og desuden skal der
sættes et par bit i ELF filen (det har jeg gjort).

Desuden antages MIPS4 instruktioner at være til rådighed.
Det giver vist et par ekstra instr.

Alt er *usædvanligt godt dokumenteret*, endda med tabeller med
sammenligninger med gamle format, i de web-sider jeg henviser til.

> > 1. Der bruges nu op til 8 registre til argumenter ved kald (tidlig
ere 4)
> Konflikter det med den nuværende brug af registre?

Ja. Det er $4-$11, der nu kan bruges som argument registre.
Det konflikter bl.a. med vores d0-d4. Men argument registre kan dog
stadig bruges som scratch registre, blot man husker at de ikke er
bevaret over kald.

> 
> Og det skal så nok være en switch eller en ny platform?

Som jeg nævnte har jeg allokeret switch 84 til dette.

