<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>

<HEAD>
<LINK REL=TOP HREF=../mjolner-tut/index.html>
<LINK REL=UP HREF=valhalla-tut-3.html>
<LINK REL=PREV HREF=valhalla-tut-4.html>
<LINK REL=NEXT HREF=valhalla-tut-6.html>
<TITLE> An Example Usage</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING5></A>


<P><A HREF=valhalla-tut-6.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=valhalla-tut-4.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=valhalla-tut-3.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P> Debugger</P>


<A NAME=HEADING5-0></A>
<H1> <A NAME="LINK-valhalla-tut-_Toc366231461"><A NAME=MARKER-9-10></A>An Example Usage</A></H1>
<P> This section assumes the record program has been compiled as described in the previous section. Running record results in a runtime error:</P>
<PRE CLASS=beta>
&gt; cd myDir	
&gt; record	
# BETA execution aborted: Reference is none	
# Look at 'record.dump'
</PRE>
<P> Now let's use Valhalla to locate the cause of the error. As record does not take command line parameters, simply start Valhalla by typing:</P>
<PRE CLASS=beta>
&gt; valhalla record
</PRE>
<P> Valhalla will initialize and open the Valhalla Universe as shown<EM><A REL=FOOTNOTE HREF="#FOOTNOTE-2">[2]</A></EM> in .</P>

<P> &lt;&lt;fig&gt;&gt;</P>
<P> <A NAME="LINK-valhalla-tut-_Ref365819767"><A NAME=MARKER-9-13></A>Figure 1: The Valhalla Universe</A></P>
<P> Immediately after the Valhalla Universe have been opened, the Command Line Editor will be displayed, as seen in .  Since record does not use any command line arguments, we just press the <EM>Cancel</EM> button (otherwise, we could have entered the command line arguments in the text field, and then pressed the <EM>OK</EM> button).</P>

<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 2: The Command Line editor</P>
<A NAME=HEADING5-15></A>
<H2> Contents of the Valhalla Universe</H2>

<P> The Valhalla Universe defines a number of menus. Most commands in these menus operate on the state of the debugged process, or enables control over the debugger process.</P>

<P> The middle pane of the Valhalla Universe contains a view area in which the different local views will be displayed.</P>
<P> Finally the bottom pane contains three areas: the Process Info Area, the Valhalla Info Area, and the Buttons Area.</P>

<P> In the Process Info area, you will see different messages related to the debugged process.  In , you see the message: No Process, indication that no process is being debugged at this point.</P>

<P> In the Valhalla Info Area, you will find different messages related to the operation of Valhalla (status messages, error messages, etc.). In , no Valhalla messages are displayed.</P>

<P> In the Buttons areas, you find a number of buttons, which are short-cuts to often used commands, also found in the menus of the Valhalla Universe.</P>
<P> After we now have presented the Valhalla Universe, we continue the record example.  After having dealt with the Command Line Editor, we will be presented with the following contents in the Universe:</P>
<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 3: Universe with ready process</P>

<P> The Universe at this point contains one inner window with the title: Fragment: PROGRAM.  This view is a code view, displaying the contents of the PROGRAM slot of the source code of the process, being ready to be debugged.  This code view is identical to the code views, you find in the other Mj&oslash;lner BETA System tools (e.g. Sif <A HREF="../bibliography/index.html#mia90-11">[MIA 90-11]</A>, Freja <A HREF="../bibliography/index.html#mia93-31">[MIA 93-31]</A>, and Frigg [96-33]), and you can interact with the code in the window exactly as described in the Sif manual <A HREF="../bibliography/index.html#mia90-11">[MIA 90-11]</A>, except that only browsing is possible - editing in the source code is not possible through code views in Valhalla.  This implies that semantic browsing are available for browsing in the source code, shown in code views.</P>
<P> As you can see, abstract presentation is also available in the code view.  After having detailed the <EM>&Eacute;</EM> in the code view, you will be able to see some of the source code in the code view in the Universe:</P>

<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 4: Detailing the contractions</P>

<P> We are now ready to start execution of the record application.  We do this by pressing the <EM>Go</EM> button in the Buttons Area.  The application will now begin execution, and since there in this case is a runtime error, the debugged process will not complete.  Since the application is being debugged, the application does not terminate as usual, but will signal the error to Valhalla, who will then present the following Universe:</P>

<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 5: code view opened at time of error</P>
<P> Note that a new code view is now visible in the Universe (in this picture, this new code view is placed entirely on top of the previous code view).  This new code view displays the code being executed at the time of the runtime error, and highlights the exact source code that gave rise to the runtime error.</P>
<P> The name of the code view opened is Fragment: lib and the pattern in the source code is newBook, implying that the newBook pattern is defined in a fragment, called lib.   From here, you can now use the semantic browsing facilities described in the Sif manual <A HREF="../bibliography/index.html#mia90-11">[MIA 90-11]</A> to find the definitions of the different names in the displayed source code.  If the semantic links refer to source code, not in the current code view, new code views are created, displaying the proper source code (similar to Open Separate in Sif).  If, during browsing, you forget what imperative caused the error, or cannot find the window containing that imperative, just press the <EM>Code</EM> button, and Valhalla will raise (and wriggle) the window with the offending imperative selected.</P>

<P> A number of other informations about program state at time of error would be useful in order to decide what caused the error:</P>

<UL>
<LI>What is the state of these objects.
<LI>What was the call chain at time of error.
</UL>
<P> In the following sections we will consider how to obtain these informations.</P>
<A NAME=HEADING5-49></A>
<H1> Inspecting object state<A NAME=MARKER-2-22></A></H1>

<P> Above we found that Valhalla automatically displayed the source code containing the offending imperative.  Usually, in order to determine the cause of the error, one has to consider the state of the objects in the executable to understand what caused the error.  To browse the state of the objects, Valhalla implements so-called object views.</P>
<P> The immediately most interesting object, related to the error is the so-called Current Object<A NAME=MARKER-2-23></A>, which is the object that executed the offending imperative.  We can gain access to the current object by pressing the <EM>Object</EM> button in the Buttons Area.  This will result in an object view being displayed in the Universe.  This object view will display the state of the Current Object at the time of the error.</P>
<P> More generally, whenever the debugged process is stopped, pressing the <EM>Object</EM> button in the Buttons Area of the Valhalla Universe opens an object view displaying the current object  if already open in the Universe, the object view will be raised (and wriggled).  If we press the <EM>Object</EM> button, we get the following contents of the Universe:</P>
<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 6: Object view opened at time of error</P>
<P> From the object view in , we see that the current object at time of error was an instance of the pattern NewBook.  The state of the object is displayed in the window. The Rec attribute is a reference to an object and is therefore described only by the name of its pattern, followed by ~ and a number.  If we double-click the line  Rec: ^Book~3, a new object view is opened, displaying the state fo the object referred to by Rec (as shown in ):</P>
<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 7: Object view displaying the new attribute of the failing object</P>
<P> As it can be seen, the author attribute of Rec is NONE. This is actually the reason for the runtime error in record. As you probably remember, the failing imperative was A-&gt;Rec.Author and because Rec.author is NONE, this results in a runtime error. If you do not remember, simply press the <EM>Code</EM> button in the Buttons Area of the Universe.</P>
<P> Since author is a dynamic reference to a Text object, we could correct the error by changing author to become a static instance of Text (exchanging ^ with @).</P>
<P> Eventhough we have now found the source of error, there is still a number of Valhalla features that have not yet been demonstrated. As a consequence we just continue this tutorial to introduce you to more of the Valhalla functionality.</P>

<P> Some attributes are shown contracted (shown by the <EM>&Eacute;</EM>).  These <EM>&Eacute;</EM> indicate that these objects are complex objects, with inner structure.  You can see the inner structure (and state) by double clicking on the attribute.  If we do this on e.g. the A attribute, we get the following screen:</P>
<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 8: Detailing static objects</P>

<P> Note, that in contrast to when we followed the Rec attribute in , no new object view is opened, but the state of the A attribute is shown inline.  This is due to the fact, that A is a static object, whereas Rec is a dynamic object reference.</P>

<P> Object views are updated every time the program stops by hitting a breakpoint, receiving a signal or in case of runtime error. </P>
<A NAME=HEADING5-70></A>
<H1> Inspecting the call chain<A NAME=MARKER-2-25></A></H1>
<P> Now we know where and why the error happened. But how did we get there? To answer this question we use the stack view:  We can get a stack view by pressing the <EM>Stack</EM> button in the Button Area.</P>

<P> The stack view shows the process stack at time of error. Each line in the stack view refers to a stack frame, with the most recent as the top-most line:</P>
<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 9: The stack view<A NAME=MARKER-2-27></A></P>
<P> By double-clicking on the lines in the stack view, code views are opened, displaying the code related with this stack frame (with the active imperative selected).  By holding the right mouse button down on a line, you get a small menu from where you can create object views, displaying the state of the corresponding stack frame. </P>
<A NAME=HEADING5-77></A>
<H1> Rerunning the program<A NAME=MARKER-2-28></A></H1>

<P> If it during a debugging session becomes necessary to restart the debugged process (e.g. to try to trace the location of the error after having inserted some breakpoints), we can rerun the debugged process by pressing the <EM>Rerun</EM> button in the Buttons Area.  The debugged process will then be reinitialized and prepared to start from the beginning again.  All existing program state is cleared by the rerun, but existing breakpoints are maintained.</P>
<A NAME=HEADING5-80></A>
<H1> Setting a Breakpoint</H1>
<P> Until now, Valhalla has decided when to interrupt the debugged process, doing so because of a &ograve;Reference is NONE&oacute; error. We have not yet seen an example of controlling the program execution in greater detail. To do this we are now going to restart the debugged process and trace the program flow until time of error</P>
<P> We press the <EM>Rerun</EM> button, and Valhalla now restarts the process and makes it ready to be restarted.<EM><A REL=FOOTNOTE HREF="#FOOTNOTE-3">[3]</A></EM></P>
<P> We now examine the code view, locating the invocation of the erronious NewBook pattern. We now want to make the process continue execution until it is about to execute NewBook.  We can do this by setting a breakpoint immediately before the invocation.</P>

<P> We click at the BETA imperative containing the generation and execution of a NewBook object. Then select <EM>Set Breakpoint<A NAME=MARKER-2-31></A></EM> from the <EM>Breakpoints<A NAME=MARKER-2-32></A></EM> menu in the Universe. An breakpoint marker<A NAME=MARKER-2-33></A>  (&gt;&gt;1&gt;&gt;) appears in front of the imperative to mark the presence of a breakpoint (the 1 indicates that this is the first breakpoint). The process will thus be interrupted just before this imperative is about to be executed.  displays the look of the code view at this point.</P>
<P> &lt;&lt;fig&gt;&gt;</P>
<P> Figure 10: Your first breakpoint</P>

<P> Having set the breakpoint we make the debugged process begin execution by pressing the <EM>Go</EM> button. The process now runs until the breakpoint is hit. Then Valhalla updates all open code and object views to display the current state of the debugged process. </P>

<P> Alternatively, we could have selected the <EM>Step Over</EM> button a number of times.  <EM>Step Over</EM> executes the imperatives one by one, returning control to Valhalla after each imperative. This would bring the debugged process to exactly the same imperative, but by executing an imperative at the time in the PROGRAM fragment.<EM><A REL=FOOTNOTE HREF="#FOOTNOTE-4">[4]</A></EM></P>
<P> Now we would like to continue until the first imperative executed by NewBook. </P>

<P> From here we might want to trace the execution more closely.  We can do this by using the <EM>Step</EM> button.  <EM>Step</EM> is a single step facility, which executes one single BETA imperative at a time.  This implies, that <EM>Step Over</EM> executed entire patterns in a single step, since <EM>Step Over</EM> is intuitively single stepping at the imperative level of the visible code in the code view, whereas <EM>Step</EM> will stop execution e.g. immediately after a pattern invocation have been initiated, setting a breakpoint before the first imperative in the invoked pattern.</P>
<P> If we now press the <EM>Step</EM> button repeatedly, we can now follow the execution closely, until we reach the point immediately before the offending imperative. </P>
<A NAME=HEADING5-96></A>
<H1> Browsing code<A NAME=MARKER-2-36></A></H1>

<P> We have above described the source code browsing, based on the semantic linking facilities.  However, this is often not sufficient, and Valhalla is therefore integrated with the source browser (Ymer), just as other tools in the Mj&oslash;lner BETA System.  </P>
<P> You can gain access to this source browser by selectiong the <EM>Source Browser</EM> menu enty in the <EM>File</EM> menu of the Universe.  This will bring up a standard source browser, with the dependency graph of the debugged program as a socalled root project.  We will refer to the Sif manual <A HREF="../bibliography/index.html#mia90-11">[MIA 90-11]</A> for more information on the browsing facilities of the Source Browser.</P>
<A NAME=HEADING5-100></A>
<H1> The End</H1>
<P> You have now concluded a tour of the most important Valhalla facilities. To get a more detailed description of these facilities as well as others not covered in this tutorial, please consult the reference part of this manual.</P>






<HR>

<A NAME=FOOTNOTE-2>[2] </A>
 Screen dumps shown in the tutorial shows the views as they would have been if you had not copied the example program to a directory of your own, but simply compiled them in the ~beta/debugger/demo directory.
<HR>

<A NAME=FOOTNOTE-3>[3] </A>
 All breakpoints set before rerunning the program will continue being set.
<HR>

<A NAME=FOOTNOTE-4>[4] </A>
 <EM>Step Over</EM> sets a breakpoint at the imperative following the current imperative in the current pattern and thus skips procedure calls that might be embedded in the current imperative.






<HR>
<P>
<TABLE cols=3 border=0 width=100%>
<TR>
<TD width="33%" align="left">
<ADDRESS>Debugger - Tutorial</ADDRESS>
</TD>
<TD width="34%" align="center"><FONT size=-1>&COPY; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="33%" align="right"><FONT size=-1><SCRIPT LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></FONT></TD>
</TABLE>
<P>
<P><A HREF=valhalla-tut-6.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=valhalla-tut-4.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=valhalla-tut-3.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
