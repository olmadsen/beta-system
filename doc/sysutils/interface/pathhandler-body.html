<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<!-- Autogenerated file - do not edit -->
<HEAD>
<TITLE>Pathhandler Interface</TITLE>
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">
<SCRIPT DEFER TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/hashfromparent.js"></SCRIPT>
<SCRIPT DEFER TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/printframe.js"></SCRIPT>
<BASE TARGET="_top">
</HEAD>
<BODY onLoad='HashFromParent()'>
<H1><A name="pathhandler">Pathhandler Interface</A></H1>
<PRE CLASS=interface>
ORIGIN '~beta/basiclib/betaenv';
LIB_DEF 'pathhandler' '../lib';
BODY 'private/pathhandlerbody';

(*
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-96
 *       All rights reserved.
 *)

-- LIB: attributes --

(* Utility patterns *)
<B>DirectoryChar</B><A name="DirectoryChar.1(233)"></A>:
  (* The character which is used in this operating system to merge local
   * names to full path-names. Placed here to allow use without having
   * an instance of pathhandler.
   *)
  (# <B>c</B><A name="DirectoryChar.1:c.2(234)"></A><A name="c.2(234)"></A>: @char;
  ...
  exit c
  #);
<B>CurrentDirectory</B><A name="CurrentDirectory.1(235)"></A>: 
  (* The current working directory of this process.
   * Placed here to allow use without having an instance of pathhandler.
   *)
  (# <B>cwd</B><A name="CurrentDirectory.1:cwd.2(236)"></A><A name="cwd.2(236)"></A>: ^text; 
  ...
  exit cwd[]
  #);
<B>scanSearchPath</B><A name="scanSearchPath.1(237)"></A>:
  (* Scan through a list of paths separated by the delimiter
   * specified. INNER is called for each path found in
   * the list.
   * If pathlist is none, the default search path of the machine.
   * If delimiter is 0, the default delimiter for searchpaths
   * is used.
   *)
  (# <B>pathlist</B><A name="scanSearchPath.1:pathlist.2(238)"></A><A name="pathlist.2(238)"></A>: ^text; (* list if paths seperated by delimiter *)
     <B>delimiter</B><A name="scanSearchPath.1:delimiter.2(239)"></A><A name="delimiter.2(239)"></A>: @char;
     <B>path</B><A name="scanSearchPath.1:path.2(240)"></A><A name="path.2(240)"></A>: ^text; (* pathlist component set before each call of INNER *)
  enter (pathlist[], delimiter)
  ...
  #);

<B>PathHandler</B><A name="PathHandler.1(241)"></A>: 
  (*
   *  This pattern converts the Mjolner path notation to and from full native paths.
   *
   *  The following abbreviations are handled:
   *
   *      ~    is expanded into the home directory of the user
   *      ~foo is expanded into the home directory of foo
   *      .    is interpreted relatively to another path 
   *           (see ConvertFilePath below)
   *      ..   is interpreted relatively to another path 
   *           (see ConvertFilePath below)
   * 
   *      Environment variables like $(HOME) are expanded within paths.
   *
   *  PathHandler examines the environment variable
   *      
   *      BETALIB. If set, this determines the home directory of the Mjolner 
   *               BETA system. 
   * 
   *      The value of BETALIB may, but need not, be terminated by '/'.
   *)
  (# 
     &lt;&lt;SLOT PathHandlerLib: attributes&gt;&gt;;
     
     <B>BetaLib</B><A name="PathHandler.1:BetaLib.2(242)"></A><A name="BetaLib.2(242)"></A>: (* Mjolner BETA System home directory *)
       (# value: ^text; 
       ...
       exit value[]
       #);
      
     <B>CurrentDirectory</B><A name="PathHandler.1:CurrentDirectory.2(243)"></A><A name="CurrentDirectory.2(243)"></A>: (* The current working directory of this process *)
       (# value: ^text; 
       ...
       exit value[]
       #);

     <B>ConvertFilePath</B><A name="PathHandler.1:ConvertFilePath.2(244)"></A><A name="ConvertFilePath.2(244)"></A>:&lt;
       (* Convert the 'path' relative to 'basis'.
        * 
        * Within 'path' the conversion expands the abbreviations mentioned
        * above.  '..' is a relative path designating the parent of a directory
        * (if any) whereas '.' is a relative path designating the directory
        * itself.  If path starts with ~, this is expanded to the home
        * directory of the user, and if it starts with ~foo, this is expanded
        * to the home directory of the user foo. These expansions ignore basis.
        * These abbreviations are only expanded if they are the first
        * component(s) of 'path'.
        * 
        * The only meaningful abbreviation in 'basis' is that it may start with
        * '.' Using this, 'basis' may be specified as the relative path '.'
        * instead of the absolute path THIS(PathHandler).CurrentDirectory.
        * 
        * If both the path and the basis are relative paths, the result will be
        * a relative path, otherwise it will be an absolute path.  Path and
        * basis may be terminated by '/', but need not be.
        * 
        * The resulting path will contian the native DirectoryChar as separators.
        *        
        *)
       (# path,basis, convertedpath: ^text;
          NoFather:&lt; Exception
            (* Raised if there are too many '..' in the beginning of 'path'
             * compared to the given (absolute) basis.
             * If basis is relative, excess '..'s will be converted to '..'
             *)
            (# ... #);
          convert: @...
       enter(path[],basis[])
       do convert;
          INNER
       exit convertedpath[]
       #);
     
     <B>DirectoryChar</B><A name="PathHandler.1:DirectoryChar.2(245)"></A><A name="DirectoryChar.2(245)"></A>: @char 
       (* The character which is used in this operating system to merge local
        * names to full path-names; '/' in unix, ':' on Macintosh, '\' on Windows
        *);
     
     <B>LocalPath</B><A name="PathHandler.1:LocalPath.2(246)"></A><A name="LocalPath.2(246)"></A>: 
       (* Given a path and a basis, exit the local path relative to the basis,
        * if possible.
        * 
        * The local path will be a path relative to basis, if basis is a prefix
        * of path. If this is not the case, it is attempted to use some of the
        * paths allready converted by THIS(PathHandler) as prefix to path. In
        * this case the result may be a relative path, or it may be a path in
        * the form ~foo.  If it is not possible to find any legal prefix, the
        * exception LocalPathException is raised and the original path is
        * exited. LocalPathException has the continue attribute set to true by
        * default; set it to false in a further binding, if you want to catch
        * this error.
        * 
        * The resulting path will contain '/' as separators.
        *)
       (# path,basis: ^text;
          localName: ^text;
          LocalPathException:&lt; Exception
            (# ... #);
          localize: @...;
       enter (path[],basis[])
       do localize
       exit localName[]
       #);
     
     <B>init</B><A name="PathHandler.1:init.2(247)"></A><A name="init.2(247)"></A>:&lt; (# ... #);
     
     <B>Private</B><A name="PathHandler.1:Private.2(248)"></A><A name="Private.2(248)"></A>: @...;
     
  #);

<B>FilenameConverter</B><A name="FilenameConverter.1(249)"></A>: PathHandler
  (#
     (* This pathhandler is capable of keeping track of files which have 
      * allready been "converted".
      * 
      * convertFilePath will return the same pathname every time the same 
      * file is accessed even if the absolute path-names differs.
      *  
      * E.g. if /users/beta/basiclib/current is a link to the directory 
      * ~cn/beta/basiclib then
      *       '/users/beta/basiclib/current/file.bet' -&gt; convertFilePath -&gt; ...
      * and 
      *       '~cn/beta/basiclib/file.bet' -&gt; convertFilePath -&gt; ...
      *  
      * will give the same result, and the result will be the exit-parameter of
      * the first executed call of "convertFilePath".
      * Notice that if the file itself is a link to another file, these two
      * disk entries are considered different.
      * Notice also that in this special pathhandler, it is significant whether
      * the path are terminated by '/' or not: If it is, the path is considered
      * a directory.
      *)
     
     &lt;&lt;SLOT FileNameConverterLib: attributes&gt;&gt;;
     
     <B>convertFilePath</B><A name="FilenameConverter.1:convertFilePath.2(250)"></A><A name="convertFilePath.2(250)"></A>::&lt;(# fileNotFound:&lt; (# do INNER #);
          convert: @...
       do convert
       #);
     
     <B>init</B><A name="FilenameConverter.1:init.2(251)"></A><A name="init.2(251)"></A>::&lt;(# ... #); 
     
     <B>FCPrivate</B><A name="FilenameConverter.1:FCPrivate.2(252)"></A><A name="FCPrivate.2(252)"></A>: @...
  #)
</PRE>
<!---------------------------------------------------------->
<HR>
<P></P>
<TABLE cols=3 border=0 width=100%>
<TR>
<TD width="40%" align="left"><ADDRESS>Pathhandler Interface</ADDRESS></TD>
<TD width="20%" align="center"><FONT size=-1>&COPY; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT LANGUAGE=JavaScript SRC="../../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
</BODY>
</HTML>
