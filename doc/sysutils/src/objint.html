
<H1>Object Interface Library</H1>

The Object Interface Library is a collection of patterns that forms a
lowlevel runtime interface to objects. It allows the user to read and
manipulate the runtime state of objects and prototypes.<P>
This is a short description of the functionality. Please refer to the
interface <A HREF="interface/objinterface.html">file</A> for parameters etc.

<H2>ProtoTypes</H2>
Each object-descriptor in a BETA fragments gives rise to a prototype.<BR>
The library defines the following patterns for dealing with prototypes:
<UL>
<LI>protoType<A NAME=protoType></A>: Prototype is a highlevel model of the lowlevel
prototype. It has the following attributes:
  <UL>
  <LI>address: is the memory address of the actual prototype.
  <LI>GCtab: is the distance to allocation tables, used by garbage collector.
  <LI>OriginOff: is the offset of the origin field.
  <LI>GPart: is the address of the generation entry point
  corresponding to the prototype.
  <LI>Size: is the size of the objects with this prototype.
  <LI>Prefix: is the address of the prefix (super) pattern.
  <LI>LabId: is the name of objects used in dumps.
  <LI>GroupId: is the name of the file, where the pattern is declared.
  <LI>ScanRefs<A NAME=ScanRefs></A>: scans through references in this prototype. See later.
  <LI>ScanSimples: scans through simple attributes in this prototype.
  <LI>AstIndex<A NAME=AstIndex></A>: is the ast-index corresponding to this prototype. Must
  be doubled before used with indexToNode. Eg. pt.astIndex*2->ff.indexToNode;
  <LI>formIndex<A NAME=formIndex></A>: this is the index of the form containing the
  descriptor corresponding to this prototype. 
  </UL>
<LI>getProtoTypeForStruc: Returns the prototype corresponding to a
pattern-variable. 
<LI>getProtoType: Returns the prototype corresponding to a object.
<LI>getProtoField: Returns the prototype-field of a object. Will not
work on components.
<LI>putProtoField: Sets the prototype-field of a object. 
<LI>IsPrototypeOfProcess: Returns true if the address is a prototype
in the program.
</UL>
<P>
<B>ScanRefs:</B>
The ScanRefs scans a prototype for references. You can use it
to investigate the references in a object. It calls INNER for every
reference. IsStatic is true if the reference is static. thisProto is
the prototype address of static inlined objects. refType is the type
of the dynamic reference.<P>
Here is an example from the sysutils/demo/objectinterface/objint.bet
demo:

<BETA SRC="scanrefs.bet">

<H2>BETA Components</H2>
The library defines the following patterns for
<UL>
<LI>isComponent: Determines if a object is a BETA component.
<LI>objectToComponent<A NAME=objectToComponent></A>: Used to convert a object reference to a
component reference.
<LI>componentToObject<A NAME=componentToObject></A>: Used to convert a component reference to a
object reference.
</UL>

ObjectToComponent is often needed in situation where the THIS construct
is used on components. Eg:
<beta>
(# mySystem:System
   (# ...
      myfork:
        (# 
        do THIS(system)[]->objectToComponent->fork;
                (* fork is in basicsystemenv.bet *)
        #);
   #)
#);
</beta>
"THIS(System)" is a object reference and fork needs a component reference.

<H2>Objects</H2>
The library defines the following patterns for
<UL>
<LI>getPatternName<A NAME=getPatternName></A>: Return the name of the pattern this object is
instance of.
<LI>getOrigin: Returns the origin (enclosing) object.
<LI>getGCField: Return the GC field of the object.
<LI>addressToObject: Converts a address (integer) to a object reference.
<LI>printObject: Prints a low-level textual form of a object.
<LI>assignRef: Assigns a object reference to a object field using
integer addresses.
<LI>getOIDforObject: Returns a unique integer object ID.
<LI>getObjectByOID: Return a object reference from a integer object ID.
</UL>

<H2>Groups</H2>
The library defines the following patterns for handling groups.<BR>
These are only for very advanced use.
<UL>
<LI>group_header: is a highlevel description of objectcode-groups.
<LI>NextGroup: returns the next/first group in the executable. 
<LI>NameOfGroup: returns address of the groups groupname.
<LI>AddGroup: Appends a new groups to the list. 
<LI>IsPrototypeOfGroup: returns true if a prototype is in a group.
</UL>

<H2>Miscellaneous</H2>
The library also contains this pattern:
<UL>
<LI>extGetCstring: converts a address of a c-string to a BETA char repetition.
</UL>
