<H1> The shellEnv pattern</H1>
<P> The shellEnv<A NAME=MARKER-2-16></A> pattern from basicshell.bet is a subpattern of systemEnv from ~beta/basiclib/basicsystemenv.bet. As a consequence, distributed programs using shellEnv must have a structure corresponding to that of concurrent programs using systemEnv. This structure is sketched in figure 3, showing a template for a distributed BETA program not using X window libraries.</P>
<PRE CLASS=beta>
ORIGIN '~beta/distribution/shell';
--- program:descriptor ---
shellEnv
(# shellType:: (# ... #)
   ...
#)
</PRE>
<P> Figure 3: Template shellEnv program not using X libraries.</P>
<P> As can be seen from figure 3, the program:descriptor SLOT must contain a specialization of shellEnv. The usage of the shellType virtual is described in the section on the shell pattern.</P>
<P> When writing distributed BETA programs, the program:descriptor SLOT in betaenv must contain a subpattern of shellEnv. This instance of shellEnv is futhermore the only one allowed.</P>
<P> The template in figure 3 has ORIGIN in the shell fragment since is not using X window libraries. If the program were to use X libraries, it should have ORIGIN in the xshell fragment. There is no difference between shell.bet and xshell.bet concerning the abstractions offered. The only difference is the systemEnv implementation used. An alternative implementation is necessary to be able to combine systemEnv with the event driven X window libraries using a central event loop. To be able to install a number of callback functions used for scheduling purposes, the X implementation of systemEnv needs a reference to the xtenv instance used in the current program. This is handled by the setWindowEnv virtual as illustrated in figure 4.</P>
<PRE CLASS=beta>
ORIGIN '~beta/distribution/xshell';
INCLUDE '~beta/Xt/xtenv';
--- program:descriptor ---
shellEnv
(# shellType:: (# ... #);
   setWindowEnv:: (# do myxtenv[] -&gt; theWindowEnv[] #);
   myxtenv: xtenv@(# ... #);
#)
</PRE>
<P> Figure 4: Template distributed BETA program using X libraries.</P>
<P> In figure 4, the myxtenv object could as well have been an instance of awenv or motifenv. What counts is that it is qualified by xtenv. </P>
<P> The singular shellEnv instance in a distributed BETA process is returned by the getShellEnv pattern declared in basicshell.bet. Library fragments that should be usable in programs using X as well as programs not using X, must have origin in basicshell.bet.</P>

<P> The shellEnv pattern calls INNER when it has finished initialization. Initialization of shellEnv specializations may thus take place in the shellEnv INNER, or in the shellType INNER, to be described in section 4.3. Note that the distributed BETA program will not terminate until theShell.kill has been called, even if INNER shellEnv and INNER theShell terminates!</P>
<P> The following sections describe the different patterns and virtuals embedded in shellEnv.</P>





