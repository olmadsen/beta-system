From datpete@ariel.cs.au.dk Tue Nov 24 20:52:41 1998
X-UIDL: 145d4232990f16076818320ee173852b
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 3699 invoked from network); 24 Nov 1998 20:52:41 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 24 Nov 1998 20:52:41 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.1/8.9.1) id VAA02024;
	Tue, 24 Nov 1998 21:52:37 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811242052.VAA02024@ariel.cs.au.dk>
Subject: Guienv print dialog
To: jlk@cs.au.dk (Jørgen Lindskov Knudsen),
        henryml@cs.au.dk (Henry Michael Lassen),
        les@cs.au.dk (Lennert Sloth),
        gram@cs.au.dk (Flemming Gram Christensen),
        mannan@cs.au.dk (Manmathan Muthukumarapillai),
        pa@mjolner.com (Peter Andersen)
Date: Tue, 24 Nov 1998 21:52:37 +0100 (MET)
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Status: OR

Så vidt jeg kan se er en standard print dialog ikke inkluderet 
i guienv/stddialogs eller guienv/prompts.

På mac og pc kan der vel laves et interface det OS'ens standard
dialog, men på UNIX er man nok nødt til selv at lave den.

Jeg har lavet et foreløbigt forslag til et API for en print dialog:
/users/datpete/beta/bifrost/bdraw/printdialog.bet (ligger i bdraw
selvom den er uafhængig af bifrost - bruges foreløbig kun i min
private udgave af bdraw).

Jeg har endvidere lavet en body for denne, der udvider en
PromptForText til at spørge om et par ting mere.
Prøv på solaris: /users/datpete/beta/bifrost/bdraw/bdraw og sig
Cntl-P for at aktivere dialogen.

Det er ikke helt nemt at lave den pænt, og jeg har måttet tilføje
to attributter til guienv/prompts.bet:

     extra_hspace:< integerValue
       (* Extra horizontal space to put to the right of the fields
*);
     extra_vspace:< integerValue
       (* Extra vertical space to put between the fields and the
buttons *);

Jeg mangler endnu at tilføje "Destination: Printer/File" og
"Orientation: Portrait/Landscape", men inden jeg gør det vil jeg lige
høre guienv/bifrost folket:

Synes man jeg skal arbejde videre på denne?
Kunne man forestille sig at lave implementationer baseret på 
standard OS dialogerne på mac/pc givet den API jeg har skitseret i
printdialog.bet? Jeg har set at der i hvert fald i bdraw_ntibody
er en anvendelse af PC printdialogen, men jeg ved ikke om det passer
ind i den foreslåede API.

Hvis der er stemning for det vil jeg committe det snarest. Og
printdialog+body kan evt flyttes til guienv/utils.

/Peter

From datpete@asgaard.mjolner.dk Wed Nov 25 13:17:06 1998
X-UIDL: ecefb3230e016bf4895c80ff7bbe6dd9
Return-Path: <datpete@asgaard.mjolner.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 12057 invoked from network); 25 Nov 1998 13:17:06 -0000
Received: from asgaard.mjolner.dk (130.225.8.217)
  by noatun.mjolner.dk with SMTP; 25 Nov 1998 13:17:06 -0000
Received: (from datpete@localhost)
	by asgaard.mjolner.dk (8.8.7/8.8.7) id OAA00311;
	Wed, 25 Nov 1998 14:17:04 +0100 (MET)
From: Peter Andersen <datpete@mjolner.dk>
Message-Id: <199811251317.OAA00311@asgaard.mjolner.dk>
Subject: Re: Guienv print dialog
To: datpete@cs.au.dk (Peter Andersen)
Date: Wed, 25 Nov 1998 14:17:03 +0100 (MET)
Cc: jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk, gram@cs.au.dk,
        mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk (Elmer Sandvad),
        toby@mjolner.dk (Michael Christensen)
In-Reply-To: <199811242052.VAA02024@ariel.cs.au.dk> from "Peter Andersen" at Nov 24, 98 09:52:37 pm
Organization: Mjolner Informatics A/S
X-Mailer: ELM [version 2.4 PL25]
Content-Type: text
Status: OR

Ups - jeg havde glemt at min 'beta' folder var paranoidt beskkyttet.
Den skulle nu være læsbar for gruppe beta.

Samtidig har jeg udvidet diskussionslisten med Elmer og Toby.
Findes der i dag en print dialog til UNIX freja?

Generel ekstra kommanter: Bør man opdele i 2 dialoger - een for page setup
(page size etc) og en for print?
Sådan er det vist på PC og Mac normalt. Egenskaberne fra PageSetup dialogen
gemmes normalt i dokumentet, mens settings i print dialog er transiente.

Bemærk at min UNIX print dialog ikke resizer korrekt. Jeg tror jeg vil slå resize fra i stedet for at implementere pæn resize.

/Peter



Peter Andersen writes:
> 
> Så vidt jeg kan se er en standard print dialog ikke inkluderet 
> i guienv/stddialogs eller guienv/prompts.
> 
> På mac og pc kan der vel laves et interface det OS'ens standard
> dialog, men på UNIX er man nok nødt til selv at lave den.
> 
> Jeg har lavet et foreløbigt forslag til et API for en print dialog:
> /users/datpete/beta/bifrost/bdraw/printdialog.bet (ligger i bdraw
> selvom den er uafhængig af bifrost - bruges foreløbig kun i min
> private udgave af bdraw).
> 
> Jeg har endvidere lavet en body for denne, der udvider en
> PromptForText til at spørge om et par ting mere.
> Prøv på solaris: /users/datpete/beta/bifrost/bdraw/bdraw og sig
> Cntl-P for at aktivere dialogen.
> 
> Det er ikke helt nemt at lave den pænt, og jeg har måttet tilføje
> to attributter til guienv/prompts.bet:
> 
>      extra_hspace:< integerValue
>        (* Extra horizontal space to put to the right of the fields
> *);
>      extra_vspace:< integerValue
>        (* Extra vertical space to put between the fields and the
> buttons *);
> 
> Jeg mangler endnu at tilføje "Destination: Printer/File" og
> "Orientation: Portrait/Landscape", men inden jeg gør det vil jeg lige
> høre guienv/bifrost folket:
> 
> Synes man jeg skal arbejde videre på denne?
> Kunne man forestille sig at lave implementationer baseret på 
> standard OS dialogerne på mac/pc givet den API jeg har skitseret i
> printdialog.bet? Jeg har set at der i hvert fald i bdraw_ntibody
> er en anvendelse af PC printdialogen, men jeg ved ikke om det passer
> ind i den foreslåede API.
> 
> Hvis der er stemning for det vil jeg committe det snarest. Og
> printdialog+body kan evt flyttes til guienv/utils.
> 
> /Peter
> 


From jlknudsen@cs.au.dk Wed Nov 25 14:45:23 1998
X-UIDL: 3ed37a1f3db2610897607c70dc6f62ad
Return-Path: <jlknudsen@cs.au.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 16273 invoked from network); 25 Nov 1998 14:45:21 -0000
Received: from cs.au.dk (130.225.16.1)
  by noatun.mjolner.dk with SMTP; 25 Nov 1998 14:45:21 -0000
Received: from corona (corona [130.225.16.173])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id PAA04239;
	Wed, 25 Nov 1998 15:45:14 +0100 (MET)
From: "Jorgen Lindskov Knudsen" <jlknudsen@cs.au.dk>
To: "Peter Andersen" <datpete@mjolner.dk>,
        "Peter Andersen" <datpete@cs.au.dk>
Cc: <jlk@cs.au.dk>, <henryml@cs.au.dk>, <les@cs.au.dk>,
        <gram@cs.au.dk>, <mannan@cs.au.dk>, <pa@mjolner.com>,
        "Elmer Sandvad" <ess@cs.au.dk>,
        "Michael Christensen" <toby@mjolner.dk>
Subject: RE: Guienv print dialog
Date: Wed, 25 Nov 1998 15:45:14 +0100
Message-ID: <007201be1882$36103700$ad10e182@corona.daimi.aau.dk>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook 8.5, Build 4.71.2173.0
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V4.72.2106.4
In-Reply-To: <199811251317.OAA00311@asgaard.mjolner.dk>
Status: OR

jeg synes klart, at den skal opdeles i to dialoger.

Men jeg kan stadig ikke finde programmet :-)  Er det på daimi, eller
mjolner - jeg har forsøgt begge steder :-)

--- jlk

> -----Original Message-----
> From: Peter Andersen [mailto:datpete@mjolner.dk]
> Sent: 25. november 1998 14:17
> To: Peter Andersen
> Cc: jlk@cs.au.dk; henryml@cs.au.dk; les@cs.au.dk;
> gram@cs.au.dk; mannan@cs.au.dk; pa@mjolner.com; Elmer Sandvad;
> Michael Christensen
> Subject: Re: Guienv print dialog
>
>
> Ups - jeg havde glemt at min 'beta' folder var paranoidt beskkyttet.
> Den skulle nu være læsbar for gruppe beta.
>
> Samtidig har jeg udvidet diskussionslisten med Elmer og Toby.
> Findes der i dag en print dialog til UNIX freja?
>
> Generel ekstra kommanter: Bør man opdele i 2 dialoger - een for page setup
> (page size etc) og en for print?
> Sådan er det vist på PC og Mac normalt. Egenskaberne fra
> PageSetup dialogen
> gemmes normalt i dokumentet, mens settings i print dialog er transiente.
>
> Bemærk at min UNIX print dialog ikke resizer korrekt. Jeg tror
> jeg vil slå resize fra i stedet for at implementere pæn resize.
>
> /Peter
>
>
>
> Peter Andersen writes:
> >
> > Så vidt jeg kan se er en standard print dialog ikke inkluderet
> > i guienv/stddialogs eller guienv/prompts.
> >
> > På mac og pc kan der vel laves et interface det OS'ens standard
> > dialog, men på UNIX er man nok nødt til selv at lave den.
> >
> > Jeg har lavet et foreløbigt forslag til et API for en print dialog:
> > /users/datpete/beta/bifrost/bdraw/printdialog.bet (ligger i bdraw
> > selvom den er uafhængig af bifrost - bruges foreløbig kun i min
> > private udgave af bdraw).
> >
> > Jeg har endvidere lavet en body for denne, der udvider en
> > PromptForText til at spørge om et par ting mere.
> > Prøv på solaris: /users/datpete/beta/bifrost/bdraw/bdraw og sig
> > Cntl-P for at aktivere dialogen.
> >
> > Det er ikke helt nemt at lave den pænt, og jeg har måttet tilføje
> > to attributter til guienv/prompts.bet:
> >
> >      extra_hspace:< integerValue
> >        (* Extra horizontal space to put to the right of the fields
> > *);
> >      extra_vspace:< integerValue
> >        (* Extra vertical space to put between the fields and the
> > buttons *);
> >
> > Jeg mangler endnu at tilføje "Destination: Printer/File" og
> > "Orientation: Portrait/Landscape", men inden jeg gør det vil jeg lige
> > høre guienv/bifrost folket:
> >
> > Synes man jeg skal arbejde videre på denne?
> > Kunne man forestille sig at lave implementationer baseret på
> > standard OS dialogerne på mac/pc givet den API jeg har skitseret i
> > printdialog.bet? Jeg har set at der i hvert fald i bdraw_ntibody
> > er en anvendelse af PC printdialogen, men jeg ved ikke om det passer
> > ind i den foreslåede API.
> >
> > Hvis der er stemning for det vil jeg committe det snarest. Og
> > printdialog+body kan evt flyttes til guienv/utils.
> >
> > /Peter
> >
>
>


From datpete@fraxinus.cs.au.dk Wed Nov 25 20:31:43 1998
X-UIDL: 7a04c64d466ec5a8c897872c3bccb2c7
Return-Path: <datpete@fraxinus.cs.au.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 20347 invoked from network); 25 Nov 1998 20:31:43 -0000
Received: from fraxinus.cs.au.dk (130.225.16.39)
  by noatun.mjolner.dk with SMTP; 25 Nov 1998 20:31:43 -0000
Received: (from datpete@localhost)
	by fraxinus.cs.au.dk (8.9.1/8.9.1) id VAA18991;
	Wed, 25 Nov 1998 21:31:38 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811252031.VAA18991@fraxinus.cs.au.dk>
Subject: Re: Guienv print dialog
To: jlknudsen@cs.au.dk (Jorgen Lindskov Knudsen)
Date: Wed, 25 Nov 1998 21:31:36 +0100 (MET)
Cc: datpete@mjolner.dk, datpete@cs.au.dk, jlk@cs.au.dk,
        henryml@cs.au.dk, les@cs.au.dk, gram@cs.au.dk,
        mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk, toby@mjolner.dk
In-Reply-To: <007201be1882$36103700$ad10e182@corona.daimi.aau.dk> from Jorgen Lindskov Knudsen at "Nov 25, 98 03:45:14 pm"
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Status: OR

Efter at have tænkt over print problemet i guienv i en dags tid
kommer her et noget omstruktureret forslag. Det er ikke implementeret,
men er blot et design forslag.

Der er to problemer, jeg mener bliver løst med dette:

1. Vi vil gerne have en PrintWindow metode helt oppe
   i GUIENV.window (eller i windowitem?).
   Lennert har faktisk lavet en fuld implementation af
   et sådant interface til PC. Det er det kode, Mannan
   har fået.
   Der var det problem, at der var en Device Context parameter
   synlig i interfacet. Dette er PC specifikt.
   Jeg har en ca. 50% implementation for i hvert fald Bifrost
   vinduer (PostScript baseret). Men det er kun i bdraw. Kan
   dog løftes op i ihvert fald Bifrost, men evt helt op i
   GUIENV, blot vil det ikke i første omgang blive implementeret
   for alle vindues typer (man kan "nemt" gøre det for textedit
   vinduer ved at kopiere postscript genereringen for TextShape
   i bifrost.
   Jeg mener Lennerts forslag vil være et fint udgangspunkt.
   Jeg har ikke koden, men vil Mannan eller Lennert lige sende
   det ud i diskussionen, så vi kan vurdere det?

2. Vi vil gerne have et interface til en print dialog. Igen er der
   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
   skal printes er meget maskinafhængig.

Jeg mener derfor at der er behov for en indpakning af denne print 
information. I mit forslag til løsning af (2), som følger nedenfor,
er der TO forskellige forslag til et PrintRecord pattern, som jeg
mener vil løse dette, samt et forslag til et meget generisk API for
en PrintDialog og en PageSetupDialog. Vi skal diskuttere om een af
disse kan bruges. Og også om det er smart med en enkelt type record
til begge dialogtyper. Her vil jeg specielt gerne have kommentarer fra
Michael og Lennert i forhold til hhv. mac og pc.

Hvis man så vedtager een eller anden PrintRecord type, og erstatter
DeviceContext parameteren i Lennerts PrintWindow forslag med en
reference til en sådan PrintRecord (som på PC tilfældigvis blot pakker
en Device Context ind (:-)), så mener jeg vi har løsningen på problem
(1).

Og så er vi tæt på at haave generel print i guienv og bifrost!!! (:-)

Dog mener jeg ikke vi kan klare os med een PrintWindow metode i
Window.
Jeg mener vi skal have:
   PrintNative
   PrintPostScript
hvor "native" er StyleWriter/InkJet lignende printere.
Disse giver normalt kun mening på PC/Mac, så jeg forestiller
mig at implementationen af PrintNative på UNIX er et kald af
PrintPostScript.

Nedenfor følger mit interface forslag. Som sagt er jeg overbevist
om at det vil fungere på UNIX, så jeg er mest interesseret i at
få specifikke Mac/PC kommentarer. Men selvfølgelig også nogle
generelle kommentarer.

/Peter

ORIGIN '~beta/guienv/utils/prompts';
BODY 'printdialogbody';

--GuienvLib: attributes--

(* Very generic interface to platform specific PrintDialogs.
 * The machine specific stuff is collected in the PrintRecord pattern.
 *)

PrintDialog:
  (* Generic Print Dialog. Used to specify "transient"
   * properties regarding the print to be performed.
   * That is, the dialog is used to specify properties
   * that are not kept in the document for later use,
   * e.g. which printer to print on, the number of copies
   * etc.
   * Dialog can include a button which activates a PageSetup
   * dialog on the same PrintRecord, but need not.
   *)
  (# ok:< Object
       (* Called when the OK button is pressed *);
     cancel:< Object
       (* Called when the Cancel button is pressed *);
     pr: ^PrintRecord
       (* Record which is filled with information obtained
        * in the dialog with the user. Existing properties
        * in the record are used as defulet in the dialog window
        *);
     popup:
       (* Opens the dialog with existing properties in
        * the PrintRecord used as defaults. If no PrintRecord is
        * specified, a default one is generated and filled 
        * with the information, the user specifies.
        *)
       (# title: ^text;
          father: ^window;
       enter (father[], title[], pr[])
       <<SLOT PrintDialogPopup: dopart>>
       exit pr[]
       #);
     private: @<<SLOT PrintDialogPrivate: descriptor>>;
  enter popup
  exit pr[]
  #);
PageSetupDialog:
  (* Generic Page setup Dialog. Used to specify "persistent"
   * properties regarding the print to be performed.
   * That is, the dialog is used to specify properties
   * that are typically kept in the document for later use,
   * e.g. paper size, orientation, etc.
   *)
  (# ok:< Object
       (* Called when the OK button is pressed *);
     cancel:< Object
       (* Called when the Cancel button is pressed *);
     pr: ^PrintRecord
       (* Record which is filled with information obtained
        * in the dialog with the user. Existing properties
        * in the record are used as defulet in the dialog window
        *);
     popup:
       (* Opens the dialog with existing properties in
        * the PrintRecord used as defaults. If no PrintRecord is
        * specified, a default one is generated and filled 
        * with the information, the user specifies.
        *)
       (# title: ^text;
          father: ^window;
       enter (father[], title[], pr[])
       <<SLOT PageSetupDialogPopup: dopart>>
       exit pr[]
       #);
     private: @<<SLOT PageSetupDialogPrivate: descriptor>>;
  enter popup
  exit pr[]
  #);


--LIB: attributes--

PrintRecord:
  (* Suggestion one: No properties visible in interface.
   * Machine specific uses will have to include machine dependent
   * bodies.
   *)
  <<SLOT PrintRecordBody: Descriptor>>;

PrintRecord:
  (* Suggestion two: Machine dependent properties visible.
   * A little overhead in space, and not "pretty". 
   * But probably easier to use.
   * Typical use on UNIX:
   *   aPrintRecord.UNIX.numcopies -> n;
   * Typical use on Macintosh:
   *   %getLongAt(@@aPrintRecord.Macintosh.GP+anInterestingOffset) -> x;
   * Typical use on PC:
   *   %getLongAt(@@aPrintRecord.Win32.HDC) -> myHandle; 
   *)
  (# Macintosh: @
       (# GP: @integer (* GrafPtr *);
          (* anything else ? *)
       #);
     Win32: @
       (# HDC: @integer (* Handle to device context *)
          (* anything else ? *)
       #)
     UNIX: @
       (# (* Page setup properties *)
          papersize: @point;
          orientation: @integer;
          fitToPaper: @boolean;
          (* Print properties *)
          printToFile: @boolean;
          filename: ^text;
          printcommand: ^text;
          numcopies: @integer;
          (* Probably some more ... *)
       #);
  #);
     

(* Paper sizes in PostScript pixels: 
 *   1 Inch is 25.4 mm.
 *   1 Inch is 72 PostScript pixels
 *   A4 is        210mm x 297mm
 *   Letter is    8.5 x 11 inches
 *   Legal is     8.5 x 14 inches
 *   Executive is 7.5 x 10 inches
 *)
paper_A4:     
  (# exit (595 (* 210*(72/25.4) *), 842 (* 297*(72/25.4) *)) #);
paper_Letter: 
  (# exit (612 (* 8.5*72 *),        792 (* 11*72 *)) #);
paper_Legal:     
  (# exit (612 (* 8.5*72 *),        1008(* 14*72 *)) #);
paper_Executive: 
  (# exit (540 (* 7.5*72 *),        720 (* 10*72 *)) #);

(* Constants specifying paper orientation *)
orientation_portrait:
  (# exit 0 #);
orientation_landscape:
  (# exit 1 #);


From datpete@fraxinus.cs.au.dk Wed Nov 25 22:13:54 1998
X-UIDL: 1ab3e67e1293efe7e91fd9301b56cb9b
Return-Path: <datpete@fraxinus.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 629 invoked from network); 25 Nov 1998 22:13:54 -0000
Received: from ns.dk.net (root@193.88.44.42)
  by noatun.mjolner.dk with SMTP; 25 Nov 1998 22:13:54 -0000
Received: from fraxinus.cs.au.dk (fraxinus.cs.au.dk [130.225.16.39])
	by ns.DK.net (8.9.1/8.9.1) with ESMTP id WAA17086;
	Wed, 25 Nov 1998 22:37:12 +0100 (MET)
Received: (from datpete@localhost)
	by fraxinus.cs.au.dk (8.9.1/8.9.1) id WAA19326;
	Wed, 25 Nov 1998 22:36:44 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811252136.WAA19326@fraxinus.cs.au.dk>
Subject: Re: Guienv print dialog
To: datpete@cs.au.dk (Peter Andersen)
Date: Wed, 25 Nov 1998 22:36:44 +0100 (MET)
Cc: jlknudsen@cs.au.dk, datpete@mjolner.dk, datpete@cs.au.dk,
        jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
In-Reply-To: <199811252031.VAA18991@fraxinus.cs.au.dk> from Peter Andersen at "Nov 25, 98 09:31:36 pm"
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Status: OR

Jeg har checket den print dialog, der er i WorkSheet vinduer i freja.
Er funktionaliteten med print from page x to page y implementeret?
Under alle omstændigheder skal dette nok tilføjes til min UNIX
printrecord.

/Peter

From henryml@cs.au.dk Thu Nov 26 00:08:55 1998
X-UIDL: 1bd08d63324d7032b884152ba6435851
Return-Path: <henryml@cs.au.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 941 invoked from network); 26 Nov 1998 00:08:55 -0000
Received: from cs.au.dk (130.225.16.1)
  by noatun.mjolner.dk with SMTP; 26 Nov 1998 00:08:55 -0000
Received: from [130.225.18.210] (lissi-06 [130.225.18.210])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id BAA02519;
	Thu, 26 Nov 1998 01:08:48 +0100 (MET)
Message-Id: <199811260008.BAA02519@cs.au.dk>
X-Mailer: Microsoft Outlook Express for Macintosh - 4.01 (295) 
Date: Thu, 26 Nov 1998 01:12:52 +0100
Subject: Re: Guienv print dialog
From: "Michael Lassen" <henryml@cs.au.dk>
To: Peter Andersen <datpete@cs.au.dk>,
        Jorgen Lindskov Knudsen <jlknudsen@cs.au.dk>
CC: datpete@mjolner.dk, datpete@cs.au.dk, jlk@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
Mime-version: 1.0
X-Priority: 3
Content-type: text/plain; charset="ISO-8859-1"
Content-transfer-encoding: quoted-printable
Status: OR



Peter skriver

>Efter at have t=E6nkt over print problemet i guienv i en dags tid
>kommer her et noget omstruktureret forslag. Det er ikke implementeret,
>men er blot et design forslag.
>
>Der er to problemer, jeg mener bliver l=F8st med dette:
>
>1. Vi vil gerne have en PrintWindow metode helt oppe
>   i GUIENV.window (eller i windowitem?).

Hvis et vindue indeholder fx. et knap-panel og scrollbarer
udover det bifrostcanvas som skal printes er det vel ikke selve
vinduet der skal siges print til, men selve bifrostcanvas'et -
det antyder at "print" operationen skal v=E6re p=E5 WindowItem i stedet
for Window.

[ KLIP ]

>2. Vi vil gerne have et interface til en print dialog. Igen er der
>   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
>   skal printes er meget maskinafh=E6ngig.
>
>Jeg mener derfor at der er behov for en indpakning af denne print
>information. I mit forslag til l=F8sning af (2), som f=F8lger nedenfor,
>er der TO forskellige forslag til et PrintRecord pattern, som jeg
>mener vil l=F8se dette, samt et forslag til et meget generisk API for
>en PrintDialog og en PageSetupDialog. Vi skal diskuttere om een af
>disse kan bruges. Og ogs=E5 om det er smart med en enkelt type record
>til begge dialogtyper. Her vil jeg specielt gerne have kommentarer fra
>Michael og Lennert i forhold til hhv. mac og pc.
>

P=E5 mac platformen er der fuld underst=F8ttelse for at kalde en
PageSetupDialog og efterf=F8lgende en PrintDialog som udfylder
felter i en PrintRecord, som derefter kan bruges n=E5r man printer.

Der er vel ingen grund til at eksponere denne print record  i interfacet
mere end allerh=F8jst n=F8dvendigt ?

Muligvis b=F8r man give et interface til at afl=E6se

  - PaperSize/PageSize
  - Range af sider der skal printes.

Det f=F8rste af hensyn til at man kan lave evt. ombrydning af dokumentet
i forhold til st=F8rrelsen af papiret.

Range af sider af hensyn til at man kan n=F8jes med at forberede
de sider der rent faktisk skal printes.

Fx. kunne man forestille sig en applikation som printer ved at
konstrure et BifrostCanvas per side on the fly, som derefter
printes vha. BifrostCanvas.print

PaperSize og Range burde v=E6re tilg=E6ngelige p=E5 alle platforme.

--
Michael


>Hvis man s=E5 vedtager een eller anden PrintRecord type, og erstatter
>DeviceContext parameteren i Lennerts PrintWindow forslag med en
>reference til en s=E5dan PrintRecord (som p=E5 PC tilf=E6ldigvis blot pakker
>en Device Context ind (:-)), s=E5 mener jeg vi har l=F8sningen p=E5 problem
>(1).
>
>Og s=E5 er vi t=E6t p=E5 at haave generel print i guienv og bifrost!!! (:-)
>
>Dog mener jeg ikke vi kan klare os med een PrintWindow metode i
>Window.
>Jeg mener vi skal have:
>   PrintNative
>   PrintPostScript
>hvor "native" er StyleWriter/InkJet lignende printere.
>Disse giver normalt kun mening p=E5 PC/Mac, s=E5 jeg forestiller
>mig at implementationen af PrintNative p=E5 UNIX er et kald af
>PrintPostScript.
>
>Nedenfor f=F8lger mit interface forslag. Som sagt er jeg overbevist
>om at det vil fungere p=E5 UNIX, s=E5 jeg er mest interesseret i at
>f=E5 specifikke Mac/PC kommentarer. Men selvf=F8lgelig ogs=E5 nogle
>generelle kommentarer.
>
>/Peter
>
>ORIGIN '~beta/guienv/utils/prompts';
>BODY 'printdialogbody';
>
>--GuienvLib: attributes--
>
>(* Very generic interface to platform specific PrintDialogs.
> * The machine specific stuff is collected in the PrintRecord pattern.
> *)
>
>PrintDialog:
>  (* Generic Print Dialog. Used to specify "transient"
>   * properties regarding the print to be performed.
>   * That is, the dialog is used to specify properties
>   * that are not kept in the document for later use,
>   * e.g. which printer to print on, the number of copies
>   * etc.
>   * Dialog can include a button which activates a PageSetup
>   * dialog on the same PrintRecord, but need not.
>   *)
>  (# ok:< Object
>       (* Called when the OK button is pressed *);
>     cancel:< Object
>       (* Called when the Cancel button is pressed *);
>     pr: ^PrintRecord
>       (* Record which is filled with information obtained
>        * in the dialog with the user. Existing properties
>        * in the record are used as defulet in the dialog window
>        *);
>     popup:
>       (* Opens the dialog with existing properties in
>        * the PrintRecord used as defaults. If no PrintRecord is
>        * specified, a default one is generated and filled
>        * with the information, the user specifies.
>        *)
>       (# title: ^text;
>          father: ^window;
>       enter (father[], title[], pr[])
>       <<SLOT PrintDialogPopup: dopart>>
>       exit pr[]
>       #);
>     private: @<<SLOT PrintDialogPrivate: descriptor>>;
>  enter popup
>  exit pr[]
>  #);
>PageSetupDialog:
>  (* Generic Page setup Dialog. Used to specify "persistent"
>   * properties regarding the print to be performed.
>   * That is, the dialog is used to specify properties
>   * that are typically kept in the document for later use,
>   * e.g. paper size, orientation, etc.
>   *)
>  (# ok:< Object
>       (* Called when the OK button is pressed *);
>     cancel:< Object
>       (* Called when the Cancel button is pressed *);
>     pr: ^PrintRecord
>       (* Record which is filled with information obtained
>        * in the dialog with the user. Existing properties
>        * in the record are used as defulet in the dialog window
>        *);
>     popup:
>       (* Opens the dialog with existing properties in
>        * the PrintRecord used as defaults. If no PrintRecord is
>        * specified, a default one is generated and filled
>        * with the information, the user specifies.
>        *)
>       (# title: ^text;
>          father: ^window;
>       enter (father[], title[], pr[])
>       <<SLOT PageSetupDialogPopup: dopart>>
>       exit pr[]
>       #);
>     private: @<<SLOT PageSetupDialogPrivate: descriptor>>;
>  enter popup
>  exit pr[]
>  #);
>
>
>--LIB: attributes--
>
>PrintRecord:
>  (* Suggestion one: No properties visible in interface.
>   * Machine specific uses will have to include machine dependent
>   * bodies.
>   *)
>  <<SLOT PrintRecordBody: Descriptor>>;
>
>PrintRecord:
>  (* Suggestion two: Machine dependent properties visible.
>   * A little overhead in space, and not "pretty".
>   * But probably easier to use.
>   * Typical use on UNIX:
>   *   aPrintRecord.UNIX.numcopies -> n;
>   * Typical use on Macintosh:
>   *   %getLongAt(@@aPrintRecord.Macintosh.GP+anInterestingOffset) -> x;
>   * Typical use on PC:
>   *   %getLongAt(@@aPrintRecord.Win32.HDC) -> myHandle;
>   *)
>  (# Macintosh: @
>       (# GP: @integer (* GrafPtr *);
>          (* anything else ? *)
>       #);
>     Win32: @
>       (# HDC: @integer (* Handle to device context *)
>          (* anything else ? *)
>       #)
>     UNIX: @
>       (# (* Page setup properties *)
>          papersize: @point;
>          orientation: @integer;
>          fitToPaper: @boolean;
>          (* Print properties *)
>          printToFile: @boolean;
>          filename: ^text;
>          printcommand: ^text;
>          numcopies: @integer;
>          (* Probably some more ... *)
>       #);
>  #);
>
>
>(* Paper sizes in PostScript pixels:
> *   1 Inch is 25.4 mm.
> *   1 Inch is 72 PostScript pixels
> *   A4 is        210mm x 297mm
> *   Letter is    8.5 x 11 inches
> *   Legal is     8.5 x 14 inches
> *   Executive is 7.5 x 10 inches
> *)
>paper_A4:
>  (# exit (595 (* 210*(72/25.4) *), 842 (* 297*(72/25.4) *)) #);
>paper_Letter:
>  (# exit (612 (* 8.5*72 *),        792 (* 11*72 *)) #);
>paper_Legal:
>  (# exit (612 (* 8.5*72 *),        1008(* 14*72 *)) #);
>paper_Executive:
>  (# exit (540 (* 7.5*72 *),        720 (* 10*72 *)) #);
>
>(* Constants specifying paper orientation *)
>orientation_portrait:
>  (# exit 0 #);
>orientation_landscape:
>  (# exit 1 #);
>
>

From les@daimi.aau.dk Sun Nov 29 23:16:40 1998
X-UIDL: 218a77992567599db49a75ba69fbd1aa
Return-Path: <les@daimi.aau.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 23188 invoked from network); 29 Nov 1998 23:16:40 -0000
Received: from cs.au.dk (130.225.16.1)
  by noatun.mjolner.dk with SMTP; 29 Nov 1998 23:16:40 -0000
Received: from royalhome (lissi-03 [130.225.18.207])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id AAA13520;
	Mon, 30 Nov 1998 00:16:31 +0100 (MET)
Message-Id: <199811292316.AAA13520@cs.au.dk>
From: "Lennert Sloth" <les@daimi.aau.dk>
To: "Peter Andersen" <datpete@cs.au.dk>
Cc: <jlk@cs.au.dk>, <henryml@cs.au.dk>, <les@cs.au.dk>,
        <gram@cs.au.dk>, <mannan@cs.au.dk>, <pa@mjolner.com>,
        <ess@cs.au.dk>, <toby@mjolner.dk>
Subject: Re: Guienv print dialog
Date: Mon, 30 Nov 1998 00:26:43 +0100
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 4.71.1712.3
X-MimeOLE: Produced By Microsoft MimeOLE V4.71.1712.3
Status: OR

- Mht. "print" og "page setup" dialoger:
  Så vidt jeg kan se, er der ikke nogen problemer ved at bruge de foreslåede
interfaces til print hhv. page setup dialogerne på windows. "PrintRecord"
skal dog have en "dispose" operation, da fx. den allokerede device context
skal frigives igen.

- Mht. print metode:
Hvad definerer et dokument (og dermed et print job)?
Hvis indholdet af et windowitem udgør et dokument er det fint med en print
operation på windowitem. Hvis indholdet af flere windowitems skal kunne
printes i samme dokument/print job dur det vel ikke?

Det interface jeg lavede til bdraw ser ud som flg.:
PrintDocument:
  (#
     <<SLOT printDocumentAttr: attributes>>;

     resourceAllocationError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);

     apiError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);

     PrintPage:<
       (# gHdc: @integer;
          morePages: @boolean;
       enter gHdc
       do inner printPage;
       exit morePages
       #);

     (* DocWindow must NOT be NONE *)
     DocWindow: ^window;
     DocTitle: ^text;

  enter (DocWindow[],DocTitle[])
  <<SLOT printDocumentImpl: doPart>>
#)

Med de nye dialoger skal gHdc skiftes ud med en PrintRecord.

-- Lennert

-----Original Message-----
[stuff deleted]
>Der er to problemer, jeg mener bliver løst med dette:
>
>1. Vi vil gerne have en PrintWindow metode helt oppe
>   i GUIENV.window (eller i windowitem?).

[stuff deleted]
>
>2. Vi vil gerne have et interface til en print dialog. Igen er der
>   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
>   skal printes er meget maskinafhængig.
>
[stuff deleted]




From henryml@cs.au.dk Sun Nov 29 23:38:34 1998
X-UIDL: f32c879bfd882666df9346690d99655d
Return-Path: <henryml@cs.au.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 23202 invoked from network); 29 Nov 1998 23:38:34 -0000
Received: from cs.au.dk (130.225.16.1)
  by noatun.mjolner.dk with SMTP; 29 Nov 1998 23:38:34 -0000
Received: from [194.234.182.15] (pm33-15.image.dk [194.234.182.15])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id AAA14194;
	Mon, 30 Nov 1998 00:38:27 +0100 (MET)
Message-Id: <199811292338.AAA14194@cs.au.dk>
X-Mailer: Microsoft Outlook Express for Macintosh - 4.01 (295) 
Date: Mon, 30 Nov 1998 00:42:35 +0100
Subject: Re: Guienv print dialog
From: "Michael Lassen" <henryml@cs.au.dk>
To: Lennert Sloth <les@daimi.aau.dk>, Peter Andersen <datpete@cs.au.dk>
CC: jlk@cs.au.dk, les@cs.au.dk, gram@cs.au.dk, mannan@cs.au.dk,
        pa@mjolner.com, ess@cs.au.dk, toby@mjolner.dk
Mime-version: 1.0
X-Priority: 3
Content-type: text/plain; charset="ISO-8859-1"
Content-transfer-encoding: quoted-printable
Status: OR


>
>- Mht. print metode:
>Hvad definerer et dokument (og dermed et print job)?
>Hvis indholdet af et windowitem udg=F8r et dokument er det fint med en print
>operation p=E5 windowitem. Hvis indholdet af flere windowitems skal kunne
>printes i samme dokument/print job dur det vel ikke?

Kan man ikke bare placere de forskellige windowItems i
et canvas, og s=E5 printe det?




>
>Det interface jeg lavede til bdraw ser ud som flg.:
>PrintDocument:
>  (#
>     <<SLOT printDocumentAttr: attributes>>;
>
>     resourceAllocationError:< exception
>       (# errorMsg: ^text;
>       enter errorMsg[]
>       do inner;
>       #);
>
>     apiError:< exception
>       (# errorMsg: ^text;
>       enter errorMsg[]
>       do inner;
>       #);
>
>     PrintPage:<
>       (# gHdc: @integer;
>          morePages: @boolean;
>       enter gHdc
>       do inner printPage;
>       exit morePages
>       #);
>
>     (* DocWindow must NOT be NONE *)
>     DocWindow: ^window;
>     DocTitle: ^text;
>
>  enter (DocWindow[],DocTitle[])
>  <<SLOT printDocumentImpl: doPart>>
>#)
>
>Med de nye dialoger skal gHdc skiftes ud med en PrintRecord.
>
>-- Lennert
>
>-----Original Message-----
>[stuff deleted]
>>Der er to problemer, jeg mener bliver l=F8st med dette:
>>
>>1. Vi vil gerne have en PrintWindow metode helt oppe
>>   i GUIENV.window (eller i windowitem?).
>
>[stuff deleted]
>>
>>2. Vi vil gerne have et interface til en print dialog. Igen er der
>>   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
>>   skal printes er meget maskinafh=E6ngig.
>>
>[stuff deleted]
>
>
>
>

From datpete@fraxinus.cs.au.dk Mon Nov 30 10:27:36 1998
X-UIDL: 78da81536d48c0939b75490d47cf1b96
Return-Path: <datpete@fraxinus.cs.au.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 24874 invoked from network); 30 Nov 1998 10:27:36 -0000
Received: from fraxinus.cs.au.dk (130.225.16.39)
  by noatun.mjolner.dk with SMTP; 30 Nov 1998 10:27:36 -0000
Received: (from datpete@localhost)
	by fraxinus.cs.au.dk (8.9.1/8.9.1) id LAA16697;
	Mon, 30 Nov 1998 11:27:33 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811301027.LAA16697@fraxinus.cs.au.dk>
Subject: Re: Guienv print dialog
To: les@daimi.aau.dk (Lennert Sloth)
Date: Mon, 30 Nov 1998 11:27:33 +0100 (MET)
Cc: datpete@cs.au.dk, jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
In-Reply-To: <199811292316.AAA13520@cs.au.dk> from Lennert Sloth at "Nov 30, 98 00:26:43 am"
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Status: OR

Lennert Sloth writes:
> - Mht. "print" og "page setup" dialoger:
>   Så vidt jeg kan se, er der ikke nogen problemer ved at bruge de foreslåede
> interfaces til print hhv. page setup dialogerne på windows. "PrintRecord"
> skal dog have en "dispose" operation, da fx. den allokerede device context
> skal frigives igen.

OK. Det vil jeg gøre. Jeg er stille og roligt i gang med at
implementere nogle af disse ting i et private directory.
Jeg vil forsøge at få Lennerts kode til at virke inden jeg "frigiver"
det.

> 
> - Mht. print metode:
> Hvad definerer et dokument (og dermed et print job)?

Det skal vi naturligvis diskuttere. Vi kan dog f.eks. starte
med at det er et Window, og evt udvide det senere.

> Hvis indholdet af et windowitem udgør et dokument er det fint med en print
> operation på windowitem. Hvis indholdet af flere windowitems skal kunne
> printes i samme dokument/print job dur det vel ikke?
> 
> Det interface jeg lavede til bdraw ser ud som flg.:

Lennert, er nedenstående ikke i virkeligheden en tilføjelse af
en PrintDocument *virtuel* til Window? Det kan selvfølgelig
ikke lade sig gøre i et LIB slot (hvor dette stammer fra), men
det kan simuleres ved at tage en Window reference ind som parameter,
som du gør.

Jeg har set "den anden" fil (jeg vedlægger begge i fuld længde
nedenfor af hensyn til de øvrige i diskussionen.
Dette mener jeg svarer til en virtuel viderebinding af printpage
i et bifrostcanvas.

> PrintDocument:
>   (#
>      <<SLOT printDocumentAttr: attributes>>;
> 
>      resourceAllocationError:< exception
>        (# errorMsg: ^text;
>        enter errorMsg[]
>        do inner;
>        #);
> 
>      apiError:< exception
>        (# errorMsg: ^text;
>        enter errorMsg[]
>        do inner;
>        #);
> 
>      PrintPage:<
>        (# gHdc: @integer;
>           morePages: @boolean;
>        enter gHdc
>        do inner printPage;
>        exit morePages
>        #);
> 
>      (* DocWindow must NOT be NONE *)
>      DocWindow: ^window;
>      DocTitle: ^text;
> 
>   enter (DocWindow[],DocTitle[])
>   <<SLOT printDocumentImpl: doPart>>
> #)
> 
> Med de nye dialoger skal gHdc skiftes ud med en PrintRecord.
> 
Jeps.

En anden ting, som jeg har tænkt på: En sådan printDocument
operation aktiverer jo print dialogen bag om ryggen på
brugeren. Derfor kan man spørge: Er der brug for en synlig API for
selve printdialogen?

/Peter


Lennerts oprindelige forslag i fuld længde:

printLib.bet:
=============

ORIGIN '~beta/guienv/v1.6/guienv';
BODY 'printLibBody';


-- guienvLib: attributes --

PrintDocument:
  (# 
     <<SLOT printDocumentAttr: attributes>>;
     
     resourceAllocationError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);
     
     apiError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);
     
     PrintPage:<
       (# gHdc: @integer;
          morePages: @boolean;
       enter gHdc
       do inner printPage;
       exit morePages
       #);
     
     (* DocWindow must NOT be NONE *) 
     DocWindow: ^window;
     DocTitle: ^text;
     
  enter (DocWindow[],DocTitle[])
  <<SLOT printDocumentImpl: doPart>>
#)


printBifrostPage.bet:
======================

ORIGIN '../Bifrost';
BODY 'printBifrostPageBody';

INCLUDE 
'../SelectionPicture';

-- BifrostAttributes: attributes --

printBifrostPage:
  (# 
     margin: (# exit (20, 20) #);
     A4: (# exit (0, 0, 595, 822) (* in points (1/72 inch) *) #);
     
     
     (* hdc is a handle to the printer device context *)
     hdc: @integer;
     
     (* MainCanvas is the BifrostCanvas containing the graphics to be printed.
      *)
      MainCanvas: ^BifrostCanvas;
     
     (* If the selection has been moved or otherwise transformed, this 
      * transformation is only registered by the selection TM matrix.
      * To handle this the selection can be entered.
      *)
     TheSelection: ^SelectionPicture;
     
  enter (hdc,MainCanvas[],TheSelection[])
  <<SLOT printBifrostPageImpl: doPart>>
  #);

From henryml@daimi.aau.dk Mon Nov 30 10:39:04 1998
X-UIDL: 9c23c9253cf033debf198a7fc84d1162
Return-Path: <henryml@daimi.aau.dk>
Delivered-To: pa@mjolner.com
Received: (qmail 24930 invoked from network); 30 Nov 1998 10:39:04 -0000
Received: from cs.au.dk (130.225.16.1)
  by noatun.mjolner.dk with SMTP; 30 Nov 1998 10:39:04 -0000
Received: from [130.225.17.89] (beijing [130.225.17.89])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id LAA06099;
	Mon, 30 Nov 1998 11:38:46 +0100 (MET)
Message-Id: <v02130502b288268a49fa@[130.225.17.89]>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Date: Mon, 30 Nov 1998 11:43:18 +0100
To: Peter Andersen <datpete@cs.au.dk>, les@daimi.aau.dk (Lennert Sloth)
From: henryml@daimi.aau.dk (Michael Lassen)
Subject: Re: Guienv print dialog
Cc: datpete@cs.au.dk, jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
Status: OR

>> - Mht. print metode:
>> Hvad definerer et dokument (og dermed et print job)?
>
>Det skal vi naturligvis diskuttere. Vi kan dog f.eks. starte
>med at det er et Window, og evt udvide det senere.
>

Jeg kom ellers med (efter min mening) gode argumenter
for at window var en d=E5rlig ide.

Hvad var der galt med mit argument?

Hvis man definere vinduet som det der skal printes -
betyder det s=E5 at scrollbaren skal printes med? Eller
skal man l=F8be vinduet igennem og finde alle "dokument-agtige"
windowitems? Hvordan kan man p=E5 Window niveau vide
hvilke dele af vinduets grafik der skal ud p=E5 printeren?

--
Michael



From datpete@ariel.cs.au.dk Mon Dec 20 13:10:16 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24688 invoked from network); 20 Dec 1999 13:10:16 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:16 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27695
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:15 +0100 (MET)
Received: from oban (oban [130.225.16.8])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id VAA10828
	for <datpete@cs.au.dk>; Tue, 24 Nov 1998 21:57:54 +0100 (MET)
Message-Id: <3.0.1.32.19981124215802.009f5780@daimi.aau.dk>
X-Sender: les@daimi.aau.dk
X-Mailer: Windows Eudora Pro Version 3.0.1 (32)
Date: Tue, 24 Nov 1998 21:58:02 +0100
To: Peter Andersen <datpete@cs.au.dk>
From: Lennert Sloth <les@daimi.aau.dk>
Subject: Re: Guienv print dialog
In-Reply-To: <199811242052.VAA02024@ariel.cs.au.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-UIDL: d15d4e4c194a1134953122b5d0f85159
Sender: datpete@cs.au.dk
Status: O

Jeg har ikke rettigheder til, at læse din beta folder.

-- Lennert 

At 21:52 24-11-98 +0100, you wrote:
>Så vidt jeg kan se er en standard print dialog ikke inkluderet 
>i guienv/stddialogs eller guienv/prompts.
>
>På mac og pc kan der vel laves et interface det OS'ens standard
>dialog, men på UNIX er man nok nødt til selv at lave den.
>
>Jeg har lavet et foreløbigt forslag til et API for en print dialog:
>/users/datpete/beta/bifrost/bdraw/printdialog.bet (ligger i bdraw
>selvom den er uafhængig af bifrost - bruges foreløbig kun i min
>private udgave af bdraw).
>
>Jeg har endvidere lavet en body for denne, der udvider en
>PromptForText til at spørge om et par ting mere.
>Prøv på solaris: /users/datpete/beta/bifrost/bdraw/bdraw og sig
>Cntl-P for at aktivere dialogen.
>
>Det er ikke helt nemt at lave den pænt, og jeg har måttet tilføje
>to attributter til guienv/prompts.bet:
>
>     extra_hspace:< integerValue
>       (* Extra horizontal space to put to the right of the fields
>*);
>     extra_vspace:< integerValue
>       (* Extra vertical space to put between the fields and the
>buttons *);
>
>Jeg mangler endnu at tilføje "Destination: Printer/File" og
>"Orientation: Portrait/Landscape", men inden jeg gør det vil jeg lige
>høre guienv/bifrost folket:
>
>Synes man jeg skal arbejde videre på denne?
>Kunne man forestille sig at lave implementationer baseret på 
>standard OS dialogerne på mac/pc givet den API jeg har skitseret i
>printdialog.bet? Jeg har set at der i hvert fald i bdraw_ntibody
>er en anvendelse af PC printdialogen, men jeg ved ikke om det passer
>ind i den foreslåede API.
>
>Hvis der er stemning for det vil jeg committe det snarest. Og
>printdialog+body kan evt flyttes til guienv/utils.
>
>/Peter
>
>
---------------------------------------------------
Lennert Sloth, Computer Science Department  
Aarhus University, Ny Munkegade 116, DK-8000 Aarhus 
DENMARK, email: les@cs.au.dk, phone:+45 8942 5634


From datpete@ariel.cs.au.dk Mon Dec 20 13:10:21 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24693 invoked from network); 20 Dec 1999 13:10:21 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:21 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27702
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:21 +0100 (MET)
Received: from oban (oban [130.225.16.8])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id MAA19377
	for <datpete@cs.au.dk>; Wed, 25 Nov 1998 12:43:04 +0100 (MET)
Message-Id: <3.0.1.32.19981125124307.009c2220@daimi.aau.dk>
X-Sender: les@daimi.aau.dk
X-Mailer: Windows Eudora Pro Version 3.0.1 (32)
Date: Wed, 25 Nov 1998 12:43:07 +0100
To: Peter Andersen <datpete@cs.au.dk>
From: Lennert Sloth <les@daimi.aau.dk>
Subject: Re: Guienv print dialog
In-Reply-To: <199811251046.LAA14703@fraxinus.cs.au.dk>
References: <3.0.1.32.19981124215802.009f5780@daimi.aau.dk>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-UIDL: 546df44ce5dfa3e344167088d43c77b9
Sender: datpete@cs.au.dk
Status: O

At 11:46 25-11-98 +0100, you wrote:
>Ups - jeg troede alle var med i netgruppe beta, som burde kunne se
>min beta folder.
Det troede jeg også jeg var.

>Her er det foreslåede API. Hvordan er det på PC - skelner man mellem 
>Page Setup (hvor f.eks. papirstørrelse vælges) og Print (hvor f.eks.
>antal kopier vælges)? På mac er det nemlig 2 dialoger, mens det på
>unix typisk er i samme dialog.

Der er 2 dialoger.

Den printcommand som kommer fra popup, hvordan vil den fx. se ud?
Det som man får fra en print dialog på windows er en device context, som
man skal printe sit dokument i.

-- Lennert 

>
>/Peter
>
>ORIGIN '~beta/guienv/utils/prompts';
>BODY 'printdialogbody';
>
>--GuienvLib: attributes--
>
>(* Print Dialog to be used on platforms that do not
> * have a 'native' print dialog.
> *)
>
>PrintDialog:
>  (* FIXME: Add the following to the dialog:
>      *   Print To: Printer/File 
>      *     (with Browse button for File. Suggest <currentFileName>.eps)
>      *   Orientation: Landscape/portrait
>      *)
>  (# ok:< Object;
>     printcommand: ^text;
>     numcopies: @integer;
>     papersize: ^text
>       (* Would be better if this was a rectangle, but conflict
>        * in Guienv rectangle and Bifrost Rectangle.
>        *);
>     
>     popup:
>       (# title: ^text;
>          father: ^window;
>       enter (father[], title[], printcommand[])
>       <<SLOT PrintDialogPopup: dopart>>
>       exit printcommand[]
>       #);
>     private: @<<SLOT PrintDialogPrivate: descriptor>>;
>  #);
>
>
>--LIB: attributes--
>
>(* Paper sizes in PostScript pixels: 
> *   1 Inch is 25.4 mm.
> *   1 Inch is 72 pixels
> *   A4 is        210mm x 297mm
> *   Letter is    8.5 x 11 inches
> *   Legal is     8.5 x 14 inches
> *   Executive is 7.5 x 10 inches
> *)
>paper_A4:     
>  (# exit (0, 0, 595 (* 210*(72/25.4) *), 842 (* 297*(72/25.4) *)) #);
>paper_Letter: 
>  (# exit (0, 0, 612 (* 8.5*72 *),        792 (* 11*72 *)) #);
>paper_Legal:     
>  (# exit (0, 0, 612 (* 8.5*72 *),        1008(* 14*72 *)) #);
>paper_Executive: 
>  (# exit (0, 0, 540 (* 7.5*72 *),        720 (* 10*72 *)) #);
>
>
>
---------------------------------------------------
Lennert Sloth, Computer Science Department  
Aarhus University, Ny Munkegade 116, DK-8000 Aarhus 
DENMARK, email: les@cs.au.dk, phone:+45 8942 5634


From datpete@ariel.cs.au.dk Mon Dec 20 13:10:26 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24698 invoked from network); 20 Dec 1999 13:10:26 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:26 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27705
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:25 +0100 (MET)
Received: from asgaard.mjolner.dk (asgaard.mjolner.dk [130.225.8.217])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id OAA25269;
	Wed, 25 Nov 1998 14:17:05 +0100 (MET)
Received: (from datpete@localhost)
	by asgaard.mjolner.dk (8.8.7/8.8.7) id OAA00311;
	Wed, 25 Nov 1998 14:17:04 +0100 (MET)
From: Peter Andersen <datpete@mjolner.dk>
Message-Id: <199811251317.OAA00311@asgaard.mjolner.dk>
Subject: Re: Guienv print dialog
To: datpete@cs.au.dk (Peter Andersen)
Date: Wed, 25 Nov 1998 14:17:03 +0100 (MET)
Cc: jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk, gram@cs.au.dk,
        mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk (Elmer Sandvad),
        toby@mjolner.dk (Michael Christensen)
In-Reply-To: <199811242052.VAA02024@ariel.cs.au.dk> from "Peter Andersen" at Nov 24, 98 09:52:37 pm
Organization: Mjolner Informatics A/S
X-Mailer: ELM [version 2.4 PL25]
Content-Type: text
X-UIDL: 9aca851a29f6984c655a2a58efa33151
Sender: datpete@cs.au.dk
Status: O

Ups - jeg havde glemt at min 'beta' folder var paranoidt beskkyttet.
Den skulle nu være læsbar for gruppe beta.

Samtidig har jeg udvidet diskussionslisten med Elmer og Toby.
Findes der i dag en print dialog til UNIX freja?

Generel ekstra kommanter: Bør man opdele i 2 dialoger - een for page setup
(page size etc) og en for print?
Sådan er det vist på PC og Mac normalt. Egenskaberne fra PageSetup dialogen
gemmes normalt i dokumentet, mens settings i print dialog er transiente.

Bemærk at min UNIX print dialog ikke resizer korrekt. Jeg tror jeg vil slå resize fra i stedet for at implementere pæn resize.

/Peter



Peter Andersen writes:
> 
> Så vidt jeg kan se er en standard print dialog ikke inkluderet 
> i guienv/stddialogs eller guienv/prompts.
> 
> På mac og pc kan der vel laves et interface det OS'ens standard
> dialog, men på UNIX er man nok nødt til selv at lave den.
> 
> Jeg har lavet et foreløbigt forslag til et API for en print dialog:
> /users/datpete/beta/bifrost/bdraw/printdialog.bet (ligger i bdraw
> selvom den er uafhængig af bifrost - bruges foreløbig kun i min
> private udgave af bdraw).
> 
> Jeg har endvidere lavet en body for denne, der udvider en
> PromptForText til at spørge om et par ting mere.
> Prøv på solaris: /users/datpete/beta/bifrost/bdraw/bdraw og sig
> Cntl-P for at aktivere dialogen.
> 
> Det er ikke helt nemt at lave den pænt, og jeg har måttet tilføje
> to attributter til guienv/prompts.bet:
> 
>      extra_hspace:< integerValue
>        (* Extra horizontal space to put to the right of the fields
> *);
>      extra_vspace:< integerValue
>        (* Extra vertical space to put between the fields and the
> buttons *);
> 
> Jeg mangler endnu at tilføje "Destination: Printer/File" og
> "Orientation: Portrait/Landscape", men inden jeg gør det vil jeg lige
> høre guienv/bifrost folket:
> 
> Synes man jeg skal arbejde videre på denne?
> Kunne man forestille sig at lave implementationer baseret på 
> standard OS dialogerne på mac/pc givet den API jeg har skitseret i
> printdialog.bet? Jeg har set at der i hvert fald i bdraw_ntibody
> er en anvendelse af PC printdialogen, men jeg ved ikke om det passer
> ind i den foreslåede API.
> 
> Hvis der er stemning for det vil jeg committe det snarest. Og
> printdialog+body kan evt flyttes til guienv/utils.
> 
> /Peter
> 



From datpete@ariel.cs.au.dk Mon Dec 20 13:10:33 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24703 invoked from network); 20 Dec 1999 13:10:33 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:33 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27709
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:33 +0100 (MET)
Received: from corona (corona [130.225.16.173])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id PAA04239;
	Wed, 25 Nov 1998 15:45:14 +0100 (MET)
From: "Jorgen Lindskov Knudsen" <jlknudsen@cs.au.dk>
To: "Peter Andersen" <datpete@mjolner.dk>,
        "Peter Andersen" <datpete@cs.au.dk>
Cc: <jlk@cs.au.dk>, <henryml@cs.au.dk>, <les@cs.au.dk>,
        <gram@cs.au.dk>, <mannan@cs.au.dk>, <pa@mjolner.com>,
        "Elmer Sandvad" <ess@cs.au.dk>,
        "Michael Christensen" <toby@mjolner.dk>
Subject: RE: Guienv print dialog
Date: Wed, 25 Nov 1998 15:45:14 +0100
Message-ID: <007201be1882$36103700$ad10e182@corona.daimi.aau.dk>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook 8.5, Build 4.71.2173.0
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V4.72.2106.4
In-Reply-To: <199811251317.OAA00311@asgaard.mjolner.dk>
X-UIDL: 32fb4a7c2c7c5424e76357eaa9da60e8
Sender: datpete@cs.au.dk
Status: O

jeg synes klart, at den skal opdeles i to dialoger.

Men jeg kan stadig ikke finde programmet :-)  Er det på daimi, eller
mjolner - jeg har forsøgt begge steder :-)

--- jlk

> -----Original Message-----
> From: Peter Andersen [mailto:datpete@mjolner.dk]
> Sent: 25. november 1998 14:17
> To: Peter Andersen
> Cc: jlk@cs.au.dk; henryml@cs.au.dk; les@cs.au.dk;
> gram@cs.au.dk; mannan@cs.au.dk; pa@mjolner.com; Elmer Sandvad;
> Michael Christensen
> Subject: Re: Guienv print dialog
>
>
> Ups - jeg havde glemt at min 'beta' folder var paranoidt beskkyttet.
> Den skulle nu være læsbar for gruppe beta.
>
> Samtidig har jeg udvidet diskussionslisten med Elmer og Toby.
> Findes der i dag en print dialog til UNIX freja?
>
> Generel ekstra kommanter: Bør man opdele i 2 dialoger - een for page setup
> (page size etc) og en for print?
> Sådan er det vist på PC og Mac normalt. Egenskaberne fra
> PageSetup dialogen
> gemmes normalt i dokumentet, mens settings i print dialog er transiente.
>
> Bemærk at min UNIX print dialog ikke resizer korrekt. Jeg tror
> jeg vil slå resize fra i stedet for at implementere pæn resize.
>
> /Peter
>
>
>
> Peter Andersen writes:
> >
> > Så vidt jeg kan se er en standard print dialog ikke inkluderet
> > i guienv/stddialogs eller guienv/prompts.
> >
> > På mac og pc kan der vel laves et interface det OS'ens standard
> > dialog, men på UNIX er man nok nødt til selv at lave den.
> >
> > Jeg har lavet et foreløbigt forslag til et API for en print dialog:
> > /users/datpete/beta/bifrost/bdraw/printdialog.bet (ligger i bdraw
> > selvom den er uafhængig af bifrost - bruges foreløbig kun i min
> > private udgave af bdraw).
> >
> > Jeg har endvidere lavet en body for denne, der udvider en
> > PromptForText til at spørge om et par ting mere.
> > Prøv på solaris: /users/datpete/beta/bifrost/bdraw/bdraw og sig
> > Cntl-P for at aktivere dialogen.
> >
> > Det er ikke helt nemt at lave den pænt, og jeg har måttet tilføje
> > to attributter til guienv/prompts.bet:
> >
> >      extra_hspace:< integerValue
> >        (* Extra horizontal space to put to the right of the fields
> > *);
> >      extra_vspace:< integerValue
> >        (* Extra vertical space to put between the fields and the
> > buttons *);
> >
> > Jeg mangler endnu at tilføje "Destination: Printer/File" og
> > "Orientation: Portrait/Landscape", men inden jeg gør det vil jeg lige
> > høre guienv/bifrost folket:
> >
> > Synes man jeg skal arbejde videre på denne?
> > Kunne man forestille sig at lave implementationer baseret på
> > standard OS dialogerne på mac/pc givet den API jeg har skitseret i
> > printdialog.bet? Jeg har set at der i hvert fald i bdraw_ntibody
> > er en anvendelse af PC printdialogen, men jeg ved ikke om det passer
> > ind i den foreslåede API.
> >
> > Hvis der er stemning for det vil jeg committe det snarest. Og
> > printdialog+body kan evt flyttes til guienv/utils.
> >
> > /Peter
> >
>
>



From datpete@ariel.cs.au.dk Mon Dec 20 13:10:39 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24708 invoked from network); 20 Dec 1999 13:10:39 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:39 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27712
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:39 +0100 (MET)
Received: from fraxinus.cs.au.dk (fraxinus [130.225.16.39])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id VAA21152;
	Wed, 25 Nov 1998 21:31:41 +0100 (MET)
Received: (from datpete@localhost)
	by fraxinus.cs.au.dk (8.9.1/8.9.1) id VAA18991;
	Wed, 25 Nov 1998 21:31:38 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811252031.VAA18991@fraxinus.cs.au.dk>
Subject: Re: Guienv print dialog
To: jlknudsen@cs.au.dk (Jorgen Lindskov Knudsen)
Date: Wed, 25 Nov 1998 21:31:36 +0100 (MET)
Cc: datpete@mjolner.dk, datpete@cs.au.dk, jlk@cs.au.dk,
        henryml@cs.au.dk, les@cs.au.dk, gram@cs.au.dk,
        mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk, toby@mjolner.dk
In-Reply-To: <007201be1882$36103700$ad10e182@corona.daimi.aau.dk> from Jorgen Lindskov Knudsen at "Nov 25, 98 03:45:14 pm"
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-UIDL: cc412af7faa05214b381b62e1a4815b6
Sender: datpete@cs.au.dk
Status: O

Efter at have tænkt over print problemet i guienv i en dags tid
kommer her et noget omstruktureret forslag. Det er ikke implementeret,
men er blot et design forslag.

Der er to problemer, jeg mener bliver løst med dette:

1. Vi vil gerne have en PrintWindow metode helt oppe
   i GUIENV.window (eller i windowitem?).
   Lennert har faktisk lavet en fuld implementation af
   et sådant interface til PC. Det er det kode, Mannan
   har fået.
   Der var det problem, at der var en Device Context parameter
   synlig i interfacet. Dette er PC specifikt.
   Jeg har en ca. 50% implementation for i hvert fald Bifrost
   vinduer (PostScript baseret). Men det er kun i bdraw. Kan
   dog løftes op i ihvert fald Bifrost, men evt helt op i
   GUIENV, blot vil det ikke i første omgang blive implementeret
   for alle vindues typer (man kan "nemt" gøre det for textedit
   vinduer ved at kopiere postscript genereringen for TextShape
   i bifrost.
   Jeg mener Lennerts forslag vil være et fint udgangspunkt.
   Jeg har ikke koden, men vil Mannan eller Lennert lige sende
   det ud i diskussionen, så vi kan vurdere det?

2. Vi vil gerne have et interface til en print dialog. Igen er der
   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
   skal printes er meget maskinafhængig.

Jeg mener derfor at der er behov for en indpakning af denne print 
information. I mit forslag til løsning af (2), som følger nedenfor,
er der TO forskellige forslag til et PrintRecord pattern, som jeg
mener vil løse dette, samt et forslag til et meget generisk API for
en PrintDialog og en PageSetupDialog. Vi skal diskuttere om een af
disse kan bruges. Og også om det er smart med en enkelt type record
til begge dialogtyper. Her vil jeg specielt gerne have kommentarer fra
Michael og Lennert i forhold til hhv. mac og pc.

Hvis man så vedtager een eller anden PrintRecord type, og erstatter
DeviceContext parameteren i Lennerts PrintWindow forslag med en
reference til en sådan PrintRecord (som på PC tilfældigvis blot pakker
en Device Context ind (:-)), så mener jeg vi har løsningen på problem
(1).

Og så er vi tæt på at haave generel print i guienv og bifrost!!! (:-)

Dog mener jeg ikke vi kan klare os med een PrintWindow metode i
Window.
Jeg mener vi skal have:
   PrintNative
   PrintPostScript
hvor "native" er StyleWriter/InkJet lignende printere.
Disse giver normalt kun mening på PC/Mac, så jeg forestiller
mig at implementationen af PrintNative på UNIX er et kald af
PrintPostScript.

Nedenfor følger mit interface forslag. Som sagt er jeg overbevist
om at det vil fungere på UNIX, så jeg er mest interesseret i at
få specifikke Mac/PC kommentarer. Men selvfølgelig også nogle
generelle kommentarer.

/Peter

ORIGIN '~beta/guienv/utils/prompts';
BODY 'printdialogbody';

--GuienvLib: attributes--

(* Very generic interface to platform specific PrintDialogs.
 * The machine specific stuff is collected in the PrintRecord pattern.
 *)

PrintDialog:
  (* Generic Print Dialog. Used to specify "transient"
   * properties regarding the print to be performed.
   * That is, the dialog is used to specify properties
   * that are not kept in the document for later use,
   * e.g. which printer to print on, the number of copies
   * etc.
   * Dialog can include a button which activates a PageSetup
   * dialog on the same PrintRecord, but need not.
   *)
  (# ok:< Object
       (* Called when the OK button is pressed *);
     cancel:< Object
       (* Called when the Cancel button is pressed *);
     pr: ^PrintRecord
       (* Record which is filled with information obtained
        * in the dialog with the user. Existing properties
        * in the record are used as defulet in the dialog window
        *);
     popup:
       (* Opens the dialog with existing properties in
        * the PrintRecord used as defaults. If no PrintRecord is
        * specified, a default one is generated and filled 
        * with the information, the user specifies.
        *)
       (# title: ^text;
          father: ^window;
       enter (father[], title[], pr[])
       <<SLOT PrintDialogPopup: dopart>>
       exit pr[]
       #);
     private: @<<SLOT PrintDialogPrivate: descriptor>>;
  enter popup
  exit pr[]
  #);
PageSetupDialog:
  (* Generic Page setup Dialog. Used to specify "persistent"
   * properties regarding the print to be performed.
   * That is, the dialog is used to specify properties
   * that are typically kept in the document for later use,
   * e.g. paper size, orientation, etc.
   *)
  (# ok:< Object
       (* Called when the OK button is pressed *);
     cancel:< Object
       (* Called when the Cancel button is pressed *);
     pr: ^PrintRecord
       (* Record which is filled with information obtained
        * in the dialog with the user. Existing properties
        * in the record are used as defulet in the dialog window
        *);
     popup:
       (* Opens the dialog with existing properties in
        * the PrintRecord used as defaults. If no PrintRecord is
        * specified, a default one is generated and filled 
        * with the information, the user specifies.
        *)
       (# title: ^text;
          father: ^window;
       enter (father[], title[], pr[])
       <<SLOT PageSetupDialogPopup: dopart>>
       exit pr[]
       #);
     private: @<<SLOT PageSetupDialogPrivate: descriptor>>;
  enter popup
  exit pr[]
  #);


--LIB: attributes--

PrintRecord:
  (* Suggestion one: No properties visible in interface.
   * Machine specific uses will have to include machine dependent
   * bodies.
   *)
  <<SLOT PrintRecordBody: Descriptor>>;

PrintRecord:
  (* Suggestion two: Machine dependent properties visible.
   * A little overhead in space, and not "pretty". 
   * But probably easier to use.
   * Typical use on UNIX:
   *   aPrintRecord.UNIX.numcopies -> n;
   * Typical use on Macintosh:
   *   %getLongAt(@@aPrintRecord.Macintosh.GP+anInterestingOffset) -> x;
   * Typical use on PC:
   *   %getLongAt(@@aPrintRecord.Win32.HDC) -> myHandle; 
   *)
  (# Macintosh: @
       (# GP: @integer (* GrafPtr *);
          (* anything else ? *)
       #);
     Win32: @
       (# HDC: @integer (* Handle to device context *)
          (* anything else ? *)
       #)
     UNIX: @
       (# (* Page setup properties *)
          papersize: @point;
          orientation: @integer;
          fitToPaper: @boolean;
          (* Print properties *)
          printToFile: @boolean;
          filename: ^text;
          printcommand: ^text;
          numcopies: @integer;
          (* Probably some more ... *)
       #);
  #);
     

(* Paper sizes in PostScript pixels: 
 *   1 Inch is 25.4 mm.
 *   1 Inch is 72 PostScript pixels
 *   A4 is        210mm x 297mm
 *   Letter is    8.5 x 11 inches
 *   Legal is     8.5 x 14 inches
 *   Executive is 7.5 x 10 inches
 *)
paper_A4:     
  (# exit (595 (* 210*(72/25.4) *), 842 (* 297*(72/25.4) *)) #);
paper_Letter: 
  (# exit (612 (* 8.5*72 *),        792 (* 11*72 *)) #);
paper_Legal:     
  (# exit (612 (* 8.5*72 *),        1008(* 14*72 *)) #);
paper_Executive: 
  (# exit (540 (* 7.5*72 *),        720 (* 10*72 *)) #);

(* Constants specifying paper orientation *)
orientation_portrait:
  (# exit 0 #);
orientation_landscape:
  (# exit 1 #);



From datpete@ariel.cs.au.dk Mon Dec 20 13:10:44 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24713 invoked from network); 20 Dec 1999 13:10:44 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:44 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27718
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:44 +0100 (MET)
Received: from fraxinus.cs.au.dk (fraxinus [130.225.16.39])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id WAA24399;
	Wed, 25 Nov 1998 22:36:45 +0100 (MET)
Received: (from datpete@localhost)
	by fraxinus.cs.au.dk (8.9.1/8.9.1) id WAA19326;
	Wed, 25 Nov 1998 22:36:44 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811252136.WAA19326@fraxinus.cs.au.dk>
Subject: Re: Guienv print dialog
To: datpete@cs.au.dk (Peter Andersen)
Date: Wed, 25 Nov 1998 22:36:44 +0100 (MET)
Cc: jlknudsen@cs.au.dk, datpete@mjolner.dk, datpete@cs.au.dk,
        jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
In-Reply-To: <199811252031.VAA18991@fraxinus.cs.au.dk> from Peter Andersen at "Nov 25, 98 09:31:36 pm"
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-UIDL: cfc8e78d35e5ba2886d693a5f78fbeea
Sender: datpete@cs.au.dk
Status: O

Jeg har checket den print dialog, der er i WorkSheet vinduer i freja.
Er funktionaliteten med print from page x to page y implementeret?
Under alle omstændigheder skal dette nok tilføjes til min UNIX
printrecord.

/Peter


From datpete@ariel.cs.au.dk Mon Dec 20 13:10:49 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24718 invoked from network); 20 Dec 1999 13:10:49 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:49 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27721
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:48 +0100 (MET)
Received: from [130.225.18.210] (lissi-06 [130.225.18.210])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id BAA02519;
	Thu, 26 Nov 1998 01:08:48 +0100 (MET)
Message-Id: <199811260008.BAA02519@cs.au.dk>
X-Mailer: Microsoft Outlook Express for Macintosh - 4.01 (295) 
Date: Thu, 26 Nov 1998 01:12:52 +0100
Subject: Re: Guienv print dialog
From: "Michael Lassen" <henryml@cs.au.dk>
To: Peter Andersen <datpete@cs.au.dk>,
        Jorgen Lindskov Knudsen <jlknudsen@cs.au.dk>
CC: datpete@mjolner.dk, datpete@cs.au.dk, jlk@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
Mime-version: 1.0
X-Priority: 3
Content-type: text/plain; charset="ISO-8859-1"
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from quoted-printable to 8bit by cs.au.dk id BAA02519
X-UIDL: 0925addb988c18562f8400143a9b419b
Sender: datpete@cs.au.dk
Status: O



Peter skriver

>Efter at have tænkt over print problemet i guienv i en dags tid
>kommer her et noget omstruktureret forslag. Det er ikke implementeret,
>men er blot et design forslag.
>
>Der er to problemer, jeg mener bliver løst med dette:
>
>1. Vi vil gerne have en PrintWindow metode helt oppe
>   i GUIENV.window (eller i windowitem?).

Hvis et vindue indeholder fx. et knap-panel og scrollbarer
udover det bifrostcanvas som skal printes er det vel ikke selve
vinduet der skal siges print til, men selve bifrostcanvas'et -
det antyder at "print" operationen skal være på WindowItem i stedet
for Window.

[ KLIP ]

>2. Vi vil gerne have et interface til en print dialog. Igen er der
>   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
>   skal printes er meget maskinafhængig.
>
>Jeg mener derfor at der er behov for en indpakning af denne print
>information. I mit forslag til løsning af (2), som følger nedenfor,
>er der TO forskellige forslag til et PrintRecord pattern, som jeg
>mener vil løse dette, samt et forslag til et meget generisk API for
>en PrintDialog og en PageSetupDialog. Vi skal diskuttere om een af
>disse kan bruges. Og også om det er smart med en enkelt type record
>til begge dialogtyper. Her vil jeg specielt gerne have kommentarer fra
>Michael og Lennert i forhold til hhv. mac og pc.
>

På mac platformen er der fuld understøttelse for at kalde en
PageSetupDialog og efterfølgende en PrintDialog som udfylder
felter i en PrintRecord, som derefter kan bruges når man printer.

Der er vel ingen grund til at eksponere denne print record  i interfacet
mere end allerhøjst nødvendigt ?

Muligvis bør man give et interface til at aflæse

  - PaperSize/PageSize
  - Range af sider der skal printes.

Det første af hensyn til at man kan lave evt. ombrydning af dokumentet
i forhold til størrelsen af papiret.

Range af sider af hensyn til at man kan nøjes med at forberede
de sider der rent faktisk skal printes.

Fx. kunne man forestille sig en applikation som printer ved at
konstrure et BifrostCanvas per side on the fly, som derefter
printes vha. BifrostCanvas.print

PaperSize og Range burde være tilgængelige på alle platforme.

--
Michael


>Hvis man så vedtager een eller anden PrintRecord type, og erstatter
>DeviceContext parameteren i Lennerts PrintWindow forslag med en
>reference til en sådan PrintRecord (som på PC tilfældigvis blot pakker
>en Device Context ind (:-)), så mener jeg vi har løsningen på problem
>(1).
>
>Og så er vi tæt på at haave generel print i guienv og bifrost!!! (:-)
>
>Dog mener jeg ikke vi kan klare os med een PrintWindow metode i
>Window.
>Jeg mener vi skal have:
>   PrintNative
>   PrintPostScript
>hvor "native" er StyleWriter/InkJet lignende printere.
>Disse giver normalt kun mening på PC/Mac, så jeg forestiller
>mig at implementationen af PrintNative på UNIX er et kald af
>PrintPostScript.
>
>Nedenfor følger mit interface forslag. Som sagt er jeg overbevist
>om at det vil fungere på UNIX, så jeg er mest interesseret i at
>få specifikke Mac/PC kommentarer. Men selvfølgelig også nogle
>generelle kommentarer.
>
>/Peter
>
>ORIGIN '~beta/guienv/utils/prompts';
>BODY 'printdialogbody';
>
>--GuienvLib: attributes--
>
>(* Very generic interface to platform specific PrintDialogs.
> * The machine specific stuff is collected in the PrintRecord pattern.
> *)
>
>PrintDialog:
>  (* Generic Print Dialog. Used to specify "transient"
>   * properties regarding the print to be performed.
>   * That is, the dialog is used to specify properties
>   * that are not kept in the document for later use,
>   * e.g. which printer to print on, the number of copies
>   * etc.
>   * Dialog can include a button which activates a PageSetup
>   * dialog on the same PrintRecord, but need not.
>   *)
>  (# ok:< Object
>       (* Called when the OK button is pressed *);
>     cancel:< Object
>       (* Called when the Cancel button is pressed *);
>     pr: ^PrintRecord
>       (* Record which is filled with information obtained
>        * in the dialog with the user. Existing properties
>        * in the record are used as defulet in the dialog window
>        *);
>     popup:
>       (* Opens the dialog with existing properties in
>        * the PrintRecord used as defaults. If no PrintRecord is
>        * specified, a default one is generated and filled
>        * with the information, the user specifies.
>        *)
>       (# title: ^text;
>          father: ^window;
>       enter (father[], title[], pr[])
>       <<SLOT PrintDialogPopup: dopart>>
>       exit pr[]
>       #);
>     private: @<<SLOT PrintDialogPrivate: descriptor>>;
>  enter popup
>  exit pr[]
>  #);
>PageSetupDialog:
>  (* Generic Page setup Dialog. Used to specify "persistent"
>   * properties regarding the print to be performed.
>   * That is, the dialog is used to specify properties
>   * that are typically kept in the document for later use,
>   * e.g. paper size, orientation, etc.
>   *)
>  (# ok:< Object
>       (* Called when the OK button is pressed *);
>     cancel:< Object
>       (* Called when the Cancel button is pressed *);
>     pr: ^PrintRecord
>       (* Record which is filled with information obtained
>        * in the dialog with the user. Existing properties
>        * in the record are used as defulet in the dialog window
>        *);
>     popup:
>       (* Opens the dialog with existing properties in
>        * the PrintRecord used as defaults. If no PrintRecord is
>        * specified, a default one is generated and filled
>        * with the information, the user specifies.
>        *)
>       (# title: ^text;
>          father: ^window;
>       enter (father[], title[], pr[])
>       <<SLOT PageSetupDialogPopup: dopart>>
>       exit pr[]
>       #);
>     private: @<<SLOT PageSetupDialogPrivate: descriptor>>;
>  enter popup
>  exit pr[]
>  #);
>
>
>--LIB: attributes--
>
>PrintRecord:
>  (* Suggestion one: No properties visible in interface.
>   * Machine specific uses will have to include machine dependent
>   * bodies.
>   *)
>  <<SLOT PrintRecordBody: Descriptor>>;
>
>PrintRecord:
>  (* Suggestion two: Machine dependent properties visible.
>   * A little overhead in space, and not "pretty".
>   * But probably easier to use.
>   * Typical use on UNIX:
>   *   aPrintRecord.UNIX.numcopies -> n;
>   * Typical use on Macintosh:
>   *   %getLongAt(@@aPrintRecord.Macintosh.GP+anInterestingOffset) -> x;
>   * Typical use on PC:
>   *   %getLongAt(@@aPrintRecord.Win32.HDC) -> myHandle;
>   *)
>  (# Macintosh: @
>       (# GP: @integer (* GrafPtr *);
>          (* anything else ? *)
>       #);
>     Win32: @
>       (# HDC: @integer (* Handle to device context *)
>          (* anything else ? *)
>       #)
>     UNIX: @
>       (# (* Page setup properties *)
>          papersize: @point;
>          orientation: @integer;
>          fitToPaper: @boolean;
>          (* Print properties *)
>          printToFile: @boolean;
>          filename: ^text;
>          printcommand: ^text;
>          numcopies: @integer;
>          (* Probably some more ... *)
>       #);
>  #);
>
>
>(* Paper sizes in PostScript pixels:
> *   1 Inch is 25.4 mm.
> *   1 Inch is 72 PostScript pixels
> *   A4 is        210mm x 297mm
> *   Letter is    8.5 x 11 inches
> *   Legal is     8.5 x 14 inches
> *   Executive is 7.5 x 10 inches
> *)
>paper_A4:
>  (# exit (595 (* 210*(72/25.4) *), 842 (* 297*(72/25.4) *)) #);
>paper_Letter:
>  (# exit (612 (* 8.5*72 *),        792 (* 11*72 *)) #);
>paper_Legal:
>  (# exit (612 (* 8.5*72 *),        1008(* 14*72 *)) #);
>paper_Executive:
>  (# exit (540 (* 7.5*72 *),        720 (* 10*72 *)) #);
>
>(* Constants specifying paper orientation *)
>orientation_portrait:
>  (# exit 0 #);
>orientation_landscape:
>  (# exit 1 #);
>
>


From datpete@ariel.cs.au.dk Mon Dec 20 13:10:54 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24724 invoked from network); 20 Dec 1999 13:10:54 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:54 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27724
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:53 +0100 (MET)
Received: from royalhome (lissi-03 [130.225.18.207])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id AAA13520;
	Mon, 30 Nov 1998 00:16:31 +0100 (MET)
Message-Id: <199811292316.AAA13520@cs.au.dk>
From: "Lennert Sloth" <les@daimi.aau.dk>
To: "Peter Andersen" <datpete@cs.au.dk>
Cc: <jlk@cs.au.dk>, <henryml@cs.au.dk>, <les@cs.au.dk>,
        <gram@cs.au.dk>, <mannan@cs.au.dk>, <pa@mjolner.com>,
        <ess@cs.au.dk>, <toby@mjolner.dk>
Subject: Re: Guienv print dialog
Date: Mon, 30 Nov 1998 00:26:43 +0100
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 4.71.1712.3
X-MimeOLE: Produced By Microsoft MimeOLE V4.71.1712.3
X-UIDL: 93e04d82da1864d7aecdc15efdc5db86
Sender: datpete@cs.au.dk
Status: O

- Mht. "print" og "page setup" dialoger:
  Så vidt jeg kan se, er der ikke nogen problemer ved at bruge de foreslåede
interfaces til print hhv. page setup dialogerne på windows. "PrintRecord"
skal dog have en "dispose" operation, da fx. den allokerede device context
skal frigives igen.

- Mht. print metode:
Hvad definerer et dokument (og dermed et print job)?
Hvis indholdet af et windowitem udgør et dokument er det fint med en print
operation på windowitem. Hvis indholdet af flere windowitems skal kunne
printes i samme dokument/print job dur det vel ikke?

Det interface jeg lavede til bdraw ser ud som flg.:
PrintDocument:
  (#
     <<SLOT printDocumentAttr: attributes>>;

     resourceAllocationError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);

     apiError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);

     PrintPage:<
       (# gHdc: @integer;
          morePages: @boolean;
       enter gHdc
       do inner printPage;
       exit morePages
       #);

     (* DocWindow must NOT be NONE *)
     DocWindow: ^window;
     DocTitle: ^text;

  enter (DocWindow[],DocTitle[])
  <<SLOT printDocumentImpl: doPart>>
#)

Med de nye dialoger skal gHdc skiftes ud med en PrintRecord.

-- Lennert

-----Original Message-----
[stuff deleted]
>Der er to problemer, jeg mener bliver løst med dette:
>
>1. Vi vil gerne have en PrintWindow metode helt oppe
>   i GUIENV.window (eller i windowitem?).

[stuff deleted]
>
>2. Vi vil gerne have et interface til en print dialog. Igen er der
>   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
>   skal printes er meget maskinafhængig.
>
[stuff deleted]





From datpete@ariel.cs.au.dk Mon Dec 20 13:10:58 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24729 invoked from network); 20 Dec 1999 13:10:58 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:10:58 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27730
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:10:58 +0100 (MET)
Received: from [194.234.182.15] (pm33-15.image.dk [194.234.182.15])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id AAA14194;
	Mon, 30 Nov 1998 00:38:27 +0100 (MET)
Message-Id: <199811292338.AAA14194@cs.au.dk>
X-Mailer: Microsoft Outlook Express for Macintosh - 4.01 (295) 
Date: Mon, 30 Nov 1998 00:42:35 +0100
Subject: Re: Guienv print dialog
From: "Michael Lassen" <henryml@cs.au.dk>
To: Lennert Sloth <les@daimi.aau.dk>, Peter Andersen <datpete@cs.au.dk>
CC: jlk@cs.au.dk, les@cs.au.dk, gram@cs.au.dk, mannan@cs.au.dk,
        pa@mjolner.com, ess@cs.au.dk, toby@mjolner.dk
Mime-version: 1.0
X-Priority: 3
Content-type: text/plain; charset="ISO-8859-1"
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from quoted-printable to 8bit by cs.au.dk id AAA14194
X-UIDL: 30a09a49ba05a072e7d18f93388424df
Sender: datpete@cs.au.dk
Status: O


>
>- Mht. print metode:
>Hvad definerer et dokument (og dermed et print job)?
>Hvis indholdet af et windowitem udgør et dokument er det fint med en print
>operation på windowitem. Hvis indholdet af flere windowitems skal kunne
>printes i samme dokument/print job dur det vel ikke?

Kan man ikke bare placere de forskellige windowItems i
et canvas, og så printe det?




>
>Det interface jeg lavede til bdraw ser ud som flg.:
>PrintDocument:
>  (#
>     <<SLOT printDocumentAttr: attributes>>;
>
>     resourceAllocationError:< exception
>       (# errorMsg: ^text;
>       enter errorMsg[]
>       do inner;
>       #);
>
>     apiError:< exception
>       (# errorMsg: ^text;
>       enter errorMsg[]
>       do inner;
>       #);
>
>     PrintPage:<
>       (# gHdc: @integer;
>          morePages: @boolean;
>       enter gHdc
>       do inner printPage;
>       exit morePages
>       #);
>
>     (* DocWindow must NOT be NONE *)
>     DocWindow: ^window;
>     DocTitle: ^text;
>
>  enter (DocWindow[],DocTitle[])
>  <<SLOT printDocumentImpl: doPart>>
>#)
>
>Med de nye dialoger skal gHdc skiftes ud med en PrintRecord.
>
>-- Lennert
>
>-----Original Message-----
>[stuff deleted]
>>Der er to problemer, jeg mener bliver løst med dette:
>>
>>1. Vi vil gerne have en PrintWindow metode helt oppe
>>   i GUIENV.window (eller i windowitem?).
>
>[stuff deleted]
>>
>>2. Vi vil gerne have et interface til en print dialog. Igen er der
>>   problemet med at informationen om hvor/hvordan/hvorfor(:-) der
>>   skal printes er meget maskinafhængig.
>>
>[stuff deleted]
>
>
>
>


From datpete@ariel.cs.au.dk Mon Dec 20 13:11:02 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24744 invoked from network); 20 Dec 1999 13:11:02 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:11:02 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27738
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:11:02 +0100 (MET)
Received: from cs.au.dk (labatt [130.225.16.67])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id KAA02907
	for <datpete@cs.au.dk>; Mon, 30 Nov 1998 10:57:26 +0100 (MET)
Message-ID: <36626C06.3D67D899@cs.au.dk>
Date: Mon, 30 Nov 1998 10:57:26 +0100
From: Michael Christensen <toby@cs.au.dk>
Organization: Devise, DAIMI, Aarhus University 
X-Mailer: Mozilla 4.5 [en] (WinNT; I)
X-Accept-Language: en
MIME-Version: 1.0
To: Peter Andersen <datpete@cs.au.dk>
Subject: Re: Guienv print dialog
References: <199811252136.WAA19326@fraxinus.cs.au.dk>
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-UIDL: 19f2ac139f868703321832636541edaa
Sender: datpete@cs.au.dk
Status: O



Peter Andersen wrote:
> 
> Jeg har checket den print dialog, der er i WorkSheet vinduer i freja.
> Er funktionaliteten med print from page x to page y implementeret?

Så vidt min eksperimentelle undersøgelse viser ja :-)

Michael


From datpete@ariel.cs.au.dk Mon Dec 20 13:11:07 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24749 invoked from network); 20 Dec 1999 13:11:07 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:11:07 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27750
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:11:06 +0100 (MET)
Received: from fraxinus.cs.au.dk (fraxinus [130.225.16.39])
	by cs.au.dk (8.9.1/8.9.1) with ESMTP id LAA05047;
	Mon, 30 Nov 1998 11:27:34 +0100 (MET)
Received: (from datpete@localhost)
	by fraxinus.cs.au.dk (8.9.1/8.9.1) id LAA16697;
	Mon, 30 Nov 1998 11:27:33 +0100 (MET)
From: Peter Andersen <datpete@cs.au.dk>
Message-Id: <199811301027.LAA16697@fraxinus.cs.au.dk>
Subject: Re: Guienv print dialog
To: les@daimi.aau.dk (Lennert Sloth)
Date: Mon, 30 Nov 1998 11:27:33 +0100 (MET)
Cc: datpete@cs.au.dk, jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
In-Reply-To: <199811292316.AAA13520@cs.au.dk> from Lennert Sloth at "Nov 30, 98 00:26:43 am"
X-Mailer: ELM [version 2.4ME+ PL22 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-UIDL: 414180c02a1d33ca36ca060470842da1
Sender: datpete@cs.au.dk
Status: O

Lennert Sloth writes:
> - Mht. "print" og "page setup" dialoger:
>   Så vidt jeg kan se, er der ikke nogen problemer ved at bruge de foreslåede
> interfaces til print hhv. page setup dialogerne på windows. "PrintRecord"
> skal dog have en "dispose" operation, da fx. den allokerede device context
> skal frigives igen.

OK. Det vil jeg gøre. Jeg er stille og roligt i gang med at
implementere nogle af disse ting i et private directory.
Jeg vil forsøge at få Lennerts kode til at virke inden jeg "frigiver"
det.

> 
> - Mht. print metode:
> Hvad definerer et dokument (og dermed et print job)?

Det skal vi naturligvis diskuttere. Vi kan dog f.eks. starte
med at det er et Window, og evt udvide det senere.

> Hvis indholdet af et windowitem udgør et dokument er det fint med en print
> operation på windowitem. Hvis indholdet af flere windowitems skal kunne
> printes i samme dokument/print job dur det vel ikke?
> 
> Det interface jeg lavede til bdraw ser ud som flg.:

Lennert, er nedenstående ikke i virkeligheden en tilføjelse af
en PrintDocument *virtuel* til Window? Det kan selvfølgelig
ikke lade sig gøre i et LIB slot (hvor dette stammer fra), men
det kan simuleres ved at tage en Window reference ind som parameter,
som du gør.

Jeg har set "den anden" fil (jeg vedlægger begge i fuld længde
nedenfor af hensyn til de øvrige i diskussionen.
Dette mener jeg svarer til en virtuel viderebinding af printpage
i et bifrostcanvas.

> PrintDocument:
>   (#
>      <<SLOT printDocumentAttr: attributes>>;
> 
>      resourceAllocationError:< exception
>        (# errorMsg: ^text;
>        enter errorMsg[]
>        do inner;
>        #);
> 
>      apiError:< exception
>        (# errorMsg: ^text;
>        enter errorMsg[]
>        do inner;
>        #);
> 
>      PrintPage:<
>        (# gHdc: @integer;
>           morePages: @boolean;
>        enter gHdc
>        do inner printPage;
>        exit morePages
>        #);
> 
>      (* DocWindow must NOT be NONE *)
>      DocWindow: ^window;
>      DocTitle: ^text;
> 
>   enter (DocWindow[],DocTitle[])
>   <<SLOT printDocumentImpl: doPart>>
> #)
> 
> Med de nye dialoger skal gHdc skiftes ud med en PrintRecord.
> 
Jeps.

En anden ting, som jeg har tænkt på: En sådan printDocument
operation aktiverer jo print dialogen bag om ryggen på
brugeren. Derfor kan man spørge: Er der brug for en synlig API for
selve printdialogen?

/Peter


Lennerts oprindelige forslag i fuld længde:

printLib.bet:
=============

ORIGIN '~beta/guienv/v1.6/guienv';
BODY 'printLibBody';


-- guienvLib: attributes --

PrintDocument:
  (# 
     <<SLOT printDocumentAttr: attributes>>;
     
     resourceAllocationError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);
     
     apiError:< exception
       (# errorMsg: ^text;
       enter errorMsg[]
       do inner;
       #);
     
     PrintPage:<
       (# gHdc: @integer;
          morePages: @boolean;
       enter gHdc
       do inner printPage;
       exit morePages
       #);
     
     (* DocWindow must NOT be NONE *) 
     DocWindow: ^window;
     DocTitle: ^text;
     
  enter (DocWindow[],DocTitle[])
  <<SLOT printDocumentImpl: doPart>>
#)


printBifrostPage.bet:
======================

ORIGIN '../Bifrost';
BODY 'printBifrostPageBody';

INCLUDE 
'../SelectionPicture';

-- BifrostAttributes: attributes --

printBifrostPage:
  (# 
     margin: (# exit (20, 20) #);
     A4: (# exit (0, 0, 595, 822) (* in points (1/72 inch) *) #);
     
     
     (* hdc is a handle to the printer device context *)
     hdc: @integer;
     
     (* MainCanvas is the BifrostCanvas containing the graphics to be printed.
      *)
      MainCanvas: ^BifrostCanvas;
     
     (* If the selection has been moved or otherwise transformed, this 
      * transformation is only registered by the selection TM matrix.
      * To handle this the selection can be entered.
      *)
     TheSelection: ^SelectionPicture;
     
  enter (hdc,MainCanvas[],TheSelection[])
  <<SLOT printBifrostPageImpl: doPart>>
  #);


From datpete@ariel.cs.au.dk Mon Dec 20 13:11:12 1999
Return-Path: <datpete@ariel.cs.au.dk>
Delivered-To: datpete@mjolner.dk
Received: (qmail 24754 invoked from network); 20 Dec 1999 13:11:12 -0000
Received: from ariel.cs.au.dk (130.225.16.7)
  by noatun.mjolner.dk with SMTP; 20 Dec 1999 13:11:12 -0000
Received: (from datpete@localhost)
	by ariel.cs.au.dk (8.9.3/8.9.3) id OAA27754
	for datpete@mjolner.dk; Mon, 20 Dec 1999 14:11:11 +0100 (MET)
Received: from [130.225.17.89] (beijing [130.225.17.89])
	by cs.au.dk (8.9.1/8.9.1) with SMTP id LAA06099;
	Mon, 30 Nov 1998 11:38:46 +0100 (MET)
Message-Id: <v02130502b288268a49fa@[130.225.17.89]>
Mime-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Date: Mon, 30 Nov 1998 11:43:18 +0100
To: Peter Andersen <datpete@cs.au.dk>, les@daimi.aau.dk (Lennert Sloth)
From: henryml@daimi.aau.dk (Michael Lassen)
Subject: Re: Guienv print dialog
Cc: datpete@cs.au.dk, jlk@cs.au.dk, henryml@cs.au.dk, les@cs.au.dk,
        gram@cs.au.dk, mannan@cs.au.dk, pa@mjolner.com, ess@cs.au.dk,
        toby@mjolner.dk
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from quoted-printable to 8bit by cs.au.dk id LAA06099
X-UIDL: 900d561f7bd1452bbcfe2d0010ab82a0
Sender: datpete@cs.au.dk
Status: O

>> - Mht. print metode:
>> Hvad definerer et dokument (og dermed et print job)?
>
>Det skal vi naturligvis diskuttere. Vi kan dog f.eks. starte
>med at det er et Window, og evt udvide det senere.
>

Jeg kom ellers med (efter min mening) gode argumenter
for at window var en dårlig ide.

Hvad var der galt med mit argument?

Hvis man definere vinduet som det der skal printes -
betyder det så at scrollbaren skal printes med? Eller
skal man løbe vinduet igennem og finde alle "dokument-agtige"
windowitems? Hvordan kan man på Window niveau vide
hvilke dele af vinduets grafik der skal ud på printeren?

--
Michael




