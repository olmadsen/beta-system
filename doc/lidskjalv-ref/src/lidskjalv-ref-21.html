<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> Chapter 5:   The figureitems Library</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING21></A>


<P><A HREF=lidskjalv-ref-24.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=lidskjalv-ref-18.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html#_toc><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>



<A NAME=HEADING21-0></A>
<H1> Chapter 5:   The figureitems Library</H1>

<P> The figureitems library is implementing a relative simple vector graphics system, sufficient for many purposes.  For more advanced graphics, the Mj&oslash;lner System contains a full-fledged 2D graphics library, called Bifrost (see <A HREF="../bibliography/index.html#mia91-13">[MIA 91-13]</A> and <A HREF="../bibliography/index.html#mia91-19">[MIA 91-19]</A>).</P>
<P> The vector graphics patterns are all subpatterns of figureItem.  FigureItem is a subpattern of windowItem, and inherits all the event handling etc., allowing figureItems to react to user manipulations.</P>
<P> <center><IMG ALIGN=TOP SRC=images/figureitemshierarchy.gif></center></P>

<P> FigureItem is the general superpattern for all vector graphics patterns, implementing the common attributes of all graphics patterns.  All figureItems have the attribute pen.  Pen is an object used for drawing the figureItem.  Pen has attributes for defining the drawing pattern of pen, for defining the foreground and background color of pen, and for defining the size (rectangle) of pen.  </P>

<P> Line is used for drawing straight lines.  The start and end attributes are used for controlling the starting (resp. ending) points of the line.</P>

<P> Shape is the general superpattern for all figureItems that can be filled with some paint.  It defines one additional attribute, fill.  Fill is an object used for modeling the properties of the paint used for filling the figureItem.  Fill has attributes for defining the drawing pattern being used for the paint, and for defining the foreground and background color of the paint.</P>

<P> Oval  and  Rect are very similar in not defining any additional attributes.</P>

<P> RoundRect is similar to rect but with round corners.  The roundness of the corners are defined as ovals and controlled through the roundness attribute.</P>

<P> Wedge defines a `piece of cake' and defines startAngle and endAngle for controlling the wedge.</P>

<P> Polygon is a collection of points defining a connected set of straight lines.  Polygon defines one additional attribute, points, used to control the points in the polygon.</P>


<A NAME=HEADING22-0></A>
<H1> Using the figureitems Library</H1>
<P> Remember that in order to utilize this extension to Lidskjalv, the fragment figureitems must be included as follows:</P>
<P> </P>
<PRE CLASS=beta>
ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/guienv/figureitems'
--- program: descriptor ---
guienv(# l: @line;
         ...
      do ...
         ps1 -&gt; l.start;
         ps2 -&gt; l.end;
         ...
      #)
</PRE>



<A NAME=HEADING23-0></A>
<H1> Examples of Use of the figureitems Fragment</H1>
<P> This demo program is a little more elaborate.  It is a simple draw editor in which you interactively can draw lines and polygons.</P>
<P> </P>

<H4 class=betacaption>draw.bet</H4>
<PRE class=beta>
ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/guienv/figureitems';
(* This demo gives an example of how you can draw lines and polygons
 * with mouse using the figureitems "line" and "polygon".  Clicking
 * with the left mouse button defines a node in the polygon/line,
 * clicking with the right mouse button ends the definition of the
 * polygon/line and draws it on the screen.
 *)
--- program: descriptor ---
guienv
(# drawEditor: @window
     (# points: @
          (# ps: [16] ^point;
             top: @integer;
             init:
               (# 
               do 0 -&gt; top;
                  (for i: ps.range repeat
                       &amp;point[] -&gt; ps[i][]
                  for)
               #);
             clear:
               (# do 0 -&gt; top #);
             add:
               (# p: @point;
                  size: @integer
               enter p
               do top + 1 -&gt; top;
                  (if top &gt; ps.range then
                      ps.range -&gt; size;
                      size -&gt; ps.extend;
                      (for i: size repeat
                           &amp;point[] -&gt; ps[size + i][]
                      for)
                  if);
                  p -&gt; ps[top]
               #);
          exit ps[1:top]
          #);
        polygonEditor: polygon
          (# open::
               (# do patterns.dkgray[] -&gt; fill.tile #);
             eventHandler::
               (# onMouseDown::
                    (#
                    do drag;
                       this(polygonEditor)[] -&gt; father.selection.set
                    #)
               #)
          #);
        lineEditor: line
          (# eventHandler::
               (# onMouseDown::
                    (#
                    do drag;
                       this(lineEditor)[] -&gt; father.selection.set
                    #)
               #)
          #);
        definingPoly: @boolean;
        eventHandler::
          (# onAboutToClose:: (# do terminate #);
             onMouseDown::
               (# ps: [0] ^point
               do (if definingPoly then
                      (if buttonState
                       //1 then
                          localPosition -&gt; points.add
                       //3 then
                          localPosition -&gt; points.add;
                          points -&gt; ps;
                          (if ps.range &gt; 2 then
                              ps -&gt; createPolygon
                           else
                              ps -&gt; createLine
                          if);
                          false -&gt; definingPoly
                      if);
                   else
                      (if buttonState=1 then
                          true -&gt; definingPoly;
                          points.clear;
                          localPosition -&gt; points.add
                      if)
                  if)
               #)
          #);
        createPolygon:
          (# ps: [0] ^point;
             poly: ^polygon
          enter ps
          do &amp;polygonEditor[] -&gt; poly[];
             poly.open;
             ps -&gt; poly.points
          #);
        createLine:
          (# l: ^line;
             ps: [0] ^point
          enter ps
          do &amp;lineEditor[] -&gt; l[];
             l.open;
             ps[1] -&gt; l.start;
             ps[2] -&gt; l.end
          #);
        open::
          (# 
          do (400,500) -&gt; size;
             contents -&gt; target;
             points.init
          #)
     #)
do drawEditor.open
#)
</PRE>


<BLOCKQUOTE>
<IMG ALIGN=TOP SRC=images/drawEditor.gif></BLOCKQUOTE>







<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>Lidskjalv - Reference Manual</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
<P>
<P><A HREF=lidskjalv-ref-24.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=lidskjalv-ref-18.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html#_toc><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
