all: generated link-check

# Re-generate all the generated files in the various manuals.
generated:
	@env -i PATH=$$PATH BETALIB=$$BETALIB QUIET=1 sh -c 'for d in *; do if [ -f $$d/Makefile ] ; then cd $$d; echo ""; echo ---$$d---; make; cd ..; fi; done'

# Re-generate interface files only.
interface:
	@env -i PATH=$$PATH BETALIB=$$BETALIB QUIET=1 sh -c 'for d in *; do if [ -f $$d/Makefile ] ; then /usr/xpg4/bin/grep -q interface: $$d/Makefile; status=$$?; if [ $$status -eq 0 ] ; then cd $$d; echo ""; echo "---$$d---"; make interface; cd ..; fi; fi; done'


link-check:
	@echo Checking all links from index.html
	cd admin/errors; sh -c 'for f in *.*; do >$$f; done'
	perl bin/linklint_2.1/linklint -net -error -xref -doc admin/errors -quiet -orphan -htmlonly -limit 2000 -ignore /contents.html -root . -index index.html  /@ 
	@echo See file admin/errors/linklint.html for a survey of errors.

make-check:
	@echo Checking Makefiles
	sh -c 'for d in *; do if [ -f $$d/Makefile ] ; then echo $$d; cd $$d; make -n; cd ..; fi; done'

interface-check:
	sh -c 'for d in *; do if [ -f $$d/Makefile ] ; then /usr/xpg4/bin/grep -q interface: $$d/Makefile; status=$$?; if [ $$status -eq 0 ] ; then cd $$d; echo $$d; cd ..; fi; fi; done'

up: update

update:
	cvs update -dP

# Tags: Only include html files that are not
# generated
tags:
	etags \
*.html \
*/*.html \
xwindows/interface/index.html \
xwindows/LessTifFaq/index.html

# wmtags: Tag files originally generated by webmaker:
wmtags:
	etags -o WMTAGS \
basiclib/*.html \
beta/*.html \
beta-intro/*.html \
beta-overview/*.html \
bifrost-ref/*.html \
bifrost-tut/*.html \
compiler/*.html \
containers/*.html \
distribution/*.html \
freja/*.html \
frigg/*.html \
install/*.html \
lidskjalv-ref/*.html \
lidskjalv-tut/*.html \
maclib/*.html \
mjolner/*.html \
persistence/*.html \
process/*.html \
sif/*.html \
sysutils/*.html \
teaching/*.html \
tutorial/*.html \
unixlib/*.html \
valhalla/*.html \
win32lib/*.html \
xwindows/*.html \
yggdrasil/*.html 


# Remove all generated files
distclean:
	@env -i PATH=$$PATH BETALIB=$$BETALIB QUIET=1 sh -c 'for d in *; do if [ -f $$d/Makefile ] ; then /usr/xpg4/bin/grep -q distclean: $$d/Makefile; status=$$?; if [ $$status -eq 0 ] ; then cd $$d; echo ""; echo "---$$d---"; make distclean; cd ..; fi; fi; done'

