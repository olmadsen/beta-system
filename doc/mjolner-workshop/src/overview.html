<h1>Mjolner Workshop</h1>
These notes contain five exercises which cover the most important features of the Mjolner tool. Furthermore an overview of keyboard shortcuts is supplied -- you might want to skip to that section before you continue.
<ul>
<li>Exercise 1: The basics - editing and compiling
<li>Exercise 2: Browsing code
<li>Exercise 3: Editing using syntactic code fragments
<li>Exercise 4: The fragment system
<li>Exercise 5: Debugging
<li>Appendix: Keyboard shortcuts
</ul>

Download the files 'syntaxedit.bet', 'useloops.bet' og 'loops.bet' to your own directory.
Start the Mjolner tool ("mjolner" - not "mjolner &amp;").


<h2>Exercise 1: The basics - editing and compiling</h2>

In this exercise we will construct a program that reads a number of integers and prints the minimum and maximum among them. Choose 'File-&gt;New BETA Program...' Call the program 'minmax.bet'.

<br><center><png src="images/image001.png"></center><br>

The &lt;&lt;PrefixOpt&gt;&gt; in the code view means that you can type a super pattern here. We do not want here, so click &lt;&lt;PrefixOpt&gt;&gt; og press Delete.
<p>
The &lt;&lt;AttributeDeclOpt&gt;&gt; means that you can declare attributes here. The program needs two integers: 'min' and 'max'. Click &lt;&lt;AttributeDeclOpt&gt;&gt; and type 'min,max: @integer'. Choose 'Edit-&gt;Parse Text or press ctrl-space to leave text editing mode.
<p>
The &lt;&lt;ImpOpt&gt;&gt; means that you can type imperatives here. We need to initialize 'min' and 'max', so click &lt;&lt;ImpOpt&gt;&gt; and type 'maxint-&gt;min'; minint-&gt;max. Leave text editing mode.
<p>
Now we need a loop. Mark 'minint-&gt;max' by holding down the mouse button from the middle of 'minint' to the middle of 'max'. 

<br><center><png src="images/image003.png"></center><br>

Then append some "empty code" by choosing 'Edit-&gt;Insert After' or by pressing Enter. 

<br><center><png src="images/image005.png"></center><br>

Replace the &lt;&lt;ImpOpt&gt;&gt; by 'myloop: (# do restart myloop #)'. Leave text editing mode.

<br><center><png src="images/image007.png"></center><br>

Mark 'myloop' as shown above and re-enter text editing mode the same way you left it. Type the code in the loop, so that it looks like this:

<br><center><png src="images/image009.png"></center><br>

Is the program correct?
Find out by checking it: choose 'Compile/Run-&gt;Check Current (minmax)' or click on the Check button <png src="images/image011.png"> in the toolbar. If there are  errors in the program a window showing the errors will appear:

<br><center><png src="images/image013.png"></center><br>

You can click the 'Nodes' list to browse through the errors. At the bottom of the window information on the error is displayed: "i is not declared". Insert a declaration of 'i' by clicking on 'max' and inserting "empty code" (as you have done before). Type 'i' and leave text editing mode. 

<br><center><png src="images/image015.png"></center><br>

Check the program again. This time it should work.
Now we insert a few statements that print the results of the loop. Mark all of 'myloop' and insert "empty code" after the loop and add the lines shown below:

<br><center><png src="images/image017.png"></center><br>

Compile <png src="images/image019.png"> and run <png src="images/image021.png"> the program from the Mjolner tool (NOT from shell). You can interact with the program in the shell where the Mjolner tool was started.


<h2>Exercise 2: Browsing code</h2>
In this exercise we will use the program 'minmax' from exercise 1 to illustrate code browsing in the Mjolner tool.

<h3>What is maxint/minint?</h3>

In 'minmax' we use maxint and minint. Find out how they are defined by marking e.g. maxint and clicking the Definition button <png src="images/image023.png"> in the toolbar (or press ctrl-d or double-click 'maxint').

<br><png src="images/image025.png"><br>

Maxint is apparently defined in the file 'betaenv'. Double-click the three dots beside 'maxint'.

<br><png src="images/image027.png"><br>

Continue the same way with maxint32 to find out the actual value.
<p>
Now we return to 'minmax'. Click the Back button <png src="images/image029.png"> in the toolbar (or right-click and choose 'back' or press ctrl-b). Go back until the 'minmax'-program is displayed. 

<h3>Adjust the 'Minimum'-output right and add zero-padding</h3> 

Mark min-&gt;putint and enter text editing mode. Add "(# format::&lt; (##) #)" to putint as shown:

<br><png src="images/image031.png"><br>

Double-click 'format'. Because the compiler has not yet checked the text you have just typed, it does not know what it means. So answer yes when asked whether to check the program.

<br><png src="images/image033.png"><br>

Now you can see the attributes of 'putint' -- hopefully they are self-explanatory. Further bind 'putint.format' in 'minmax', so that it prints 'min' right adjusted with width 10 and zero-padding.

<h3>Which containers are available?</h3>

You have probably heard of lists and array-containers, but there are many other containers. At the top of the Projects window there is a line that reads "Std. Libraries/". Double-click that line  or click '+' to open it. Then open "containers". Now all the files in  ~beta/containers/ are displayed. Browse through the files and inspect the different kinds of containers. There are 17 of them.
<p>
Whenever you find '(*)' in a program, it means the program contains a comment at that point. If you double-click the asterisk, the comment is displayed. Duoble-click again, and the comment is hidden. You can also use ctrl-d or the Definition button <png src="images/image023.png"> in the toolbar.
<p>
If you find that too much code is being displayed and you would like an overview of the program you can press ctrl-o. This hides all the details. Double-click to get more details (or mark and press ctrl-d or click the Definition button <png src="images/image023.png"> in the toolbar)

<h3>What else is in the Beta system?</h3>

You should know about the files listed below -- have a quick look at them: 

<ul>
<li>basiclib
<li>/directory (interface to directories on a disk)
<li>/file (file handling)
<li>/math (mathematical computation)
<li>/random (random numbers)
<li>guienv
<li>/controls (elememts for graphical user intefaces, such as buttons, text fields, check-boxes)
<li>/stddialogs (standard dialogue elements, such as file dialogues)
<li>persistentstore (for storing objects on disk)
<li>sysutils
<li>/envstring (access environment variables, e.g. $USER)
<li>/time (handle time and dates)
</ul>



<h2>Exercise 3: Editing using syntactic code fragments</h2>

A central feature of the Mjolner tool is that it enables you to copy and move around large chunks of code quite easily -- without running into syntactic errors such as missing brackets etc. Unfortunately, it is difficult to illustrate the usefulness of this feature in a small example. Therefore this exercise consists of a description of the techniques required to use syntactic editing. 
<p>
Load the file 'syntaxedit.bet'

<h3>Marking code fragments </h3>
First of all, you need to know how to mark a chunk of code. In the Mjolner tool it is impossible to mark something that is not a 'whole', for instance you cannot mark half a descriptor. The tool will always expand the marking until it fits a syntactic category.

<br><png src="images/image036.png"><png src="images/image038.png"><br>

In the example above, the selection becomes the entire pattern.

Another example: Mark from the middle of one pattern to the middle of the next.

<br><png src="images/image041.png"><png src="images/image043.png"><br>

The tool selects both patterns.
<p>
Try marking different chunks of code and observe what is being selected. For example, try marking the following:
<ul>
<li>UnregisteredVehicle: Vehicle ...;
<br><png src="images/image045.png">

<li>Person: ... until aPerson: @person
<br><png src="images/image047.png">

<li>Inside Person.print mark 'living at'-&gt;puttext
<br><png src="images/image049.png">

<li>Inside Person.print mark the entire do-part
<br><png src="images/image051.png">
</ul>
Experiment with the use of ctrl-o (overview) and ctrl-d (detail).


<h3>Code fragments: Cut, copy & paste</h3>

The tool supports the usual cut, copy, paste, undo and redo in their usual places:

<table border=1>
<tr>
<td><b>Command</b>
<td><b>Keyboard shortcut</b>
<tr>
<td><b>cut<br>copy<br>paste<br>undo<br>redo</b>
<td>ctrl-x<br>ctrl-c<br>ctrl-v<br>ctrl-z<br>ctrl-y
</table>
<p>
Now we want to move the Person pattern down to aPerson: @person:
<ol>
<li>Mark the Person pattern.
<li>Press ctrl-x to cut.
<li>Mark Moped: UnregisteredVehicle.
<li>Press Enter to insert code.
<li>Press ctrl-v to paste.
</ol>
<br><png src="images/image053.png" width=20%><png src="images/image055.png" width=20%><png src="images/image057.png" width=20%><png src="images/image059.png" width=20%><png src="images/image061.png" width=20%>

Now try undoing it all using ctrl-z.
<p>
Notice that the Person pattern could have been thousands of lines of code, and it would still be very simple to move it around or copy it.
<p>
You can apply this to all sorts of other code fragments: imperatives, descriptors, do-parts, enter-parts, exit-parts, variabels, superpattern-prefixes. But it takes a little practice to be able to use it efficiently.



<h2>Exercise 4: The fragment systemet</h2>
This exercise is about the fragment system and how it is represented in the Mjolner tool.

<h3>Hiding details of your implementation</h3>
Load the file 'useloops.bet' in the Mjolner tool.
If you click the '+' next to the 'useloops' icon <png src="images/image063.png"> in the Projects window, you will see that the program INCLUDEs the file 'loops' (symbolized by a single up-arrow <png src="images/image065.png">). Click the line that says <png src="images/image065.png"> 'loops'. We would like to save the do-parts in another file - our implementation file. 
<p>
While viewing 'loops' choose SLOTs-&gt;Create Implementation File... and type "loopsbody". Now you have created a new file 'loopsbody' whose ORIGIN is 'loops' (symbolized by a double up-arrow <png src="images/image068.png">). Conversely, 'loops' now has BODY 'loopsbody' (symbolized by a down arrow <png src="images/image070.png">).
<p>
Go back to 'loops' by double-clicking <png src="images/image068.png"> 'loops' in the Projects window.
<p>
Mark the do-part of 'upTo' (press and hold the mouse button from the middle of 'do' to somewhere in the do-part).

<br><png src="images/image073.png"><br>

Choose SLOTs-&gt;Make DoPart SLOT, and call it "upToImplementation". Now the implementation of 'upTo' is automatically moved down into 'loopsbody'. Double-click &lt;&lt;SLOT upToImplementation: DoPart&gt;&gt; which takes you directly to the code in 'loopsbody' (or click the Definiton button <png src="images/image023.png"> in the toolbar or  eller press ctrl-d).
<p>
The Mjolner tool keeps track of your "current implementation file" at all times. This is the file into which the implementaion is moved when you choose SLOTs-&gt;Make DoPart SLOT. When you use SLOTs-&gt;Create Implementation File... to create a new file, that file becomes the "current implementation file". If you wish to change it, use the SLOTs menu.
<p>
Move the do-parts of 'downTo' and 'stepTo' down into 'loopsbody' as well. This can be done in one step by selecting both 'downTo' and 'stepTo' and choosing SLOTs-&gt;Make DoPart SLOT.


<h3>Browsing through SLOTs and fragment forms</h3>
A SLOT is on the form &lt;&lt;SLOT blahblah: DoPart&gt;&gt;. A fragment form contains a line such as '---blahblah: DoPart---'. 
Using the Mjolner tool you can easily jump from a SLOT to the corresponding fragment form or vice versa.

While viewing 'loops' double-click the 'stepTo' SLOT. This causes the implementation of stepTo to be displayed. In the Fragment Forms window you can see that it contains three do-parts and that currently 'stepToImplementation' is displayed. Jump down to the 'downTo' implementation by clicking the line above ???HVAD????
To find the SLOT mathing the 'downTo' fragment form, click the 'ToSlot' button <png src="images/image076.png"> in the toolbar or right click in the code window (????????NAVN???????) and select Follow-&gt;Link To SLOT. 

<br><gif src="images/image079.gif"><br>
(Note that this screenshot is from version 5.1 of the Mjolner tool)
<p>
Now the tool searches through the chain of ORIGINs (adhering to the rules for doing so) looking for a matching SLOT. It ends up finding such a SLOT in 'loops'.

<br><png src="images/image080.png"><br>

Three patterns are defined in 'loops': 'upTo', 'downTo' and 'stepTo'. To be precise, they are defined in a 'lib:attributes' fragment form. as can be seen in the upper right corner of the tool. But which slot will this fragment form be inserted into, i.e. where is the SLOT corresponding to 'lib:attributes'? Find out the same way as above. Of course, the matching SLOT is located in 'betaenv'. 


<h2>Exercise 5: Debugging</h2>
In this exercise we will take a brief look at how the Mjolner tool can help you locate errors in your programs.
<p>
Load the file 'syntaxedit.bet'.
<p>
Compile <png src="images/image019.png"> and run <png src="images/image021.png"> the program. It contains an error: 'Reference is none'.
Click the Debug button <png src="images/image084.png"> in the toolbar or right click in the code and choose Compile/Run-&gt;Debug 'syntaxedit'. Now a debugging window pops up.

<h3>Reference is none</h3>
Click "Go" in the debugging window. This time, when the program stops, the window tells you at the bottom that there is an error: "Reference is none". And in the code window ?????NAVN????? the command causing the error is marked ('kg'-&gt;value, which should be 'kg'-&gt;value[]). Close the debugging window, correct the error and run the program again.
<p>
It is that easy to find errors like "Reference is none"!

<h3>Break points</h3>
For practice we will insert a breakpoint at 'The car is:'-&gt;putline. Mark this line and right click. Choose "Set Break" and mark something else (anything).
<p>
Click "Go" in the debugging window. Now the program runs for a little while and then stops at the break point.
CLick the Object button in the debugging window. This displays the active object, i.e. the object whose do-part is currently being executed. Here, the active object is of course the entire program.
<p>
You can see that the object has a 'aPerson' component which is an instance of the 'program.Person' pattern. But we already knew that. Now double click that line. Double click 'Name', and double click 'T'. You can see that the person is called "Santa Claus". 
<p>
In this manner the object structure can be observed at runtime. Sometimes this is preferable to inserting debug-printlines.
Now click the break point &gt;&gt;1&gt;&gt; and right click. Choose "Erase Break". Choose "Rerun" either from the right click menu or the new window. Now the program is ready to start over.


<h2>Appendix: Important commands and keyboard shortcuts</h2>

The following commands are not available in text mode.
<table border=1>
<tr><th> Operation <th> Keys <th> Mouse/Button <th> Description <th> Menu item
<tr><th>Re-prettyprint <td> ctrl-p <td> &nbsp; <td> Redraws the code if something has gone awry <td> View -&gt; Reprettyprint

<tr><th>Overview <td> ctrl-o <td> &nbsp; <td> Abstract the code around the current selection <td> View -&gt; Overview

<tr><th>Detail<br><br>Show definition<br><br>Show code <td> ctrl-d <td> Double click<br><br><br><png src="images/image086.png"> <td> This command has a number of different meanings depending on the current selection. Show more details around the current selection, find the definition of a name, open or close a comment <td> View -&gt; Detail<br><br>View -&gt; Follow Semantic Link<br><br>View-&gt;Follow Link to SLOT

<tr><th>Abstract <td> ctrl-k <td> &nbsp; <td> Abstract the current selection <td> View -&gt; Abstract 

<tr><th>To slot <td> F3 <td> <png src="images/image088.png"> <td> Search through the chain of ORIGINs looking for a SLOT matching the fragment form <td> View-&gt; Follow Link to SLOT

<tr><th>Back <td> ctrl-b <td> <png src="images/image090.png"> <td> Go back to where you were before pressing e.g. Show Definition <td> History-&gt;Back

<tr><th>Forward <td> ctrl-f <td> <br><png src="images/image092.png"> <td> The oppposite of Back <td> History-&gt;Forward

<tr><th>Append empty code <td> ctrl-a<br>Enter <td> &nbsp; <td> Append "empty code" to the current selection <td> Edit-&gt;Insert After

<tr><th>Prepend empty code <td> ctrl-u <td> &nbsp; <td> Prepend "empty code" to the current selection <td> Edit -&gt; Insert Before

<tr><th>Check current <td> F4 <td> &nbsp; <td> Check the current code for errors <td> Compile/Run-&gt;Check Current

<tr><th>Check program <td> ctrl-F4 <td><png src="images/image094.png"> <td> Re-check the program that was last checked <td> Compile/Run-&gt;Check Program

<tr><th>Compile current <td> F5 <td> &nbsp; <td> Compile the current code and (if it is a program) produce an executable file <td> Compile/Run-&gt;Compile Current

<tr><th>Compile program <td> Ctrl-F5 <td> <png src="images/image096.png"> <td> Compile and create executable for the most recently selected program <td> Compile/Run-&gt;Compile Program

<tr><th>Run program <td> F6 <td> <png src="images/image098.png"> <td> Run the most recently selected program (if it has been compiled) <td> Compile/Run-&gt;Run Program

<tr><th>Recompile and run <td> Shift-F5 <td> &nbsp; <td> Compile and run the most recently selected program <td> Compile/Run-&gt;Recompile and Run 

<tr><th>Debug the program <td> F7 <td> &nbsp; <td> Debug the most recently selected program (if it has been compiled) <td> Compile/Run-&gt;Debug Program
</table>

<table border=1>
<tr>
<th>Command
<th>Keyboard shortcut
<tr>
<th>cut<br>copy<br>paste<br>undo<br>redo
<td>ctrl-x<br>ctrl-c<br>ctrl-v<br>ctrl-z<br>ctrl-y
</table>

<h3>Text mode</h3>
<table border=1>
<tr>
<td>Command <td> Keys <td> Mouse <td> Description <td> Menu item
<tr>
<td>Enter text editing mode <td> ctrl-t, ctrl-space <td> &nbsp; <td> Enter text editing mode for the current selection <td> Edit-&gt;Edit Text

<tr>
<td>Leave text editing mode <td> ctrl-t, sctrl-space <td> click outside selection <td> Re-interpret the edited chunk of code. The code must be syntactically correct <td> Edit-&gt;Parse Text

<tr>
<td>Cancel Text editing <td> escape <td> &nbsp; <td> Discards all changes to the edited chunk of code <td> Edit-&gt;Cancel Textediting
</table>

<br>
<br>
Author: Christian Heide Damm (damm@daimi.au.dk), October 1999<br>
Updated by Elmer Sandvad (elmer@mjolner.dk), September 2000<br>
Updated and translated into English by Karsten Jorgensen (karsten@mjolner.dk), May 2001<br>
Please report errors in this document to <a href="mailto:support@mjolner.dk">support@mjolner.dk</a>

