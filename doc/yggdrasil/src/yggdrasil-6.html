<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> The Tree Level</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING6></A>


<P><A HREF=yggdrasil-7.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=yggdrasil-5.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P>Metaprogramming System</P>


<A NAME=HEADING6-0></A>
<H1> <A NAME="LINK-yggdrasil-_Toc364700500"><A NAME=MARKER-9-48></A>The Tree Level</A></H1>
<P> <A NAME=MARKER-2-50></A>As mentioned in the introduction, certain tools like syntax directed editors are usually table-driven in the sense that the code is independent of the actual grammar. The AST is manipulated as an ordinary tree. The context-free level must therefore be integrated with a level where the AST is viewed as an ordinary tree. This is straight forward using subclassing. The patterns generated from the grammar are all subpatterns of the general patterns Cons and List. These patterns are actually subpatterns of more general patterns describing ASTs as ordinary trees. In this section these general patterns are described. The general patterns are called the tree level.</P>

<P>  At the tree level, an AST is modelled as an instance of the pattern AST. The pattern AST is further specialized into a number of sub-patterns. Some of these sub-patterns correspond to the rule types of a structured context-free grammar. The tree level corresponds to an ordinary data type for a tree. The specialization hierarchy for the patterns defined in the tree level is:</P>
<center> <IMG ALIGN=TOP SRC=treelevel.gif></center>
<P> The following is a verbal description of these patterns:</P>

<UL>
<LI>AST<A NAME=MARKER-2-51></A> describes all ASTs. Operations of this pattern are: Symbol returns the nonterminal symbol of the AST. Kind returns the type of the AST (e.g. List). Father returns the father. SonNo returns the index of this AST in the list of sons of the father of this AST. NextBrother returns the next brother of this AST in the list of sons of the father of this AST. AddComment updates an associated comment, GetComment returns an associated comment, and HasComment tests whether a comment is associated with this AST. HasSemanticError and SemanticError is used by language-dependent tools to mark ASTs with information on semantic errors in the AST. Copy returns a copy. Match, Equal and Lt performs different kinds of comparisons of ASTs, and copy enables copying an entire AST. Finally, NearestCommonAncestor returns the nearest common ancestor of this AST and some other AST. GetAttribute, putAttribute, getNodeAttribute, putNodeAttribute, getSlotAttribute, putSlotAttribute, getSlotNodeAttribute and putSlotNodeAttribute, are operations for accessing and changing the different attributes, that are specified for this kind of ASTs. The number of attributes are defined as part of the grammar specification. Finally, the putCommentProp and getCommentProp is used for associating properties directly with individual ASTs. For a description of properties, see chapter 7.
<LI>Expanded<A NAME=MARKER-2-52></A> describes ASTs that are expanded into trees (i.e. something has been derived from the nonterminal of this AST). Get returns a son at a given position. Put updates a son at a given position. NoOfSons returns the number of sons of this AST. Scan iterates over the sons in this AST. SuffixWalk and SuffixWalkforProd perform preorder traversal of the tree with this node as root. Insert will insert an AST before a given son. Finally, expanded defines getson1, ..., getson9 and putson1, ..., putson9 for direct access to the given son number.
<LI>Cons<A NAME=MARKER-2-53></A> describes all nodes derived by a constructor rule. Delete deletes a son at a given position.
<LI>List<A NAME=MARKER-2-54></A> describes all nodes derived by a list rule. SonCat describes the category of the ASTs of the list. Delete deletes an AST with a given position and Insert inserts an AST at a given position. Append inserts an AST as the last son in the list. NewScan iterates over the ASTs in this list.
<LI>Lexem<A NAME=MARKER-2-55></A> describes all nodes derived by one of the predefined nonterminals (e.g. Const). No special operations.
<LI>LexemText<A NAME=MARKER-2-56></A> describes leaves having textual contents. GetText returns the textual contents. PutText updates the textual contents. CurLength returns the length of the textual contents. GetChar and putChar allows for accessing and changing the individual chars in the textual contents. Clear empties the textual contents.
<LI>NameDecl<A NAME=MARKER-2-57></A> describes all name declarations. ScanUsage iterates over the name applications that use this declaration. This information is context-sensitive and if used it must be set up by a language specific tool. AddUsage and removeUsage is used by these language-specific tools to set-up and remove such informations.
<LI>NameAppl<A NAME=MARKER-2-58></A> describes all name applications. GetDecl returns a reference to the AST, containing the declaration of this name application. This information is context-sensitive and if used it must be set up by a language specific tool. NextUsage returns the next usage (reference to an AST) of this nameAppl, if any exists. DeclSet tells whether any language-specific tools have setup declaration information for this name application.
<LI>String<A NAME=MARKER-2-59></A> describes all strings. No special operations.
<LI>Const<A NAME=MARKER-2-60></A> describes all numeric constants. GetValue returns the value of the constant, PutValue updates the value of the constant.
<LI>Comment<A NAME=MARKER-2-61></A> describes comments associated with ASTs. CommentType returns the type of this comment.
<LI>UnExpanded<A NAME=MARKER-2-62></A> describes ASTs where nothing yet has been derived from the nonterminal of this AST. NonterminalSymbol returns the kind of nonterminal associated with this AST (Note that this(AST).symbol returns unExpanded). The kind of nonterminals are defined in the kinds object. The available kinds are: kinds.interior, kinds.unExpanded, kinds.optional, kinds.nameDecl, etc).
<LI>Optional<A NAME=MARKER-2-63></A> describes ASTs that are unexpanded, and where the nonterminal symbol of this AST is defined by an optional rule. No special operations.
<LI>SlotDesc<A NAME=MARKER-2-64></A> describes AST representing SLOTs. More on SLOTs later.
</UL>
<P> Assuming the patterns AssignmentImp, IfImp and ProcCall
corresponding to ASTs generated from the respective nonterminals.
These patterns are sub-patterns of the pattern Imp.  Assume that a
tool for counting the number of imperatives in an instance of ImpList
is to be implemented.  In addition the tool should count the number of
different types of imperatives.  The tool may be implemented by adding
a virtual pattern attribute Count to the pattern Imp.  The definition
of Count may then be extended in the sub-patterns:</P>

<PRE class=beta>
Imp: Cons(# Count:&lt; (# do ImpCount.Add1; inner #) #)     
AssignmentImp: Imp(# ...                                    
                     Count::&lt; (# do AssignmentCount.Add1 #)
                  #);                                      
...                                                        
ImpList: List(# ... #)                                     
IL: ImpList;                                               
...                                                      
IL.Scan(# do thisElm.Count #)                               
</PRE>

<P> The virtual pattern Count in AssignmentImp will be a sub-pattern of the Count pattern in Imp.  ThisElm in IL.scan... will in turn refer to each element in IL.  If ThisElm in IL.Scan denotes an instance of AssignmentImp then ThisElm.Count will result in execution of ImpCount.Add1 followed by AssignmentCount.Add1</P>




<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>Metaprogramming System</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
<P>
<P><A HREF=yggdrasil-7.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=yggdrasil-5.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
