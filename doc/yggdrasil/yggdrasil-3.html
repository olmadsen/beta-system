<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE> The Metaprogramming System</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING3></A>


<P><A HREF=yggdrasil-4.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=index.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P>Metaprogramming System</P>


<A NAME=HEADING3-0></A>
<H1> <A NAME="LINK-yggdrasil-_Toc364700496"><A NAME=MARKER-9-1></A>The Metaprogramming System</A></H1>



<P> A number of tools in the Mj&oslash;lner BETA System are metaprograms, i.e. programs that manipulate other programs. The metaprogramming system is grammar-based in the sense that a metaprogramming tool may be generated from the grammar of any language. For each syntactic category of the language, a corresponding pattern is generated. The syntactic hierarchy of the grammar is mapped into a corresponding pattern hierarchy. This object-oriented representation of programs is further exploited by including a set of more general patterns that view a program as an abstract syntax tree and by allowing the user to add semantic attributes in sub-patterns. </P>
<P> The Mj&oslash;lner BETA System is a programming environment that supports design, implementation and maintenance of large production programs. In such an environment support for structure and security is essential. The Mj&oslash;lner BETA System is primarily aimed at supporting the object-oriented programming style. </P>

<P> All metaprogramming tools in the Mj&oslash;lner BETA System manipulate programs through a common representation that is abstract syntax trees (ASTs). It was decided that for a language supported by the system, the corresponding ASTs should be instances of a well-defined data type. There is no commonly agreed definition of abstract syntax tree, which implies that each language implementor selects his own definition. A context-free grammar for a language induces an abstract syntax that may be used to give an AST-definition. In the Mj&oslash;lner BETA System, the representation of a program as an AST is defined by means of a context-free grammar for the language. In addition there is a set of rules that specify how the context-free grammar is mapped into a set of data types. The context-free grammar is then part of the specification of the environment.</P>

<P> The ASTs defined by the context-free grammar may be described as Lisp S-expressions. An example of a Pascal statement and a corresponding AST in the form of an S-expression is:</P>
<PRE CLASS=beta>
while p&lt;&gt;q do if p&lt;q then q:=q-p else p:=p-q
(while (&lt;&gt; p q)
	(if (&lt; p q)
		(:= q (- q p))
		(:= p (- p q))))
</PRE>
<P> S-expressions could in fact be used for manipulation of an AST. In order to do this in Simula, BETA, or other languages, predefined patterns (types) modelling S-expressions could be included in the environment.</P>
<P> Not all S-expressions do, however, constitute correct programs. In order for an S-expression to be an AST, a certain context-free structure must be satisfied. E.g. the S-expression '(while (if p) (else q))' does not correspond to an AST for a Pascal program, even though it is a well defined tree structure.</P>

<P>  An object-oriented model of the ASTs has been developed as part of the Mj&oslash;lner BETA System. An AST is modelled as an instance of a pattern. There is a pattern corresponding to each syntactic category (nonterminal) of the grammar. ASTs derived from a syntactic category are then modelled as instances of the corresponding pattern. The pattern IfImp corresponds to the syntactic category &lt;IfImp&gt;. Instances of pattern IfImp then model ASTs that may be derived from &lt;IfImp&gt;.</P>
<P> The grammar hierarchy is modelled by a corresponding pattern hierarchy. E.g. if the nonterminal &lt;Imp&gt; may derive &lt;IfImp&gt;, &lt;WhileImp&gt; etc., then the pattern Imp will be a super-pattern of IfImp. The pattern hierarchy is derived automatically from the context-free grammar. In order for this to work properly, the context-free grammar must obey a certain structure.</P>
<P> Using the metaprogramming system, there is a well defined representation of programs in the form of ASTs. This implies that the various Mj&oslash;lner BETA System tools and other metaprograms all are able to use the same representation of programs.</P>

<P> The grammar-based interface described above results in a set of patterns for each language. A metaprogram using the grammar-based interface will thus be language specific since it uses the set of patterns generated from the grammar of the actual language. A number of tools are language specific in the sense that usually one exists for each language. Examples of tools that benefit from using the grammar-based interface are: semantic checkers, program analysers, interpreters, browsers, graphical presentation tools, transformation tools.</P>
<P> For certain types of metaprograms it may be inconvenient to use the grammar-based interface, since it implies grammar-based information to be hard-coded in the programs. If manipulation of the AST could only take place through this interface, it would be necessary to write such tools for every language. This is of course not acceptable. Examples of such tools are table-driven parsers and syntax-directed editors.</P>
<P> In order to support both types of tools, the AST in the metaprogramming system may be accessed at three levels.</P>

<UL>
<LI>Tree level<A NAME=MARKER-2-10></A>: Here the AST is viewed as a tree. This corresponds to S-expressions.
<LI>Context-free level<A NAME=MARKER-2-11></A>: This is the grammar-based interface generated automatically from the grammar. This level corresponds to S-expressions where a context-free structure is imposed, together with functions for accessing the components of the AST.
<LI>Semantic level<A NAME=MARKER-2-12></A>: At this level semantic attributes may be added to the AST. The attributes are tool dependent and usually reflect context sensitive aspects of the language.
</UL>
<P> The three levels are also modelled by a pattern hierarchy. A generated context-free level is a subpattern of tree level, and a semantic level is a subpattern of the context-free level for the language in question.</P>
<P> In the metaprogramming system, an attempt has been made to view traditional tools like editor, compiler and debugger as metaprograms in general. The advantage of this is that all tools including user programs access programs through a common representation. This leads to the integration of the grammar-based interfaces with the tree level and semantic level described above.</P>
<P> The implementation language of the metaprogramming system is BETA. This means that all metaprograms are written in BETA. However, metaprograms can manipulate ASTs of any context-free language.</P>

<P> The metaprogramming system is also known under the name Yggdrasil<A NAME=MARKER-2-13></A>. This name is used in a few operations, and in some of the diagnostic messages from the system. The name originates in the Nordic mythodology, where Yggdrasil is the name of the &quot;Tree of Life<A NAME=MARKER-2-14></A>&quot;. </P>




<HR>
<P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left">
<ADDRESS>Metaprogramming System</ADDRESS>
</TD>
<TD width="20%" align="center"><FONT SIZE="-1">&#169; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
<P>
<P><A HREF=yggdrasil-4.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=index.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>

<A HREF="../index.html"><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF="index.html#_toc"><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
