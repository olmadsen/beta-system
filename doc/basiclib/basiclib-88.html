<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>

<HEAD>
<LINK REL=TOP HREF=index.html>
<LINK REL=UP HREF=basiclib-84.html>
<LINK REL=PREV HREF=basiclib-87.html>
<LINK REL=NEXT HREF=inx.html>
<TITLE> Example Using externalRecord</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING88></A>


<P><A HREF=intercace/index.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=basiclib-87.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=basiclib-84.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF=index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=contents.html><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P> Interfacing to External Data Structures</P>


<A NAME=HEADING88-0></A>
<H1> Example Using externalRecord</H1>
<P> Here TCSbuffer is the interface into some data structure in some image processing software. TCAlloc is the interface into the C routine in that software, allocating this data structure, and allocate is an example of using this routine for getting access to the externally allocated data structure. Finally, update illustrates how to transfer the memory address back into the external language.</P>
<P> </P>
<PRE CLASS=beta>
TCSbuffer: externalRecord
(# display:		@long(# pos ::&lt; (# do 0 -&gt; value #)#);
window:		@long(# pos ::&lt; (# do 4 -&gt; value #)#);
visual:		@long(# pos ::&lt; (# do 8 -&gt; value #)#);
colormap:		@long(# pos ::&lt; (# do 12 -&gt; value #)#);
depth:		@long(# pos ::&lt; (# do 16 -&gt; value #)#);
gc:			@long(# pos ::&lt; (# do 20 -&gt; value #)#);
colorLookup:	@long(# pos ::&lt; (# do 24 -&gt; value #)#);
width:		@long(# pos ::&lt; (# do 56 -&gt; value #)#);
height:		@long(# pos ::&lt; (# do 60 -&gt; value #)#);
data:			@long(# pos ::&lt; (# do 64 -&gt; value #)#);
xOffset:		@long(# pos ::&lt; (# do 68 -&gt; value #)#);
yOffset:		@long(# pos ::&lt; (# do 72 -&gt; value #)#);
zoom:			@long(# pos ::&lt; (# do 76 -&gt; value #)#);
updateTile:	@long(# pos ::&lt; (# do 80 -&gt; value #)#);
#);

TCAlloc: External 
(# width, height: @integer;
buffer: @integer
enter (width, height)
exit buffer
#);

allocate:
(* allocates a true color buffer of resolution
width x height
*)
(# width, height: @integer; buffer: ^TCSbuffer
noMemoryError :&lt; TCSnoMemoryError;
enter(width, height, buffer[])
do (width, height) -&gt; TCALLOC -&gt; buffer.ptr;
(if ptr //-1 then noMemoryError if);
INNER
#);

update: 
(* Draws a region of a true color buffer on the window it's
associated with.  The x, y, width and height arguments 
give the location and size of the region in BUFFER 
coordinates, NOT window coordinates.
*)
(# x, y, width, height: @integer; buffer: ^TCSbuffer
noBufferError :&lt; TCSnoBufferError;
internError :&lt; TCSinternError;
enter (buffer, x, y, width, height)
do (if (buffer.ptr, x, y, width, height) -&gt; TCUPDATE
// 0 then 'update' -&gt; NoBufferError
//-4 then 'update' -&gt; internError
if);
INNER
#);
</PRE>
<P> </P>
<P> </P>
<P> </P>
<P> </P>







<!-- TOC -->



<HR>
<P>
<TABLE cols=3 border=0 width=100%>
<TR>
<TD width="33%" align="left">
<ADDRESS>Basic Libraries - Reference Manual</ADDRESS>
</TD>
<TD width="34%" align="center"><FONT size=-1>&COPY; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="33%" align="right"><FONT size=-1><SCRIPT LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></FONT></TD>
</TABLE>
<P>
<P><A HREF=interface/index.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=basiclib-87.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=basiclib-84.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF=index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=contents.html><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
