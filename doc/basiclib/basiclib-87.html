<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>

<HEAD>




<TITLE> Example Using cStruct</TITLE>
<LINK REL=stylesheet HREF=../style/miadoc.css TYPE=text/css>

</HEAD>
<BODY>


<A NAME=HEADING87></A>


<P><A HREF=basiclib-88.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=basiclib-86.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=basiclib-84.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>
<P> Interfacing to External Data Structures</P>


<A NAME=HEADING87-0></A>
<H1> Example Using cStruct</H1>
<P> The following example shows how to interface to the C language using cStruct and external. The BETA pattern myStruct describes a BETA object to be transferred to the foo C function. The BETA pattern foo describes the interface to a C function called foo. It is important that there exist a C function with the name foo and exactly the same parameters and result. </P>
<PRE CLASS=beta>
(# myStruct: cStruct
(* myStruct describes a cStruct consisting of 8 bytes
'a' denotes byte[0]
'b' denotes byte[1]
'c' denotes byte[2-5]
'd' denotes byte[6-7]
*)
(# byteSize ::&lt; (# do 8 -&gt; value #);
a: byte (# pos ::&lt; (# do 0 -&gt; value #) #);
b: byte (# pos ::&lt; (# do 1 -&gt; value #) #);
c: long (# pos ::&lt; (# do 2 -&gt; value #) #);
d: short (# pos ::&lt; (# do 6 -&gt; value #) #) 
#);
foo: external 
(* This pattern describes the interface to the following
C function, called 'foo':
*
int foo(int i, short si, char a, char *t, myStruct *r) 
*)
(# i: @integer; si: @shortint;
a: @char; t: [1] @char;
r: ^myStruct;
status: @ integer;
enter (i, si, a, t, r[])
exit status
#);
theStruct: @myStruct;
m, n, status: @integer;
c: @char;
do ...
m -&gt; theStruct.a; (* overflow is not detected *)
17 -&gt; theStruct.b; ...
(n, 117, c, 'smith', theStruct[]) -&gt; foo -&gt; status;
(if status
//117 then
theStruct.d -&gt; m;
...
if);
(11, m, 'x', 'smith', NONE) -&gt; foo -&gt; status;
#)
</PRE>










<HR>
<P>
<TABLE cols=3 border=0 width=100%>
<TR>
<TD width="33%" align="left">
<ADDRESS>Basic Libraries - Reference Manual</ADDRESS>
</TD>
<TD width="34%" align="center"><FONT size=-1>&COPY; <A HREF="http://www.mjolner.com">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="33%" align="right"><FONT size=-1><SCRIPT LANGUAGE=JavaScript SRC="../javascript/lastmod.js"></SCRIPT></FONT></TD>
</TABLE>
<P>
<P><A HREF=basiclib-88.html><IMG ALIGN=BOTTOM SRC="../images/next.gif" ALT=Next BORDER=0></A>
<A HREF=basiclib-86.html><IMG ALIGN=BOTTOM SRC="../images/prev.gif" ALT=Previous BORDER=0></A>
<A HREF=basiclib-84.html><IMG ALIGN=BOTTOM SRC="../images/up.gif" ALT=Up BORDER=0></A>
<A HREF=../index.html><IMG ALIGN=BOTTOM SRC="../images/top.gif" ALT=Top BORDER=0></A>
<A HREF=index.html><IMG ALIGN=BOTTOM SRC="../images/content.gif" ALT=Contents BORDER=0></A>
<A HREF=inx.html><IMG ALIGN=BOTTOM SRC="../images/index.gif" ALT=Index BORDER=0></A></P>


</BODY>
</HTML>
