<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<!-- Autogenerated file - do not edit -->
<HEAD>
<TITLE>External Interface</TITLE>
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">

<SCRIPT DEFER TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/hashfromparent.js"></SCRIPT>
<SCRIPT DEFER TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/printframe.js"></SCRIPT>
<BASE TARGET="_top">
</HEAD>
<BODY onLoad='HashFromParent()'>
<H1><A name="external">External Interface</A></H1>

<PRE CLASS=interface>
ORIGIN 'betaenv';
-- CStructLib: attributes---
(*
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-99
 *       All rights reserved.
 *
 ****** Patterns for external interface *****
 * 
 * In CStructLib, the operations on a cStruct are defined.
 * The pattern ExternalRecord is an interface to e.g. CStruct objects
 * allocated from C or other external languages.
 *)
<B>GetByte</B><A name="GetByte.1(518)"></A>: 
  (# byteno: @int32;
  enter byteno-&gt;chk
  exit byteNo -&gt; R.%getByte
  #);
<B>PutByte</B><A name="PutByte.1(519)"></A>: 
  (# val: @int8;
     byteno: @int32;
  enter(byteno,val) 
  do byteno-&gt;chk;
     (val,byteno) -&gt;R.%putbyte
  #);
<B>GetShort</B><A name="GetShort.1(520)"></A>: 
  (# byteno: @int32;
  enter byteno-&gt;chk 
  exit (byteno div 2) -&gt;R.%getShort
  #);
<B>PutShort</B><A name="PutShort.1(521)"></A>: 
  (# val: @int16;
     byteno: @int32;
  enter (byteno,val) 
  do byteno-&gt;chk;
     (val,byteno div 2) -&gt; R.%putShort
  #);
<B>GetSignedShort</B><A name="GetSignedShort.1(522)"></A>: 
  (# byteno: @int32;
  enter byteno-&gt;chk 
  exit (byteno div 2) -&gt;R.%getSignedShort
  #);
<B>GetLong</B><A name="GetLong.1(523)"></A>: 
  (# byteno: @int32;
  enter byteno-&gt;chk
  exit (byteno div 4) -&gt;R.%getLong
  #);
<B>PutLong</B><A name="PutLong.1(524)"></A>: 
  (# val: @int32;
     byteno: @int32
  enter (byteno,val)
  do byteno-&gt;chk; 
     (val,byteno div 4) -&gt;R.%putLong
  #);

<B>CStructField</B><A name="CStructField.1(525)"></A>: 
  (* Used for declaring CStruct fields *)
  (# pos:&lt; IntegerObject; 
     p: @pos; 
  #);
<B>Byte</B><A name="Byte.1(526)"></A>: CStructField
  (# set: @(# val: @int8 enter val do (val,p) -&gt;R.%putByte #);
  enter set
  exit p -&gt;R.%getByte
  #);
<B>Short</B><A name="Short.1(527)"></A>: CStructField
  (# set: @(# val: @int16 enter val do (val,p div 2) -&gt;R.%putShort #);
  enter set
  exit (p div 2) -&gt;R.%getShort
  #);
<B>SignedShort</B><A name="SignedShort.1(528)"></A>: CStructField
  (# set: @(# val: @int16 enter val do (val,p div 2) -&gt;R.%putShort #);
  enter set
  exit (p div 2) -&gt;R.%getSignedShort
  #);
<B>Long</B><A name="Long.1(529)"></A>: CStructField
  (# set: @(# val: @int32 enter val do (val,p div 4) -&gt;R.%putLong #);
  enter set
  exit (p div 4)-&gt;R.%getLong
  #);

--LIB: attributes--
<B>ExternalRecord</B><A name="ExternalRecord.1(530)"></A>: 
  (* Super-pattern for describing externally allocated record-structures.
   * A call to e.g. a C routine may often return a pointer to a CStruct.
   * By assigning such a pointer to the ptr-field of an externalRecord 
   * object it is possible to interface to such an external CStruct.
   * Notice the difference to the CStruct pattern, which is typically used
   * to *provide* external code with a structure allocated in BETA.
   *)
  (# <B>ptr</B><A name="ExternalRecord.1.ptr.2(531)"></A><A name="ptr.2(531)"></A>: @int32; (* pointer to the externally allocated record *)
     <B>GetByte</B><A name="ExternalRecord.1.GetByte.2(532)"></A><A name="GetByte.2(532)"></A>: 
       (# byteno: @int32;
       enter byteno
       exit %getByteAt (ptr+byteno)
       #);
     <B>PutByte</B><A name="ExternalRecord.1.PutByte.2(533)"></A><A name="PutByte.2(533)"></A>: 
       (# val: @int8;
          byteno: @int32;
       enter(byteno,val)
       do val %putByteAt (ptr+byteno)
       #);
     <B>GetShort</B><A name="ExternalRecord.1.GetShort.2(534)"></A><A name="GetShort.2(534)"></A>: 
       (# byteno: @int32;
       enter byteno
       exit %getShortAt (ptr+byteno)
       #);
     <B>GetSignedShort</B><A name="ExternalRecord.1.GetSignedShort.2(535)"></A><A name="GetSignedShort.2(535)"></A>: 
       (# byteno: @int32;
       enter byteno
       exit %getSignedShortAt (ptr+byteno)
       #);
     <B>PutShort</B><A name="ExternalRecord.1.PutShort.2(536)"></A><A name="PutShort.2(536)"></A>: 
       (# val: @int16;
          byteno: @int32;
       enter(byteno,val)
       do val %putShortAt (ptr+byteno)
       #);
     <B>GetLong</B><A name="ExternalRecord.1.GetLong.2(537)"></A><A name="GetLong.2(537)"></A>: 
       (# byteno: @int32
       enter byteno
       exit %getLongAt (ptr+byteno)
       #);
     <B>PutLong</B><A name="ExternalRecord.1.PutLong.2(538)"></A><A name="PutLong.2(538)"></A>: 
       (# val: @int32;
          byteno: @int32
       enter(byteno,val)
       do val %putLongAt (ptr+byteno)
       #);
     
     <B>ExternalRecordField</B><A name="ExternalRecord.1.ExternalRecordField.2(539)"></A><A name="ExternalRecordField.2(539)"></A>: 
       (* For declaring fields in ExternalRecords *)
       (# pos:&lt; IntegerValue; 
          p: @pos;
       #);
     <B>Byte</B><A name="ExternalRecord.1.Byte.2(540)"></A><A name="Byte.2(540)"></A>: ExternalRecordField
       (# set: @(# val: @int8 enter val do val %putByteAt (ptr+p) #)
       enter set
       exit %getByteAt (ptr+p)
       #);
     <B>Short</B><A name="ExternalRecord.1.Short.2(541)"></A><A name="Short.2(541)"></A>: ExternalRecordField
       (# set: @(# val: @int16 enter val do val %putShortAt (ptr+p) #);
       enter set
       exit %getShortAt (ptr+p)
       #);
     <B>SignedShort</B><A name="ExternalRecord.1.SignedShort.2(542)"></A><A name="SignedShort.2(542)"></A>: ExternalRecordField
       (# set: @(# val: @int16 enter val do val %putShortAt (ptr+p) #);
       enter set
       exit %getSignedShortAt (ptr+p)
       #);
     <B>Long</B><A name="ExternalRecord.1.Long.2(543)"></A><A name="Long.2(543)"></A>: ExternalRecordField
       (# val: @int32;
          set: @(# enter val do val %putLongAt (ptr+p) #);
       enter set
       exit %getLongAt (ptr+p)
       #);
     <B>DoubleLong</B><A name="ExternalRecord.1.DoubleLong.2(544)"></A><A name="DoubleLong.2(544)"></A>: ExternalRecordField
       (# v1,v2: @int32; 
          set: @(# enter(v1,v2) 
                do v1 %putLongAt (ptr+p);
                   v2 %putLongAt (ptr+p+4);
                #);
       enter set
       exit (%getLongAt (ptr+p), %getLongAt (ptr+p+4))
       #);
  #) (* ExternalRecord *);

<B>makeCBF</B><A name="makeCBF.1(545)"></A>: External
  (* Call this external to install a callback and get
   * an int32 pointer to it.
   *)
  (# <B>pat</B><A name="makeCBF.1.pat.2(546)"></A><A name="pat.2(546)"></A>: ##External;
     <B>cb</B><A name="makeCBF.1.cb.2(547)"></A><A name="cb.2(547)"></A>: @int32;
  enter pat##
  exit cb
  #);

<B>freeCBF</B><A name="freeCBF.1(548)"></A>: External
  (* Call this external with an int32 pointer to an installed
   * callback (obtained via MakeCBF) when it is certain that the
   * callback will NOT be called again.
   * This will free BETA heap space associated with the callback.
   *)
  (# <B>cbf</B><A name="freeCBF.1.cbf.2(549)"></A><A name="cbf.2(549)"></A>: @int32;
  enter cbf
  #)
</PRE>
<!---------------------------------------------------------->
<HR>
<P></P>
<TABLE cols=3 border=0 width=100%>
<TR>
<TD width="40%" align="left"><ADDRESS>External Interface</ADDRESS></TD>
<TD width="20%" align="center"><FONT size=-1>&COPY; <A HREF="http://www.mjolner.com" TARGET="_top">Mj&oslash;lner Informatics</A></FONT></TD>
<TD width="40%" align="right"><SCRIPT LANGUAGE=JavaScript SRC="../../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
</BODY>
</HTML>
