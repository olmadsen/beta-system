<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd"
>
<HTML>
<!-- Autogenerated file - do not edit -->
<HEAD>
<META http-equiv="Content-Type" CONTENT="text/html; CHARSET=ISO-8859-1">
<TITLE>Texthash Interface</TITLE>
<LINK REL="stylesheet" HREF="../../style/miadoc.css" TYPE="text/css">

<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript" SRC="../../javascript/hashfromparent.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript">
<!--
    CheckParent("texthash");
//-->
</SCRIPT>
<BASE TARGET="_parent">
</HEAD>
<BODY onLoad='HashFromParent()'>
<H1><A name="texthash">Texthash Interface</A></H1>

<PRE CLASS=interface>
ORIGIN '~beta/basiclib/betaenv';
LIB_DEF 'texthash' '../lib';
--- lib:attributes ---
(* This is a pattern implementing a hash of a text into an integer.
 * 
 * Usage:
 *      ph: @honeyman;
 *      ...
 * do ph.init;
 *    ...
 *    'Some text' -&gt; ph.hash -&gt; hashValue
 * 
 * This version is a BETA implementation of a hash function found in:
 *
 *       C News Source, which contains the following statement:
 *
 * "dbz.c  V3.2
 *
 * Copyright 1988 Jon Zeeff (zeeff@b-tech.ann-arbor.mi.us)
 * You can use this code in any manner, as long as you leave my name on it
 * and don't hold me responsible for any problems with it.
 *
 * Hacked on by gdb@ninja.UUCP (David Butler); Sun Jun  5 00:27:08 CDT 1988
 *
 * Various improvments + INCORE by moraes@ai.toronto.edu (Mark Moraes)
 * 
 * Major reworking by Henry Spencer as part of the C News project."
 *
 * The following text is the original comment before the hash function:
 *
 * This is a simplified version of the pathalias hashing function.
 * Thanks to Steve Belovin and Peter Honeyman
 *
 * hash a string into a long int.  31 bit crc (from andrew appel).
 * the crc table is computed at run time by crcinit() -- we could
 * precompute, but it takes 1 clock tick on a 750.
 *
 * This fast table calculation works only if POLY is a prime polynomial
 * in the field of integers modulo 2.  Since the coefficients of a
 * 32-bit polynomial won't fit in a 32-bit word, the high-order bit is
 * implicit.  IT MUST ALSO BE THE CASE that the coefficients of orders
 * 31 down to 25 are zero.  Happily, we have candidates, from
 * E. J.  Watson, "Primitive Polynomials (Mod 2)", Math. Comp. 16 (1962):
 *      x^32 + x^7 + x^5 + x^3 + x^2 + x^1 + x^0
 *      x^31 + x^3 + x^0
 *
 * We reverse the bits to get:
 *      111101010000000000000000000000001 but drop the last 1
 *         f   5   0   0   0   0   0   0
 *      010010000000000000000000000000001 ditto, for 31-bit crc
 *         4   8   0   0   0   0   0   0
 *)

<B>honeyman</B><A name="honeyman.1(1089)"></A>: (* BETA VERSION *)
  (# <B>POLY</B><A name="honeyman.1.POLY.2(1090)"></A><A name="POLY.2(1090)"></A>: (# exit 0x48000000 #);
     <B>CrcTable</B><A name="honeyman.1.CrcTable.2(1091)"></A><A name="CrcTable.2(1091)"></A>: [128]@Integer;

     <B>init</B><A name="honeyman.1.init.2(1092)"></A><A name="init.2(1092)"></A>:
       (# j,sum: @Integer;
       do (for i:128 repeat
               0-&gt;sum; 6-&gt;j;
               loop:
                 (#
                 do (if ((i-1) %Band (1 %sll j)) then
                        (sum %Bxor (POLY %srl j))-&gt;sum;
                    if);
                    (if j&gt;0 then j-1-&gt;j; restart loop if);
                 #);
               sum-&gt;CrcTable[i];
          for);
       #);

     <B>hash</B><A name="honeyman.1.hash.2(1093)"></A><A name="hash.2(1093)"></A>: @  
       (# t: ^Text; sum: @Integer;
       enter t[]
       do 0-&gt;sum;
          (for i:t.lgth repeat
               (sum %srl 7) %Bxor CrcTable[((sum %Bxor t.T[i]) %Band 0x7f) + 1]
                 -&gt;sum;
          for);
       exit sum
       #);
  #)
</PRE>
<P></P>
<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<HR>
<P></P>
<TABLE border=0 width="100%">
<TR>
<TD width="40%" align="left"><ADDRESS>Texthash Interface</ADDRESS></TD>
<TD width="20%" align="center"><FONT size="-1">&#169; <A HREF="http://www.mjolner.com" TARGET="_top">Mj&oslash;lner Informatics</A></FONT>
</TD>
<TD width="40%" align="right"><SCRIPT TYPE="text/javascript" LANGUAGE=JavaScript SRC="../../javascript/lastmod.js"></SCRIPT></TD>
</TABLE>
</BODY>
</HTML>
