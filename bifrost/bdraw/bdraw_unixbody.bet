ORIGIN 'bdrawenv';
INCLUDE '../private/X11/CanvasXtImpl';
INCLUDE '~beta/basiclib/v1.4/file';
INCLUDE 'menus';

-- BdrawPrint: descriptor--
(# out: @file;
   A4: (# exit (0, 0, 595, 822) #);
do (* For now just save eps in file. Later: read env var with command *)
   'bdraw.ps' -> out.name;
   out.openWrite;
   (A4, true, 1, out[]) -> maincanvas.writeEPS;
   out.close;
   'EPS output written to ''bdraw.ps''' -> Note;
#)

-- BdrawExtensions: descriptor --
(# dpy, root, bitmap, status: @integer;
   filename: ^text;
   width, height, bmap: @integerref;
   doiconify: 
     (# do (XtNiconic, true) -> topWindow.setIntegerResource #);
   menufonts: @MotifFontList
     (# addText:
          (* Add one entry to THIS(MotifFontList) *)
          (# font, charset: ^text;
             fontstruct: @integer;
          enter (font[], charset[])
          do (xdisplay, font) -> XLoadQueryFont -> fontstruct;
             (if value
              // 0 then
                 (fontstruct, @@charset.T[1])
                   -> XmFontListCreate -> value
              else
                 (value, fontstruct, @@charset.T[1])
                   -> XmFontListAdd -> value
             if)
          #);
     #);     
   menulabel: @MotifString
     (# setT:
          (# string, charset: ^text;
          enter (string[], charset[])
          do (string[], charset[], XmSTRING_DIRECTION_L_TO_R)  -> setTextSegment;
          #)
     #);
   menubar: ^menubarpattern;
do 
   (* Add iconify pattern *)
   doiconify## -> iconify##;
   
   (* Specify icon for toplevel *)
   ('~beta/bifrost/v2.0/bitmaps/mjoelner.xbm', '') 
     -> bifrostprivate.PH.convertFilePath
     -> filename[];
   xdisplay -> dpy -> XDefaultRootWindow -> root;
   (dpy,root,filename,width,height,bmap,0,0)
     -> XReadBitmapFile -> status;
   (if status
    // XBitmapOpenFailed then
       'Cannot open bitmap file '->puttext; filename[]->putline; 
    // XBitmapFileInvalid then
       filename[]->puttext;
       ' is not a valid bitmap file' -> putline;
    // XBitmapNoMemory then
       'Not enough memory to hold bitmap file '->puttext;
       filename[] -> putline;
    // XBitmapSuccess then
       bmap.value -> bitmap;
   if);
   (XtNiconPixmap, bitmap) -> topwindow.setIntegerresource;
   
   (* Specify fonts for Text submenus *)
   ('-*-COURIER-MEDIUM-R-*-120-*-ISO8859-1',   'courier')   -> menufonts.addText;
   ('-*-TIMES-MEDIUM-R-*-120-*-ISO8859-1',     'times')     -> menufonts.addText;
   ('-*-HELVETICA-MEDIUM-R-*-120-*-ISO8859-1', 'helvetica') -> menufonts.addText;
   ('-*-MEDIUM-R-*-120-*-ISO8859-1', 'plain')  -> menufonts.addText;
   ('-*-BOLD-R-*-120-*-ISO8859-1', 'bold')     -> menufonts.addText;
   ('-*-MEDIUM-I-*-120-*-ISO8859-1', 'italic') -> menufonts.addText;
   menulabel.init;
   topwindow.themenubar -> menubar[];
   
   ('Plain', 'plain') -> menulabel.setT;
   menubar.menus.TextMenu.istyle.Stylemenu.iplain.scanMotifmenuItems
   (# 
   do (XmNfontList, menufonts)    -> current.setIntegerResource;
      (XmNlabelString, menulabel) -> current.setIntegerResource;
   #);
    
   ('Bold', 'bold') -> menulabel.setT;
   menubar.menus.TextMenu.istyle.Stylemenu.ibold.scanMotifmenuItems
   (# 
   do (XmNfontList, menufonts)    -> current.setIntegerResource;
      (XmNlabelString, menulabel) -> current.setIntegerResource;
   #);
    
   ('Italic', 'italic') -> menulabel.setT;
   menubar.menus.TextMenu.istyle.Stylemenu.iitalic.scanMotifmenuItems
   (# 
   do (XmNfontList, menufonts)    -> current.setIntegerResource;
      (XmNlabelString, menulabel) -> current.setIntegerResource;
   #);
    
   ('Times', 'times') -> menulabel.setT;
   menubar.menus.TextMenu.ifont.Fontmenu.itimes.scanMotifmenuItems
   (# 
   do (XmNfontList, menufonts)    -> current.setIntegerResource;
      (XmNlabelString, menulabel) -> current.setIntegerResource;
   #);
    
   ('Helvetica', 'helvetica') -> menulabel.setT;
   menubar.menus.TextMenu.ifont.Fontmenu.ihelvetica.scanMotifmenuItems
   (# 
   do (XmNfontList, menufonts)    -> current.setIntegerResource;
      (XmNlabelString, menulabel) -> current.setIntegerResource;
   #);
   
   ('Courier', 'courier') -> menulabel.setT;
   menubar.menus.TextMenu.ifont.Fontmenu.icourier.scanMotifmenuItems
   (# 
   do (XmNfontList, menufonts)    -> current.setIntegerResource;
      (XmNlabelString, menulabel) -> current.setIntegerResource;
   #);

   
#)
