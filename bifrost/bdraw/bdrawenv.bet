ORIGIN '../Bifrost';
INCLUDE '../ColorNames';
INCLUDE '../PredefinedGO';
INCLUDE '../SelectionPicture';

---- LIB: attributes -----

bdrawenv: guienv
  (# topwindow: @window
       (# 
          menubarpattern: menubar
            (# menus: @<<SLOT BdrawMenus: descriptor>>;
               setdefaults: <<SLOT BdrawMenusDefaults: descriptor>>;
               open:: (# <<SLOT BdrawInitMenus: dopart>> #)
            #);
          menubartype:: menubarpattern;
                 
          <<SLOT bdrawattributes: attributes>>;
          
          maincanvas: @BifrostCanvas
            (# eventhandler::
                 (# onOpen::< (# <<SLOT WindowOpen: dopart>> #);
                    onKeyDown::< (# do ch -> doKeyPressed #);
                    onmouseDown::< (# <<SLOT WindowButton: dopart>> #);
                 #)
            #);
          Zoomed: @Boolean;
          actualPosition, actualSize: @Point;
          
          State: @
            (# s: @integer
            enter (# enter s <<SLOT NewState: dopart>> #)
            exit  (# <<SLOT State: dopart>> exit s #)
            #);
          
          clickpos: @point;
          mouseclickshiftmodified: @boolean;
          
          SelectMode:	   	(# exit  1 #);
          RectObject:	   	(# exit  2 #);
          EllipseObject:   	(# exit  3 #);
          UserDefObject:   	(# exit  4 #);
          PieObject:       	(# exit  5 #);
          TextObject:	   	(# exit  6 #);
          LineObject:	   	(# exit  7 #);
          MultiLineObject:      (# exit  8 #);
          StrokedRectObject:    (# exit  9 #);
          StrokedEllipseObject: (# exit 10 #);
          ArcObject:            (# exit 11 #);
          
          HoldObjectType: @boolean;
          
          mySolidColor: @SolidColor;
          myLineWidth: @Integer;
          myCapstyle: @capstyledesc;
          myJoinstyle: @joinstyledesc;
          myFontName: @Fontname;
          myStyle: @Style;
          mySize: @Integer;
          myUnderlineFlag: @Boolean;
          myFillRule: @integer;
          
          theSelection: ^SelectionPicture;
          clipboard: ^Picture;
          
          AddingToSelected: @Boolean;
          
          (********** CURSORS **********)
          
          savedcursor: @<<SLOT SavedCursor: descriptor>>;
          
          savecursor: @<<SLOT saveCursor: descriptor>>;
          restorecursor: @<<SLOT restoreCursor: descriptor>>;
          
          watchcursor: @<<SLOT WatchCursor: descriptor>>;
          ulcornercursor: @<<SLOT UlCornerCursor: descriptor>>;
          lrcornercursor: @<<SLOT LrCornerCursor: descriptor>>;
          leftptrcursor: @<<SLOT leftptrcursor: descriptor>>;
          lefthandcursor: @<<SLOT lefthandcursor: descriptor>>;
          crosscursor: @<<SLOT crosscursor: descriptor>>;
          beamcursor: @<<SLOT beamcursor: descriptor>>;
          
          InitCursors: @<<SLOT InitCursors: descriptor>>;
                    
          (********** PALETTE ***********)
          
          thepalette: @<<SLOT PaletteBody: descriptor>>;
          
          (************ CANVASES *************)
          
          Logo: @BifrostCanvas
            (# open:: (# <<SLOT InitializeLogo: dopart>> #);
               eventhandler::
                 (# onOpen:: (# do <<SLOT Logo:descriptor>> #)
                 #);
            #);
          
          ColorCanvas: @BifrostCanvas
            (# theLine: @Line;
               eventhandler::
                 (# onOpen:: (# do theLine[] -> draw #)#);
               open:: (# do <<SLOT InitializeColorCanvas: descriptor>> #);
               update: <<SLOT UpdateColorCanvas: descriptor>>;
            #);
          
          Inform: @BifrostCanvas
            (# t: @text;
               label: @GraphicText;
               clear: <<SLOT ClearInfo:descriptor>>;
               open:: (# do <<SLOT InitInfo:descriptor>> #);
               eventhandler::
                 (# onOpen::< (# <<SLOT OpenInfo: dopart>> #)#);
            enter (# enter t do <<SLOT SetInfo:descriptor>> #)
            #);
          
          (**************************** DIALOGS ********************************)
          
          Dialogs: @<<SLOT Dialogs: descriptor>>;
          
          InitDialogs: @<<SLOT InitDialogs: descriptor>>;
          
          ReadInt:
            (# title (* Title bar of dialog *),
               prompt (* Prompt in dialog *): ^text;
               useit:< IntegerObject; (* Specialize to use integer read *)
            enter (prompt[], title[])
            <<SLOT ReadIntBody:dopart>>
            #);
          
          ReadRGB: @(# <<SLOT ReadRGB: dopart>>#);
          
          ReadHSV: @(# <<SLOT ReadHSV: dopart>>#);
          
          ReadCMY: @(# <<SLOT ReadCMY: dopart>>#);
          
          Note: 
            (# message: ^text
            enter message[]
               <<SLOT BdrawNote: dopart>>
            #);
          
          (**************************** ACTIONS ********************************)
          
          Extensions: @<<SLOT BdrawExtensions: descriptor>>;
          
          NewFile: <<SLOT NewFile:descriptor>>;
          
          OpenFile: <<SLOT OpenFile:descriptor>>;
          
          SaveFile: <<SLOT SaveFile:descriptor>>;
          SaveFileAs: <<SLOT SaveFileAs:descriptor>>;
          
          ExportEPS: <<SLOT ExportEPS: descriptor>>;
          Print: <<SLOT BdrawPrint: descriptor>>;
          
          Quit: <<SLOT Quit:descriptor>>;
          
          Undo: <<SLOT Undo:descriptor>>;
          
          Cut: <<SLOT Cut:descriptor>>;
          
          Copy: <<SLOT Copy:descriptor>>;
          
          Paste: <<SLOT Paste:descriptor>>;
          
          Duplicate: <<SLOT Duplicate:descriptor>>;
          
          SelectAll: <<SLOT SelectAll:descriptor>>;
          
          ShowClipboard: <<SLOT ShowClipboard:descriptor>>;
          
          ClearSelection: <<SLOT ClearSelection:descriptor>>;
          
          RaiseSelection: <<SLOT RaiseSelection:descriptor>>;
          
          LowerSelection: <<SLOT LowerSelection:descriptor>>;     
          
          Group: <<SLOT Group:descriptor>>;
          
          Ungroup: <<SLOT Ungroup:descriptor>>;
          
          Smooth: <<SLOT Smooth:descriptor>>;
          
          Unsmooth: <<SLOT Unsmooth:descriptor>>;
          
          ReverseOrientation: <<SLOT ReverseOrientation:descriptor>>;
          
          StrokeShape: <<SLOT StrokeShape:descriptor>>;
          
          CombineShape: <<SLOT BdrawCombineShape: descriptor>>;
          
          SetFillRule: (# r: @integer enter r do <<SLOT SetFillRule: descriptor>> #);
          
          Move: <<SLOT Move:descriptor>>;
          
          MoveTo: <<SLOT MoveTo:descriptor>>;
          
          Scale: <<SLOT Scale:descriptor>>;
          
          Rotate: <<SLOT Rotate:descriptor>>;
          
          FlipHor: <<SLOT FlipHor:descriptor>>;
          
          FlipVer: <<SLOT FlipVer:descriptor>>;
          
          Select: <<SLOT Select:descriptor>>;
          
          Zoom: <<SLOT Zoom:descriptor>>;
          
          RefreshAll: <<SLOT RefreshAll:descriptor>>;
          
          Iconify: ##object;
          
          Debug: <<SLOT DebugBody:descriptor>>;
          
          ColorChanged: <<SLOT ColorChanged:descriptor>>;
          
          ColorInfo: <<SLOT ColorInfo:descriptor>>;
          
          LineAttChanged: <<SLOT LineAttChanged:descriptor>>;
          
          TextAttChanged: <<SLOT TextAttChanged: descriptor>>;
          
          doLeftButton: <<SLOT DoLeftButton:descriptor>>;
          
          doMiddleButton: <<SLOT DoMiddleButton:descriptor>>;
          
          doRightButton: <<SLOT DoRightButton:descriptor>>;
          
          doKeyPressed: (# ch:@char enter ch do <<SLOT DoKeyPressed:descriptor>> #);
          
          open::
            (* topWindow *)
            (# do <<SLOT OpenBdraw:descriptor>> #)
          
       #);
     
     variant: <<SLOT BdrawVariant: descriptor>>;
     version: <<SLOT BdrawVersion: descriptor>>;
     description: <<SLOT BdrawDescription: descriptor>>;
     
  do (* bdrawenv *)
     variant;
     description;
     newline;
     topwindow.open;
  #)

