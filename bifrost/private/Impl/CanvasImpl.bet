ORIGIN 'BifrostImpl';
BODY 'CanvasImplBody'
-- CanvasAttributes: attributes --

UpdateCoordinateSystem:
  (# s: @point;
  do size -> s;
     NONE -> visualShape[];
     <<SLOT CanvasUpdateCoordImpl: descriptor>>;
     (if visualShape[] = NONE then
         &Shape[] -> visualShape[];
         visualShape[] -> clipShape[];
     if);
     
     (* clear the visible shape *)
     none -> visualShape.privatepart.SegmentList[];
     
     (* set visibleShape to size of the BifrostCanvas window *)
     (0,0) -> visualShape.open;
     (s.x,0) -> visualShape.lineto;
     (s.x,s.y) -> visualShape.lineto;
     (0,s.y) -> visualShape.lineto;
     visualShape.close;
     
     (* force recalculation of go's according to new coordinatesystem *)
     thepicture.scanGOs(# do go.theshape.invalidate #);
  #);
