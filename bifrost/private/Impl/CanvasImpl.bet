ORIGIN 'BifrostImpl';
BODY 'CanvasImplBody'
-- CanvasAttributes: attributes --

UpdateCoordinateSystem:
  (# s: @point;
     CanvasUpdateCoordImpl:
       (* Adjust TM according to unit difference and
        * axis orientation in device.
        *)
       <<SLOT CanvasUpdateCoordImpl: descriptor>>;
  do NONE -> visualShape[];
     size -> s;
     CanvasUpdateCoordImpl;
     (if visualShape[] = NONE then
         &Shape[] -> visualShape[];
         visualShape[] -> clipShape[];
     if);
     
     (* clear the visible shape *)
     none -> visualShape.privatepart.SegmentList[];
     
     (* set visibleShape to size of the unzoomed BifrostCanvas window *)
     (0,0) -> visualShape.open;
     (if ((0,0), privatepart.unzoomedsize)->EqualPoint then
         s -> privatepart.unzoomedsize;
     if);
     (privatepart.unzoomedsize.x,0) -> visualShape.lineto;
     privatepart.unzoomedsize -> visualShape.lineto;
     (0,privatepart.unzoomedsize.y) -> visualShape.lineto;
     visualShape.close;
     
     (* force recalculation of go's according to new coordinatesystem *)
     thepicture.scanGOs(# do go.theshape.invalidate #);
  #);
