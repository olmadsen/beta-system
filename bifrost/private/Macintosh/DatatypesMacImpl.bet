ORIGIN '../Impl/DatatypesImpl';
[[
-- INCLUDE '~beta/maclib/maclib'

-- BifrostAttributes: attributes --

     (* Descriptor for dynamic reference to MAC points *)

     MacPointDesc: (# p: [1] @Integer #);
	 
	MakeBifrostRect:
	(# r: @Rectangle;
	   mr: ^macrect;
	enter mr[]
	do	  
	  (%getSignedShortAt (@@mr.R[1]+2)) -> r.x;
	  (%getSignedShortAt (@@mr.R[1]+0)) -> r.y;
	  (%getSignedShortAt (@@mr.R[1]+6) - r.x) -> r.width;
	  (%getSignedShortAt (@@mr.R[1]+4) - r.y) -> r.height;
	exit r
	#);


-- PointArrayAttributes: Attributes --
     
     ToMacPoints:
       (# macPoints: @macpointdesc;
	      p: @Point;
	      TM: ^Matrix
       enter TM[]
       do npoints -> macpoints.p.extend;
	      (for i:npoints repeat
	           (if TM[]<>NONE then
			       private.points[i] -> TM.transformPoint -> p;
			   if);
	       	   (p.x, 0) -> macPoints.p[i].%putshort;
	       	   (p.y, 1) -> macPoints.p[i].%putshort;
	       for);
       exit macpoints[]
       #);
	   
--]]
