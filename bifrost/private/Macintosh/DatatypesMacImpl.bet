ORIGIN '../Impl/DatatypesImpl';
[[
-- INCLUDE 'MacLibExtentions'

-- GraphicsAttributes: attributes --

     (* Descriptor for dynamic reference to MAC points *)

     MacPointDesc: (# p: [1] @Integer #);
	 
	MakeMacRect:
	(# r: @Rectangle;
	   mr: ^MacRectangle;
	enter (r,mr[])
	do
	  (mr.R,2,r.x)->TOS'%inxPutShort';
	  (mr.R,0,r.y)->TOS'%inxPutShort';
	  (mr.R,6,r.x+r.width)->TOS'%inxPutShort';
	  (mr.R,4,r.y+r.height)->TOS'%inxPutShort';
	#);
	
	MakeBifrostRect:
	(# r: @Rectangle;
	   mr: ^MacRectangle;
	enter mr[]
	do	  
	  @@mr.R[1]+2 -> TOS'%adrGetSignedShort[0]' -> r.x;
	  @@mr.R[1]+0 -> TOS'%adrGetSignedShort[0]' -> r.y;
	  (@@mr.R[1]+6 -> TOS'%adrGetSignedShort[0]') - r.x -> r.width;
	  (@@mr.R[1]+4 -> TOS'%adrGetSignedShort[0]') - r.y -> r.height;
	exit r
	#);


-- PointArrayAttr: Attributes --
     
     ToMacPoints:
       (# macPoints: @macpointdesc;
	      p: @Point;
	      TM: ^Matrix
       enter TM[]
       do npoints -> macpoints.p.extend;
	      (for i:npoints repeat
	           (if TM[]<>NONE//true then
			       private.points[i] -> TM.transformPoint -> p;
			   if);
	       	   (@@macPoints.p[i],p.x) -> TOS'%putshort[0]';
	           (@@macPoints.p[i],p.y) -> TOS'%putshort[1]';
	       for);
       exit macpoints[]
       #);
	   
--]]
