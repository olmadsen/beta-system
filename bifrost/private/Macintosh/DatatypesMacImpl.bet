ORIGIN '../Impl/DatatypesImpl';
[[
-- INCLUDE '~beta/maclib/v3.1/maclib'

-- BifrostAttributes: attributes --

     (* Descriptor for dynamic reference to MAC points *)

     MacPointDesc: (# p: [1] @Integer #);
	 
	MakeBifrostRect:
	(# r: @Rectangle;
	   mr: ^macrect;
	enter mr[]
	do	  
	  @@mr.R[1]+2 -> TOS'%adrGetSignedShort[0]' -> r.x;
	  @@mr.R[1]+0 -> TOS'%adrGetSignedShort[0]' -> r.y;
	  (@@mr.R[1]+6 -> TOS'%adrGetSignedShort[0]') - r.x -> r.width;
	  (@@mr.R[1]+4 -> TOS'%adrGetSignedShort[0]') - r.y -> r.height;
	exit r
	#);


-- PointArrayAttributes: Attributes --
     
     ToMacPoints:
       (# macPoints: @macpointdesc;
	      p: @Point;
	      TM: ^Matrix
       enter TM[]
       do npoints -> macpoints.p.extend;
	      (for i:npoints repeat
	           (if TM[]<>NONE//true then
			       private.points[i] -> TM.transformPoint -> p;
			   if);
	       	   (@@macPoints.p[i],p.x) -> TOS'%putshort[0]';
	           (@@macPoints.p[i],p.y) -> TOS'%putshort[1]';
	       for);
       exit macpoints[]
       #);
	   
--]]
