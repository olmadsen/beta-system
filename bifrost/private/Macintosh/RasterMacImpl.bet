ORIGIN '../Impl/RasterImpl'

[[

-- INCLUDE 'GraphicsMacImpl'
-- INCLUDE 'MacBifrostEnv'

(************* Rasters ****************)

-- RasterCalculate: descriptor --
     (# #)

(* Bitmap *)

-- BitMapPrivatePart: descriptor --
     (# MacBitMap: @BitMapPtr;
	    realwidth: @Integer;
		baseAddrPeek: @Integer;
		padright: @Integer;
      #)

-- InitBitMapBody: descriptor --
     (# aRect: @MacRectangle;
	 do 14 -> NewPtr -> bitmapprivatepart.MacBitMap;
        ((width+15) div 16) * 16 -> bitmapprivatepart.realwidth; (* word alignment *)
		bitmapprivatepart.realwidth - width -> bitmapprivatepart.padright;
		(if env.macDebug//true then
			newline;
			'InitBitMapBody realw: ' -> puttext;
			bitmapprivatepart.realwidth -> putint; newline;
		if);
		bitmapprivatepart.realwidth div 8 -> bitmapprivatepart.MacBitMap.rowBytes;
		(width+1,height+1) -> (aRect.width,aRect.height);
		aRect -> bitmapprivatepart.MacBitMap.bounds;
		bitmapprivatepart.realwidth * height -> NewPtr 
		  -> bitmapprivatepart.MacBitMap.baseAddr 
		  -> bitmapprivatepart.baseAddrPeek;

		(if env.macDebug//true then
			'size: ' -> puttext;
			bitmapprivatepart.realwidth * height -> putint; newline;
			'bounds ' -> puttext; width -> putint; ' ' -> put; height -> putint;
			newline; 'baseaddr: ' -> puttext;
			bitmapprivatepart.baseAddrPeek -> putint; newline;
		if);
	 #)

-- BitMapCalculate: descriptor --
     (##)

-- BitMapPutPixel: descriptor --
     (##)

-- BitMapGetPixel: descriptor --
     (##)
-- BitmapConvertPBMrow: descriptor --
     (#	byteno,theByte,bitsperitem: @integer;
	    putbit: @
          (# b,theBit: @integer;
          enter b
          do (if b//1 then
                 (if bitsperitem
                  // 7 then   1 -> theBit
                  // 6 then   2 -> theBit
                  // 5 then   4 -> theBit
                  // 4 then   8 -> theBit
                  // 3 then  16 -> theBit
                  // 2 then  32 -> theBit
                  // 1 then  64 -> theBit
                  // 0 then 128 -> theBit
                  if);
                 theByte+theBit -> theByte;
             if);
             bitsperitem+1 -> bitsperitem;
			 (if bitsperitem//8 then 
		         theByte -> putbyte;
             	 0 -> bitsperitem -> theByte;
			 if);
          #);
        putbyte: @
          (#
		     item: @char;
		  enter item
		  do (if byteno
			  // 0 then
				 (bitmapprivatepart.baseAddrPeek, item) -> TOS'%PutByte[0]';
			  // 1 then
				 (bitmapprivatepart.baseAddrPeek, item) -> TOS'%PutByte[1]';
			  // 2 then
				 (bitmapprivatepart.baseAddrPeek, item) -> TOS'%PutByte[2]';
			  // 3 then
				 (bitmapprivatepart.baseAddrPeek, item) -> TOS'%PutByte[3]';
			 if);
			 byteno+1 -> byteno;
             (if byteno//4 then 
			     bitmapprivatepart.baseAddrPeek+4 -> bitmapprivatepart.baseAddrPeek; 
				 0 -> byteno;
			 if);
          #);
		  
        readrawpbmrow: @
          (# 
          do (for i:pbmrow.range repeat pbmrow[i] -> putbyte for);
          #);
		readpbmrow: @
		  (#
          do (for i:width repeat pbmrow[i] -> putbit for);
		  #);
	 do
        0 -> byteno -> bitsperitem -> theByte;
	    (if rawbits
	 	 // true  then readrawpbmrow;
	 	 // false then readpbmrow
		if);
 		(for bitmapprivatepart.padright repeat 0 -> putbit for);
	 #)

(*** GrayMap ***)

-- GrayMapCalculate: descriptor --
     (# #)
-- GrayMapPrivatePart: descriptor --
     (# #)

-- InitGrayMapBody: descriptor --
     (#
     do
     #)

-- GrayMapPutPixel: descriptor --
     (#
     do
     #)

-- GrayMapGetPixel: descriptor --
     (#
     do
     #)

-- GrayMapCopy: descriptor --
     (# 
     #)

-- GrayMapWritePGM: descriptor -- (##)
-- GrayMapReadPGM: descriptor -- (##)



(*** PixMap ***)

-- PixMapCalculate: descriptor --
     (# #)

-- PixMapPrivatePart: descriptor --
     (#
      
     #)

-- InitPixMapBody: descriptor --
     (#
     #)

-- PixMapPutPixel: descriptor --
     (# #)

-- PixMapGetPixel: descriptor --
     (# 
     do
     #)

-- PixMapCopy: descriptor --
     (#  #)

-- PixMapWritePPM: descriptor -- (##)
-- PixMapReadPPM: descriptor -- (##)



(*** Compressed Pixmap ****)

-- CPixMapPrivatePart: descriptor --
     (#
     do 
     #)

-- InitCPixMapBody: descriptor --
     (#
     do 
     #)

-- CPixMapPutPixel: descriptor --
     (#
     do 
     #)

-- CPixMapGetPixel: descriptor --
     (#
     do 
     #)

-- CPixMapCopy: descriptor --
     (#  #)

-- CPixMapWritePPM: descriptor --
     (#
     do 
     #)

-- CPixMapReadPPM: descriptor --
     (#
     do 
     #)

-- CPixMapCalculate: descriptor -- (##)

-- PictureDrawOnPixmap: descriptor -- (##)

--]]ÿ
