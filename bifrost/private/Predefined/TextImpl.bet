ORIGIN '../Impl/PredefinedImpl';

(********* Fonts and styles ***********)

-- CourierBody: dopart --
do 1->value;
   
   
-- TimesBody: dopart --
do 2->value;
   
   
-- HelveticaBody: dopart --
do 3->value;
   
   
-- PlainBody: dopart --
do 1->value;
   
   
-- ItalicBody: dopart --
do 2->value;
   
   
-- BoldBody: dopart --
do 3->value;
   
   
   
   (************ TextShape **********************)
   
-- BifrostAttributes: attributes --

TextShapeGetWidth:
  (# theText: @Text;
     nam: @Fontname;
     sty: @Style;
     siz: @Integer;
     width: @Integer;
  enter (theText, nam, sty, siz)
  do <<SLOT TextShapeGetWidth: descriptor >>;
  exit width
  #);

TextShapeMaxDescent:
  (# nam: @Fontname;
     sty: @Style;
     siz: @Integer;
     desc: @Integer;
  enter (nam, sty, siz)
  <<SLOT TextShapeMaxDescent: dopart>>
  exit desc
  #);

TextShapeUnderlineDepth:
  (# nam: @Fontname;
     sty: @Style;
     siz: @Integer;
     depth: @Integer;
  enter (nam, sty, siz)
  do <<SLOT TextShapeUnderlineDepth: descriptor >>;
  exit depth
  #);


-- TextShapeChangePosBody: dopart --
do p -> TextPrivate.position;
   Invalidate;
   
   
-- TextShapePosBody: dopart --
do TextPrivate.position -> p;
   
   
-- TextShapeChangeNameBody: dopart --
do nam -> TextPrivate.theFontName;
   Invalidate;
   
   
-- TextShapeTheFontNameBody: dopart --
do TextPrivate.theFontName -> nam;
   
   
-- TextShapeChangeStyleBody: dopart --
do sty -> TextPrivate.theStyle;
   Invalidate;
   
   
-- TextShapeTheStyleBody: dopart --
do TextPrivate.theStyle -> sty;
   
   
-- TextShapeChangeSizeBody: dopart --
do siz -> TextPrivate.theSize;
   Invalidate;
   
   
-- TextShapeSizeBody: dopart --
do TextPrivate.theSize -> siz;
   
   
-- TextShapeChangeUnderlineBody: dopart --
do ul -> TextPrivate.underline;
   Invalidate;
   
   
-- TextShapeUnderlineBody: dopart --
do TextPrivate.underline -> ul;
   
   
-- TextShapeChangeTextBody: dopart --
do (if t[]<>NONE
    // true then
       t -> TextPrivate.theString;
       Invalidate;
   if)
   
   
-- TextShapeTheTextBody: dopart --
do &text[]->t[]; TextPrivate.theString -> t;
   
   
-- TextShapePrivatePart: descriptor --
(# thestring: @Text;
   theFontName: @FontName;
   theStyle: @Style;
   theSize: @Integer;
   underline: @Boolean;
   position: @Point;
#)

-- TextShapeGetBoundsBody: descriptor --
(# desc, excess: @integer;
do (if privatepart.boundInvalid // true then
       
       TextPrivate.position.x            -> privatepart.bound.x;
       TextPrivate.position.y + size + 1 -> privatepart.bound.y;
       (theFontName, theStyle, size) -> TextShapeMaxDescent -> desc;
       privatepart.bound.y - desc        -> privatepart.bound.y;
       (privatepart.bound.x,privatepart.bound.y)
         -> privatepart.go2canvasTM.m.transformPoint
         -> (privatepart.bound.x,privatepart.bound.y);
       
       ((theText, theFontName, theStyle, size) -> TextShapeGetWidth) + 1 
         -> privatepart.bound.width;
       size+1 -> privatepart.bound.height;
       (* +1 to correct round-off errors *)
       (if TextPrivate.underline//true then
           ((theFontName, theStyle, size)->TextShapeUnderlineDepth)-desc 
             -> excess;
           (if (excess>0)//true then
               bound.height + excess -> privatepart.bound.height
           if);
       if);
       false -> privatepart.boundinvalid;
   if);
#)

-- TextShapeContainsPoint: dopart --
do (thePoint, getbounds) -> PointInRect -> value;
   INNER
   
-- TextShapeIntersects: dopart --
do INNER;
   'TextShape.Intersects' -> UnImplemented;
   
-- TextShapeWithin: dopart --
do INNER;
   'TextShape.Within' -> UnImplemented;
   
-- TextShapeCopyBody: descriptor --
(# ts: ^TextShape;
do (if aCopy[]//NONE then (* Not done in inner *)
       &TextShape[] -> ts[];
       position -> ts.position;
       theFontName -> ts.theFontName;
       theStyle -> ts.theStyle;
       size -> ts.size;
       underline -> ts.underline;
       TextPrivate.theString -> ts.TextPrivate.theString;
       ts[] -> aCopy[];
   if)
#)

-- TextShapeTransformBody: dopart --
do TextPrivate.position -> M.transformPoint -> TextPrivate.position;
   INNER;
   
-- TextShapeCalculate: dopart --
do 'TextShape: CalculateShape not implemented' -> putline;
   INNER;
   
-- TextShapeGetControlsBody: descriptor --
(# r: @Rectangle;
do
   getBounds -> r; (* bound in BifrostCanvas coordinates *)
   (r.x, r.y)  -> spots.addpoint;
   (r.x+r.width, r.y) -> spots.addpoint;
   (r.x+r.width, r.y-r.height) -> spots.addpoint;
   (r.x, r.y-r.height) -> spots.addpoint;
#)
