ORIGIN 'BifrostX11impl';

-- CanvasImmediateTextBody: descriptor --
(# (* Need to be in this fragmentgroup to see private attributes of 
    * font info
    *)
   width: @integer;
   xf: ^THIS(guienv).private.xfont;
do
   (THIS(BifrostCanvas)[], theFontName, theStyle, theSize) -> SetXFont;
   
   (xdisplay, 
   implpart.xdrawable, 
   implpart.xgc,
   pos.x,
   pos.y,
   thestring,
   thestring.lgth) -> XDrawString;
   
   (if underline//true then
       THIS(guienv).private.fonts.xfonts[theFontName].style[theStyle].size[theSize][]
         -> xf[];
       (* Safe to use because of SetXFont above *)
       
       (if xf.fixedwidth
        // true then 
           thestring.length*xf.width -> width;
        // false then
           (xf.fi,thestring.t, thestring.t.range) -> XTextWidth -> width;
       if);
       
       (xdisplay,
       implpart.xdrawable, 
       implpart.xgc,
       pos.x,
       pos.y + xf.upos,
       width,
       xf.uthick)
         -> XFillRectangle;
   if);
#)



-- SetXFontBody: descriptor --
(# xf: ^THIS(guienv).private.xfont;
do
   (nam,sty,siz) -> XCheckFontLoaded -> (xf[],nam,sty,siz);
   
   (* Set font in GC *)
   (xdisplay, 
   theCanvas.implpart.xgc,
   xf.XfontId) -> XSetFont;
   
   (* Temporarily store the current font in privatePart of 
    theCanvas
    *)
   xf[] -> theCanvas.implpart.currentxfont[];
   
#)

-- BifrostAttributes: attributes -- 
initBifrostFonts: 
  (# d: @Text;
     stylepattern: @THIS(guienv).private.fonts.stylearray;
     sizepattern:  @THIS(guienv).private.fonts.sizearray;
  do 
     (if debugGraphic //true then 'InitFonts ... ' -> puttext if);
     (for nam: THIS(guienv).private.fonts.xfonts.range repeat
          &THIS(guienv).private.fonts.stylearray[] 
            -> THIS(guienv).private.fonts.xfonts[nam][];
          
          (for sty: stylepattern.style.range repeat
               &THIS(guienv).private.fonts.sizearray[] 
                 -> THIS(guienv).private.fonts.xfonts[nam].style[sty][];
               
               (for siz: sizepattern.size.range repeat
                    &THIS(guienv).private.xfont[] 
                      -> THIS(guienv).private.fonts.xfonts[nam].style[sty].size[siz][];
                    false ->
                    THIS(guienv).private.fonts.xfonts[nam].style[sty].size[siz].loaded;
                    
               for);
          for);
     for);
     
     InitXFontNames;
     '8x13' -> THIS(guienv).private.fonts.defaultfont.name;
     THIS(guienv).private.fonts.defaultfont[] -> XLoadFontFromName;
     (if debugGraphic //true then 'done' -> putline if);
  #);

XCheckFontLoaded:
  (# nam: @FontName;
     sty: @Style;
     siz: @integer;
     subst: @boolean;
     xf: ^THIS(guienv).private.xfont;
     
  enter (nam,sty,siz)
  do
     (if debugGraphic //true then 
         'XCheckFontLoaded: Name style size ' -> puttext;
         nam -> screen.putint(# format::<(#do 6->width#)#);
         sty -> screen.putint(# format::<(#do 6->width#)#);
         siz -> screen.putint(# format::<(#do 6->width#)#); newline
     if);
     
     (* index checks *)
     (if ((nam<1) or (nam>THIS(guienv).private.fonts.xfonts.range))
      // true then
         (* no such fontname *)
         'No such font! Substituting standardfont' -> putline;
         Courier -> nam; Plain -> sty; 12 -> siz;
      // false then
         (if debugGraphic //true then 'XCheckFontLoaded: name ok' -> putline if);
         (* nam ok *)
         (if ((sty<1) or (sty>THIS(guienv).private.fonts.xfonts[nam].style.range))
          // true then
             (* no such style *)
             'No such style! Substituting Plain' -> putline;
             Plain -> nam; 12 -> siz;
          // false then
             (* nam & sty ok *)
	     (if debugGraphic //true then 'XCheckFontLoaded: style ok' -> putline if);
             (if ((siz<1) or 
                 (siz>THIS(guienv).private.fonts.xfonts[nam].style[sty].size.range))
              // true then
                 (* No such size *)
                 'Illegal text size: '->puttext; siz-> putint; 
	         '! Substituting 12' -> putline;
                 12 -> siz;
              // false then
                 (* nam & sty & siz ok *)
	         (if debugGraphic //true then 'XCheckFontLoaded: size ok' -> putline if);
             if);
         if);
     if);
     
     (if debugGraphic //true then 'XCheckFontLoaded: indexcheck completed' -> putline if);
     
     THIS(guienv).private.fonts.xfonts[nam].style[sty].size[siz][] 
       -> xf[];
     
     (* check that it is loaded, and if not, do it *)
     (if xf.loaded//false then
         
         (if xf.name.empty//true then
       	     (if displaywarnings//true then
       	         ascii.bel -> put;
       	         'Sorry, the X server has no font corresponding to '->puttext;
       	         (if nam
	    	  // Helvetica then 'Helvetica-' -> puttext;
	    	  // Times     then 'Times-' -> puttext;
	    	  // Courier   then 'Courier-' -> puttext;
	         if);
	         (if sty
	    	  // Plain  then 'Plain-' -> puttext;
	    	  // Bold   then 'Bold-' -> puttext;
	    	  // Italic then 'Courier-' -> puttext;
	         if);
	         siz -> putint; newline;
       	     if);
       	     
       	     true -> subst;  	   
       	     THIS(guienv).private.fonts.xfonts[nam].style[sty].size[1][] -> xf[];
         if);
         xf[] -> XLoadFontFromName;
         
         (if xf.loaded//false then
       	     (if displaywarnings//true then
    	         ascii.bel -> put;
       	         'Sorry, the X server has no font matching '''->puttext;
       	         xf.name[] -> puttext;
       	         ''''->put; newline;
       	     if);
       	     true -> subst;
       	     THIS(guienv).private.fonts.defaultFont[] -> xf[];
         if);
         
         (if subst//true then
       	     (if displaywarnings//true then 
       	         'Substituting with font: ''' -> puttext;
       	         xf.name[] -> puttext;
       	         ''''->put; newline;
       	     if);
       	     (* Trick to avoid work on next call of XCheckFontLoaded *)
       	     true ->
             THIS(guienv).private.fonts.xfonts[nam].style[sty].size[siz].loaded;
       	     xf[] -> THIS(guienv).private.fonts.xfonts[nam].style[sty].size[siz][];
         if);
         
         (if debugGraphic//true then
       	     'Font to be used: ' -> puttext;
       	     xf.name[] -> puttext;
       	     xf.xfontid 
       	       -> screen.putint(# format::<(#do 10->width#)#); newline
         if);
     if); (* xf.loaded *)
     
  exit (xf[], nam, sty, siz)
  #);


XLoadFontFromName:
  (# xf: ^THIS(guienv).private.xfont;
  enter xf[]
  do
     (if ((xdisplay, xf.name) -> XLoadQueryFont -> xf.fi)
      //0 then
         (* font does not exist *)
         false -> xf.loaded;
         -1 -> xf.fixedWidth
           -> xf.height
           -> xf.width
           -> xf.baseLine
           -> xf.firstCharInFont
           -> xf.lastCharInFont;
      else
         xf.fi.id
           -> xf.XFontId;
         
         (xf.fi.maxBounds.width =
         xf.fi.minBounds.width)
           -> xf.fixedWidth;
         xf.fi.maxBounds.width
           -> xf.width;
         xf.fi.maxBounds.ascent 
         + xf.fi.maxBounds.descent
           -> xf.height;
         xf.fi.ascent
           -> xf.baseLine;
         xf.fi.minCharOrByte2
           -> xf.firstCharInFont;
         xf.fi.maxCharOrByte2
           -> xf.lastCharInFont;
         
         true -> xf.loaded;
         xf.fi.maxbounds.descent -> xf.maxdescent;
     if);
  #);


InitXFontNames:
  (# revision: @Integer;
     t: @text;
  do
     xdisplay -> XVendorRelease -> revision;
     (*(if revision >= 1000 // true then revision div 1000 -> revision if);*)
     (if revision
      // 0 // 1 // 2 then (* X11, X11.1, X11.2 *)
         &InitX11r0;
      else (* X11.{3,4,...}: Using adobe fonts *)
         &InitX11r3
     if);
  #);


InitX11r0:
  (#
  do     (* Courier *)
     
     (# do (* made a local descriptor due to compiler error! *)
        
        ('6x10', Courier , Plain, 10) -> &InitName;
        (* Courier 12 occationally used as defaultvalues *)
        ('8x13', Courier , Plain, 12) -> &InitName;
        ('8x13bold', Courier , Bold, 12) -> &InitName;
        ('8x13', Courier , Italic, 12) -> &InitName;
        ('8x13', Courier , Plain, 13) -> &InitName;
        ('8x13bold', Courier , Bold, 13) -> &InitName;
        ('9x15', Courier , Plain, 15) -> &InitName;
        ('iso1.16', Courier , Plain, 16) -> &InitName;
        ('iso1.16b', Courier , Bold, 16) -> &InitName;
        ('fg-18', Courier , Plain, 18) -> &InitName;
        ('fg-18', Courier , Bold, 18) -> &InitName;
        ('iso1.20', Courier , Plain, 20) -> &InitName;
        ('iso1.20b', Courier , Bold, 20) -> &InitName;
        ('fr-25', Courier , Bold, 25) -> &InitName;
        ('fqxb-25', Courier , Bold, 25) -> &InitName;
        ('pica.18x30', Courier , Bold, 30) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        
        (* Default values *)
        ('8x13', Courier , Plain, 1) -> &InitName;
        ('8x13bold', Courier , Bold, 1) -> &InitName;
        ('8x13', Courier , Italic, 1) -> &InitName;
        
        (* Times *)
        
        ('serif10', Times , Plain, 10) -> &InitName;
        ('serif12', Times , Plain, 12) -> &InitName;
        ('serifi10', Times , Italic, 10) -> &InitName;
        ('serifi12', Times , Italic, 12) -> &InitName;
        ('serifb10', Times , Bold, 10) -> &InitName;
        ('serifb12', Times , Bold, 12) -> &InitName;
        ('kana.8x16', Times , Plain, 16) -> &InitName;
        ('kana.10x18', Times , Plain, 18) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        (*  ('vr-20', Times , Plain, 20) -> &InitName; *)
        ('roman', Times , Plain, 20) -> &InitName;
        ('bold-roman', Times , Bold, 20) -> &InitName;
        ('italic', Times , Italic, 20) -> &InitName;
        ('kana.12x24', Times , Plain, 24) -> &InitName;
        ('vr-25', Times , Plain, 25) -> &InitName;
        ('vrb-25', Times , Bold, 25) -> &InitName;
        ('vri-25', Times , Italic, 25) -> &InitName;
        ('vr-27', Times , Plain, 27) -> &InitName;
        ('vr-27', Times , Bold, 27) -> &InitName;
        ('vr-30', Times , Plain, 30) -> &InitName;
        ('vrb-30', Times , Bold, 30) -> &InitName;
        ('vri-30', Times , Bold, 30) -> &InitName;
        ('vr-31', Times , Plain, 31) -> &InitName;
        ('vrb-31', Times , Bold, 31) -> &InitName;
        ('vri-31', Times , Italic, 31) -> &InitName;
        ('vr-40', Times , Plain, 40) -> &InitName;
        ('vr-40', Times , Bold, 40) -> &InitName;
        ('vri-40', Times , Italic, 40) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        
        (* Default values *)
        ('serif12', Times , Plain, 1) -> &InitName;
        ('serifb12', Times , Plain, 1) -> &InitName;
        ('serifi12', Times , Plain, 1) -> &InitName;
        
        (* Helvetica *)
        
        ('sans12', Helvetica , Plain, 12) -> &InitName;
        ('sansi12', Helvetica , Italic, 12) -> &InitName;
        ('sansb12', Helvetica , Bold, 12) -> &InitName;
        ('vg-13', Helvetica , Plain, 13) -> &InitName;
        ('vg-13', Helvetica , Bold, 13) -> &InitName;
        ('variable', Helvetica , Plain, 14) -> &InitName;
        ('variable', Helvetica , Bold, 14) -> &InitName;
        ('vg-20', Helvetica , Plain, 20) -> &InitName;
        ('vg-20', Helvetica , Bold, 20) -> &InitName;
        ('vgi-20', Helvetica , Italic, 20) -> &InitName;
        ('vg-25', Helvetica , Plain, 25) -> &InitName;
        ('vgb-25', Helvetica , Bold, 25) -> &InitName;
        ('vg-31', Helvetica , Plain, 31) -> &InitName;
        ('vgvb-31', Helvetica , Bold, 31) -> &InitName;
        ('vgi-31', Helvetica , Italic, 31) -> &InitName;
        ('vg-40', Helvetica , Plain, 40) -> &InitName;
        ('vg-40', Helvetica , Bold, 40) -> &InitName;
        
        (* Default values *)
        ('sans12', Helvetica , Plain, 1) -> &InitName;
        ('sansi12', Helvetica , Bold, 1) -> &InitName;
        ('sansb12', Helvetica , Italic, 1) -> &InitName;
     #);
  #);

InitX11r3:
  (#
  do     (* Courier *)
     
     (# do (* made a local descriptor due to compiler error! *)
        
        ('-adobe-courier-medium-r-normal--8-*',
        Courier, Plain,  8) -> &InitName;
        ('-adobe-courier-bold-r-normal--8-*',
        Courier, Bold,   8) -> &InitName;
        ('-adobe-courier-medium-o-normal--8-*',
        Courier, Italic, 8) -> &InitName;
        ('-adobe-courier-medium-r-normal--10-*',
        Courier, Plain,  10) -> &InitName;
        ('-adobe-courier-bold-r-normal--10-*',
        Courier, Bold,   10) -> &InitName;
        ('-adobe-courier-medium-o-normal--10-*',
        Courier, Italic, 10) -> &InitName;
        ('-adobe-courier-medium-r-normal--11-*',
        Courier, Plain,  11) -> &InitName;
        ('-adobe-courier-bold-r-normal--11-*',
        Courier, Bold,   11) -> &InitName;
        ('-adobe-courier-medium-o-normal--11-*',
        Courier, Italic, 11) -> &InitName;
        ('-adobe-courier-medium-r-normal--12-*',
        Courier, Plain,  12) -> &InitName;
        ('-adobe-courier-bold-r-normal--12-*',
        Courier, Bold,   12) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-courier-medium-o-normal--12-*',
        Courier, Italic, 12) -> &InitName;
        ('-adobe-courier-medium-r-normal--14-*',
        Courier, Plain,  14) -> &InitName;
        ('-adobe-courier-bold-r-normal--14-*',
        Courier, Bold,   14) -> &InitName;
        ('-adobe-courier-medium-o-normal--14-*',
        Courier, Italic, 14) -> &InitName;
        ('-adobe-courier-medium-r-normal--17-*',
        Courier, Plain,  17) -> &InitName;
        ('-adobe-courier-bold-r-normal--17-*',
        Courier, Bold,   17) -> &InitName;
        ('-adobe-courier-medium-o-normal--17-*',
        Courier, Italic, 17) -> &InitName;
        ('-adobe-courier-medium-r-normal--18-*',
        Courier, Plain,  18) -> &InitName;
        ('-adobe-courier-bold-r-normal--18-*',
        Courier, Bold,   18) -> &InitName;
        ('-adobe-courier-medium-o-normal--18-*',
        Courier, Italic, 18) -> &InitName;
        ('-adobe-courier-medium-r-normal--20-*',
        Courier, Plain,  20) -> &InitName;
        ('-adobe-courier-bold-r-normal--20-*',
        Courier, Bold,   20) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-courier-medium-o-normal--20-*',
        Courier, Italic, 20) -> &InitName;
        ('-adobe-courier-medium-r-normal--24-*',
        Courier, Plain,  24) -> &InitName;
        ('-adobe-courier-bold-r-normal--24-*',
        Courier, Bold,   24) -> &InitName;
        ('-adobe-courier-medium-o-normal--24-*',
        Courier, Italic, 24) -> &InitName;
        ('-adobe-courier-medium-r-normal--25-*',
        Courier, Plain,  25) -> &InitName;
        ('-adobe-courier-bold-r-normal--25-*',
        Courier, Bold,   25) -> &InitName;
        ('-adobe-courier-medium-o-normal--25-*',
        Courier, Italic, 25) -> &InitName;
        ('-adobe-courier-medium-r-normal--34-*',
        Courier, Plain,  34) -> &InitName;
        ('-adobe-courier-bold-r-normal--34-*',
        Courier, Bold,   34) -> &InitName;
        ('-adobe-courier-medium-o-normal--34-*',
        Courier, Italic, 34) -> &InitName;
        
        (* Courier default values *)
        ('-adobe-courier-medium-r-normal--12-*',
        Courier, Plain,  1) -> &InitName;
        ('-adobe-courier-bold-r-normal--12-*',
        Courier, Bold,   1) -> &InitName;
        ('-adobe-courier-medium-o-normal--12-*',
        Courier, Italic, 1) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        
        (* Helvetica *)
        
        ('-adobe-helvetica-medium-r-normal--8-*',
        Helvetica, Plain,  8) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--8-*',
        Helvetica, Bold,   8) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--8-*',
        Helvetica, Italic, 8) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--10-*',
        Helvetica, Plain,  10) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--10-*',
        Helvetica, Bold,   10) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--10-*',
        Helvetica, Italic, 10) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--11-*',
        Helvetica, Plain,  11) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--11-*',
        Helvetica, Bold,   11) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--11-*',
        Helvetica, Italic, 11) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-helvetica-medium-r-normal--12-*',
        Helvetica, Plain,  12) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--12-*',
        Helvetica, Bold,   12) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--12-*',
        Helvetica, Italic, 12) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--14-*',
        Helvetica, Plain,  14) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--14-*',
        Helvetica, Bold,   14) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--14-*',
        Helvetica, Italic, 14) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--17-*',
        Helvetica, Plain,  17) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--17-*',
        Helvetica, Bold,   17) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--17-*',
        Helvetica, Italic, 17) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--18-*',
        Helvetica, Plain,  18) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-helvetica-bold-r-normal--18-*',
        Helvetica, Bold,   18) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--18-*',
        Helvetica, Italic, 18) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--20-*',
        Helvetica, Plain,  20) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--20-*',
        Helvetica, Bold,   20) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--20-*',
        Helvetica, Italic, 20) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--24-*',
        Helvetica, Plain,  24) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--24-*',
        Helvetica, Bold,   24) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--24-*',
        Helvetica, Italic, 24) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--25-*',
        Helvetica, Plain,  25) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-helvetica-bold-r-normal--25-*',
        Helvetica, Bold,   25) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--25-*',
        Helvetica, Italic, 25) -> &InitName;
        ('-adobe-helvetica-medium-r-normal--34-*',
        Helvetica, Plain,  34) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--34-*',
        Helvetica, Bold,   34) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--34-*',
        Helvetica, Italic, 34) -> &InitName;
        
        (* Helvetica default values *)
        ('-adobe-helvetica-medium-r-normal--12-*',
        Helvetica, Plain,  1) -> &InitName;
        ('-adobe-helvetica-bold-r-normal--12-*',
        Helvetica, Bold,   1) -> &InitName;
        ('-adobe-helvetica-medium-o-normal--12-*',
        Helvetica, Italic, 1) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        
        (* Times *)
        
        ('-adobe-times-medium-r-normal--8-*',
        Times, Plain,  8) -> &InitName;
        ('-adobe-times-bold-r-normal--8-*',
        Times, Bold,   8) -> &InitName;
        ('-adobe-times-medium-i-normal--8-*',
        Times, Italic, 8) -> &InitName;
        ('-adobe-times-medium-r-normal--10-*',
        Times, Plain,  10) -> &InitName;
        ('-adobe-times-bold-r-normal--10-*',
        Times, Bold,   10) -> &InitName;
        ('-adobe-times-medium-i-normal--10-*',
        Times, Italic, 10) -> &InitName;
        ('-adobe-times-medium-r-normal--11-*',
        Times, Plain,  11) -> &InitName;
        ('-adobe-times-bold-r-normal--11-*',
        Times, Bold,   11) -> &InitName;
        ('-adobe-times-medium-i-normal--11-*',
        Times, Italic, 11) -> &InitName;
        ('-adobe-times-medium-r-normal--12-*',
        Times, Plain,  12) -> &InitName;
        ('-adobe-times-bold-r-normal--12-*',
        Times, Bold,   12) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-times-medium-i-normal--12-*',
        Times, Italic, 12) -> &InitName;
        ('-adobe-times-medium-r-normal--14-*',
        Times, Plain,  14) -> &InitName;
        ('-adobe-times-bold-r-normal--14-*',
        Times, Bold,   14) -> &InitName;
        ('-adobe-times-medium-i-normal--14-*',
        Times, Italic, 14) -> &InitName;
        ('-adobe-times-medium-r-normal--17-*',
        Times, Plain,  17) -> &InitName;
        ('-adobe-times-bold-r-normal--17-*',
        Times, Bold,   17) -> &InitName;
        ('-adobe-times-medium-i-normal--17-*',
        Times, Italic, 17) -> &InitName;
        ('-adobe-times-medium-r-normal--18-*',
        Times, Plain,  18) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        ('-adobe-times-bold-r-normal--18-*',
        Times, Bold,   18) -> &InitName;
        ('-adobe-times-medium-i-normal--18-*',
        Times, Italic, 18) -> &InitName;
        ('-adobe-times-medium-r-normal--20-*',
        Times, Plain,  20) -> &InitName;
        ('-adobe-times-bold-r-normal--20-*',
        Times, Bold,   20) -> &InitName;
        ('-adobe-times-medium-i-normal--20-*',
        Times, Italic, 20) -> &InitName;
        ('-adobe-times-medium-r-normal--24-*',
        Times, Plain,  24) -> &InitName;
        ('-adobe-times-bold-r-normal--24-*',
        Times, Bold,   24) -> &InitName;
        ('-adobe-times-medium-i-normal--24-*',
        Times, Italic, 24) -> &InitName;
        ('-adobe-times-medium-r-normal--25-*',
        Times, Plain,  25) -> &InitName;
        ('-adobe-times-bold-r-normal--25-*',
        Times, Bold,   25) -> &InitName;
        ('-adobe-times-medium-i-normal--25-*',
        Times, Italic, 25) -> &InitName;
        ('-adobe-times-medium-r-normal--34-*',
        Times, Plain,  34) -> &InitName;
        ('-adobe-times-bold-r-normal--34-*',
        Times, Bold,   34) -> &InitName;
        ('-adobe-times-medium-i-normal--34-*',
        Times, Italic, 34) -> &InitName;
     #);
     (# do (* made a local descriptor due to compiler error! *)
        
        (* Times default values *)
        ('-adobe-times-medium-r-normal--12-*',
        Times, Plain,  1) -> &InitName;
        ('-adobe-times-bold-r-normal--12-*',
        Times, Bold,   1) -> &InitName;
        ('-adobe-times-medium-i-normal--12-*',
        Times, Italic, 1) -> &InitName;
     #);
  #); 


InitName:
  (# xname: @Text;
     nam: @FontName;
     sty: @Style;
     siz: @Integer;
  enter (xname, nam, sty, siz)
  do
     xname -> THIS(guienv).private.fonts.xfonts[nam].style[sty].size[siz].name;
  #);
