ORIGIN '../Impl/DatatypesImpl';
-- LIB: attributes --

(* Descriptor for dynamic reference to X points *)

XPointDesc: (# p: [1] @ Integer; #);


-- PointArrayAttributes: Attributes --

ToXPoints:
  (# xpoints: @Xpointdesc;
     p: @Point;
     TM: ^Matrix
  enter TM[]
  do npoints -> xpoints.p.extend;
     (for i:npoints repeat
          (* transform point using TM *)
          private.points[i] -> TM.transformPoint -> p;
          (* Encode x,y as two shorts in one integer *)
          (p.x, 0) -> xpoints.p[i].%putshort;
          (p.y, 1) -> xpoints.p[i].%putshort;
     for);
  exit xpoints[]
  #);
