ORIGIN 'basicsystemenvbody';
OBJFILE default '$/uniq.o' '$/timetick.o';
-- lib: Attributes --
time: external (# time: @Integer;  exit time #);   

-- systemLib: Attributes --
(************** Redefinition of Keyboard *********************************
 * A get operation on the keyboard will make a PAUSE if no input available
 * This has not been completely implemented yet and will not always work.
 *)
getImRead: external (# device,no: @integer enter device do callC exit no #);
sleep: external (# seconds: @integer enter seconds do callC #);
cKeyboard: stream
  (# Eos::<
       (# KeyboardEOS: External (# yes: @boolean do CallC exit yes #); 
       do KeyboardEOS->value
       #);
     otherError::< (# do 'cKeyboard '->msg.puttext #);
     get::<
       (# do
          loop:
          (if (0->getImRead) > 0
           // true then private.mdpriv.oldKb.get->ch
           else
              PAUSE; restart loop
          if)
       #);
     getLine::<
       (# do
          loop:
          (if (0->getImRead) > 0
           // true then private.mdpriv.oldKb.getLine->Txt[]
           else
              PAUSE; restart loop
          if)
       #);
     getAtom::<
       (# do
          loop:
          (if (0->getImRead) > 0
           // true then private.mdpriv.oldKb.getAtom->Txt[]
           else
              PAUSE; restart loop
          if)
       #);
     
  #);
  

-- installKeyboard: Descriptor --
(# do keyboard[]->private.mdpriv.oldKb[]; &cKeyboard[]->keyboard[];  #)  

-- BasicSystemEnvMDPriv: Descriptor --
(# oldKB: ^stream;  #)  

-- secoundCounterBody: DoPart --
do time (*div 60*) ->now;   

