ORIGIN '../repstream';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1984-96
 *       All rights reserved.
 *
 *)

--- RepStreamgetTextBody:descriptor ---
(# l: @Integer;
do
   &text[] -> t[];
   getInt -> l;
   (# x: [l]@char
   do (for i: l repeat (r,top*4+i-1) -> TOS'%inxGetByte' -> x[i] for);
      top+(l-1) div 4+1 -> top;
      x -> t
   #);
#)

(* 
 * (# l, longCount, val: @integer;
 * do
 *    &text[] -> t[];
 *    getInt -> l;
 *    (if l<>0 then
 *        (# x: [l]@char
 *        do (l-1) div 4 + 1 -> longCount;
 *           (for i: longCount repeat 
 *                (@@R[1] + (top+i-1)*4) -> TOS'%adrGetLong' -> val;
 *                (@@x[1] + (i-1)*4, val) -> TOS'%PutLong';
 *           for);
 *           top + longCount -> top;
 *           x[1:l] -> t;
 *           'repetitionStream.getText: "' -> screen.putText;
 *           t[] -> screen.putText;
 *           '"' -> screen.putLine;
 *        #);
 *     else
 *        'repetitionStream.getText: length is 0' -> screen.putLine;
 *    if)
 * #)
 *)

--- RepStreamputTextBody: descriptor ---
(# l: @Integer;
do
   (if t[]=NONE then 0 -> l else t.length -> l if);
   l -> putInt;
   (if (top+(l-1) div 4+1 >=r.range)
       then 1000+top+(l-1) div 4+1 -> extend
   if);
   (for i: l repeat (r,top*4+i-1,t.t[i]) -> TOS'%inxPutByte' for);
   top+(l-1) div 4+1 -> top;
#)

(* 
 * (# l, longCount, val: @Integer;
 * do
 *    (if t[]=NONE then 0 -> l else t.length -> l if);
 *    l -> putInt;
 *    (l-1) div 4 + 1 -> longCount;
 *    (if top + longCount >= r.range then
 *        1000 + longCount -> extend;
 *    if);
 *    (for i: longCount repeat 
 *         @@t.t[1] + (i-1)*4 -> tos'%adrGetLong' -> val;
 *         (@@R[1] + (top+i-1)*4, val) -> TOS'%PutLong' 
 *    for);
 *    top + longCount -> top;
 * #)
 *)
