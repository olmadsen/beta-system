ORIGIN  'directorybody';
LIB_ITEM 'directory';
INCLUDE 'file_jvmbody';
(*
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-2003
 *       All rights reserved.
 *
 * This fragment group is the JVM dependent implementation of directories.
 *)

-- DirectoryLib: attributes--

DirFullPath:
  (# p: ^text;
     dir: ^text;
     cwd: ^text;
     entry: ^text;
  enter (p[], dir[], cwd[], entry[])
  do (if p.length=0 then
       	 (if entry.t[1] = '/' then
             entry -> p;
	  else
       	     (if true
    	      // dir.t[1]='/' then
	       	 (* dir is a full path *)
	       	 dir -> p;
    	      // '.' -> dir.equal then
	       	 (* dir is CWD *)
       	       	 cwd -> p;
    	      else
       	       	 (* dir has path relative to CWD *)
       	       	 cwd -> p;
	       	 (if p.T[p.length]<>'/' then '/' -> p.append if);
	       	 dir[] -> p.append;
       	     if);
       	     (if p.T[p.length]<>'/' then '/' -> p.append if);
       	     entry[] -> p.append;
       	 if);
     if);
#)


-- DirPrivate: descriptor --
(# 
   jentry: ^JavaFile;
#)

-- DirException: descriptor --
(# 
do msg.newline;
   'Directory exception for \'' -> msg.putText; 
   name->msg.putText; '\''->msg.put;
   msg.newline;
   (* FIXME: 'Error in system call: ' -> msg.puttext;
    * getErrno -> errorstring -> msg.putline;
    *)
#)


-- DirTouch: descriptor--
(# 
do 'directory:Touch' -> NYI
#)


-- DirNoOfEntries: dopart --
do 'directory:NoOfEntries' -> NYI

-- DirEmpty: dopart --
do 'directory:Empty' -> NYI

-- DirDelete: descriptor --
(# 
do 'directory:Delete' -> NYI
#)

-- DirCreateFile: dopart -- 
do (if name[]=NONE then &text[]->name[] else name.copy->name[]  if);
   '/' -> name.prepend;
   entry.path -> name.prepend;
   name[] -> JavaFile._init_String -> private.jentry[];
   (if private.jentry.createNewFile then
       &EntryDesc[] -> newEntry[];
       name[] -> newEntry.path;
    else
       name[] -> exists; 
   if);
   NONE -> private.jentry[];

-- DirDeleteFile: dopart --
do (if name[]=NONE then &text[]->name[] else name.copy->name[]  if);
   '/' -> name.prepend;
   entry.path -> name.prepend;
   name[] -> JavaFile._init_String -> private.jentry[];
   (if private.jentry.delete then
    else
       name[] -> error; 
   if);
   NONE -> private.jentry[];

-- DirCreateDir: dopart --
do (if name[]=NONE then &text[]->name[] else name.copy->name[]  if);
   '/' -> name.prepend;
   entry.path -> name.prepend;
   name[] -> JavaFile._init_String -> private.jentry[];
   (if private.jentry.mkdirs then
       &EntryDesc[] -> newEntry[];
       name[] -> newEntry.path;
    else
       name[] -> error; 
   if);
   NONE -> private.jentry[];

-- DirDeleteDir: dopart --
do (if name[]=NONE then &text[]->name[] else name.copy->name[]  if);
   '/' -> name.prepend;
   entry.path -> name.prepend;
   name[] -> JavaFile._init_String -> private.jentry[];
   (if private.jentry.delete then
    else
       name[] -> error; 
   if);
   NONE -> private.jentry[];

-- DirFindSelect: descriptor --
(# 
do 'directory:FindSelect' -> NYI
#)

-- DirFindDispatch: descriptor --
(# 
do 'directory:FindDispatch' -> NYI
#)

-- DirFindFullPath: descriptor -- 
(# 
do 'directory:FindFullPath' -> NYI
#)

-- DirFindGetFile: descriptor --
(# 
do 'directory:FindGetFile' -> NYI
#)

-- DirFindGetDir: descriptor --
(# 
do 'directory:FindGetDir' -> NYI
#)

-- DirFindEntry: descriptor --
(# 
do 'directory:FindEntry' -> NYI
#)

-- DirScanFullPath: descriptor --
(# 
do 'directory:ScanFullPath' -> NYI
#)

-- DirScanSelect: descriptor --
(# 
do 'directory:ScanSelect' -> NYI
#)

-- DirScanDispatch: descriptor --
(# 
do 'directory:ScanDispatch' -> NYI 
#)

-- DirScanGetFile: descriptor -- 
(# 
do 'directory:ScanGetFile' -> NYI
#)

-- DirScanGetDir: descriptor --
(# 
do 'directory:ScanGetDir' -> NYI
#)

-- DirScanEntries: descriptor -- 
(# 
do 'directory:ScanEntries' -> NYI
#)
