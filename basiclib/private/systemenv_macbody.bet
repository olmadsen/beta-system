ORIGIN 'basicsystemenv_mac';
INCLUDE 'console_macbody';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1984-96
 *       All rights reserved.
 *
 *)
 
-- installKeyboard: Descriptor --
(# k: ^keyboardStream;
do (if keyboard## <= keyboardStream## then
		keyboard[] -> k[];
		k.c[] -> private.mdpriv.pioPrivate.sysKeyboard.c[];
		private.mdpriv.pioPrivate.sysKeyboard[] -> keyboard[];
	if);
#)  

--- BasicScheduler:descriptor ---
(# 
do 
   initBeforeScheduler;
   run: cycle 
     (# result: @integer;
     do private.attNext -> result;
		
        (if result=2 then
            leave run;
         else
			(if private.mdpriv.keyboardBlocked then
		       2 -> private.mdpriv.pioPrivate.sysKeyboard.check;
			if);
            (if private.mdpriv.check then leave run if);
        if);
     #);
#)

--- pioEnsure:descriptor ---
(# #)

--- pioPrivate:descriptor ---
(# sysKeyboard: @keyboardStream
		(# ready: @semaphore;
			block::
				(#
				do true  -> keyboardBlocked;
					ready.P;
				#);
			continue::
				(#
				do false -> keyboardBlocked;
					ready.V;
				#);
			
		#);
#)

--- forksecond:descriptor ---
(# #)

