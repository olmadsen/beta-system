ORIGIN  'filebody';
INCLUDE '~beta/javalib/io/File';
INCLUDE '~beta/javalib/util/Date';
(*
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1986-96
 *       All rights reserved.
 *
 * This fragment group is the JVM dependent implementation of files.
 *)

--LIB:attributes--

--DiskEntryException: dopart-- 
do 'Disk entry exception for \''->msg.puttext;
   path -> msg.puttext;
   '\''->msg.putline;
   'Error in system call: ' -> msg.puttext;
   (*getErrno -> errorstring -> msg.putline;*)
   INNER;

--DiskEntryPrivate: descriptor--
(# path: @text;
   jfile: ^JavaFile;
#)

--DiskEntryPathHead: dopart--
do INNER; 

--DiskEntryPathNamePref: dopart--
do INNER; 

--DiskEntryPathNameSuf: dopart--
do INNER; 

--DiskEntryPathNameExt: dopart--
do INNER;

--DiskEntryPathNameGet: dopart--
do INNER; 

--DiskEntryPathSet: dopart--
do INNER;
   (if p[]=NONE then ''->p[] if);
   p -> private.path;
   p[] -> &JavaFile[] -> private.jfile[];

--DiskEntryPathGet: dopart--
do INNER; private.path.copy -> p[]

--DiskEntryExists: dopart--
do private.jfile.exists -> value
   
--DiskEntryTouch: dopart--
do (if private.jfile.exists then
       (*(private.jfile[], DateNow->DateGetTimeSeconds) -> FileSetLastModifiedAsSeconds;*)
       'FIXME: DiskEntryTouch: FileSetLastModifiedAsSeconds crashes compiler' -> screen.putline;
    else
       private.jfile.createNewFile;
   if);
   
--DiskEntrySize: dopart--
do (if beta_jvm_has_int64 then
       private.jfile.length -> value
    else
       private.jfile[] -> FileLengthAsInt -> value;
   if);

--DiskEntrySetModTime:dopart--
do (if beta_jvm_has_int64 then
       time -> private.jfile.setLastModified
    else
       (*(private.jfile[],time) -> FileSetLastModifiedAsSeconds*)
       'FIXME: DiskEntrySetModTime: FileSetLastModifiedAsSeconds crashes compiler' -> screen.putline;
   if);
   
--DiskEntryGetModTime:dopart--
do (if beta_jvm_has_int64 then
       private.jfile.lastModified -> time
    else
       private.jfile[] -> FileLastModifiedAsSeconds -> time;
   if);

--DiskEntryRename: dopart--
do 

--DiskEntryReadable: dopart--
do private.jfile.canRead -> value

--DiskEntryWriteable: descriptor--
(# 
do private.jfile.canWrite -> value
#)

--DiskEntryIsDir: dopart--
do private.jfile.isDirectory -> value
   
--DiskEntryIsFile: dopart--
do private.jfile.isFile -> value

--FilePrivate:descriptor--
(# 
#)

--FileOtherException: dopart--
do 'Error in system call: ' -> msg.puttext;
   (*getErrno -> errorstring -> msg.putline;*)
   INNER

--FileTouch: dopart--
do 

--FileLength: dopart--
do 

--FileDoOpen:descriptor--
(# 
#)

--FileOpenRead:dopart--
do 
   
--FileOpenWrite:dopart--
do 
   
--FileOpenReadWrite:dopart--
do 
   
--FileOpenAppend:dopart--
do 
   
--FileOpenReadAppend:dopart--
do 
   
--FileDelete:dopart--
do 

--FilePut:dopart--
do 

--FileGet:dopart--
do 

--FilePeek:dopart--
do 
   
--FilePutText:dopart--
do 

--FileGetAtom:dopart--
do 

--FileGetLine:dopart--
do 
   
--FileGetPos:dopart--
do 
   
--FileSetPos:dopart--
do 
   
--FileEos:dopart--
do 

--FileGetRep:dopart--
do 

--FilePutRep:dopart--
do 

--FileFlush:dopart--
do 

--FileClose:dopart--
do 

