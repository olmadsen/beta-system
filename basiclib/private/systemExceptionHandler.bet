ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/sysutils/sysexcept';
INCLUDE '~beta/basiclib/systemExceptions';

-- lib: attributes --

(* Basic System Exception Handler Type *)
RuntimeErrorHandler: external
  (# error: @integer (* Error number - see below *);
     SP: @integer (* Stack pointer at error *);
     PC: @integer (* Program conter at error *);
     currentObject: @integer (* Current object at error *);
     skip_dump: @boolean (* Set to true to ignore dumping stack and exiting *);
  enter (error, currentObject[], PC, SP)
  do cExternalEntry;
     INNER;
  exit skip_dump
  #);

(* Call InstallSystemExceptionHandler once to get a RuntimeErrorHandler
 * called for System Exceptions.
 *)

InstallSystemExceptionHandler: External
  (# handler: ##RuntimeExceptionHandler;
  enter handler##
  #);

runtimeExceptionHandler: RuntimeErrorHandler
  (#
  do
     (if error
      // RefNoneErr then &refNoneException[]->throw;
      // RepRangeErr then &repRangeException[]->throw;
      // RepSubRangeErr then &repSubRangeException[]->throw;
      // RepLowRangeErr then &repLowRangeException[]->throw;
      // RepHighRangeErr then &repHighRangeException[]->throw;
      // QuaErr then &quaException[]->throw;
      // QuaOrigErr then &quaOrigException[]->throw;  
      // ArithExceptErr then &arithExceptException[]->throw;
      // ZeroDivErr then &zeroDivException[]->throw;
      // FpZeroDivErr then &fpZeroDivException[]->throw;
      // FpExceptErr then &fpExceptException[]->throw;
      // UnorderedFVal then &unorderedFValException[]->throw;
      // LVRAfullErr then &LVRAFullException[]->throw;
      // CBFAfullErr then &CBFAFullException[]->throw;
      // IOAFullErr then &IOAFullException[]->throw;
      // AOAtoIOAfullErr then &AOAtoIOAFullException[]->throw;
      // AOAtoLVRAfullErr then &AOAtoLVRAFullException[]->throw;
      // AOAtoIOAAllocErr then &AOAtoIOAAllocException[]->throw;
      // FpStackUflowErr then &fpStackUflowException[]->throw;
      // FpStackOflowErr then &fpStackOflowException[]->throw;
      // StackErr then &stackOflowException[]->throw;
      (*// DumpStackErr then &dumpStackException[]->throw;*)
      // CompCallBackErr then &compCallbackException[]->throw;
      // LeaveBasicCompErr then &leaveBasicCompException[]->throw;
      // RecursiveAttErr then &recursiveAttException[]->throw;
      // SignalErr then &signalExceptException[]->throw;
      // UnknownSigErr then &unknownSigException[]->throw;
      // IllegalInstErr then &illegalInstException[]->throw;
      // BusErr then &busException[]->throw;
      // SegmentationErr then &segmentationException[]->throw;
      (*// StopCalledErr then &stopCalledException[]->throw;*)
      // InterruptErr then &interruptException[]->throw;
      // PascalCallBackErr then &pascalCallbackException[]->throw;
      // EmulatorTrapErr then &emulatorTrapException[]->throw;
      // CTextPoolErr then &CTextPoolException[]->throw;
      // InternalErr then &internalException[]->throw;
      // CompTerminatedErr then &compTerminatedException[]->throw;
     if);
  #);
