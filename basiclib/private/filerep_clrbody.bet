ORIGIN 'filerepbody';
INCLUDE 'binfile_clrbody';


---- lib: attributes ---
bytewise: 
  (# exit false (* if true: both methods do big-endian byteordering!!!*) #);

---- FileRepSave: descriptor ----
(# f: @binfile;
   x, y: @int32; (* Only needed for bytewise *)
do (if filename[]=NONE then
       (*&text[]->filename[] - WHAT??? This will just make the following break mysteriously! *) 
       'FileRepSave: filename=NONE!!!'->putline;
   if);
   filename[] -> f.name;
   (*'filerepsave: '->screen.puttext; filename[]->screen.putline;*)
   f.OpenWrite; 
   (for i:Top repeat
        (if bytewise then
            R[i]->x; 
            (*x -> screen.putint; screen.newline;*)
            (f.private.bw[], (x %srl 24) %Band 0xff -> y) -> BetaHelpers.WriteInt8u;
            (f.private.bw[], (x %srl 16) %Band 0xff -> y) -> BetaHelpers.WriteInt8u;
            (f.private.bw[], (x %srl  8) %Band 0xff -> y) -> BetaHelpers.WriteInt8u;
            (f.private.bw[], (x %srl  0) %Band 0xff -> y) -> BetaHelpers.WriteInt8u;
         else
            R[i] -> f.private.bw.Write_int32;
        if);
   for);
   f.close
#)

---- FileRepRestore: descriptor ----
(# f: @binfile;
   x, y: @int32; (* Only needed for bytewise *)
do (if filename[]=NONE then 
       (*&text[]->filename[] - WHAT??? This will just make the following break mysteriously! *) 
       'FileRepRestore: filename=NONE!!!'->putline;
   if);
   filename[] -> f.name;
   f.OpenRead; 
   (F.length+3) div 4 -> R.new;
   (for i:R.range repeat
        (if bytewise then
            0 -> x;
            (((f.private.br[]->BetaHelpers.ReadInt8u->y) %band 0xff) %sll 24) %Bor x -> x;
            (((f.private.br[]->BetaHelpers.ReadInt8u->y) %band 0xff) %sll 16) %Bor x -> x;
            (((f.private.br[]->BetaHelpers.ReadInt8u->y) %band 0xff) %sll  8) %Bor x -> x;
            (((f.private.br[]->BetaHelpers.ReadInt8u->y) %band 0xff) %sll  0) %Bor x -> x;
            x->R[i];
         else
            f.private.br.ReadInt32->R[i];
        if)
   for);
   F.close;
   R.range ->Top;
#)
