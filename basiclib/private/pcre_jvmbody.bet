ORIGIN 'pcrebody';
INCLUDE 'betaenv_jvmbody';
INCLUDE 'PcreJvmHelper';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 2000-2003
 *       All rights reserved.
 *)

--LIB: attributes--
trace: (# exit false #);

---- PcreInit: dopart ----
do (# results: [3]@integer;
   do (exp[],options) 
        -> PcreJvmHelper.initialize
        -> results[];
      (results[1], results[2], results[3])
        -> (private.compiled_regexp, private.extra, subpatterns);
   #);
   (if trace then 
       'PcreInit: compiled_regexp: ' -> screen.puttext;
       private.compiled_regexp->screen.putint;
       ', extra: ' -> screen.puttext;
       private.extra->screen.putint;
       ', subpatterns: ' -> screen.puttext;
       subpatterns ->screen.putint;
       screen.newline;
   if);
   (if private.compiled_regexp=0 then
       'PcreInit: error handling' -> NYI;
    else
       ((subpatterns + 1) * 3) -> private.oVector.new;
   if);
      
---- PcreMatch: dopart ----
do options -> opt;
   0 -> subMatchCounter;
   pre;
   private.oVector.range -> private.oVector.new;
   (if subject.T.range = 0 then 1 -> subject.T.extend; 0 -> subject.T[1] if);
   position - 1 -> psn;
   
   (private.compiled_regexp, 
   private.extra, 
   subject[], 
   subject.lgth,
   psn, 
   opt %Band pcre_NONBETAOPTIONS, 
   private.oVector[], 
   private.oVector.range) -> PcreJvmHelper.exec -> result;
   
   (result <> pcre_ERROR_NOMATCH) -> matched;
   (if matched then
       INNER;
    else
       noMatch;
   if);

---- PcreMatchAll: dopart ----
do 'pcre_jvmbody: PcreMatchAll' -> NYI;
