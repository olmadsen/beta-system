ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/basiclib/private/systemExceptionHandler';
INCLUDE 'tstexceptlib';

-- program: descriptor --
(# 
   a: @|(# pp: @p
             (# x:^object 
             do suspend; 
                x (* RefNoneErr: Reference is none *) 
             #);
        do pp
        #);
   b: @|(# qq: @q(# do a; a #);
        do qq
        #);
do runtimeExceptionHandler##->InstallSystemExceptionHandler;
   try
   (#
      name:: (# do 'refNoneTry'->n[] #);
      handler::
        (#
        do 
           when (# type:: refNoneException
                do 'refNoneTry handler... aborting'->putline;
                   abort;
                #);
        #);
   do b
   #);
#)

(* stack layout at dump time:
 * 
 *   |    main            |
 *   |____________________|
 *   |                    |
 *   |    M1BETAENV       |
 *   |____________________|
 *   |                    |
 *   |    M1PROGRAM       |
 *   |____________________|
 *   |                    |
 *   |    Att             |
 *   |____________________|
 *   |                    |
 *   |    M4PROGRAM       |
 *   |____________________|
 *   |                    |
 *   |    M2TSTDUMPLIB    |
 *   |____________________|
 *   |                    |
 *   |    M5PROGRAM       |
 *   |____________________|
 *   |                    |
 *   |    Att             |
 *   |____________________|
 *   |                    |
 *   |    M2PROGRAM       |
 *   |____________________|
 *   |                    |
 *   |    M1TSTDUMPLIB    |
 *   |____________________|
 *   |                    |
 *   |    M3PROGRAM       |
 *   |____________________|
 * 
 *)
