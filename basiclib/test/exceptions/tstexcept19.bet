ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/basiclib/private/systemExceptionHandler';

-- program: descriptor --
(# x: ^object
do runtimeExceptionHandler##->InstallSystemExceptionHandler;
   try
   (#
      name:: (# do 'refNoneTry'->n[] #);
      handler::
        (# 
        do when (# type:: refNoneException
                do 'refNoneTry handler...aborting'->putline;
                   abort;
                #);
        #);
   do x (* RefNoneErr *) 
   #);   
#)

(* Stack at refnone (sparc):
 * 
 *    M2PROGRAM ()
 *    M1EXCEPTTRY ()
 *    M228BETAENV ()
 *    M1PROGRAM ()
 *    CAtt ()
 *    M1BETAENV ()
 *    CAttBC ()
 *    main ()
 * 
 * Stack at find_activation (sparc):
 * 
 *    find_activation ()
 *    M2EXCEPTTHROW ()
 *    M1EXCEPTTHROW ()
 *    M237BETAENV ()
 *    M3SYSTEMEXCEPTIONHANDLER ()
 *    runtimeExceptionHandler ()
 *    HandleCB ()
 *    DisplayBetaStack ()
 *    BetaSignalHandler ()
 *    proxyTrapHandler ()
 *    <signal handler called>
 *    M2PROGRAM ()
 *    M1EXCEPTTRY ()
 *    M228BETAENV ()
 *    M1PROGRAM ()
 *    CAtt ()
 *    M1BETAENV ()
 *    CAttBC ()
 *    main ()
 * 
 * In case the user had called throw directly from the try block:
 * 
 *    find_activation ()
 *    M2EXCEPTTHROW ()
 *    M1EXCEPTTHROW ()
 *    M237BETAENV ()
 *    M2PROGRAM ()
 *    M1EXCEPTTRY ()
 *    M228BETAENV ()
 *    M1PROGRAM ()
 *    CAtt ()
 *    M1BETAENV ()
 *    CAttBC ()
 *    main ()
 *)
