ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/basiclib/private/systemExceptionHandler';

-- program: descriptor --
(# 
   a: @|(# p: (# do inner #);
           pp: @p(# x: (##);
                    xx: x(##);
                    r: ^xx;
                 do suspend;
                    &x[]->r[];
                    (* QuaErr: Qualification error in reference assignment *)
                    'done' -> putline;
                 #);
        do pp
        #);
   b: @|(# q: (# do inner #);
           qq: @q(# do a; a #);
        do qq
        #);
do runtimeExceptionHandler##->InstallSystemExceptionHandler;
   try
   (#
      name:: (# do 'quaTry'->n[] #);
      handler::
        (# 
        do when (# type:: quaException
                do 'quaTry handler...aborting'->putline;
                   abort;
                #);
        #);
   do try (#
             name:: (# do 'inner'->n[] #);
             handler::
               (# 
               do when (# type:: quaException
                       do 'inner handler...propagating'->putline;
                          propagate;
                       #);
               #);
          do b #);     
   #);
#)
