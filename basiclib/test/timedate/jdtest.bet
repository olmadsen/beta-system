ORIGIN '../timedate';
INCLUDE '~beta/basiclib/v1.6/numberio';

--- program:descriptor ---
(# 
   t: @time;
   
   clear:
     (#
     do
        (0,0,0,0,0,0) -> t;
     #);
   
   dt:
     (#
        t: @time;
     enter t
     do
        (*
        t -> puttime;
        ' Frac day: ' -> puttext;
        t.getfracday -> putreal;
        newline;
        *)
     #);
do
   '>>> Gregorian calender -> JD conversion <<<' -> putline;
   '>>> All output should equal 0.0         <<<' -> putline;
   
   clear;
   -4713 -> t.year;
   11 -> t.month;
   24 -> t.day;
   12 -> t.hour;
   (* t -> dt; *)
   t.getjd - 0.0 -> putreal; newline;
   
   clear;
   -2001 -> t.year;
   12 -> t.month;
   15 -> t.day;
   t -> dt;
   t.getjd - 990557.5 -> putreal; newline;
   
   clear;
   -584 -> t.year;
   5 -> t.month;
   22 -> t.day;
   14 -> t.hour;
   24 -> t.minute;
   t -> dt;
   t.getjd - 1507900.1 -> putreal; newline;
   
   
   clear;
   200 -> t.year;
   3 -> t.month;
   1 -> t.day;
   t -> dt;
   t.getjd - 1794167.5 -> putreal; newline;
   
   clear;
   1984 -> t.year;
   2 -> t.month;
   29 -> t.day;
   4 -> t.hour;
   48 -> t.minute;
   t -> dt;
   t.getjd - 2445759.7 -> putreal; newline;
   
   clear;
   2000 -> t.year;
   1 -> t.month;
   1 -> t.day;
   12 -> t.hour;
   t -> dt;
   t.getjd - 2451545.0 -> putreal; newline;
   
   clear;
   3000 -> t.year;
   3 -> t.month;
   21 -> t.day;
   21 -> t.hour;
   36 -> t.minute;
   t -> dt;
   t.getjd - 2816867.4 -> putreal; newline;
   
   '>>> Julian Day to Gregorian Calender conversion <<<' -> putline;
   
   0.0 -> t.setjd; t -> putTime; newline;
   990557.5 -> t.setjd;  t -> putTime; newline;
   1507900.1 -> t.setjd; t -> putTime; newline;
   1794167.5 -> t.setjd; t -> putTime; newline;
   2445759.7 -> t.setjd; t -> putTime; newline;
   2451545.0 -> t.setjd; t -> putTime; newline;
   2816867.4 -> t.setjd; t -> putTime; newline;
   
   '>>> Nuts days <<<' -> putline;
   (1996, 14, 31, 8,0,0 ) -> t; t -> puttime; newline;
   
   '>>> Weekdays <<<' -> putline;
   
   clear;
   (1996,11,25,8,0,0) -> t;
   t -> puttime; ' weekday: ' ->puttext; t.weekday -> putint; newline;
   
   '>>> Adding <<<' -> putline;
   
   (0,0,2,0,0,0) -> t; t.getjd -> putreal; newline;
   (0,0,0,7,0,0) -> t; t.getjd -> putreal; newline;
   (0,0,0,0,0,0) -> t; t.getjd -> putreal; newline;
   
#)

--- timeLib: attributes ---

getjd: (# jd: @real <<slot getjd:dopart>> exit jd #);
setjd: (# jd: @real enter jd <<slot setjd:dopart>> #);
getfracday: (# fd: @real <<slot getfracday:dopart>> exit fd #);

--- INCLUDE '../private/timedatebody'
--- getjd:dopart ---
do 
   private.jd->jd
   
--- setjd:dopart ---
do jd -> wfloor -> private.jdd;
   jd -> frac -> private.jdf;
   JD2GregCal;
   
--- getfracday:dopart ---
do
   private.jd + 0.5 -> frac -> fd;
   
