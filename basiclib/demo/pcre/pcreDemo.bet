ORIGIN '~beta/basiclib/pcre';
INCLUDE '~beta/basiclib/formatio';
--- program: descriptor ---
(#
   after: ^Text;
   tt: ^Text;
   success: @Boolean;
   regex: @Pcre;
   simpleMatch:
   (#
      cr: @Pcre;
      re: ^Text;
      sub: ^Text;
    enter (re[], sub[])
    do
       re[] -> cr;
       (if sub[] -> cr.match then
          '\'%s\' is matched by \'%s\'\n' ->
	     putFormat (# do re[] -> s; sub[] -> s; #);
       else
          '\'%s\' is not matched by \'%s\'\n' ->
	     putFormat (# do re[] -> s; sub[] -> s; #);
       if);
   #);
do ('^([a-zA-Z])[a-zA-Z_0-9]+$', 'p9') -> simpleMatch;
   ('^([a-zA-Z])[a-zA-Z_0-9]+$', 'This_is_a_variable_name_2') -> simpleMatch;
   ('^([a-zA-Z])[a-zA-Z_0-9]+$', '9p') -> simpleMatch;
   ('^([a-zA-Z])[a-zA-Z_0-9]+$', 'p 9') -> simpleMatch;
   'Wer der Philosophie Wissenschaftlichkeit im Sinne rationeller\nund argumentativ geschlossener Diskursivität abverlangt,\nwird die Frage, ob denn nun Dichter Philosophen seien, in\nletzter Instanz verneinen müssen.' -> tt[];
   '***Test text: \n%s\n' -> putFormat (# do tt[] -> s #);
   '[A-Z]' -> regex;
   '**First capital letter' -> putline;
   tt[] -> regex.match (# do 'Match \'%s\' (position %d-%d)\n' ->
                             putFormat (# do matchText -> s;
					     matchPos -> (d, d);
				       #);
		       #);
   '**First capital letter after position 10 in text' -> putline;
   tt[] -> regex.match (#    position:: (# do 10 -> p #);
                          do 'Match \'%s\' (position %d-%d)\n' ->
                             putFormat (# do matchText -> s;
					     matchPos -> (d, d);
				       #);
		       #);
   '**First capital letter after position 9 in text' -> putline;
   tt[] -> regex.match (#    position:: (# do 9 -> p #);
                          do 'Match \'%s\' (position %d-%d)\n' ->
                             putFormat (# do matchText -> s;
					     matchPos -> (d, d);
				       #);
		       #);
   '**All the capital letters in text' -> putline;
   tt[] -> regex.matchAll (#
                             do matchText -> putText;
		          #);
   putLine;
   '[aeiouäöü]{2,}' -> regex;
   '**First set of consecutive vowels' -> putline;
   tt[] -> regex.match (# do 'Match \'%s\' (position %d-%d)\n' ->
                             putFormat (# do matchText -> s;
					     matchPos -> (d, d);
				       #);
		       #);
   '**Job change' -> putline;
   (tt[], 'Informatiker') -> ('Dichter' -> Pcre).replace -> (success, after[]);
   after[] -> putLine;
   '**Childrens song version' -> putline;
   '[aäeioöuü]' -> regex;
   (tt[], 'i') -> ('[aäeioöuü]' -> Pcre).replaceAll -> (success, after[]);
   after[] -> putLine;
   '**Case insensitive and case preserving childrens song version' -> putline;
   '[AÄEIOÖUÜaäeioöuü]' -> regex;
   (tt[], 'i') -> regex.replaceAll (# rep:: (#
      do
         (if (matchtext).T[1] -> ascii.isupper then
             'A' -> r[];
         else
             'a' -> r[];
         if);
      #);
   #) -> (success, after[]);
   after[] -> putLine;
   '**Words' -> putline;
   '[ \\n,.]+' -> regex;
   tt[] -> regex.matchAll (# split:: (# do splitText -> putLine; #); #);
   '> Kan du spesifisere hva du mener med "naturtalent"/egnet?\n\nThore kan sikkert det på egenhånd, men jeg pleier å si at bugs\ner hint fra maskinen til mennesket om at mennesket ikke har skjønt\nmaskinen.  Et naturtalent av en programmerer skjønner maskinen.  En\nprogrammerer som sliter med bugs i månedsvis, burde ta et hint.' -> tt[];
   '***Test text: \n%s\n' -> putFormat (# do tt[] -> s #);
   '**HTMLise' -> putline;
   '[\n<>&]|[^ -~]' -> regex;
   (tt[], '') -> regex.replaceAll
   (#
      rep::
      (#
         mat: ^Text;
      do
         matchText -> mat[];
	 (if mat.T[1]
	     // '>' then '&gt;' -> r[];
	     // '<' then '&lt;' -> r[];
	     // '&' then '&amp;' -> r[];
	     // '\n' then '<br>\n' -> r[];
	 else
	    '' -> r[];
	    '&#%02x;' -> r.putformat (# do mat.T[1] -> x; #);
	 if);
       #);
    #) -> (success, after[]);
   after[] -> putLine;
#)
