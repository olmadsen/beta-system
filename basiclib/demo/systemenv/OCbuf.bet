ORIGIN '~beta/basiclib/systemenv';

---program: descriptor--
systemenv
(# buffer: @Monitor
     (# R: [4] @char; in,out: @integer;
        full: (# exit in=out #);
        empty: (#exit (in = (out mod R.range)+1) #);
        Put: Entry
          (# ch: @char
          enter ch
          do wait(# do (not full)->cond #);
             ch->R[in]; (in mod R.range)+1 ->in;
          #);
        get: Entry
          (# ch: @char
          do wait(# do (not empty)->cond #);
             R[(out mod R.range)+1->out]->ch; 
          exit ch
          #);
        init::< (# do 1->in; R.range->out #)
     #);
   
   prod: @| System(# do cycle(# do (if keyboard.EOS then stop else keyboard.get->buffer.put if) #) #);
   cons: @| System(# do cycle(# do buffer.get->screen.put #) #);
   
do buffer.init;
   conc(# do prod[]->start; cons[]->start #)
#)

