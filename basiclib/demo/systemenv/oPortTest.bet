ORIGIN '~beta/basiclib/v1.6/systemenv';
--- program: descriptor ---
systemenv
(# s: @ | System
     (# qp: @QualifiedPort;
        op: @ObjectPort;
        dosomeQ: qp.entry 
          (# x: @integer;
          enter x
          do '\tp'->puttext;x->putint;
             '.dosome(##)'->putline;
          #);
        dosomeP: op.entry 
          (# x: @integer;
          enter x
          do '\tp'->puttext;x->putint;
             '.dosome([])'->putline;
          #);
     do (for i:3 repeat
             'accept p1s[]'->putline; p1s[]->op.accept;
             'accept p1##'->putline; p1##->qp.accept;
             'accept p2##'->putline; p2##->qp.accept;
             'accept p2s[]'->putline; p2s[]->op.accept
        for);
     #);
   p1: System
     (# do (for 3 repeat
                'trying p1.dosome([])'->putline; 1->s.dosomeP;
                'trying p1.dosome(##)'->putline; 1->s.dosomeQ;
           for)
     #);
   p2: System
     (# do (for 3 repeat
                'trying p2.dosome(##)'->putline; 2->s.dosomeQ;
                'trying p2.dosome([])'->putline; 2->s.dosomeP
           for)
     #);
   p1s: @|p1;
   p2s: @|p2;
do p2s[]->fork;p1s[]->fork;s[]->fork;
#)
