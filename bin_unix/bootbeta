#!/bin/sh

# used to boot beta compiler.
# this one is tricky, since we cannot just set BETALIB
# to the old value and invoke bin/beta in the old location: 
# BETALIB *must* point to the stuff we are about to compile. 
# So we introduce a variable OLD_BETALIB to point to the old 
# location and duplicate the beta script.

#--- configuration---
OLD_BETALIB="/users/beta"
OLD_COMPILER_VERSION="v5.2"
OLD_BETARUN="/users/beta/betarun/v2.9"

#--- don't change below ---

if [ "$BETALIB" = "" ]
then
    echo "$0: BETALIB must be set to NEW location"
    exit 1
fi

. $BETALIB/configuration/env.sh

if [ "$MACHINETYPE" = "SGI" ]
then
  LD_LIBRARY_PATH=${OLD_BETALIB}/system/${OLD_COMPILER_VERSION}/${objdir}:${LD_LIBRARY_PATH}
  export LD_LIBRARY_PATH
fi

# try binary first
compiler=${OLD_BETALIB}/system/${OLD_COMPILER_VERSION}/${MACHINETYPE}Bbeta
if [ ! -f $compiler ]
then
  # fall back on non-binary
  compiler=${OLD_BETALIB}/system/${OLD_COMPILER_VERSION}/${MACHINETYPE}beta
fi

exec $compiler --betarun ${OLD_BETARUN}/${objdir}/betarunv.o $BETAOPTS $betaopt "$@"

