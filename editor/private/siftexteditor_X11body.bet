ORIGIN 'siftexteditorbody';
INCLUDE '~beta/guienv/v1.6/private/X11/widget';
(*
 * COPYRIGHT
 *   Copyright Mjolner Informatics, 1995-97
 *   All rights reserved.
 *)
-- siftexteditorSetBindings: Descriptor --
(#  do contents.WidgetId->X11EmacsBindings #)  

-- lib: Attributes --
X11EmacsBindings:
  (#
     override: @
       (# tt: @integer; widget: @integer; 
       do t->XtParseTranslationTable->tt; (widget,tt)->XtOverrideTranslations; t.clear; 
       #);
     t: @text
       (#
          putl: @putline;
          bind: @
            (# b: ^text
            enter b[]
            do (if lgth+b.lgth >= 1000 then override if); b[]->putl; 
            #);
          
       #);
     
  enter override.widget
  do
     'Ctrl <Key>b:            backward-character()'->t.bind;
     'Alt <Key>b:             backward-word()'->t.bind;
     'Meta <Key>b:            backward-word()'->t.bind;
     'Shift Alt <Key>b:       backward-word(extend)'->t.bind;
     'Shift Meta <Key>b:      backward-word(extend)'->t.bind;
     'Alt <Key>[:             backward-paragraph()'->t.bind;
     'Meta <Key>[:            backward-paragraph()'->t.bind;
     'Shift Alt <Key>[:       backward-paragraph(extend)'->t.bind;
     'Shift Meta <Key>[:      backward-paragraph(extend)'->t.bind;
     'Alt <Key><:             beginning-of-file()'->t.bind;
     'Meta <Key><:            beginning-of-file()'->t.bind;
     'Ctrl <Key>a:            beginning-of-line()'->t.bind;
     'Shift Ctrl <Key>a:      beginning-of-line(extend)'->t.bind;
     'Ctrl <Key>osfInsert:    copy-clipboard()'->t.bind;
     'Shift <Key>osfDelete:   cut-clipboard()'->t.bind;
     'Shift <Key>osfInsert:   paste-clipboard()'->t.bind;
     'Alt <Key>>:             end-of-file()'->t.bind;
     'Meta <Key>>:            end-of-file()'->t.bind;
     'Ctrl <Key>e:            end-of-line()'->t.bind;
     'Shift Ctrl <Key>e:      end-of-line(extend)'->t.bind;
     'Ctrl <Key>f:            forward-character()'->t.bind;
     'Alt <Key>]:             forward-paragraph()'->t.bind;
     'Meta <Key>]:            forward-paragraph()'->t.bind;
     'Shift Alt <Key>]:       forward-paragraph(extend)'->t.bind;
     'Shift Meta <Key>]:      forward-paragraph(extend)'->t.bind;
     'Ctrl Alt <Key>f:        forward-word()'->t.bind;
     'Ctrl Meta <Key>f:       forward-word()'->t.bind;
     'Ctrl <Key>d:            kill-next-character()'->t.bind;
     'Alt <Key>BackSpace:     kill-previous-word()'->t.bind;
     'Meta <Key>BackSpace:    kill-previous-word()'->t.bind;
     'Ctrl <Key>w:            key-select() kill-selection()'->t.bind;
     'Ctrl <Key>y:            unkill()'->t.bind;
     'Ctrl <Key>k:            kill-to-end-of-line()'->t.bind;
     'Alt <Key>Delete:        kill-to-start-of-line()'->t.bind;
     'Meta <Key>Delete:       kill-to-start-of-line()'->t.bind;
     'Ctrl <Key>o:            newline-and-backup()'->t.bind;
     'Ctrl <Key>j:            newline-and-indent()'->t.bind;
     'Ctrl <Key>n:            next-line()'->t.bind;
     'Ctrl <Key>osfLeft:      page-left()'->t.bind;
     'Ctrl <Key>osfRight:     page-right()'->t.bind;
     'Ctrl <Key>p:            previous-line()'->t.bind;
     'Ctrl <Key>g:            process-cancel()'->t.bind;
     'Ctrl <Key>l:            redraw-display()'->t.bind;
     'Ctrl <Key>osfDown:      next-page()'->t.bind;
     'Ctrl <Key>osfUp:        previous-page()'->t.bind;
     'Ctrl <Key>space:        set-anchor()'->t.bind;
     override;
     
  #)  

-- siftexteditorCharWidthType: Descriptor --
(# sz: @Point; count,sum: @Integer; ch: @Char
do
   thisOp:
     (# 
     do
        (if ts[]
         // none then
            contents.defaultStyle->ts[];
            (if ts[]
             // none then
                (if sifViewer.switch[14] then 'ts is none'->putLine if);
                INNER charWidthType;
                (if ts[]
                 // none then
                    (if sifViewer.switch[14] then 'ts is none, value is set to 80'->putLine if);
                    80->value;
                    leave thisOp (*not good: system.systemTextStyle[]->ts[]; *)
                if);
                
            if);
            
        if);
        'a'->ch;
        loop:
        (if ch <= 'z' then
            (ch->ts.widthOfChar)+sum->sum;
            (if sifViewer.switch[14] then
                '<'->put; ch->put; '> '->putText; ch->ts.widthOfChar->putInt; newLine
            if);
            (ch->ascii.upcase->ts.widthOfChar)+sum->sum;
            (if sifViewer.switch[14] then
                '<'->put;
                ch->ascii.upcase->put;
                '> '->putText;
                ch->ascii.upcase->ts.widthOfChar->putInt;
                newLine
            if);
            count+2->count;
            ch+1->ch;
            restart loop;
            
        if);
        '0'->ch;
        loop:
        (if ch <= '9' then
            (ch->ts.widthOfChar)+sum->sum;
            (if sifViewer.switch[14] then
                '<'->put; ch->put; '> '->putText; ch->ts.widthOfChar->putInt; newLine
            if);
            count+1->count;
            ch+1->ch;
            restart loop;
            
        if);
        viewsize.h div (sum div count)->value
     #)
#)  

-- siftexteditorUpdate: Descriptor --
(#  do  #)  

-- siftexteditorSetTexteditStyle: DoPart --
do

-- siftexteditorResetTexteditStyle: DoPart --
do

-- siftexteditorFormat: DoPart --
do

-- siftexteditorAllowFormat: DoPart --
do
