LIB_ITEM 'editorcodeeditor';
(*
 * COPYRIGHT
 *	 Copyright Mjolner Informatics, 1995-2000
 *	 All rights reserved.
 *)
ORIGIN '../codeeditor';
-- editMenuOpen: DoPart --
do 
   ('Undo','z')->iUndo.newKey;
   ('Redo','y')->iRedo.newkey;
   newSeparator;
   ('Cut','x')->iCut.newkey;
   ('Copy','c')->iCopy.newKey;
   ('Paste','v')->iPaste.newKey;
   ('Paste Before',spk.INSERT,false,false,false)->iPasteBefore.newSpecKey;
   ('Paste After',spk.INSERT,false,true,false)->iPasteAfter.newSpecKey;
   (*'Show Textedit Commands'->iShowTextEditCommands.new;*)
   ('Clear')->iClear.new;
   ('Select All','a')->iSelectAll.newkey;
   newSeparator;
   ('Textedit',spk.F2,false,false,false)->iTextEdit.newSpecKey;
   (if useExternalTextEditor then
   (*('External Textedit','e')->iExternalTextEdit.newKey;*)
       'External Textedit'->iExternalTextEdit.new
   if);
   ('Cancel Textediting',spk.ESCAPE,false,false,false)
     ->iRevertTextEdit.newSpecKey;
   newSeparator;
   ('Insert Before',ascii.cr,false,true,false)->iInsertBefore.newSpecKey;
   'Insert After (Return)'->iInsertAfter.new;
   newSeparator;
   ('Remove Optional Nonterminals','r')->iRemoveOptionals.newKey;
   ('Insert Optional Nonterminals','i')->iShowOptionals.newKey;
   newSeparator;
   ('Find...','f')->iSearch.newKey;
   ('Replace...','h')->iReplace.newKey;
   newSeparator;
   'Open Subeditor'->iSubeditor.new;
   'Form Write Protection'->iSetIsReadOnly.new;
   'Edit'->name;
   INNER  

-- editMenuiExternalTextEditOnStatus: DoPart --
do
   false->value;
   (if formEditorExists and not cfe.isReadOnly and not cfe.askTextEditMode and
   not cfe.frag.locked then
       (if useExternalTexteditor then true->value if)
   if)  

-- editMenuiExternalTextEditOnSelect: DoPart --
do 'External textediting'->writestatus; cfe.doExternalTextEdit; ''->writestatus  

-- viewMenuFollowLinkToSLOTOnSelect: DoPart --
do
   cfe.doCommand
     (# 
     do
        (if cfe.thisGroupEditor[] <> none then
            cfe.frag[]->cfe.thisGroupEditor.searchSLOT->node[];
            (if node[] <> none then
            (*node[]->cfe.edenv.ymerCallback.findAndSelect*)
                (node[],node[],false)->cfe.selectNodeInFormEditor
            if);
            
        if)
     #)  

-- viewMenuOpen: DoPart --
do
   'Abstract'->iAbstract.new;
   ('Astract Recursively',spk.LEFT,false,false,true)
     ->iAbstractRecursively.newSpecKey;
   ('Overview',spk.UP,false,false,true)->iOverview.newSpecKey;
   ('Detail (Dbl-Clk)',spk.RIGHT,false,false,true)->iDetail.newSpecKey;
   ('Detail Recursively',spk.DOWN,false,false,true)
     ->iDetailRecursively.newSpecKey;
   (if true (*BETAsif*) then
       newSeparator;
       ('Follow Semantic Link (Dbl-Clk)',spk.RIGHT,false,false,true)
         ->iFollowSemanticLink.newSpecKey;
       ('Follow Link To Fragment (Dbl-Clk)',spk.RIGHT,false,false,true)
         ->iFollowLinkToFragment.newSpecKey;
       ('Follow Link To SLOT',spk.f3,false,false,false)
         ->iFollowLinkToSLOT.newSpecKey
   if);
   newSeparator;
   ('Zoom In','+')->iZoomIn.newKey;
   ('Zoom Out','-')->iZoomOut.newKey;
   'Zoom To Full Editor'->iZoomFullEditor.new;
   newSeparator;
   ('Reprettyprint',spk.F5,false,false,false)->iReprettyprint.newSpecKey;
   'Format...'->iFormat.new;
   'Adaptive prettyprinting'->iAdaptivePrettyprinting.new;
   'Show AST Dump'->iShowAstCS.new;
   'View'->name;
   INNER  

-- SLOTsMenuCreateImplFragOnStatus: DoPart --
do allowCommand->value  

-- SLOTsMenuSelectImplFragOnStatus: DoPart --
do allowCommand->value  

-- SLOTsMenuSetImplFragOnStatus: DoPart --
do groupEditorExists->value  

-- SLOTsMenuUnsetImplFragOnStatus: DoPart --
do groupEditorExists->value  

-- SLOTsMenuSetSLOTnamePrefixOnStatus: DoPart --
do groupEditorExists->value  

-- SLOTsMenuUnsetSLOTnamePrefixOnStatus: DoPart --
do groupEditorExists->value  

-- SLOTsMenuHideImplOnStatus: DoPart --
do allowCommand->value  

-- SLOTsMenuOpen: DoPart --
do
   'Make DoPart SLOT...'->iMakeDoPartSlot.new;
   'Make Descriptor SLOT...'->iMakeDescriptorSlot.new;
   'Make Attributes SLOT...'->iMakeAttributesSlot.new;
   newSeparator;
   'Create Implementation File...'->iCreateImplementationFragment.new;
   'Select Implementation File...'->iSelectImplementationFragment.new;
   'Set Current as Implementation File'->iSetImplementationFragment.new;
   'Unset Implementation File'->iUnsetImplementationFragment.new;
   'Set SLOT Name Prefix...'->iSetSLOTNamePrefix.new;
   'Unset SLOT Name Prefix'->iUnsetSLOTNamePrefix.new;
   'Hide Implementation...'->iHideImpl.new;
   (* newSeparator;*)
   (* 'Paste Fragment Form'->iPasteFragmentForm.new;*)
   (*  'Test: Fill SLOT...'->iFillSlot.new;
    'Test: Fill All SLOTs'->iFillAllSlots.new;*)
   'SLOTs'->name;
   INNER  

-- editMenuCutOnStatus: DoPart --
do
   (if false (*allowTextAndStructure *) then
       (if not cfe.textEditMode and cfe.frag.locked (* by another editor *)
        then
           false->value
        else
           true->value
       if)
   if);
   (if allowTextAndStructure then
       (if not cfe.texteditMode then
           (if not cfe.frag.locked then true->value else false->value if)
        else
           true->value
       if)
    else
       false->value
   if)  

-- editMenuCutOnSelect: DoPart --
do cfe.doCut;   

-- editMenuCopyOnStatus: DoPart --
do formEditorExists->value  

-- editMenuCopyOnSelect: DoPart --
do cfe.doCopy  

-- editMenuPasteOnStatus: DoPart --
do
   (if allowTextAndStructure then
       (if not cfe.texteditMode then
           (if not cfe.frag.locked then
               cfe.askPastePermission->value
            else
               false->value
           if)
        else
           true->value
       if)
    else
       false->value
   if)  

-- editMenuPasteOnSelect: DoPart --
do cfe.doPaste  

-- editMenuAllowCommand: DoPart --
do
   (if formEditorExists then
       not cfe.frag.locked (*texteditMode*) and not cfe.isReadOnly->value
   if)  

-- editMenuUndoOnStatus: DoPart --
do (if allowCommand then cfe.askUndoPermission->value else false->value if)  

-- editMenuUndoOnSelect: DoPart --
do cfe.doUndo  

-- editMenuRedoOnStatus: DoPart --
do (if allowCommand then cfe.askRedoPermission->value else false->value if)  

-- editMenuRedoOnSelect: DoPart --
do cfe.doRedo  

-- editMenuClearOnStatus: DoPart --
do allowCommand->value  

-- editMenuClearOnSelect: DoPart --
do cfe.doClear;   

-- editMenuSelectAllOnStatus: DoPart --
do
   (if allowTextAndStructure then
       (if not cfe.texteditMode then
           (if not cfe.frag.locked then true->value else false->value if)
        else
           false->value
       if)
    else
       false->value
   if)  

-- editMenuSelectAllOnSelect: DoPart --
do cfe.doSelectAll;   

-- editMenuTextEditOnStatus: DoPart --
do
   (if formEditorExists then
       (if not cfe.isReadOnly then
           true->value
        else
           (if not cfe.edenv.ymerCallback.isEditor (* is in debugging mode *)
            then
               true->value
            else
               false->value
           if)
       if);
       (if cfe.askTextEditMode then
           'Parse Text (Ctrl+Space)'->THIS(item).name
        else
           'Edit Text (Space)'->THIS(item).name
       if)
    else
       false->value
   if)  

-- editMenuTexteditOnSelect: DoPart --
do (if cfe.askTextEditMode then cfe.doParseText else cfe.doTextEdit if);   

-- editMenuRevertTexteditOnStatus: DoPart --
do
   (if formEditorExists and not cfe.isReadOnly then
       cfe.askTextEditMode->value
    else
       false->value
   if)  

-- editMenuRevertTexteditOnSelect: DoPart --
do cfe.doRevertTextEdit; ''->writestatus  

-- popupMenuFollowLinkToFragmentSeparateOnStatus: DoPart --
do (if allowCommand then cfe.cs.isSlot->value else false->value if)  

-- popupMenuFollowLinkToFragmentSeparateOnSelect: DoPart --
do cfe.doCommand (#  do true->cfe.makeSearchSlotBinding #)  

-- popupMenuFollowLinkToSLOTOnSelect: DoPart --
do
   cfe.doCommand
     (# 
     do
        (if cfe.thisGroupEditor[] <> none then
            cfe.frag[]->cfe.thisGroupEditor.searchSLOT->node[];
            (if node[] <> none then
            (*node[]->cfe.edenv.ymerCallback.findAndSelect*)
                (node[],node[],false)->cfe.selectNodeInFormEditor
            if);
            
        if)
     #)  

-- popupMenuFollowLinkToSLOTSeparateOnStatus: DoPart --
do allowCommand->value  

-- popupMenuFollowLinkToSLOTSeparateOnSelect: DoPart --
do
   cfe.doCommand
     (# 
     do
        (if cfe.thisGroupEditor[] <> none then
            cfe.frag[]->cfe.thisGroupEditor.searchSLOT->node[];
            (if node[] <> none then
            (*node[]->cfe.edenv.ymerCallback.findAndSelect*)
                (node.frag.root[],node[],true)->cfe.selectNodeInFormEditor
            if);
            
        if)
     #)  

-- popupMenuOpenSeparateOnSelect: DoPart --
do (cfe.editorRoot[],cfe.editorRoot[],true)->cfe.selectNodeInFormEditor  

-- popupMenuCutOnStatus: DoPart --
do (*allowTextAndStructure->value;*)
   (if allowTextAndStructure then
       (if not cfe.texteditMode then
           (if not cfe.frag.locked then true->value else false->value if)
        else
           true->value
       if)
    else
       false->value
   if)  

-- popupMenuCutOnSelect: DoPart --
do cfe.doCut;   

-- popupMenuCopyOnStatus: DoPart --
do formEditorExists->value  

-- popupMenuCopyOnSelect: DoPart --
do cfe.doCopy  

-- popupMenuPasteOnStatus: DoPart --
do
   (if formeditorExists then
       (if not cfe.texteditMode then
           cfe.askPastePermission->value
        else
           true->value
       if)
    else
       false->value
   if)  

-- popupMenuPasteOnSelect: DoPart --
do cfe.doPaste  

-- popupMenuFollowOpen: DoPart --
do
   'Semantic Link (Dbl-Clk)'->iFollowSemanticLink.new;
   'Semantic Link (Separate Window)'->iFollowSemanticLinkSeparate.new;
   'Link To Fragment (Dbl-Clk)'->iFollowLinkToFragment.new;
   'Link To Fragment (Separate Window)'->iFollowLinkToFragmentSeparate.new;
   'Link To SLOT'->iFollowLinkToSLOT.new;
   'Link To SLOT (Separate Window)'->iFollowLinkToSLOTSeparate.new  

-- popupMenuEditOpen: DoPart --
do
   ('Cut','x')->iCut.newkey;
   ('Copy','c')->iCopy.newKey;
   ('Paste','v')->iPaste.newKey;
   ('Paste Before',spk.INSERT,false,false,false)->iPasteBefore.newSpecKey;
   ('Paste After',spk.INSERT,false,true,false)->iPasteAfter.newSpecKey;
   newSeparator;
   ('Insert Before',ascii.cr,true,true,false)->iInsertBefore.newSpecKey;
   ('Insert After',ascii.cr,false,true,false)->iInsertAfter.newSpecKey;

-- popupMenuOpen: DoPart --
do
   ('Back',spk.LEFT,false,true,false)->iBack.newSpecKey;
   ('Forward',spk.RIGHT,false,true,false)->iForward.newSpecKey;
   (if BETAsif then newSeparator; 'Follow'->iFollow.new if);
   newSeparator;
   'Open Separate Editor'->iOpenSeparate.new;
   'Open Subeditor'->iSubeditor.new;
   newSeparator;
   'Show UML Class Diagram'->iShowDiagram.new;
   'Open GUI Editor'->iEditUserInterface.new;
   newSeparator;
   'Edit'->iEdit.new;
   (*  newSeparator;
    *  'Debug'->iDebug.new;*)
   newSeparator;
   ('Reprettyprint',spk.F5,false,false,false)->iReprettyprint.newSpecKey;
   INNER  

-- popupMenuTextmodeOpen: DoPart --
do
   ('Cut','x')->iCut.newkey;
   ('Copy','c')->iCopy.newKey;
   ('Paste','v')->iPaste.newKey;
   newSeparator;
   ('Parse Text (Ctrl-space)',spk.F2,false,false,false)->iParseText.newSpecKey;
   ('Cancel Textediting',spk.ESCAPE,false,false,false)
     ->iRevertTextEdit.newSpecKey;
   newSeparator;
   'Comment Out Selection'->iComment.new;
   'Remove Surrounding Comment'->iRemoveComment.new;
     

-- popupMenuTextmodeCutOnStatus: DoPart --
do (*allowTextAndStructure->value;*)
   (if allowTextAndStructure then
       (if not cfe.texteditMode then
           (if not cfe.frag.locked then true->value else false->value if)
        else
           true->value
       if)
    else
       false->value
   if)  

-- popupMenuTextmodeCutOnSelect: DoPart --
do cfe.doCut  

-- popupMenuTextmodeCopyOnStatus: DoPart --
do formEditorExists->value  

-- popupMenuTextmodeCopyOnSelect: DoPart --
do cfe.doCopy  

-- popupMenuTextmodePasteOnStatus: DoPart --
do
   (if formeditorExists then
       (if not cfe.texteditMode then
           cfe.askPastePermission->value
        else
           true->value
       if)
    else
       false->value
   if)  

-- popupMenuTextmodePasteOnSelect: DoPart --
do cfe.doPaste  

-- popupMenuTextModeParseTextOnStatus: DoPart --
do
   (if formEditorExists then
       (if not cfe.isReadOnly then
           true->value
        else
           (if not cfe.edenv.ymerCallback.isEditor (* is in debugging mode *)
            then
               true->value
            else
               false->value
           if)
       if);
       'Parse Text (Ctrl-space)'->THIS(item).name
    else
       false->value
   if)  

-- popupMenuTextModeParseTextOnSelect: DoPart --
do cfe.doParseText;   

-- popupMenuTextModeRevertTexteditOnStatus: DoPart --
do
   (if formEditorExists and not cfe.isReadOnly then
       cfe.askTextEditMode->value
    else
       false->value
   if)  

-- popupMenuTextModeRevertTexteditOnSelect: DoPart --
do cfe.doRevertTextEdit; ''->writestatus  

-- popupMenuTextmodeCommentOnStatus: DoPart --
do cfe.commentAllowed->value  

-- popupMenuTextmodeCommentOnSelect: DoPart --
do cfe.doComment  

-- popupMenuTextmodeRemoveCommentOnStatus: DoPart --
do
   cfe.doSurrounding_comment->(comBeginRow,comBeginCol,comEndRow,comEndCol);
   (comBeginRow <> - 1)->value  

-- popupMenuTextmodeRemoveCommentOnSelect: DoPart --
do (comBeginRow,comBeginCol,comEndRow,comEndCol)->cfe.doRemoveComment  

-- codeeditorPopUpMenuBackOnStatus: DoPart --
do
   (formeditorExists and (cfe.cs.node[]->cfe.edenv.history.BackPossible))->value  

-- codeeditorPopUpMenuBackOnSelect: DoPart --
do
   cfe.edenv.history.protect
     (# node: ^astInterface.ast
     do
     (* cfe.cs.node[]->cfe.edenv.history.back
      ->cfe.edenv.ymerCallBack.findAndSelect*)
        cfe.cs.node[]->cfe.edenv.history.back->node[];
        (if node[] <> none then
            (node.frag.root[],node[],false)->cfe.selectNodeInFormEditor
        if)
     #)  

-- codeeditorPopUpMenuForwardOnStatus: DoPart --
do
   (formeditorExists and (cfe.cs.node[]->cfe.edenv.history.forwardPossible))
     ->value  

-- codeeditorPopUpMenuForwardOnSelect: DoPart --
do
   cfe.edenv.history.protect
     (# node: ^astInterface.ast
     do
     (* cfe.cs.node[]->cfe.edenv.history.forward
      ->cfe.edenv.ymerCallBack.findAndSelect*)
        cfe.cs.node[]->cfe.edenv.history.forward->node[];
        (if node[] <> none then
            (node.frag.root[],node[],false)->cfe.selectNodeInFormEditor
        if)
     #)  

-- codeeditorFormatOnStatus: DoPart --
do
   allowCommand->value;
   (if formEditorExists then
       cfe.theSiftexteditor.contents.AllowFormat->value
   if);
     

-- codeeditorFormatOnSelect: DoPart --
do cfe.theSifTexteditor.contents.format;   

-- editMenuiSetIsReadOnlyOnStatus: DoPart --
do
   formeditorExists and not cfe.frag.locked (*texteditMode*) ->value;
   (if formEditorExists then
       cfe.isReadOnly->checked;
       (if cfe.isReadOnly then (* 'Write protected'->writeStatus *)
           
        else
       (* ''->writeStatus *)
           
       if)
   if)  

-- editMenuiSetIsReadOnlyOnSelect: DoPart --
do
   (if cfe.isReadOnly then
       (if cfe.thisGroupEditor[] <> none then
           (if cfe.thisGroupEditor.groupFileWriteable then
               false->cfe.setIsReadOnly; ''->writeStatus
           if)
       if)
    else
       true->cfe.setIsReadOnly; 'Write protected'->writeStatus
   if)  

-- editMenuShowTexteditCommandsOnStatus: DoPart --
do
   (if formEditorExists and not cfe.isReadOnly then
       cfe.askTexteditMode->value
    else
       false->value
   if);
   false-> (* not implemented *) value  

-- editMenuShowTexteditCommandsOnSelect: DoPart --
do cfe.doShowTexteditCommands;   

-- editMenuReplaceOnStatus: DoPart --
do
   (if formEditorExists then
       not cfe.frag.locked (*texteditMode*) and not cfe.isReadOnly->value
    else
       false->value
   if)  

-- viewMenuAllowCommand: DoPart --
do
   (if formEditorExists then not cfe.frag.locked (*texteditMode*) ->value if)  

-- SLOTsMenuFormeditorExists: DoPart --
do
   INNER ;
   (if cfe[] <> none then not cfe.frag.locked (*texteditMode*) ->value if)  

-- SLOTsMenuGroupEditorExists: DoPart --
do
   INNER ;
   (if cfe[] <> none then
       (cge[] <> none ) and not cfe.frag.locked (*texteditMode*) ->value
    else
       cge[] <> none ->value
   if)  

-- SLOTsMenuAllowCommand: DoPart --
do
   (if formEditorExists and not cfe.frag.locked (*texteditMode*) and not
   cfe.isReadOnly then
       true->value
   if)  

-- popUpMenuAllowCommand: DoPart --
do
   (if formEditorExists then
       not cfe.frag.locked (*texteditMode*) and not cfe.isReadOnly->value
   if)  

-- codeeditorPopupMenuDebugOnStatus: DoPart --
do cfe.frag.father->cfe.edenv.ymerCallback.allowdebug->(value,name);   

-- codeeditorPopupMenuDebugOnSelect: DoPart --
do cfe.frag.father->cfe.edenv.ymerCallback.dodebug;   

-- popupMenuShowDiagramOnStatus: DoPart --
do
   (if formEditorExists and not cfe.frag.locked then
       cfe.askShowDiagram->value
    else
       false->value
   if)  

-- popupMenuGUIOnStatus: DoPart --
do
   (if allowCommand then
       true (*cfe.askEditUserInterface*) ->value
    else
       false->value
   if)  

-- popupMenuGUIOnSelect: DoPart --
do cfe.editUserInterface  

-- editMenuiInsertAfterOnStatus: DoPart --
do (if allowCommand then cfe.askInsertPermission->value else false->value if)  

-- editMenuiInsertAfterOnSelect: DoPart --
do
     (# start,end: @integer
     do
        (if allowCommand and cfe.askInsertPermission then
            cfe.doInsertAfter
         else
            (if (cfe[] <> none ) and cfe.textEditMode then
                'ctrl-a in texteditMode caught in editmenu.insertafter.select'
                  ->putLine;
                cfe.theSifTexteditor.contents.beginning_of_line;
                cfe.theSifTexteditor.contents.texteditingExtent->(start,end);
                'Textediting extent: ('->putText;
                start->putInt;
                ','->put;
                end->putInt;
                ')'->putLine;
                
            if)
        if)
     #)  

-- editMenuiRemoveOptionalsOnStatus: DoPart --
do allowCommand->value  

-- editMenuiRemoveOptionalsOnSelect: DoPart --
do
   (if allowCommand then
       cfe.doRemoveOptionals
    else
       (if (cfe[] <> none ) and cfe.textEditMode then
           'ctrl-n in texteditMode caught in editmenu.removeOptionals.select'
             ->putLine;
           cfe.theSifTexteditor.contents.next_line;
           
       if)
   if)  

-- viewMenuiReprettyprintOnStatus: DoPart --
do allowCommand->value  

-- viewMenuiReprettyprintOnSelect: DoPart --
do
   (if allowCommand then
       cfe.doReprettyprint
    else
       (if (cfe[] <> none ) and cfe.textEditMode then
           'ctrl-p in texteditMode caught in viewmenu.reprettyprint.select'
             ->putLine;
           cfe.theSifTexteditor.contents.previous_line;
           
       if)
   if)  

