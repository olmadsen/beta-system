ORIGIN '../ymersiflib';
LIB_ITEM 'editorymersiflib'
(*
 * COPYRIGHT
 *	 Copyright Mjolner Informatics, 1995-2000
 *	 All rights reserved.
 *)
-- ymersiflibSearchCheckNode: DoPart --
do
     (#
        lexText: ^astInterface.lexemText;
        exp: ^astInterface.expanded;
        help,currentText: ^text
     do
        (if not searchFor.onlyApplications then
            (if node.kind
             // mps.ast.kinds.nameDecl // mps.ast.kinds.nameAppl
             // mps.ast.kinds.string then
                (if
                (searchFor.t[],node[],searchFor.caseSensitive,
                 searchFor.wholeWord)->edenv.inLexem then
                    true->value;
                    node[]->lexText[];
                    '...'->t[];
                    lexText.getText->t.append;
                    '...'->t.append
                if)
            if)
         else
            (if searchFor.theNameDcl[] <> none then
                (if (node.kind = mps.ast.kinds.nameAppl) or
                (node.kind = mps.ast.kinds.nameDecl) then
                    node[]->lexText[];
                    lexText.getText->currentText[];
                    (if currentText[]->searchFor.t.equalNCS then
                        (if
                        (node[],searchFor.theNameDcl[])->edenv.isApplicationOf
                         then
                            true->value;
                            node[]->lexText[];
                            '...'->t[];
                            lexText.getText->t.append;
                            '...'->t.append
                        if)
                    if)
                if)
            if)
        if)
     #)  

-- ymersiflibSearchShowSearchHits: DoPart --
do
   doCommand
     (# 
     do
        t[]->searchFor.t[];
        caseSensitive->searchFor.caseSensitive;
        wholeWord->searchFor.wholeword;
        onlyApplications->searchFor.onlyApplications;
        theNameDcl[]->searchFor.theNameDcl[];
        (if searchArea
         // searchArea_cs then
            node[]->searchNode[]; ff[]->searchff[]; fg[]->searchfg[]
         // searchArea_ff then
            none ->searchNode[]; ff[]->searchff[]; fg[]->searchfg[]
         // searchArea_fg then
            none ->searchNode[]; none ->searchff[]; fg[]->searchfg[]
         // searchArea_project then
            none ->searchNode[]; none ->searchff[]; none ->searchfg[]
        if);
        (if theSearchViewer[] = none then
            &searchViewer[]->thesearchViewer[];
            ymerBrowserInt[]->thesearchViewer.init;
            showAllHits->theSearchViewer.showAllHits;
            thesearchViewer.open
         else
            (if not thesearchViewer.opened then
                &searchViewer[]->thesearchViewer[];
                ymerBrowserInt[]->thesearchViewer.init;
                showAllHits->theSearchViewer.showAllHits;
                thesearchViewer.open;
                (searchfg[],searchff[],searchNode[])
                  ->thesearchViewer.registerFragmentGroup
             else
                showAllHits->theSearchViewer.showAllHits;
                (searchfg[],searchff[],searchNode[])
                  ->thesearchViewer.registerFragmentGroup;
                thesearchViewer.show;
                thesearchViewer.bringToFront
            if)
        if);
     #)  

-- ymersiflibCheckGroupStatus: DoPart --
do
     (# msg: ^text
     do
        (if searchFor.onlyApplications then
            (if not ((mps.ast[],fg[])->getDoneCheckProperty) then
                false->value;
                (fg.name).copy->msg[];
                ' must be (re)checked \nin order to (re)build the semantic links\n'
                  ->msg.append;
                (none ,'Check?',msg[])
                  ->gui.promptForBoolean
                    (# ok::  (#  do fg[]->check->value #) #)
            if)
        if)
     #)  

-- ymersiflibSearchCallSearch: DoPart --
do
     (# originalGE: ^edenv.groupEditor; originalFE: ^ymerbrowser.codeeditor
     do
        ymerBrowserInt.cge[]->originalGE[];
        ymerBrowserInt.cfe[]->originalFE[];
        (ymerBrowserInt.cge[],ymerBrowserInt.cfe[],none ,none ,none )
          ->edenv.searchTextDialog
            (#
               found:: 
                 (# 
                 do
                    (if edenv.trace[12] then 'found'->putLine if);
                    foundNode[]->findandselect
                 #);
               notfound:: 
                 (# help: ^text
                 do
                    ascii.bel->put;
                    searchText[]->help[];
                    ' not found'->help.append;
                    (if originalGE[] <> none then
                        ' in '->help.append;
                        originalGE.fgTitle->help.append;
                        (if originalFE[] <> none then
                            '-'->help.append; originalFE.frag.name->help.append
                        if)
                    if);
                    (if edenv.trace[12] then help[]->putLine if);
                    help[]->writeInfoView
                 #)
            #)
     #)  

-- ymersiflibSearchCallReplace: DoPart --
do
     (# originalGE: ^edenv.groupEditor; originalFE: ^ymerbrowser.codeeditor
     do
        (ymerBrowserInt.cge[],ymerBrowserInt.cfe[],none ,none ,none )
          ->edenv.replaceTextDialog
            (#
               found:: 
                 (# 
                 do
                    (if edenv.trace[12] then 'found'->putLine if);
                    foundNode[]->findandselect
                 #);
               notfound:: 
                 (# help: ^text
                 do
                    ascii.bel->put;
                    searchText[]->help[];
                    ' not found'->help.append;
                    (if originalGE[] <> none then
                        ' in '->help.append;
                        originalGE.fgTitle->help.append;
                        (if originalFE[] <> none then
                            '-'->help.append; originalFE.frag.name->help.append
                        if)
                    if);
                    (if edenv.trace[12] then help[]->putLine if);
                    help[]->writeInfoView
                 #)
            #)
     #)  

