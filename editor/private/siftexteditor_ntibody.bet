ORIGIN 'siftexteditorbody' (*
 * COPYRIGHT
 *   Copyright Mjolner Informatics, 1995-97
 *   All rights reserved.
 *)
;
INCLUDE '~beta/guienv/v1.6/private/winnt/fields_ntibody'
        '~beta/guienv/v1.6/fields';
-- siftexteditorSetBindings: Descriptor --
(#  do  #)  

-- siftexteditorCharWidthType: Descriptor --
(# sz: @Point; count,sum: @Integer; ch: @Char
do
   thisOp:
     (# 
     do
        (if ts[]
         // none then
            contents.defaultStyle->ts[];
            (if ts[]
             // none then
                (if sifViewer.switch[14] then 'ts is none'->putLine if);
                INNER charWidthType;
                (if ts[]
                 // none then
                    (if sifViewer.switch[14] then
                        'ts is none, value is set to 80'->putLine
                    if);
                    80->value;
                    leave thisOp (*not good: system.systemTextStyle[]->ts[]; *)
                if);
                
            if);
            
        if);
        'a'->ch;
        loop:
        (if ch <= 'z' then
            (ch->ts.widthOfChar)+sum->sum;
            (if sifViewer.switch[14] then
                '<'->put;
                ch->put;
                '> '->putText;
                ch->ts.widthOfChar->putInt;
                newLine
            if);
            (ch->ascii.upcase->ts.widthOfChar)+sum->sum;
            (if sifViewer.switch[14] then
                '<'->put;
                ch->ascii.upcase->put;
                '> '->putText;
                ch->ascii.upcase->ts.widthOfChar->putInt;
                newLine
            if);
            count+2->count;
            ch+1->ch;
            restart loop;
            
        if);
        '0'->ch;
        loop:
        (if ch <= '9' then
            (ch->ts.widthOfChar)+sum->sum;
            (if sifViewer.switch[14] then
                '<'->put;
                ch->put;
                '> '->putText;
                ch->ts.widthOfChar->putInt;
                newLine
            if);
            count+1->count;
            ch+1->ch;
            restart loop;
            
        if);
        viewsize.h div (sum div count)->value
     #)
#)  

-- siftexteditorUpdate: Descriptor --
(#  do contents.update #)  

-- siftexteditorSetTexteditStyle: DoPart --
do
     (# cf: @CHARFORMAT; windowID: @integer; 
     do
        sizeOfCharFormat->malloc->cf.ptr;
        (if cf.ptr <> 0 then
            THIS(textField).interfaceObjectID->windowID;
            (cf.ptr,0,sizeOfCharFormat)->memset;
            sizeOfCharFormat->cf.cbSize;
            CFM_COLOR+CFM_UNDERLINE->cf.dwMask;
            (if ((COLOR_WINDOWTEXT->GetSysColor) = 0x00800080) then
                0x00808000->cf.crTextColor; 
             else
                0x00800080->cf.crTextColor; 
            if);
            (windowID,EM_SETCHARFORMAT,0x0001,cf.ptr)->SendMessage;
            cf.ptr->free;
            
        if);
        
     #)  

-- siftexteditorResetTexteditStyle: DoPart --
do
     (# cf: @CHARFORMAT; windowID: @integer; 
     do
        sizeOfCharFormat->malloc->cf.ptr;
        (if cf.ptr <> 0 then
            THIS(textField).interfaceObjectID->windowID;
            (cf.ptr,0,sizeOfCharFormat)->memset;
            sizeOfCharFormat->cf.cbSize;
            CFM_COLOR->cf.dwMask;
            siftexteditorPrivate.textColor->cf.crTextColor;
            (windowID,EM_SETCHARFORMAT,0x0000,cf.ptr)->SendMessage;
            cf.ptr->free
        if);
        
     #)  

-- siftexteditorFormat: DoPart --
do
   0->THIS(textField).private.formatFlags;
   THIS(textField).private.selectCharFormat->siftexteditorPrivate.textColor  

-- siftexteditorAllowFormat: DoPart --
do true->value  

