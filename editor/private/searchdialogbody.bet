ORIGIN '../searchdialog';
INCLUDE '~beta/guienv/v1.3.1/fields';
-- searchDialogPrivate: Descriptor --
(#
   fatherpos,fathersize,mysize: @point;
   dialogopened: @boolean;
   DialogText: textField
     (#
        eventhandler:: 
          (#
             onBeforeChange:: 
               (# txt: ^text
               do
                  (if length = 1 then
                      theText->txt[];
                      (if 1->txt.inxGet
                       // ascii.nl // ascii.cr then
                          THIS(search).private.nextButton.theEventhandler.
                            onMouseup;
                          false->allow;
                          
                      if);
                      
                  if)
               #);
             onKeyDown:: 
               (# 
               do
                  (if ch = ascii.esc then
                      THIS(search).private.cancelButton.theEventhandler.
                        onMouseup;
                      
                  if)
               #);
             
          #);
        
     #);
   theMessage: @staticText
     (# open::  (#  do ((20,10),(20+320,10+30))->frame #);  #);
   theText: @DialogText
     (# open::  (#  do ((20,40),(20+320,40+30))->frame #);  #);
   nextButton: @pushButton
     (#
        eventHandler:: 
          (# onMouseUp::  (#  do theText.contents->usertext[]; next #)
          #);
        open::  (#  do ((20,80),(20+100,80+30))->frame; 'Next'->label;  #);
        
     #);
   previousButton: @pushButton
     (#
        eventHandler:: 
          (# onMouseUp::  (#  do theText.contents->usertext[]; previous #)
          #);
        open:: 
          (#  do ((130,80),(130+110,80+30))->frame; 'Previous'->label;  #);
        
     #);
   cancelButton: @pushButton
     (#
        eventHandler:: 
          (#
             onMouseUp:: 
               (# 
               do theText.contents->usertext[]; cancel; THIS(search).hide
               #)
          #);
        open:: 
          (#  do ((250,80),(240+100,80+30))->frame; 'Close'->label;  #);
        
     #);
   
#)  

-- searchDialogPopup: DoPart --
do
   (if not private.dialogopened then open;  if);
   titleText[]->title;
   msgText[]->private.theMessage.label;
   private.theText.all->private.theText.selection;
   private.theText.delete;
   (if defaultText[] = none then ''->defaultText[] if);
   defaultText[]->private.theText.insert;
   private.theText.all->private.theText.selection;
   INNER ;
   (if father[] <> none then
       father.size->private.fathersize;
       size->private.mysize;
       father.position->private.fatherpos;
       (private.fatherpos.v+(private.fathersize.v-private.mysize.v) div 2,
        private.fatherpos.h+(private.fathersize.h-private.mysize.h) div 2)
         ->position;
       
   if);
   show;
     

-- searchDialogOpen: DoPart --
do
   (if not private.dialogopened then
       true->private.dialogopened;
       hide;
       private.theMessage.open;
       private.theText.open;
       private.nextButton.open;
       private.previousButton.open;
       private.cancelButton.open;
       (360,130)->size;
       INNER ;
       
   if);
     

