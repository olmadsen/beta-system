ORIGIN '../codeeditor';
INCLUDE '~beta/mps/v4.9.1/findgrammar'
        '~beta/betaast/v4.9.1/donecheck';
(*
 COPYRIGHT
 Copyright Mjolner Informatics, 1986-94
 All rights reserved.
 *)
(*
 COPYRIGHT
 Copyright Mjolner Informatics, 1986-94
 All rights reserved.
 *)
-- autoSaveLimitBody: Descriptor --
(#  do 1->ASlimit;  #)  

-- autoSaveBody: DoPart --
do 'autosave'->putLine  

-- fragmentChangedEventBody: Descriptor --
(# 
do
(* (if (thisGroupEditor[] <> none )
 then
 (if thisGroupEditor.writeAccess
 then *)
   noOfAstChanges+1->noOfAstChanges;
   fragmentTouched;
   (if (noOfAstChanges >= ASLimit) then autoSave; 0->noOfAstChanges;  if);
   (*   if);
    
    if);*)
   
#)  

-- resetFragmentTouchBody: Descriptor --
(#  do 0->touched;  #)  

-- fragmentTouchedBody: Descriptor --
(# 
do
   touched+1->touched;
   (* (if thisGroupEditor[]
    // none then 
    else
    thisGroupEditor.groupTouched; 
    if);*)
   (if true (*debugBrowser*) then
       'fragment touched '->putText; touched->putint; ' times'->putLine; 
   if);
   'TOUCHED'->frag.prop.addProp;
   
#)  

-- fragmentDetouchedBody: Descriptor --
(# 
do
   touched-1->touched;
   (*  (if thisGroupEditor[]
    // none then 
    else
    thisGroupEditor.groupDetouched; 
    if);*)
   (if true (*debugBrowser*) then
       'fragment touched '->putText; touched->putint; ' times'->putLine; 
   if);
   
#)  

-- codeeditorinit: DoPart --
do
     (# grammarWithPath,help: ^text; gg: ^mps.fragmentGroup; bobsfile: @file
     do
        &undoElemType[]->undoElem[];
        &expmenuprivate[]->expandmenuprivate[];
        &texteditingPrivate[]->TE[];
        frag.grammar.parser.haveBeenInitialized->parsingPossible;
        (if not parsingPossible then
            'No parser was initialized'->putline;
            '~beta/grammars/beta/v2.4/beta'->grammarWithPath[];
            (if betaGrammar.grammarAst[]
             // none then
                'No grammarAst for '->screen.putText;
                grammarWithPath[]->screen.putLine;
                
             else
                '-parser'->help[];
                mps.parserFileExtension->help.append;
                help[]->grammarWithPath.copyAppend->mps.expandToFullPath
                  ->bobsFile.name;
                (if bobsFile.entry.exists then
                    bobsFile.name->betaGrammar.parser.initialize;
                    ('objectdescriptor','descriptor')
                      ->betaGrammar.parser.privatePart.b.defineNonTAlias;
                    ('attributedecl','attributes')
                      ->betaGrammar.parser.privatePart.b.defineNonTAlias;
                    
                 else
                    'No parser available: '->screen.putText;
                    bobsFile.name->screen.putLine;
                    
                if);
                
            if);
            true->parsingPossible;
            'Parser initialized now'->putLine;
            
        if);
        false->switch[1];
        false->switch[2];
        false->switch[3];
        false->switch[4];
        false->switch[5]
     #)  

