1v5.0.1(0)

14/2-96: 
Frozen version for dSA

v5.0.2(0)

14/2-96:
Fixed the bug: If the checker was activated by double-clicking it crashed 
after checking in follow semantic link if there were bugs in the fragment 
structure

this has been merged into v5.0.1 in the PC sync. process

v5.0.2(1)

15/3-96: 

Fixed the bug: 
insert new fragment form when fragment list is empty
=>ref is none

Fixed the bug: 
copy root in one property editor and paste in another one
=> ref is none              

22/3-96:

Fixed the bug: 
following semantic links into a fragment that is not checked may 
lead to an indexerror in indextonode in valuetoast in getnodeattribute in 
dclRef. 
temporary fixed by binding the exceptions of indextonode, in a local copy of
the above operation (codeeditorbody)

v5.0.2(2) (version number was made 9/4-96)

27/3-96:

Fixed the bug:
recovery was not offered on fragment groups without fragmentforms

Added Search/Replace in the Edit menu of the property editor

1/4-96:

Fixed the bug:
When opening the second codeeditor on the same fragment form, 
and the ff has been changed in the first editor, the user is asked
whether to recover from the autosave file

Moved the groupFileMenu.open and performMenu.open to sif, 
in this way other tools like Frigg and Freja, can insert their 
own commands together with Sifs.
Take a copy these open bindings and adjust them.
This may be done differently in the future.
The same is done in siflight, compsif and usersif.

Added the following notifications to be used by Frigg:

ymersiflib.bet, fragmentBrowser:

     onAboutToCloseGroup:<
       (# fg: ^astInterface.fragmentGroup;
          OKtoClose,askSave: @boolean
            (* if OKtoClose the groupEditor is closed.
             * if askSave the user is prompted whether to save the group
             * else it is just saved (if necessary)
             *)
       enter fg[]
       do true->OKtoClose->askSave;
          INNER
       exit (OKtoClose,askSave)
       #);
     onGroupSaved:<
       (# fg: ^astInterface.fragmentGroup;
       enter fg[]
       do
          INNER
       #);
     onGroupCompiled:<
       (# fg: ^astInterface.fragmentGroup;
          OK: @boolean (* OK means no errors *)
       enter (fg[],OK)
       do
          INNER
       #);
     onGroupChecked:<
       (# fg: ^astInterface.fragmentGroup;
          OK: @boolean (* OK means no errors *)
       enter (fg[],OK)
       do
          INNER
       #);

2/4-96:

added onGroupClosed in ymersiflib (fragmentBrowser), 
which is called when sif closes a groupeditor

     onGroupClosed:<
       (# fg: ^astInterface.fragmentGroup
       enter fg[]
       do INNER
       #);

9/4-96:

cvs commit and install v5.0.2(2)

10/4-96:

Fixed the bug: Revert textediting does not reinstall the mps default 
error reporter. This gives problems during property editing.
Solution: a ref. to mps.errorReporter is kept in edenv.mpsErrorReporter.
After Revert textediting mps.errorReporter is reinstalled.

Fixed the bug: opening the property editor on an empty property list
crashes.

Fixed the bug: crashed when reopening a propertyeditor that was closed
via the System menu.

Fixed the bug: when entering an empty file name in the New dialogs the
editor crashed

Fixed the bug: when pressing a key in an empty siftexteditor the editor
crashes in onbeforechange

11/4-96:

commit and install v5.0.2(3)

11/4-96: 

added a star '*' in the Location field to indicate that a fg has been
touched

12/4-96:

reinstalled the mps errorreporter just before parsing the properties
to the prop ast

fixed the bug: enter textedit as 1. op in the editor - parse error 
revert textediting - undo - crash with ref. is none in doundo

fixed the bug: when the compiler saves a group and calls groupSaved this
is not propagated to onGroupSaved

tried to fix the EOS exception in the errorreporter, but could not reproduce
the error

commit and install v5.0.2(3)

theSemanticErrorViewer.bringtofront on semantic errors

fixed the bug: onGroupSaved is called the first time the fg is touched in 
sif

15/4-96: v5.0.2(4)

the dep.graph. is now traversed before calling the compiler.
or each file in the dg (that is open in sif)
it is checked if it was changed by another tool
If so compilation is not allowed and the user is told to leave sif

NB! I think that a groupeditor is opened for each fg in dp!!!!!
this must be changed!!!

commit and install v5.0.2(4)

>NB! I think that a groupeditor is opened for each fg in dp!!!!!
>this must be changed!!!
no my check was wrong udated and installed new version


16/4-96:

changed markAsChanged to extendMarkAsChanged in editorenvboby
(New.., New BETA prog etc.)
to bind exceptions, now it does not crash if the .ast file already
exists and is non-writable, but the "changedByOtherTool" check 
gives an alert! should not happen

allow danish characters in textediting, only disallow characters < ' '

commit textediting and installed new version


18/4: 

there is also a problem with closed fragment groups after compilation
if the user changes files that are NOT open in sif, because the
compiler for such files closes the fragment group and opens a 
new one (see control-controller: grouplist.insertGroup), 
this gives problems in the sourcebrowsers dependency graph
that still has references to the old fg.
to avoid crashes the user is now notified when any files in the DG has
been changed (whether open or not in sif) and compilation is 
prohibited, but we need to solve this problem soon!!

commited and installed v5.0.2(4)

v5.0.2(5) (version number was made 30/4-96)

19/4-96:
--------------------------------------------------------------------------
fixed the EOS error on text.get on the input text for the error reporter:

example:

ORIGIN '~beta/basiclib/v1.4/betaenv';
-- program: Descriptor --
(# selection: @integer do (IF (t.selection.first -> selected)>0 then selected -> theWindows.indexGet).hide if) #)

this caused the errorReporter to break down:


Date: Thu, 21 Mar 1996 04:19:19 +0100
From: Jesper Buus Nielsen <buus@daimi.aau.dk>
To: frigg@mjolner.dk
Subject: Automatic frigg error report

buus | SUN4S | rupee | Thu Mar 21 04:17:47 MET 1996 | 25828 | 
Description:
----------
Jeg var ved at texteditere noget der saa ca. saadan her ud:

Trying to parse: 5:  MainPart
<(# selected: @integer do (IF (textScrollList23.selection.first -> selected)>0 then selected -> theWindows.indexGet).hide if) #)
>

**** Exception processing
Attempt to read past end-of-stream
Error in text, which begins as follows:
'(# selected: @integer do (IF (textScrollList23.selection.first -> sele.....'

----------

Dumpfile:
----------
-rw-------   1 buus     buusin      4346 Mar 21 04:17 /a/home/scandium6/jersin/usr/buusin/brugerflade/SUN4Sfrigg.dump

Beta execution aborted: Stop is called.

Call chain: (sun4s)

  item <Stop#> in ~beta/basiclib/v1.4/betaenv
    -- BETAENV-~ in ~beta/basiclib/v1.4/betaenv
  item EOSerror#EOSerror#StreamException#<Exception#> in ~beta/basiclib/v1.4/betaenv
    -- BETAENV-~ in ~beta/basiclib/v1.4/betaenv
  item <TEXTGET-~> in ~beta/basiclib/v1.4/private/betaenvbody
    -- Get#Get# in ~beta/basiclib/v1.4/betaenv
  item <Get#>Get# in ~beta/basiclib/v1.4/betaenv
    -- Text#Stream# in ~beta/basiclib/v1.4/betaenv
  item <PARSEERRORREPORTBODY-~> in ~beta/mps/v5.0.1/private/astparser
    -- errorReport# in ~beta/mps/v5.0.1/astlevel
  item <errorReport#> in ~beta/mps/v5.0.1/astlevel
    -- parse# in ~beta/mps/v5.0.1/astlevel
  item <*> in ~beta/editor/v5.0.1/private/textediting
    -- * in ~beta/editor/v5.0.1/private/textediting
  item <*> in ~beta/editor/v5.0.1/private/textediting
    -- exitEditAndParseMode# in ~beta/editor/v5.0.1/private/textediting
  item <exitEditAndParseMode#> in ~beta/editor/v5.0.1/private/textediting

also the parser of the beta compiler gets confused:
eeess@fraxinus:~/beta/editor/v5.0.2> beta test/text2
Mjolner BETA System version 5.1.1(2) for SUN-4 Solaris 2.x (ELF linker format)
Target machine type sun4s
Building dependency graph for: 'test/text2' ...
Parsing: 'test/text2'
Parse errors 
#   4 
# **** ^
#  Expected symbols: else if [] ! ; ## (# -> [ . .%
 File "/a/home/quercus1/ess/beta/editor/v5.0.2/test/text2.bet"; Line 4

Parse errors in fragment : 
/a/home/quercus1/ess/beta/editor/v5.0.2/test/text2

WORKAROUND: in the code: put newlines in the input to the error reporter!!!
see textediting

this must be debugged in mps!

--------------------------------------------------------------------------

22/4-96:

Fixed bugs in backupTextFile, extendSaveBackup, save and makeNewTextFile
regarding disk access rights

25/4-96:

Save now tests if the textfile has been modified outside sif, 
if so the user is prompted for whether to overwrite or not

Every time the user calls save a .ast~ file is made before saving
(this has never worked!!)
The same is done with the textfile (has been so for a long time)
Notice that this is another strategy then emacs that only makes a 
~ file the first time the file is saved in the same session.

The jobfile change permission compiler error has been circumvented
in the following way:
before calling the compler sif deletes the jobfile if any, 
after compilation sif sets the permisions of the jobfile to a+w
this workaround should only be there until the next compiler version

key shortcut: Ctrl-G for Recompile

30/4-96:

committed and installed v5.0.2(5)

1/5-96

Now save is callled on all open and modifed fg's in the DG before calling
the compiler

committed and installed

2/5-96 

Fixed bug: double-click on yes in the Save all dialog crashed the editor
with ref. is none

commited and installed

6/5-96

Explicit close on promptforboolean in Save All, to avoid problems with
2 clicks on the OK button, will later be fixed in guienv.

Fixed the bug: when searching fragments for slots (Follow Link to Fragment)
no exceptions was bound on top.open on the body files, this caused problems
if the body file did not exist or had parse errors.

7/5-96

Making test and trace info available via menu when calling sif with -test 
argument.

Fixed the bug: dump with qualification error in updatebrowser if editing
properties while having a separate editor on that group. The problem was
that the group editor of the separate editor got an propertiesChanged event 
which made a call to updatebrowser, but in this case we do not have a 
browser!! Now updatebrowser tests for this.

8-9/5-96

The following notification is called if the user answers no to save
the changes: 

onGroupNotSaved:<
  # fg: ^astInterface.fragmentGroup enter fg[] do INNER #)


The following operation is added in order to make experiences wit
using emacs as text editor:

externalTextEdit:<
  (# textBefore,textAfter: ^text
  enter textBefore[]
  do INNER
  exit textAfter[]
  #)

When sif is called with -e as agurment, an extra menu element is
added to the Edit menu: 'External Textedit', with short cut Ctrl e.
When this command is activated the text in the current selection is
used as textBefore.  externalTextEdit is supposed to block sif
until the editing in emacs is finished, and textAfter should then contain
the new text.

As a side effect a texteditor update problem has been removed. 
When entering textediting on a sublist which includes the last element
of the list the text was not updated correctly. Similar after
revert textediting. Preliminary workaround: prettyprint some more :-)


The test for donecheck is removed when following semantic links.
This means that it is now possible to follow semantic links in 
files that are not semantically correct.


Fixed the bug: when using (Follow Link to SLOT)
no exceptions was bound on top.open on the origin files, this caused problems
if the origin file did not exist or had parse errors.


Changes on the fragment group level is now only reported to Freja when the 
group is open in Freja.


Fixed the bug: when opening a group file from freja, an error recovery
dialog appeared, which should not appear.


committed and installed v5.0.2(6)

10/5-96:

Improved the semantic link following, now it checks if the source of the
link is in a subtree of a semantic error, in that case that error is
reported.


11/5-96:

Hopefully fixed the pp.doresize error. I think it is a consequence of 
textfield.posToRowCol returning (0,0) on the known motif segmentation error.
(textediting.bet)

commited and installed 


15/5-96:

Fixed the bug.
If the user tries to "out comment" some code by putting a (* in the 
start of the texteditarea and a *) in the end, the comment is lossed.
For the time being a workaround is reported to the user:
Textedit the enclosing block.
(textediting.bet)

Added the rest of the external texteditpart, i.e. the start of am external 
texteditor (specified by $EDITOR) on a temporary file placed in /temp.
The name of the file is siftext$USER$TIME.bet.
Has been tested with emacs and vi. 
NB! only Unix.

emacs:

EDITOR must be set to e.g.
/usr/local/bin/emacsclient

and the following must be added to the .emacs file:

;;; sif

(server-start)

(defun my-server-edit ()
  (interactive)
  (server-edit)
  (server-edit))

; shourt cut for finishing the external text edit
(define-key global-map [?\C-e] 'my-server-edit)

(setq server-temp-file-regexp "/tmp/sif*")

Currently this feature is only available if sif is started with -e.
The external editing is activated by the Edit:External Textedit command (Ctrl-e)

We need a way to regret changes in emacs.

vi:

EDITOR must be set to e.g.
/usr/ucb/vi

commited and installed.

24/5-96:

Improved the test when following semantic links by making a copy of 
getGroup in codeeditorbody

committed and installed sif+: v5.1(0)

11/6-96:

. removed the annoying scroll caused by reselection 
  when reentering a texteditor (on enableTarget)
  side effect: now the selection is not very visible when reentering
  the texteditor, only the text cursor is blinking at selection.end
  The reselection should be done automatically by the texteditor, without
  scroll!
  this and other related things like scrollIntoView must be discussed in 
  the Lidskjalv forum

. removed the forced synchronization between codeeditors on the same ast
  now this is only done in the editor that Freja talks to.
  proev det Michael :-)

committed and installed sif+: v5.1(0) rev. 1.60

27/6-96: 

. Enabled ascii.sp short key for entering textediting mode again

. Added cut,copy,paste functionality to the comment editor  (codeviewer)

. Added cut,copy,paste functionality to textediting  (codeeditor)

. Disabled the Fill SLOT operations because of problems with compilation
  (codeeditormenus)

. Added at test for writepermmisions on the codedir before deleting the
  jobfile (compiler_unixbody)