v5.0.1(0)

14/2-96: 
Frozen version for dSA

v5.0.2(0)

14/2-96:
Fixed the bug: If the checker was activated by double-clicking it crashed 
after checking in follow semantic link if there were bugs in the fragment 
structure

this has been merged into v5.0.1 in the PC sync. process

v5.0.2(1)

15/3-96: 

Fixed the bug: 
insert new fragment form when fragment list is empty
=>ref is none

Fixed the bug: 
copy root in one property editor and paste in another one
=> ref is none              

22/3-96:

Fixed the bug: 
following semantic links into a fragment that is not checked may 
lead to an indexerror in indextonode in valuetoast in getnodeattribute in 
dclRef. 
temporary fixed by binding the exceptions of indextonode, in a local copy of
the above operation (codeeditorbody)

v5.0.2(2) (version number was made 9/4-96)

27/3-96:

Fixed the bug:
recovery was not offered on fragment groups without fragmentforms

Added Search/Replace in the Edit menu of the property editor

1/4-96:

Fixed the bug:
When opening the second codeeditor on the same fragment form, 
and the ff has been changed in the first editor, the user is asked
whether to recover from the autosave file

Moved the groupFileMenu.open and performMenu.open to sif, 
in this way other tools like Frigg and Freja, can insert their 
own commands together with Sifs.
Take a copy these open bindings and adjust them.
This may be done differently in the future.
The same is done in siflight, compsif and usersif.

Added the following notifications to be used by Frigg:

ymersiflib.bet, fragmentBrowser:

     onAboutToCloseGroup:<
       (# fg: ^astInterface.fragmentGroup;
          OKtoClose,askSave: @boolean
            (* if OKtoClose the groupEditor is closed.
             * if askSave the user is prompted whether to save the group
             * else it is just saved (if necessary)
             *)
       enter fg[]
       do true->OKtoClose->askSave;
          INNER
       exit (OKtoClose,askSave)
       #);
     onGroupSaved:<
       (# fg: ^astInterface.fragmentGroup;
       enter fg[]
       do
          INNER
       #);
     onGroupCompiled:<
       (# fg: ^astInterface.fragmentGroup;
          OK: @boolean (* OK means no errors *)
       enter (fg[],OK)
       do
          INNER
       #);
     onGroupChecked:<
       (# fg: ^astInterface.fragmentGroup;
          OK: @boolean (* OK means no errors *)
       enter (fg[],OK)
       do
          INNER
       #);

2/4-96:

added onGroupClosed in ymersiflib (fragmentBrowser), 
which is called when sif closes a groupeditor

     onGroupClosed:<
       (# fg: ^astInterface.fragmentGroup
       enter fg[]
       do INNER
       #);

9/4-96:

cvs commit and install v5.0.2(2)

10/4-96:

Fixed the bug: Revert textediting does not reinstall the mps default 
error reporter. This gives problems during property editing.
Solution: a ref. to mps.errorReporter is kept in edenv.mpsErrorReporter.
After Revert textediting mps.errorReporter is reinstalled.

Fixed the bug: opening the property editor on an empty property list
crashes.

Fixed the bug: crashed when reopening a propertyeditor that was closed
via the System menu.

Fixed the bug: when entering an empty file name in the New dialogs the
editor crashed

Fixed the bug: when pressing a key in an empty siftexteditor the editor
crashes in onbeforechange

11/4-96:

commit and install v5.0.2(3)

11/4-96: 

added a star '*' in the Location field to indicate that a fg has been
touched

12/4-96:

reinstalled the mps errorreporter just before parsing the properties
to the prop ast

fixed the bug: enter textedit as 1. op in the editor - parse error 
revert textediting - undo - crash with ref. is none in doundo

fixed the bug: when the compiler saves a group and calls groupSaved this
is not propagated to onGroupSaved

tried to fix the EOS exception in the errorreporter, but could not reproduce
the error

commit and install v5.0.2(3)

theSemanticErrorViewer.bringtofront on semantic errors

fixed the bug: onGroupSaved is called the first time the fg is touched in 
sif

15/4-96: v5.0.2(4)

the dep.graph. is now traversed before calling the compiler.
or each file in the dg (that is open in sif)
it is checked if it was changed by another tool
If so compilation is not allowed and the user is told to leave sif

NB! I think that a groupeditor is opened for each fg in dp!!!!!
this must be changed!!!

commit and install v5.0.2(4)

>NB! I think that a groupeditor is opened for each fg in dp!!!!!
>this must be changed!!!
no my check was wrong udated and installed new version


16/4-96:

changed markAsChanged to extendMarkAsChanged in editorenvboby
(New.., New BETA prog etc.)
to bind exceptions, now it does not crash if the .ast file already
exists and is non-writable, but the "changedByOtherTool" check 
gives an alert! should not happen

allow danish characters in textediting, only disallow characters < ' '

commit textediting and installed new version


18/4: 

there is also a problem with closed fragment groups after compilation
if the user changes files that are NOT open in sif, because the
compiler for such files closes the fragment group and opens a 
new one (see control-controller: grouplist.insertGroup), 
this gives problems in the sourcebrowsers dependency graph
that still has references to the old fg.
to avoid crashes the user is now notified when any files in the DG has
been changed (whether open or not in sif) and compilation is 
prohibited, but we need to solve this problem soon!!

commited and installed v5.0.2(4)

v5.0.2(5) (version number was made 30/4-96)

19/4-96:
--------------------------------------------------------------------------
fixed the EOS error on text.get on the input text for the error reporter:

example:

ORIGIN '~beta/basiclib/v1.4/betaenv';
-- program: Descriptor --
(# selection: @integer do (IF (t.selection.first -> selected)>0 then selected -> theWindows.indexGet).hide if) #)

this caused the errorReporter to break down:


Date: Thu, 21 Mar 1996 04:19:19 +0100
From: Jesper Buus Nielsen <buus@daimi.aau.dk>
To: frigg@mjolner.dk
Subject: Automatic frigg error report

buus | SUN4S | rupee | Thu Mar 21 04:17:47 MET 1996 | 25828 | 
Description:
----------
Jeg var ved at texteditere noget der saa ca. saadan her ud:

Trying to parse: 5:  MainPart
<(# selected: @integer do (IF (textScrollList23.selection.first -> selected)>0 then selected -> theWindows.indexGet).hide if) #)
>

**** Exception processing
Attempt to read past end-of-stream
Error in text, which begins as follows:
'(# selected: @integer do (IF (textScrollList23.selection.first -> sele.....'

----------

Dumpfile:
----------
-rw-------   1 buus     buusin      4346 Mar 21 04:17 /a/home/scandium6/jersin/usr/buusin/brugerflade/SUN4Sfrigg.dump

Beta execution aborted: Stop is called.

Call chain: (sun4s)

  item <Stop#> in ~beta/basiclib/v1.4/betaenv
    -- BETAENV-~ in ~beta/basiclib/v1.4/betaenv
  item EOSerror#EOSerror#StreamException#<Exception#> in ~beta/basiclib/v1.4/betaenv
    -- BETAENV-~ in ~beta/basiclib/v1.4/betaenv
  item <TEXTGET-~> in ~beta/basiclib/v1.4/private/betaenvbody
    -- Get#Get# in ~beta/basiclib/v1.4/betaenv
  item <Get#>Get# in ~beta/basiclib/v1.4/betaenv
    -- Text#Stream# in ~beta/basiclib/v1.4/betaenv
  item <PARSEERRORREPORTBODY-~> in ~beta/mps/v5.0.1/private/astparser
    -- errorReport# in ~beta/mps/v5.0.1/astlevel
  item <errorReport#> in ~beta/mps/v5.0.1/astlevel
    -- parse# in ~beta/mps/v5.0.1/astlevel
  item <*> in ~beta/editor/v5.0.1/private/textediting
    -- * in ~beta/editor/v5.0.1/private/textediting
  item <*> in ~beta/editor/v5.0.1/private/textediting
    -- exitEditAndParseMode# in ~beta/editor/v5.0.1/private/textediting
  item <exitEditAndParseMode#> in ~beta/editor/v5.0.1/private/textediting

also the parser of the beta compiler gets confused:
eeess@fraxinus:~/beta/editor/v5.0.2> beta test/text2
Mjolner BETA System version 5.1.1(2) for SUN-4 Solaris 2.x (ELF linker format)
Target machine type sun4s
Building dependency graph for: 'test/text2' ...
Parsing: 'test/text2'
Parse errors 
#   4 
# **** ^
#  Expected symbols: else if [] ! ; ## (# -> [ . .%
 File "/a/home/quercus1/ess/beta/editor/v5.0.2/test/text2.bet"; Line 4

Parse errors in fragment : 
/a/home/quercus1/ess/beta/editor/v5.0.2/test/text2

WORKAROUND: in the code: put newlines in the input to the error reporter!!!
see textediting

this must be debugged in mps!

--------------------------------------------------------------------------

22/4-96:

Fixed bugs in backupTextFile, extendSaveBackup, save and makeNewTextFile
regarding disk access rights

25/4-96:

Save now tests if the textfile has been modified outside sif, 
if so the user is prompted for whether to overwrite or not

Every time the user calls save a .ast~ file is made before saving
(this has never worked!!)
The same is done with the textfile (has been so for a long time)
Notice that this is another strategy then emacs that only makes a 
~ file the first time the file is saved in the same session.

The jobfile change permission compiler error has been circumvented
in the following way:
before calling the compler sif deletes the jobfile if any, 
after compilation sif sets the permisions of the jobfile to a+w
this workaround should only be there until the next compiler version

key shortcut: Ctrl-G for Recompile

30/4-96:

committed and installed v5.0.2(5)

1/5-96

Now save is callled on all open and modifed fg's in the DG before calling
the compiler

committed and installed

2/5-96 

Fixed bug: double-click on yes in the Save all dialog crashed the editor
with ref. is none

commited and installed

6/5-96

Explicit close on promptforboolean in Save All, to avoid problems with
2 clicks on the OK button, will later be fixed in guienv.

Fixed the bug: when searching fragments for slots (Follow Link to Fragment)
no exceptions was bound on top.open on the body files, this caused problems
if the body file did not exist or had parse errors.

7/5-96

Making test and trace info available via menu when calling sif with -test 
argument.

Fixed the bug: dump with qualification error in updatebrowser if editing
properties while having a separate editor on that group. The problem was
that the group editor of the separate editor got an propertiesChanged event 
which made a call to updatebrowser, but in this case we do not have a 
browser!! Now updatebrowser tests for this.

8-9/5-96

The following notification is called if the user answers no to save
the changes: 

onGroupNotSaved:<
  # fg: ^astInterface.fragmentGroup enter fg[] do INNER #)


The following operation is added in order to make experiences wit
using emacs as text editor:

externalTextEdit:<
  (# textBefore,textAfter: ^text
  enter textBefore[]
  do INNER
  exit textAfter[]
  #)

When sif is called with -e as agurment, an extra menu element is
added to the Edit menu: 'External Textedit', with short cut Ctrl e.
When this command is activated the text in the current selection is
used as textBefore.  externalTextEdit is supposed to block sif
until the editing in emacs is finished, and textAfter should then contain
the new text.

As a side effect a texteditor update problem has been removed. 
When entering textediting on a sublist which includes the last element
of the list the text was not updated correctly. Similar after
revert textediting. Preliminary workaround: prettyprint some more :-)


The test for donecheck is removed when following semantic links.
This means that it is now possible to follow semantic links in 
files that are not semantically correct.


Fixed the bug: when using (Follow Link to SLOT)
no exceptions was bound on top.open on the origin files, this caused problems
if the origin file did not exist or had parse errors.


Changes on the fragment group level is now only reported to Freja when the 
group is open in Freja.


Fixed the bug: when opening a group file from freja, an error recovery
dialog appeared, which should not appear.


committed and installed v5.0.2(6)

10/5-96:

Improved the semantic link following, now it checks if the source of the
link is in a subtree of a semantic error, in that case that error is
reported.


11/5-96:

Hopefully fixed the pp.doresize error. I think it is a consequence of 
textfield.posToRowCol returning (0,0) on the known motif segmentation error.
(textediting.bet)

commited and installed 


15/5-96:

Fixed the bug.
If the user tries to "out comment" some code by putting a (* in the 
start of the texteditarea and a *) in the end, the comment is lossed.
For the time being a workaround is reported to the user:
Textedit the enclosing block.
(textediting.bet)

Added the rest of the external texteditpart, i.e. the start of am external 
texteditor (specified by $EDITOR) on a temporary file placed in /temp.
The name of the file is siftext$USER$TIME.bet.
Has been tested with emacs and vi. 
NB! only Unix.

emacs:

EDITOR must be set to e.g.
/usr/local/bin/emacsclient

and the following must be added to the .emacs file:

;;; sif

(server-start)

(defun my-server-edit ()
  (interactive)
  (server-edit)
  (server-edit))

; shourt cut for finishing the external text edit
(define-key global-map [?\C-e] 'my-server-edit)

(setq server-temp-file-regexp "/tmp/sif*")

Currently this feature is only available if sif is started with -e.
The external editing is activated by the Edit:External Textedit command (Ctrl-e)

We need a way to regret changes in emacs.

vi:

EDITOR must be set to e.g.
/usr/ucb/vi

commited and installed.

24/5-96:

Improved the test when following semantic links by making a copy of 
getGroup in codeeditorbody

committed and installed sif+: v5.1(0)

11/6-96:

. removed the annoying scroll caused by reselection 
  when reentering a texteditor (on enableTarget)
  side effect: now the selection is not very visible when reentering
  the texteditor, only the text cursor is blinking at selection.end
  The reselection should be done automatically by the texteditor, without
  scroll!
  this and other related things like scrollIntoView must be discussed in 
  the Lidskjalv forum

. removed the forced synchronization between codeeditors on the same ast
  now this is only done in the editor that Freja talks to.
  proev det Michael :-)

committed and installed sif+: v5.1(0) rev. 1.60

27/6-96: 

. Enabled ascii.sp short key for entering textediting mode again
. Added cut,copy,paste functionality to the comment editor  (codeviewer)
. Added cut,copy,paste functionality to textediting  (codeeditor)
. Disabled the Fill SLOT operations because of problems with compilation
  (codeeditormenus)
. Added a test for writepermmisions on the codedir before deleting the
  jobfile (compiler_unixbody)

12/8-96:

. Corrected problems with semantic links and realOpen resulting in 
  duplicate buffers on the same AST
. Separate viewers now preserve the current abstraction level
. Following semantic links from subeditors outside the editor
  is now enabled, a new subeditor is simply created on destination.frag.root 
  consider only to open it on the enclosing pattern

13/8-96:

. Corrected the error in the propertyeditor that appeared when the property
  grammar was changed to use listZeros instead of listOnes.

error corretion branch: v5.1.1

23/10-96:

. Fixed the following error:
  Recompiling a fg that has been changed outside sif since the last 
  compilation makes sif crash, because the depencency-code
  will close the group and reopen it.
  Have introduced a reloadingNotification, where sif can disallow 
  reloading.

. If no changes in external texteditor, then do not parse

5/11-96:

. Now Re-check and Re-compile are independent
. When compiling, only the fg's in the DG is examined for nonterminals

6/11-96

. The \' parse error in ~beta/mps/private/astparser has been fixed
  there was 2 fixed repetition with length 100!
. When compiling af DG with old versions of ASTs the compiler did not
  catch the badFormat excetion in compactOpen, now it does.

installed new version.

7/11-9

. When recovering from an autosavefile, the autosavefile was deleted, 
  this is bad if sif crashes again, before the next save.
  Due to ymer, the restored fg, has to be saved on disk and thereby
  the autosavefile is deleted. This is not done now if the user
  wishes to recover upon opening (checkAutosaveFile), but if
  it happens after the fg has been opened, there is no way back
  because I have to save the fg and read it in again.
  (ymersiflib, codeeditor, groupeditorbody etc.)

. Operations for Freja in externalInterface

addProp:
  (#
     FG: ^astInterface.fragmentGroup;
     propName,propString: ^text;
     ifExists:<
       (# delete: @boolean
       do true->delete; INNER
       exit delete
       #)
   enter (FG[],propName[],propString[])
   <<SLOT externalInterfaceAddProp:DoPart>>
   #);
 deleteProp:
   (#
      FG: ^astInterface.fragmentGroup;
      propName,propString: ^text;
      notFound:< object
   enter (FG[],propName[],propString[])
   <<SLOT externalInterfaceDeleteProp:DoPart>>
   #)

13/11-96:

. When following link from SLOT to fragment form in the BODY hierarchy
  deeper than 1, an annoying "not found"-dialog box was popped up
  even though the fragment form was found. (codeviewer.searchbinding)

12-26/11-96:

. The new grammar initialization code is called (grammarInit) and the 
  exceptions are bound on grammarInit and grammarTable.find.

26/11-96

.  When there is no parser, no textediting is allowed, except on lexems
  just at in old days.

. If a subcomment of a list node is selected, cut would delete the entire 
  listnode same problem with textediting of a comment, is fixed now
  
. Changed cursorarrow movement to do the same as mouseclick (only started...)

1/12-12/12 96
. Added popup-menu with navigation and edit commands
. Started search command on ff, fg af project level
. Avoids now scrolling when detailing, but still need a better scrollintoview
. Found the getgroup error, is caused by textediting of e.g. remotes, 
  i.e. recursive constructors. The old solution of just using super
  as parsing syntactic category when editing constructors is wrong.
  it must also be tested which production lead to the selection.
  e.g. if y is selected in x.y, then the parsing syncatno is NOT 
  objectspecification, but only nameAppl, however the textediting area
  should be extended to x.y and this should be clear to the user

6/1-97
. search in lexem is now OK for ff, fg and project, 
  only thing that has to be finished is the previous command
  and to use it in the replace dialog
. the semantic error viewer has been generalized and another
  specialization has been made: search viewer.
  this is really a useful tool!
  it allows the user to browse in  search hits in a window like 
  the semantic error viewer
. after cut(Fragment)Form the next ff in the list (if it exists ) is selected 
  otherwise the previous is selected (if it exists)
. after cut of a list element in a list whose start is not visible
  the next list element (if exists) is scrolled into view, 
  the reason why this is necessary is that the whole list currently is
  reprettyprinted. However it would be nice if the selection was 
  centered (or even better: if the whole list not had to be reprettyprinted)
. now sif can be started with foo-body again
. cursor arrow navigation has been improved

9/1-97
. undo can now be repeated until the start of the editor session
  redo is also implemented now.
. added clear and redo to codeeditor.externalinterface
. corrected an error in astReplacedSequence, this notification from 
  insert/remove optionals did nok work when done in a subeditor
. now ^d will activate follow semantic link or follow link to fragmentform
  if a nameAppl is selected resp.
. navigation with arrow keys could go beoynd the subAST in a subeditor
. made userbetasif prepared for integration with the dynamic env. for beta.
  user menus can be added to separate codeeditors and workspace.
  the check for nonterminals when compiling in sif is now calling a
  'nonterminalAllowed' virtuel

10/1-97 commited and installed in ~beta/r4.0.1

10/1-97
. first "Browse hits" took the whole project in the first search if 
  cge was not none, even though Search area was set to Group.

13/1-96
. now Edit form name is called in case of name collisions when adding a
  new fragment form
. askBeforeTextediting and askBeforeTexteditingMessage have been introduced
  this allows freja to give a warning if the user wants to textedit 
  parts that imply rebuilding of some of the diagrams
  frejaInterface:
  (# ...
     askBeforeTextediting:< booleanValue;
     askBeforeTexteditingMessage:< (# msg: ^text do INNER exit msg[] #)
  #)
. fixed bug in reading of arguments (sif --trace did crash)
. fixed bug: deleteautosavefile if not writeable crashed

->16/1-97
. global replace (lexem) is now also ready, 'Previous' is still not implemented
  it is not hard to do.
  A 'Replace All' button would be nice, and also an extra search area: 
  'Selection'
  a problem with the old replace was detected: undo is not possible
  since the text og lexemtext was changed 
  is fixed in the global replace, but not in the local, must be done!
. the problem with textediting of parts of x.y.z is now solved, by extending
  the textediting area to enclosing nodes. 
  this means that the user is allowed to select 'integer' in 
  'x: @integer' and textedit it to 'real; y: boolean'
  However we have to get experience with this new way of doing it. 
  First of all I have to solve the following problem: when using a key
  stroke to enter textediting (including space) 
. Make descriptor SLOT on finalBinding did not work and had strance results.
  It was simply forgotten in the test for VirtualDecl, etc.
  In fact this operation is from before FinalDecl was added.
. fixed bug in externalinterface.addprop: if another include property
  existed, parse errors were introduced in the propertylist

17/1-97
. now the selection problem after textediting of x.y.z see above 
  has been fixed, but again, we have to get experiences with it.
  because the textediting area is extended, and sometimes it is much.
  perhaps a test on the size of the tree should be incorporated.

18/1-97 commited and installed in  ~beta/r4.0.1

Tue Jan 28 12:04:43 MET 1997: /jlk
----------------------------------

Changed the following filenames:

    fragmentformhandlerbody.bet        ffhandlerbody.bet
    fragmentgrouphandlerbody.bet       fghandlerbody.bet
    globalexternalinterfacebody.bet    globalexternalintbody.bet
    searchreplacedialog.bet            searchreplace.bet
    searchreplacedialogbody.bet        searchreplacebody.bet

27-30/1 97
commited and installed new version in  ~beta/r4.0.1

. fixed bugs in propertyeditor, did not handle listZero nonterminals well
  a problem remains: the parser does not put the syncatno in the listZero
  nonterminals! Ole has a solution to the generator
. fixed bug with undo of a sublist of length noOfsons, it only undid 1 
  element
. userbetasif now starts with only a separate code editor on the arguments:
  -hide foo-program
. deleteprop update, fixed. Again a lot of problems due to the 
  double representation of includes!
. textedit on numbers was disabled by mistake, and old bug with update
  of numbers does not exist anymore, 1 problem remains: you cannot undo
  editing of numbers, same problem as with old search in form
. when following a link from a subeditor to a nonvisible enclosing structure
  a new subeditor is opened
. disable compile if cfe is not a program form
. global search/replace, compile, check etc. is diablet if any textediting
  is going on, but more needs to be done, e.g. when closing windows, 
  using semantic browser, search browser etc.
. askbeforetextediting is now also called when starting external 
  textediting

31/1 97
. fixed the bug: when entering textediting on something that must be 
  reprettyprinted because it includes comments or contractions the
  initial selection in the texteditor was wrong
. fixed a bug introduced in the handling af listZeros (see 27-30/1 97)
  now listZero nodes are handled separately.
. fixed af bug in the askbeforetextediting dialog, the cancel caused 
  a crash when the textediting area was extended
. now the user does not have to click in the texteditor of the global
  search (and replace) dialog, the target is automatically set in the
  open of the dialog
. introduced the allowedKey hook in siftexteditor.onKeyDown. is currently
  used to prohibit use of backspace in subeditors and propertyeditors in Freja.
. introduced fragmentbrowesr.isActive update in subeditors and property editors
  because the allowedKey did not do the work

3/2 97
. allowedKey is not needed now, becuase isActive does the work :-)

r4.0.2 startet

19/2 97
. groupeditor.deleteprop did not work on non-include properties
. sif crashed during scan of DG as well as during compilation when
  *** Property "resource" has no value for "sun4s" property-exceptions
  was called
. 1. new beta prog or lib, 2. close, 3. new beta prog or lib with same name
  => crash, is now fixed, i.e. it does not crash, but due to the general
  fg close problem in the integrated tools, the new group is not created
. editorenvbodyprivate.newBetaProgOrLib: minor bug fixed:, when newBetaProgOrLib
  was called with an explicit name, noExt was not initialized resulting in 
  crash
. when deleting the whole content of a subeditor two subeditors on some 
  of the enclosing structures was created. Similarly when searching in 
  a subeditor, when the hit was inside the ast, but outside the subeditor.

25/2 97 commit and install v5.1(3)

9/4 97
. now shift click will extend the selection, introduced to circumvent the 
  drag and drop inconvenience 

r4.1/v5.2 startet

Michael Lassen: Thu Jul 10

   Made small changes in codeeditor to make sif compile after
   utils/timer was moved to guienv. Timer.activate is renamed to
   Timer.start, timer.pause is renamed to timer.stop.

3/9 97
. fixed bug in replace, did not alow _ (underscores)

12/9 97
. added charWidthType body for ppcmac and nti, because adaptive pp did not
  work
. added ppcmac in test for not writing "extending text editing area..."

13/9 97
. fixed the bug: following a semantic link to a nonexisting file crashed

22/9 97
. now it is possible to follow semantic links in a construct with semantic
  errors
. now Make Dopart Slot on a DoPart does not crash. However a misleading
  error message appears: slot 'name' already exists. This is due a wrong
  use of the exit parameter 'status' of setFatherNode.
. fixed the bug: ctrl E on NT and mac gives ref. is none

28/4-98
. now a user menu can be added to a subeditor too

2/6-98
. ff and fg notifications are now extracted form the codeeditor and
  groupeditor resp. and they are now ready to be moved to mps.
  NB! notifications are not sent to freja and frigg anymore!!
  - in usersif and userbetasif the new notifications are used, 
    however handleDoubleClick and onPopupButton are not.
    these notifications are special, since they must override the 
    corresponding notifications in the "real" editors.
  - refresh after fg operations have never worked, has been corrected now,
    a minor change in ymerPrivate was nescessary: the browser parameter
    to createGroupeditor (this is because the pattern var relational operations
    also test for origin equality)
. fixed some inconveniences with the semantic browser and the search browser
  - the semantic error viewer was recomputed before a recompile
  - sometimes files outside the dep. graph. was parsed
  - added new check box: show all hits, the coloring process (or rather the
    gui-selection of all hits) is sometime rather slow e.g. when using ISDN.
. now the fragment search and replace is called on Ctrl S and Ctrl R,
  however currently the hits are shown in the sourcebrowser.
. Ctrl H: Recheck
. Ctrl K: Abstract
. the search dialogs, the semantic error browser and search hit browser
  are not floating anymore

8/6-98
. moved notifications to mps (notifications.bet). 
  Now users can also add their own events, see usersif.

4/8-98
. TOBY: removed some freja specifics

1/9-98
. TOBY: added checkAutoSaveFile to external interface

aug.-sept. 98
. a lot of changes based on marius and miksens usability test

8/10-98
. corrected the bug: SLOTs:Make Attributes SLOT... and 
  SLOTs:Make Descriptor SLOT...
  was disabled due to former integration with freja
. an error in SLOTs:Make Attributes SLOT... that caused the compiler to  
  crash due to wrong ast was corrected. 
  Check whether SLOTs:Fill SLOT and SLOTs:Fill All SLOTs now work again
. added SLOTs:Create Implementation file... and 
  SLOTs:Select Implementation file..., that inserts the relevant
  ORIGIN and BODY properties. Currently the full paths are inserted

13/10-98
. Now relative paths are used in  SLOTs:Create Implementation file... and 
  SLOTs:Select Implementation file...

19/10-98
. textediting of consts is now handled via editAndParseText, i.e. via the
  parser (and not via editLexem that has its own use of getnumber)
  consequences: changed a number to a name is now possible and number
  exceptions are now handled by the checker

20/10-98
. recheck and recompile shortcuts did not work if current=last checked etc.

22/10-98
. corrected the bug: open mjolner on foo - open separate editor on foo - 
  change in separate editor - quit - then no save?-dialog appeared
  the reason was that 'touched' was not propagated to the other (first) editor.
  the notifications onTouched and onDetouched have been added to sifobserver
. minor correction on enabling the menu item reexecute
. corrected the bug: after SaveAs the text file got the extension .text
  instead of .bet (the reason was that fg.saveAs clears fg.defaultGrammar 
  which is used by fg.textFileName. This bug has been reported to the
  mps responsible)

M codeeditor.bet
M sifnotifications.bet
M ymersiflib.bet
M private/codeeditorbody.bet
M private/editorenvbody.bet
M private/externalinterfacebody.bet
M private/ffobserverbody.bet
M private/fgobserverbody.bet
M private/groupeditorbody.bet
M private/slotbody.bet
-------------------------------------------------------------------------------

23/10-98
. for each program started from mjolner the user will now be asked whether
  it should be killed when quitting mjolner
  This means that neither the programs nor mjolner will be "hanging" on exit.

M ymersiflib.bet
-------------------------------------------------------------------------------

27/10-98
. after 'Save As' the done check flag is cleared, in order to be sure that
  the semantic relations are rechecked
. before Reexecute and Recompile and execute, the user is asked whether
  to kill the current running application
. minor improvements to edit menu and infoView regarding textediting

M codeditor.bet
M ymersiflib.bet
M private/codeeditormenus.bet
M private/textediting.bet
A private/ymersiflibperformbody.bet

-------------------------------------------------------------------------------

30/10-98
. Edit the bug that the dialog: 'To edit comments edit the enclosing structure'
  appeared even though no comments were involved.

M ymersiflib.bet
M private/codeviewerbody.bet
-------------------------------------------------------------------------------

2-11/11 98

. Improved possibilities for paste, now any listelement kan replace 
  any other list element (of the same list category of course)
  Started investigation on allowing copy/paste between nameDcls and nameApls
. Added Paste Before/After in Edit and Popup menu
. Corrected the bug: Qualification error in parse text, when replacing
  an optional (e.g. PrefixOpt) with a comment.
  Detected via an automatic error report.
. Corrected the bug: Search in fragment group with no fragment forms
  caused a crash.
  Detected via an automatic error report.

M codeeditor.bet
M codeviewer.bet
M private/codeeditormenus.bet
M private/editorenvsearchbody.bet
M private/parsing.bet
M private/updatemenus.bet
M private/ymersiflibperformbody.bet

-------------------------------------------------------------------------------

17/11 98

. Enabling File:Print on windows, by using Lennerts code.
  This means that the contents of a codeditor in the sourcebrowser
  now is printed (only on windows!)
  This must later be used in a more general platform dependent
  solution

M codeviewer.bet
M ymersiflib.bet
M private/siftexteditor_X11body.bet
M private/siftexteditor_macbody.bet
M private/siftexteditor_ntibody.bet
-------------------------------------------------------------------------------

18/11 98
. Corrected the bug: under some circumstances deleteAutosaveFile could
  crash (despite test for file existence). Bound noSuchFileError
. Corrected the bug: specifying a nonexisting path in New BETA Program/Lib
  in Freja, caused the editor to crash (browser.cge was none)

M private/editorenvbody.bet
M private/globalexternalintbody.bet
-------------------------------------------------------------------------------

1/7-99:
-------------------------------------------------------------------------------
. Enabled Fragments:Cut Fragment Form again. Was disabled by gram.
  Still remaining: currentGroup.close.

6/7-99:
-------------------------------------------------------------------------------
. Introduced two notifications to sifnotifications:
    onEnterTextediting
    onExitTextediting
  To be used by e.g. freja, to disable editing commands.

M codeeditor.bet
M sifnotifications.bet
M private/codeeditorbody.bet
M private/ffobserverbody.bet
M private/textediting.bet

7-8/7 99:
-------------------------------------------------------------------------------
. (dsa99 error 100,120) 
  Bound exceptions on saveBackup in extendedSaveBackup 
. (dsa99 error 122) 
  Bound exceptions on saveAs in group.saveAs 
. (dsa99 error 317) 
  Bound exceptions on process.start in executeProgram 
. (dsa99 error 147 and 236,237) 
  Some bugs in cut and search due to an obsolete current focus.
  Could not find the bugs, but now setFocus selects the root when the
  node cannot be found, inorder to get a welldefined focus.  
. Due to the test: (if frejaExternalInterface=none then autosave if)
  autosave was not performed after fragmentgroup editing like insert/delete
  fragment form. This is an old test from when Freja was standAlone.
  In the integrated tool this does not work.
. A wish from gram: when using Ctrl-D on a nameDecl the right side of
  the declaration is detailed if it is a patternDeclaration.
  Same functionality is put on double-click. And in addition: 
  when double-clicking on something that not is a comment, has a semantic
  link etc. it is not longer collapsed, but it details the current selection
  one level. The latter I think is good for 'nervous' users like jlk :-)
. A wish from gram: when entering textediting on '...' the contraction is
  expanded first.

M codeviewer.bet
M ymersiflib.bet
M private/codeviewerbody.bet
M private/editorenvbody.bet
M private/groupeditorbody.bet
M private/siftexteditorbody.bet
M private/textediting.bet

16/9 99:
. When double-clicking on a nameAppl in a readonly editor, 
  the user is asked to saveAs, just like in the tools menu

M ymercall.bet
M ymersiflib.bet
M private/codeeditorbody.bet
M private/ymersiflibperformbody.bet

OLM:5/12/99:
----------------------
Fixed calls of isWarning and semanticErrorText to handle
dynamic compiler error messages.

5/1 00:
. Inserted contraction tests in textediting mode
  - Before parsing it is checked that the textual representation of contractions
    e.g. <<@4711:PatternDecl>>, is meaning full, i.e that the corresponding
    contractions (...) existed before entering textedit mode
  - It is not allowed to copy (the copy command in textedit mode) something
    that contains the textual representation of a contraction. However, the X
    mouse button copy cannot be avoided, but if this is pasted into another
    textediting session, it will be detected before parsing.

M private/codeeditorbody.bet
M private/textediting.bet

7/1 00:
. remove right button cursor
. now the textedit cursor is only shown in the relevant codeeditor

M private/codeeditorbody.bet

18/1 00: 
When a file is readonly, the frag.locked flag is now set to true.
This can be used by e.g. frigg, to avoid editing read only files.
In r5.2, a frag.isReadOnly flag should be made, as well as a
frag.touched flag.

M private/codeeditorbody.bet
M private/editorenvbody.bet

2/3 00:
When deleting everything in textediting resulting in a cut, 
the ff was not reprettyprinted.

M private/textediting.bet

9/3 00:
Moved local editor implementation of the code for following semantic 
links (declRef and virtDcl)to mps/utils/safesemanticlinks.bet.
It must be decided whether this safe implementation should
replace the mps implementation. In that case no changes
has to be made in betasematt.bet and the following two
operations can be avoided.

safeDclRef:
  (* like betasematt.declRef except that it does not crash if the
   * the semantic link is undefined, instead it returns NONE
   *)
  (# aplNode,dclNode: ^astInterface.ast
  enter aplNode[]
  do ((1,aplNode[])->safeGetNodeAttribute)->dclNode[]; 
  exit dclNode[]
  #);
safeVirtDcl:
   (* like betasematt.virtDecl except that it does not crash if the
   * the semantic link is undefined, instead it returns NONE
   *)
 (# aplNode,dclNode: ^astInterface.ast; f: ^astInterface.ast
  enter aplNode[]
  do
     aplNode.father->f[];
     f.father->f[];
     ((1,f[])->safeGetNodeAttribute)->dclNode[]
  exit dclNode[]
  #)  

To see the difference between the implementations, 
follow the semantic links in 
editor/private/codeditorbody-hasSemanticLinks:

(if true then
    theNameApl[]->mps.safeDclRef->node[]
 else
    'hasSemanticLinks: calling old semantic links code (dclRef)'->putLine;
    theNameApl.dclRef->node[]
if);
 
M editor/private/codeditorbody.bet
A mps/utils/safesemanticlinks.bet

7/4-00
. defensive programming in editlexem to avoid qua error

M editor/private/codeeditorbody.bet

14/4-00
. in all astChangedEvents it is now checked whether cs still is valid,
  if not it is set to editorRoot.

M editor/private/codeeditorbody.bet

14/4-00
. in all astChangedEvents it is now checked whether cs still is valid,
  if not it is set to editorRoot.

18/7-00
. when undoing after compilation without further editing before recompilation
  nothing happened during compilation because the 'touched' variable
  had a wrong value (negative, because resetGroupToch was called twice).
  And when quitting the undo did not have effect.
. resizing a search dialog dialog to minimum, caused division by zero
  in rescale
. is now forcing save-dialog on quit caused by astOverflow when the
  violating operation was the first one, in order to force ast gc
  (if the user answers yes in the save-dialog, maybe this dialog should
  be avoided for the file with the overflown ast)
. search for applications is now enabled also when a nameAppl has
  been selected before activating the search and replace dialogs
  
M private/groupeditorbody.bet
M private/searchreplacebody.bet
M private/delete.bet
M private/slotbody.bet
M private/textediting.bet
M private/editorenvsearchbody.bet

26/7-00

. the search and replace dialogs are now reused on subsequent searches
. a qualification error was found in editlexem (used cs.node instead of node)
. added 'Replace all' button to the replace dialog.
  it is now possible to change all applications of af name
  including the declaration
. remaining problem: sourcebrowser.selectFramentform adds a new groupeditor 
  if an existing one does not contain any forms with the effect that 
  two groupeditors with the same browserid exist in groupeditorlist!

M searchreplace.bet
M ymercall.bet
M ymersiflib.bet
M private/editorenvsearchbody.bet
M private/groupeditorbody.bet
M private/searchreplacebody.bet
M private/ymersiflibsearchbody.bet

28/7-00

. the selectFragmentForm problem (see 26/7) has been solved i sourcebrowser:
  it called  edenv.groupEditorList.createGroupEditor instead of
  findOrCreateGroupEditor, and thereby creating an extra groupeditor
. added 'yes-no-cancel-yes to all-no to all'-dilog til 
  'Show search hits' and 'Replace All' when asking for checking of files
  in projects. Major improvement!

M search.bet
M private/ymersiflibsearchbody.bet
A moreprompts.bet
A private/morepromptsbody.bet

18/10-00

. fixed: index error on parsing more than 50 list elements
  (the size of astlist repetition) with extending the repetition.
  this is done other places already, but in not in listSubstituteBody

M private/parsing.bet

23/11-00

. fixed hasProgramFG ref none error by defensive programming
  ymerbrowserInterface.cge[] can  be none even if 
  interface.currentGroupEditor is not.
  Occurs if opening '+' in Recent Files and '+' of some file in 
  Recent Files as the first thing in a mjolner tool session

. fixed the outstanding problem from 18/1 00: 
"When a file is readonly, the frag.locked flag is now set to true.
This can be used by e.g. frigg, to avoid editing read only files.
In r5.2, a frag.isReadOnly flag should be made, as well as a
frag.touched flag."

M ymersiflib.bet
M private/codeeditorbody.bet

5/3-01
- Allowed ctrl-a, ctrl-e, ctrl-n and ctrl-p in textedtingmode in order 
  to be able to use them for textediting.
  But now the corresponding menu entrances are not disabled(grayed)
- Disabled the binding og Home and End

M codeeditor.bet
M ymersiflib.bet
M private/codeeditormenus.bet
M private/siftexteditorbody.bet

15/3-01
M ymersiflib.bet
M private/compiler.bet
- fixed bug report 3.
  The parameter to simplecheck (fg) was always none! Called by freja when 
  editing an aggregation (right-click on the aggregation) that has been changed 
  by sif. Due to restructuring when introducing toolbar last semester.

  item <DGchangedOutside#> in ~beta/editor/ymersiflib
  item <*>doCommand# in ~beta/editor/private/compiler
  item *<doCommand#> in ~beta/editor/ymersiflib
  item <COMPILERCHECK-~> in ~beta/editor/private/compiler
  item <check#> in ~beta/editor/ymersiflib
  item <simplecheck#>simplecheck# in ~beta/editor/private/globalexternalintbody
  item simplecheck#<simplecheck#> in ~beta/editor/sifinterface
  item <check#>check# in ~beta/freja/private/externalinterfacebody
  item check#<check#> in ~beta/freja/frejaenv
  item <callChecker#>callChecker# in ~beta/freja/frejaenv
  item callChecker#<callChecker#> in ~beta/gpp/gppinterface
  item <notFound#>notFound#notification#exception# in ~beta/gpp/private/aggregationconnbody
  item notFound#<notFound#>notification#exception# in ~beta/containers/container
  item notFound#notFound#<notification#>exception# in ~beta/basiclib/betaenv
  item notFound#notFound#notification#<exception#> in ~beta/basiclib/betaenv
  item <*> in ~beta/containers/private/setsBody
  item *<find#>find# in ~beta/containers/private/setsBody
  item *find#<find#> in ~beta/containers/private/containerBody
  item <edit#>edit#edit# in ~beta/gpp/private/aggregationconnbody
  item edit#<edit#>edit# in ~beta/gpp/private/associationconnbody
  item edit#edit#<edit#> in ~beta/gpp/gppinterface
  item <onSelect#>select#event# in ~beta/gpp/private/aggregationconnbody

Jeg lavede en reference i UML-diagrammet til static. Da jeg lavede den tilbage til dynamic crashede det... 

18/5-01 ESS
-------------------------------------------------------------------------------
. added print of compiler version, runtime system version should also be added
M sifinterface.bet
M ymercall.bet
M ymersiflib.bet
M compiler.bet

01/06-01 ESS
-------------------------------------------------------------------------------
. binding af the texteditMode virtual called by the betaindenter removed 
  problems with prettyprint and slow update after pressing return in 
  structureediting mode.
M codeviewer.bet
M private/siftexteditorbody.bet


01/06-01 MBE
-------------------------------------------------------------------------------
. added virtual texteditMode to codeTextField. This is used in the 
  eventhandler to prevent the code from beeing executes when not in text-
  editmode. 

M codeTextField.bet
M betaTextField.bet

06/07-2001 MBE
-------------------------------------------------------------------------------

. added patterns cheap_next_line and cheap_previous_line to acheive better
  performance. All calls in the inden_line pattern to next_line/previous_line
  are replaced with the cheap ones. 

M betaTextField.bet
M codeTextField.bet
M private/codePattern.bet



16/07-2001 Mads Brogger Enevoldsen
-------------------------------------------------------------------------------

 private/codePattern.bet replaced with private/codeTextFieldbody.bet
 private/codeRegexps.bet replaced with private/codeTextFieldRegexps.bet

. An internal navigation system made. (globalRow,globalCol) describes
  the current position in the textField. globalFresh (boolean) tells if
  globalText contains the contents of the textField. 
  
M betaTextField.bet
M codeTextField.bet
M private/betaTextFieldbody.bet
M private/codeTextFieldbody.bet


