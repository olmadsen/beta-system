ORIGIN '~beta/basiclib/v1.4/basicsystemenv';
INCLUDE '~beta/guienv/v1.3/guienvsystemenv'
        '~beta/guienv/v1.3/utils/simplemenu'
        '~beta/sourcebrowser/v0.1/ymer';
-- program: Descriptor --
systemenv
  (#
     fragmentBrowser: @ymerApplication
       (#
          ymerBrowserWindow:: 
            (#
               eventhandler::  (#  #);
               open::  (#  #);
               theSifTextEditor: ^sifTextEditor;
               theFormEditor: ^theSifTextEditor.codeViewerType;
               formEditorExists:
                 (# exists: @boolean
                 do
                    browser.getFragmentFormEditor->theSifTextEditor[];
                    (if theSifTextEditor[] <> none then
                        (if theSifTextEditor.sifViewer[] <> none then
                            theSifTextEditor.sifViewer[]->theFormEditor[];
                            true->exists;
                            INNER formEditorExists
                        if)
                    if)
                 exit exists
                 #);
               menubarType:: 
                 (#
                    Edit: @simplemenu
                      (#
                         eventHandler::< 
                           (#
                              onSelect::< 
                                (# 
                                do
                                (* (if formEditorExists then
                                 'menu enable does not work!!'->putLine; enable
                                 else
                                 'menu disable does not work!!'->putLine; disable
                                 if)*) 
                                #)
                           #);
                         iUndo: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do theFormEditor.askUndoPermission->value
                                     #)
                                #);
                              onSelect::  (#  do theFormEditor.doUndo #)
                           #);
                         iCut: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect::  (#  do theFormEditor.doCut;  #)
                           #);
                         iCopy: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect::  (#  do theFormEditor.doCopy;  #)
                           #);
                         iPaste: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do theFormEditor.askPastePermission->value
                                     #)
                                #);
                              onSelect::  (#  do theFormEditor.doPaste #)
                           #);
                         iTextedit: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do
                                        (if theFormEditor.askTextEditMode then
                                            'Parse Text'->THIS(item).name
                                         else
                                            'Edit Text'->THIS(item).name
                                        if);
                                        true->value
                                     #)
                                #);
                              onSelect:: 
                                (# 
                                do
                                   (if theFormEditor.askTextEditMode then
                                       theFormEditor.doParseText
                                    else
                                       theFormEditor.doTextEdit
                                   if);
                                   
                                #)
                           #);
                         iRevertTextEdit: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do theFormEditor.askTexteditMode->value
                                     #)
                                #);
                              onSelect:: 
                                (#  do theFormEditor.doRevertTextEdit;  #)
                           #);
                         iShowTexteditCommands: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do theFormEditor.askTexteditMode->value
                                     #)
                                #);
                              onSelect:: 
                                (# 
                                do theFormEditor.doShowTexteditCommands; 
                                #)
                           #);
                         iInsertBefore: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do
                                        theFormEditor.askInsertPermission->value
                                     #)
                                #);
                              onSelect:: 
                                (#  do theFormEditor.doInsertBefore #)
                           #);
                         iInsertAfter: @item
                           (#
                              onStatus:: 
                                (# 
                                do
                                   formEditorExists
                                     (# 
                                     do
                                        theFormEditor.askInsertPermission->value
                                     #)
                                #);
                              onSelect:: 
                                (#  do theFormEditor.doInsertAfter #)
                           #);
                         iRemoveOptionals: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect:: 
                                (#  do theFormEditor.doRemoveOptionals #)
                           #);
                         iShowOptionals: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect:: 
                                (#  do theFormEditor.doShowOptionals #)
                           #);
                         open:: 
                           (# 
                           do
                              ('Undo','z')->iUndo.newkey;
                              newSeparator;
                              ('Cut','x')->iCut.newkey;
                              ('Copy','c')->iCopy.newKey;
                              ('Paste','v')->iPaste.newKey;
                              newSeparator;
                              ('Textedit','t')->iTextEdit.newKey;
                              'Revert Textedit'->iRevertTextEdit.new;
                              'Show Textedit commands'
                                ->iShowTextEditCommands.new;
                              newSeparator;
                              ('Insert Before','b')->iInsertBefore.newKey;
                              ('Insert After','a')->iInsertAfter.newKey;
                              newSeparator;
                              ('Remove Optionals','r')->iRemoveOptionals.newKey;
                              ('Show Optionals','s')->iShowOptionals.newKey
                           #);
                         
                      #);
                    View: @simplemenu
                      (#
                         eventHandler::< 
                           (#
                              onSelect::< 
                                (# 
                                do
                                (* (if formEditorExists then
                                 'menu enable does not work!!'->putLine; enable
                                 else
                                 'menu disable does not work!!'->putLine; disable
                                 if)*) 
                                #)
                           #);
                         iAbstract: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect::  (#  do theFormEditor.doAbstract #)
                           #);
                         iAbstractRecursively: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect:: 
                                (# 
                                do theFormEditor.doAbstractRecursively; 
                                #)
                           #);
                         iOverview: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect:: 
                                (#  do theFormEditor.doOverview;  #)
                           #);
                         iDetail: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect::  (#  do theFormEditor.doDetail #)
                           #);
                         iDetailRecursively: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect:: 
                                (# 
                                do theFormEditor.doDetailRecursively; 
                                #)
                           #);
                         iReprettyprint: @item
                           (#
                              onStatus::  (#  do formEditorExists->value #);
                              onSelect:: 
                                (#  do theFormEditor.doReprettyprint;  #)
                           #);
                         open:: 
                           (# 
                           do
                              'Abstract'->iAbstract.new;
                              'Astract Recursively'->iAbstractRecursively.new;
                              ('Overview','o')->iOverview.newkey;
                              ('Detail','d')->iDetail.newkey;
                              'Detail Recursively'->iDetailRecursively.new;
                              newSeparator;
                              ('Reprettyprint','p')->iReprettyprint.newKey;
                              
                           #);
                         
                      #);
                    open::  (#  do Edit.new; View.new #)
                 #)
            #);
          init::  (#  #);
          
       #);
     setWindowEnv::  (#  do fragmentBrowser[]->theWindowEnv[] #)
  do
  (*(if noOfArguments<>2 then
   *    'ERROR: Illegal number of arguments'->screen.putline;
   *    (normal,'Usage: ymer machineType')->stop
   *  else
   *    2->arguments->*) fragmentBrowser.init (*if)*)
  #)  

