ORIGIN '~beta/basiclib/betaenv';
INCLUDE 'qStdBetaParser';
---LIB:attributes---
qStdBetaChecker: parseStdBetaModule
  (# StdBetaModule::
       (# setUpOrigin::
            (#
            do 'StdBetaModule:setUpOrigin:'->dumpT; moduleName.doPT -> dumpTN;
               origin[] -> frags.setUpOrigin;
               true -> done
            #);
       #);
     BetaFragments::<
       (# setUpOrigin::(#do 'BetaFragments:setUpOrigin'->traceCheckN #);
          check::
            (# 
            do (*'BetaFragments:check:'->traceCheckN;*)
            #)
       #);
     AttFrag::<
       (# setUpOrigin::(#do 'AttFrag:setUpOrigin'->traceCheckN #);
          check::
            (#
            do (*'AttFrag:check:'->traceCheckN;*)
            #);
       #);
     ObjDescFrag::<
       (# setUpOrigin::(#do 'ObjDescFrag:setUpOrigin'->traceCheckN #);
          check::
            (#
            do (*'ObjDescFrag:check:'->traceCheckN;*)
            #);
       #);
     DoPartFrag::<
       (# setUpOrigin::(#do 'DoPartFrag:setUpOrigin'->traceCheckN #);
          check::
            (#
            do (*'DoPartFrag:check:'->traceCheckN;*)
            #);
       #);
     Attributes::<
       (# setUpOrigin::
            (#
            do 'Attributes:setUpOrigin'->traceCheckN; 
               (if false then doPT -> putHeadN if)
            #);
          check::
            (#
            do (*'Attributes:check:'->traceCheckN;*)
            #);
          localSearch::
            (#
            do (*'**** Attributes.localSearch:'->traceCheck; 
                * NA.T[]->traceCheckN;
                *)
               loop:
                 scanSons
                 (#
                 do NA[] -> current.localSearch -> dcl[];
                    (if dcl[] <> none then
                        leave Loop
                    if)
                 #)
            #)
       #);
     AttSlot::
       (# setUpOrigin::
            (#
            do 'AttSlot:setUpOrigin:'->traceCheck; doPT -> traceCheckN
            #);
       #);
     ObjDescSlot::
       (# setUpOrigin::
            (#
            do 'ObjDescSlot:setUpOrigin:'->traceCheck; doPT -> traceCheckN;
               scanBindings
               (#
               do origin[] -> current.setUpOrigin
               #)
            #);
       #);
     DoPartSlot::
       (# setUpOrigin::
            (#
            do 'DoPartSlot:setUpOrigin:'->traceCheck; doPT -> traceCheckN
            #);
       #);
     BetaDecl::<
       (# setUpOrigin::
            (#
            do this(BetaDecl)[] -> NS.addDclRef;
            #);
          theDesc:
            (# aDesc:  ^ObjectDesc
            do IT.theDesc -> aDesc[]
            exit aDesc[]
            #);
          localSearch::
            (#
            do NA[] -> NS.localSearch -> dcl[]
            #);
       #);
     NameDecls::
       (# addDclRef:
            (# dcl: ^BetaDecl; ND: ^BetaNameDecl
            enter dcl[]
            do scanSons(#do dcl[] -> (current[]->ND[]).theDcl[] #)
            #);
          localSearch::
            (#
            do loop:
                 scanSons
                 (#
                 do (if (NA[]->current.localSearch->dcl[]) <> none then
                        leave loop
            if)#)#)
       #);
     BetaNameDecl::
       (# localSearch::
            (#
            do (if NA.T[] -> N.T.equalNCS then
                   '**** found: ' -> traceCheck; NA.T[] -> traceCheckN;
                   (if theDcl[] = none then
                       '!!!! theDcl is none'->dumpTN;
                   if);
                   theDcl[] -> dcl[];
               if)
            #);
          theDcl: ^BetaDecl
       #);
     StaticItem::<
       (# check::
            (#
            do 'StaticItem:check:'->traceCheck; doPT -> traceCheckN;
            #);
          theDesc::
            (#
            do OS.theDesc -> aDesc[]
            #)
       #);
     DynamicItem::<
       (# check::
            (#
            do 'DynamicItem:check:'->traceCheck; doPT -> traceCheckN;
            #);
          theDesc::
            (#
            do OS.theDesc -> aDesc[]
            #)
       #);
     BetaPattern::<
       (# check::
            (#
            do 'BetaPattern:check:'->traceCheckN;
            #);
          theDesc:: (# do OD[] -> aDesc[] #);
       #);
     ObjectDesc::<
       (# setUpOrigin::
            (#
            do (*'ObjectDesc:setUpOrigin'->traceCheck; label -> traceCheckN; *)
               origin[] -> sup.setupOrigin; 
               this(ObjectDesc)[] -> att.setUpOrigin;
               this(ObjectDesc)[] -> acp.setUpOrigin;
               true -> done;
            #);
          check::
            (#
            do (*'ObjectDesc:check:'->traceCheckN;*)
            #);
          theDesc::
            (#
            do 'ObjectDesc:theDesc:'->traceCheck; doPT -> putHeadN;
               this(ObjectDesc)[] -> aDesc[]
            #);
          scanDecls:
            (#
            do (* remember labels and forImpIndex *)
               att.scanSons
               (#
               do
               #)
            #);
          localSearch::
            (#
            do NA[] -> att.localSearch -> dcl[];
               (* search super *)
            #);
          search:
            (# NA: ^BetaName; dcl:  ^BetaDecl
            enter NA[]
            do (*'ObjDesc:Search:' -> traceCheckN;*)
               (if NA.T.length > 0 then 
                   (if false then
                       '**** Search:' -> traceCheck; NA.T[] -> traceCheckN;
                       '**   in:' -> traceCheckN;
                       doPT -> traceCheckN;
                   if);
                   NA[] -> localSearch -> dcl[];
                   (if dcl[] = none then
                       (if origin[] <> none then
                           NA[] -> origin.search -> dcl[];
                       if);
               if)if)
            exit dcl[]
            #);
       #);
     ActionPart::<
       (# check::
            (#
            do (*'ActionPart:check:'->traceCheckN;*)
              (* enterP.check;
               imps.check;
               exitP.check*)
            #)
       #);
     Imperatives::<
       (# check::
            (#
            do (*'Imperatives:check:'->traceCheckN;*)
            #);
       #);
     IfImp::<
       (# check::
            (#
            do (*'IfImp:check:'->traceCheckN;*)
            #)
       #);
     PatternDen::<
       (# check::
            (#
            do 'PatternDen:check:'->traceCheck; doPT -> traceCheckN;
            #);
          theDesc::
            (#
            do 'PatternDen:theDesc:'->dumpT;AD.doPT -> dumpTN;
               AD.theDesc -> aDesc[]
            #);
       #);
     NameApl::<
       (# check::
            (# dcl: ^BetaDecl
            do 'NameApl:check:'->traceCheck; doPT->traceCheckN;
               (if N.T.length > 0 then 
                   (if false then
                       '**** AD:Search:'->traceCheck; T[]->traceCheckN;
                   if);
                   (if origin[] <> none then
                       N[] -> origin.search -> dcl[] -> ATd[];
                       (if dcl[] = none then
                           '**** did not find: ' -> traceCheck;
                           N.T[] -> traceCheckN;
                           father.father.father.father.doPT -> dumpTN;
                           (if origin[] = none then
                               '**   NameApl:origin is none'->dumpTN
                            else
                               origin.dopt -> putHeadN
                       if)if)
                    else
                       'empty'->traceCheckN
               if)if);
               true -> done
            #);
          theDesc::
            (#
            do '**** theDesc:ATd:'->dumpT; 
               (if ATd[] <> none then 
                   ATd.dopt->putHeadN; 
                   ATd.theDesc -> aDesc[] 
               if)
            #);
          ATd: ^BetaDecl
       #);
     Remote::<
       (# setUpOrigin::
            (#
            do 'Remote:setUpOrigin:'->traceCheck; dopt -> dumpTN;
            #);
          Check::
            (# predDesc: ^ObjectDesc
            do 'Remote:check:'->traceCheck; dopt -> dumpTN;
               scanSons
               (# AD: ^AttributeDenotation
               do current.doPT -> dumpTN;
                  (if not isFirst then
                      predDesc[] -> current.setUpOrigin
                  if);
                  (current[]->AD[]).check;
                  AD.theDesc -> predDesc[]
               #);

            #);
       #);
     BetaName::<
       (# setUpOrigin::
            (#
            do (if origin[] = none then
                   'Name:origin is none:'->traceCheck; T[]->traceCheckN
               if)
            #);
          check::
            (# 
            do (*'BetaName:check:'->traceCheck;*)
            #)
       #);
              
  do (if doTrace then 
         '**** StdBetaChecker: '->puttext; newline;
         '**** topModule:' -> dumpTN; 
         (if topModule[] <> none then
             topModule.doPT -> putheadN;
             '------'->dumpTN
         if);
     if);
     topModule.setUpOrigin;
     topModule.check;
  #)
