ORIGIN '~beta/basiclib/betaenv';
INCLUDE 'qStdBetaParser';
---LIB:attributes---
qStdBetaChecker: parseStdBetaModule
  (# BetaFragments::<
       (# setUpOrigin::(#do 'BetaFragments:setUpOrigin'->traceCheckN #);
          check::
            (# 
            do (*'BetaFragments:check:'->traceCheckN;*)
            #)
       #);
     AttFrag::<
       (#  setUpOrigin::(#do 'AttFrag:setUpOrigin'->traceCheckN #);
          check::
            (#
            do (*'AttFrag:check:'->traceCheckN;*)
            #);
       #);
     Attributes::<
       (# setUpOrigin::
            (#
            do 'Attributes:setUpOrigin'->traceCheckN; 
               (if false then doPT -> putHeadN if)
            #);
          check::
            (#
            do (*'Attributes:check:'->traceCheckN;*)
            #);
          localSearch::
            (#
            do (*'**** Attributes.localSearch:'->traceCheck; 
                * NA.T[]->traceCheckN;
                *)
               loop:
                 scanSons
                 (#
                 do NA[] -> current.localSearch -> dcl[];
                    (if dcl[] <> none then
                        leave Loop
                    if)
                 #)
            #)
       #);
     AttSlot::
       (# setUpOrigin::
            (#
            do 'AttSlot:setUpOrigin:'->traceCheck; doPT -> traceCheckN
            #);
       #);
     BetaDecl::<
       (# check::
            (#
            do this(BetaDecl)[] -> NS.addDclRef;
            #);
          localSearch::
            (#
            do NA[] -> NS.localSearch -> dcl[]
            #);
       #);
     NameDecls::
       (# addDclRef:
            (# dcl: ^BetaDecl; ND: ^BetaNameDecl
            enter dcl[]
            do scanSons(#do dcl[] -> (current[]->ND[]).theDcl[] #)
            #);
          localSearch::
            (#
            do loop:
                 scanSons
                 (#
                 do (if (NA[]->current.localSearch->dcl[]) <> none then
                        leave loop
            if)#)#)
       #);
     BetaNameDecl::
       (# localSearch::
            (#
            do (if NA.T[] -> N.T.equalNCS then
                   '**** found: ' -> traceCheck; NA.T[] -> traceCheckN;
                   theDcl[] -> dcl[];
               if)
            #);
          theDcl: ^BetaDecl
       #);
     StaticItem::<
       (# check::
            (#
            do (*'StaticItem:check:'->traceCheck; doPT -> traceCheckN;*)
            #)
       #);
     BetaPattern::<
       (# check::
            (#
            do (*'BetaPattern:check:'->traceCheckN;*)
            #);
       #);
     ObjectDesc::<
       (# setUpOrigin::
            (#
            do (*'ObjectDesc:setUpOrigin'->traceCheck; label -> traceCheckN; *)
               origin[] -> sup.setupOrigin; 
               this(ObjectDesc)[] -> att.setUpOrigin;
               this(ObjectDesc)[] -> acp.setUpOrigin;
               true -> done;
            #);
          check::
            (#
            do (*'ObjectDesc:check:'->traceCheckN;*)
            #);
          scanDecls:
            (#
            do (* remember lables of forImpIndex *)
               att.scanSons
               (#
               do
               #)
            #);
          localSearch::
            (#
            do NA[] -> att.localSearch -> dcl[];
               (* search super *)
            #);
          search:
            (# NA: ^BetaName; dcl:  ^BetaDecl
            enter NA[]
            do (*'ObjDesc:Search:' -> traceCheckN;*)
               (if NA.T.length > 0 then 
                   (if false then
                       '**** Search:' -> traceCheck; NA.T[] -> traceCheckN;
                       '**   in:' -> traceCheckN;
                       doPT -> traceCheckN;
                   if);
                   NA[] -> localSearch -> dcl[];
                   (if dcl[] = none then
                       (if origin[] <> none then
                           NA[] -> origin.search -> dcl[];
                       if);
                       (if dcl[] = none then
                           '**** did not find: ' -> traceCheck;
                           NA.T[] -> traceCheckN;
               if)if)if)
            exit dcl[]
            #);
       #);
     ActionPart::<
       (# check::
            (#
            do (*'ActionPart:check:'->traceCheckN;*)
              (* enterP.check;
               imps.check;
               exitP.check*)
            #)
       #);
     Imperatives::<
       (# check::
            (#
            do (*'Imperatives:check:'->traceCheckN;*)
            #);
       #);
     IfImp::<
       (# check::
            (#
            do (*'IfImp:check:'->traceCheckN;*)
            #)
       #);
     PatternDen::<
       (# check::
            (#
            do (*'PatternDen:check:'->traceCheck; doPT -> traceCheckN;*)
            #)
       #);
     NameApl::<
       (# check::
            (#
            do (*'NameApl:check:'->traceCheck; doPT->traceCheckN;*)
               (if N.T.length > 0 then 
                   (if false then
                       '**** AD:Search:'->traceCheck; T[]->traceCheckN;
                   if);
                   (if origin[] <> none then
                       N[] -> origin.search;
                    else
                       'empty'->traceCheckN
               if)if);
               true -> done
            #)
       #);
     
     BetaName::<
       (# setUpOrigin::
            (#
            do (if origin[] = none then
                   'Name:origin is none:'->traceCheck; T[]->traceCheckN
               if)
            #);
          check::
            (# 
            do (*'BetaName:check:'->traceCheck;*)
            #)
       #);
              
  do (if doTrace then 
         '**** StdBetaChecker: '->puttext; newline;
         '**** topModule:' -> dumpTN; 
         (if topModule[] <> none then
             topModule.doPT -> putheadN;
             '------'->dumpTN
         if);
         topModule.setUpOrigin;
         topModule.check;
     if)
  #)
