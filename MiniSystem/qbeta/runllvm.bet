ORIGIN '~beta/basiclib/betaenv'
---lib:attributes---
chdir: external
  (# dir: [0] @char; res: @integer
  enter dir
  do callC
  exit res
  #);
system: external
  (# cmd: [0] @char; res: @integer
  enter cmd
  do callC
  exit res
  #);
_popen: external
  (# cmd,mode: [0]@char; res: @integer
  enter(cmd,mode)
  do callC
  exit res
  #);
fgetc: external
  (# F: @integer; ch: @char
  enter F
  do callC
  exit ch
  #);
--- program:descriptor ---
(# WS: ^text;
   exe:
     (# cmd,subPath,input: ^text; 
        withB,withC,background: @boolean;
        TB,TBx: ^Text
     enter(cmd[],subPath[], withB,withC,background,input[])
     do subPath[] -> (WS.copy).append -> TB[]; 
        cmd[] -> (TB.copy).append -> TB[]; 
        TB -> chdir;
        TB.copy -> TBx[];
        'xbeta -l ' -> TB[];
        cmd[] -> TB.append;
        (if false then
            (if first then
                ' > ' -> TB.append;
                false -> first
             else
                ' >> ' -> TB.append
        if)if);
        log[] -> TB.append;
        (if background then '&' -> TB.append;  if);
        (if withB then TB[] -> putline; TB -> system if);        
        
        (if false then
            '/a.exe >> ' -> TBx.append -> TBx[];
            log[] -> TBx.append;
         else
            '/a.exe ' -> TBx.append -> TBx[];
        if);
        TBx[] -> putline;
        TBx -> system;
        newline;
        WS -> chdir;
     #); 
   first: @boolean;
   T: [10000] @char; S: @text;
   FFF: @integer;
   arg: ^Text; resetLog: @boolean;
   log: ^text
do 'qBeta LLVM test run: ' -> puttext;
   (if noOfArguments > 1 then
       2 -> arguments -> arg[];
       (if '-r' -> arg.equalNCS then
           true -> resetLog;
           'Log file is reset' -> puttext
       if)
    else
           'test against llvmmasterlog.txt: ' -> puttext           
   if);
   newline;
   'c:/beta/r5.5/MiniSystem/qbeta/BETAworld/workspace/LLVMex/' -> WS[];
   (if false then
       (if resetLog then
           'llvmmasterlog.txt' -> (WS.copy).append -> log[]
        else
           'llvmrunlog.txt' -> (WS.copy).append -> log[]
   if)if);
   
   true -> first;
   WS -> chdir;

   ('mixed','',true,false,false,none)-> exe;
   ('RefRel','',true,false,false,none)-> exe;
   ('valEx','',true,false,false,none)-> exe;
   ('mini','',true,false,false,none)-> exe;
   ('minix','',true,false,false,none)-> exe;
   ('miniy','',true,false,false,none)-> exe;
   
   WS -> chdir;
#)

   
