CharFilter: obj
   c: var char
   S: ref StringLib.String  -- ENC, origin error if no StringLib
   i: var integer
   next:
      out c: var char
      i:= i + 1
      c := S.@get i
   send(ch: var char):
      c := ch
   doubleSpaceToDot: obj 
     ch: var char
     doubleSpaceToDot.suspend
     cycle
        ch := next
        if (ch = ' ') :then
           ch := next
           if (ch = ' ') :then
              send('.')
              doubleSpaceToDot.suspend
              send(' ')
              doubleSpaceToDot.suspend
           :else
              send(' ')
              doubleSpaceToDot.Suspend
              send(ch)
              doubleSpaceToDot.Suspend
        :else
           send(ch)
           doubleSpaceToDot.Suspend
   doubleSpaceToDotB: obj 
     ch: var char
     send(ch: var char):
        c := ch
        doubleSpaceToDotB.suspend	
     doubleSpaceToDotB.suspend
     cycle
        ch := next
        if (ch = ' ') :then
           ch := next
           if (ch = ' ') :then
              send('.')
              send(' ')
           :else
              send(' ')
              send(ch)
        :else
           send(ch)
   S := "Hello world  What a nice day!\n"
   S.print
   loop: do
      cycle
         doubleSpaceToDot.call
         put(c)
         if (c = ascii.newline) :then
            leave(loop)
   i := 0
   S := "The sun is shining  The sky is blue.\n"
   loopB: do
      cycle
         doubleSpaceToDotB.call
         put(c)
         if (c = ascii.newline) :then
            leave(loop)