AgentSystem: obj
   %visible Containers.Set,QBETA,StringLib

   Point(X: var integer):and(y: var integer): value
      print:
         "Point({I2S(x)}):at({I2S(y)})\n".print
   random(V: var integer):
      out R: var integer
      R := 111 /% V      
   System:
      Agent(who: var integer):
         pos: var Point(0):and(0)
         pen: obj 
            down:
              put('D')	    
            up:
              put('U')	    
            color: var char
            draw:
               put(color)
               pos.print	       
         fd(s: var integer):
            pen.draw	 
            pos.x := pos.x + 1
            pos.y := pos.y + 1  
         rt(d: var integer):
            pos.y := pos.y + d	 
         lt(d: var integer):
            pos.x := pos.x + d	 
         neighbors4:
             out N: ref PatchSet
             
      Patch:
         Pos: var Point(0):and(0)
      TurtleSet: Set(#Agent)
         ask:<
            current: ref Elm
            cond:<
               out V: var Boolean
            scan
               this(ask).current := current
               inner(ask)
      PatchSet: Set(#Patch)
         dum: var integer
      turtles: obj TurtleSet
      tick:
         put('t')
      inner(System)
   System
      for (1):to(10):repeat
          turtles.insert(Agent(inx))
      for(1):to(10):repeat
         Turtles.ask
               current.pen.color := 'a' + current.who      
               current.fd(1)
               current.lt(random(current.who + 10))
               current.rt(random(current.who + 13))
   newline
