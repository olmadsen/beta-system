ORIGIN '~beta/basiclib/betaenv';
INCLUDE 'qStdBetaAllocator';
INCLUDE '../VM/objectcode'
---LIB:attributes---
qStdBetaGenerator: qStdBetaAllocator
  (# StdBetaModule::<
       (# gen:: 
            (# 
            do 'StdBetaModule:gen:'-> dumpT; moduleName.doPT->dumpTN;

            #)
       #);   
     AttSlot::<
       (# gen::
            (#
            do scanBindings(#do current.gen #)
            #);
       #);
     ObjDescSlot::<
       (# gen::
            (#
            do scanBindings(#do current.gen #)
            #);
       #);
     ObjectDesc::
       (# gen::
            (#  T: ^Text
            do (if false then
                   'ObjectDesc:gen:'-> dumpT; 
               if);
               '_StdBeta_'-> T[];

               (if NS[] <> none then
                   NS.scanSons(#do current.dopt -> T.append #)
                else 
                   (if origin[] = none then
                       'betaenv'->T.append;
                    else
                       'aFragment'->T.append
               if)if);
               (if false then T[] -> dumptn; if);
               
               (T[],descNo,false,1,originOff,'bobs',1,false,false)
                 -> cd.class;
               cd.nop;
               
               acp.gen;
               
               (objSize,false,0) -> cd.endclass
               
       #)#);
     ActionPart::
       (# gen::
            (#
            do (*(if imps[] <> none then imps.gen if)*)
            #);
       #);
     imperatives::
       (# gen::
            (#
            do (* scanSons(#do current.gen #)*)
            #)
       #);
     Evaluation::
       (# gen::
            (#
            do (if false then
                   cd.fcom(#do 'Eval:gen:'->TT; dopt -> TQ #)
               if);
               scanSons
               (#
               do(if isFirst then
                      current.gen;
                   else
                      current.store
               if)#);
               true -> done
            #)
       #);
     PatternDen::
       (# gen:: (#do#);
       #);
     BetaBinaryExp::
       (# gen::
            (#
            do lE.gen; rE.gen; op -> cd.op; true -> done;
            #)
       #);
     NameApl::
       (# store::
            (#
            do (* goOrigin *)
               (N.T[],(*ATd.off*)7) -> cd.storeg (* if value *)
            #);
       #);     
     ConstExp::
       (# gen::
            (#
            do cst.T.setpos; cst.T.getInt  -> cd.pushConst;
               true -> done
            #)
       #);
     genStdBeta:
       (#
       do '**** Generator: StdBeta:'->dumptn;
          topModule.alloc;
          topModule.gen;
       #);
     cd:  ^ObjectCode;
  enter cd[]
  #);

