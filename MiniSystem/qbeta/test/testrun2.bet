ORIGIN '~beta/basiclib/betaenv';
INCLUDE 'testlib'
--- program:descriptor ---
(# sys: @SysEnv;
   T: [10000] @char; 
   arg: ^Text; resetLog: @boolean;
   WS,testDir,S: ^text;   
   log: ^text
do 'qBeta test run: ' -> puttext;
   (if noOfArguments > 1 then
       2 -> arguments -> arg[];
       (if '-r' -> arg.equalNCS then
           true -> resetLog;
           'Log file is reset' -> puttext
       if)
    else
       'test against B_mastertrace.txt: ' -> puttext           
   if);
   newline;
   'pwd' -> system;
   (* The  path '/home/olm/...' has been working fine for many years,
    * but starting nov 2022, it failed for chdir - dont know why?
    * 
    * '/home/olm/beta/r5.5/MiniSystem/qbeta/BETAworld/workspace/' -> WS[];
    * By changing to 'C:/beta/...' it works again!?
    *)      
   'C:/beta/r5.5/MiniSystem/qbeta/test/' -> testDir[];
   'Compiler_test'-> (testDir.copy).append -> S[];
   '> C_list &' -> S.append;
   (* the idea ws to run S in the background but it does not work
    * so we do this manually 
    * S[]->putline;
    * S -> system;
    *)
   (if resetLog then
       'B_mastertrace.txt' -> (testDir.copy).append -> log[]
    else
       'B_trace.txt' -> (testDir.copy).append -> log[]
   if);
   ('C:/beta/r5.5/MiniSystem/qbeta/BETAworld/workspace/',log[]) -> sys.init;
   sys.WS -> chdir;
   ('Break','demo/',true,true,false) -> sys.run;
   ('UnitIssues','',true,true,false) -> sys.run;
   ('UnitEx','demo/',true,true,false) -> sys.run;
   ('ToyCar','demo/',true,true,false) -> sys.run;
   ('LibraEx','demo/',true,true,false) -> sys.run;
   ('ChemicalPlantSystem','demo/',true,true,false) -> sys.run;
   ('UnitTest','',true,true,false) -> sys.run;
   ('DumpObjEx','',true,false,false) -> sys.run;
   ('test','',true,true,false) -> sys.run;
   ('SimpleThreadEx','demo/',false,true,false) -> sys.run;
   ('SCPex','demo/',false,true,false) -> sys.run;
   ('ForkJoinEx','demo/',false,true,false) -> sys.run;
   ('MonitorDemo','demo/',false,true,false) -> sys.run;
   'Done:testrun2'->putline;
   (if not resetLog then
       'diff -a B_mastertrace.txt B_trace.txt' -> putline;
       'diff -a B_mastertrace.txt B_trace.txt' -> System
   if);
#)

   
