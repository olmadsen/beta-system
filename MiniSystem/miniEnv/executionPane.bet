ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/guienv/controls';
INCLUDE '~beta/guienv/utils/framer';
INCLUDE '~beta/guienv/fields';
INCLUDE 'subwindow';
---windowlib:attributes---
executionPane: subWindow
  (# open::<  
       (# width, height: @integer;
       do THIS(Window).size -> (width, height);
          (width - 410 - 5, height - 10) -> size;

          callButton.open;
          callOverButton.open;
          callOverbutton.hide;
          stepButton.open;
          stepOverButton.open;
          skipInternalButton.open;
          continueButton.open;
          lifelines.open;
          closeButton.open;
          clearStacksButton.open;
          keepStacksBox.open;   
          (if keepStacksBox.state then
              keepStacksBox.hide
          if);
          S.open;
          inner;
       #);
     init:< (* is this one used?*)
       (#
       do callButton.show;
          callOverButton.show;
          continueButton.show;
          keepStacksBox.show;
          (if not keepStacksBox.state then
              clearStacksButton.show
          if);
          lifelines.show;
          inner
       #);
     xStart: (# exit 140 #);
     butW: (#exit 70 #);
     nextStart: @
       (# n: @integer
       do n + 1 -> n
       exit xStart + (butW + 3) * (n-1) 
       #);
     callButton: @callPushButton;
     callPushButton:< pushButton
       (# eventHandler::< 
            (# onMouseUp::< (#do true -> call; inner #)#);
          open::<
            (#
            do 'Call' -> label;
               (nextStart,borderWidth) -> position;
               (butW,20) -> size;
               inner
            #)
       #);
     callOverButton: @callOverPushButton;
     callOverPushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::< (# do true -> call; inner #)#);
          open::<
            (#
            do 'CallOver' -> label;
               (nextStart, borderWidth) -> position;
               (butW,20) -> size;
               inner
            #)
       #);
     skipInternalButton: @skipInternalPushButton;
     skipInternalPushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::< (# do true -> call; inner #);
            #);
          open::<
            (#
            do 'SkipInternal' -> label;
               (nextStart, borderWidth) -> position;
               (butW,20) -> size;
               inner
            #)
       #);
     stepButton: @stepPushButton;
     stepPushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::< (# do(* true -> step;*) inner #);
            #);
          open::<
            (#
            do 'Step' -> label;
               (nextStart, borderWidth) -> position;
               (butW,20) -> size;
               inner
            #)
       #);
     stepOverButton: @stepOverPushButton;
     stepOverPushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::< (# do (*true -> step; *) inner #);
            #);
          open::<
            (#
            do 'StepOver' -> label;
               (nextStart, borderWidth) -> position;
               (butW,20) -> size;
               inner
            #)
       #);
     
     continueButton: @continuePushButton;
     continuePushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::<
                 (#
                 do true -> continue;
                    inner
                 #);
            #);
          open::<
            (#
            do
               'Continue' -> label;
               (nextStart, borderWidth) -> position;
               (butW,20) -> size;
               inner
            #)
       #);
     clearStacksButton: @clearStacksPushButton;
     clearStacksPushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::<
                 (#
                 do 
                    inner
                 #);
            #);
          open::<
            (#
            do
               'Clear Stacks' -> label;
               (nextStart,borderWidth) -> position;
               (butW,20) -> size;
               inner               
            #);
       #);
     lifelines: @lifelinesButton;
     lifelinesButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::<
                 (#
                 do true -> continue;
                    inner
                 #);
            #);
          open::<
            (#
            do
               'Lifelines' -> label;
               (nextStart,borderWidth) -> position;
               (butW,20) -> size;
               inner
               
            #)
       #);
     closeButton: @closePushButton;
     closePushButton:< pushButton
       (# eventHandler::<
            (# onMouseUp::<
                 (#
                 do 
                    inner
                 #);
            #);
          open::<
            (#
            do
               'Close' -> label;
               (nextStart,borderWidth) -> position;
               (butW,20) -> size;
               inner               
            #);
       #);
     keepStacksBox: @keepStacksCheckBox;
     keepStacksCheckBox:< checkBox
       (# eventHandler::<
            (# onMouseUp::<
                 (#
                 do (if state then
                        clearStacksButton.hide
                     else
                        clearStacksButton.show
                    if);
                    inner
                 #)
            #);
          open::<
            (# 
            do 'Keep Stacks' -> label;
               (nextStart,borderWidth) -> position;
               false -> state;
               INNER;
               fitToContents
            #);
       #);

     call,continue: @boolean;
 
     S: @ scroller
       (# contentsType::
            (# (* why do we need contents as well as SDP?*)
               SDP: @framer
                 (# open::
                      (#
                      do (this(executionPane).width,this(executionPane).height) -> size;
                         'betaExeGrey' -> ct.lookup -> backgroundcolor;
                      #);
                 #);
               open:: 
                 (# 
                 do (this(executionPane).width,this(executionPane).height) -> size;
                    SDP.open ;
                    (*contents.size -> SDP.size; (* does not work*)                    
                    true -> bindright -> bindBottom;
                 #)
            #);
          open::
            (#
            do (this(executionPane).width-40,this(executionPane).height-40) -> size;
               (*size -> contents.size;*) (* does not work*)
               (25,25) -> position;
               true -> bindright -> bindBottom;
            #)
       #);
  #); 
