ORIGIN '~beta/guienv/guienvsystemenv';
INCLUDE '~beta/guienv/guienv';
INCLUDE '~beta/MiniSystem/compiler_IF/directoryComponents';
INCLUDE '~beta/MiniSystem/qbeta/qgenerator';
INCLUDE '~beta/MiniSystem/VM/betaVM';
BODY '~beta/MiniSystem/qbeta/unithandlerBody';
BODY '~beta/MiniSystem/VM/objectcode_VM';
-- program: descriptor --
SystemEnv
(# gui: @guienv;
   setWindowEnv:: (# do gui[] -> theWindowEnv[] #);
   compile: @generator;
   VM: @ betaVM
     (# putCH:: (# do ch -> put #);
        getCh:: (# do get -> ch #);
        done::
          (#
          do stop
          #)
     #);
   LG: @log;
   fullPath,fileExt,BetaWorld,errors: ^Text;
   iMain: ^compile.IModule;
   runMode: @integer;
do 'C:\\beta\\r5.5\\MiniSystem\\qbeta\\BETAworld\\workspace\\hello\\hello.qbeta' -> fullPath[];
   '/MiniSystem/qbeta/BETAworld/' -> BetaWorld[];
   '.qbeta' -> fileExt[];
   (BetaWorld[],fileExt[],'.xbeta') -> compile.initDirectoryModules;
   ('qservice.log', false) -> LG.open;

   true -> compile.newFatComma;
   true -> compile.stringAsVal;
   true -> compile.isXbeta;
   true -> compile.altParser;
   run_Beta_INT -> runMode;

   'compiling: ' -> putText;
   fullPath[] -> putline;

   (LG[], true, NONE, fullPath[]) -> compile -> (iMain[],errors[]);
   (if errors[] <> none then
       'errors:'-> putline; errors[] -> putline;
   if);

   (runMode,true) -> VM.init;

   (if not compile.onlyLex
       and not compile.hasSyntaxError
       and not compile.semanticErrors then
       true -> VM.noPause;
       (compile.runtimeDescs,compile.mainDescNo,fullPath[],runMode)
         -> VM.execute.init;
       VM.execute[] -> fork;
       VM.reactivate
   if);
   'done' -> putLine;
   stop
#)
