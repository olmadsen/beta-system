origin '~beta/basiclib/systemenv';
---lib:attributes---
(*
  hThreadArray[i] = CreateThread( 
            NULL,                   // default security attributes
            0,                      // use default stack size  
            MyThreadFunction,       // thread function name
            pDataArray[i],          // argument to thread function 
            0,                      // use default creation flags 
            &dwThreadIdArray[i]);   // returns the thread identifier 
*)
CreateThread: External
(# a,b: @integer;
   F: ##external;
   c,d,e: @integer;
   R: @int64
enter(a,b,F##,c,d,e)
do CallStd
exit R
#);

WaitForMultipleObjects: external
  (*WaitForMultipleObjects(MAX_THREADS, hThreadArray, TRUE, INFINITE);*)
(# max,X,Y: @integer;
  HT: @integer
enter(max,HT,X,Y)
do CallStd 
#);

---program:descriptor---
systemEnv
(# 
   foo: external
     (# X,V: @integer 
     enter X 
     do 'Here is foo' -> putline;
        0 -> X
     exit X
     #);   
   Q: [3] @ integer;
   W: @int64
do 'Hello world' -> putline;
   
   (0,0,foo##,123,0,@@Q[1]) -> CreateThread -> W;
   
   'Started'-> putline;
   
   (1,@@Q[1],1,111111111) -> WaitForMultipleObjects;

   'Bye' -> putline
#)

