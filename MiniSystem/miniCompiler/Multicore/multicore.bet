origin '~beta/basiclib/betaenv'; 
include '~beta/basiclib/formatio';
(*BUILD default '$$/cmpxchlg.obj' 'cmpxchlg.c' 'betacc  $0 $1';*)
BUILD default '$$/cmpxchlg.obj' 'cmpxchlg.c' 'c:/cygwin/bin/gcc -c -o $0 $1';
---lib:attributes---
cmpxchlg: external
  (# mutex,old,val,res: @integer
  enter(mutex,old,val)
  do callC
  exit res
  #);
CreateThread: External
(* HANDLE WINAPI CreateThread(
 *  _In_opt_   LPSECURITY_ATTRIBUTES lpThreadAttributes,
 * _In_       SIZE_T dwStackSize,
 * _In_       LPTHREAD_START_ROUTINE lpStartAddress,
 * _In_opt_   LPVOID lpParameter,
 * _In_       DWORD dwCreationFlags, -- unsigned 32-bit integer
 * _Out_opt_  LPDWORD lpThreadId     -- typedef DWORD *LPDWORD;
 * );
 *)
  (# lpThreadAttributes: @integer;
     dwStackSize: @integer;
     lpStartAddress: ##external;
     lpParameter: @integer;
     dwCreationFlags: @integer;
     threadId: @int32;
     handle: @int32       
  enter(lpThreadAttributes, dwStackSize, lpStartAddress##, 
     lpParameter,dwCreationFlags,threadId)
  do CallStd
  exit handle
  #);

(***********************
 * HANDLE WINAPI CreateEvent(
 * _In_opt_  LPSECURITY_ATTRIBUTES lpEventAttributes,
 * _In_      BOOL bManualReset,
 * _In_      BOOL bInitialState,
 * _In_opt_  LPCTSTR lpName
 * );
 *)
CreateEvent: external
  (# security: @ integer;
     autoReset: @int16;
     initialSignal: @int16;
     id,res: @integer
  enter(security,autoReset,initialSignal,id)
(*  do CallStd*)
  exit res
  #);
     
WaitForMultipleObjects: external
  (*WaitForMultipleObjects(MAX_THREADS, hThreadArray, TRUE, INFINITE);*)
  (# max,X,Y: @integer;
     HT: @integer;
     Res: @integer
  enter(max,HT,X,Y)
  do CallStd 
  exit Res
  #);

