origin '~beta/basiclib/betaenv'; 
include '~beta/basiclib/formatio';
INCLUDE 'multicore'
(*BUILD default '$$/cmpxchlg.obj' 'cmpxchlg.c' 'c:/cygwin/bin/cc -c -o $0 $1';
---lib:attributes---
cmpxchlg: external
  (# mutex,old,val,res: @integer
  enter(mutex,old,val)
  do callC
  exit res
  #)*)
---program:descriptor---
(# m,res: @integer
do 
   (for i: 2 repeat
        'old: ' -> puttext; m -> putint; newline;
        (@@m,m,1) -> cmpxchlg -> res;
        'res: ' -> puttext; res -> putint; newline;
        'new: ' -> puttext; m -> putint; newline;
   for)
   
#)
