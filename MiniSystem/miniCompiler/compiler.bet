ORIGIN '~beta/guienv/guienvsystemenv';
(*ORIGIN '~beta/basiclib/betaenv';*)
INCLUDE '~beta/guienv/guienv';
INCLUDE 'lexer';
INCLUDE 'parser';
INCLUDE 'checker';
INCLUDE 'generator';
INCLUDE 'betaVM';
BODY 'parseStdBeta'
---program:descriptor---
SystemEnv
(# compile: @generator;
   FN: ^text;
   VM: @betaVM
     (# putCh:: (# do ch -> put #);
        getCh:: (# do get -> ch #);
        (*startEvent:: (#do '\n***Start:' -> RTT.puttext #);
        allocEvent::
            (#
            do '\n***Alloc:' -> RTT.puttext;
            #);
          doEvent::
            (#
            do '\n***Do:' ->  RTT.puttext;
            #);
          rtnEvent::
            (#
            do '\n***Rtn:' ->  RTT.puttext;
         #);*)
        errorEvent:: (# do msg[] -> putline; done #);
        done:: (# do stop #);
     #);
   setWindowEnv:: (# do myWindowEnv[] -> theWindowEnv[]#);
   myWIndowEnv: @ guienv;
   L: @LOG;
   RTT: @File;
   betaLib: ^compile.Node;
   runC: @boolean
do 'New BETA compiler - SVN version: ' -> puttext;
   2 -> arguments -> FN[];
   (if ('-c' -> FN.equalNCS) then
       true -> runC;
       ' ' -> put;
       3 -> arguments -> FN[]
    if);
   FN[] -> fixExtension_bet -> FN[] -> putline;
   ((FN[],'..log') -> mkAuxName, false) -> L.open;
   (L[],false,none,FN[]) -> compile;
   (if compile.hasErrors then
       stop
    else
       (FN[],'..run') -> mkAuxName -> RTT.name;
       RTT.openWrite;
       VM.init; (* two inits? *)
       (compile.descs[],compile.mainDescNo,RTT[],runC) -> VM.execute.init;
       VM.execute[] -> fork;
   if);
#)
