ORIGIN '~beta/basiclib/systemenv';
(*ORIGIN '~beta/basiclib/betaenv';*)
INCLUDE 'lexer';
INCLUDE 'parser';
INCLUDE 'checker';
INCLUDE 'generator';
INCLUDE 'betaVM';
BODY 'parseStdBeta'
---program:descriptor---
SystemEnv
(# compile: @generator;
   FN: ^text;
   VM: @betaVM
       (# allocEvent::
            (#
            do '\n***Alloc:' -> RTT.puttext;

            #);
          doEvent::
            (#
            do '\n***Do:' ->  RTT.puttext;

            #);
          rtnEvent::
            (#
            do '\n***Rtn:' ->  RTT.puttext;

            #)
       #);
   
   L: @LOG;
   RTT: @File;
   betaLib: ^compile.Node
do 'New BETA compiler: ' -> puttext;
   2 -> arguments -> FN[] -> putline;
   ((FN[],'..log') -> mkAuxName, false) -> L.open;
   (L[],false,none,FN[]) -> compile;
   (if not compile.hasErrors then
       (FN[],'..run') -> mkAuxName -> RTT.name;
       RTT.openWrite;
       VM.init;
       (if true then
           (compile.descs[],compile.mainDescNo,RTT[]) -> VM.execute.init;
           VM.execute[] -> fork
        else
           (compile.descs[],compile.mainDescNo,RTT[]) -> VM.execute;
           L: cycle(# do  pause; (*1.0 -> sleep;*) VM.execute; restart L #);

           compile.parseStdBeta -> betaLib[];
           RTT.close;
       if);
   if)
#)
