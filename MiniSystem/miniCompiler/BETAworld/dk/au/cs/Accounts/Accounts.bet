Accounts: @
  (# with Persons;
     Account: 
       (# owner: ^Person;
          Transactions:
            (# add: 
                 (# (*msg: @text;*) subj: ^Account; amount: @integer;
                    R: ^Text 
                 enter(R[],subj[],amount)
                 do 
                    (* Problems with text
                     * 'Transfer ' -> msg.putRtext;
                     * subj.owner.name[] -> msg.puttext
                     * ' amount: ' -> msg.puttext;
                     * amount -> msg.putint; msg.newline;
                     *msg[] -> owner.notify;
                     *)
                    owner.notify
                 #);     
            #);
          trans: ^Transactions;
          open:
            (# ow: ^Persons.Person;
               amount: @integer
            enter(ow[],amount)
            do ow[] -> owner[]; amount -> balance;
               &Transactions[] -> trans[]
            #);
          deposit: 
            (# subj: ^Accounts
               amount,bal: @ integer
            enter(subj[],amount)
            do balance + amount -> balance;
               balance -> bal;
               ('TO:', subj[],amount) -> trans.add
            exit bal
            #);
          withdraw: 
            (# subj: ^Account;
               amount,bal: @ integer
            enter(subj[],amount)
            do (if (balance - amount) >= 0 then
                   balance - amount -> balance
               if);
               balance -> bal
            exit bal
            #);
          ownerName: (# exit owner.name[] #);
          balance: @ integer;
          
          
       #);
     SavingsAccount: Account
       (#
       #);
     CheckAccount: Account
       (#
       #);     
  #)
