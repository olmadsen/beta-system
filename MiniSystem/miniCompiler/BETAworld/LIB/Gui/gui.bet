Gui: @
  (# processEvent:
       (# %primitive%               
          event: ^text;
          handle,e,arg1: @integer;
          T: ^text;
          C: ^Component
       enter event[]
       do 
          'Comp:processEvent: "' -> T[]; T.print; event.print; '"'->put; 10->put;
          0 -> event.setPos;
          event.getint -> handle;
          (*
           'Handle: ' -> T[]; handle->t.putint; T.print; (*handle -> putint;* ) '#'->put; 10 -> put;*)
          handle -> ServiceIF.getComponent -> C[];
          event.getint -> e;
          (if e
           // 1 then
              'ProcessEvent:mouseClicked:' -> T[]; T.print;
              event.getInt -> arg1; arg1 -> putint; 10 -> put;
              arg1 -> C.mouseClicked
           else
          if)
       #); 
     Component:
       (# open:<
            (# father: ^Component
            enter father[]
            do inner;
               (handle,this(Component)[]) -> ServiceIF.add;
            #);
          
          mouseClicked:<
            (# noOfClicks: @integer; T: ^text
            enter noOfClicks
            do 'Component:mouseClicked: ' -> T[]; T.print;
               noOfClicks -> putint;
               10 -> put;
               inner
            #);
          
          setBackground:
            (# 
            do (guiService,handle,C_setBackground,'+++') -> sendMsg -> handle;
            #);
          setSize:
            (# x,y: @integer; args: ^text
            enter(x,y)
            do &text(33)[] -> args[];  
               ' '-> args.putx; x -> args.putint; ' ' -> args.putx; y -> args.putint; 
               
               (guiService,handle,C_setSize,args[]) -> sendMsg -> handle;
            #);
          setPosition:
            (# x,y: @integer; args: ^text
            enter(x,y)
            do &text(33)[] -> args[];  
               ' '-> args.putx; x -> args.putint; ' ' -> args.putx; y -> args.putint; 
               (guiService,handle,C_setPosition,args[]) -> sendMsg -> handle;
            #);
          mkArgs:
            (# x,y: @integer; args: ^text
            enter(x,y)
            do &text(33)[] -> args[];  
               ' '-> args.putx; x -> args.putint; ' ' -> args.putx; y -> args.putint; 
            exit args[]
            #);
          handle: @ integer
       #);
     Window: Component
       (# open::< 
            (# name: ^text
            enter name[]
            do (guiService,0,openWindow,name[]) -> sendMsg -> handle;               
               inner
            #);
          
          Frame: Component (* this(window).handle should be father.handle *)
            (# open::<
                 (# N: ^text;
                    h: @integer
                 do father.handle -> h;
                    (guiService,h,openFrame,'***') -> sendMsg -> handle;
                    inner
                 #)
            #);  
          Label: Component
            (# open::<
                 (# title: ^text; h: @integer
                 enter title[]
                 do father.handle -> h; 'Q'-> put;
                    (guiService,h,C_openLabel,title[]) -> sendMsg -> handle
                 #);
            #);
          TextField: Component
            (# open::< 
                 (# 
                 do (guiService,father.handle,C_openTextField,'---') -> sendMsg -> handle
                 #);
               setText:
                 (# T: ^text
                 enter T[]
                 do (guiService,handle,C_setText,T[]) -> sendMsg -> handle
                 #);
               getText:
                 (# T: ^text
                 do (guiService,handle,C_getText,'---') -> sendMsg -> T[]
                 exit T[]
                 #);
            #)
       #);
     guiService: (# exit 2 #);
     openWindow: (# exit 1 #);
     openFrame: (# exit 2 #);
     C_setBackground: (# exit 3 #);
     C_setPosition: (# exit 4 #);
     C_openLabel: (# exit 5 #);
     C_opentextField: (# exit 6 #);
     C_setSize: (# exit 7 #);
     C_setText: (# exit 8 #);
     C_getText: (# exit 9 #);
  #)
