Gui: @
  (# (*with ServiceIF; - does not work, apparently search starts in origin *)
     
     processEvent:
       (# %basic=processEvent%               
          event: ^text;
          handle,e,arg1: @integer;
          T: ^text;
          C: ^Component
       enter event[]
       do (* 'Comp:processEvent: "' -> T[]; T.print; event.print; '"'->put; 10->put;*)
          0 -> event.setPos;
          event.getint -> handle;
          (* 'Handle: ' -> T[]; T.print;  handle -> putint;  10 -> put;*)
          handle -> ServiceIF.getComponent -> C[];
          C.echo;
          event.getint -> e;
          (if e
           // 1 then
              (* 'ProcessEvent:mouseClicked:' -> T[]; T.print;*)
              event.getInt -> arg1; 
              (* arg1 -> putint; 10 -> put;*)
              arg1 -> C.mouseClicked
           else
          if)
       #); 
     Component:
       (# open:<
            (# father: ^Component
            enter father[]
            do inner;
               (handle,this(Component)[]) -> ServiceIF.add;
            #); 
          echo:< (# T: ^text do inner; T.print #);
          mouseClicked:<
            (# noOfClicks: @integer; T: ^text
            enter noOfClicks
            do 'Component:mouseClicked: ' -> T[]; T.print;
               noOfClicks -> putint;
               10 -> put;
               inner
            #);          
          setBackground:
            (# 
            do (guiService,handle,C_setBackground,'+++') -> sendMsg -> handle;
            #);
          setSize:
            (# x,y: @integer; args: ^text
            enter(x,y)
            do &text(33)[] -> args[];  
               ' '-> args.putx; x -> args.putint; ' ' -> args.putx; y -> args.putint;              
               (guiService,handle,C_setSize,args[]) -> sendMsg -> handle;
            #);
          setPosition:
            (# x,y: @integer; args: ^text
            enter(x,y)
            do &text(33)[] -> args[];  
               ' '-> args.putx; x -> args.putint; ' ' -> args.putx; y -> args.putint; 
               (guiService,handle,C_setPosition,args[]) -> sendMsg -> handle;
            #);
          mkArgs:
            (# x,y: @integer; args: ^text
            enter(x,y)
            do &text(33)[] -> args[];  
               ' '-> args.putx; x -> args.putint; ' ' -> args.putx; y -> args.putint; 
            exit args[]
            #);
          handle: @ integer
       #);
     Window: Component
       (# open::< 
            (# name: ^text
            enter name[]
            do (guiService,0,openWindow,name[]) -> sendMsg -> handle;               
               inner
            #);
          
          Frame: Component (* this(window).handle should be father.handle *)
            (# open::<
                 (# N: ^text;
                    h: @integer
                 do father.handle -> h;
                    (guiService,h,openFrame,'***') -> sendMsg -> handle;
                    inner
                 #)
            #);  
          Label: Component
            (# open::<
                 (# title: ^text; h: @integer
                 enter title[]
                 do father.handle -> h;
                    (guiService,h,C_openLabel,title[]) -> sendMsg -> handle
                 #);
            #);
          TextField: Component
            (# open::< 
                 (# 
                 do (guiService,father.handle,C_openTextField,'---') -> sendMsg -> handle
                 #);
               setText:
                 (# T: ^text
                 enter T[]
                 do (guiService,handle,C_setText,T[]) -> sendMsg -> handle
                 #);
               getText:
                 (# T: ^text
                 do (guiService,handle,C_getText,'---') -> sendMsg -> T[]
                 exit T[]                
                 #);
            #);
          Button: Component
            (# open::<
                 (# title: ^text
                 enter title[]
                 do (guiService,father.handle,C_openButton,title[]) -> sendMsg -> handle
                 #)
            #)
       #);
     guiService: (# do exit 2 #);
     openWindow: (# do exit 1 #);
     openFrame: (# do exit 2 #);
     C_setBackground: (# do exit 3 #);
     C_setPosition: (# do exit 4 #);
     C_openLabel: (# do exit 5 #);
     C_opentextField: (# do exit 6 #);
     C_setSize: (# do exit 7 #);
     C_setText: (# do exit 8 #);
     C_getText: (# do exit 9 #);
     C_openButton: (# do exit 10 #);
     
  #)
