gJobShop: @
  (# With Simulation;
     Resource:
       (# 
          init: 
            (# 
            enter (id[],nm) 
            do display; 
               &Queue[] -> Q[] 
            #);
          request: 
            (# 
            do 'Request:'.print; display; 
               nm - 1 -> nm; (if nm < 0 then Q[] -> (current).wait if) 
            #);
          release: 
            (# 
            do 'Release:'.print; display; 
               nm + 1 -> nm; (if nm <= 0 then Q.first -> (current).activate if) 
            #);
          entry: (# do request; inner; release #);
          display:
            (#
            do id.print; ':'->put; nm -> putint; newline;
            #);
          id: ^text;
          nm: @integer; (* no. of machines in group *)
          Q: ^Queue
       #);
     MachineGroup: Resource(# #);
     MG1: @MachineGroup
       (# getParts: entry(# do 5 -> (current).hold; inner #); 
       #);
     MG2: @MachineGroup
       (# assemble: entry(# do 15 -> (current).hold inner #);
       #);
     MG3: @ MachineGroup
       (# ship: entry(# do 7 -> (current).hold; inner #)
       #);
     Order: Process(#do inner #);
     init:
       (# mkId: (# i: @integer; id: ^text enter i do 'Machine:' -> id[]; i -> id.putint; exit(id[],i*2) #)
       do ('GetParts',1) -> MG1.init;
          ('Assembler',1) -> MG2.init;
          ('Shipper',1) -> MG3.init;
       #);
     O1: @ Order
       (#
       do MG1.getParts(# do (*5 -> hold*) #);
          MG2.assemble(# do (*15 -> hold*) #);
          MG3.ship(# do (*7 -> hold*)  #)
       #);
     O2: @ Order
       (#
       do MG1.getParts; 5 -> hold; MG2.assemble;  15 -> hold; MG3.ship; 7 -> hold 
       #);
     
  do 'Job shop simulation: '.print; newline;
     init;
     ('Order1',3) -> O1; 
     ('Order2',6) -> O2; 

     (O1[],120) -> Simulate(#do O2[] -> SQS.insert; #); 
  #)

