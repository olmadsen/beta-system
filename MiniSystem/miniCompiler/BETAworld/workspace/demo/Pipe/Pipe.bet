Pipe: @
  (# keyboard: @ DefaultKeyboard;
     Prod: @
     (# L: ^text; ch: @Char;
     do 
        &text(16)[] -> L[]
        (for i: 8 repeat 
             (if keyboard.EOS then (* stop *) else 
                 (*keyboard.getx*) 'a'+i-1 -> L.putx; if);
        for); 
        '*' -> L.putx;
        '*' -> L.putx;
        'Q' -> L.putx;
        '.'->L.putx;
        L[] -> Pipe.pPut; 
     #);
   
   Pipe: @
     (# pPut: (# L: ^text enter L[] do L[] -> DisAsm  #); 

        DisAsm: @ 
          (# inLine: ^text
          enter inLine[]
          do 
             inLine.scan(# do currentCh -> Squash.pput #);
             ' ' -> Squash.pput;
             Squash.doIt
	  #);
        Squash: @ 
          (# pput: 
               (# ch: @Char
               enter ch
               do ch -> line.putx; 
               #);
             
             doIt:
               (# 
               do
                  line.scan
                  (#
                  do (if currentCh = '*' then
                         (if currentCh =  '*' then 
                             '^' -> Asm.put
                          else 
                             '*' -> asm.put; 
                             currentCh -> asm.put 
                         if)
                      else 
                         currentCh -> Asm.put
                     if)
                  #);
                  line.clear
               #);
             line: @text
          #);
        Asm: @
          (# put: 
               (# ch: @Char
               enter ch
               do ch -> OutLine.putx; 
                  (if ch = '.' then 
                      OutLine[] -> Cons.put
                  if)
               #);
	  #);
        OutLine: @text
     #);
     Cons: @
       (# put: (# T: ^text enter T[] do T.print #)
       #);
   
  do Prod;
     10 -> put
#)

