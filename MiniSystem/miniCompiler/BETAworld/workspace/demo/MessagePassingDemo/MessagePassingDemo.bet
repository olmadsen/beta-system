MessagePassingDemo: @ MessagePassingSystem.System
  (# MyMessage: Message
       (# T: ^text
       enter T[]
       exit this(MyMessage)[]
       #);
     P1: @ Process
       (# M: ^MyMessage
       do (for i: 10 repeat
               'P1-message\n' -> myMessage -> M[]; M[] -> P3.sendMessage
          for);
       #);
      P2: @ Process
       (# M : ^MyMessage
       do (for i: 5 repeat 
               'P2-message\n' -> MyMessage -> M[]; M[] -> P3.sendMessage
          for);
       #);
      P3: @ Process
       (# M: ^MyMessage; C: @integer
       do loop:
            (if 1 then 
                getMessage -> M[];
                (if M[] <> none then
                    console.display(# do 'Received: '.print; M.T.print; #);
                    restart loop
                if);
                10 -> Sleep;
                C + 1 -> C;
                (if C < 50 then
                    restart Loop
                if)
            if)
       #);
  do 'Message Passing System Demo\n'.print;
     101-> P1.start; 102 -> P2.start; 103 -> P3.start
  #)
