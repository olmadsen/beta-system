P2CDIR = /users/beta/p2c/v1.20
INCLUDE = $(P2CDIR)/home
LIB = $(P2CDIR)/$(MACHINETYPE)libp2c.a
CC = gcc

default: $(MACHINETYPE)exbobs $(MACHINETYPE)tabc

$(MACHINETYPE)exbobs: $(MACHINETYPE)exbobs.c $(P2CDIR)/$(MACHINETYPE)libp2c.a
# Compiling $(MACHINETYPE)exbobs.c
	$(CC) -I$(INCLUDE) $(MACHINETYPE)exbobs.c $(LIB) -o $(MACHINETYPE)exbobs
# $(MACHINETYPE)exbobs READY

$(MACHINETYPE)tabc: tabc.bet
# Compiling tabc.bet
	beta -q -o $(MACHINETYPE)tabc tabc.bet
# $(MACHINETYPE)tabc READY

$(MACHINETYPE)exbobs.c: exbobs.p $(P2CDIR)/$(MACHINETYPE)libp2c.a
# Converting exbobs.p to $(MACHINETYPE)exbobs.c
	$(P2CDIR)/$(MACHINETYPE)p2c -a -q exbobs.p
	mv exbobs.c $(MACHINETYPE)exbobs.c
# $(MACHINETYPE)exbobs.c READY

$(LIB): $(P2CDIR)/$(MACHINETYPE)p2c
# Creating $(MACHINETYPE)libp2c.a
	cd $(P2CDIR)/src; make clean.o;	 \
		rm -f libp2c.a p2clib.o loc.p2clib.o; \
		make libp2c.a;		 \
		ranlib libp2c.a;		 \
		mv $(P2CDIR)/src/libp2c.a $(P2CDIR)/$(MACHINETYPE)libp2c.a

$(P2CDIR)/$(MACHINETYPE)p2c:
# Creating $(MACHINETYPE)p2c
	cd $(P2CDIR)/src; make clean.o;	 \
		make p2c;		 \
		mv $(P2CDIR)/src/p2c $(P2CDIR)/$(MACHINETYPE)p2c
