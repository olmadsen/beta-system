ORIGIN 'comtypes';
BODY 'private/comlibbody';
INCLUDE 'Unknwn';
--LIB: attributes--

(*
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-98
 *       All rights reserved.
 *)

CoInitialize: external
  (# LPVoid,hresult: @Int32;
  enter LPVoid
  do CallStd; 
  exit hresult
  #);
CoUninitialize: external
  (# 
  do CallStd;
  #);

CLSIDFromProgID: 
  (# progid: ^BSTR;
     theclsid: ^CLSID;
     hr: @HRESULT;
     CLSIDFromProgID: external
       (# lpszProgID, rclsid, hr: @Int32;
       enter (lpszProgID, rclsid)
       do callStd
       exit hr
       #);
  enter progid[]
  do &CLSID[] -> theclsid[];
     (progid.wcharptr, @@theclsid.Binary[1]) -> CLSIDFromProgID -> hr;
     (if hr.failed then
         ('CLSIDFromProgID failed', hr.value) -> ComErrorMessage;
         NONE->theclsid[];
     if);
  exit theclsid[]
  #);

CoCreateInstance:
  (# theclsid: ^CLSID; 
     outer: ^IUnknown;
     Flags: @Int32;
     theiid: ^IID;
     Iptr: ^IUnknown;
     hr: @HRESULT;
     CoCreateInstance: external
       (# pUnkOuter: ^IUnknown;
          rclsid, dwClsContext, riid, ppv, hr: @Int32;
       enter (rclsid, pUnkOuter[], dwClsContext, riid, ppv)
       do callStd
       exit hr
       #);
  enter (theclsid[], outer[], Flags, theiid[])
  do (@@theclsid.Binary[1], outer[], Flags, @@theiid.Binary[1], @@Iptr)
       -> CoCreateInstance->hr;
     (if hr.failed then
         ('CoCreateInstance failed', hr.value) -> ComErrorMessage;
         NONE->Iptr[];
     if);
  exit Iptr[]
  #);
          
ComErrorMessage: external
  (# msg: [0]@char;
     hr: @int32;
  enter (msg, hr)
  do CallC
  #)

