ORIGIN 'OAIdl';

(*
 * COPYRIGHT
 *       Copyright (C) Aarhus University
 *       All rights reserved.
 *)

-- lib: attributes --

(*---------------------------------------------------------------------*
 *            Active Object Registration API                           *
 *---------------------------------------------------------------------*)

(* flags for RegisterActiveObject *)
ACTIVEOBJECT_STRONG: (# exit 0x0 #);
ACTIVEOBJECT_WEAK: (# exit 0x1 #);



(*---------------------------------------------------------------------*)
(*                ITypeInfo                                            *)
(*---------------------------------------------------------------------*)

(* Flags for IDispatch::Invoke *)
DISPATCH_METHOD:         (# exit 0x1 #);
DISPATCH_PROPERTYGET:    (# exit 0x2 #);
DISPATCH_PROPERTYPUT:    (# exit 0x4 #);
DISPATCH_PROPERTYPUTREF: (# exit 0x8 #);


SysAllocString: External
  (# wstr: @integer;
     bstr: @integer;
  enter wstr
  do callStd;
  exit bstr
  #);
SysFreeString: External
  (# bstr: @integer
  enter bstr
  do callstd
  #);


SafeArrayCreate: External
  (# vt: @int16u (* VARTYPE *);
     cDims: @int32u (* unsigned int *);
     rgsaBound: @int32 (* Array of ^SAFEARRAYBOUND *);
     psa: ^SAFEARRAY;
  enter (vt, cDims, rgsaBound)
  do callStd;
  exit psa[]
  #);

variantRefHolder: holder
  (# value: ^VARIANT;
     increment:
       (* Can be used to increment the pointer by sizeof(VARIANT)
        * e.g. in case it points to an array of VARIANTs
        *)
       (# 
       do (*(((0->value.%getLong) + 16),0) -> value.%putLong; *)
          (%getLongAt(@@value)+16) %putLongAt (@@value);
       #);
  enter value[]
  exit value[]
  #);

SafeArrayAccessData: External
  (# psa: ^SAFEARRAY;
     ppvdata: ^variantRefHolder;
     hr: @integer;
  enter (psa[], ppvData[])
  do callStd;
  exit hr
  #);

SafeArrayUnaccessData: External
  (# psa: ^SAFEARRAY;
     hr: @integer;
  enter psa[]
  do callStd;
  exit hr
  #);

SafeArrayDestroy: External
  (# psa: ^SAFEARRAY;
     hr: @integer;
  enter psa[]
  do callStd;
  exit hr
  #);
