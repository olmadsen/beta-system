ORIGIN '~beta/comlib/comlib';
INCLUDE 'ICalcTLB';

--PROGRAM: descriptor--
(# CLSID_Calc: @CLSID;
   IID_ICalc: @IID;
   pICalc: ^ICalc;
   i: @Int32Holder;
   hr: @HRESULT;
   
do 0->CoInitialize;
   
   ICalc_IID -> IID_ICalc; (* not pretty (:-) *)
   Calc_CLSID -> CLSID_Calc; (* not pretty (:-) *)
   
   'Create component and get interface ICalc'->putLine;
   
   (CLSID_Calc[], NONE, CLSCTX_INPROC_SERVER, IID_ICalc[])
     -> CoCreateInstance->pICalc[];
   
   'CoCreateInstance done'->putLine;

   (if pICalc[]<>NONE then
       'Succeeded creating component.'->putLine;
       '(17,4,i[])->pICalc.add '->putText;
       (17,4,i[])->pICalc.add->hr;
       (if hr.succeeded then
           '= '->putText; i->putInt;newLine;
        else
           'FAILED' -> putLine;
       if);
       '(17,4,i[])->pICalc.F_sub '->putText;
       (17,4,i[])->pICalc.subtract->hr;
       (if hr.succeeded then
           '= '->putText; i->putInt;newLine;
        else
           'FAILED' -> putLine;
       if);
       
       'Trying to release interface ICalc'->putline;
       pICalc.Release;
       'Succeeded releasing interface ICalc'->putline;
    else
       'Could not create component'->putline;
   if); 
   'CoUninitialize'->putline;
   CoUninitialize;
   'CoUninitialize done'->putline;
#)
