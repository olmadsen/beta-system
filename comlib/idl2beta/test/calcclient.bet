ORIGIN '~beta/comlib/comlib';
INCLUDE 'ICalc';

--PROGRAM: descriptor--
(# CLSID_Calculator: ^CLSID;
   IID_ICalc: @IID;
   pICalc: ^ICalc;
   i: @Integer;
   hr: @HRESULT;
   
do 0->CoInitialize;
   
   ICalc_IID -> IID_ICalc; (* hmmm... *)
   
   'Create component and get interface ICalc'->putLine;
   
   (CLSID_Calculator[], NONE, CLSCTX_INPROC_SERVER, IID_ICalc[])
     -> CoCreateInstance->pICalc[];
   
   'CoCreateInstance done'->putLine;

   (if pICalc[]<>NONE then
       'Succeeded creating component.'->putLine;
       '(17,4)->pICalc.F_add '->putText;
       (17,4,@@i)->pICalc.F_add->hres;
       (if hres.succeeded then
           '= '->putText; i->putInt;newLine;
        else
           'FAILED' -> putLine;
       if);
       '(17,4)->pICalc.F_sub '->putText;
       (17,4,@@i)->pICalc.F_sub->hres;
       (if hres.succeeded then
           '= '->putText; i->putInt;newLine;
        else
           'FAILED' -> putLine;
       if);
       
       'Trying to release interface ICalc'->putline;
       pICalc.Release;
       'Succeeded releasing interface ICalc'->putline;
    else
       'Could not create component'->putline;
   if); 
   'CoUninitialize'->putline;
   CoUninitialize;
   'CoUninitialize done'->putline;
#)
