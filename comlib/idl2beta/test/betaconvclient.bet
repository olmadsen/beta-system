ORIGIN '~beta/comlib/comlib';
INCLUDE 'calculator_server.bet';
INCLUDE 'Deep_Thought';

--PROGRAM: descriptor--
(# CLSID_Conv: @CLSID;
   CLSID_Calc: @CLSID;
   IID_IConv: @IID;
   IID_ICalc: @IID;
   pIConv: ^IConv;
   pICalc: ^ICalc;
   b: @BSTRHolder;
   t: ^text;
   b2: @BSTR;
   i: @int32Holder;
   hr: @HRESULT;
   
do 0->CoInitialize;
   
   IConv_IID -> IID_IConv; (* not pretty (:-) *)
   Conv_CLSID -> CLSID_Conv; (* not pretty (:-) *)
   
   'Create component and get interface IConv'->putLine;
  
   (CLSID_Conv[], NONE, 0, IID_IConv[])
     -> BetaCoCreateInstance -> pIConv[];
   'Fake CoCreateInstance for Conv done'->screen.putLine;
   
   'CoCreateInstance done'->putLine;

   (if pIConv[]<>NONE then
       'Succeeded creating component.'->putLine;
       '(17,b[])->pIConv.dec2hex '->putText;
       (17,b[])->pIConv.dec2hex->hr;
       (if hr.succeeded then
           '= '->putText; b.gettext->t[];
           (if t.length=0 then
               '<empty text!>' -> putLine;
            else
               t[] -> putline;
           if);
        else
           'FAILED' -> putLine;
       if);
       (if false then
           'ABBA' -> b2.settext;
           '(\'ABBA\',i[])->pIConv.hex2dec '->putText;
           (b2, i[])->pIConv.hex2dec->hr;
           (if hr.succeeded then
               '= '->putText; i->putInt; newLine;
            else
               'FAILED' -> putLine;
           if);
       if);
       
       'Trying to release interface IConv'->putline;
       pIConv.Release;
       'Succeeded releasing interface IConv'->putline;
    else
       'Could not create component'->putline;
   if); 
   'CoUninitialize'->putline;
   CoUninitialize;
   'CoUninitialize done'->putline;
#)
