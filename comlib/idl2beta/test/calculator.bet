ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/guienv/controls'
        '~beta/interfacebuilder/support/auxcontrols'
        '~beta/interfacebuilder/support/row';
(*BODY 'calculator_betabody';*)
BODY 'calculator_combody';
-- guienvLib: Attributes --
Calculator: window
  (#
     calculator_private: @<<SLOT CalculatorPrivate:Descriptor>>;
     open::< 
       (# 
       do
          'COM Calculator'->title;
          (205,235)->size;
          display.open;
          decRadioButton.open;
          hexRadioButton.open;
          pushbutton1.open;
          pushbutton2.open;
          pushbutton3.open;
          pushbutton4.open;
          pushbutton5.open;
          pushbutton6.open;
          pushbutton7.open;
          pushbutton8.open;
          pushbutton9.open;
          pushbutton10.open;
          pushbutton11.open;
          pushbutton12.open;
          pushbutton13.open;
          pushbutton14.open;
          pushbutton15.open;
          pushbutton16.open;
          pushbutton17.open;
          pushbutton18.open;
          pushbutton19.open;
          pushbutton20.open;
          pushbutton21.open;
          pushbutton22.open;
          pushbutton23.open;
          pushbutton24.open;
          INNER
       #);
     close::  (#  do terminate #);
     display: @row
       (* The numerical display of the calculator *)
       (#
          value_is_transient: 
            (* True iff the next action should make the value disappear *)
            @boolean;
          getint: integervalue
            (* Exits decimal value of the displayed number 
             * (which is dec or hex) 
             *)
            (# val: ^text
            do
               caption1.label->val[];
               (if hexRadioButton.state then val[]->hex2dec->val[];  if);
               val.reset;
               val.getint->value;
               
            #);
          putint:
            (* Sets the displayed number (in hex or dec) 
             * according to the entered decimal value
             *)
            (# dec: @integer; val: ^text
            enter dec
            do
               ''->val[];
               dec->val.putint;
               (if hexRadioButton.state then val[]->dec2hex->val[];  if);
               val[]->caption1.label;
               
            #);
          open::< 
            (# 
            do
               true->border.visible;
               borderStyles.shadowIn->border.style;
               5->distance;
               5->margin.bottom;
               5->margin.right;
               5->margin.top;
               5->margin.left;
               false->vertical.wrap;
               false->horizontal.wrap;
               alignRight->horizontal.alignment;
               alignCenter->vertical.alignment;
               (175,30)->size;
               caption1.open;
               (10,15)->position;
            #);
          caption1: @caption
            (#
               open::< 
                 (# 
                 do
                    '0'->label;
                    borderStyles.shadowOut->border.style;
                    (10,17)->size;
                    (160,6)->position;
                 #)
            #)
       #);
     hex2dec:
       (# hex,dec: ^text; 
       enter hex[]
       <<SLOT CalculatorHex2Dec:DoPart>>
       exit dec[]
       #);
     dec2hex:
       (# hex,dec: ^text; 
       enter dec[]
       <<SLOT CalculatorDec2Hex:DoPart>>
       exit hex[]
       #);
     decRadioButton: @groupRadioButton
       (#
          eventhandler:: 
            (#
               onStateChanged:: 
                 (# 
                 do
                    (if state then (* changed from hex to dec *)
                        display.caption1.label->hex2dec->display.caption1.label
                    if);
                    
                 #);
            #);
          open::< 
            (# 
            do
               true->state;
               'dec'->label;
               borderStyles.shadowOut->border.style;
               (50,16)->size;
               (15,55)->position;
            #)
       #);
     hexRadioButton: @groupRadioButton
       (#
          eventhandler:: 
            (#
               onStateChanged:: 
                 (# 
                 do
                    (if state then (* changed from dec to hex *)
                        display.caption1.label->dec2hex->display.caption1.label;
                        
                    if);
                    
                 #);
            #);
          open::< 
            (# 
            do false->state;
               'hex'->label;
               borderStyles.shadowOut->border.style;
               (45,16)->size;
               (65,55)->position;
            #)
       #);
     numberbutton: pushbutton
       (#
          eventhandler:: 
            (#
               onMouseUp:: 
                 (# number: @char; numbertext: ^text; 
                 do
                    label->numbertext[];
                    numbertext.reset;
                    numbertext.get->number;
                    (if display.value_is_transient then
                        ''->numbertext[]; false->display.value_is_transient; 
                     else
                        display.caption1.label->numbertext[];
                        (if '0'->numbertext.equal then ''->numbertext[];  if);
                        
                    if);
                    number->numbertext.put;
                    numbertext[]->display.caption1.label
                 #)
            #);
          
       #);
     letterbutton: pushbutton
       (#
          eventhandler:: 
            (#
               onMouseUp:: 
                 (# number: @char; numbertext: ^text; 
                 do
                    (if hexRadioButton.state then
                        label->numbertext[];
                        numbertext.reset;
                        numbertext.get->number;
                        (if display.value_is_transient then
                            ''->numbertext[];
                            false->display.value_is_transient;
                            
                         else
                            display.caption1.label->numbertext[];
                            (if '0'->numbertext.equal then
                                ''->numbertext[]; 
                            if);
                            
                        if);
                        number->numbertext.put;
                        numbertext[]->display.caption1.label
                    if);
                    
                 #)
            #);
          
       #);
     arithmeticbutton: pushbutton
       (#
          eventhandler::< 
            (#
               onMouseUp::< 
                 (# op1,op2: @integer; 
                 do
                    stack.pop->op1;
                    display.getint->op2;
                    INNER ;
                    op1->display.putint;
                    true->display.value_is_transient;
                    
                 #);
               
            #);
          
       #);
     pushbutton1: @numberbutton
       (#
          open::< 
            (# 
            do
               '1'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,180)->position;
               
            #)
       #);
     pushbutton2: @numberbutton
       (#
          open::< 
            (# 
            do
               '2'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (50,180)->position;
               
            #)
       #);
     pushbutton3: @numberbutton
       (#
          open::< 
            (# 
            do
               '3'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (85,180)->position;
               
            #)
       #);
     pushbutton4: @numberbutton
       (#
          open::< 
            (# 
            do
               '4'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,155)->position;
               
            #)
       #);
     pushbutton5: @numberbutton
       (#
          open::< 
            (# 
            do
               '5'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (50,155)->position;
               
            #)
       #);
     pushbutton6: @numberbutton
       (#
          open::< 
            (# 
            do
               '6'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (85,155)->position;
               
            #)
       #);
     pushbutton7: @numberbutton
       (#
          open::< 
            (# 
            do
               '7'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,130)->position;
               
            #)
       #);
     pushbutton8: @numberbutton
       (#
          open::< 
            (# 
            do
               '8'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (50,130)->position;
               
            #)
       #);
     pushbutton9: @numberbutton
       (#
          open::< 
            (# 
            do
               '9'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (85,130)->position;
               
            #)
       #);
     pushbutton10: @numberbutton
       (#
          open::< 
            (# 
            do
               '0'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,205)->position;
               
            #)
       #);
     pushbutton11: @pushbutton
       (#
          eventhandler:: 
            (#
               onMouseUp:: 
                 (# 
                 do
                    display.getint->stack.push;
                    true->display.value_is_transient;
                    
                 #);
               
            #);
          open::< 
            (# 
            do
               'ENTER'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (50,205)->position;
               
            #)
       #);
     pushbutton12: @arithmeticbutton
       (#
          eventhandler:: 
            (# onMouseUp::  (#  do <<SLOT CalculatorAdd:Descriptor>> #); 
            #);
          open::< 
            (# 
            do
               '+'->label;
               borderStyles.shadowOut
                 ->border.style;
               (30,20)->size;
               (120,130)->position;
               
            #)
       #);
     pushbutton13: @arithmeticbutton
       (#
          eventhandler:: 
            (#
               onMouseUp:: 
                 (# 
                 do
                    <<SLOT CalculatorSub:Descriptor>>
                 #);
               
            #);
          open::< 
            (# 
            do
               '-'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (120,155)->position;
               
            #)
       #);
     pushbutton14: @arithmeticbutton
       (#
          eventhandler:: 
            (# onMouseUp::  (#  do <<SLOT CalculatorDiv:Descriptor>> #); 
            #);
          open::< 
            (# 
            do
               '/'->label;
               borderStyles.shadowOut
                 ->border.style;
               (30,20)->size;
               (120,180)->position;
               
            #)
       #);
     pushbutton15: @arithmeticbutton
       (#
          eventhandler:: 
            (#
               onMouseUp:: 
                 (# 
                 do
                    <<SLOT CalculatorMul:Descriptor>>
                 #);
               
            #);
          open::< 
            (# 
            do
               '*'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (120,205)->position;
               
            #)
       #);
     pushbutton16: @pushbutton
       (#
          eventhandler::  (# onMouseUp::  (#  do terminate #);  #);
          open::< 
            (# 
            do
               'OFF'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (15,80)->position;
               
            #)
       #);
     pushbutton17: @pushbutton
       (#
          eventhandler:: 
            (# onMouseUp::  (#  do 0->display.putint;  #);  #);
          open::< 
            (# 
            do
               'CLR'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (15,105)->position;
               
            #)
       #);
     pushbutton18: @pushbutton
       (#
          eventhandler:: 
            (# onMouseUp::  (#  do 0->display.putint; stack.clear;  #); 
            #);
          open::< 
            (# 
            do
               'RESET'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (85,105)->position;
               
            #)
       #);
     pushbutton19: @letterbutton
       (#
          open::< 
            (# 
            do
               'A'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (155,80)->position;
               
            #)
       #);
     pushbutton20: @letterbutton
       (#
          open::< 
            (# 
            do
               'B'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (155,105)->position;
               
            #)
       #);
     pushbutton21: @letterbutton
       (#
          open::< 
            (# 
            do
               'C'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (155,130)->position;
               
            #)
       #);
     pushbutton22: @letterbutton
       (#
          open::< 
            (# 
            do
               'D'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (155,155)->position;
               
            #)
       #);
     pushbutton23: @letterbutton
       (#
          open::< 
            (# 
            do
               'E'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (155,180)->position;
               
            #)
       #);
     pushbutton24: @letterbutton
       (#
          open::< 
            (# 
            do
               'F'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (155,205)->position;
               
            #)
       #);
     Stack: @
       (#
          A: [100] @Integer;
          Top: @integer;
          Push:
            (# e: @integer
            enter e
            do
               top+1->top;
               (if top > A.range then A.range->A.extend if);
               e->A[top]
            #);
          Pop:
            (# e: @integer
            do (if Top <= 0 then 0->e else A[top]->e; top-1->top if); 
            exit e
            #);
          clear: (#  do 0->top #);
          isEmpty: booleanValue (#  do (0 = Top)->value #)
       #);
     
  #);


-- PROGRAM: Descriptor --
guienv
(#
   onStartApplication::  (#  <<SLOT ProgramStart:DoPart>> #);
   onQuit:: 
     (#  <<SLOT ProgramQuit:DoPart>> #);
   main: @calculator;
   
do main.open; 
#)  

