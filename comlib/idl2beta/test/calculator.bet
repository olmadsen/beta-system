ORIGIN '~beta/guienv/v1.6/guienv';
INCLUDE '~beta/guienv/v1.6/controls'
        '~beta/interfacebuilder/v1.6/support/auxcontrols'
        '~beta/interfacebuilder/v1.6/support/row';
BODY 'calculator_betabody';
-- guienvLib: Attributes --
Calculator: window
  (#
     open::< 
       (# 
       do
          'COM Calculator'->title;
          (175,235)->size;
          display.open;
          groupRadioButton1.open;
          groupRadioButton2.open;
          pushbutton1.open;
          pushbutton2.open;
          pushbutton3.open;
          pushbutton4.open;
          pushbutton5.open;
          pushbutton6.open;
          pushbutton7.open;
          pushbutton8.open;
          pushbutton9.open;
          pushbutton10.open;
          pushbutton11.open;
          pushbutton12.open;
          pushbutton13.open;
          pushbutton14.open;
          pushbutton15.open;
          pushbutton16.open;
          pushbutton17.open;
          INNER
       #);
     close::  (#  do terminate #);
     display: @row
       (# value_is_arithmetic_result: @boolean;
          getint: integervalue
            (# val: ^text
            do caption1.label -> val[];
               val.reset;
               val.getint -> value;
            #);
          value: @
            (# 
            enter caption1.label
            exit caption1.label
            #);
          open::< 
            (# 
            do
               true->border.visible;
               5->distance;
               5->margin.bottom;
               5->margin.right;
               5->margin.top;
               5->margin.left;
               false->vertical.wrap;
               false->horizontal.wrap;
               alignRight->horizontal.alignment;
               alignTop->vertical.alignment;
               (145,30)->size;
               caption1.open;
               (10,15)->position;
               
            #);
          caption1: @caption
            (#
               open::< 
                 (# 
                 do
                    '0'->label;
                    borderStyles.shadowOut->border.style;
                    (10,17)->size;
                    (130,5)->position;
                    
                 #)
            #)
       #);
     groupRadioButton1: @groupRadioButton
       (#
          open::< 
            (# 
            do
               true->state;
               'dec'->label;
               borderStyles.shadowOut->border.style;
               (50,16)->size;
               (15,55)->position;
               
            #)
       #);
     groupRadioButton2: @groupRadioButton
       (#
          open::< 
            (# 
            do
               false->state;
               'hex'->label;
               borderStyles.shadowOut->border.style;
               (45,16)->size;
               (110,55)->position;
               
            #)
       #);
     numberbutton: pushbutton
       (#
          eventhandler:: 
            (#
               onMouseUp:: 
                 (# number: @char; numbertext: ^text; 
                 do
                    label->numbertext[];
                    numbertext.reset;
                    numbertext.get->number;
                    (if display.value_is_arithmetic_result then
                        ''->numbertext[];
                        false -> display.value_is_arithmetic_result;
                     else
                        display.value->numbertext[];
                        (if '0'->numbertext.equal then ''->numbertext[]; if);
                    if);
                    number->numbertext.put;
                    numbertext[]->display.value
                 #)
            #);
          
       #);
     arithmeticbutton: pushbutton
       (# eventhandler::<
            (# onMouseUp::<
                 (# value: ^text;
                    op1, op2: @integer;
                 do display.value -> value[];
                    stack.pop -> op1;
                    display.getint -> op2;
                    '0' -> display.value;
                    INNER;
                    '' -> value[];
                    op1 -> value.putint;
                    value[] -> display.value;
                    true -> display.value_is_arithmetic_result;
                 #);
            #);
       #);
     pushbutton1: @numberbutton
       (#
          open::< 
            (# 
            do
               '1'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,155)->position;
               
            #)
       #);
     pushbutton2: @numberbutton
       (#
          open::< 
            (# 
            do
               '2'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (50,155)->position;
               
            #)
       #);
     pushbutton3: @numberbutton
       (#
          open::< 
            (# 
            do
               '3'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (85,155)->position;
               
            #)
       #);
     pushbutton4: @numberbutton
       (#
          open::< 
            (# 
            do
               '4'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,130)->position;
               
            #)
       #);
     pushbutton5: @numberbutton
       (#
          open::< 
            (# 
            do
               '5'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (50,130)->position;
               
            #)
       #);
     pushbutton6: @numberbutton
       (#
          open::< 
            (# 
            do
               '6'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (85,130)->position;
               
            #)
       #);
     pushbutton7: @numberbutton
       (#
          open::< 
            (# 
            do
               '7'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,105)->position;
               
            #)
       #);
     pushbutton8: @numberbutton
       (#
          open::< 
            (# 
            do
               '8'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (50,105)->position;
               
            #)
       #);
     pushbutton9: @numberbutton
       (#
          open::< 
            (# 
            do
               '9'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (85,105)->position;
               
            #)
       #);
     pushbutton10: @numberbutton
       (#
          open::< 
            (# 
            do
               '0'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (15,180)->position;
               
            #)
       #);
     pushbutton11: @pushbutton
       (#
          eventhandler::
            (# onMouseUp::
                 (# value: ^text;
                 do display.value -> value[];
                    value.reset;
                    value.getint -> stack.push;
                    '0' -> display.value;
                 #);
            #);
          open::< 
            (# 
            do
               'ENTER'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (50,180)->position;
               
            #)
       #);
     pushbutton12: @arithmeticbutton
       (# eventhandler::
            (# onMouseUp::
                 (# do <<SLOT CalculatorAdd: descriptor>> #);
            #);
          open::< 
            (# 
            do
               '+'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (120,105)->position;
               
            #)
       #);
     pushbutton13: @arithmeticbutton
       (# eventhandler::
            (# onMouseUp::
                 (# do <<SLOT CalculatorSub: descriptor>> #);
            #);
          open::< 
            (# 
            do '-'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (120,130)->position;
               
            #)
       #);
     pushbutton14: @arithmeticbutton
       (# eventhandler::
            (# onMouseUp::
                 (# do <<SLOT CalculatorDiv: descriptor>> #);
            #);
          open::< 
            (# 
            do
               '/'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (120,155)->position;
               
            #)
       #);
     pushbutton15: @arithmeticbutton
       (# eventhandler::
            (# onMouseUp::
                 (# do <<SLOT CalculatorMul: descriptor>>#);
            #);
          open::< 
            (# 
            do
               '*'->label;
               borderStyles.shadowOut->border.style;
               (30,20)->size;
               (120,180)->position;
               
            #)
       #);
     pushbutton16: @pushbutton
       (# eventhandler::
            (# onMouseUp::
                 (# 
                 do terminate
                 #);
            #);
          open::< 
            (# 
            do
               'OFF'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (85,80)->position;
               
            #)
       #);
     pushbutton17: @pushbutton
       (# eventhandler::
            (# onMouseUp::
                 (# 
                 do '0' -> display.value;
                 #);
            #);
          open::< 
            (# 
            do
               'CLR'->label;
               borderStyles.shadowOut->border.style;
               (65,20)->size;
               (15,80)->position;
               
            #)
       #);
     Stack: @
       (# A: [100] @Integer; Top: @integer;
          Push: 
            (# e: @integer
            enter e
            do top+1 -> top;
               (if top>A.range then A.range -> A.extend if);
               e -> A[top]
            #);
          Pop: 
            (# e: @integer
            do (if Top<=0 then 
                   0 -> e
                else
                   A[top] -> e;
                   top-1 -> top
               if);
            exit e
            #);
          isEmpty: booleanValue
            (# 
            do (0 = Top) -> value
            #)
       #)
  #);



-- PROGRAM: Descriptor --
guienv (# main: @calculator;  do main.open;  #)  

