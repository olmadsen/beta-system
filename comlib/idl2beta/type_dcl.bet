ORIGIN 'translate';

--type_dcl_lib: attributes--
do_typedef:
  (# t: ^idl.typedef;
     x: ^idl.attributeX;
     a: ^idl.attributes;
  enter t[]
  do outfile.indent;
     'typedef:' -> outfile.commentline;
     outfile.indent;
     t.gettype_declarator -> do_type_declarator;
     (if t.getattribute_opt -> optionalPresent then
         t.getattribute_opt -> x[];
         x.getattributes -> a[];
         outfile.CommentBegin;
         a.newscan
         (# first_done: @boolean;
         do (if first_done then
                ',' -> outfile.put;
             else
                true->first_done
            if);
            current[] -> do_attributeY;
         #);
         outfile.CommentEnd;
     if);
     ';' -> outfile.putline;
  #);
do_type_declarator:
  (# t: ^idl.type_declarator;
     info: @declarator_info;          
     do_type_spec:
       (# t: ^idl.type_spec;
       enter t[]
       do (if t.symbol
           // idl.float then
              'float NYI' -> outfile.puttext;
           // idl.double then
              'double NYI' -> outfile.puttext;
           // idl.signed_long_int then
              'signed_long_int NYI' -> outfile.puttext;
           // idl.signed_short_int then
              'signed_short_int NYI' -> outfile.puttext;
           // idl.unsigned_long_int then
              'unsigned_long_int NYI' -> outfile.puttext;
           // idl.unsigned_short_int then
              'unsigned_short_int NYI' -> outfile.puttext;
           // idl.char_type then
              'char_type NYI' -> outfile.puttext;
           // idl.boolean_type then
              'boolean_type NYI' -> outfile.puttext;
           // idl.octet_type then
              'octet_type NYI' -> outfile.puttext;
           // idl.any_type then
              'any_type NYI' -> outfile.puttext;
           // idl.sequence1 then
              'sequence1 NYI' -> outfile.puttext;
           // idl.sequence2 then
              'sequence2 NYI' -> outfile.puttext;
           // idl.string1 then
              'string1 NYI' -> outfile.puttext;
           // idl.string2 then
              'string2 NYI' -> outfile.puttext;
           // idl.scoped_name1
           // idl.scoped_name2
           // idl.scoped_name3 then
              t[] -> do_scoped_name;
              (if true
               // info.is_pointer then
                  '_Ref' -> outfile.puttext;
               // info.is_pointer_pointer then
                  '_RefRef' -> outfile.puttext;
              if);
              '(# #)' -> outfile.puttext;
           // idl.constr_struct_type then
              'constr_struct_type NYI' -> outfile.puttext;
           // idl.constr_union_type then
              'constr_union_type NYI' -> outfile.puttext;
           // idl.constr_enum_type then
              'constr_enum_type NYI' -> outfile.puttext;
           // idl.void_type_spec then
              'Object(# (* void *) #)' -> outfile.puttext;
           else
              'Oops, must have forgotten a type!' -> outfile.comment;
          if)
       #);
     do_x:
       (# t: ^idl.void_type_spec;
       enter t[]
       do 'do_x NYI' -> outfile.comment;
       #);
     do_declarators:
       (# d: ^idl.declarators;
       enter d[]
       do outfile[] -> info.out[];
          d.newscan
          (# d: ^idl.declarator;
             first_done: @boolean;
          do (if first_done then
                 ', ' -> outfile.puttext;
              else
                 true->first_done
             if);
             (info[], current[]) -> do_declarator;
          #);
          ': '->outfile.puttext;
       #);
  enter t[]
  do t.getdeclarators -> do_declarators;
     t.gettype_spec -> do_type_spec;
  #);

do_struct_type:
  (# t: ^idl.struct_type;
  enter t[]
  do outfile.indent;
     'do_struct_type NYI' -> outfile.commentline;
  #);
do_enum_type:
  (# t: ^idl.enum_type;
  enter t[]
  do outfile.indent;
     'do_enum_type NYI' -> outfile.commentline;
  #);
do_type_dcl_error:
  (# t: ^idl.type_dcl_error;
  enter t[]
  do outfile.indent;
     'do_type_dcl_error NYI' -> outfile.commentline;
  #);

--type_dcl_body: dopart--
do (if d.symbol
    // idl.typedef then
       d[] -> do_typedef;
    // idl.struct_type then
       d[] -> do_struct_type;
    // idl.enum_type then
       d[] -> do_enum_type;
    // idl.type_dcl_error then
       d[] -> do_type_dcl_error;
   if);
   
