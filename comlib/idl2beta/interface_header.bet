ORIGIN 'translate'

-- interface_header_lib: attributes--
do_inheritance_spec:
  (# i: ^idl.inheritance_spec;
     n: ^idl.scoped_names;
     
     numPrefixes: @integer;
  enter i[]
  do 0->numPrefixes;
     i.getscoped_names -> n[];
     n.newscan
     (# 
     do (if numPrefixes>0 then
            'Error: Multiple inheritance_specs not supported!'
              -> screen.putline;
            stop;
         else
            current[] -> do_scoped_name;
        if);
     #)
  #);
do_interface_attributes:
  (# do_uuid:
       (# do_uuid_rep:
            (# r: ^idl.uuid_rep;
            enter r[]
            do r.newscan
               (# k: ^idl.keys;
                  first_done: @boolean;
               do current[] -> k[];
                  (if first_done then
                      '-' -> outfile.put;
                   else
                      true->first_done
                  if);
                  k.newscan
                  (# n: ^idl.namekey;
                     c: ^idl.constkey;
                  do (if current.symbol
                      // idl.namekey then
                         current[] -> n[];
                         n.getnameappl -> NameApplToText -> outfile.puttext;
                      // idl.constkey then
                         current[] -> c[];
                         c.getconst -> ConstToText -> outfile.puttext;
                     if)
                  #);
               #)
            #);
          u: ^idl.uuid
       enter u[]
       do outfile.indent;
          outfile.CommentBegin;
          'uuid: ' -> outfile.puttext;
          u.getuuid_rep -> do_uuid_rep;
          outfile.CommentEnd;
          outfile.newline;
       #);
     do_iversion:
       (# v: ^idl.iversion
       enter v[]
       do outfile.indent;
          'do_iversion NYI' -> outfile.commentline;
       #);
     do_endpoint:
       (# e: ^idl.endpoint
       enter e[]
       do outfile.indent;
          'do_endpoint NYI' -> outfile.commentline;
       #);
     do_helpstring:
       (# e: ^idl.helpstring
       enter e[]
       do outfile.indent;
          'do_helpstring NYI' -> outfile.commentline;
       #);
     do_local:
       (# l: ^idl.local
       enter l[]
       do outfile.indent;
          'keyword found: \'local\'' -> outfile.commentline;
       #);
     do_pointer_default:
       (# do_ptr_attr:
            (# p: ^idl.ptr_attr;
               i: ^idl.iid_is;
            enter p[]
            do (if p.symbol
                // idl.ref then
                   'ref' -> outfile.puttext;
                // idl.ptr then
                   'ptr' -> outfile.puttext;
                // idl.unique then
                   'unique' -> outfile.puttext;
                // idl.iid_is then
                   'iid_is: ' -> outfile.puttext;
                   (p[]->i[]).getIdentifier 
                     -> IdentifierToText -> outfile.puttext;
               if);
            #);
          p: ^idl.pointer_default
       enter p[]
       do outfile.indent;
          outfile.CommentBegin;
          'do_pointer_default NYI: ' -> outfile.puttext;
          p.getptr_attr->do_ptr_attr;
          outfile.CommentEnd;
          outfile.newline;
       #);
     do_object:
       (# o: ^idl.object
       enter o[]
       do outfile.indent;
          'keyword found: \'object\'' -> outfile.commentline;
       #);
     a: ^idl.interface_attributes;
  enter a[]
  do a.newscan
     (# 
     do 
        (if current.symbol
         // idl.uuid then current[] -> do_uuid;
         // idl.helpstring then current[] -> do_helpstring;
         // idl.iversion then current[] -> do_iversion;
         // idl.endpoint then current[] -> do_endpoint;
         // idl.local then current[] -> do_local;
         // idl.pointer_default then current[] -> do_pointer_default;
         // idl.object then current[] -> do_object;
        if);
     #);
  #);

--interface_header_body: dopart--
do outfile.newline;
   outfile.indent;
   h.getIdentifier -> IdentifierToText -> outfile.puttext;
   ': ' -> outfile.puttext;
   (if h.getinheritance_specOpt -> optionalPresent then
       h.getinheritance_specOpt -> do_inheritance_spec;
   if);
   outfile.newline;
   (* The following will be matched with corresponding lines
    * in end of do_interface_body.
    *)
   2 -> outfile.indent.inc;
   outfile.indent;
   outfile.PatternBegin;
   outfile.newline;
   3 -> outfile.indent.inc;
   h.getinterface_attributes -> do_interface_attributes; 
   outfile.newline;
   
   
   
