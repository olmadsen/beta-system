ORIGIN '~beta/basiclib/file';
BODY 'private/betaoutfilebody' (* For now, it's a .bet text file *);
-- Lib:Attributes --

debug: (# exit false #);

OutputFile: file
  (#
     compact: @boolean;
     indent: @indenter;

     Identification:
       (# IdlFileName: ^text 
       enter IdlFileName[]  
       <<SLOT OutfileIdentification:dopart>> 
       #);
     Origin:
       (# chain: @boolean;
          PreviousFile: ^text;
       enter (chain, PreviousFile[])
       <<SLOT OutfileOrigin:dopart>> 
       #);

     Lib:
       (#  
       <<SLOT OutfileLib:dopart>> 
       #);

     Epilog:
       (# 
       <<SLOT OutfileEpilog:dopart>>
       #);

     Indenter: 
       (# indentlevel: @integer;
          inc: 
            (# i: @integer;
            enter i
            do indentlevel+i -> indentlevel;
               (if debug then
                   commentbegin;
                   '+'->put;
                   i->putint;
                   '='->put;
                   indentlevel->putint;
                   commentend;
               if)
            #);
          dec:
            (# i: @integer
            enter i
            do indentlevel-i -> indentlevel;
               (if debug then
                   commentbegin;
                   '-'->put;
                   i->putint;
                   '='->put;
                   indentlevel->putint;
                   commentend;
               if)
            #);
       do (for i:indentlevel repeat ' '->put for);
       #);

     PatternBegin:
       (# <<SLOT OutFilePatternBegin: dopart>> #);

     PatternEnd:
       (# <<SLOT OutFilePatternEnd: dopart>> #);

     CommentBegin:
       (# <<SLOT OutFileCommentBegin: dopart>> #);

     CommentEnd:
       (# <<SLOT OutFileCommentEnd: dopart>> #);

     SpaceComment: 
       (# c: ^text;
       enter c[]
       <<SLOT OutFileSpaceComment: dopart>>
       #);
     Comment: 
       (# c: ^text;
       enter c[]
       <<SLOT OutFileComment: dopart>>
       #);
     CommentLine: 
       (# c: ^text;
       enter c[]
       <<SLOT OutFileCommentLine: dopart>>
       #);
  #);
