ORIGIN '~beta/basiclib/file';
BODY 'private/betaoutfilebody' (* For now, it's a .bet text file *);
-- Lib:Attributes --

debug: (# exit false #);

OutputFile: file
  (#
     compact, opened: @boolean;
     
     do_open:
       (# 
       do true -> opened;
          INNER;
       #);
     if_open:
       (# 
       do (if opened then INNER if);
       #);
     
     openWrite: do_open
       (# 
       do THIS(File).openWrite;
       #);
     openAppend: do_open
       (# 
       do THIS(File).openAppend;
       #);
     close: if_open
       (# 
       do false -> opened;
          THIS(File).close;
       #);
     
     Identification: if_open
       (# IdlFileName: ^text 
       enter IdlFileName[]  
       <<SLOT OutfileIdentification:dopart>> 
       #);
     Origin: if_open
       (# chain: @boolean;
          PreviousFile: ^text;
       enter (chain, PreviousFile[])
       <<SLOT OutfileOrigin:dopart>> 
       #);

     Lib: if_open
       (#  
       <<SLOT OutfileLib:dopart>> 
       #);

     Epilog: if_open
       (# 
       <<SLOT OutfileEpilog:dopart>>
       #);

     Indent: @if_open
       (# indentlevel: @integer;
          inc: 
            (# i: @integer;
            enter i
            do indentlevel+i -> indentlevel;
               (if debug then
                   commentbegin;
                   '+'->put;
                   i->putint;
                   '='->put;
                   indentlevel->putint;
                   commentend;
               if)
            #);
          dec:
            (# i: @integer
            enter i
            do indentlevel-i -> indentlevel;
               (if debug then
                   commentbegin;
                   '-'->put;
                   i->putint;
                   '='->put;
                   indentlevel->putint;
                   commentend;
               if)
            #);
       do (for i:indentlevel repeat ' '->put for);
       #);

     PatternBegin: if_open
       (# <<SLOT OutFilePatternBegin: dopart>> #);

     PatternEnd: if_open
       (# <<SLOT OutFilePatternEnd: dopart>> #);

     CommentBegin: if_open
       (# <<SLOT OutFileCommentBegin: dopart>> #);

     CommentEnd: if_open
       (# <<SLOT OutFileCommentEnd: dopart>> #);

     SpaceComment: if_open
       (# c: ^text;
       enter c[]
       <<SLOT OutFileSpaceComment: dopart>>
       #);
     Comment: if_open
       (# c: ^text;
       enter c[]
       <<SLOT OutFileComment: dopart>>
       #);
     CommentLine: if_open
       (# c: ^text;
       enter c[]
       <<SLOT OutFileCommentLine: dopart>>
       #);
     
     puttext: if_open
       (# t: ^text
       enter t[]
       do t[] -> THIS(File).puttext;
       #);
     putline: if_open
       (# t: ^text
       enter t[]
       do t[] -> THIS(File).putline;
       #);
     putint: if_open
       (# i: @integer
       enter i
       do i -> THIS(File).putint;
       #);
     put: if_open
       (# c: @char
       enter c
       do c -> THIS(File).put;
       #);
     newline: if_open
       (# 
       do THIS(File).newline;
       #);
  #);
