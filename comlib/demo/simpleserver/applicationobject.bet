ORIGIN '~beta/guienv/guienv';
BODY 'applicationobjectbody';

INCLUDE 
'~beta/comlib/Unknwn'
'~beta/sysutils/objinterface'
'~beta/comlib/comlib';


-- guienvlib: attributes --
SimpleServer_CLSID: (# exit 'E3A24D74-041A-11d4-875E-00C04F68A452' #);
ISimpleServer_IID: (# exit 'BF2B1B30-0413-11d4-875E-00C04F68A452' #);

ApplicationObject: IUnknown
  (# errMsg: @Text;
     debug: @boolean;
     
     m_cRef: @int32u; (* Used for reference counting. *)
     
     Unknown_IID, SimpleServer_IID: @IID;
     
     init:
       (# 
       do (* TRUE -> debug; *)
          IUnknown_IID->Unknown_IID;
          ISimpleServer_IID->SimpleServer_IID;
       #);
     
     QueryInterface::<
       (# aGUID: @GUID
       <<SLOT QueryInterfaceImpl: doPart>>
       #);
     
     AddRef::<
       (# 
       do 'addref' -> screen.putline;
          'addref1' -> screen.putline;
          'current object: ' -> puttext;
          (THIS(AddRef)[],screen[]) -> printObject;
          screen.newline;
          'origin: ' -> puttext;
          THIS(AddRef)[]->getOrigin->getPatternname -> screen.putline;
          'objects done'->screen.putline;
          (if true then 
              (# dummy: @char;
              do 'errormsg start' -> screen.putline;
                 (# dummy: @char;
                 do 'errormsg 1' -> screen.putline;
                    (# d:@char do 'applobj_AddRefImpl begin.' -> errMsg.putLine; #);
                    'errormsg 2' -> screen.putline;
                    (# d:@char do errMsg[] -> screen.putline; #);
                    'errormsg 3' -> screen.putline;
                 #);
              #);
          if);
          
          'addref2' -> screen.putline;
          m_cRef + 1 -> m_cRef -> result;
          'addref3' -> screen.putline;
          
          (if true then 
              errMsg.clear;
              'applobj_AddRefImpl done.' -> errMsg.putLine; 
              errMsg[] -> screen.putline;
          if);
          'addref4' -> screen.putline;
          
          (*<<SLOT AddRefImpl: doPart>>*) 
       #);
     
     Release::<
       (# <<SLOT ReleaseImpl: doPart>> #);
     
     print:<
       (# str: @BSTR;
       <<SLOT printImpl: doPart>> 
       #);
  #);
