ORIGIN '~beta/comlib/comlib';
INCLUDE '~beta/win32lib/winnt';
INCLUDE '~beta/comlib/oleauto';
INCLUDE '~beta/comlib/MsApplication/Excel8';

--PROGRAM: descriptor--
(# CLSID_XL: ^CLSID;
   clsstr: @BSTR;
   IID_IDispatch: @IID;
   str: @BSTR;
   empty: @VARIANT;
   hr: @HRESULT;
   th: @TextHolder;
   ih: @int32holder;
   
   pDisp: ^IDispatch;
   
   excel_progid: (# exit 'Excel.Application' #);
   
do 0->CoInitialize;
   
   excel_progid -> clsstr.setText;
   clsstr[] -> CLSIDFromProgID -> CLSID_XL[];
   IDispatch_IID -> IID_IDispatch; 
   
   'Create component and get dispinterface'->putLine;
   
   (CLSID_XL[], NONE, CLSCTX_LOCAL_SERVER, IID_IDispatch[])
     -> CoCreateInstance->pDisp[];
   
   'CoCreateInstance done'->putLine;

   (if pDisp[]<>NONE then
       'Succeeded creating component.'->putLine;
       
       'Invoking pDisp.Visible' -> putline;
       ((IID_NULL).binary[], th[], 1, LOCALE_SYSTEM_DEFAULT, ih[])
         -> pDisp.GetIdsOfNames
         -> hr;
       
       'Releasing interfaces' -> putline;
       (if pDisp[]<>NONE then 
           pDisp.Release; 
           'Succeeded releasing dispinterface'->putline;
       if);
    else
       'Could not create component'->putline;
   if); 
   'CoUninitialize'->putline;
   CoUninitialize;
   'CoUninitialize done'->putline;
#)



