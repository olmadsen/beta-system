ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/comlib/comtypes'
        '~beta/comlib/comlib'
        '~beta/comlib/oleidl'
        '~beta/guienv/private/winnt/guienv_ntiprivate'
        '~beta/win32lib/winerror'
        'additionslib';
-- program: Descriptor --
guienv
  (#
     mainWindow: @window
       (#
          ;
          SKAL_LIGGE_I_WINDOWLIB: (#  #);
          CCmdTarget: (#  #);
          COleDropTarget: CCmdTarget
            (#
               private: @
                 (#
                    pDropTarget: ^IDropTargetType;
                    IDropTargetType: IDropTarget
                      (#
                         DragEnter::< 
                           (#  do 'DragEnter called'->putline #);
                         DragOver::<  (#  do 'DragOver called'->putline #);
                         DragLeave::< 
                           (#  do 'DragLeave called'->putline #);
                         Drop::<  (#  do 'DragDrop called'->putline #)
                      #)
                 #);
               init:
                 (# 
                 do &private.IDropTargetType[]->private.pDropTarget[]
                 #);
               ;
               register:
                 (#
                    onError:< exception
                      (# 
                      do
                         'COleDropTarget error: unable to register window.'
                           ->msg.append
                      #);
                    theCanvas: ^Canvas;
                    ;
                    canvasHandle:
                      (# handle: @integer
                      do
                         (if theCanvas[] <> none then
                             theCanvas.InterfaceObjectID->handle
                          else
                             'canvasHandle: theCanvas[]=none'->putline
                         if)
                      exit handle
                      #);
                    hr: @HRESULT
                 enter theCanvas[]
                 do
                    'Register called'->putline;
                    (canvasHandle,private.pDropTarget[])->MyRegisterDragDrop
                      ->hr;
                    (if hr.succeeded then
                        'RegisterDragDrop succeeded'->putline
                     else
                        'RegisterDragDrop failed!'->putline
                    if);
                    (if hr.value
                     // S_OK then
                        'S_OK'->putline
                     // DRAGDROP_E_INVALIDHWND then
                        'DRAGDROP_E_INVALIDHWND'->putline
                     // DRAGDROP_E_ALREADYREGISTERED then
                        'DRAGDROP_E_ALREADYREGISTERED'->putline
                     else
                        'hr er underlig'->putline
                    if)
                 #);
               revoke: (#  #)
            #);
          ;
          ;
          TING_SOM_HOERER_TIL_NETOP_DETTE_VINDUE: (#  #);
          DT: @COleDropTarget (#  #);
          open::< 
            (# 
            do
               (486,338)->size;
               clientCanvas.open;
               'Drag\'n\'drop demo'->title;
               ;
               DT.init;
               clientCanvas[]->DT.register
            #);
          eventHandler::<  (# onAboutToClose::<  (#  do onExit #) #);
          menubarType:: 
            (#
               fileMenu: @menu
                 (#
                    openItem: @menuItem
                      (#
                         eventHandler:: 
                           (# onSelect::  (#  do onOpen;  #);  #);
                         open::  (#  do '&Open'->name; 'o'->key #)
                      #);
                    closeItem: @menuItem
                      (#
                         eventHandler:: 
                           (# onSelect::  (#  do onClose #);  #);
                         open::  (#  do '&Close'->name; 'c'->key #)
                      #);
                    exitItem: @menuItem
                      (#
                         eventHandler:: 
                           (# onSelect::  (#  do onExit #);  #);
                         open::  (#  do 'E&xit'->name; 'x'->key;  #)
                      #);
                    sep1: @separator;
                    open:: 
                      (# 
                      do
                         '&File'->name;
                         openItem.open;
                         openItem[]->append;
                         closeItem.open;
                         closeItem[]->append;
                         sep1.open;
                         sep1[]->append;
                         exitItem.open;
                         exitItem[]->append
                      #)
                 #);
               shortcutsMenu: @menu
                 (#
                    shortcut1Item: @menuItem
                      (#
                         eventHandler:: 
                           (# onSelect::  (#  do onShortcut1 #);  #);
                         open::  (#  do 'Shortcut &1'->name; '1'->key #)
                      #);
                    open:: 
                      (# 
                      do
                         'Shortcuts'->name;
                         Shortcut1Item.open;
                         Shortcut1Item[]->append
                      #)
                 #);
               open::< 
                 (# 
                 do
                    fileMenu.open;
                    fileMenu[]->append;
                    ShortcutsMenu.open;
                    ShortcutsMenu[]->append;
                    INNER
                 #)
            #);
          clientCanvas: @canvas
            (#
               open::< 
                 (# 
                 do
                    4->border.style;
                    true->border.visible;
                    (449,287)->size;
                    (18,32)->position;
                    
                 #)
            #);
          ;
          onOpen:< (#  #);
          onClose:< (#  #);
          onExit:< (#  do terminate #);
          ;
          onShortcut1:< (#  #)
       #);
     ;
     InitOLE:
       (# hr: @HRESULT
       do
          0->OleInitialize->hr;
          (if hr.failed then 'OleInitialize failed!'->putline if)
       #)
  do InitOLE; mainWindow.open
  #)  

