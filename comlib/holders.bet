ORIGIN '~beta/basiclib/v1.6/betaenv';
BODY 'private/textholderbody';
--LIB: attributes--

(*
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-98
 *       All rights reserved.
 *)


(* Holder patterns for predefined BETA types *)

integerHolder: Holder
  (# value: @integer #);
shortIntHolder: Holder
  (# value: @shortInt #);
charHolder: Holder
  (# value: @char #);
booleanHolder: Holder
  (# value: @boolean #);
realHolder: Holder
  (# value: @real #);
int8Holder: Holder
  (# value: @int8 #);
int8uHolder: Holder
  (# value: @int8u #);
int16Holder: Holder
  (# value: @int16 #);
int16uHolder: Holder
  (# value: @int16u #);
int32Holder: Holder
  (# value: @int32 #);
int32uHolder: Holder
  (# value: @int32u #);
int64Holder: Holder
  (# value: @int64 #);
int64uHolder: Holder
  (# value: @int64u #);

(* Holder for COM references (interfaces) *)
RefHolder: Holder
  (# type:< COM;
     ref: ^type;
  #);

(* Holder for text objects *)

TextHolder: Holder
  (* Externally allocated string used for pointer-to-text parameters
   * in COM interfaces.
   *)
  (# charptr: @integer
       (* The pointer to the external string *);
     allocate: 
       (* Allocate length bytes (default 256) using malloc, and assign the
        * result to charptr. You may want to explicitly free THIS(TextHolder)
        * before a reinitialization.
        *)
       (# length: @integer;
       enter length 
       do <<SLOT TextHolderInit: descriptor>>
       #);
     free: 
       (* Free the externally allocated string. The chars of the externally
        * allocated string will be unaccessible after this operation.
        *)
       (# <<SLOT TextHolderFree: dopart>> #);
     set: 
       (* Initializes THIS(TextHolder) to be large enough to hold the
        * chars of T, and then copies the chars of T to
        * THIS(TextHolder). You may want to explicitly free
        * THIS(TextHolder) before this operation, if this is a
        * reinitialization.  For convenience, it also exits the char
        * pointer.
        *)
       (# T: ^text; 
       enter T[]
       do <<SLOT TextHolderSet: descriptor>>
       exit charptr
       #);
     get:
       (* Return the chars of THIS(TextHolder) copied into the text T *)
       (# T: ^text;
       do <<SLOT TextHolderGet: descriptor>>  
       exit T[]
       #);
     getChars:
       (* Return a repetition, with the chars of THIS(TextHolder)
        * copied to it
        *)
       (# R: [0]@char;
       do <<SLOT TextHolderGetChars: descriptor>>
       exit R
       #);
     length: IntegerValue
       (* Return the string-length if THIS(TextHolder), i.e., the
        * number of chars before the NULL-char in the externally
        * allocated string.
        *)
       (# <<SLOT TextHolderLength: dopart>> #);
     inxPut:
       (* Put ch at index inx in the externally allocated
        * TextHolder. The first char is at index 0. NOTICE: There is no
        * index check, it is up to the programmer to ensure, that it is
        * allowed to put at the given index.
        *)
       (# inx: @integer;
          ch: @char;
       enter (inx, ch) 
          <<SLOT TextHolderInxPut: dopart>>
       #);
     inxGet:
       (* Obtain the char at the given index in the externally
        * allocated string.  The first char is at index 0.
        *)
       (# inx: @integer;
          ch: @char;
       enter inx
          <<SLOT TextHolderInxGet: dopart>>
       exit ch
       #);
     <<SLOT TextHolderLib: attributes>>;
  #);

