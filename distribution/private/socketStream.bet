ORIGIN '~beta/basiclib/v1.4/basicsystemenv';
(* 
 * $RCSfile: socketStream.bet,v $ $Revision: 1.1.1.1 $ $Date: 1994-08-22 08:37:16 $
 *
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-94
 *       All rights reserved.
 *)
BODY 'socketStreamBody';

--- include '~beta/objectserver/v2.1/RepetitionObject'
--- include '~beta/basiclib/v1.4/iostate'

---systemlib:attributes ---

socketStream: 
  (# ios: @IOstate;
     
     sockfd: @Integer; (* The socket descriptor of this stream. *)
     init:
       (# enter sockfd 
       do sockfd -> ios.init;
       #);
     
     sockEntry:
       (# conBroken:< Exception
            (* Raised if this socket connection was broken. *)
            (# 
            do INNER;
               (if continue //false then
                   'sockEntry.conBroken ' -> msg.prepend;
               if)
            #);
          timeOut:< Object
            (* Raised if a read or write timed out. 
             * If timeOut returns, the operation is retried.*);
          
       do INNER
       #);
     
     PutInt: sockEntry
       (# (* private: *) wrote, totalWrote, toWrite: @Integer;
          i: @Integer;
       enter i
       <<SLOT ssPutIntBody:dopart>>
       #);
     
     GetInt: sockEntry
       (# (* private: *) read, totalRead, toRead: @Integer; waited: @Boolean;
          i: @Integer;
       <<SLOT ssGetIntBody:dopart>>
       exit i
       #);
     
     PutRep: sockEntry
       (# (* private: *) wrote, totalWrote, toWrite: @Integer;
          rs: ^repetitionObject;
       enter rs[]
       <<SLOT ssPutRepBody:dopart>>
       #);
     
     GetRep: sockEntry
       (* Exits NONE in case the repetition object has size 0 *)
       (# (* private: *) read, totalRead, toRead, size: @Integer; 
          (* private: *) waited: @Boolean;
          rs: ^repetitionObject;
       enter rs[]
       <<SLOT ssGetRepBody:dopart>>
       exit rs[]
       #);
     
     CloseStream: (# <<SLOT ssCloseBody:dopart>> #);
     ShutDownStream: (# <<SLOT ssShutDownBody:dopart>> #);
  #);
