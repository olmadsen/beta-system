ORIGIN '~beta/basiclib/v1.5/betaenv';
(* 
 * $RCSfile: dottable.bet,v $ 
 * $Revision: 1.3 $ 
 * $Date: 1996-06-21 10:49:55 $
 *
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-96
 *       All rights reserved.
 *)

--- lib:attributes ---

(* DOTtable
 * ========
 * 
 * DOTinit should be called before using DOT.
 * 
 * DOThandleInsert inserts an object into the table and returns a handle
 * to be used if the object reference needs to be looked up. The onDeleteAdr
 * enter parameter is a callback function called when the objec gets deleted 
 * from the DOTtable. It should point out a subpattern of DOTonDelete.
 * 
 * DOThandleLookup returns the object denoted by the index given. 
 * Make sure that lookup is not called with an index that was deleted.
 * When the object was deleted, the DOTonDelete registered at insertion
 * time was called. *)

DOThandleInsert: external
  (# objAdr: @Integer;
     onDeleteAdr: @Integer; (* As returned from makeCBF *)
     allowCompaction: @Integer; (* Should be non-zero (TRUE) *)
     handle: @Integer;
  enter (objAdr,onDeleteAdr,allowCompaction)
  exit handle
  #);

DOThandleLookup: external
  (# handle: @Integer;
     objAdr: @Integer;
  enter handle
  exit objAdr
  #);

DOThandlePerformCompaction: external 
  (# onDeleteAdr: @Integer;
     (* As returned from makeCBF. Should be 0. 
      * See ~betarun/v2.7/$/C/dot.h *)
  enter onDeleteAdr
  #);

DOTinit: external (# #);


(* makeCBF
 * =======
 * 
 * Use makeCBF to install a callback function once and then pass the
 * address as an integer to DOThandleInsert. *)

makeCBF: External
  (# pat: ##external;
     cb: @integer;
  enter pat##
  exit cb
  #);


(* DOTonDelete: Proposed super pattern for callback functions informing
 * about deletion of objects from the DOT table. *)

DOTonDelete: external
  (# handle: @Integer; (* The handle that was deleted. *)
  enter handle
  do CExternalEntry;
     INNER
  #);
