ORIGIN '~beta/basiclib/v1.4/betaenv';
(* 
 * $RCSfile: dottable.bet,v $ $Revision: 1.1.1.1 $ $Date: 1994-08-22 08:37:10 $
 *
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-94
 *       All rights reserved.
 *)
OBJFILE default '$/dot.o';

--- lib:attributes ---

(* DOTtable
 * ========
 * 
 * DOTinit should be called before using DOT.
 * 
 * DOThandleInsert inserts an object into the table and returns a handle
 * to be used if the object reference needs to be looked up. The onDeleteAdr
 * enter parameter is a callback function called when the objec gets deleted 
 * from the DOTtable. It should point out a subpattern of DOTonDelete.
 * 
 * DOThandleLookup returns the object denoted by the index given. 
 * Make sure that lookup is not called with an index that was deleted.
 * When the object was deleted, the DOTonDelete registered at insertion
 * time was called. *)

DOThandleInsert: external
  (# objAdr: @Integer;
     onDeleteAdr: @Integer; (* As returned from makeCBF *)
     handle: @Integer;
  enter (objAdr,onDeleteAdr)
  exit handle
  #);

DOThandleLookup: external
  (# handle: @Integer;
     objAdr: @Integer;
  enter handle
  exit objAdr
  #);

DOThandlePerformCompaction: external (#  #);

DOTinit: external (# #);


(* makeCBF
 * =======
 * 
 * Use makeCBF to install a callback function once and then pass the
 * address as an integer to DOThandleInsert. *)

makeCBF: External
  (# pat: ##external;
     cb: @integer;
  enter pat##
  exit cb
  #);


(* DOTonDelete: Proposed super pattern for callback functions informing
 * about deletion of objects from the DOT table. *)

DOTonDelete: external
  (# handle: @Integer; (* The handle that was deleted. *)
  enter handle
  do CExternalEntry;
     INNER
  #);
