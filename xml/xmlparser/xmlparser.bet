ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/containers/list';
BODY 'private/xmlparserbody';

--- Lib:Attributes ---

(*
 * This XML parser is an interface to the expat parser, that has the
 * following copyright notice:
 *
 * "Copyright (c) 1998, 1999, 2000 Thai Open Source Software Center Ltd. 
 * Expat is freely available with source under a very liberal license (the MIT license)."
 *
 * See doc/expat.html for more information.
 *
 *)

AttributeList: List (# Element:: Attribute; #);

Attribute: 
  (# name: ^Text;
     value: ^Text;
  enter (name[], value[])
  exit (name[], value[])
  #);

XMLParser:
  (# Init:
       (# encoding: ^Text;
       enter encoding[]
       <<SLOT XMLParserInit:DoPart>>
       #);
     
     InitNS: Init
       (# namespaceSeparator: @Char;
       enter namespaceSeparator
       <<SLOT XMLParserInitNS:DoPart>>
       #);
     
     Close:
       (# <<SLOT XMLParserClose:DoPart>> #);
          
     (* Exception handling method. *)
     onError:< Exception
       (# errorString: ^Text;
          errorLine: @Integer;
          errorColumn: @Integer;
          errorByteIndex: @Integer;
          errorByteCount: @Integer;
       enter (errorString[], errorLine, errorColumn, errorByteIndex, errorByteCount)
       do INNER;
       #);
     
     (* Callback virtual methods. *)
     onElementStart:<
       (# name: ^Text;
          attributes: ^AttributeList;
       enter (name[], attributes[])
       do INNER;
       #);
     
     onElementEnd:<
       (# name: ^Text;
       enter name[]
       do INNER;
       #);
     
     onCharacterData:<
       (# data: ^Text;
       enter data[]
       do INNER;
       #);
     
     onProcessingInstruction:<
       (# target: ^Text;
          data: ^Text;
       enter (target[], data[])
       do INNER;
       #);
     
     onComment:<
       (# data: ^Text;
       enter data[]
       do INNER;
       #);
     
     onCDataStart:<
       (# 
       do INNER;
       #);
     
     onCDataEnd:<
       (#
       do INNER;
       #);
     
     onDefault:<
       (# data: ^Text;
       enter data[]
       do INNER;
       #);
     
     onUnparsedEntity:<
       (# entityName: ^Text;
          base: ^Text;
          systemId: ^Text;
          publicId: ^Text;
          notationName: ^Text;
       enter (entityName[], base[], systemId[], publicId[], notationName[])
       do INNER;
       #);
     
     onNotation:<
       (# notationName: ^Text;
          base: ^Text;
          systemId: ^Text;
          publicId: ^Text;
       enter (notationName[], base[], systemId[], publicId[])
       do INNER;
       #);
     
     onNamespaceStart:<
       (# prefix: ^Text;
          uri: ^Text;
       enter (prefix[], uri[])
       do INNER;
       #);
     
     onNamespaceEnd:<
       (# prefix: ^Text;
       enter prefix[]
       do INNER;
       #);
     
     onExternalEntity:<
       (# context: ^Text;
          base: ^Text;
          systemId: ^Text;
          publicId: ^Text;
       enter (context[], base[], systemId[], publicId[])
       do INNER;
       #);
     
     <<SLOT XMLParserLib:Attributes>>;
     Private: @<<SLOT XMLParserPrivate:Descriptor>>;
     
     inputStream: ^Stream;
  enter inputStream[]
  <<SLOT XMLParserDoPart: DoPart>>
  #);
