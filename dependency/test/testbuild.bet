origin '~beta/mps/v5.2/astlevel'; 
include '../dependency';
(*********************************
 * test of build property;
 * the files foo.bet and foo.ast MUST be present,
 * and notice that if no foo.ast, foo.bet will NOT be parsed;
 * this should fixed.
 * usage 1
 *         testbuild foo
 * usage 2
 *         touch viggo.c
 *         touch viggo.o
 *         testbuild foo
 *    this will for sun4s select only the first build entry
 *)
---program:descriptor---
(# AST: @ astinterface;
   D: @AST.dependencyGraph;
   FileName: ^text;
do AST.astLevelInit;
   (*(ast.trace.onParse,true)->ast.trace.set;
   (ast.trace.fragmentOpen,true)->ast.trace.set;
    (ast.trace.topOpen,true)->ast.trace.set;*)
   D.Init;
   D.xverboselevel.actions -> D.xverboselevel;
   
   (if noOfArguments > 1 then
       2 -> arguments -> Filename[]
    else 'testdep'->Filename[]
   if);
   (for i: 4 repeat
        (if i
         // 1 then
            'sun4s'->D.targetDirectory;
            'sun4s'->D.targetMachine;
         // 2 then
            'sgi'->D.targetDirectory;
            'sgi'->D.targetMachine;
         // 3 then
            'ppcmac'->D.targetDirectory;
            'ppcmac'->D.targetMachine;
         // 4 then
            'hpux9pa'->D.targetDirectory;
            'hpux9pa'->D.targetMachine;
        if);   
        
        '\nBuild for target: '->puttext; D.targetDirectory[]->putline;
        FileName[] -> D.scanExtent
        (#  BuildProperty::
             (#
             do 'Build: '->puttext; objfile[]->putLine;
                '   in: '->puttext; directory[]->putline;
                ' with: '-> puttext; command[] -> putline;
             #)
        #);
   for)
   
#)
   
