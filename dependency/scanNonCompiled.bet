ORIGIN 'dependency';
LIB_DEF 'scanNonCompiled' '../lib';
BODY 'private/scanNonCompiledBody'
---DependencyGraphLib:attributes---
ScanNonCompiled: Scanner
  (# <<SLOT scanNonCompiledLib:attributes>>;
     init::<
       (#
       do INNER;
          (if asmExt[] = NONE then '..s'->asmExt[] if);
          (if binExt[] = NONE then '.go'->binExt[] if);
          (* Hack! This inf. is also in DepGraph! *)
          this(ScanNonCompiled).nti -> this(dependencyGraph).nti;
          this(ScanNonCompiled).b2c -> this(dependencyGraph).b2c;
       #);
     beforeGroup:: (# <<SLOT ScanNonCompiledBeforeGroup:doPart>> #);
     afterGroup::< (# <<SLOT ScanNonCompiledAfterGroup:doPart>> #);
     translate:<
       (# fg: ^fragmentGroup
       enter fg[]
       do INNER
       #);

     InsertSubDir:
       (* Inserts the directory name TargetDirectory immedidately before the
        * base name of the entered path name. E.g. if TargetDirectory='sun3'
        * and path='/home/frede/beta/system/v3.9/control' then the result will
        * be:      '/home/frede/beta/system/v3.9/sun3/control'.
        * Another example:  path='fusk' will result in: 'sun3/fusk'.
        *)
       (# path: ^text; dirCh: @text;
          lastSlash,L: @integer;
          asmDir: @boolean
       enter(path[],asmDir)
       <<SLOT dependency_InsertSubDir:doPart>>
       exit path[]
       #);

     CreateAsmFileName: 
       (# g: ^FragmentGroup; T: ^text
       enter g[]
       <<SLOT dependency_CreateAsmFileName:doPart>>
       exit T[]
       #);
     CreateObjFileName: 
       (# g: ^FragmentGroup; T: ^text
       enter g[]
       <<SLOT dependency_CreateObjFileName:doPart>>
       exit T[]
       #);

     theGroup: ^fragmentGroup;
     checkAll,genAll,
     doAsm,binaryCodeGen: @boolean;
     (* the following variables MUST be set by init - should be cleaned up! *)
     b2c,nti: @boolean;
     asmExt,binExt: ^text; (* Hack! This inf. is also in DepGraph! *)
  <<SLOT ScanNonCompiledDo:doPart>>
  #);

ScanForms:
  (* scan all fragment forms in a group *)
  (# FG: ^FragmentGroup; 
     current: ^FragmentForm;
  enter FG[]
  <<SLOT dependency_ScanForms:doPart>>
  #);

ScanLinks:
  (* scan all fragment Links in a group *)
  (# FG,nfg: ^FragmentGroup;
     current: ^text(*FragmentGroupLink*);
  enter FG[]
  <<SLOT dependency_ScanLinks:doPart>>
  #);
