ORIGIN '../dependency';
INCLUDE '~beta/sysutils/v1.4.2/envstring'
---dependencyGraphLib: attributes ----
ExpandMacro:
   (* Enters a text string and replaces every occurence of the char '$' 
    * in it with the string TargetDirectory (assumed not to contain any '$').
    * WARNING : This operation destroys the entered text.
    *)
   (# macroChar: (# exit '$' #);
      T: ^text;
   enter T[]
   do t[] -> expandEnvVar -> t[];
      Loop: macroChar -> T.findCh
      (#
      do (inx,inx) -> T.Delete;   (* Delete the '$'. *)
         (TargetDirectory[],inx) -> T.Insert;
         restart loop      (* Necessary? *)
      #);
   exit T[]
   #);

ScanForms:
  (* scan all fragment forms in a group *)
  (# FG: ^FragmentGroup; 
     current: ^FragmentForm;
  enter FG[]
  do FG.FragmentList.scan
     (#
     do (if current.type // formType then
            current.f[] -> this(ScanForms).current[];
            inner ScanForms;
     if)#)
  #);

ScanLinks:
  (* scan all fragment Links in a group *)
  (# FG: ^FragmentGroup; 
     current: ^FragmentLink;
  enter FG[]
  do
     FG.FragmentList.scan
     (# FL: ^fragmentLink; T: ^text
     do (if current.type // linkType then
            newfragmentLink -> fl[] -> current.F[];
            current.fullNameOfLink[] -> fl.fullNameOfLink[];
            current.localName[]-> fl.localName[];
            current.name[]-> fl.name;
            FG[] -> fl.father;
            fl[] ->this(ScanLinks).current[];
            (*397->trace
            (#do 'include:'->xT;
               current.fullNameOfLink[]->xT; xN;
               current.localName[]->xT; xN;
               current.name[]->xT; xN;
             #);*)
            INNER ScanLinks
        if)
     #)
  #);

