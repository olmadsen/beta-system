ORIGIN '../time';
INCLUDE '~beta/maclib/v3.1/mactypes'
        '~beta/maclib/v3.1/osutils';
        
BUILD default ':$$/timeInt.obj' ':external/timeInt.c' 'mrc -shared_lib_export on -proto strict -o $0 $1';

-- systemTimeDoPart: DoPart --
do
   (# tt: @longInt; 
   do tt[]->GetDateTime; 
     (* Henryml 20/2 1998:
	  * GetDateTime delivers a Macintosh date (seconds since January 1, 1904)
	  * This can be converted to a UNIX date by clearing the most significant
	  * bit. This is what happens in the following code.
	  *)
   	 tt %Band (%Bnot (1 %sll 31)) -> t;
	 INNER systemTime;  
	#);   

-- preciseTimeBody: Descriptor --
(# tt: @LongInt; 
do tt[]->GetDateTime; tt->time; 0->millitm; INNER preciseTime; 
#)  

-- cpuTimeDoPart: DoPart --
do 0->t; INNER ;   

-- formatTimeDoPart: DoPart --
do
   &text[]->readable[];
     (# 
        getdatestring: External
          (# dateTime: @Integer; result: ^pascalString; 
          enter (dateTime,result[])
          #);
        time: @PascalString;
        
     do (t,time[])->getdatestring; time->readable[]; 
     #)  

