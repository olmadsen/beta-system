ORIGIN '../time';
LIB_ITEM 'sysutilstime';
INCLUDE '~beta/unixlib/unixinterface';

-- systemTimeDoPart: dopart --
do 0 -> unixtime -> t; INNER;
   
-- cpuTimeDoPart: dopart --
do clock -> t; INNER;

-- formatTimeDoPart: dopart--
do &text[] -> readable[]; 
   @@t -> ctime -> readable;
   (* delete newline *)
   (readable.length,readable.length) -> readable.delete;
   INNER;
   
-- preciseTimeBody: descriptor --
(# stat: @integer;
   timeval: externalRecord
     (# tv_sec: @long(# pos::< (# do 0->value #) #);
        tv_usec: @long(# pos::< (# do 4->value #) #);
     #);
   gettimeofday: external
     (# timeval_ptr: @Integer;
        status: @Integer;
     enter timeval_ptr
     exit status
     #);
   tp: @timeval;
do 8->malloc->tp.ptr;
   tp.ptr->gettimeofday->stat;
   tp.tv_sec -> time; 
   tp.tv_usec -> millitm;
   INNER preciseTime;
#)
