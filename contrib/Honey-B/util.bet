(************************************************************)
(** Util indeholder værktøjer og konstanter som er brugt   **)
(** i det meste af programmet.                             **)
(************************************************************)

ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/basiclib/math';

--- guienvLib: attributes ---

(* Følgende konstanter angiver farver og bruges til at angive *)
(* forskellige former for kollisionsobjekter *)
maxColVal: (# exit 255 #);
OBSTACLE: (*sort*) (# exit (0,0,0) #);
SAND: (*gul*) (# exit (maxColVal,maxColVal,0) #);
OIL: (*grå*) (# exit (128,128,128) #);
WATER: (*blå*) (# exit (0,0,255) #);
CHECKPOINT1: (**)(# exit (100,0,0)#);
CHECKPOINT2: (**)(# exit (200,0,0)#);
CLEAR: (*hvid*)(# exit (maxColVal,maxColVal,maxColVal) #);

(* Følgende er konstanter som identificeret nogle af de taster *)
(* vi bruger til at styre bilen. De resterende er defineret i  *)
(* '~beta/win32lib/winuserconsts' *)
VK_A: (# exit 0x41 #);
VK_D: (# exit 0x44 #);
VK_W: (# exit 0x57 #);
VK_S: (# exit 0x53 #);
VK_I: (# exit 0x49 #);
VK_J: (# exit 0x4A #);
VK_L: (# exit 0x4C #);
VK_K: (# exit 0x4B #);

(* Det største antal tiles et kort kan have i bredden og højden *)
MAX_TILES_WIDTH: (#	exit 100 #);
MAX_TILES_HEIGHT: (# exit 100 #);

(* Det største antal af tiles der findes *)
MAX_NUMBER_TILES: (# exit 60 #);

(* Det højeste antal spillerer der kan deltage *)
MAX_NR_PLAYERS: (# do exit 4 #);

(* En tiles højde og bredde *)
TILE_WIDTH: (# do exit 200 #);
TILE_HEIGHT: (# do exit 200 #);

(* Vinduets bredde og højde *)
WINDOW_WIDTH: (# do exit 1920(*800*) #);
WINDOW_HEIGHT: (# do exit 1080(*600*) #);

(* Bilens bredde og højde *)
CAR_SIZE_WIDTH: (# do exit 50 #);
CAR_SIZE_HEIGHT: (#	do exit 50 #);

(*antallet af bilens frames*)
CAR_FRAMES: (# exit 16 #);

(* Højden på displayet i toppen*)
DISPLAY_SIZE: (# exit 25 #);


(* Matrix er et pattern som opretter en 2-dimensionel repetition *)
(* bestående af integer-objekter *)
(* init: Opretter selve matricen *) 
(* (i,j,x) -> set: Sætter element[i][j] i matricen til x *)
(* (i,j)->Matrix: Returnerer indgangen [i][j] *)
(* Matrix-pattern bruges i vores opgave i map *)

matrix: (* simuleret 2-dimensionel vektor *)
(# 
	elements:[MAX_TILES_WIDTH]^vector; 
	result:@integer;
	i,j,x:@integer;
	
	vector:
	(# 
		velements:[MAX_TILES_HEIGHT]@integer; 
		index,elm:@integer;
		vresult:@integer;
	
		set:
		(#
			enter (index,elm)
		do
			(if (index<=elements.range) then
				elm->velements[index]; (* find det ønskede *)
			if);
		#);
	
		enter index
	do
		0->vresult;
		(if (index<=elements.range) then
			velements[index]->vresult; (* find det ønskede *)
		if);
		exit vresult
	#); (* slut vector *)
	
	init:
	(# 
		idx:@integer;
	do
		(for idx: elements.range repeat (* dyn opret vektorer *)
			&vector[]->elements[idx][];
		for);
	#);
	
	set:
	(#
		enter (i,j,x)
	do	
		(if (i<=elements.range) then
			(j,x)->elements[i].set;
		if);			
	#);
	
	
	enter (i,j)
do
	0->result;
	(if (i<=elements.range) then
		j->elements[i]->result;
	if);
	exit result
#); (* slut matrix *)




(* Et simplet lille pattern som kan holde en position *)
(* bestående af en x og en y koordinat *)
(* Brugt i det meste af programmet *)
newPosition:
(#
	x, y :@integer
	enter (x,y)
do
	exit (x,y)
#);

(* Et simpelet lille pattern som kan holde et rektangle *)
(* bestående af en x og en y koordinat samt en h højde og w bredde *)
(* Brugt i det meste af programmet *)
newRect:
(#
	x,y,w,h:@integer;
	enter (x,y,w,h)
do
	exit (x,y,w,h)
#);

(* Sammenligner om to farver er ens. Exiter true hvis det er tilfældet *)
(* Bruges i forbindelse med kollision *)
checkColor:
(#
	c:@color;
	r,g,b:@integer;
	sim:@boolean;
	enter (c,(r,g,b))
do
	false->sim;
	(if (r=c.red) and (g=c.green) and (b=c.blue) then
		true->sim;
	if);
	exit sim
#);
