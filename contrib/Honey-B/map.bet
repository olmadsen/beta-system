(************************************************************)
(** Map-patternet er et pattern som indkapsler en dobbelt  **)
(** matrix og som kan indlæse et kort i matrixen.          **)
(** Bruges af drawMap og af collision til at aflæse        **)
(** informationer om kortet 							   **)
(************************************************************)

ORIGIN '~beta/guienv/guienv';
INCLUDE '~beta/basiclib/math';
INCLUDE '~beta/basiclib/random';
INCLUDE 'util';
INCLUDE '~beta/basiclib/file';
--- guienvLib: attributes ---

Map:
(#
	matrice:@matrix; (* Matricen som indeholder informationer om kortets opbygning *)
	tilesWidth, tilesHeight:@integer; (* Det antal af tiles som udgør bredden og højden *)
	startPos:@newPosition; (* Positionen hvor bilerne starter. Indlæses fra filen *)
	nrTiles:@Integer; (* Antallet af tiles som læses ind *)

	(* Init initialiserer matricen og indlæser det aktuelle kort *)
	(* Bruges ved start af et nyt spil og kaldes fra control     *)
	init:
	(#
		filename,mapFilename: ^text; 
		theFile: @file;
		enter mapFilename[]
	do
		matrice.init;	

		mapFilename[] -> theFile.Name;
     	theFile.OpenRead;  	
     	theFile.getInt->nrTiles;       	     	
     	theFile.getInt->tilesWidth;
	 	theFile.getInt->tilesHeight; 	
		theFile.getInt->startPos.x;	 			
		theFile.getInt->startPos.y;		
	 	(for j:tilesHeight repeat
	 		(for i:tilesWidth repeat
				(i,j,theFile.getInt)->matrice.set;
			for);
		for);	
     	theFile.Close;    		
	#);	
#);