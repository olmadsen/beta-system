ORIGIN '~beta/guienv/guienvsystemenv';
INCLUDE '~beta/guienv/guienv';
INCLUDE '~beta/guienv/utils/colorTable';
INCLUDE '~beta/containers/sets';
INCLUDE '~beta/utils/AgentSystem/WorldWindow';
INCLUDE '~beta/utils/AgentSystem/colors';
INCLUDE '~beta/basiclib/math'
---lib:attributes--
Point:
  (# x,y: @integer;
     equal: BooleanValue
       (# P: ^Point
       enter P[]
       do (P.x = x) and (P.y = y) -> value
       #);
     print:
       (#
       do 'Point('->puttext; x -> putint; ','->put; y ->putint; ')'->put
       #)
  enter(x,y)
  exit(x,y)
  #);

east: (#exit 0 #);
north: (#exit 90 #);
west: (#exit 180 #);
south: (#exit 270 #);


World: guienv
  (#
     Turtle:
       (# location: @Point;
          direction: @ integer;
          pen: @
            (# col: @color;
               width: @integer;
               isDown: @boolean;
               draw:
                 (# start,end: @Point;
                    l:  @theWorldW.turtleLine
                 enter(start,end)
                 do (if isDown then
                        'down:'->puttext;
                        width -> theWorldW.pensize;
                        (none,start.x,start.y,end.x,end.y,col) -> l.open
                     else
                        'up:'->puttext;
                    if);
                    (start.x,start.y)->out; 
                    (end.x,end.y)->out; 
                    width -> putint; 
                    ' direction: ' -> puttext; direction ->  putint;
                    newline;
                 #);               
               out:
                 (# x,y: @integer
                 enter(x,y)
                 do '(' -> put; x -> putint; ','->put; y->putint; ')'->put
                 #)
            #);
          forward:
            (# distance: @integer; radian,x,y: @real; newLoc: @Point
            enter distance
            do direction * (pi / 180) -> radian;
               radian -> cos -> x;
               radian -> sin -> y;
               (location.x + x * distance, location.y + y * distance)
                 -> newLoc;
               (location,newLoc) -> pen.draw;
               newloc -> location;
               10 -> guienvwait
            #);
          backward: 
            (# distance: @integer
            enter distance
            do -distance -> forward
            #);
          right:
            (# angle: @integer
            enter angle
            do -angle -> left
            #);
          left: 
            (# angle: @integer
            enter angle
            do (direction + angle) mod 360-> direction
            #);
          up: (# do false -> pen.isDown #);
          down: (# do true -> pen.isDown #);
          set_color:(# enter pen.col #);
          fillcolor:(##);
          heading:(##);
          position: (# exit  location #);
          goto: 
            (# x,y: @integer 
            enter(x,y) 
            do (x,y) -> location
            #);
          penSize: 
            (# w: @integer 
            enter w 
            do w -> pen.width 
            #);
          begin_fill: (# #);
          end_fill:(# #);
          dot: (# #);
          stamp: (# #);
          shape: (# #);
       do (0,0) -> location;
          red -> set_color;
          1 -> pen.width;
          true -> pen.isDown;
          east -> direction
       #);
     world_width: @ (# w: @integer enter w exit w #);
     world_height: @ (# h: @integer enter h exit h #);
     theWorldW: @WorldWindow;
  do 50 -> world_width;
     50 -> world_height;
     (world_width,world_height,7) -> theWorldW.open;     
     inner World
  exit this(World)[]
  #)
---program:descriptor---
World
(# T: @Turtle;
   TurtleStar:
     (#
     do 
        (*color('red', 'yellow')
        begin_fill()*)
        L: 
        cycle
        (# i: @integer
        do i + 1 -> i;
           200 -> T.forward;
           170 -> T.left;
           (if (i = 1500) then leave L if);
           (if (T.location.x->abs) < 1 then
               leave L
           if)
        #);
        'done'->putline;
     #)
do T;
   TurtleStar;
#)

