ORIGIN 'nameTable';
BODY 'private/name_to_address_body';
INCLUDE '~beta/containers/hashTable';
INCLUDE '~beta/toollibs/utils/fileExtensions';
INCLUDE '~beta/basiclib/texthash';
-- lib: Attributes --
TextToInteger:
  (* Used for qualification of ExternalLookup below *)
  (# t: ^text; i: @integer
  enter t[]
  do INNER
  exit i
  #);
name_to_address_table: hashTable
  (# out_of_process: @boolean
       (* We are relocating an external process.
        * Use the nm or equivalent to initialize name_to_address_table;
        * Used for Valhalla.
        *);
     traceStream,infoStream: ^stream;
     logical2physical_offset: @integer
       (* Always 0 on UNIX - only used on nti 
        * FIXME: Should reside in _ntibody
        *);
     private: @<<SLOT name_to_address_table_private: descriptor>>;
     MDPrivate: @<<SLOT name_to_address_tableMDPrivate:descriptor>>;
       
     rangeInitial:: (# do 5879->value #);
     element::
       (# name: ^text;
          adr: @integer;
          display:
            (# s: ^stream
            enter s[]
            <<SLOT name_to_address_table_element_display:dopart>>
            #);
       #);
     ExternalLookup: ^TextToInteger
       (* Reference set by init if init.ExternalLookup is further bound *);
     init:
       (# exeName: ^text; 
          ExternalLookup:< TextToInteger
            (* If out_of_process is true and ExternalLookup is
             * further bound, ExternalLookup will be used
             * for looking up symbols instead of nm.
             *);
       enter(exeName[],out_of_process)
       <<SLOT name_to_address_tableInit:DoPart>> 
       #);
     dotsInit: init
       (# i: @integer
       enter infoStream[]
       <<SLOT name_to_address_table_dotsinit:dopart>>
       #);
     hashFunction:: 
       (# <<SLOT name_to_address_table_hashfunction:dopart>> #);
     equal:: 
       (# <<SLOT name_to_address_table_equal:dopart>> #);
     add:
       (# name: ^text; adr: @integer; e: ^element
       enter (name[],adr)
       <<SLOT name_to_address_table_add:dopart>> 
       #);
     lookup: @
       (# name: ^text;
          adr: @integer;
          thelookup: @<<SLOT name_to_address_table_thelookup:descriptor>>;
       enter name[]
       do thelookup;
       exit adr
       #);
     lookupC:
       (* Prepends an underscore top copy of "name" on
        * some platforms. 
        *)
       (# name: ^text;
       enter name[]
       do <<SLOT name_to_address_tableLookupCFixName: descriptor>>;
       exit name[] -> lookup
       #)
  #)  

