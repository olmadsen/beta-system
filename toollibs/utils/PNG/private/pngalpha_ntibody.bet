ORIGIN 'pngalphabody';
INCLUDE '~beta/guienv/private/winnt/pixmapbody';
INCLUDE '~beta/guienv/private/winnt/graphics_ntibody';

INCLUDE 'winpnginterface';
LINKOPT nti 'MSIMG32.LIB';
BUILD nti '$$/winpngalpha.obj' 'external/winpngalpha.c' 'betacc -I external/libpng -I external/zlib $0 $1';


-- lib: attributes --

ReadPNGalpha: external
  (# name: [1] @char;
     hbmp: @integer;
     pixels: @integer;
     width: @integer;
     height: @integer;
     result: @integer;
  enter (name, hbmp, pixels, width, height)
  exit result
  #);
ReadPNGalphaImage: external
  (# name: [1] @char;
     hbmp: @integer;
     pixels: @integer;
     width: @integer;
     height: @integer;
     result: @integer;
  enter (name, hbmp, pixels, width, height)
  exit result
  #);
ReadPNGrgbImage: external
  (# name: [1] @char;
     hbmp: @integer;
     width: @integer;
     height: @integer;
     result: @integer;
  enter (name, hbmp, width, height)
  exit result
  #);
AlphaDraw: external
  (# hdc, x, y, width, height, hbmp: @integer;
  enter (hdc, x, y, width, height, hbmp)
  #);

-- pixmapReadAlpha: doPart --
do (# result: @integer;
   do (name, @@private.handleToPixmap, @@private.pixels, @@private.width, @@private.height)
        -> ReadPNGalpha
        -> result;
      (if result = 0 then
          
       else
          'unknown error' -> error;
      if);
   #);
-- pixmapReadRGB: doPart --
do (# result: @integer;
   do (name, @@private.handleToPixmap, @@private.width, @@private.height)
        -> ReadPNGrgbImage
        -> result;
      (if result = 0 then
          
       else
          'unknown error' -> error;
      if);
   #);
   
-- pixmapReadAlphaImage: doPart --
do (# result: @integer;
      pixels: @integer;
   do (name, @@private.handleToPixmap, @@pixels, @@private.width, @@private.height)
        -> ReadPNGalphaImage
        -> result;
      (if result = 0 then
          pixels -> private.pixels;
       else
          'unknown error' -> error;
      if);
   #);
   
-- graphicsDrawRasterAlpha: doPart --
do (private.hdc, x, y, pm.width, pm.height, pm.private.handleToPixmap) -> AlphaDraw;
   
-- pixmapDrawPixmapAlpha: doPart --
do 
