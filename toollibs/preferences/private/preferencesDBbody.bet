ORIGIN '../preferencesDB';
LIB_ITEM 'preferencesdb';
INCLUDE 'preferencesBody';
INCLUDE '~beta/basiclib/regexp';
INCLUDE '~beta/basiclib/formatio';
INCLUDE '~beta/basiclib/file';
MDBODY nti 'preferencesdb_ntibody'
       ppcmac 'preferencesdb_macbody'
       default 'preferencesdb_defaultbody';

--- preferencesDump: dopart ---
do (# nameMax, typeMax: @integer; v: ^text; mostSpecificType: ^private.prefType
   do private.prefs.scan
      (# where:: (# do (current.value.changed or all)->value #);
         type: ##preference; nt,tt,vt: ^text;
      do current.name[]->s.puttext;
         (for i: private.prefsMaxWidth-current.name.length+1 repeat ' '->s.put for);
         current.type##->type##; NONE->mostSpecificType[];
         private.types.scan
         (# where::
              (# do type##<=current.type##->value #)
         do (if (mostSpecificType[]=NONE) or
                (current.type##<=mostSpecificType.type##) then
                current[]->mostSpecificType[]
            if)
         #);
         mostSpecificType.name[]->s.puttext;
         (for i:private.typesMaxWidth-mostSpecificType.name.length+1 repeat ' '->s.put for);
         current.value.write->v[];
         v.scanAll
         (#
         do (if ch//ascii.nl//ascii.cr then '\\'->s.put if); ch->s.put
         #);
         s.newline;
      #);
   #)
   
