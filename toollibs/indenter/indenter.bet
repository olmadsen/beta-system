Origin '~beta/basiclib/betaenv';
Include 'private/indentRegexps';
Body 'private/indenterBody';

-- lib: attributes --

indenter:
  (# 
     init:<
       (# <<SLOT init:doPart>> #);
     
     (* indentValue - dirty = indentvalue before the indent 
      * length = indentValue + line.length     
      *)
     textLine:<
       (# line: ^text; indentValue,pos,dirty,length: @integer;
       exit line.copy
       #);
     
     (* top points to the first empty pos in contents *)
     top: @integer;
     contents: [1] ^textLine;
     regexp: ^indentRegexps;
     
     setContents:<
       (# unformattet: ^text; line: @integer;
       enter unformattet[]
       <<SLOT setContents: doPart>> 
       #);
     
     
     updateIndentValue:<
       (# line,indentValue: @integer
       enter (line,indentValue)
       <<SLOT updateIndentValue: doPart>>
       #);
     
     
     indentLine:<
       (# line,absolutCol,indentValue: @integer
       enter (line,absolutCol)
       <<SLOT indentLine: doPart>> 
       exit absolutCol
       #);
     
     getIndent:<
       (# line, indentValue: @integer
       enter line
       <<SLOT getIndent:doPart>>
       exit indentValue
       #);
     
     getActualIndent:<
       (# line,indent: @integer
       enter line
       <<SLOT getActualIndent: doPart>>
       exit indent
       #);
     
     firstLine:
       (# line: @integer
       enter line
       exit line=1
       #);
     
     lastLine:
       (# line: @integer
       enter line
       exit line=top-1
       #);
     
     updatePos:
       (# <<SLOT updatePos: doPart>> #);
     
     getBlockIndent:
       (* Finds the position of the beginnning block,
        * defined by the blocknumber.
        *)
       (# line,col,blockNumber: @integer;
          t: ^text;
          differentLines: @boolean;
       enter (line,blockNumber)
       <<SLOT getBlockIndent:DoPart>>
       exit (line,col,differentLines)
       #);
     
  #)
