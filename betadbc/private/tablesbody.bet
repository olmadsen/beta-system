ORIGIN '../tables';
INCLUDE 'odbcbody';
-- getTables: DoPart --
do
     (# rc: @shortint; hstmt: @integer
     do
        (THIS(Connection).private.hdbc,@@ hstmt)->SQLAllocStmt->rc;
        (if rc <> SQL_SUCCESS then
            (none, SQL_HANDLE_DBC,THIS(Connection).private.hdbc)->connectionException
        if);
        (hstmt,0,0,0,0,0,0,0,0)->SQLTables->rc;
        (if rc <> SQL_SUCCESS then
            (none,SQL_HANDLE_STMT,hstmt)->connectionException
        if);
        hstmt->SQLFetch->rc;
        until:
          (#
             getByNumber:
               (#
                  i: @integer;
                  res: ^text;
                  target: @cString;
                  StrLen_or_IndPtr: @integer
               enter i
               do
                  255->target.init;
                  (hstmt,i,SQL_CHAR,target,255,@@ StrLen_or_IndPtr)->SQLGetData
                    ->rc;
                  (if rc <> SQL_SUCCESS then
                      (none,SQL_HANDLE_STMT,hstmt)->connectionException
                  if);
                  target.get->res[];
                  target.free
               exit res[]
               #)
          do
             (if rc = SQL_SUCCESS then
                 &table[]->current[];
                 1->getByNumber->current.CatalogName[];
                 2->getByNumber->current.SchemaName[];
                 3->getByNumber->current.TableName[];
                 4->getByNumber->current.TableType[];
                 INNER scanTables;
                 hstmt->SQLFetch->rc;
                 restart until
              else
                 (if rc <> SQL_NO_DATA then
                     (none,SQL_HANDLE_STMT,hstmt)->connectionException
                 if)
             if)
          #);
        (hstmt,SQL_CLOSE)->SQLFreeStmt->rc;
        (if rc <> SQL_SUCCESS then
            (none,SQL_HANDLE_DBC,THIS(Connection).private.hdbc)->connectionException
        if)
     #);
     

