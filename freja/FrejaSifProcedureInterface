The procedural interface between Sif and Freja.

Application commands (global) in Sif:
=====================================

openForm:
  (#
     name: ^text;
     node: ^edenv.mps.ast;
     fe: ^ymerBrowser.codeEditor;
     NoEditorForForm:< ...;
     couldNotOpenFragmentform:< ...
  enter (name[],node[])
  ...
  exit fe[]
  #)

  Opens an editor instance on the fragment form 'name' and selects the 'node'
  in the fragmentform, if 'node' is none the root is selected.
  If the editor already is instantiated, the node will only be selected.
  Returns a reference to the editor instance of the fragment form.

  Exceptions:
  . couldNotOpenFragmentform
    Raised if the fragmentform could not be opened
  . NoEditorForForm
    Raised if no editor instance could be found or created for the
    fragmentform
  
  ESS Bem: EditorEnv's openForm tager et astindex som enter parameter -
           det boer vel laves om til en astreference?


getEditorForForm:
  (#
     ff: ^edenv.mps.fragmentForm;
     node: ^edenv.mps.ast 
     fe: ^ymerBrowser.codeEditor;
     NoEditorForForm:< externalInterfaceException
  enter (ff[],node[])
  ...
  exit fe[]
  #)

  Opens an editor instance on the fragment form refered to by 'ff' and 
  selects the 'node' in the fragmentform, if 'node' is none the root is
  selected
  Returns a reference to the editor instance of the fragment form.

  Exceptions:
  . NoEditorForForm
    Raised if no editor instance could be found or created for the
    fragmentform


newBETAProgram:
  (#
     name: ^text;
     NoEditorForForm:< externalInterfaceException
  enter name[]
  ...
  #)

  Creates a new fragment 'name' and an editor instance for it's fragment form
  'program'. Raises a 'newFragmentEvent' on the editor which in turn calls
  'newFragment' in Freja.

  Exceptions:
  . NoEditorForForm
    Raised if no editor instance could be found or created for the
    fragmentform


newBETALibrary:
  (#
     name: ^text;
     NoEditorForForm:< externalInterfaceException
  enter name[]
  ...
  #)

  Creates a new fragment 'name' and an editor instance for it's fragment form
  'lib'. Raises a 'newFragmentEvent' on the editor which in turn calls
  'newFragment' in Freja.

  Exceptions:
  . NoEditorForForm
    Raised if no editor instance could be found or created for the
    fragmentform


save: 
  (#  
  ...
  #)

Creates .ast~ files and new .bet files for all Freja editors.
deletes the corresponding .ast# files.

saveAndQuit:
  (#
  ...
  #)

same as save, but on returning from this command, 
Freja closes down and quits.

autoSave:
  (#
  ...
  #)

  creates .ast# files for all Freja editors.

check: 
  (#  
  ...
  #)

calls the checker on the fragment group of the current selection.
The groupChecked command is send from Sif after the checking.

toggleDebug:
  (#  
  ...
  #)


Fragment form specific commands (commands to editor instances) in Sif: 
======================================================================

undo:< (# ... #)

  undoes the last change (only one step)


cut:< (# ... #)

copy:< (# ... #)

paste:< (# ... #)

before:< (# ... #)

  inserts a list element nonterminal before current focus


after:< (# ... #)

  inserts a list element nonterminal after current focus


changeFocus:<
  (# node: ^mps.ast; 
     length: @integer
  enter (node[],length)
  ...
  exit (frejaEditTypeStatus[],cs.undoPermit,cs.pastePermit,
        cs.listInsertPermit,frejaExpandStatus[])
  #)

  selects 'node'.
  'length' is used for sublists. if only one must be selected
  'length' must be 1.

  Returns:

  frejaEditTypeStatus - a text containing either 'expanded','unexpNormal'
                        or 'unexpOptional'. 

  cs.undoPermit,cs.pastePermit,cs.listInsertPermit - three booleans

  frejaExpandStatus - a text on the form [{<synCatNo> <synCatName>}+], where
                      <synCatNo> is an integer.

getStatus:< (# 
            ... 
            exit (cs.node[],cs.length, frejaEditTypeStatus[],
                  cs.undoPermit,cs.pastePermit,
                  cs.listInsertPermit,frejaExpandStatus[])
            #)

  Returns the current selection and a status like the above for this editor.


expandNormal:<
  (# synCatNo: @integer 
  enter synCatNo 
  ...
  #)

  Expands (derives) the nonterminal at current focus with production no
  synCatNo.


expandOptional:<
  (# synCatNo: @integer
  enter synCatNo
  ...
  #);

  If synCatNo is 1 the nonterminal at current focus is derived empty
  else it is expanded with production no synCatNo.


expandLexem:<
  (# theText: @text 
  enter text 
  ...
  #)

  Expands the lexem at current focus with theText.


insertOptionals:< (# ... #);

  Inserts optional nonterminals in current focus.


removeOptionals:< (# ... #)

  Removes optional nonterminals in current focus.


parse:
  (#
     node: ^mps.ast;
     ok: @boolean;
     errorPos: @integer;
     parseText,parseErrorText: ^text
  enter (node[],parseText[])
  <<SLOT externalInterfaceParse:DoPart>>
  exit
     (ok,errorPos,parseErrorText[])
  #)

  Parses the text parseText according to node, if no parse errors ok is
  true, else errorPos contains the position of the error in the text and
  parseErrorText the error message


Application commands (global) in Freja:
=======================================

groupChecked:< 
  (#  
  ...   
  #)

  At least one of the fragments open in Freja has been checked by Sif.
  Relations are redisplayed in Freja and a Save of the diagram is performed
  (because check means implicit save on fragment and diagram must be
  consistently saved together with fragments).

  ESS Bem: Det kan godt vaere vi lige skal kigge paa det her sammen, men
           det ser nu umiddelbart ud til at fungere ok...


Fragment form specific commands in Freja: 
=========================================

astReplaced:<
  (# oldAst,newAst: ^astInterface.ast
  enter (oldAst[],newAst[])
  ...
  #)


listElementInserted:<
  (# father: ^astInterface.ast; position: @integer
  enter (father[],position)
  ...
  #)


listElementsDeleted:<
  (#
     father: ^astInterface.ast;
     position,length: @integer;
     oldElements: [1] ^astInterface.ast
  enter (father[],position,length,oldElements)
  ...
  #)

listElementsReplaced:<
  (#
     father: ^astInterface.ast;
     position,length,newLength: @integer;
     oldElements: [1] ^astInterface.ast
  enter (father[],position,length,oldElements,newLength)
  ...
  #);


focusChanged:<
  (# node: ^astInterface.ast; length: @integer
  enter (node[],length)
  ...
  #)


newFragment:<
  (# ff: ^astInterface.fragmentForm;
     node: ^astInterface.ast
  enter (ff[],node[])
  ...
  #)

  opens an editor instance on the fragment form refered by 'ff' and selects
  the 'node', if 'node' is none the root is selected.


openForm:<
  (# ff: ^astInterface.fragmentForm;
     node: ^astInterface.ast
  enter (ff[],node[])
  do INNER openForm
  #)


  ESS Bem: Benyttes ikke laengere??! Er det fordi den nye Sif i oejeblikket
           ikke har en "Show Diagram in Freja"?
