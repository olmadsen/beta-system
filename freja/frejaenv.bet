ORIGIN '~beta/basiclib/betaenv';
INCLUDE '~beta/gpp/gppinterface'
        '~beta/gpp/private/diagramattributes'
        '~beta/designenv/design'
        '~beta/sysutils/envstring';
BODY 'private/frejamenu'
     'private/frejabody';
-- lib: Attributes --
frejaenv:
  (#
     FrejaShowClassDiag:< (#  <<SLOT MenuFrejaShowClassDiag:DoPart>> #);
     FrejaNewLib:
       (# 
       <<SLOT MenuFrejaNewLib:DoPart>>
       #);
     FrejaNewProgram: (#  <<SLOT MenuFrejaNewProgram:DoPart>> #);
     FrejaNewGraphicsPage:
       (# 
       <<SLOT MenuFrejaNewGraphicsPage:DoPart>>
       #);
     FrejaOpen: (#  <<SLOT MenuFrejaOpen:DoPart>> #);
     FrejaClose:
       (#  <<SLOT MenuFrejaClose:DoPart>> #);
     FrejaSave:
       (# 
       <<SLOT MenuFrejaSave:DoPart>>
       #);
     FrejaSaveAs: (#  <<SLOT MenuFrejaSaveAs:DoPart>> #);
     FrejaRevert:
       (#  <<SLOT MenuFrejaRevert:DoPart>> #);
     FrejaShowObjectDiag: (#  <<SLOT MenuFrejaShowObjectDiag:DoPart>> #);
     FrejaLoadGraphics:
       (# 
       <<SLOT MenuFrejaLoadGraphics:DoPart>>
       #);
     FrejaPrint: (#  <<SLOT MenuFrejaPrint:DoPart>> #);
     FrejaPreferences:
       (# 
       <<SLOT MenuFrejaPreferences:DoPart>>
       #);
     FrejaPromptForText:
       (#
          message,defaultText: ^text;
          confirm:< (# theText: ^text enter theText[] do INNER #);
          cancel:< object;
          
       enter (message[],defaultText[])
       <<SLOT FrejaPromptForText:DoPart>>
       #);
     sdeModel:<
       (#
          GraphicalInterface:< gppInterface
            (#
               DesignInterface::< 
                 (#
                    ShowSIFSelection:
                      @Boolean;
                    OADDocument::< 
                      (#
                         OADPage::< 
                           (#
                              canUndo,canPaste,canListInsert: @Boolean;
                              theFragmentNode: ^PatternDiagramNode;
                              BindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT BindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              FinalBindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT FinalBindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              PatternVariableConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT PatternVariableConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              getStatus:
                                (# theObject: ^DesignObject; 
                                enter theObject[]
                                do <<SLOT GetStatusFromSif:Descriptor>>; 
                                #);
                              doExpand:
                                (#
                                   synCatNo:
                                     @Integer;
                                   normal: @Boolean;
                                   
                                enter (synCatNo,normal)
                                do <<SLOT DoExpand:Descriptor>>; 
                                #);
                              doExpandLexem:
                                (# name: @Text; 
                                enter name
                                do
                                   <<SLOT DoExpandLexem:Descriptor>>;
                                   
                                #);
                              changedFocus::< 
                                (#  do <<SLOT ChangedFocus:Descriptor>> #);
                              declarationTextChanged::< 
                                (# 
                                do <<SLOT declarationTextChanged:Descriptor>>
                                #);
                              openFormInSif::< 
                                (#  do <<SLOT openFormInSif:Descriptor>> #);
                              copy::<  (#  do <<SLOT copy:Descriptor>> #);
                              onFocusChange:<
                                (#
                                   node: ^mps.ast;
                                   length: @Integer;
                                   status: @Boolean;
                                   
                                enter (node[],length)
                                do
                                   <<SLOT onFocusChange:Descriptor>>
                                exit status
                                #);
                              onMouseDown::< 
                                (# 
                                do <<SLOT FrejaMouseDown:Descriptor>>
                                #);
                              private:
                                @<<SLOT FrejaOADPagePrivate:Descriptor>>
                           #);
                         readOnlyModeOn: @boolean;
                         doOADPaste,doObjectPaste,pasteGroupWithOAD: @boolean;
                         setReadOnly::< 
                           (#  <<SLOT frejaSetReadOnly:DoPart>> #);
                         unsetReadOnly::< 
                           (# 
                           <<SLOT frejaUnsetReadOnly:DoPart>>
                           #);
                         checkEditMenuTextEdit::< 
                           (#  <<SLOT FrejaCheckEditMenuTextEdit:DoPart>> #);
                         openAssociationDialog::< 
                           (#  <<SLOT openAssociationDialog:DoPart>> #);
                         openAggregationDialog::< 
                           (#  <<SLOT openAggregationDialog:DoPart>> #);
                         FrejaEditMenu:
                           @UserMenu
                           (#
                              myItem: item
                                (#
                                   myDisable:
                                     (#  do true->doNotEnable; disable #);
                                   myEnable:
                                     (#  do false->doNotEnable; enable #);
                                   hit::<  (#  <<SLOT myItemHit:DoPart>> #)
                                #);
                              iUndo: @myItem
                                (#
                                   enable: (#  #);
                                   myenable:
                                     (#  #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCut: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCutItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCopy: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCopyItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteBefore: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteBeforeItem:Descriptor>>
                                     #)
                                #);
                              iPaste: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteAfter:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaPasteAfterItem:Descriptor>>
                                     #)
                                #);
                              iClear: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaClearItem:Descriptor>>;
                                        INNER
                                          ;
                                        
                                     #);
                                   init::< 
                                     (# 
                                     do
                                        disable
                                     #)
                                #);
                              sep1,sep2,sep3,sep4,sep5: @Item;
                              insertBeforeItem: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertBeforeHit:Descriptor>>
                                     #)
                                #);
                              insertAfter:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertAfterHit:Descriptor>>
                                     #)
                                #);
                              TextModeOn:
                                @Boolean;
                              iEditName: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaEditMenuIEditName:DoPart>>
                                     #)
                                #);
                              iTextEdit:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaEditMenuITextEdit:Descriptor>>
                                     #)
                                #);
                              iEditOtherText: @item
                                (#
                                   hit::< 
                                     (#  <<SLOT iEditOtherText:DoPart>> #)
                                #);
                              iRevertTextEdit:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT iRevertTextEdit:Descriptor>>
                                     #)
                                #);
                              iRemoveOptionals: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaRemoveOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iShowOptionals: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaShowOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCheck: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaCheckItem:Descriptor>>; 
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT EditMenuInit:Descriptor>>
                                #);
                              
                           #);
                         ViewMenuDesc::< 
                           (#
                              SearchItemDesc::< 
                                (#
                                   hit::< 
                                     (#
                                        thePage: ^Page;
                                        theOADPage: ^OADPage;
                                        theDesObj: ^theOADPage.DesignObject;
                                        theObject:
                                          ^theOADPage.PatternDiagramNode
                                     <<SLOT frejaSearchItemDesc:DoPart>>
                                     #)
                                #);
                              LayoutPreferencesDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaLayputPreferencesDesc:DoPart>>
                                     #)
                                #);
                              TraceItemDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaViewMenuTraceItem:DoPart>>
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT FrejaViewMenuInit:Descriptor>>;
                                   
                                #)
                           #);
                         AttributeKindMenu: @UserMenu
                           (#
                              NewPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuNewPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              sep: @Item;
                              attrKindItem: Item
                                (#
                                   hit::< 
                                     (# op: ^OADPage
                                     <<SLOT attrKindItem:DoPart>>
                                     #)
                                #);
                              LocalPattern:
                                @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuLocalPattern:DoPart>>
                                     #)
                                #);
                              PartObject: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuPartObject:DoPart>>
                                     #)
                                #);
                              DynamicReference: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuDynamicReference:DoPart>>
                                     #)
                                #);
                              VirtualPattern: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuVirtualPattern:DoPart>>
                                     #)
                                #);
                              BindingOfVirtualPattern: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuBindingOfVirtualPattern:DoPart>>
                                     #)
                                #);
                              FinalBindOfVirtPattern: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuFinalBindOfVirtPattern:DoPart>>
                                     #)
                                #);
                              disable:: 
                                (# 
                                <<SLOT AttributeKindMenuDisable:DoPart>>
                                #);
                              enable:: 
                                (# 
                                <<SLOT AttributeKindMenuEnable:DoPart>>
                                #);
                              init::< 
                                (# 
                                do <<SLOT AttributeKindMenuInit:Descriptor>>; 
                                #)
                           #);
                         RelationsMenu: @UserMenu
                           (#
                              sep,sep1,sep2,sep3: @Item;
                              GeneralRelationship: @item
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT GeneralRelationshipItem:DoPart>>
                                     #)
                                #);
                              Aggregation: @item
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT RelationsMenuAggregationItem:DoPart>>
                                     #)
                                #);
                              Association: @item
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT RelationsMenuAssociationItem:DoPart>>
                                     #)
                                #);
                              Specialization: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuSpecialization:Descriptor>>;
                                        
                                     #)
                                #);
                              bind: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT RelationsMenuBind:Descriptor>>; 
                                     #)
                                #);
                              final: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuFinal:Descriptor>>; 
                                     #)
                                #);
                              pattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              selfAssociate: @Item
                                (#
                                   hit::< 
                                     (# theWindow: ^selfAssociateWindow
                                     <<SLOT RealtionsMenuSelfAssociateHit:DoPart>>
                                     #)
                                #);
                              edit: @item
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT RelationsMenuEditHit:DoPart>>
                                     #)
                                #);
                              disable:: 
                                (# 
                                <<SLOT RelationsMenudisable:DoPart>>
                                #);
                              enable:: 
                                (#  <<SLOT RelationsMenuEnable:DoPart>> #);
                              init::< 
                                (# 
                                do
                                   <<SLOT RelationsMenuInit:Descriptor>>;
                                   
                                #)
                           #);
                         ExpandMenu: UserMenu
                           (#
                              theItems: [noOfItems] ^ExpandItem;
                              noOfItems: (#  exit 12 #);
                              ExpandItem: Item
                                (#
                                   synCatNo: @Integer;
                                   syncatName: ^Text;
                                   hit::< 
                                     (# 
                                     do <<SLOT ExpandItemHit:Descriptor>>
                                     #);
                                   create:
                                     (# i: @Integer; 
                                     enter (i,syncatno,syncatname[])
                                     do <<SLOT ExpandItemCreate:Descriptor>>
                                     #);
                                   
                                #);
                              CreateItems:
                                (#
                                   list:
                                     ^Text;
                                   
                                enter list[]
                                do <<SLOT ExpandMenuCreateItems:Descriptor>>
                                #);
                              deleteMenu:
                                (# 
                                do <<SLOT ExpandMenuDelete:Descriptor>>; 
                                #);
                              init::< 
                                (# 
                                do <<SLOT ExpandMenuInit:Descriptor>>; 
                                #);
                              
                           #);
                         theExpandMenu:
                           @ExpandMenu;
                         associationDialog:
                          <<SLOT associationDialog:Descriptor>>;
                         aggregationDialog:
                          <<SLOT aggregationDialog:Descriptor>>;
                         selfAssociateWindow:
                          <<SLOT selfAssociateWindow:Descriptor>>;
                         layoutPreferencesDialog:
                           @<<SLOT layoutPreferencesDialog:Descriptor>>;
                         onKeyDown::< 
                           (# fragmentBrowserIsActive: @boolean
                           <<SLOT FrejaOnKeyDown:DoPart>>
                           #);
                         onInit::< 
                           (# 
                           do
                              <<SLOT FrejaOADDocumentOnInit:Descriptor>>;
                              
                           #)
                      #);
                    FileMenuDesc::< 
                      (#
                         NewBETAProgramDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETAProgram:Descriptor>>
                                #)
                           #);
                         NewBETALibraryDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETALibrary:Descriptor>>
                                #)
                           #);
                         QuitDesc::< 
                           (#
                              hit::< 
                                (# 
                                do <<SLOT FrejaFileMenuQuit:Descriptor>>
                                #)
                           #)
                      #);
                    onInit::< 
                      (# 
                      do
                         <<SLOT FrejaDesignInterfaceOnInit:Descriptor>>;
                         
                      #);
                    private: @<<SLOT frejaDesignInterfacePrivate:Descriptor>>
                 <<SLOT FrejaDesignInterfaceDoPart:DoPart>>
                 #);
               frejaAssociationsInclude:: 
                 (#  do '~beta/freja/associations'->t[] #);
               enableEditName::< 
                 (# theOADDocument: ^theDesignInterface.OADDocument
                 <<SLOT GraphicalInterfaceEnableEditName:DoPart>>
                 #);
               disableEditName::< 
                 (# theOADDocument: ^theDesignInterface.OADDocument
                 <<SLOT theGraphicalInterfaceDisableEditName:DoPart>>
                 #);
               callChecker::< 
                 (#  do fg[]->theController.globalSifCommands.check #);
               sifSaveAndQuit::< 
                 (#  do theController.globalSifCommands.saveAndQuit #);
               sifSave::<  (#  do theController.globalSifCommands.save #);
               sifAutoSave::< 
                 (#  do theController.globalSifCommands.autoSave #);
               sifAddProp::< 
                 (# 
                 do
                    (fg[],propName[],propString[])
                      ->theController.globalSifCommands.addProp
                 #);
               sifSetFrejaMark::< 
                 (# 
                 do fg[]->theController.globalSifCommands.setFrejaMark
                 #);
               sifGetFrejaMark::< 
                 (# 
                 do
                    fg[]->theController.globalSifCommands.getFrejaMark
                      ->frejaMark
                 #);
               fileCreateDialog::< 
                 (# t: ^text <<SLOT FrejaFileCreateDialog:DoPart>> #);
               fileSelectDialog::< 
                 (# t: ^text
                 <<SLOT FrejaFileSelectDialog:DoPart>>
                 #);
               alertUser::< 
                 (#  <<SLOT frejaDesignInterfaceAlertUser:DoPart>> #);
               promptForBoolean::<
                 (#  <<SLOT frejaPromptForBoolean:DoPart>> #);
               
            do
               <<SLOT FrejaDoPart:Descriptor>>
            #);
          theGraphicalInterface: @GraphicalInterface
       do theGraphicalInterface; INNER sdeModel
       #);
     sdeControl:<
       (#
          globalSifCommands: @globalSifCommandsDesc;
          globalSifCommandsDesc:<
            (#
               openForm:<
                 (#
                    name: ^Text; node: ^theModel.theGraphicalInterface.mps.ast
                 enter (name[],node[])
                 do INNER openForm
                 #);
               newBETAProgram:<
                 (# name: ^Text enter name[] do INNER newBETAProgram #);
               newBETALibrary:<
                 (# name: ^Text enter name[] do INNER newBETAlibrary #);
               saveAndQuit:< (#  do INNER saveAndQuit #);
               save:< (#  do INNER save #);
               autoSave:< (#  do INNER autosave #);
               check:<
                 (# fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 do INNER check
                 #);
               addProp:<
                 (#
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup;
                    propName,propString: ^text
                 enter (fg[],propName[],propString[])
                 do INNER addProp
                 #);
               deleteProp:<
                 (#
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup;
                    propName,propString: ^text
                 enter (fg[],propName[],propString[])
                 do INNER deleteProp
                 #);
               setFrejaMark:<
                 (#
                    frejamark: @boolean;
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 do INNER setFrejaMark
                 #);
               getFrejaMark:<
                 (#
                    frejamark: @integer;
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 do INNER getFrejaMark
                 exit frejamark
                 #);
               toggleDebug:< (#  do INNER toggleDebug #)
            #)
       #);
     theModel: @sdeModel;
     theController: @sdeControl
  do INNER frejaenv
  #)  

