ORIGIN '~beta/basiclib/betaenv';
LIB_DEF 'frejaenv''../lib';
INCLUDE '../gpp/gppinterface'
        '../gpp/private/diagramattributes'
        '~beta/designenv/design'
        '~beta/sysutils/envstring';
BODY 'private/frejamenu'
     'private/frejabody'
     'private/dialogbody'
     'private/aggregationdialogbody'
     'private/associationdialogbody';
-- lib: Attributes --
frejaenv:
  (#
     FrejaShowClassDiag:< (#  <<SLOT MenuFrejaShowClassDiag:DoPart>> #);
     FrejaNewLib:
       (# 
       <<SLOT MenuFrejaNewLib:DoPart>>
       #);
     FrejaNewProgram: (#  <<SLOT MenuFrejaNewProgram:DoPart>> #);
     FrejaNewGraphicsPage:
       (# 
       <<SLOT MenuFrejaNewGraphicsPage:DoPart>>
       #);
     FrejaOpen: (#  <<SLOT MenuFrejaOpen:DoPart>> #);
     FrejaClose:
       (#  <<SLOT MenuFrejaClose:DoPart>> #);
     FrejaSave:
       (# 
       <<SLOT MenuFrejaSave:DoPart>>
       #);
     FrejaSaveAs: (#  <<SLOT MenuFrejaSaveAs:DoPart>> #);
     FrejaRevert:
       (#  <<SLOT MenuFrejaRevert:DoPart>> #);
     FrejaShowObjectDiag: (#  <<SLOT MenuFrejaShowObjectDiag:DoPart>> #);
     FrejaLoadGraphics:
       (# 
       <<SLOT MenuFrejaLoadGraphics:DoPart>>
       #);
     FrejaPrint: (#  <<SLOT MenuFrejaPrint:DoPart>> #);
     FrejaPreferences:
       (# 
       <<SLOT MenuFrejaPreferences:DoPart>>
       #);
     FrejaPromptForText:
       (#
          message,defaultText: ^text;
          confirm:< (# theText: ^text enter theText[] do INNER #);
          cancel:< object;
          
       enter (message[],defaultText[])
       <<SLOT FrejaPromptForText:DoPart>>
       #);
     sdeModel:<
       (#
          GraphicalInterface:< gppInterface
            (#
               DesignInterface::< 
                 (#
                    ShowSIFSelection:
                      @Boolean;
                    OADDocument::< 
                      (#
                         OADPage::< 
                           (#
                              canUndo,canPaste,canListInsert: @Boolean;
                              theFragmentNode: ^PatternDiagramNode;
                              BindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT BindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              FinalBindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT FinalBindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              PatternVariableConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT PatternVariableConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              getStatus:
                                (# theObject: ^DesignObject; 
                                enter theObject[]
                                do <<SLOT GetStatusFromSif:Descriptor>>; 
                                #);
                              doExpand:
                                (#
                                   synCatNo:
                                     @Integer;
                                   normal: @Boolean;
                                   
                                enter (synCatNo,normal)
                                do <<SLOT DoExpand:Descriptor>>; 
                                #);
                              doExpandLexem:
                                (# name: @Text; 
                                enter name
                                do
                                   <<SLOT DoExpandLexem:Descriptor>>;
                                   
                                #);
                              changedFocus::< 
                                (#  do <<SLOT ChangedFocus:Descriptor>> #);
                              declarationTextChanged::< 
                                (# 
                                do <<SLOT declarationTextChanged:Descriptor>>
                                #);
                              openFormInSif::< 
                                (#  do <<SLOT openFormInSif:Descriptor>> #);
                              copy::<  (#  do <<SLOT copy:Descriptor>> #);
                              onFocusChange:<
                                (#
                                   node: ^mps.ast;
                                   length: @Integer;
                                   status: @Boolean;
                                   
                                enter (node[],length)
                                do
                                   <<SLOT onFocusChange:Descriptor>>
                                exit status
                                #);
                              onMouseDown::< 
                                (# 
                                do <<SLOT FrejaMouseDown:Descriptor>>
                                #);
                              getCanPaste::< 
                                (# 
                                do
                                   canPaste->v
                                #);
                              private: @<<SLOT FrejaOADPagePrivate:Descriptor>>
                           #);
                         readOnlyModeOn: @boolean;
                         doOADPaste,doObjectPaste,pasteGroupWithOAD: @boolean;
                         setReadOnly::< 
                           (#  <<SLOT frejaSetReadOnly:DoPart>> #);
                         unsetReadOnly::< 
                           (# 
                           <<SLOT frejaUnsetReadOnly:DoPart>>
                           #);
                         checkEditMenuTextEdit::< 
                           (#  <<SLOT FrejaCheckEditMenuTextEdit:DoPart>> #);
                         openAssociationDialog::< 
                           (#  <<SLOT openAssociationDialog:DoPart>> #);
                         openAggregationDialog::< 
                           (#  <<SLOT openAggregationDialog:DoPart>> #);
                         FrejaEditMenu:
                           @UserMenu
                           (#
                              myItem: item
                                (#
                                   myDisable:
                                     (#  do true->doNotEnable; disable #);
                                   myEnable:
                                     (#  do false->doNotEnable; enable #);
                                   hit::<  (#  <<SLOT myItemHit:DoPart>> #)
                                #);
                              iUndo: @myItem
                                (#
                                   enable: (#  #);
                                   myenable:
                                     (#  #);
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCut: @myItem
                                (#
                                   onStatus::<
                                    
                                     (# 
                                     do <<SLOT FrejaCutOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCutItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCopy: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do <<SLOT FrejaCopyOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCopyItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteBefore: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteBeforeOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteBeforeItem:Descriptor>>
                                     #)
                                #);
                              iPaste: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do <<SLOT FrejaPasteOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteAfter:
                                @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteAfterOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaPasteAfterItem:Descriptor>>
                                     #)
                                #);
                              iClear: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do <<SLOT FrejaClearOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaClearItem:Descriptor>>;
                                        INNER
                                          ;
                                        
                                     #);
                                   init::< 
                                     (# 
                                     do
                                        disable
                                     #)
                                #);
                              sep1,sep2,sep3,sep4,sep5,sep6: @Item;
                              insertBeforeItem: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT InsertBeforeOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertBeforeHit:Descriptor>>
                                     #)
                                #);
                              insertAfter:
                                @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do <<SLOT InsertAfterOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertAfterHit:Descriptor>>
                                     #)
                                #);
                              TextModeOn:
                                @Boolean;
                              iEditName: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     <<SLOT FrejaEditMenuIEditNameOnStatus:DoPart>>
                                     #);
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaEditMenuIEditName:DoPart>>
                                     #)
                                #);
                              iTextEdit:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaEditMenuITextEdit:Descriptor>>
                                     #)
                                #);
                              iEditOtherText: @item
                                (#
                                   onStatus::< 
                                     (# 
                                     <<SLOT iEditOtherTextOnStatus:DoPart>>
                                     #);
                                   hit::<
                                     (#  <<SLOT iEditOtherText:DoPart>> #)
                                #);
                              iRemoveOptionals:
                                @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaRemoveOptionalsOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaRemoveOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iShowOptionals: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaShowOptionalsOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaShowOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
		              iFind: @myItem
                                (# 
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaFindOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (#
                                        thePage: ^Page;
                                        theOADPage: ^OADPage;
                                        theDesObj: ^theOADPage.DesignObject;
                                        theObject:
                                          ^theOADPage.PatternDiagramNode
                                       <<SLOT frejaSearchItemDesc:DoPart>>
                                     #);
                                #);
		              iReplace: @myItem
                                (# 
                                   onStatus::< 
                                     (# 
                                     do
                                        <<SLOT FrejaReplaceOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaReplaceItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCheck: @myItem
                                (#
                                   onStatus::< 
                                     (# 
                                     do <<SLOT FrejaCheckOnStatus:Descriptor>>
                                     #);
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaCheckItem:Descriptor>>; 
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT EditMenuInit:Descriptor>>
                                #);
                              
                           #);
                         ViewMenuDesc::< 
                           (#
                              LayoutPreferencesDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaLayputPreferencesDesc:DoPart>>
                                     #)
                                #);
                              ShowDesc::< 
                                (#
                                   init:: 
                                     (# 
                                     <<SLOT FrejaShowItemDescInit:DoPart>>
                                     #);
                                   
                                #);
                              HideDesc::< 
                                (#
                                   init:: 
                                     (# 
                                     <<SLOT FrejaHideItemDescInit:DoPart>>
                                     #);
                                   
                                #);
                              ShowAttributesWithDesc::<
                                (#
                                   init::
                                     (# 
                                     <<SLOT ShowAttributesWithInit:DoPart>>
                                     #);
                                   
                                #);
                              TraceItemDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaViewMenuTraceItem:DoPart>>
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT FrejaViewMenuInit:Descriptor>>;
                                   
                                #)
                           #);
                         AttributeKindMenu: @UserMenu
                           (#
                              NewClass: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuNewClass:Descriptor>>;
                                        
                                     #)
                                #);
                              sep: @Item;
                              attrKindItem: Item
                                (#
                                   hit::< 
                                     (# op: ^OADPage; oadd: ^op.OADDiagram
                                     <<SLOT attrKindItem:DoPart>>
                                     #)
                                #);
                              Attribute:
                                @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuAttribute:DoPart>>
                                     #)
                                #);
                              Operation: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuOperation:DoPart>>
                                     #)
                                #);
                              localClass: @attrKindItem
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT AttributeKindMenuLocalClass:DoPart>>
                                     #)
                                #);
                              disable:: 
                                (# 
                                <<SLOT AttributeKindMenuDisable:DoPart>>
                                #);
                              enable:: 
                                (# 
                                <<SLOT AttributeKindMenuEnable:DoPart>>
                                #);
                              init::< 
                                (# 
                                do <<SLOT AttributeKindMenuInit:Descriptor>>; 
                                #)
                           #);
                         RelationsMenu: @UserMenu
                           (#
                              sep,sep1,sep2,sep3: @Item;
                              GeneralRelationship: @item
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT GeneralRelationshipItem:DoPart>>
                                     #)
                                #);
                              Aggregation: @item
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT RelationsMenuAggregationItem:DoPart>>
                                     #)
                                #);
                              Association: @item
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT RelationsMenuAssociationItem:DoPart>>
                                     #)
                                #);
                              Specialization: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuSpecialization:Descriptor>>;
                                        
                                     #)
                                #);
                              bind: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT RelationsMenuBind:Descriptor>>; 
                                     #)
                                #);
                              final: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuFinal:Descriptor>>; 
                                     #)
                                #);
                              pattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              edit: @item
                                (#
                                   hit:: 
                                     (# 
                                     <<SLOT RelationsMenuEditHit:DoPart>>
                                     #)
                                #);
                              disable:: 
                                (# 
                                <<SLOT RelationsMenudisable:DoPart>>
                                #);
                              enable:: 
                                (#  <<SLOT RelationsMenuEnable:DoPart>> #);
                              init::< 
                                (# 
                                do
                                   <<SLOT RelationsMenuInit:Descriptor>>;
                                   
                                #)
                           #);
                         ExpandMenu: UserMenu
                           (#
                              theItems: [noOfItems] ^ExpandItem;
                              noOfItems: (#  exit 12 #);
                              ExpandItem: Item
                                (#
                                   synCatNo: @Integer;
                                   syncatName: ^Text;
                                   hit::< 
                                     (# 
                                     do <<SLOT ExpandItemHit:Descriptor>>
                                     #);
                                   create:
                                     (# i: @Integer; 
                                     enter (i,syncatno,syncatname[])
                                     do <<SLOT ExpandItemCreate:Descriptor>>
                                     #);
                                   
                                #);
                              CreateItems:
                                (#
                                   list:
                                     ^Text;
                                   
                                enter list[]
                                do <<SLOT ExpandMenuCreateItems:Descriptor>>
                                #);
                              deleteMenu:
                                (# 
                                do <<SLOT ExpandMenuDelete:Descriptor>>; 
                                #);
                              init::< 
                                (# 
                                do <<SLOT ExpandMenuInit:Descriptor>>; 
                                #);
                              
                           #);
                         theExpandMenu:
                           @ExpandMenu;
                         associationDialog:
                          <<SLOT associationDialog:Descriptor>>;
                         aggregationDialog:
                          <<SLOT aggregationDialog:Descriptor>>;
                         layoutPreferencesDialog:
                           @<<SLOT layoutPreferencesDialog:Descriptor>>;
                         onKeyDown::< 
                           (# fragmentBrowserIsActive: @boolean
                           <<SLOT FrejaOnKeyDown:DoPart>>
                           #);
                         onInit::< 
                           (# 
                           do
                              <<SLOT FrejaOADDocumentOnInit:Descriptor>>;
                              
                           #)
                      #);
                    FileMenuDesc::< 
                      (#
                         NewBETAProgramDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETAProgram:Descriptor>>
                                #)
                           #);
                         NewBETALibraryDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETALibrary:Descriptor>>
                                #)
                           #);
                         QuitDesc::< 
                           (#
                              hit::< 
                                (# 
                                do <<SLOT FrejaFileMenuQuit:Descriptor>>
                                #)
                           #)
                      #);
                    onInit::< 
                      (# 
                      do
                         <<SLOT FrejaDesignInterfaceOnInit:Descriptor>>;
                         
                      #);
                    private: @<<SLOT frejaDesignInterfacePrivate:Descriptor>>
                 <<SLOT FrejaDesignInterfaceDoPart:DoPart>>
                 #);
               frejaAssociationsInclude:: 
                 (#  do '~beta/freja/associations'->t[] #);
               enableEditName::< 
                 (#  <<SLOT GraphicalInterfaceEnableEditName:DoPart>> #);
               disableEditName::< 
                 (#  <<SLOT theGraphicalInterfaceDisableEditName:DoPart>> #);
               enablePaste::< 
                 (#  <<SLOT theGraphicalInterfaceEnablePaste:DoPart>> #);
               doOADPaste::< 
                 (# 
                 <<SLOT theGraphicalInterfaceDoOADPaste:DoPart>>
                 #);
               doObjectPaste::< 
                 (#  <<SLOT theGraphicalInterfaceDoObjectPaste:DoPart>> #);
               pasteGroupWithOAD::< 
                 (# 
                 <<SLOT theGraphicalInterfacePasteGroupWithOAD:DoPart>>
                 #);
               callChecker::< 
                 (#  do fg[]->theController.globalSifCommands.check #);
               sifSaveAndQuit::< 
                 (#  do theController.globalSifCommands.saveAndQuit #);
               sifSave::<  (#  do theController.globalSifCommands.save #);
               sifAutoSave::< 
                 (#  do theController.globalSifCommands.autoSave #);
               sifCheckAutoSaveFile::< 
                 (# 
                 do
                    fg[]->theController.globalSifCommands.checkAutoSaveFile
                      ->didRecover
                 #);
               sifAddProp::< 
                 (# 
                 do
                    (fg[],propName[],propString[])
                      ->theController.globalSifCommands.addProp
                 #);
               sifSetFrejaMark::< 
                 (# 
                 do fg[]->theController.globalSifCommands.setFrejaMark
                 #);
               sifGetFrejaMark::< 
                 (# 
                 do
                    fg[]->theController.globalSifCommands.getFrejaMark
                      ->frejaMark
                 #);
               fileCreateDialog::< 
                 (# t: ^text <<SLOT FrejaFileCreateDialog:DoPart>> #);
               fileSelectDialog::< 
                 (# t: ^text
                 <<SLOT FrejaFileSelectDialog:DoPart>>
                 #);
               alertUser::< 
                 (#  <<SLOT frejaDesignInterfaceAlertUser:DoPart>> #);
               promptForBoolean::<
                 (#  <<SLOT frejaPromptForBoolean:DoPart>> #);
               promptForYesNo::< 
                 (# 
                 <<SLOT frejaPromptForYesNo:DoPart>>
                 #);
               
            do <<SLOT FrejaDoPart:Descriptor>>
            #);
          theGraphicalInterface:
            @GraphicalInterface
       do theGraphicalInterface; INNER sdeModel
       #);
     sdeControl:<
       (#
          globalSifCommands: @globalSifCommandsDesc;
          globalSifCommandsDesc:<
            (#
               openForm:<
                 (#
                    name: ^Text; node: ^theModel.theGraphicalInterface.mps.ast
                 enter (name[],node[])
                 do INNER openForm
                 #);
               newBETAProgram:<
                 (# name: ^Text enter name[] do INNER newBETAProgram #);
               newBETALibrary:<
                 (# name: ^Text enter name[] do INNER newBETAlibrary #);
               saveAndQuit:< (#  do INNER saveAndQuit #);
               save:< (#  do INNER save #);
               autoSave:< (#  do INNER autosave #);
               checkAutoSaveFile:<
                 (#
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup;
                    didRecover: @boolean
                 enter fg[]
                 do INNER checkAutoSaveFile
                 exit didRecover
                 #);
               check:<
                 (# fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 do INNER check
                 #);
               addProp:<
                 (#
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup;
                    propName,propString: ^text
                 enter (fg[],propName[],propString[])
                 do INNER addProp
                 #);
               deleteProp:<
                 (#
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup;
                    propName,propString: ^text
                 enter (fg[],propName[],propString[])
                 do INNER deleteProp
                 #);
               setFrejaMark:<
                 (#
                    frejamark: @boolean;
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 do INNER setFrejaMark
                 #);
               getFrejaMark:<
                 (#
                    frejamark: @integer;
                    fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 do INNER getFrejaMark
                 exit frejamark
                 #);
               toggleDebug:< (#  do INNER toggleDebug #)
            #)
       #);
     theModel: @sdeModel;
     theController: @sdeControl
  do INNER frejaenv
  #)  

