ORIGIN '~beta/basiclib/v1.4/betaenv';
OBJFILE default '~beta/designOA/v1.0/$/getarg.o';
BODY 'private/frejamenu'
     'private/frejabody';
INCLUDE '~beta/gpp/v2.0/gppinterface'
        '~beta/gpp/v2.0/prettyprintersetup'
        '~beta/gpp/v2.0/private/diagramattributes'
        'sdecommunication'
        '~beta/sysutils/v1.4/envstring'
        '~beta/Xt/v1.8/xlib';
(*'private/display'*)
-- lib: Attributes --
freja:
  (#
     sdeModel:<
       (#
          selection: (#  #);
          updatePrettyPrint: (#  #);
          withDexter:
          (* if true then we start sif with dexter hyperlink support *)
            @Boolean;
          HandleControllerMessage:
            (# t: @Text; 
            enter t
            do <<SLOT HandleControllerMessage:Descriptor>>; 
            #);
          parseStatusMessage:
            (#
               status,trailer:
                 ^Text;
               OK: @Boolean;
               editorID: @Integer;
               command: ^Text;
               
            enter status[]
            do
               <<SLOT ParseStatusMessage:Descriptor>>
            exit (command[],ok,editorID,trailer[])
            #);
          theGraphicalInterface: @GraphicalInterface;
          GraphicalInterface:< gppInterface
            (#
               updateFragmentForm::< 
                 (#  do ff[]->sifEditorList.updateFragmentForm #);
               sendSifCommand::< 
                 (#  do t[]->theController.sendSifCommand #);
               sifEditorList: @containerlist
                 (#
                    element::< 
                      (# editorId: @integer; ff: ^fragmentForm #);
                    findFragmentForm:
                      (# editorId: @integer; ff: ^fragmentForm
                      enter editorId
                      do <<SLOT findFragmentForm:Descriptor>>
                      exit ff[]
                      #);
                    updateFragmentForm:
                      (#
                         ff: ^fragmentForm;
                         
                      enter ff[]
                      do
                         <<SLOT updateFragmentForm:Descriptor>>
                      #);
                    findEditorId:
                      (# ff: ^fragmentForm; editorId: @integer; 
                      enter ff[]
                      do <<SLOT findEditorId:Descriptor>>
                      exit editorId
                      #);
                    insert:
                      (# theElm: ^element
                      enter theElm[]
                      do
                         <<SLOT SifEditorListInsert:Descriptor>>;
                         
                      #);
                    dump:
                      (#  do <<SLOT SifEditorListDump:Descriptor>>;  #);
                    
                 #);
               DesignInterface::< 
                 (#
                    onInit::< 
                      (# 
                      do
                         (UserMenu3,'File')
                           ->
                             theFileMenu.
                               init;
                         menuID.editMenu->theFileMenu.insertBefore;
                         enable.ConnEndsGrammarCallBack;
                         enable.KbdEventCallBack;
                         false->withDexter;
                         menuID.fileMenu->DSMenuDeleteMenu;
                         DocFileMenu[]->menuBar.remove
                      #);
                    FileMenuDesc::< 
                      (#
                         NewBETAProgramDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETAProgram:Descriptor>>
                                #)
                           #);
                         NewBETALibraryDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETALibrary:Descriptor>>
                                #)
                           #);
                         QuitDesc::< 
                           (#
                              hit::< 
                                (# 
                                do <<SLOT FrejaFileMenuQuit:Descriptor>>
                                #)
                           #)
                      #);
                    ShowSIFSelection:
                      @Boolean;
                    OADDocument::< 
                      (#
                         onInit::< 
                           (# 
                           do <<SLOT FrejaOADDocumentOnInit:Descriptor>>; 
                           #);
                         FrejaEditMenu: @UserMenu
                           (#
                              iUndo: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iUndoGraphicalOperation: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoGraphicalOperationItem:Descriptor>>;
                                        
                                     #)
                                #);
                              iCut: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCutItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCopy: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCopyItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteBefore: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteBeforeItem:Descriptor>>
                                     #)
                                #);
                              iPaste: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteAfter:
                                @item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaPasteAfterItem:Descriptor>>
                                     #)
                                #);
                              iClear: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaClearItem:Descriptor>>;
                                        INNER
                                          ;
                                        
                                     #);
                                   init::< 
                                     (# 
                                     do
                                        disable
                                     #)
                                #);
                              sep1,sep2,sep3,sep4,sep5: @Item;
                              insertBeforeItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertBeforeHit:Descriptor>>
                                     #)
                                #);
                              insertAfter:
                                @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertAfterHit:Descriptor>>
                                     #)
                                #);
                              TextModeOn:
                                @Boolean;
                              iTextEdit: @Item
                                (#
                                   hit::< 
                                     (#  do <<SLOT iTextEdit:Descriptor>> #)
                                #);
                              iRevertTextEdit: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT iRevertTextEdit:Descriptor>>
                                     #)
                                #);
                              iRemoveOptionals: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaRemoveOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iShowOptionals: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaShowOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCheck: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaCheckItem:Descriptor>>; 
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT EditMenuInit:Descriptor>>
                                #);
                              
                           #);
                         ViewMenuDesc::< 
                           (#
                              TraceItemDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        '#0toggleDebug'
                                          ->theController.sendSifCommand
                                     #)
                                #);
                              DumpSifEditorList: @item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT DumpSifEditorList:Descriptor>>; 
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT FrejaViewMenuInit:Descriptor>>; 
                                #)
                           #);
                         EditorMenu:
                           @UserMenu
                           (#
                              sep: @Item;
                              ShowCodeItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT ShowCodeItem:Descriptor>>
                                     #)
                                #);
                              NewProgramItem:
                                @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT NewProgramItem:Descriptor>>
                                     #)
                                #);
                              NewLibraryItem:
                                @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT NewLibraryItem:Descriptor>>
                                     #)
                                #);
                              CheckItem:
                                @Item
                                (#
                                   hit::< 
                                     (#  do <<SLOT CheckItem:Descriptor>> #)
                                #);
                              SelectItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT SelectItem:Descriptor>>
                                     #)
                                #);
                              OffCommItem: @Item
                              (* temporarily *)
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT OffCommHit:Descriptor>>
                                     #)
                                #);
                              SendCommandItem:
                                @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT SendCommandHit:Descriptor>>
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT EditorMenuInit:Descriptor>>
                                #);
                              
                           #);
                         ObjectCreateMenu: @UserMenu
                           (#
                              CreateNewPage: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreateNewPage:Descriptor>>
                                     #)
                                #);
                              CreatePassiveObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreatePassiveObject:Descriptor>>
                                     #)
                                #);
                              CreateMultipleObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateMultipleObject:Descriptor>>
                                     #)
                                #);
                              CreateConcurrentObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateConcurrentObject:Descriptor>>
                                     #)
                                #);
                              CreateInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreateTwoWayInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateTwoWayInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreateDistributedInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateDistributedInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreateTwoWayDistributedInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateTwoWayDistributedInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreatePattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreatePattern:Descriptor>>
                                     #)
                                #);
                              CreatePatternPrefix: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreatePatternPrefix:Descriptor>>
                                     #)
                                #);
                              CreateVirtualPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateVirtualPattern:Descriptor>>
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT ObjectCreateMenuInit:Descriptor>>
                                #);
                              
                           #);
                         AttributeKindMenu: @UserMenu
                           (#
                              NewPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuNewPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              sep: @Item;
                              LocalPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuLocalPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              PartObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuPartObject:Descriptor>>;
                                        
                                     #)
                                #);
                              DynamicReference: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuDynamicReference:Descriptor>>;
                                        
                                     #)
                                #);
                              VirtualPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuVirtualPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              BindingOfVirtualPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuBindingOfVirtualPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              FinalBindOfVirtPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuFinalBindOfVirtPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT AttributeKindMenuInit:Descriptor>>; 
                                #)
                           #);
                         RelationsMenu: @UserMenu
                           (#
                              sep,sep1,sep2: @Item;
                              StaticItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuStaticItem:Descriptor>>;
                                        
                                     #)
                                #);
                              StaticComponent: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuStaticComponent:Descriptor>>;
                                        
                                     #)
                                #);
                              DynamicItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuDynamicItem:Descriptor>>;
                                        
                                     #)
                                #);
                              DynamicComponent: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuDynamicComponent:Descriptor>>;
                                        
                                     #)
                                #);
                              Specialization: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuSpecialization:Descriptor>>;
                                        
                                     #)
                                #);
                              bind: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT RelationsMenuBind:Descriptor>>; 
                                     #)
                                #);
                              final: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuFinal:Descriptor>>; 
                                     #)
                                #);
                              pattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              oto: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuOTOHit:Descriptor>>;
                                        
                                     #)
                                #);
                              otm: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuOTMHit:Descriptor>>;
                                        
                                     #)
                                #);
                              mtm: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuMTMHit:Descriptor>>;
                                        
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT RelationsMenuInit:Descriptor>>; 
                                #)
                           #);
                         ExpandMenu:
                          UserMenu
                           (#
                              theItems: [noOfItems] ^ExpandItem;
                              noOfItems: (#  exit 12 #);
                              ExpandItem: Item
                                (#
                                   synCatNo: @Integer;
                                   syncatName: ^Text;
                                   hit::< 
                                     (# 
                                     do <<SLOT ExpandItemHit:Descriptor>>
                                     #);
                                   create:
                                     (# i: @Integer; 
                                     enter (i,syncatno,syncatname[])
                                     do <<SLOT ExpandItemCreate:Descriptor>>
                                     #);
                                   
                                #);
                              CreateItems:
                                (#
                                   list:
                                     ^Text;
                                   
                                enter list[]
                                do <<SLOT ExpandMenuCreateItems:Descriptor>>
                                #);
                              deleteMenu:
                                (# 
                                do <<SLOT ExpandMenuDelete:Descriptor>>; 
                                #);
                              init::< 
                                (# 
                                do <<SLOT ExpandMenuInit:Descriptor>>; 
                                #);
                              
                           #);
                         theExpandMenu:
                           @ExpandMenu;
                         OADPalette: @Palette
                           (#
                              normal: @Boolean;
                              lastfree: @Point;
                              width: (#  exit 150 #);
                              height: (#  exit 20 #);
                              RightOnPage: (#  exit 80 #);
                              OADPaletteObject: RectNode
                                (#
                                   SynCatNo: @Integer;
                                   onInit::< 
                                     (# 
                                     do
                                        false->moveable;
                                        false->sizeable;
                                        false->BorderVisible;
                                        10->theText.size;
                                        1->LineType;
                                        
                                     #)
                                #);
                              obj: ^OADPaletteObject;
                              Title: (#  enter pagetitle #);
                              Add:
                                (# t: ^Text; no: @Integer; 
                                enter (no,t[])
                                do
                                   (if (1->t.inxget) = '-'
                                    // false then
                                       &OADPaletteObject[]->obj[];
                                       no->obj.SynCatNo;
                                       (lastfree.x,lastfree.y,width,height)
                                         ->obj.new;
                                       t->obj.theText.set;
                                       height*2+lastfree.y->lastfree.y;
                                       
                                   if);
                                   
                                #);
                              Clear:
                                (# x,y,w,h: @Integer; 
                                do
                                   (if isopen
                                    // true then
                                       cleanup;
                                       geometry->(x,y,w,h);
                                       (x-(w div 2)+RightOnPage,y-(h div 2)+
                                        RightOnPage)->lastfree;
                                       none ->obj[]
                                   if);
                                   
                                #);
                              Reset:
                                (# 
                                do
                                   DSUIAbortCommand;
                                   (* like pressing cmd-. or ESC 
                                    * on keyboard *)
                                   
                                #);
                              onInit::< 
                                (# x,y,w,h: @Integer; 
                                do (* set up lastfree *)
                                   geometry->(x,y,w,h);
                                   (x-(w div 2)+RightOnPage,y-(h div 2)+
                                    RightOnPage)->lastfree;
                                   
                                #);
                              onSelect::< 
                                (# p: ^Page; op: ^OADPage; 
                                do
                                   theObject[]->obj[];
                                   (if switch[1]
                                    // true then
                                       'Selected syntatical cat.: '->puttext;
                                       obj.SynCatNo->putint;
                                       newline;
                                       
                                   if);
                                   (if obj.SynCatNo <> 0
                                    // true then
                                       currentpage->p[];
                                       (if p[] <> none
                                        // true then
                                           (if p.struc <= Palette##
                                            // true then
                                               'CurrentPage is a Palette'
                                                 ->putline;
                                               
                                            else
                                               p[]->op[];
                                               (obj.SynCatNo,normal)
                                                 ->op.doExpand;
                                               
                                           if)
                                       if)
                                   if)
                                #);
                              
                           #);
                         changeASTFocus:<
                           (# SifEditorInstanceNo,ASTIndex: @integer
                           enter (SifEditorInstanceNo,ASTIndex)
                           do <<SLOT changeASTFocus:Descriptor>>; 
                           #);
                         OADPage::< 
                           (#
                              canUndo,
                                canPaste,canListInsert: @Boolean;
                              askedForFragmentForm: ^fragmentForm;
                              theFragmentNode: ^PatternDiagramNode;
                              insertedObject: ^PatternDiagramNode;
                              nonTerminalCatName: ^Text;
                              StaticItemConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT StaticItemConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              StaticComponentConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT StaticComponentConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              SpecializationConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT SpecializationConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              BindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT BindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              FinalBindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT FinalBindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              PatternVariableConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT PatternVariableConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              OTOAssociationRelation: Connector
                                (#
                                   onInit::< 
                                     (# 
                                     do
                                        <<SLOT OTOAssociationRelationOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              OTMAssociationRelation: Connector
                                (#
                                   onInit::< 
                                     (# 
                                     do
                                        <<SLOT OTMAssociationRelationOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              MTMAssociationRelation: Connector
                                (#
                                   onInit::< 
                                     (# 
                                     do
                                        <<SLOT MTMAssociationRelationOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              concludeOngoingOperation:
                                (# 
                                do
                                   <<SLOT concludeOngoingOperation:Descriptor>>;
                                   
                                #);
                              concludeExpansion:
                                (# 
                                do <<SLOT concludeExpansion:Descriptor>>; 
                                #);
                              openObjectInSif:
                                (# theObject: ^PatternDiagramNode; 
                                enter theObject[]
                                do <<SLOT OpenObjectInSif:Descriptor>>; 
                                #);
                              getStatus:
                                (#
                                   theObject:
                                     ^DesignObject;
                                   
                                enter theObject[]
                                do <<SLOT GetStatusFromSif:Descriptor>>; 
                                #);
                              doExpand:
                                (#
                                   synCatNo:
                                     @Integer;
                                   normal: @Boolean;
                                   
                                enter (synCatNo,normal)
                                do <<SLOT DoExpand:Descriptor>>; 
                                #);
                              doExpandLexem:
                                (# name: @Text; 
                                enter name
                                do
                                   <<SLOT DoExpandLexem:Descriptor>>;
                                   
                                #);
                              MakeAPalette:
                                (# t: ^Text; 
                                enter t[]
                                do <<SLOT MakeAPalette:Descriptor>>; 
                                #);
                              getDexterAnchors::< 
                                (# 
                                do <<SLOT GetDexterAnchors:Descriptor>>; 
                                #);
                              changedFocus::< 
                                (#  do <<SLOT ChangedFocus:Descriptor>> #);
                              declarationTextChanged::< 
                                (# 
                                do <<SLOT declarationTextChanged:Descriptor>>
                                #);
                              openFormInSif::< 
                                (#  do <<SLOT openFormInSif:Descriptor>> #);
                              prefixExpand::< 
                                (#  do <<SLOT prefixExpand:Descriptor>> #);
                              copy::< 
                                (# 
                                do
                                   <<SLOT copy:Descriptor>>
                                #);
                              onFocusChange:<
                                (#
                                   astindex,length,editorId: @Integer;
                                   status: @Boolean;
                                   
                                enter (editorId,astIndex,length)
                                do <<SLOT onFocusChange:Descriptor>>
                                exit status
                                #);
                              astReplaced::< 
                                (# 
                                do
                                   <<SLOT frejaAstReplaced:Descriptor>>
                                #);
                              MakeAnchors::<  (#  do INNER #);
                              presentAnchor:<
                                (# theIndex: @Integer; 
                                enter theIndex
                                do <<SLOT presentAnchor:Descriptor>>
                                #);
                              GrabPointer::< 
                                (# 
                                do
                                   (if
                                   currentObject <> none then
                                       (if switch[12] then
                                           'GrapPointer: '->putText;
                                           (currentObject).ID->putInt;
                                           ' '->put;
                                           
                                       if);
                                       FrejaLocked+1->FrejaLocked;
                                       (if switch[12] then
                                           '------------------------- FrejaLocked: '
                                             ->putText;
                                           FrejaLocked->putInt;
                                           newLine;
                                           
                                       if);
                                       (if FrejaLocked = 1 then
                                           'Communicating with Sif...'
                                             ->statusbar.set
                                       if);
                                       
                                   if)
                                #);
                              UngrabPointer::< 
                                (# 
                                do
                                   (if currentObject <> none then
                                       (if switch[12] then
                                           'UngrapPointer: '->putText;
                                           (currentObject).ID->putInt;
                                           ' '->put;
                                           
                                       if);
                                       FrejaLocked-1->FrejaLocked;
                                       (if switch[12] then
                                           '------------------------- FrejaLocked: '
                                             ->putText;
                                           FrejaLocked->putInt;
                                           newLine;
                                           
                                       if);
                                       (if frejaLocked <= 0 then
                                           statusbar.reset;
                                           0->frejaLocked;
                                           (if switch[12] then
                                               '------------------------- FrejaLocked changed to: '
                                                 ->putText;
                                               FrejaLocked->putInt;
                                               newLine
                                           if)
                                       if)
                                   if)
                                #);
                              private: @<<SLOT FrejaOADPagePrivate:Descriptor>>
                           #)
                      #);
                    activatedFromSif::< 
                      (#  do <<SLOT activatedFromSif:Descriptor>> #);
                    dexterOn::< 
                      (# 
                      do true->withDexter
                      #);
                    frejaLocked: @integer;
                    callBack::< 
                      (#
                         ConnEndsGrammar::<
                          
                           (# 
                           do <<SLOT FrejaConnEndsGrammar:Descriptor>>; 
                           #);
                         KbdEvent::< 
                           (# 
                           do
                              <<SLOT FrejaKbdEvent:Descriptor>>;
                              
                           #);
                         MouseDown::< 
                           (#  do <<SLOT FrejaMouseDown:Descriptor>>;  #);
                         DoubleClick::< 
                           (# 
                           do
                              <<SLOT FrejaDoubleClick:Descriptor>>;
                              
                           #)
                      #);
                    
                 do
                    false->userdataVerbose;
                    true
                      ->ShowSifSelection
                      (*toby: Hack, because editormenu is currently not initialised
                       ess: udmaerket hack :-) *) ;
                    false->callbackVerbose;
                    false->switch[10]->switch[11]->switch[12];
                    false->switch[1]->switch[2]->switch[20]->switch[21]
                      ->switch[22]->switch[23];
                    false->switch[17] (* autosave etc *) ;
                    false->switch[18] (* tracing endian problem on linux *)
                 #);
               
            do <<SLOT FrejaDoPart:Descriptor>>
            #);
          
       do theGraphicalInterface; 
       #);
     (* end sdeModel *)
     sdeControl:<
       (#
          startedFromProgram: @Boolean;
          sifPort: @integer;
          com: @sdeCommunication
            (#
               onInput::< 
                 (# 
                 do
                    msg
                      ->
                        theModel.
                          HandleControllerMessage;
                    
                 #);
               
            #);
          init: (#  do <<SLOT ControllerInit:Descriptor>> #);
          close:
            (# 
            do
               <<SLOT ControllerClose:Descriptor>>
            #);
          sendSifCommand:
            (# t: ^Text; 
            enter t[]
            do <<SLOT ControllerSendSifCommand:Descriptor>>
            #);
          sendSifStatus:
            (# t: ^Text; 
            enter t[]
            do t[]->com.putline; 
            #);
          
       #);
     theModel: @sdeModel;
     theController: @sdeControl;
     
  do theModel; 
  #)  

