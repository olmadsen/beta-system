(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
ORIGIN '~beta/basiclib/v1.5/betaenv';
BODY 'private/frejamenu'
     'private/frejabody'
     'private/frejaexternalinterfacebody'
     '~beta/editor/v5.1/private/compiler'
     '~beta/editor/v5.1/private/nouser';
INCLUDE '~toby/beta/gpp/v2.2/gppinterface'
        '~toby/beta/gpp/v2.2/prettyprintersetup'
        '~toby/beta/gpp/v2.2/private/diagramattributes'
        '~beta/sysutils/v1.5/envstring'
        '~beta/Xt/v1.9/xlib'
        '~beta/editor/v5.1/ymersiflib'
        '~beta/guienv/v1.4/utils/designsupport'
        '~beta/editor/v5.1/frejasifcomm';
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
(*'private/display'*)
-- lib: Attributes --
freja:
  (#
     theFragmentBrowser: @FragmentBrowser
       (#
          ymerBrowserWindow::< 
            (#
               browserTitle::  (#  do 'Sif: '->title.prepend #);
               menubarType::< 
                 (#
                    groupFileMenuType:: 
                      (#
                         open:: 
                           (# 
                           do
                              'New...'->iNew.new;
                              'New BETA Program...'->iNewBetaProgram.new;
                              'New BETA Library...'->iNewBetaLibrary.new;
                              newSeparator;
                              'Close'->iClose.new;
                              'Save'->iSave.new;
                              'Save As...'->iSaveAs.new;
                              'Save All...'->iSaveAll.new;
                              'Save Abstract...'->iSaveAbstract.new;
                              newSeparator;
                              'Recover'->iRecover.new;
                              'Revert'->iRevert.new;
                              newSeparator;
                              'Group Write Protection'->iSetIsReadOnly.new;
                              'Global Write Protection'
                                ->iSetGlobalWriteProtection.new
                           #)
                      #);
                    groupPerformMenuType:: 
                      (#
                         open::< 
                           (# 
                           do
                              'Check Current'->iCheck.new;
                              'Recheck'->iReCheck.new;
                              'Compile Current'->iCompile.new;
                              'Recompile'->iRecompile.new;
                              'Execute Current'->iExecute.new;
                              'Reexecute'->iReExecute.new;
                              newSeparator;
                              'Debug'->iDebug.new;
                              newSeparator;
                              'Semantic Errors...'->iSemanticErrors.new;
                              newSeparator;
                              'Show Diagram'->iShowDiagram.new;
                              INNER
                           #)
                      #);
                    open::< 
                      (# 
                      do
                         SLOTs.new;
                         SLOTs[]->append;
                         'Fragment'->GroupEdit.new;
                         'Tools'->GroupPerform.new;
                         INNER
                      #)
                 #);
               open::  (#  do true->sifHidden; hide #)
            #);
          isBETAsif::<  (#  do true->value #);
          frejaInclude::< 
            (# 
            do theModel.theGraphicalInterface.frejaAssociationsInclude->t[]
            #);
          init::< 
            (# 
            do
               ymerBrowser.initCompiler;
               ('Sif: Known Bugs and Inconveniences',
                '~beta/editor/v5.1/doc/TODO')->helpDocument;
               ('Freja: Known Bugs and Inconveniences',
                '~beta/freja/v2.2/FrejaSifStatus')->helpDocument;
               ('Freja FAQ','~beta/freja/doc/freja-faq.html')->helpDocument;
               
            #)
       do
          'Please send error reports and comments to freja@mjolner.dk'->putline;
          'Freja - Mjolner BETA Case Tool version 2.2(1)'->putLine;
          '        using Mjolner BETA Browser and Editor version '->putText;
          editorVersion->putLine;
          '        integrated with the BETA Compiler version '->putText;
          compilerVersion->putLine;
          '        Basiclib version: '->puttext;
          betaenvVersion->putline
       #);
     sifHidden: @boolean;
     FrejaPromptForText:
       (#
          message,defaultText: ^text;
          confirm:< (# theText: ^text enter theText[] do INNER #);
          cancel:< object;
          
       enter (message[],defaultText[])
       <<SLOT FrejaPromptForText:DoPart>>
       #);
     theExternalInterface:
       @frejaExternalInterface
       (#
          newFragment::< 
            (#  <<SLOT theExternalInterfaceNewFragment:DoPart>> #);
          astReplaced::< 
            (#
               theOADDocument:
                 ^theModel.
                    theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theOADDocument.OADPage;
               thePage: ^theOADDocument.Page
            <<SLOT theExternalInterfaceAstReplaced:DoPart>>
            #);
          listElementInserted::<
           
            (#
               theOADDocument:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theOADDocument.OADPage;
               thePage: ^theOADDocument.Page
            <<SLOT theExternalInterfaceListElementInserted:DoPart>>
            #);
          listElementsDeleted::< 
            (#
               theOADDocument:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theOADDocument.OADPage;
               thePage: ^theOADDocument.Page
            <<SLOT theExternalInterfaceListElementsDeleted:DoPart>>
            #);
          listElementsReplaced::< 
            (#
               theOADDocument:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theOADDocument.OADPage;
               thePage: ^theOADDocument.Page
            <<SLOT theExternalInterfaceListElementsReplaced:DoPart>>
            #);
          focusChanged::< 
            (#
               theOADDocument:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theOADDocument.OADPage;
               thePage: ^theOADDocument.Page;
               status: @boolean
            <<SLOT theExternalInterfaceFocusChanged:DoPart>>
            #);
          openForm::< 
            (# 
            <<SLOT theExternalInterfaceOpenForm:DoPart>>
            #);
          groupChecked::< 
            (#
               theOADDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceGroupChecked:DoPart>>
            #);
          propertiesChanged::< 
            (#
               theDoc:
                 ^theModel.
                    theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfacePropertiesChanged:DoPart>>
            #);
          fragmentChanged::< 
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceFragmentChanged:DoPart>>
            #);
          fragmentInserted::<
           
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceFragmentInserted:DoPart>>
            #);
          fragmentDeleted::<
           
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceFragmentDeleted:DoPart>>
            #)
       #);
     sdeModel:<
       (#
          selection:
            (#  #);
          updatePrettyPrint:
           (#  #);
          withDexter:
          (* if true then we start sif with dexter hyperlink support *)
            @Boolean;
          theGraphicalInterface: @GraphicalInterface;
          GraphicalInterface:< gppInterface
            (#
               frejaAssociationsInclude:: 
                 (#  do '~beta/freja/v2.2/associations'->t[] #);
               enableEditName::< 
                 (# theOADDocument: ^theDesignInterface.OADDocument
                 <<SLOT GraphicalInterfaceEnableEditName:DoPart>>
                 #);
               disableEditName::< 
                 (# theOADDocument: ^theDesignInterface.OADDocument
                 <<SLOT theGraphicalInterfaceDisableEditName:DoPart>>
                 #);
               sifSaveAndQuit::< 
                 (#  do theController.globalSifCommands.saveAndQuit #);
               sifSave::<  (#  do theController.globalSifCommands.save #);
               sifAutoSave::< 
                 (#  do theController.globalSifCommands.autoSave #);
               alertUser::< 
                 (# 
                 do (none ,message[],'Alert')->theFragmentBrowser.alertUser
                 #);
               promptForBoolean::< 
                 (#  <<SLOT frejaPromptForBoolean:DoPart>> #);
               DesignInterface::< 
                 (#
                    onInit::< 
                      (# 
                      do
                         <<SLOT FrejaDesignInterfaceOnInit:Descriptor>>;
                         
                      #);
                    FileMenuDesc::< 
                      (#
                         NewBETAProgramDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETAProgram:Descriptor>>
                                #)
                           #);
                         NewBETALibraryDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuNewBETALibrary:Descriptor>>
                                #)
                           #);
                         hideShowSifItemDesc::< 
                           (#
                              hit::< 
                                (#  <<SLOT frejaHideShowSifItem:DoPart>> #)
                           #);
                         QuitDesc::< 
                           (#
                              hit::< 
                                (# 
                                do
                                   <<SLOT FrejaFileMenuQuit:Descriptor>>
                                #)
                           #)
                      #);
                    ShowSIFSelection: @Boolean;
                    OADDocument::< 
                      (#
                         checkEditMenuTextEdit::< 
                           (#  <<SLOT FrejaCheckEditMenuTextEdit:DoPart>> #);
                         onInit::< 
                           (# 
                           do <<SLOT FrejaOADDocumentOnInit:Descriptor>>; 
                           #);
                         FrejaEditMenu: @UserMenu
                           (#
                              myItem: item
                                (#
                                   myDisable:
                                     (#  do true->doNotEnable; disable #);
                                   myEnable:
                                     (#  do false->doNotEnable; enable #)
                                #);
                              iUndo: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iUndoGraphicalOperation: @item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaUndoGraphicalOperationItem:Descriptor>>;
                                        
                                     #)
                                #);
                              iCut: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCutItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCopy: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaCopyItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteBefore: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteBeforeItem:Descriptor>>
                                     #)
                                #);
                              iPaste: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaPasteItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iPasteAfter:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaPasteAfterItem:Descriptor>>
                                     #)
                                #);
                              iClear: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaClearItem:Descriptor>>;
                                        INNER
                                          ;
                                        
                                     #);
                                   init::< 
                                     (# 
                                     do
                                        disable
                                     #)
                                #);
                              sep1,sep2,sep3,sep4,sep5: @Item;
                              insertBeforeItem: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertBeforeHit:Descriptor>>
                                     #)
                                #);
                              insertAfter:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT InsertAfterHit:Descriptor>>
                                     #)
                                #);
                              TextModeOn:
                                @Boolean;
                              iEditName: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaEditMenuIEditName:DoPart>>
                                     #)
                                #);
                              iTextEdit:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaEditMenuITextEdit:Descriptor>>
                                     #)
                                #);
                              iEditOtherText: @item
                                (#
                                   hit::< 
                                     (#  <<SLOT iEditOtherText:DoPart>> #)
                                #);
                              iRevertTextEdit:
                                @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT iRevertTextEdit:Descriptor>>
                                     #)
                                #);
                              iRemoveOptionals: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaRemoveOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iShowOptionals: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT FrejaShowOptionalsItem:Descriptor>>;
                                        INNER
                                     #)
                                #);
                              iCheck: @myItem
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT FrejaCheckItem:Descriptor>>; 
                                     #)
                                #);
                              init::< 
                                (# 
                                do
                                   <<SLOT EditMenuInit:Descriptor>>
                                #);
                              
                           #);
                         ViewMenuDesc::< 
                           (#
                              SearchItemDesc::< 
                                (#
                                   hit::< 
                                     (#
                                        thePage: ^Page;
                                        theOADPage: ^OADPage;
                                        theDesObj: ^theOADPage.DesignObject;
                                        theObject:
                                          ^theOADPage.PatternDiagramNode
                                     <<SLOT frejaSearchItemDesc:DoPart>>
                                     #)
                                #);
                              LayoutPreferencesDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     <<SLOT FrejaLayputPreferencesDesc:DoPart>>
                                     #)
                                #);
                              TraceItemDesc::< 
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        theController.globalSifCommands.
                                          toggleDebug
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT FrejaViewMenuInit:Descriptor>>; 
                                #)
                           #);
                         ObjectCreateMenu:
                           @UserMenu
                           (#
                              CreateNewPage: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreateNewPage:Descriptor>>
                                     #)
                                #);
                              CreatePassiveObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreatePassiveObject:Descriptor>>
                                     #)
                                #);
                              CreateMultipleObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateMultipleObject:Descriptor>>
                                     #)
                                #);
                              CreateConcurrentObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateConcurrentObject:Descriptor>>
                                     #)
                                #);
                              CreateInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreateTwoWayInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateTwoWayInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreateDistributedInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateDistributedInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreateTwoWayDistributedInteractionRelation: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateTwoWayDistributedInteractionRelation:Descriptor>>
                                     #)
                                #);
                              CreatePattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreatePattern:Descriptor>>
                                     #)
                                #);
                              CreatePatternPrefix: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT CreatePatternPrefix:Descriptor>>
                                     #)
                                #);
                              CreateVirtualPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT CreateVirtualPattern:Descriptor>>
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT ObjectCreateMenuInit:Descriptor>>
                                #);
                              
                           #);
                         AttributeKindMenu: @UserMenu
                           (#
                              NewPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuNewPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              sep: @Item;
                              LocalPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuLocalPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              PartObject: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuPartObject:Descriptor>>;
                                        
                                     #)
                                #);
                              DynamicReference: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuDynamicReference:Descriptor>>;
                                        
                                     #)
                                #);
                              VirtualPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuVirtualPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              BindingOfVirtualPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuBindingOfVirtualPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              FinalBindOfVirtPattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT AttributeKindMenuFinalBindOfVirtPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT AttributeKindMenuInit:Descriptor>>; 
                                #)
                           #);
                         RelationsMenu: @UserMenu
                           (#
                              sep,sep1,sep2: @Item;
                              StaticItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuStaticItem:Descriptor>>;
                                        
                                     #)
                                #);
                              StaticComponent: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuStaticComponent:Descriptor>>;
                                        
                                     #)
                                #);
                              DynamicItem: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuDynamicItem:Descriptor>>;
                                        
                                     #)
                                #);
                              DynamicComponent: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuDynamicComponent:Descriptor>>;
                                        
                                     #)
                                #);
                              Specialization: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuSpecialization:Descriptor>>;
                                        
                                     #)
                                #);
                              bind: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do <<SLOT RelationsMenuBind:Descriptor>>; 
                                     #)
                                #);
                              final: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuFinal:Descriptor>>; 
                                     #)
                                #);
                              pattern: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuPattern:Descriptor>>;
                                        
                                     #)
                                #);
                              oto: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuOTOHit:Descriptor>>;
                                        
                                     #)
                                #);
                              otm: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuOTMHit:Descriptor>>;
                                        
                                     #)
                                #);
                              mtm: @Item
                                (#
                                   hit::< 
                                     (# 
                                     do
                                        <<SLOT RelationsMenuMTMHit:Descriptor>>;
                                        
                                     #)
                                #);
                              selfAssociate: @Item
                                (#
                                   hit::< 
                                     (# theWindow: ^selfAssociateWindow
                                     <<SLOT RealtionsMenuSelfAssociateHit:DoPart>>
                                     #)
                                #);
                              init::< 
                                (# 
                                do <<SLOT RelationsMenuInit:Descriptor>>; 
                                #)
                           #);
                         ExpandMenu:
                          UserMenu
                           (#
                              theItems: [noOfItems] ^ExpandItem;
                              noOfItems: (#  exit 12 #);
                              ExpandItem: Item
                                (#
                                   synCatNo: @Integer;
                                   syncatName: ^Text;
                                   hit::< 
                                     (# 
                                     do <<SLOT ExpandItemHit:Descriptor>>
                                     #);
                                   create:
                                     (# i: @Integer; 
                                     enter (i,syncatno,syncatname[])
                                     do <<SLOT ExpandItemCreate:Descriptor>>
                                     #);
                                   
                                #);
                              CreateItems:
                                (#
                                   list:
                                     ^Text;
                                   
                                enter list[]
                                do <<SLOT ExpandMenuCreateItems:Descriptor>>
                                #);
                              deleteMenu:
                                (# 
                                do <<SLOT ExpandMenuDelete:Descriptor>>; 
                                #);
                              init::< 
                                (# 
                                do <<SLOT ExpandMenuInit:Descriptor>>; 
                                #);
                              
                           #);
                         theExpandMenu:
                           @ExpandMenu;
                         OADPalette: @Palette
                           (#
                              normal: @Boolean;
                              lastfree: @Point;
                              width: (#  exit 150 #);
                              height: (#  exit 20 #);
                              RightOnPage: (#  exit 80 #);
                              OADPaletteObject: RectNode
                                (#
                                   SynCatNo: @Integer;
                                   onInit::< 
                                     (# 
                                     do
                                        false->moveable;
                                        false->sizeable;
                                        false->BorderVisible;
                                        10->theText.size;
                                        1->LineType;
                                        
                                     #)
                                #);
                              obj: ^OADPaletteObject;
                              Title: (#  enter pagetitle #);
                              Add:
                                (# t: ^Text; no: @Integer; 
                                enter (no,t[])
                                do
                                   (if (1->t.inxget) = '-'
                                    // false then
                                       &OADPaletteObject[]->obj[];
                                       no->obj.SynCatNo;
                                       (lastfree.x,lastfree.y,width,height)
                                         ->obj.new;
                                       t->obj.theText.set;
                                       height*2+lastfree.y->lastfree.y;
                                       
                                   if);
                                   
                                #);
                              Clear:
                                (# x,y,w,h: @Integer; 
                                do
                                   (if isopen
                                    // true then
                                       cleanup;
                                       geometry->(x,y,w,h);
                                       (x-(w div 2)+RightOnPage,y-(h div 2)+
                                        RightOnPage)->lastfree;
                                       none ->obj[]
                                   if);
                                   
                                #);
                              Reset:
                                (# 
                                do
                                   DSUIAbortCommand;
                                   (* like pressing cmd-. or ESC 
                                    * on keyboard *)
                                   
                                #);
                              onInit::< 
                                (# x,y,w,h: @Integer; 
                                do (* set up lastfree *)
                                   geometry->(x,y,w,h);
                                   (x-(w div 2)+RightOnPage,y-(h div 2)+
                                    RightOnPage)->lastfree;
                                   
                                #);
                              onSelect::< 
                                (# p: ^Page; op: ^OADPage; 
                                do
                                   theObject[]->obj[];
                                   (if switch[1]
                                    // true then
                                       'Selected syntatical cat.: '->puttext;
                                       obj.SynCatNo->putint;
                                       newline;
                                       
                                   if);
                                   (if obj.SynCatNo <> 0
                                    // true then
                                       currentpage->p[];
                                       (if p[] <> none
                                        // true then
                                           (if p## <= Palette##
                                            // true then
                                               'CurrentPage is a Palette'
                                                 ->putline;
                                               
                                            else
                                               p[]->op[];
                                               (obj.SynCatNo,normal)
                                                 ->op.doExpand;
                                               
                                           if)
                                       if)
                                   if)
                                #);
                              
                           #);
                         OADPage::< 
                           (#
                              canUndo,canPaste,canListInsert: @Boolean;
                              askedForFragmentForm: ^mps.fragmentform;
                              theFragmentNode: ^PatternDiagramNode;
                              insertedObject: ^PatternDiagramNode;
                              nonTerminalCatName: ^Text;
                              StaticItemConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT StaticItemConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              StaticComponentConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT StaticComponentConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              SpecializationConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT SpecializationConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              BindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT BindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              FinalBindingConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT FinalBindingConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              PatternVariableConnector: Connector
                                (#
                                   onInit::< 
                                     (# node1,node2: ^node
                                     do
                                        <<SLOT PatternVariableConnectorOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              OTOAssociationRelation: Connector
                                (#
                                   onInit::< 
                                     (# 
                                     do
                                        <<SLOT OTOAssociationRelationOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              OTMAssociationRelation: Connector
                                (#
                                   onInit::< 
                                     (# 
                                     do
                                        <<SLOT OTMAssociationRelationOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              MTMAssociationRelation: Connector
                                (#
                                   onInit::< 
                                     (# 
                                     do
                                        <<SLOT MTMAssociationRelationOnInit:Descriptor>>;
                                        
                                     #)
                                #);
                              parseAfter:
                                (#
                                   theListDiagram: ^ListDiagram;
                                   parseText: ^text;
                                   theNonTerminalNode:
                                     ^theListDiagram.NonTerminalNode;
                                   anAST: ^mps.ast
                                enter (theListDiagram[],parseText[])
                                <<SLOT parseAfter:DoPart>>
                                #);
                              getStatus:
                                (# theObject: ^DesignObject; 
                                enter theObject[]
                                do <<SLOT GetStatusFromSif:Descriptor>>; 
                                #);
                              doExpand:
                                (#
                                   synCatNo:
                                     @Integer;
                                   normal: @Boolean;
                                   
                                enter (synCatNo,normal)
                                do <<SLOT DoExpand:Descriptor>>; 
                                #);
                              doExpandLexem:
                                (# name: @Text; 
                                enter name
                                do
                                   <<SLOT DoExpandLexem:Descriptor>>;
                                   
                                #);
                              MakeAPalette:
                                (# t: ^Text; 
                                enter t[]
                                do <<SLOT MakeAPalette:Descriptor>>; 
                                #);
                              changedFocus::< 
                                (#  do <<SLOT ChangedFocus:Descriptor>> #);
                              declarationTextChanged::< 
                                (# 
                                do <<SLOT declarationTextChanged:Descriptor>>
                                #);
                              openFormInSif::< 
                                (#  do <<SLOT openFormInSif:Descriptor>> #);
                              prefixExpand::< 
                                (#  do <<SLOT prefixExpand:Descriptor>> #);
                              copy::< 
                                (# 
                                do
                                   <<SLOT copy:Descriptor>>
                                #);
                              onFocusChange:<
                                (#
                                   node: ^mps.ast;
                                   length: @Integer;
                                   status: @Boolean;
                                   
                                enter (node[],length)
                                do <<SLOT onFocusChange:Descriptor>>
                                exit status
                                #);
                              MakeAnchors::< 
                                (# 
                                do INNER
                                #);
                              presentAnchor:<
                                (#
                                   theIndex:
                                     @Integer;
                                   
                                enter theIndex
                                do <<SLOT presentAnchor:Descriptor>>
                                #);
                              private:
                                @<<SLOT FrejaOADPagePrivate:Descriptor>>
                           #);
                         readOnlyModeOn: @boolean;
                         doOADPaste,doObjectPaste,pasteGroupWithOAD: @boolean;
                         setReadOnly::< 
                           (#  <<SLOT frejaSetReadOnly:DoPart>> #);
                         unsetReadOnly::< 
                           (# 
                           <<SLOT frejaUnsetReadOnly:DoPart>>
                           #);
                         selfAssociateWindow:
                          <<SLOT selfAssociateWindow:Descriptor>>;
                         layoutPreferencesDialog:
                           @<<SLOT layoutPreferencesDialog:Descriptor>>
                      #);
                    dexterOn::<  (#  do true->withDexter #);
                    callBack::< 
                      (#
                         ConnEndsGrammar::< 
                           (# 
                           do <<SLOT FrejaConnEndsGrammar:Descriptor>>; 
                           #);
                         KbdEvent::< 
                           (# 
                           do
                              <<SLOT FrejaKbdEvent:Descriptor>>;
                              
                           #);
                         MouseDown::< 
                           (#  do <<SLOT FrejaMouseDown:Descriptor>>;  #);
                         DoubleClick::< 
                           (# 
                           do
                              <<SLOT FrejaDoubleClick:Descriptor>>;
                              
                           #)
                      #);
                    
                 <<SLOT FrejaDesignInterfaceDoPart:DoPart>>
                 #);
               sifEditor::< 
                 (#
                    fe:
                      ^theFragmentBrowser.ymerBrowser.codeEditor;
                    undo::<  (#  <<SLOT SifEditorUndo:DoPart>> #);
                    cut::< 
                      (# 
                      <<SLOT sifEditorCut:DoPart>>
                      #);
                    copy::<  (#  <<SLOT sifEditorCopy:DoPart>> #);
                    paste::< 
                      (# 
                      <<SLOT sifEditorPaste:DoPart>>
                      #);
                    before::<  (#  <<SLOT sifEditorBefore:DoPart>> #);
                    after::<  (#  <<SLOT sifEditorAfter:DoPart>> #);
                    changeFocus::< 
                      (# 
                      <<SLOT sifEditorChangeFocus:DoPart>>
                      #);
                    getStatus::<  (#  <<SLOT sifEditorGetStatus:DoPart>> #);
                    expandNormal::< 
                      (#
                         theOADDocument: ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage
                      <<SLOT sifEditorExpandNormal:DoPart>>
                      #);
                    expandOptional::< 
                      (#
                         theOADDocument:
                           ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage
                      <<SLOT sifEditorExpandOptional:DoPart>>
                      #);
                    expandLexem::< 
                      (#
                         theOADDocument:
                           ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage
                      <<SLOT sifEditorExpandLexem:DoPart>>
                      #);
                    insertOptionals::< 
                      (# 
                      <<SLOT sifEditorInsertOptionals:DoPart>>
                      #);
                    removeOptionals::< 
                      (#  <<SLOT sifEditorRemoveOptionals:DoPart>> #);
                    parse::< 
                      (#
                         theOADDocument:
                           ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage;
                         theObject: ^theOADPage.PatternDiagramNode
                      <<SLOT sifEditorParse:DoPart>>
                      #);
                    search::< 
                      (# 
                      <<SLOT sifEditorSearch:DoPart>>
                      #);
                    isReadOnly::< 
                      (#  <<SLOT SifEditorIsReadOnly:DoPart>> #);
                    init::< 
                      (#  enter fe[] #)
                 #);
               
            do
               <<SLOT FrejaDoPart:Descriptor>>
            #);
          
       do theGraphicalInterface; 
       #);
     sdeControl:<
       (#
          globalSifCommands: @
            (#
               openForm:
                 (#
                    name: ^Text; node: ^theModel.theGraphicalInterface.mps.ast
                 enter (name[],node[])
                 <<SLOT globalSifCommandsOpenForm:DoPart>>
                 #);
               getEditorForForm:
                 (#
                    ff: ^theModel.theGraphicalInterface.mps.fragmentForm;
                    node: ^theModel.theGraphicalInterface.mps.ast;
                    se: ^theFragmentBrowser.ymerBrowser.codeEditor
                 enter (ff[],node[])
                 <<SLOT globalSifCommandsGetEditorForForm:DoPart>>
                 exit se[]
                 #);
               newBETAProgram:
                 (# name: ^Text
                 enter name[]
                 <<SLOT globalSifCommandsNewBETAProgram:DoPart>>
                 #);
               newBETALibrary:
                 (# name: ^Text
                 enter name[]
                 <<SLOT globalSifCommandsNewBETALibrary:DoPart>>
                 #);
               saveAndQuit:
                 (# filename: @text
                 <<SLOT globalSifCommandsSaveAndQuit:DoPart>>
                 #);
               save:
                 (#
                    filename: @text
                 <<SLOT globalSifCommandsSave:DoPart>>
                 #);
               autoSave:
                 (# filename: @text
                 <<SLOT globalSifCommandsAutoSave:DoPart>>
                 #);
               check:
                 (# fg: ^theModel.theGraphicalInterface.mps.fragmentGroup
                 enter fg[]
                 <<SLOT globalSifCommandsCheck:DoPart>>
                 #);
               toggleDebug:
                 (# 
                 <<SLOT globalSifCommandsToggleDedug:DoPart>>
                 #)
            #);
          
       #);
     theModel: @sdeModel;
     theController: @sdeControl;
     
  do theModel; 
  #)  

