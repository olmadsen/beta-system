<HTML>
<HEAD>
<TITLE>FAQ: Freja CASE Tool</TITLE>
</HEAD>

<BODY> 
<H1>Freja: Frequently Asked Questions (FAQ)</H1> 

<HR>
An online version of the Freja tutorial and reference manual can be found on
<LI><A HREF="http://www.daimi.aau.dk/~beta/Manuals/Freja.pdf"><TT>http://www.daimi.aau.dk/~beta/Manuals/Freja.pdf</TT></A>  (In PDF format)
<BR><BR>

When you start using a new tool, there is a tendency to pressure the
tool, by using untraditional command sequences resulting in the crash
of the tool. Of course this should not happen, a tool should be
waterproof. We therefore encourage users to mail errors or what seems
to be abnormal behaviour to <A
HREF="mailto:freja@mjolner.dk"><B>freja@mjolner.dk</B></A>. We also
welcome possible suggestions for changes of exsisting funtionality,
extra functionality etc.<BR></LI>


<HR>
<H2><A NAME="contents">Contents</A></H2>

<UL>
<LI><A HREF="#PartI">Part I: Frequently Asked Questions</A>

<UL>
<LI><A HREF="#Q01">Q01) What is Freja?</A>
<LI><A HREF="#Q02">Q02) What does the name Freja mean?</A>
<LI><A HREF="#Q03">Q03) What are the important files?</A>
<LI><A HREF="#Q04">Q04) How do I print a diagram?</A>
<LI><A HREF="#Q05">Q05) How do I make recovery?</A>
<LI><A HREF="#Q06">Q06) How do I revert changes to the diagram?</A>
<LI><A HREF="#Q07">Q07) Why do the files become inconsistent?</A>
<LI><A HREF="#Q08">Q08) How do I (re-)create a diagram through reverse engineering?</A>
<LI><A HREF="#Q09">Q09) Can I close a diagram?</A>
<LI><A HREF="#Q10">Q10) How do I move the files?</A>
<LI><A HREF="#Q11">Q11) How do I create a consistent backup of the diagram?</A>
<LI><A HREF="#Q12">Q12) Why do the dialogs take so long time opening?</A>
</UL>
<LI><A HREF="#PartII">Part II: Known bugs and errors</A>
<UL>
<LI><A HREF="#E01">E01) Pages should NOT be closed!</A>
<LI><A HREF="#E02">E02) Subdirectory as name of new program/library</A>
<LI><A HREF="#E03">E03) Lists of names in declarations</A>
<LI><A HREF="#E04">E04) Relations are redrawn after checking</A>
<LI><A HREF="#E05">E05) Setting current selection to an attributes SLOT</A>
<LI><A HREF="#E06">E06) Editing in Freja while Sif is in text edit mode</A>

</UL>
</UL>

<HR>
<H2><A NAME="PartI">PART I: Frequently Asked Questions</A></H2>


<HR>
<H3><A NAME="Q01">Q01) What is Freja?</A></H3>
Freja is an object-oriented CASE tool supporting system development
with BETA as the implementation language. Together with <A HREF =
"http://www.daimi.aau.dk/~beta/Manuals/Sif.pdf">Sif</A>, the Mjølner
Source Browser and Editor [MIA 91-11], Freja supports a smooth
transition from design diagrams to implementation code and vice
versa. The design notation is a graphical syntax for part of the <A
HREF = "http://www.daimi.aau.dk/~beta/info/">BETA
programming language</A>. The basic idea is to use the same abstract
language for design as well as implementation. A graphical syntax is
used for design descriptions and the usual textual syntax is used
for program code.

<HR>
<H3><A NAME="Q02">Q02) What does the name Freja mean?</A></H3>
Many have wondered about the origins of the strange product names used
for parts of the Mjølner BETA System. Due to the origin of the Mjølner
BETA System, many of the components of the system bear Nordic
names. These Nordic names originate from the Nordic Mythology, and are
thus names within the common cultural background of people in the
entire Nordic region.
Freja is the name of the goddess of love. She lives in Folkvang and is
the most beautiful of all women in Asgaard. She owns the golden piece
of jewelry Brisingemen.

<HR>
<H3><A NAME="Q03">Q03) What are the important files?</A></H3>
There are four important file types when working with Freja: .bet,
.ast, .diag and .freja files.
<P>
The .ast and the .bet files are well-known to BETA programmers. The
.ast file contains the AST and the .bet file is the textual version of
the AST. Sif automatically produces the .bet file from the .ast
file. The .diag file contains a representation of the diagrams
including layout information and references to the corresponding nodes
in the AST. This means that if the user wants to keep the layout of
the diagrams, the AST must only be modified through Freja (and/or Sif,
when Sif has been.started through Freja). The .freja file contains
information about what .ast files are used by the .diag file. It also
contains these .ast files' timestamps at the time when the diagram was
last saved.
<P>
When running Freja there will also exist versions of the .ast, .diag
and the .freja files with extensions "#" and "~". The "#" files are
autosave versions that are used when recovery is called for. Autosave
is performed each time the an AST altering operation is performed. The
"~" files are versions corresponding to how the diagram looked when an
explicit save was performed the last time. 
<P>

<DL>
<DT><STRONG>Notice:</STRONG>
<DD>
<UL>
<LI>Users are <I>not</I> encouraged to try to perform recovery by
moving the "#" files themselves! Freja takes care of this on restart
from an eventual crash; more on how to do this see <A HREF="#Q05">Q05)
How do I make recovery?</A>
<LI>Revert is currently not implemented in Freja. On how to do it
"manualy" see <A HREF="#Q06">Q06) How do I revert changes to the
diagram?</A>
</UL>
</DL>

<HR>
<H3><A NAME="Q04">Q04) How do I print a diagram?</A></H3>
Initiating the print command will bring up a dialog asking the user to
indicate which pages are to be printed. If all pages are to be printed
simply select the All field of the dialog. <BR>
Having selected the <B>ok</B> button of the dialog the following
string will appear in the xterm from which Freja was originally
started: "Enter name of PostScript file (without .ps): ". Simply do so
and both a PostScript and an Encapsulated PostScript version of the
print will be available in the directory where Freja was started.<BR>
To this purpose the Freja script sets the environment variable
<CODE>DesignPrintCommand</CODE> to <CODE>frejaprinter</CODE> if it
does not already have a value. Alternatively the
<CODE>DesignPrintCommand</CODE> can be used to specify that Freja is
to print directly on a given printer. This can e.g be done like this:
<P>
<CODE>>setenv DesignPrintCommand "lpr -Pr312"</CODE>
<P>
Where <CODE>lpr -Pr312</CODE> is the command for printing on a printer
called <CODE>r312</CODE>.
<P>
If you only wish to print one of the pages, first make sure that this
page has a page number larger than zero (page number can be changed
using the <B>Attributes...</B> entry of the <B>Page</B> menu). If the
page number is e.g 1 then choose to print the pages from 1 to 1 in the
print dialog.

<HR>
<H3><A NAME="Q05">Q05) How do I make recovery?</A></H3>
Freja performs an autosave each time an operation that alters the code
(i.e. the underlying AST) is invoked. To recover after the program has
crashed you can do one of the following:
<UL>
<LI>Start Freja giving it as parameter the diagram, that you were working
on when the crash occured. If e.g. you were working on foo.diag then
start Freja like this:
<P>
<CODE>>freja foo</CODE>
<P>
or like this
<P>
<CODE>>freja foo.diag</CODE>
<P>
<LI>Start Freja without parameters and use <B>Open...</B> in the
<B>File</B> menu to open the .diag file corresponding to the diagram
you were working on (e.g. foo.diag).
</UL>
In both cases Freja will automatically detect if valid autosave files
exist and offer to perform a recovery based on these.
<P>
If you had not explicitely given the diagram a name through an
explicit save before a crash occurred then start Freja giving it as
parameter the name (<I>without</I> .ast or .bet extension) of the
program or library that you had been working on. If you e.g. had been
working on a program by the name
<CODE>foo.bet</CODE>/<CODE>foo.ast</CODE>, then start Freja like this:
<P>
<CODE>>freja foo</CODE>
<P>
If you were working on several programs and/or libraries in the same
diagram the default name to use is the name of the program or library
that was opened first.
<P>
Explanation of the different file types used in Freja, see
<A HREF="#Q03">Q03) What are the important files?</A>

<HR>
<H3><A NAME="Q06">Q06) How do I revert changes to the diagram?</A></H3>
Revert is currently not implemented in Freja, so if you wish to revert
to the situation at the time of the last save it neccesary to
manipulte the files yourself. To do this simply move .ast~ file(s)
into the corresponding .ast file(s), move the .diag~ file into the
corresponding .diag file and move the .freja~ file into the
corresponding .freja file.
<P>

<DL>
<DT><STRONG>Notice:</STRONG>
<DD>If the diagram you wish to revert uses more than one .ast file, you
<I>must</I> move all the involved .ast~ files as explained above! If
you are not sure which files were used in the diagram, you can get
a list of these by inspecting the .freja file.
</DL>
<P>
Explanation of the different file types used in Freja, see
<A HREF="#Q03">Q03) What are the important files?</A>

<HR>
<H3><A NAME="Q07">Q07) Why do the files become inconsistent?</A></H3>
As mentioned in <A HREF="#Q03">Q03) What are the important files?</A>
the .freja file contains a list of the .ast files that are used by the
diagram. Furthermore it contains the timestamps of the .ast files at
the time when the diagram was last saved. When Freja is asked to load
a diagram it uses the .freja file to check if:
<P>
<OL>
<LI> All .ast files used by the diagram still exists on locations
registered at time of the last save.
<LI> The timestamps of the .ast files concur with the timestamps
registered in the .freja file.
</OL>
The purpose of this is to secure that other tools haven't changed the
.ast files independently of Freja. This must be prevented because the
internal representation of the diagram refers to certain subtrees in
the Abstract Syntax Trees (AST's) - stored in the .ast files -  and if
theese are changed or deleted independently of Freja the references
stored in the diagram file become invalid. <STRONG>So:</STRONG> If you
want to be able to (re-)load your diagram (i.e. preserve the graphical
layout), make sure that the .ast/.bet files are not touched by any
tools indpendently of Freja. If this by accident happens anyway Freja
will, instead of loading the diagram, popup a dialog with a message on
the following form:
<P>
<PRE>
Consistency check failed!
foo.ast
is inconsistent with
foo.diag
Open .ast or .bet file instead?
</PRE>
<P>
If you ok this <I>none</I> of the code generated up until now will be
lost, and you can recreate the diagram using Freja's reverse
engineering facilities (see <A HREF="#Q08">Q08) How do I (re-)create a
diagram through reverse engineering?</A>).
<P>
If you are <STRONG>absolutely</STRONG> sure that the files have not
been touched by any tools since the last save, you can yourself alter
the timestamp registered in the .freja file. A situation like this
could e.g. occur if:
<P>
<UL>
<LI>The files have been copied without preserving the timestamp (more
on preserving timestamps in <A HREF="#Q10">Q10) How do I create a
consistent backup of the diagram?</A>).
<LI>A part of the program, that includes the code of the diagram, has
been checked (by the semantic checker) <I>and</I> the code had not
already been checked inside Freja.
</UL>
When the above mentioned dialog pops up, a message like the following
will be written on the console:
<P>
<PRE>
Consistency check failed!
/a/home/fraxinus4/toby/beta/freja/v2.1.2/test/foo.ast
is inconsistent with
foo.diag

modtime of .ast file: 826027997
expected modtime: 826027471
</PRE>
<P>
<TT>Modtime of .ast file</TT> is the (inconsistent) timestamp of the
.ast file and <TT>expected modtime</TT> is the timestamp registered in
the .freja file. If you - as mentioned above - are
<STRONG>sure</STRONG> that no tool has altered the .ast file, then you
can do the following to force Freja to load the diagram:
<P>
<OL>
<LI>Answer <B>Cancel</B> to the dialog.
<LI>Quit Freja.
<LI>Load the .freja file into a texteditor (e.g. emacs).
<LI>Alter the number, that corresponds to <TT>Modtime of .ast
file</TT>, to the number corresponding to <TT>expected modtime</TT>.
<LI>Save these changes and start Freja again on the diagram.
</OL>

<HR>
<H3><A NAME="Q08">Q08) How do I (re-)create a diagram through reverse engineering?</A></H3>
If no diagram is available for a piece of BETA code you can create a
diagram using Freja's reverse engineering facilities. To do this open
Freja on the .ast or .bet file containing the code. If only a .bet
file is available Freja will automatically parse it and create the
.ast file. Having opened Freja on the code, a one of two will appear:
<P>
<OL>
<LI>If the opened file only contains one fragmentform, the Work Sheet
will appear, showing a diagram containing the attributes visible in
the outermost descriptor of the code.
<LI> If the opened file contains more than one fragmentform, the Group
Page will appear, showing a diagram with entries for each fragmentform
in the file.
</OL>
In the first case the detailable attributes can be detailed to the
wished level. If relations like e.g. inheritance connectors and
references do not appear automatically during detail, it means that
the program (the .ast) has not been checked. To do this, select the
<B>Check</B> entry in Freja's <B>Edit</B> menu (No nonterminals must be
present in the code for the checker to be able to semantically check
it). If no semantic errors are detected during checking, all relations
will then automatically appear when checking is finished.
<P>
In the second of the above cases, you simply detail one or more of the
fragmentform entries on the Group Page (e.g. by doubleclicking them)
and then proceed as described for the first case.

<HR>
<H3><A NAME="Q09">Q09) Can I close a diagram?</A></H3>
No, in the current version of Freja closing of diagrams is not
implemented. Several .bet/.ast files can be loaded into the same
diagram though. If you wish to load another diagram however, you are
forced to quit the application and start it up again on this other
diagram.
<P>
In future versions of Freja closing diagrams will be implemented.

<HR>
<H3><A NAME="Q10">Q10) How do I move the files?</A></H3>
In the current version of Freja it is not possible to move the files
to another location on disk, if you wish to preserve the layout of the
diagram. I.e. the .diag files can not be moved and reloaded into Freja
from another location. The .ast/.bet files can be moved,
<STRONG>but</STRONG> if a .diag file refers to these files <I>moving
them should be avoived</I>, as this would result in the diagram
becoming inconsistent (see <A HREF="#Q07">Q07)Why do the files become
inconsistent?</A>).
<P>
In future versions of Freja moving the files will be possible.

<HR>
<H3><A NAME="Q11">Q11) How do I create a consistent backup of the diagram?</A></H3>
When you make a backup of your diagram files, you should always use
the <TT>-p</TT> option for cp.<BR><BR>
Example:
<P>
<PRE>
> mkdir Backup
> cp -p ../*.bet ../*.ast Backup/
</PRE>
If the diagram is called <TT>model</TT> also copy the following files:
<P>
<PRE>
> cp -p ../model.freja ../model.diag Backup/
</PRE>
<P>
When restoring the backup (copying back all the files to their
original position) use the <TT>-p</TT> option again.

<DL>
<DT><STRONG>Notice:</STRONG>
<DD>You should be careful, because the <TT>-p</TT> option does
<STRONG>not</STRONG> work if the files that you copy already exist in
the directory into which you copy them.
</DL>


<HR>
<H3><A NAME="Q12">Q12) Why do the dialogs take so long time opening?</A></H3>
Some of the dialogs take very long time before displaying the message
they are supposed to display. Other dialogs open quite normally. The
technical reason for this is that dialogs from to different libraries
are used. We are currently working on converting to only using the
quicker type of dialogs - until then: Please have patience with the
slow dialogs :-)

<HR>
<H2><A NAME="PartII">PART II: Known bugs and errors</A></H2>


<HR>
<H3><A NAME="E01">E01) Pages should NOT be closed!</A></H3>
In the current version of Freja separate closing of pages is not
implemented. Do <STRONG>not</STRONG> attempt to close any of the Freja
windows using windowmaneger routines! This will cause Freja to either
crash immediately or enter an unstable state that eventually will
cause the program to crash.

<HR>
<H3><A NAME="E02">E02) Subdirectory as name of new program/library</A></H3>
Using the name of an existing subdirectory as input for <B>New
Program</B> or <B>New Library</B> will cause the program to crash.

<HR>
<H3><A NAME="E03">E03) Lists of names in declarations</A></H3>
Declarations containing lists names, like e.g:
<P>
<CODE>
a,b,c: @Integer
</CODE>
<P>
(as opposed to: <CODE>a: @Integer; b: @Integer; c: @Integer</CODE>)
<BR>
will currently not be handled well by Freja and may cause serious
instability of the program. Therefore <I>avoid</I> these in the code
you wish to display in Freja diagrams.

<HR>
<H3><A NAME="E04">E04) Relations are redrawn after checking</A></H3>
Non-visible relations are shown when checking finishes succesfully,
but also some of the already visible valid relations will be deleted
and redrawn. This should not happen as it may unnecessarily alter the
users layout of these relations.

<HR>
<H3><A NAME="E05">E05) Setting current selection to an attributes SLOT</A></H3>
If an attributes SLOT is selected in Sif (running together with
Freja), Freja will crash.

<HR>
<H3><A NAME="E06">E06) Editing in Freja while Sif is in text edit mode</A></H3>
Sif should not be left in text edit mode, if you wish to use Freja's
editing commands. If you have been text editing in Sif (as opposed to
structure editing) always exit from text edit mode before continuing
in Freja.
