(* OBJFILE default '~beta/designOA/v1.0/$/getarg.o';*)
ORIGIN '~beta/basiclib/basicsystemenv';
INCLUDE 'frejaenv'
        '~beta/editor/ymersiflib'
        '~beta/editor/frejasifcomm'
        '~beta/editor/sifnotifications';
BODY 'private/externalinterfacebody'
     '~beta/editor/private/compiler'
     '~beta/editor/private/nouser';
(* '~beta/guienv/v1.6/utils/designsupport' *)
(* '~beta/Xt/v1.10/xlib' *)
(* 'private/frejaxtbody' *)
-- systemlib: Attributes --
freja: frejaenv
  (#
     frejaShowClassDiag::< 
       (# 
       do theFragmentBrowser.ymerBrowser.externalInterface.showDiagram
       #);
     visibleInFreja:
       (# node: ^astInterface.ast; value: @boolean; 
       enter node[]
       do <<SLOT SifEditorVisibleInFreja:Descriptor>>
       exit value
       #);
     SifInterface:<
      frejaExternalInterface
       (#
          ignoreGroupSaved: @boolean;
          newFragment::< 
            (#
               se: ^theFragmentBrowser.ymerBrowser.codeEditor;
               aSifEditor: ^theModel.theGraphicalInterface.sifEditor;
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theDoc.OADPage
            <<SLOT theExternalInterfaceNewFragment:DoPart>>
            #);
          openForm::< 
            (#
               se:
                 ^theFragmentBrowser.ymerBrowser.codeEditor;
               aSifEditor: ^theModel.theGraphicalInterface.sifEditor;
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument;
               theOADPage: ^theDoc.OADPage;
               alreadyOpenInFreja: @boolean
            <<SLOT theExternalInterfaceOpenForm:DoPart>>
            #);
          groupChecked::< 
            (#
               theOADDoc:
                 ^theModel.
                    theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceGroupChecked:DoPart>>
            #);
          groupSaved::< 
            (#
               theOADDoc:
                 ^theModel.
                    theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceGroupSaved:DoPart>>
            #);
          groupAutoSaved::< 
            (#
               theOADDoc:
                 ^theModel.
                    theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceGroupAutoSaved:DoPart>>
            #);
          propertiesChanged::<
           
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfacePropertiesChanged:DoPart>>
            #);
          fragmentChanged::< 
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceFragmentChanged:DoPart>>
            #);
          fragmentInserted::<
           
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceFragmentInserted:DoPart>>
            #);
          fragmentDeleted::<
           
            (#
               theDoc:
                 ^theModel.theGraphicalInterface.theDesignInterface.OADDocument
            <<SLOT theExternalInterfaceFragmentDeleted:DoPart>>
            #);
          askBeforeTextEditing::< 
            (#  <<SLOT theExternalInterfaceAskBeforeTextEditing:DoPart>> #)
       #);
     theExternalInterface: @SifInterface;
     sdeModel::< 
       (#
          GraphicalInterface::< 
            (#
               ignoreGroupSavedFromSif::<
                 (#  do value->theExternalInterface.ignoreGroupSaved #);
               sifEditor::< 
                 (#
                    fe: ^theFragmentBrowser.ymerBrowser.codeEditor;
                    assertFEexists:
                      (# doesNotExist:< (#  do INNER doesNotExist #)
                      do
                         (if fe[] <> none then
                             INNER assertFEexists
                          else
                             doesNotExist
                         if)
                      #);
                    ffObserverType:< fe.frag.sifFragmentFormObserver
                      (#
                         ignoreEvents: @boolean;
                         ignore::<  (#  do ignoreEvents->value #);
                         onFocusChanged::< 
                           (# 
                           <<SLOT theExternalInterfaceFocusChanged:DoPart>>
                           #);
                         onAstReplaced::< 
                           (# 
                           <<SLOT theExternalInterfaceAstReplaced:DoPart>>
                           #);
                         onAstReplacedSequence::< 
                           (# 
                           <<SLOT theExternalInterfaceAstReplacedSequence:DoPart>>
                           #);
                         onListElementInserted::< 
                           (# 
                           <<SLOT theExternalInterfaceListElementInserted:DoPart>>
                           #);
                         onListElementsDeleted::< 
                           (# 
                           <<SLOT theExternalInterfaceListElementsDeleted:DoPart>>
                           #);
                         onListElementsReplaced::< 
                           (# 
                           <<SLOT theExternalInterfaceListElementsReplaced:DoPart>>
                           #)
                      #);
                    ffObserver: ^ffObserverType;
                    undo::<  (#  <<SLOT SifEditorUndo:DoPart>> #);
                    redo::< 
                      (# 
                      <<SLOT sifEditorRedo:DoPart>>
                      #);
                    cut::<  (#  <<SLOT sifEditorCut:DoPart>> #);
                    copy::< 
                      (# 
                      <<SLOT sifEditorCopy:DoPart>>
                      #);
                    paste::<  (#  <<SLOT sifEditorPaste:DoPart>> #);
                    clear::< 
                      (# 
                      <<SLOT sifEditorClear:DoPart>>
                      #);
                    before::<  (#  <<SLOT sifEditorBefore:DoPart>> #);
                    after::<  (#  <<SLOT sifEditorAfter:DoPart>> #);
                    changeFocus::< 
                      (# 
                      <<SLOT sifEditorChangeFocus:DoPart>>
                      #);
                    getStatus::<  (#  <<SLOT sifEditorGetStatus:DoPart>> #);
                    expandNormal::< 
                      (#
                         theOADDocument: ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage
                      <<SLOT sifEditorExpandNormal:DoPart>>
                      #);
                    expandOptional::< 
                      (#
                         theOADDocument:
                           ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage
                      <<SLOT sifEditorExpandOptional:DoPart>>
                      #);
                    expandLexem::< 
                      (#
                         theOADDocument:
                           ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage
                      <<SLOT sifEditorExpandLexem:DoPart>>
                      #);
                    insertOptionals::< 
                      (# 
                      <<SLOT sifEditorInsertOptionals:DoPart>>
                      #);
                    removeOptionals::< 
                      (#  <<SLOT sifEditorRemoveOptionals:DoPart>> #);
                    parse::< 
                      (#
                         theOADDocument:
                           ^theDesignInterface.OADDocument;
                         theOADPage: ^theOADDocument.OADPage;
                         theObject: ^theOADPage.PatternDiagramNode
                      <<SLOT sifEditorParse:DoPart>>
                      #);
                    search::< 
                      (# 
                      <<SLOT sifEditorSearch:DoPart>>
                      #);
                    isReadOnly::< 
                      (#  <<SLOT SifEditorIsReadOnly:DoPart>> #);
                    openSubEditor::< 
                      (# 
                      <<SLOT sifEditorOpenSubEditor:DoPart>>
                      #);
                    fragmentTouched::< 
                      (#  <<SLOT sifEditorFragmentTouched:DoPart>> #);
                    init::< 
                      (# 
                      enter fe[]
                      do
                         &
                            ffObserverType[]->ffObserver[]
                           ->fe.frag.attachObserver
                      #)
                 #);
               DesignInterface::< 
                 (#
                    OADDocument::< 
                      (#
                         onKeyDown::< 
                           (# 
                           do
                              theFragmentBrowser.isActive
                                ->fragmentBrowserIsActive
                           #)
                      #);
                    onInit::< 
                      (#  <<SLOT frejalibDesignInterfaceOnInit:DoPart>> #)
                 #)
            #)
       do INNER sdeModel
       #);
     sdeControl::< 
       (#
          globalSifCommandsDesc::<
           
            (#
               openForm::<  (#  <<SLOT globalSifCommandsOpenForm:DoPart>> #);
               getEditorForForm:
                 (#
                    ff: ^theModel.theGraphicalInterface.mps.fragmentForm;
                    node: ^theModel.theGraphicalInterface.mps.ast;
                    se: ^theFragmentBrowser.ymerBrowser.codeEditor
                 enter (ff[],node[])
                 <<SLOT globalSifCommandsGetEditorForForm:DoPart>>
                 exit se[]
                 #);
               newBETAProgram::< 
                 (#  <<SLOT globalSifCommandsNewBETAProgram:DoPart>> #);
               newBETALibrary::<
                 (#  <<SLOT globalSifCommandsNewBETALibrary:DoPart>> #);
               toggleDebug::< 
                 (# 
                 <<SLOT globalSifCommandsToggleDedug:DoPart>>
                 #);
               saveAndQuit::< 
                 (# filename: @text
                 <<SLOT globalSifCommandsSaveAndQuit:DoPart>>
                 #);
               save::< 
                 (#
                    filename: @text
                 <<SLOT globalSifCommandsSave:DoPart>>
                 #);
               autoSave::< 
                 (# filename: @text
                 <<SLOT globalSifCommandsAutoSave:DoPart>>
                 #);
               checkAutoSaveFile::< 
                 (#  <<SLOT globalSifCommandsCheckAutoSaveFile:DoPart>> #);
               check::< 
                 (# 
                 <<SLOT globalSifCommandsCheck:DoPart>>
                 #);
               addProp::<  (#  <<SLOT globalSifCommandsAddProp:DoPart>> #);
               deleteProp::< 
                 (# 
                 <<SLOT globalSifCommandsDeleteProp:DoPart>>
                 #);
               setFrejaMark::< 
                 (#  <<SLOT globalSifCommandsSetFrejaMark:DoPart>> #);
               getFrejaMark::< 
                 (# 
                 <<SLOT globalSifCommandsGetFrejaMark:DoPart>>
                 #)
            #)
       #);
     sifHidden: @boolean;
     theFragmentBrowser: ^FragmentBrowser;
     (* to allow Sif and bifrost design to share the same guienv,
      * theFragmentBrowser needs to be run instead of theModel.
      * theFragmentBrowser should instead call theModel.
      * Also note that theFragmentBrowser will never return, as it
      * is a specialisation of guienv.
      *)
     
  enter theModel.theGraphicalInterface.isStandAloneFreja
  do <<SLOT frejalibdopart:Descriptor>>; Inner; (* theFragmentBrowser *)
  #)  

