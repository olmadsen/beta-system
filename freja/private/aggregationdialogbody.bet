ORIGIN 'dialogbody';
-- openAggregationDialog: DoPart --
do
     (# theDialog: ^AggregationDialog
     do
        &AggregationDialog[]->theDialog[];
        (theAggregationConnector[],theName[],kind,implementation,leftMulFrom,
         leftMulTo,rightMulFrom,rightMulTo,description[])->theDialog.open;
        
     #)  

-- aggregationDialog: Descriptor --
private.UI.window
  (#
     resizeable::  (#  do false->value #);
     mainCanvas: @canvas
       (#
          Name: @staticText
            (#
               open::< 
                 (#  do (10,15)->position; (60,16)->size; 'Name:'->label #)
            #);
          NameEdit: @textField
            (#
               isOpen: @Boolean;
               eventHandler:: 
                 (#
                    onBeforeChange:: 
                      (# t: ^text; ch: @char
                      do
                         (if isOpen then
                             theText->t[];
                             (if t[] <> none then
                                 (if t.length = 1 then
                                     t.reset;
                                     (if position = 0 then
                                         (if not (t.get->ch->ascii.isLetter)
                                          then
                                             false->allow;
                                             theDesignInterface.private.UI.beep
                                         if)
                                      else
                                         (if not
                                         ((t.get->ch->ascii.isDigit) or
                                          (ch->ascii.isLetter)) then
                                             false->allow;
                                             theDesignInterface.private.UI.beep
                                         if)
                                     if)
                                  else
                                     false->allow;
                                     theDesignInterface.private.UI.beep
                                 if)
                             if)
                         if)
                      #);
                    onTextChanged:: 
                      (#  do (if isOpen then true->codeChanged if) #)
                 #);
               open::< 
                 (# 
                 do
                    (if theName[] <> none then theName[]->insert if);
                    (10,35)->position;
                    (378,30)->size;
                    true->isOpen
                 #)
            #);
          RoleCanvas: Canvas
            (#
               multiplicity: @staticText
                 (#
                    open::< 
                      (# 
                      do
                         (5,18)->position; (82,16)->size; 'Multiplicity:'->label
                      #)
                 #);
               toLabel: @staticText
                 (#
                    open::< 
                      (# 
                      do (124,19)->position; (16,16)->size; 'to'->label
                      #)
                 #);
               FromField:< textField
                 (#
                    isOpen: @boolean;
                    eventHandler::< 
                      (#
                         onTextChanged::< 
                           (# 
                           do
                              (if isOpen then
                                  true->codeChanged; INNER onTextChanged
                              if)
                           #);
                         onBeforeChange::< 
                           (# 
                           do (if isOpen then INNER onBeforeChange if)
                           #)
                      #);
                    open::< 
                      (# 
                      do
                         (92,12)->position;
                         (30,30)->size;
                         (if theAggregationConn[] = none then
                             '1'->insert
                         if);
                         INNER open;
                         true->isOpen
                      #)
                 #);
               from: @FromField;
               ToField:< textField
                 (#
                    isOpen: @boolean;
                    eventHandler::< 
                      (#
                         onTextChanged::< 
                           (# 
                           do
                              (if isOpen then
                                  true->codeChanged; INNER onTextChanged
                              if)
                           #);
                         onBeforeChange::< 
                           (# 
                           do (if isOpen then INNER onBeforeChange if)
                           #)
                      #);
                    open::< 
                      (# 
                      do
                         (142,12)->position;
                         (30,30)->size;
                         (if theAggregationConn[] = none then
                             '1'->insert
                         if);
                         INNER open;
                         true->isOpen
                      #)
                 #);
               to: @ToField;
               open::< 
                 (# 
                 do
                    true->border.visible;
                    theDesignInterface.private.UI.borderStyles.etchedIn
                      ->border.style;
                    multiplicity.open;
                    toLabel.open;
                    from.open;
                    to.open;
                    (184,55)->size;
                    INNER open
                 #)
            #);
          leftCanvasLabel: @staticText
            (#
               open::< 
                 (#  do (15,75)->position; (34,16)->size; 'Whole'->label #)
            #);
          leftCanvas: @RoleCanvas
            (#
               FromField:: 
                 (#
                    eventHandler:: 
                      (#
                         onBeforeChange:: 
                           (# t: ^text; ch: @char
                           do
                              theText->t[];
                              (if t[] <> none then
                                  (if t.length = 1 then
                                      (if
                                      (selection.contents->(contents).equal) or
                                      ((contents).length = 0) then
                                          t.reset;
                                          t.get->ch;
                                          (if (ch = '0') or (ch = '1') then
                                              
                                           else
                                              false->allow;
                                              theDesignInterface.private.UI.beep
                                          if)
                                       else
                                          false->allow;
                                          theDesignInterface.private.UI.beep
                                      if)
                                   else
                                      false->allow;
                                      theDesignInterface.private.UI.beep
                                  if)
                              if)
                           #)
                      #);
                    open:: 
                      (# t: @text
                      do
                         (if theAggregationConn[] <> none then
                             (if wholeMulFrom >= 0 then
                                 wholeMulFrom->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               ToField:: 
                 (#
                    open:: 
                      (# t: @text
                      do
                         (if theAggregationConn[] <> none then
                             (if wholeMulTo >= 0 then
                                 wholeMulTo->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               open::  (#  do to.disable; (10,83)->position;  #)
            #);
          rightCanvasLabel: @staticText
            (#
               open::< 
                 (#  do (209,75)->position; (28,16)->size; 'Part'->label #)
            #);
          rightCanvas: @RoleCanvas
            (#
               FromField:: 
                 (#
                    eventHandler:: 
                      (#
                         onBeforeChange:: 
                           (# t: ^text; ch: @char
                           do
                              theText->t[];
                              (if t[] <> none then
                                  (if t.length = 1 then
                                      t.reset;
                                      (if t.get->ch->ascii.isDigit then
                                          (if '*'->(contents).equal then
                                              (if
                                              selection.contents
                                                ->(contents).equal then
                                                  to.all->selection;
                                                  to.delete;
                                                  '*'->to.insert
                                               else
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                           else
                                              (if '0' = ch then
                                                  (if position = 0 then
                                                      (if
                                                      ((contents).length = 0)
                                                       then
                                                          
                                                       else
                                                          false->allow;
                                                          theDesignInterface.
                                                            private.UI.beep
                                                      if)
                                                  if)
                                              if)
                                          if)
                                       else
                                          (if ch = '*' then
                                              (if ((contents).length = 0) or
                                              (selection.contents
                                                 ->(contents).equal) then
                                                  to.all->to.selection;
                                                  to.delete;
                                                  '*'->to.insert
                                               else
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                           else
                                              false->allow;
                                              theDesignInterface.private.UI.beep
                                          if)
                                      if)
                                   else
                                      false->allow;
                                      theDesignInterface.private.UI.beep
                                  if)
                              if)
                           #)
                      #);
                    open:: 
                      (# t: @text
                      do
                         (if theAggregationConn[] <> none then
                             (if partMulFrom >= 0 then
                                 partMulFrom->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               ToField:: 
                 (#
                    eventhandler::< 
                      (#
                         onTextChanged:: 
                           (# t: ^text; m: @integer
                           do
                              contents->t[];
                              (if t[] <> none then
                                  (if t.length > 0 then
                                      (if '*'->t.equal then
                                          (if allImplFalse then
                                              (if not
                                              implementationCanvas.
                                                containmentCanvas.byValue.state
                                               then
                                                  true
                                                    ->
                                                      implementationCanvas.Set.
                                                        state;
                                                  gppProp.Set->impl
                                               else
                                                  true
                                                    ->
                                                      implementationCanvas.
                                                        Repetition.state;
                                                  gppProp.Repetition->impl
                                              if)
                                          if)
                                       else
                                          t.reset;
                                          t.getint->m;
                                          (if m > 1 then
                                              (if allImplFalse then
                                                  (if not
                                                  implementationCanvas.
                                                    containmentCanvas.byValue.
                                                    state then
                                                      true
                                                        ->
                                                          implementationCanvas.
                                                            Set.state;
                                                      gppProp.Set->impl
                                                   else
                                                      true
                                                        ->
                                                          implementationCanvas.
                                                            Repetition.state;
                                                      gppProp.Repetition->impl
                                                  if)
                                              if)
                                          if)
                                      if)
                                  if)
                              if)
                           #);
                         onBeforeChange:: 
                           (# t: ^text; ch: @char
                           do
                              theText->t[];
                              (if t[] <> none then
                                  (if t.length = 1 then
                                      t.reset;
                                      (if t.get->ch->ascii.isDigit then
                                          (if '*'->(contents).equal then
                                              (if
                                              selection.contents
                                                ->(contents).equal then
                                                  
                                               else
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                           else
                                              (if '0' = ch then
                                                  (if position = 0 then
                                                      (if
                                                      ((contents).length = 0)
                                                       then
                                                          
                                                       else
                                                          false->allow;
                                                          theDesignInterface.
                                                            private.UI.beep
                                                      if)
                                                  if)
                                              if)
                                          if)
                                       else
                                          (if ch = '*' then
                                              (if ((contents).length = 0) or
                                              (selection.contents
                                                 ->(contents).equal) then
                                                  
                                               else
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                           else
                                              false->allow;
                                              theDesignInterface.private.UI.beep
                                          if)
                                      if)
                                   else
                                      false->allow;
                                      theDesignInterface.private.UI.beep
                                  if)
                              if)
                           #)
                      #);
                    open:: 
                      (# t: @text
                      do
                         (if theAggregationConn[] <> none then
                             (if partMulTo >= 0 then
                                 partMulTo->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               open::  (#  do (204,83)->position #)
            #);
          Description: @staticText
            (#
               open::< 
                 (# 
                 do (10,160)->position; (76,16)->size; 'Description:'->label
                 #)
            #);
          DescriptionEdit: @textEditor
            (#
               open::< 
                 (# 
                 do
                    (10,180)->position;
                    (378,99)->size;
                    theDesignInterface.private.UI.borderStyles.ShadowIn
                      ->border.style;
                    (if desc[] <> none then desc[]->contents.insert if)
                 #)
            #);
          setNoImplMul:
            (# 
            do
               rightCanvas.to.all->rightCanvas.to.selection;
               rightCanvas.to.delete;
               '1'->rightCanvas.to.insert;
               rightCanvas.from.all->rightCanvas.from.selection;
               rightCanvas.from.delete;
               '0'->rightCanvas.from.insert
            #);
          setAllImplFalse:
            (# 
            do
               (if not allImplFalse then
                   false->implementationCanvas.Repetition.state
                     ->implementationCanvas.ArrayContainer.state
                     ->implementationCanvas.HashTable.state
                     ->implementationCanvas.ExtensibleHashTable.state
                     ->implementationCanvas.List.state
                     ->implementationCanvas.Set.state
                     ->implementationCanvas.MultiSet.state
                     ->implementationCanvas.Stack.state
                     ->implementationCanvas.Queue.state
                     ->implementationCanvas.PriorityQueue.state
               if)
            #);
          allImplFalse:
            (# value: @Boolean
            do
               not
               (implementationCanvas.Repetition.state or
                implementationCanvas.ArrayContainer.state or
                implementationCanvas.HashTable.state or
                implementationCanvas.ExtensibleHashTable.state or
                implementationCanvas.List.state or
                implementationCanvas.Set.state or
                implementationCanvas.MultiSet.state or
                implementationCanvas.Stack.state or
                implementationCanvas.Queue.state or
                implementationCanvas.PriorityQueue.state)->value
            exit value
            #);
          open::< 
            (# 
            do
               true->border.visible;
               theDesignInterface.private.UI.borderStyles.etchedOut
                 ->border.style;
               Name.open;
               NameEdit.open;
               leftCanvas.open;
               leftCanvasLabel.open;
               rightCanvas.open;
               rightCanvasLabel.open;
               (* Description.open;
                DescriptionEdit.open;
                DescriptionEdit.disable; *)
               (6,10)->position;
               (400,299)->size;
               NameEdit[]->target
            #)
       #);
     ImplementationCanvas: @Canvas
       (#
          Repetition: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.rightCanvas.to.all
                               ->mainCanvas.rightCanvas.to.selection;
                             mainCanvas.rightCanvas.to.delete;
                             '1'->mainCanvas.rightCanvas.to.insert;
                             (if containmentCanvas.byValue.state then
                                 mainCanvas.rightCanvas.from.all
                                   ->mainCanvas.rightCanvas.from.selection;
                                 mainCanvas.rightCanvas.from.delete;
                                 '1'->mainCanvas.rightCanvas.from.insert
                              else
                                 mainCanvas.rightCanvas.from.all
                                   ->mainCanvas.rightCanvas.from.selection;
                                 mainCanvas.rightCanvas.from.delete;
                                 '0'->mainCanvas.rightCanvas.from.insert
                             if)
                          else
                             gppProp.repetition->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,16)->position; (81,16)->size; 'Repetition'->label
                 #)
            #);
          ArrayContainer: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.arrayContainer->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,37)->position; (111,16)->size; 'Array Container'->label
                 #)
            #);
          HashTable: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.hashTable->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,58)->position; (81,15)->size; 'Hash Table'->label
                 #)
            #);
          ExtensibleHashTable: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.ExtensibleHashTable->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do
                    (8,79)->position;
                    (147,16)->size;
                    'Extensible Hash Table'->label
                 #)
            #);
          List: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.List->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,100)->position; (45,16)->size; 'List'->label #)
            #);
          Set: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.Set->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,121)->position; (39,16)->size; 'Set'->label #)
            #);
          MultiSet: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.MultiSet->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,142)->position; (75,16)->size; 'Multi Set'->label
                 #)
            #);
          Stack: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.Stack->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,163)->position; (51,16)->size; 'Stack'->label #)
            #);
          Queue: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.Queue->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,184)->position; (51,16)->size; 'Queue'->label #)
            #);
          PriorityQueue: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.PriorityQueue->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,205)->position; (105,16)->size; 'Priority Queue'->label
                 #)
            #);
          open:: 
            (# 
            do
               true->border.visible;
               3->border.style;
               Repetition.open;
               ArrayContainer.open;
               HashTable.open;
               ExtensibleHashTable.open;
               List.open;
               Set.open;
               MultiSet.open;
               Stack.open;
               Queue.open;
               PriorityQueue.open;
               (10,151)->position;
               (400,299)->size;
               containmentCanvas.open;
               containmentCanvasLabel.open;
               checkConstraints.open;
               separator1.open;
               checkConstraints.disable;
               (if impl <> gppProp.noImplementation then
                   (if impl
                    // gppProp.repetition then
                       true->repetition.state
                    // gppProp.arrayContainer then
                       true->arrayContainer.state
                    // gppProp.hashTable then
                       true->HashTable.state
                    // gppProp.extensibleHashTable then
                       true->ExtensibleHashTable.state
                    // gppProp.list then
                       true->List.state
                    // gppProp.set then
                       true->Set.state
                    // gppProp.multiSet then
                       true->MultiSet.state
                    // gppProp.stack then
                       true->Stack.state
                    // gppProp.queue then
                       true->Queue.state
                    // gppProp.priorityQueue then
                       true->PriorityQueue.state
                   if)
               if)
            #);
          containmentCanvasLabel: @staticText
            (#
               open:: 
                 (# 
                 do (189,13)->position; (70,16)->size; 'Containment'->label
                 #)
            #);
          containmentCanvas: @Canvas
            (#
               open:: 
                 (# 
                 do
                    true->border.visible;
                    3->border.style;
                    byValue.open;
                    byReference.open;
                    (if kind
                     // gppProp.byReference then
                        true->byReference.state
                     // gppProp.byValue then
                        true->byValue.state;
                        mainCanvas.leftCanvas.from.disable;
                        implementationCanvas.ArrayContainer.disable;
                        implementationCanvas.HashTable.disable;
                        implementationCanvas.ExtensibleHashTable.disable;
                        implementationCanvas.List.disable;
                        implementationCanvas.Set.disable;
                        implementationCanvas.MultiSet.disable;
                        implementationCanvas.Stack.disable;
                        implementationCanvas.Queue.disable;
                        implementationCanvas.PriorityQueue.disable
                     else
                        true->byReference.state
                    if);
                    (184,21)->position;
                    (184,62)->size
                 #);
               byValue: @checkbox
                 (#
                    eventhandler::< 
                      (#
                         onMouseUp::< 
                           (# 
                           do
                              (if state then
                                  gppProp.byReference->kind;
                                  true->byReference.state;
                                  mainCanvas.leftCanvas.from.enable;
                                  implementationCanvas.ArrayContainer.enable;
                                  implementationCanvas.HashTable.enable;
                                  implementationCanvas.ExtensibleHashTable.
                                    enable;
                                  implementationCanvas.List.enable;
                                  implementationCanvas.Set.enable;
                                  implementationCanvas.MultiSet.enable;
                                  implementationCanvas.Stack.enable;
                                  implementationCanvas.Queue.enable;
                                  implementationCanvas.PriorityQueue.enable
                               else
                                  gppProp.byValue->kind;
                                  false->byReference.state;
                                  mainCanvas.leftCanvas.from.all
                                    ->mainCanvas.leftCanvas.from.selection;
                                  mainCanvas.leftCanvas.from.delete;
                                  '1'->mainCanvas.leftCanvas.from.insert;
                                  mainCanvas.leftCanvas.from.disable;
                                  implementationCanvas.ArrayContainer.disable;
                                  implementationCanvas.HashTable.disable;
                                  implementationCanvas.ExtensibleHashTable.
                                    disable;
                                  implementationCanvas.List.disable;
                                  implementationCanvas.Set.disable;
                                  implementationCanvas.MultiSet.disable;
                                  implementationCanvas.Stack.disable;
                                  implementationCanvas.Queue.disable;
                                  implementationCanvas.PriorityQueue.disable;
                                  (if not mainCanvas.allImplFalse then
                                      (if not
                                      implementationCanvas.Repetition.state then
                                          false
                                            ->
                                              implementationCanvas.
                                                ArrayContainer.state
                                            ->
                                              implementationCanvas.HashTable.
                                                state
                                            ->
                                              implementationCanvas.
                                                ExtensibleHashTable.state
                                            ->implementationCanvas.List.state
                                            ->implementationCanvas.Set.state
                                            ->
                                              implementationCanvas.MultiSet.
                                                state
                                            ->implementationCanvas.Stack.state
                                            ->implementationCanvas.Queue.state
                                            ->
                                              implementationCanvas.PriorityQueue
                                              .state;
                                          true
                                            ->
                                              implementationCanvas.Repetition.
                                                state;
                                          gppProp.Repetition->impl
                                      if)
                                  if)
                              if);
                              true->codeChanged
                           #)
                      #);
                    open::< 
                      (# 
                      do (8,37)->position; (69,17)->size; 'By-value'->label
                      #)
                 #);
               byReference: @checkbox
                 (#
                    eventhandler::< 
                      (#
                         onMouseUp::< 
                           (# 
                           do
                              (if state then
                                  gppProp.byValue->kind;
                                  true->byValue.state;
                                  mainCanvas.leftCanvas.from.all
                                    ->mainCanvas.leftCanvas.from.selection;
                                  mainCanvas.leftCanvas.from.delete;
                                  '1'->mainCanvas.leftCanvas.from.insert;
                                  mainCanvas.leftCanvas.from.disable;
                                  implementationCanvas.ArrayContainer.disable;
                                  implementationCanvas.HashTable.disable;
                                  implementationCanvas.ExtensibleHashTable.
                                    disable;
                                  implementationCanvas.List.disable;
                                  implementationCanvas.Set.disable;
                                  implementationCanvas.MultiSet.disable;
                                  implementationCanvas.Stack.disable;
                                  implementationCanvas.Queue.disable;
                                  implementationCanvas.PriorityQueue.disable;
                                  (if not mainCanvas.allImplFalse then
                                      (if not
                                      implementationCanvas.Repetition.state then
                                          false
                                            ->
                                              implementationCanvas.
                                                ArrayContainer.state
                                            ->
                                              implementationCanvas.HashTable.
                                                state
                                            ->
                                              implementationCanvas.
                                                ExtensibleHashTable.state
                                            ->implementationCanvas.List.state
                                            ->implementationCanvas.Set.state
                                            ->
                                              implementationCanvas.MultiSet.
                                                state
                                            ->implementationCanvas.Stack.state
                                            ->implementationCanvas.Queue.state
                                            ->
                                              implementationCanvas.PriorityQueue
                                              .state;
                                          true
                                            ->
                                              implementationCanvas.Repetition.
                                                state;
                                          gppProp.Repetition->impl
                                      if)
                                  if)
                               else
                                  gppProp.byReference->kind;
                                  false->byValue.state;
                                  mainCanvas.leftCanvas.from.enable;
                                  implementationCanvas.ArrayContainer.enable;
                                  implementationCanvas.HashTable.enable;
                                  implementationCanvas.ExtensibleHashTable.
                                    enable;
                                  implementationCanvas.List.enable;
                                  implementationCanvas.Set.enable;
                                  implementationCanvas.MultiSet.enable;
                                  implementationCanvas.Stack.enable;
                                  implementationCanvas.Queue.enable;
                                  implementationCanvas.PriorityQueue.enable
                              if);
                              true->codeChanged
                           #)
                      #);
                    open::< 
                      (# 
                      do (8,16)->position; (93,17)->size; 'By-reference'->label
                      #)
                 #)
            #);
          checkConstraints: @checkbox
            (#
               eventhandler::< 
                 (# onMouseUp::<  (#  do true->codeChanged #) #);
               open::< 
                 (# 
                 do
                    (194,203)->position;
                    (123,16)->size;
                    'Check constraints'->label
                 #)
            #);
          separator1: @separator
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    5->style;
                    (7,219)->size;
                    (172,5)->position;
                    
                 #);
               vertical::  (#  do true->value #)
            #)
       #);
     DisplayCanvas: @canvas
       (#
          open::< 
            (# 
            do
               3->border.style;
               true->border.visible;
               (400,299)->size;
               Name.open;
               SourceLabel.open;
               DestinationLabel.open;
               SourceRoleName.open;
               SourceMultiplicity.open;
               SourceRightSide.open;
               SourceLeftSide.open;
               SourceAttachLabel.open;
               separator12.open;
               DestinationRoleName.open;
               DestinationMultiplicity.open;
               DestinationAttachLabel.open;
               DestinationRightSide.open;
               DestinationLeftSide.open;
               separator23.open;
               isVisible.open;
               (10,437)->position;
               
            #);
          Name: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Name'->label;
                    THIS(aggregationDialog).name->state;
                    (100,20)->size;
                    (113,11)->position;
                    
                 #)
            #);
          SourceLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Source:'->label;
                    (60,16)->size;
                    (8,50)->position;
                    
                 #)
            #);
          DestinationLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Destination:'->label;
                    (76,17)->size;
                    (202,53)->position;
                    
                 #)
            #);
          SourceRoleName: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Role name'->label;
                    srolename->state;
                    (100,20)->size;
                    (8,73)->position;
                    
                 #)
            #);
          SourceMultiplicity: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Multiplicity'->label;
                    smul->state;
                    (100,20)->size;
                    (8,96)->position;
                    
                 #)
            #);
          SourceRightSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->SourceLeftSide.state
                          else
                             true->SourceLeftSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Right side'->label;
                    srightside->state;
                    (100,20)->size;
                    (8,149)->position;
                    
                 #)
            #);
          SourceLeftSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->SourceRightSide.state
                          else
                             true->SourceRightSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Left side'->label;
                    sleftside->state;
                    (100,20)->size;
                    (8,172)->position;
                    
                 #)
            #);
          SourceAttachLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Attach role to'->label;
                    (88,17)->size;
                    (8,129)->position;
                    
                 #)
            #);
          separator12: @separator
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    5->style;
                    (366,8)->size;
                    (5,36)->position;
                    
                 #)
            #);
          DestinationRoleName: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Role name'->label;
                    drolename->state;
                    (100,20)->size;
                    (202,75)->position;
                    
                 #)
            #);
          DestinationMultiplicity: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Multiplicity'->label;
                    dmul->state;
                    (100,20)->size;
                    (202,98)->position;
                    
                 #)
            #);
          DestinationAttachLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Attach role to'->label;
                    (88,17)->size;
                    (202,131)->position;
                    
                 #)
            #);
          DestinationRightSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->DestinationLeftSide.state
                          else
                             true->DestinationLeftSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Right side'->label;
                    drightside->state;
                    (100,20)->size;
                    (202,151)->position;
                    
                 #)
            #);
          DestinationLeftSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->DestinationRightSide.state
                          else
                             true->DestinationRightSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Left side'->label;
                    dleftside->state;
                    (100,20)->size;
                    (202,174)->position;
                    
                 #)
            #);
          separator23: @separator
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    5->style;
                    (7,154)->size;
                    (186,44)->position;
                    
                 #);
               vertical::  (#  do true->value #)
            #);
          isVisible: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Visible'->label;
                    THIS(aggregationDialog).visible->state;
                    (100,20)->size;
                    (8,11)->position;
                    
                 #)
            #)
       #);
     theTabs: @tabControl
       (#
          theMainTab: @tab
            (#
               open:: 
                 (# 
                 do
                    'General'->label;
                    THIS(tabControl)[]->mainCanvas.open;
                    mainCanvas[]->page
                 #)
            #);
          implementationTab: @tab
            (#
               open:: 
                 (# 
                 do
                    'Implementation'->label;
                    THIS(tabControl)[]->implementationCanvas.open;
                    implementationCanvas[]->page
                 #)
            #);
          displayTab: @tab
            (#
               open:: 
                 (# 
                 do
                    'Display Preferences'->label;
                    THIS(tabControl)[]->displayCanvas.open;
                    displayCanvas[]->page
                 #)
            #);
          open:: 
            (# 
            do
               true->bindBottom;
               true->bindRight;
               3->border.style;
               (405,300)->size;
               (5,5)->position;
               theMainTab.open;
               implementationTab.open;
               displayTab.open;
               theMainTab[]->selection
            #)
       #);
     CancelButton: @pushButton
       (#
          eventhandler::< 
            (#
               onMouseUp::< 
                 (# 
                 do
                    gppProp.noGlobalInteractiveMode
                      ->gppProp.globalInteractiveMode;
                    THIS(aggregationDialog).close
                 #)
            #);
          open::< 
            (#  do (274,360)->position; (60,20)->size; 'Cancel'->label #)
       #);
     OKbutton: @pushButton
       (#
          eventhandler::< 
            (#
               onMouseUp::< 
                 (# theObject: ^theWorkPage.DesignObject; t: ^text
                 do
                    (if theAggregationConn[] = none then
                        &theWorkPage.AggregationConnector[]
                          ->theAggregationConn[]
                    if);
                    mainCanvas.leftCanvas.from.contents->t[];
                    t.reset;
                    (if t.length > 0 then
                        t.getint->wholeMulFrom
                     else
                        (if kind
                         // gppProp.byValue then
                            1->wholeMulFrom
                         // gppProp.byReference then
                            0->wholeMulFrom
                        if)
                    if);
                    mainCanvas.leftCanvas.to.contents->t[];
                    t.reset;
                    t.getint->wholeMulTo;
                    mainCanvas.rightCanvas.from.contents->t[];
                    t.reset;
                    (if t.length > 0 then
                        (if '*'->t.equal then
                            - 1->partMulFrom->partMulTo
                         else
                            t.getint->partMulFrom;
                            mainCanvas.rightCanvas.to.contents->t[];
                            t.reset;
                            (if t.length > 0 then
                                (if '*'->t.equal then
                                    - 1->partMulTo
                                 else
                                    t.getint->partMulTo
                                if)
                             else
                                partMulFrom->partMulTo
                            if)
                        if)
                     else
                        mainCanvas.rightCanvas.to.contents->t[];
                        t.reset;
                        (if t.length > 0 then
                            (if '*'->t.equal then
                                - 1->partMulTo->partMulFrom
                             else
                                t.getint->partMulTo->partMulFrom
                            if)
                         else
                            1->partMulFrom->partMulTo
                        if)
                    if);
                    (if (partMulTo = - 1) or (partMulTo >= partMulFrom) then
                        mainCanvas.NameEdit.contents->t[];
                        (if t.length = 0 then '<<NameDecl>>'->t[] if);
                        (* mainCanvas.descriptionEdit.contents.contents->desc[];
                         (if desc.length = 0 then none ->desc[] if); *)
                        DisplayCanvas.isVisible.state
                          ->THIS(AggregationDialog).visible;
                        DisplayCanvas.name.state->name;
                        DisplayCanvas.SourceRoleName.state->srolename;
                        DisplayCanvas.SourceMultiplicity.state->smul;
                        DisplayCanvas.SourceRightSide.state->srightside;
                        DisplayCanvas.SourceLeftSide.state->sleftside;
                        DisplayCanvas.DestinationRoleName.state->drolename;
                        DisplayCanvas.DestinationMultiplicity.state->dmul;
                        DisplayCanvas.DestinationRightSide.state->drightside;
                        DisplayCanvas.DestinationLeftSide.state->dleftside;
                        THIS(aggregationDialog).close;
                        gppProp.creatingAggregation
                          ->gppProp.globalInteractiveMode;
                        (if theAggregationConn.id = 0 then
                            ('Left click on "whole"; then right click on "part"',
                             t[],impl,none ,none ,wholeMulFrom,wholeMulTo,
                             partMulFrom,partMulTo,true,desc[],
                             THIS(aggregationDialog).visible,name,srolename,
                             smul,srightside,drolename,dmul,drightside,kind)
                              ->theAggregationConn.interactiveNew
                         else
                            (codeChanged,t[],impl,none ,none ,wholeMulFrom,
                             wholeMulTo,partMulFrom,partMulTo,true,desc[],
                             THIS(aggregationDialog).visible,name,srolename,
                             smul,srightside,drolename,dmul,drightside,kind)
                              ->theAggregationConn.Redisplay
                        if)
                     else
                        'Lower bound of the multiplicity on the part\nmust be less than or equal to the upper bound'
                          ->alertUser
                    if)
                 #)
            #);
          open::<  (#  do (344,360)->position; (60,20)->size; 'OK'->label #)
       #);
     codeChanged,visible,name,SRoleName,SMul,SRightSide,SLeftSide,DRoleName,
       DMul,DRightSide,DLeftSide: @boolean;
     kind,impl: @integer;
     theName,desc: ^text;
     theAggregationConn: ^theWorkPage.AggregationConnector;
     wholeMulFrom,wholeMulTo,partMulFrom,partMulTo: @integer;
     eventhandler::< 
       (# onAboutToClose::<  (#  do false->okToClose #) #);
     open::< 
       (# x,y,left,top,right,bottom: @integer
       enter
       (theAggregationConn[],theName[],kind,impl,wholeMulFrom,wholeMulTo,
        partMulFrom,partMulTo,desc[])
       do
          (if theAggregationConn[] = none then
              gppProp.byReference->kind;
              gppProp.noImplementation->impl;
              true->visible;
              false->name;
              false->srolename;
              false->smul;
              false->sleftside;
              true->srightside;
              false->drolename;
              true->dmul;
              true->dleftside;
              false->drightside
           else
              theAggregationConn.visible->visible;
              (if theAggregationConn.name <> none then
                  (theAggregationConn.name).visible->name
              if);
              (if (theAggregationConn.leftRole->theAggregationConn.lr[]).name <>
              none then
                  ((theAggregationConn.leftRole->theAggregationConn.lr[]).name).
                  visible->srolename
              if);
              (
              (theAggregationConn.leftRole->theAggregationConn.lr[]).
              multiplicity).visible->smul;
              (theAggregationConn.leftRole->theAggregationConn.lr[]).attachRight
                ->srightside;
              not srightside->sleftside;
              (if (theAggregationConn.rightRole->theAggregationConn.rr[]).name
              <> none then
                  ((theAggregationConn.rightRole->theAggregationConn.rr[]).name)
                    .visible->drolename
              if);
              (
              (theAggregationConn.rightRole->theAggregationConn.rr[]).
              multiplicity).visible->dmul;
              (theAggregationConn.rightRole->theAggregationConn.rr[]).
              attachRight->drightside;
              not drightside->dleftside
          if);
          theTabs.open;
          OKbutton.open;
          CancelButton.open;
          (415,400)->size;
          'Aggregation'->title;
          theDesignInterface.private.UI.mouse.globalPosition->(x,y);
          theDesignInterface.private.UI.screenRectangle
            ->((left,top),(right,bottom));
          (if x < left then left->x if);
          (if y < top then top->y if);
          (if x+410 > right then right-410->x if);
          (if y+431 > bottom then bottom-431->y if);
          (x,y)->position;
          OKbutton[]->defaultButton;
          INNER open;
          showModal;
          
       #)
  #)  

