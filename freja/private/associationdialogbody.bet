ORIGIN 'dialogbody';
-- openAssociationDialog: DoPart --
do
     (# theDialog: ^AssociationDialog
     do
        &AssociationDialog[]->theDialog[];
        (theAssociationConnector[],theName[],leftRoleName[],rightRoleName[],
         implementation,leftMulFrom,leftMulTo,rightMulFrom,rightMulTo,embed,
         description[])->theDialog.open
     #)  

-- associationDialog: Descriptor --
private.UI.window
  (#
     resizeable::  (#  do false->value #);
     mainCanvas: @canvas
       (#
          Name: @staticText
            (#
               open::< 
                 (#  do (10,15)->position; (60,16)->size; 'Name:'->label #)
            #);
          NameEdit: @textField
            (#
               isOpen: @Boolean;
               eventHandler:: 
                 (#
                    onBeforeChange:: 
                      (# t: ^text; ch: @char
                      do
                         (if isOpen then
                             theText->t[];
                             (if t[] <> none then
                                 (if t.length = 1 then
                                     t.reset;
                                     (if position = 0 then
                                         (if not (t.get->ch->ascii.isLetter)
                                          then
                                             false->allow;
                                             theDesignInterface.private.UI.beep
                                         if)
                                      else
                                         (if not
                                         ((t.get->ch->ascii.isDigit) or
                                          (ch->ascii.isLetter)) then
                                             false->allow;
                                             theDesignInterface.private.UI.beep
                                         if)
                                     if)
                                  else
                                     false->allow;
                                     theDesignInterface.private.UI.beep
                                 if)
                             if)
                         if)
                      #);
                    onTextChanged:: 
                      (#  do (if isOpen then true->codeChanged if) #)
                 #);
               open::< 
                 (# 
                 do
                    (if theName[] <> none then theName[]->insert if);
                    (10,35)->position;
                    (378,30)->size;
                    true->isOpen
                 #)
            #);
          RoleCanvas: Canvas
            (#
               roleName: @staticText
                 (#
                    open::< 
                      (# 
                      do (5,18)->position; (82,16)->size; 'Role Name:'->label
                      #)
                 #);
               roleNameFieldDesc:< textField
                 (#
                    isOpen: @Boolean;
                    eventHandler:: 
                      (#
                         onBeforeChange:: 
                           (# t: ^text; ch: @char
                           do
                              (if isOpen then
                                  theText->t[];
                                  (if t[] <> none then
                                      (if t.length = 1 then
                                          t.reset;
                                          (if position = 0 then
                                              (if not
                                              (t.get->ch->ascii.isLetter) then
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                           else
                                              (if not
                                              ((t.get->ch->ascii.isDigit) or
                                               (ch->ascii.isLetter)) then
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                          if)
                                       else
                                          false->allow;
                                          theDesignInterface.private.UI.beep
                                      if)
                                  if)
                              if)
                           #);
                         onTextChanged:: 
                           (# 
                           do
                              (if isOpen then
                                  true->codeChanged; INNER onTextChanged
                              if)
                           #)
                      #);
                    open::< 
                      (# 
                      do
                         (92,12)->position;
                         (80,30)->size;
                         INNER open;
                         true->isOpen
                      #)
                 #);
               roleNameField: @roleNameFieldDesc;
               multiplicity: @staticText
                 (#
                    open::< 
                      (# 
                      do
                         (5,58)->position; (82,16)->size; 'Multiplicity:'->label
                      #)
                 #);
               toLabel: @staticText
                 (#
                    open::< 
                      (# 
                      do (124,59)->position; (16,16)->size; 'to'->label
                      #)
                 #);
               FromField:< textField
                 (#
                    isOpen: @boolean;
                    eventHandler::< 
                      (#
                         onTextChanged::< 
                           (# 
                           do
                              (if isOpen then
                                  true->codeChanged; INNER onTextChanged
                              if)
                           #);
                         onBeforeChange::< 
                           (# t: ^text; ch: @char
                           do
                              (if isOpen then
                                  theText->t[];
                                  (if t[] <> none then
                                      (if t.length = 1 then
                                          t.reset;
                                          (if t.get->ch->ascii.isDigit then
                                              (if '*'->(contents).equal then
                                                  (if
                                                  selection.contents
                                                    ->(contents).equal then
                                                      to.all->to.selection;
                                                      to.delete;
                                                      '*'->to.insert
                                                   else
                                                      false->allow;
                                                      theDesignInterface.private
                                                      .UI.beep
                                                  if)
                                               else
                                                  (if '0' = ch then
                                                      (if position = 0 then
                                                          (if
                                                          ((contents).length =
                                                           0) then
                                                              
                                                           else
                                                              false->allow;
                                                              theDesignInterface
                                                              .private.UI.beep
                                                          if)
                                                      if)
                                                  if)
                                              if)
                                           else
                                              (if ch = '*' then
                                                  (if ((contents).length = 0) or
                                                  (selection.contents
                                                     ->(contents).equal) then
                                                      to.all->to.selection;
                                                      to.delete;
                                                      '*'->to.insert
                                                   else
                                                      false->allow;
                                                      theDesignInterface.private
                                                      .UI.beep
                                                  if)
                                               else
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                          if)
                                       else
                                          false->allow;
                                          theDesignInterface.private.UI.beep
                                      if)
                                  if);
                                  INNER onBeforeChange
                              if)
                           #)
                      #);
                    open::< 
                      (# 
                      do
                         (92,52)->position;
                         (30,30)->size;
                         (if theAssociationConn[] = none then
                             '1'->insert
                         if);
                         INNER open;
                         true->isOpen
                      #)
                 #);
               from: @FromField;
               ToField:< textField
                 (#
                    isOpen: @boolean;
                    eventhandler::< 
                      (#
                         onTextChanged:: 
                           (# t: ^text; m: @integer
                           do
                              (if isOpen then
                                  contents->t[];
                                  (if t[] <> none then
                                      (if t.length > 0 then
                                          (if '*'->t.equal then
                                              (if allImplFalse then
                                                  true
                                                    ->
                                                      implementationCanvas.List.
                                                        state;
                                                  gppProp.List->impl
                                              if)
                                           else
                                              t.reset;
                                              t.getint->m;
                                              (if m > 1 then
                                                  (if allImplFalse then
                                                      true
                                                        ->
                                                          implementationCanvas.
                                                            List.state;
                                                      gppProp.List->impl
                                                  if)
                                              if)
                                          if);
                                          true->codeChanged
                                      if)
                                  if);
                                  INNER onTextChanged
                              if)
                           #);
                         onBeforeChange:: 
                           (# t: ^text; ch: @char
                           do
                              (if isOpen then
                                  theText->t[];
                                  (if t[] <> none then
                                      (if t.length = 1 then
                                          t.reset;
                                          (if t.get->ch->ascii.isDigit then
                                              (if '*'->(contents).equal then
                                                  (if
                                                  selection.contents
                                                    ->(contents).equal then
                                                      
                                                   else
                                                      false->allow;
                                                      theDesignInterface.private
                                                      .UI.beep
                                                  if)
                                               else
                                                  (if '0' = ch then
                                                      (if position = 0 then
                                                          (if
                                                          ((contents).length =
                                                           0) then
                                                              
                                                           else
                                                              false->allow;
                                                              theDesignInterface
                                                              .private.UI.beep
                                                          if)
                                                      if)
                                                  if)
                                              if)
                                           else
                                              (if ch = '*' then
                                                  (if ((contents).length = 0) or
                                                  (selection.contents
                                                     ->(contents).equal) then
                                                      
                                                   else
                                                      false->allow;
                                                      theDesignInterface.private
                                                      .UI.beep
                                                  if)
                                               else
                                                  false->allow;
                                                  theDesignInterface.private.UI.
                                                    beep
                                              if)
                                          if)
                                       else
                                          false->allow;
                                          theDesignInterface.private.UI.beep
                                      if)
                                  if);
                                  INNER onBeforeChange
                              if)
                           #)
                      #);
                    open::< 
                      (# 
                      do
                         (142,52)->position;
                         (30,30)->size;
                         (if theAssociationConn[] = none then
                             '1'->insert
                         if);
                         INNER open;
                         true->isOpen
                      #)
                 #);
               to: @ToField;
               getMultiplicities:
                 (# fromVal,toVal: @integer; t: ^text
                 do
                    from.contents->t[];
                    t.reset;
                    (if t.length > 0 then
                        (if '*'->t.equal then
                            - 1->fromVal->toVal
                         else
                            t.getint->fromVal;
                            to.contents->t[];
                            t.reset;
                            (if t.length > 0 then
                                (if '*'->t.equal then
                                    - 1->toVal
                                 else
                                    t.getint->toVal
                                if)
                             else
                                fromVal->toVal
                            if)
                        if)
                     else
                        to.contents->t[];
                        t.reset;
                        (if t.length > 0 then
                            (if '*'->t.equal then
                                - 1->toVal->fromVal
                             else
                                t.getint->toVal->fromVal
                            if)
                         else
                            1->fromVal->toVal
                        if)
                    if)
                 exit (fromVal,toVal)
                 #);
               open::< 
                 (# 
                 do
                    true->border.visible;
                    theDesignInterface.private.UI.borderStyles.etchedIn
                      ->border.style;
                    roleName.open;
                    roleNameField.open;
                    multiplicity.open;
                    toLabel.open;
                    from.open;
                    to.open;
                    (184,95)->size;
                    INNER open
                 #)
            #);
          leftCanvasLabel: @staticText
            (#
               open::< 
                 (#  do (15,75)->position; (40,16)->size; 'Source'->label #)
            #);
          rightCanvasLabel: @staticText
            (#
               open::< 
                 (# 
                 do (209,75)->position; (70,16)->size; 'Destination'->label
                 #)
            #);
          leftCanvas: @RoleCanvas
            (#
               roleNameFieldDesc:: 
                 (#
                    open:: 
                      (# 
                      do
                         (if leftRoleName[] <> none then
                             leftRoleName[]->insert
                         if)
                      #)
                 #);
               FromField:: 
                 (#
                    open:: 
                      (# t: @text
                      do
                         (if theAssociationConn[] <> none then
                             (if leftMulFrom >= 0 then
                                 leftMulFrom->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               ToField:: 
                 (#
                    open:: 
                      (# t: @text
                      do
                         (if theAssociationConn[] <> none then
                             (if leftMulTo >= 0 then
                                 leftMulTo->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               open:: 
                 (# 
                 do (184,95)->size; 3->border.style; (10,83)->position; 
                 #)
            #);
          rightCanvas: @RoleCanvas
            (#
               roleNameFieldDesc:: 
                 (#
                    open:: 
                      (# 
                      do
                         (if rightRoleName[] <> none then
                             rightRoleName[]->insert
                         if)
                      #)
                 #);
               FromField:: 
                 (#
                    open:: 
                      (# t: @text
                      do
                         (if theAssociationConn[] <> none then
                             (if rightMulFrom >= 0 then
                                 rightMulFrom->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               ToField:: 
                 (#
                    open:: 
                      (# t: @text
                      do
                         (if theAssociationConn[] <> none then
                             (if rightMulTo >= 0 then
                                 rightMulTo->t.putint; t[]->insert
                              else
                                 '*'->insert
                             if)
                         if)
                      #)
                 #);
               open:: 
                 (# 
                 do (184,95)->size; 3->border.style; (204,83)->position
                 #)
            #);
          Description: @staticText
            (#
               open::< 
                 (# 
                 do (10,185)->position; (76,16)->size; 'Description:'->label
                 #)
            #);
          DescriptionEdit: @textEditor
            (#
               open::< 
                 (# 
                 do
                    (10,205)->position;
                    (378,99)->size;
                    theDesignInterface.private.UI.borderStyles.ShadowIn
                      ->border.style;
                    (if desc[] <> none then desc[]->contents.insert if)
                 #)
            #);
          setNoImplMul:
            (# 
            do
               rightCanvas.to.all->rightCanvas.to.selection;
               rightCanvas.to.delete;
               '1'->rightCanvas.to.insert;
               rightCanvas.from.all->rightCanvas.from.selection;
               rightCanvas.from.delete;
               '0'->rightCanvas.from.insert
            #);
          setAllImplFalse:
            (# 
            do
               (if not allImplFalse then
                   false->implementationCanvas.Repetition.state
                     ->implementationCanvas.ArrayContainer.state
                     ->implementationCanvas.HashTable.state
                     ->implementationCanvas.ExtensibleHashTable.state
                     ->implementationCanvas.List.state
                     ->implementationCanvas.Set.state
                     ->implementationCanvas.MultiSet.state
                     ->implementationCanvas.Stack.state
                     ->implementationCanvas.Queue.state
                     ->implementationCanvas.PriorityQueue.state
               if)
            #);
          allImplFalse:
            (# value: @Boolean
            do
               not
               (implementationCanvas.Repetition.state or
                implementationCanvas.ArrayContainer.state or
                implementationCanvas.HashTable.state or
                implementationCanvas.ExtensibleHashTable.state or
                implementationCanvas.List.state or
                implementationCanvas.Set.state or
                implementationCanvas.MultiSet.state or
                implementationCanvas.Stack.state or
                implementationCanvas.Queue.state or
                implementationCanvas.PriorityQueue.state)->value
            exit value
            #);
          open::< 
            (# 
            do
               true->border.visible;
               theDesignInterface.private.UI.borderStyles.etchedOut
                 ->border.style;
               Name.open;
               NameEdit.open;
               leftCanvas.open;
               leftCanvasLabel.open;
               rightCanvas.open;
               rightCanvasLabel.open;
               (* Description.open;
                DescriptionEdit.open;
                DescriptionEdit.disable; *)
               (10,20)->position;
               (400,299)->size;
               NameEdit[]->target
            #)
       #);
     ImplementationCanvas: @Canvas
       (#
          Repetition: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.rightCanvas.to.all
                               ->mainCanvas.rightCanvas.to.selection;
                             mainCanvas.rightCanvas.to.delete;
                             '1'->mainCanvas.rightCanvas.to.insert;
                             mainCanvas.rightCanvas.from.all
                               ->mainCanvas.rightCanvas.from.selection;
                             mainCanvas.rightCanvas.from.delete;
                             '0'->mainCanvas.rightCanvas.from.insert
                          else
                             gppProp.repetition->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,16)->position; (81,16)->size; 'Repetition'->label
                 #)
            #);
          ArrayContainer: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.arrayContainer->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,37)->position; (111,16)->size; 'Array Container'->label
                 #)
            #);
          HashTable: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.hashTable->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,58)->position; (81,15)->size; 'Hash Table'->label
                 #)
            #);
          ExtensibleHashTable: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.ExtensibleHashTable->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do
                    (8,79)->position;
                    (147,16)->size;
                    'Extensible Hash Table'->label
                 #)
            #);
          List: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.List->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,100)->position; (45,16)->size; 'List'->label #)
            #);
          Set: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.Set->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,121)->position; (39,16)->size; 'Set'->label #)
            #);
          MultiSet: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.MultiSet->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,142)->position; (75,16)->size; 'Multi Set'->label
                 #)
            #);
          Stack: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.Stack->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,163)->position; (51,16)->size; 'Stack'->label #)
            #);
          Queue: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.Queue->impl; mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (#  do (8,184)->position; (51,16)->size; 'Queue'->label #)
            #);
          PriorityQueue: @checkbox
            (#
               eventHandler::< 
                 (#
                    onMouseUp::< 
                      (# 
                      do
                         (if state then
                             gppProp.noImplementation->impl;
                             mainCanvas.setNoImplMul
                          else
                             gppProp.PriorityQueue->impl;
                             mainCanvas.setAllImplFalse
                         if);
                         true->codeChanged
                      #)
                 #);
               open::< 
                 (# 
                 do (8,205)->position; (105,16)->size; 'Priority Queue'->label
                 #)
            #);
          open:: 
            (# 
            do
               true->border.visible;
               3->border.style;
               Repetition.open;
               ArrayContainer.open;
               HashTable.open;
               ExtensibleHashTable.open;
               List.open;
               Set.open;
               MultiSet.open;
               Stack.open;
               Queue.open;
               PriorityQueue.open;
               Repetition.disable;
               ArrayContainer.disable;
               HashTable.disable;
               ExtensibleHashTable.disable;
               Set.disable;
               MultiSet.disable;
               Stack.disable;
               Queue.disable;
               PriorityQueue.disable;
               (10,20)->position;
               (400,299)->size;
               embed.open;
               checkConstraints.open;
               checkConstraints.disable;
               separator2.open;
               (if impl <> gppProp.noImplementation then
                   (if impl
                    // gppProp.repetition then
                       true->repetition.state
                    // gppProp.arrayContainer then
                       true->arrayContainer.state
                    // gppProp.hashTable then
                       true->HashTable.state
                    // gppProp.extensibleHashTable then
                       true->ExtensibleHashTable.state
                    // gppProp.list then
                       true->List.state
                    // gppProp.set then
                       true->Set.state
                    // gppProp.multiSet then
                       true->MultiSet.state
                    // gppProp.stack then
                       true->Stack.state
                    // gppProp.queue then
                       true->Queue.state
                    // gppProp.priorityQueue then
                       true->PriorityQueue.state
                   if)
               if)
            #);
          embed: @checkbox
            (#
               eventHandler::< 
                 (# onMouseUp::<  (#  do true->codeChanged #) #);
               open::< 
                 (# 
                 do
                    (202,169)->position;
                    (123,16)->size;
                    'Embed'->label;
                    (if theAssociationConn[] <> none then
                        THIS(AssociationDialog).embed->state
                    if)
                 #)
            #);
          checkConstraints: @checkbox
            (#
               eventHandler::< 
                 (# onMouseUp::<  (#  do true->codeChanged #) #);
               open::< 
                 (# 
                 do
                    (202,197)->position;
                    (123,16)->size;
                    'Check constraints'->label
                 #)
            #);
          separator2: @separator
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    5->style;
                    (7,214)->size;
                    (186,8)->position;
                    
                 #);
               vertical::  (#  do true->value #)
            #)
       #);
     DisplayCanvas: @canvas
       (#
          open::< 
            (# 
            do
               3->border.style;
               true->border.visible;
               (400,299)->size;
               (10,20)->position;
               Name.open;
               SourceLabel.open;
               DestinationLabel.open;
               SourceRoleName.open;
               SourceMultiplicity.open;
               SourceRightSide.open;
               SourceLeftSide.open;
               SourceAttachLabel.open;
               separator12.open;
               DestinationRoleName.open;
               DestinationMultiplicity.open;
               DestinationAttachLabel.open;
               DestinationRightSide.open;
               DestinationLeftSide.open;
               separator23.open;
               isVisible.open;
               
            #);
          Name: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Name'->label;
                    THIS(associationDialog).name->state;
                    (100,20)->size;
                    (113,11)->position;
                    
                 #)
            #);
          SourceLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Source:'->label;
                    (60,16)->size;
                    (8,50)->position;
                    
                 #)
            #);
          DestinationLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Destination:'->label;
                    (76,17)->size;
                    (202,53)->position;
                    
                 #)
            #);
          SourceRoleName: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Role name'->label;
                    srolename->state;
                    (100,20)->size;
                    (8,73)->position;
                    
                 #)
            #);
          SourceMultiplicity: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Multiplicity'->label;
                    smul->state;
                    (100,20)->size;
                    (8,96)->position;
                    
                 #)
            #);
          SourceRightSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->SourceLeftSide.state
                          else
                             true->SourceLeftSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Right side'->label;
                    srightside->state;
                    (100,20)->size;
                    (8,149)->position;
                    
                 #)
            #);
          SourceLeftSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->SourceRightSide.state
                          else
                             true->SourceRightSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Left side'->label;
                    sleftside->state;
                    (100,20)->size;
                    (8,172)->position;
                    
                 #)
            #);
          SourceAttachLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Attach role to'->label;
                    (88,17)->size;
                    (8,129)->position;
                    
                 #)
            #);
          separator12: @separator
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    5->style;
                    (366,8)->size;
                    (5,36)->position;
                    
                 #)
            #);
          DestinationRoleName: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Role name'->label;
                    drolename->state;
                    (100,20)->size;
                    (202,75)->position;
                    
                 #)
            #);
          DestinationMultiplicity: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Multiplicity'->label;
                    dmul->state;
                    (100,20)->size;
                    (202,98)->position;
                    
                 #)
            #);
          DestinationAttachLabel: @staticText
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Attach role to'->label;
                    (88,17)->size;
                    (202,131)->position;
                    
                 #)
            #);
          DestinationRightSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->DestinationLeftSide.state
                          else
                             true->DestinationLeftSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Right side'->label;
                    drightside->state;
                    (100,20)->size;
                    (202,151)->position;
                    
                 #)
            #);
          DestinationLeftSide: @radiobutton
            (#
               eventhandler:: 
                 (#
                    onMouseUp:: 
                      (# 
                      do
                         (if not state then
                             false->DestinationRightSide.state
                          else
                             true->DestinationRightSide.state
                         if)
                      #)
                 #);
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Left side'->label;
                    dleftside->state;
                    (100,20)->size;
                    (202,174)->position;
                    
                 #)
            #);
          separator23: @separator
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    5->style;
                    (7,154)->size;
                    (186,44)->position;
                    
                 #);
               vertical::  (#  do true->value #)
            #);
          isVisible: @checkBox
            (#
               open::< 
                 (# 
                 do
                    5->border.style;
                    false->border.visible;
                    'Visible'->label;
                    THIS(AssociationDialog).visible->state;
                    (100,20)->size;
                    (8,11)->position;
                    
                 #)
            #)
       #);
     theTabs: @tabControl
       (#
          theMainTab: @tab
            (#
               open:: 
                 (# 
                 do
                    'General'->label;
                    THIS(tabControl)[]->mainCanvas.open;
                    mainCanvas[]->page
                 #)
            #);
          implementationTab: @tab
            (#
               open:: 
                 (# 
                 do
                    'Implementation'->label;
                    THIS(tabControl)[]->implementationCanvas.open;
                    implementationCanvas[]->page
                 #)
            #);
          displayTab: @tab
            (#
               open:: 
                 (# 
                 do
                    'Display Preferences'->label;
                    THIS(tabControl)[]->displayCanvas.open;
                    displayCanvas[]->page
                 #)
            #);
          open:: 
            (# 
            do
               true->bindBottom;
               true->bindRight;
               3->border.style;
               (405,300)->size;
               (5,5)->position;
               theMainTab.open;
               implementationTab.open;
               displayTab.open;
               theMainTab[]->selection
            #)
       #);
     CancelButton: @pushButton
       (#
          eventhandler::< 
            (#
               onMouseUp::< 
                 (# 
                 do
                    gppProp.noGlobalInteractiveMode
                      ->gppProp.globalInteractiveMode;
                    THIS(associationDialog).close
                 #)
            #);
          open::< 
            (#  do (274,360)->position; (60,20)->size; 'Cancel'->label #)
       #);
     OKbutton: @pushButton
       (#
          eventhandler::< 
            (#
               onMouseUp::<
                 (# theObject: ^theWorkPage.DesignObject; t: ^text
                 do
                    (if theAssociationConn[] = none then
                        &theWorkPage.AssociationConnector[]
                          ->theAssociationConn[]
                    if);
                    mainCanvas.leftCanvas.getMultiplicities
                      ->(leftMulFrom,leftMulTo);
                    mainCanvas.rightCanvas.getMultiplicities
                      ->(rightMulFrom,rightMulTo);
                    (if ((rightMulTo = - 1) or (rightMulTo >= rightMulFrom)) and
                    ((leftMulTo = - 1) or (leftMulTo >= leftMulFrom)) then
                        mainCanvas.NameEdit.contents->t[];
                        (if t.length = 0 then '<<NameDecl>>'->t[] if);
                        mainCanvas.leftCanvas.RoleNameField.contents
                          ->leftRoleName[];
                        (if leftRoleName.length = 0 then
                            none ->leftRoleName[]
                        if);
                        mainCanvas.rightCanvas.RoleNameField.contents
                          ->rightRoleName[];
                        (if rightRoleName.length = 0 then
                            none ->rightRoleName[]
                        if);
                        (* mainCanvas.descriptionEdit.contents.contents->desc[];
                         (if desc.length = 0 then none ->desc[] if); *)
                        ImplementationCanvas.embed.state->embed;
                        DisplayCanvas.isVisible.state
                          ->THIS(AssociationDialog).visible;
                        DisplayCanvas.name.state->name;
                        DisplayCanvas.SourceRoleName.state->srolename;
                        DisplayCanvas.SourceMultiplicity.state->smul;
                        DisplayCanvas.SourceRightSide.state->srightside;
                        DisplayCanvas.SourceLeftSide.state->sleftside;
                        DisplayCanvas.DestinationRoleName.state->drolename;
                        DisplayCanvas.DestinationMultiplicity.state->dmul;
                        DisplayCanvas.DestinationRightSide.state->drightside;
                        DisplayCanvas.DestinationLeftSide.state->dleftside;
                        THIS(associationDialog).close;
                        gppProp.creatingAssociation
                          ->gppProp.globalInteractiveMode;
                        (if theAssociationConn.id = 0 then
                            ('Left click on source; then right click on destination',
                             t[],impl,leftRoleName[],rightRoleName[],
                             leftMulFrom,leftMulTo,rightMulFrom,rightMulTo,
                             embed,desc[],THIS(AssociationDialog).visible,name,
                             srolename,smul,srightside,drolename,dmul,
                             drightside)->theAssociationConn.interactiveNew
                         else
                            (codeChanged,t[],impl,leftRoleName[],
                             rightRoleName[],leftMulFrom,leftMulTo,rightMulFrom,
                             rightMulTo,embed,desc[],
                             THIS(AssociationDialog).visible,name,srolename,
                             smul,srightside,drolename,dmul,drightside)
                              ->theAssociationConn.Redisplay
                        if)
                     else
                        'Lower bound of multiplicies must be less than\n or equal to the upper bound'
                          ->alertUser
                    if)
                 #)
            #);
          open::<  (#  do (344,360)->position; (60,20)->size; 'OK'->label #)
       #);
     impl: @integer;
     theName,leftRoleName,rightRoleName,desc: ^text;
     theAssociationConn: ^theWorkPage.AssociationConnector;
     leftMulFrom,leftMulTo,rightMulFrom,rightMulTo: @integer;
     codeChanged,embed,visible,name,SRoleName,SMul,SRightSide,SLeftSide,
       DRoleName,DMul,DRightSide,DLeftSide: @boolean;
     eventhandler::< 
       (# onAboutToClose::<  (#  do false->okToClose #) #);
     open::< 
       (# x,y,left,top,right,bottom: @integer
       enter
       (theAssociationConn[],theName[],leftRoleName[],rightRoleName[],impl,
        leftMulFrom,leftMulTo,rightMulFrom,rightMulTo,embed,desc[])
       do
          (if theAssociationConn[] = none then
              gppProp.noImplementation->impl;
              true->visible;
              true->name;
              true->srolename;
              true->smul;
              false->sleftside;
              true->srightside;
              true->drolename;
              true->dmul;
              true->dleftside;
              false->drightside
           else
              theAssociationConn.visible->visible;
              (if theAssociationConn.name <> none then
                  (theAssociationConn.name).visible->name
              if);
              (if (theAssociationConn.leftRole->theAssociationConn.lr[]).name <>
              none then
                  ((theAssociationConn.leftRole->theAssociationConn.lr[]).name).
                  visible->srolename
              if);
              (
              (theAssociationConn.leftRole->theAssociationConn.lr[]).
              multiplicity).visible->smul;
              (theAssociationConn.leftRole->theAssociationConn.lr[]).attachRight
                ->srightside;
              not srightside->sleftside;
              (if (theAssociationConn.rightRole->theAssociationConn.rr[]).name
              <> none then
                  ((theAssociationConn.rightRole->theAssociationConn.rr[]).name)
                    .visible->drolename
              if);
              (
              (theAssociationConn.rightRole->theAssociationConn.rr[]).
              multiplicity).visible->dmul;
              (theAssociationConn.rightRole->theAssociationConn.rr[]).
              attachRight->drightside;
              not drightside->dleftside
          if);
          theTabs.open;
          OKbutton.open;
          CancelButton.open;
          (415,400)->size;
          'Association'->title;
          theDesignInterface.private.UI.mouse.globalPosition->(x,y);
          theDesignInterface.private.UI.screenRectangle
            ->((left,top),(right,bottom));
          (if x < left then left->x if);
          (if y < top then top->y if);
          (if x+410 > right then right-410->x if);
          (if y+431 > bottom then bottom-500->y if);
          (x,y)->position;
          OKbutton[]->defaultButton;
          INNER open;
          showModal
       #)
  #)  

