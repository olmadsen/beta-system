ORIGIN '../freja';
INCLUDE 'frejabody';
-- FrejaFileNew: DescriptorForm --
(# t: ^text
do
(*(if theDocument[]
 // none then &OADDocument[]->theDocument[]; theDocument.new;
 if)
 *)
   (if switch[1] then 'Freja: Create a new fragment'->putline if);
   ('Enter file name:','')
     ->GppPromptForText
       (#
          confirm::< 
            (#
            do
               '#0newBETAProgram '->t[];
               theText[]->t.append;
               t[]->theController.sendSifCommand
            #)
       #)
#)  

-- FrejaOptionsMenuInit: DescriptorForm --
(# do (UserMenu3+13,'With Dexter')->WithDexterItem.init; #)  

-- FrejaOptionsMenuCheckMarks: DescriptorForm --
(# do withDexter->WithDexterItem.check #)  

-- EditorMenuInit: DescriptorForm --
(#
do
   (UserMenu2+1,'Show code in Sif')->ShowCodeItem.init;
   (UserMenu2+2,'New BETA Program')->NewProgramItem.init;
   (UserMenu2+3,'New BETA Library')->NewLibraryItem.init;
   (UserMenu2+4,'Check diagram')->CheckItem.init;
   (UserMenu2+5,'-')->sep.init;
   (UserMenu2+6,'Send Command...')->SendCommandItem.init;
   (UserMenu2+7,'Show Sif Selection')->SelectItem.init;
   (UserMenu2+8,'Turn off communication with Sif')->OffCommItem.init;
   sep.disable;
   true->ShowSIFSelection;
#)  

-- OffCommHit: DescriptorForm --
(# status: @Text; do '#0 off'->theController.sendSifCommand; #)  

-- SendCommandHit: DescriptorForm --
(# status: @Text; prompt: [1] @char; answer: [64] @Char; t: @Text;
do
   'Type a command for Sif, no CRs please!'->prompt;
   (if (prompt,@@ answer[1])->DSUIGetString
    // true then
       @@ answer[1]->cStringToCharRep->t; t[]->theController.sendSifCommand;
   if);
#)  

-- WithDexterHit: DescriptorForm --
(# do not WithDexter->WithDexter->Check #)  

-- SelectItem: DescriptorForm --
(#
do not ShowSIFSelection->ShowSIFSelection->Check; (* and set checkmark *)
#)  

-- FrejaUndoItem: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   anAST: ^AST;
   t: ^Text
do
   currentPage->thePage[];
   (if thePage.canUndo then
       thePage.CurrentObject->theObject[];
       (if theObject## <= thePage.PatternDiagramNode## then
           theObject[]->theNode[];
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' undo'->t.puttext;
           t[]->theController.sendSifCommand
       if)
   if)
#)  

-- FrejaCutItem: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   deletableConnector: ^thePage.DeletableConnector;
   anAST: ^AST;
   t: ^Text
do
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject## <= thePage.PatternDiagramNode## then
       theObject[]->theNode[];
       theNode.getASTNode->anAST[];
       (if anAST[] <> none then
           true->thePage.private.performingCut;
           (theNode.SifEditorInstanceNo,anAST.index)->changeASTFocus
        else
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' cut'->t.puttext;
           t[]->theController.sendSifCommand
       if)
    else
       (if theObject## <= thePage.DeletableConnector## then
           theObject[]->deletableConnector[]; deletableConnector.onDelete
       if);
       theObject.delete
   if)
#)  

-- FrejaCopyItem: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   anAST: ^AST;
   t: ^Text
do
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject## <= thePage.PatternDiagramNode## then
       theObject[]->theNode[];
       theNode.getASTNode->anAST[];
       (if anAST[] <> none then
           true->thePage.private.performingCopy;
           (theNode.SifEditorInstanceNo,anAST.index)->changeASTFocus
        else
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' copy'->t.puttext;
           t[]->theController.sendSifCommand
       if)
   if)
#)  

-- FrejaPasteItem: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   anAST: ^AST;
   t: ^Text
do
   currentPage->thePage[];
   (if thePage.canPaste then
       (if switch[1] then 'canPaste=true'->putline if);
       thePage.CurrentObject->theObject[];
       (if theObject## <= thePage.PatternDiagramNode## then
           theObject[]->theNode[];
           theNode.getASTNode->anAST[];
           (if anAST[] <> none then
               true->thePage.private.performingPaste;
               (theNode.SifEditorInstanceNo,anAST.index)->changeASTFocus
            else
               '#'->t[];
               theNode.SifEditorInstanceNo->t.putint;
               ' paste'->t.puttext;
               t[]->theController.sendSifCommand
           if)
       if)
   if)
#)  

-- FrejaClearItem: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   deletableConnector: ^thePage.DeletableConnector;
   anAST: ^AST;
   t: ^Text
do
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject## <= thePage.PatternDiagramNode## then
    else
       (if theObject## <= thePage.DeletableConnector## then
           theObject[]->deletableConnector[]; deletableConnector.onDelete
       if);
       theObject.delete
   if)
#)  

-- InsertBeforeHit: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.PatternDiagramNode;
   t: ^text;
   anAST: ^AST
do
   (if switch[1] then 'InsertBefore'->putline if);
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject[] <> none then
       theObject.getASTNode->anAST[];
       (if anAST[] <> none then
           true->thePage.private.performingInsertBefore;
           (theObject.SifEditorInstanceNo,anAST.index)
             ->changeASTFocus
             (*Actual send of command 'after' to sif is done as response to status
              'changeFocus' from sif (to deal with synch.)*)
        else
           (if switch[1] then
               'theObject.getASTNode returned NONE'->putline
           if);
           (if thePage.canListInsert
            // true then
               '#'->t[];
               theObject.SifEditorInstanceNo->t.putint;
               ' before'->t.puttext;
               t[]->theController.sendSifCommand;
           if)
       if)
   if);
#)  

-- EditMenuInit: DescriptorForm --
(#
do (* design gets internal error for items above status+3! Why? *)
(* (UserMenu2+2,'-')->sep1.init;
 sep1.disable; *)
   (UserMenu2+1,'Undo                  (u)')->iUndo.init;
   (UserMenu2+2,'Cut                    (k)')->iCut.init;
   (UserMenu2+3,'Copy                  (c)')->iCopy.init;
   (UserMenu2+4,'Paste                 (y)')->iPaste.init;
   (UserMenu2+5,'Clear')->iClear.init;
   (UserMenu2+6,'-')->sep2.init;
   sep2.disable;
   (UserMenu2+7,'Textedit         (SPACE)')->iTextEdit.init;
   (UserMenu2+8,'Revert Textediting')->irevertTextEdit.init;
   (UserMenu2+9,'-')->sep3.init;
   sep3.disable;
   (UserMenu2+10,'Insert Before       (b)')->insertbeforeItem.init;
   (*  (menuID.EditMenu.status+3,'-')->sep2.init;
    sep2.disable;*)
   (UserMenu2+11,'Insert After         (a)')->insertafter.init;
#)  

-- iTextEdit: DescriptorForm --
(# p: ^OADPage; c: ^p.DesignObject;
do
   CurrentPage->p[];
   p.CurrentObject->c[];
   (if c[]
    // none then
    else
       (if TextModeOn
        // true then c.theText.modeOff;
        else
           c.theText.modeOn;
       if);
       not TextModeOn->TextModeOn;
       TextModeOn->Check;
   if);
#)  

-- iRevertTextEdit: DescriptorForm --
(# p: ^OADPage; c: ^p.DesignObject; theDoc: ^OADdocument
do
   (if switch[1] then 'revert text edit'->putLine if);
   CurrentPage->p[];
   p.CurrentObject->c[];
   (if c[]
    // none then
    else
       (if TextModeOn
        // true then
           false->p.ongoingTextediting;
           false->p.onGoingTitleEditing;
           p.theTextBefore->c.theText.set;
           c.theText.modeOff
       if);
       theDocument[]->theDoc[];
       false->TextModeOn->theDoc.FrejaEditMenu.iTextedit.Check;
   if)
#)  

-- InsertAfterHit: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.PatternDiagramNode;
   t: ^text;
   anAST: ^AST;
do
   (if switch[1] then 'InsertAfter'->putline if);
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject[] <> none then
       theObject.getASTNode->anAST[];
       (if anAST[] <> none then
           true->thePage.private.performingInsertAfter;
           (theObject.SifEditorInstanceNo,anAST.index)
             ->changeASTFocus
             (*Actual send of command 'after' to sif is done as response to status
              'changeFocus' from sif (to deal with synch.)*)
        else
           (if switch[1] then
               'theObject.getASTNode returned NONE'->putline
           if);
           (if thePage.canListInsert
            // true then
               '#'->t[];
               theObject.SifEditorInstanceNo->t.putint;
               ' after'->t.puttext;
               t[]->theController.sendSifCommand;
           if)
       if)
   if);
#)
(*-- opengrouphit: DescriptorForm --
 (#
 t: ^Text;
 g: ^FragmentGroup;
 theObject: ^currentPage.PatternDiagramNode;
 myDocument: ^OADDocument;
 currentPage: ^myDocument.OADPage;
 do
 theDocument[]->myDocument[];
 myDocument.CurrentPage->currentPage[];
 currentPage.CurrentObject->theObject[];
 (if theObject[]
 // none then 'No Fragment Selected'->DSUIUserAckMessage;
 else
 theObject.GetGroup->g[];
 '#0openGroup '->t[];
 g.name->ExpandToFullPath->t.append;
 t[]->theController.sendSifCommand;
 if);
 #)  
 
 -- openFormHit: DescriptorForm --
 (#
 t: ^Text;
 theObject: ^currentPage.PatternDiagramNode;
 myDocument: ^OADDocument;
 currentPage: ^myDocument.OADPage;
 aForm: ^Fragment;
 g: ^FragmentGroup;
 do
 '#0openForm '->t[];
 theDocument[]->myDocument[];
 myDocument.CurrentPage->currentPage[];
 currentPage.CurrentObject->theObject[];
 (if theObject[]
 // none then 'No Fragment Selected'->DSUIUserAckMessage;
 else
 theObject.GetFragment->aForm[];
 (if aForm[] <> none
 // true then
 theObject.GetGroup->g[];
 g.name->t.append;
 '-'->t.append;
 aForm.name->t.append;
 ' 0'->t.append;
 t[]->theController.sendSifCommand;
 else
 'Cannot find FragmentForm for selected node'->DSUIUserAckMessage;
 t[]->putline;
 if);
 if);
 #)  
 * *)  

-- ShowCodeItem: DescriptorForm --
(#
   myDocument: ^OADDocument;
   currentPage: ^myDocument.OADPage;
   theObject: ^currentPage.DesignObject;
do
   theDocument[]->myDocument[];
   myDocument.CurrentPage->currentPage[];
   (if currentPage.CurrentObject->theObject[]
    // none then 'No selection, please select a node'->DSUIUserAckMessage;
    else
       theObject[]->currentPage.openObjectInSif;
   if);
#)  

-- NewProgramItem: DescriptorForm --
(# do '#0newBETAProgram olsen'->theController.sendSifCommand #)  

-- NewLibraryItem: DescriptorForm --
(# do '#0newBETALib hansen'->theController.sendSifCommand #)  

-- CheckItem: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   t: ^text
do
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject[] <> none
    // true then
       (if theObject.struc <= thePage.PatternDiagramNode##
        // true then
           theObject[]->theNode[];
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' check '->t.puttext;
           t[]->theController.sendSifCommand;
       if)
   if)
#)  

-- LinkStartHit: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   t: ^text;
do
   (if switch[11] // true then '[[Freja: StartLink: '->puttext; if);
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject[] <> none
    // true then
       (if theObject.struc <= thePage.PatternDiagramNode##
        // true then
           theObject[]->theNode[];
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' startLink '->t.puttext;
           t[]->theController.sendSifCommand;
           (if switch[11]
            // true then theNode.astIndex->screen.putint;
           if);
        else
           '[[Freja: StartLink:unknown object type selected]]'->screen.puttext;
       if);
    else
       '[[Freja: StartLink:no object selected]]'->screen.puttext;
   if);
   (if switch[11] // true then ']]'->screen.putline; if);
#)  

-- LinkEndHit: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   t: ^text;
do
   (if switch[11] // true then '[[Freja: EndLink: '->puttext; if);
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject[] <> none
    // true then
       (if theObject.struc <= thePage.PatternDiagramNode##
        // true then
           theObject[]->theNode[];
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' endLink '->t.puttext;
           t[]->theController.sendSifCommand;
           (if switch[11]
            // true then theNode.astIndex->screen.putint;
           if);
        else
           '[[Freja: EndLink:unknown object type selected]]'->screen.puttext;
       if);
    else
       '[[Freja: EndLink:no object selected]]'->screen.puttext;
   if);
   (if switch[11] // true then ']]'->screen.putline; if)
#)  

-- LinkFollowHit: DescriptorForm --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theMark: ^thePage.MarkNode;
   theNode: ^thePage.PatternDiagramNode;
   t: ^text;
do
   (if switch[11] // true then '[[Freja: FollowLink: '->puttext; if);
   currentPage->thePage[];
   thePage.CurrentObject->theObject[];
   (if theObject[] <> none
    // true then
       (if true
        // theObject.struc <= thePage.MarkNode## then
           theObject[]->theMark[];
           (if theMark.thePatternDiagramNode[] <> none
            // true then
               '#'->t[];
               (theMark.thePatternDiagramNode).SifEditorInstanceNo->t.putint;
               ' followLink '->t.puttext;
               (theMark.thePatternDiagramNode).astIndex->t.putint;
               t[]->theController.sendSifCommand;
               (if switch[11]
                // true then
                   (theMark.thePatternDiagramNode).astIndex->screen.putint;
               if);
            else
               '[[Freja: FollowLink:theMark has no NodeObject]]'
                 ->screen.puttext;
           if);
        // theObject.struc <= thePage.PatternDiagramNode## then
           theObject[]->theNode[];
           '#'->t[];
           theNode.SifEditorInstanceNo->t.putint;
           ' followLink '->t.puttext;
           theNode.astIndex->t.putint;
           t[]->theController.sendSifCommand;
           (if switch[11]
            // true then theNode.astIndex->screen.putint;
           if);
        else
           '[[Freja: FollowLink:unknown object type selected]]'->screen.puttext;
       if);
    else
       '[[Freja: FollowLink:no object selected]]'->screen.puttext;
   if);
   (if switch[11] // true then ']]'->screen.putline; if);
#)  

-- CreateNewPage: DescriptorForm --
(# p: ^OADObjectPage;
do
   &OADObjectPage[]->p[];
   p.new;
   CreatePassiveObject.enable;
   CreateMultipleObject.enable;
   CreateConcurrentObject.enable;
   CreateInteractionRelation.enable;
   CreateTwoWayInteractionRelation.enable;
   CreateDistributedInteractionRelation.enable;
   CreateTwoWayDistributedInteractionRelation.enable;
   (*CreatePattern.enable;
    CreateVirtualPattern.enable;*)
#)  

-- CreatePassiveObject: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Passive hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# pas: ^op.PassiveObject;
         do
            &op.PassiveObject[]->pas[];
            'Create Passive Object'->pas.interactivenew;
         #);
    else
       'Cannot create Object on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateMultipleObject: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Multiple hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# mult: ^op.MultipleObject;
         do
            &op.MultipleObject[]->mult[];
            'Create Multiple Object'->mult.interactivenew;
         #);
    else
       'Cannot create Object on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateConcurrentObject: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Concurrent hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# con: ^op.ConcurrentObject;
         do
            &op.ConcurrentObject[]->con[];
            'Create Concurrent Object'->con.interactivenew;
         #);
    else
       'Cannot create Object on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateInteractionRelation: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Relation hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# rel: ^op.InteractionRelation;
         do
            &op.InteractionRelation[]->rel[];
            'Create Interaction Relation Between two Objects '
              ->rel.interactivenew;
         #);
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateTwoWayInteractionRelation: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Relation hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# rel: ^op.TwoWayInteractionRelation;
         do
            &op.TwoWayInteractionRelation[]->rel[];
            'Create Interaction Relation Between two Objects '
              ->rel.interactivenew;
         #);
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateDistributedInteractionRelation: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Relation hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# rel: ^op.DistributedInteractionRelation;
         do
            &op.DistributedInteractionRelation[]->rel[];
            'Create Interaction Relation Between two Objects '
              ->rel.interactivenew;
         #);
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateTwoWayDistributedInteractionRelation: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Relation hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# rel: ^op.TwoWayDistributedInteractionRelation;
         do
            &op.TwoWayDistributedInteractionRelation[]->rel[];
            'Create Interaction Relation Between two Objects '
              ->rel.interactivenew;
         #);
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreatePattern: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Pattern hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# pp: ^op.PatternPattern;
         do &op.PatternPattern[]->pp[]; 'Create Pattern'->pp.interactivenew;
         #);
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreatePatternPrefix: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage; oad: ^OADPage;
do
   'Create Pattern Prefix hit'->screen.putline;
   CurrentPage->p[];
   (if true
    // (p.struc <= OADObjectPage##) then
    // (p.struc <= OADPage##) then
       p[]->oad[]; oad.StartCreatePrefix;
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- CreateVirtualPattern: DescriptorForm --
(# p: ^Page; op: ^OADObjectPage;
do
   'Create Virtual hit'->screen.putline;
   CurrentPage->p[];
   (if p.struc <= OADObjectPage##
    // true then
       p[]->op[];
         (# vp: ^op.VirtualPattern;
         do
            &op.VirtualPattern[]->vp[];
            'Create Virtual Pattern '->vp.interactivenew;
         #);
    else
       'Cannot create Relation on active page'->DSUIUserAckMessage;
   if);
#)  

-- ObjectCreateMenuInit: DescriptorForm --
(# separator1: @Item;
do
   (UserMenu5+1,'New Design Page')->CreateNewPage.init;
   (UserMenu5+2,'Object')->CreatePassiveObject.init;
   (UserMenu5+3,'Multiple Objects')->CreateMultipleObject.init;
   (UserMenu5+4,'Concurrent Object')->CreateConcurrentObject.init;
   (UserMenu5+6,'Interaction')->CreateInteractionRelation.init;
   (UserMenu5+7,'Two-way Interaction')->CreateTwoWayInteractionRelation.init;
   (UserMenu5+8,'Distributed Interaction')
     ->CreateDistributedInteractionRelation.init;
   (UserMenu5+9,'Two-way Distributed Interaction')
     ->CreateTwoWayDistributedInteractionRelation.init;
   (UserMenu5+10,'-')->separator1.init;
   separator1.disable;
   (UserMenu5+11,'Create Pattern')->CreatePattern.init;
   (UserMenu5+12,'Create Pattern Prefix')->CreatePatternPrefix.init;
   (UserMenu5+13,'Create Virtual Pattern')->CreateVirtualPattern.init;
   CreatePassiveObject.disable;
   CreateMultipleObject.disable;
   CreateConcurrentObject.disable;
   CreateInteractionRelation.disable;
   CreatePattern.disable;
   CreateVirtualPattern.disable;
#)  

-- ExpandMenuInit: DescriptorForm --
(#
do
   (for i: noOfItems repeat
     &ExpandItem[]->theItems[i][];
     (UserMenu8+i,'                                 ')->theItems[i].init
   for)
#)  

-- ExpandMenuCreateItems: DescriptorForm --
(# tt,category: ^Text; aItem: ^ExpandItem; symbol,i: @Integer;
do
   (if list[]
    // none then
    else
       (if theGraphicalInterface.switch[12] then
           'Freja: expandmenu.init: '->putText; list[]->putLine;
       if);
       list.reset;
       list.getatom->tt[];
       (if tt[]
        // none then
        else
           (if ('Enter'->tt.equal)
            // true then theexpandmenu.deletemenu;
            else
               list.reset;
               1->i;
               loop:
               (if 1
                // 1 then
                   list.getInt->symbol;
                   list.getAtom->category[];
                   (i,symbol,category[])->theItems[i].create;
                   (if list.pos+1 < list.length
                    // true then i+1->i; restart loop
                   if)
               if)
           if)
       if)
   if)
#)  

-- ExpandItemCreate: DescriptorForm --
(#
do
   (if (1->syncatname.inxget) = '-'
    // false then
       (if switch[1] then
           'Expand menu create: '->puttext;
           syncatno->putint;
           ' '->puttext;
           syncatname[]->putline
       if);
       (ItemNumber,syncatname,0)->DSMenuItemRename;
    // true then
       (ItemNumber,'--',0)->DSMenuItemRename; Disable;
   if)
#)  

-- ExpandItemHit: DescriptorForm --
(# p: ^Page; op: ^OADPage;
do
   (if SynCatNo
    // 13 then
       'expanding to RepetitionDecl is not yet implemented!'->DSUIUserAckMessage
    // 16 then
       'expanding to FinalDecl is not yet implemented!'->DSUIUserAckMessage
    else
       (if SynCatNo <> 0
        // true then
           currentpage->p[];
           (if p[] <> none
            // true then
               (if p.struc <= Palette##
                // true then 'CurrentPage is a Palette'->putline;
                else
                   (if switch[1] then
                       'Expand menu item hit: '->puttext;
                       SynCatNo->putint;
                       ' '->puttext;
                       synCatName[]->putline
                   if);
                   p[]->op[];
                   (SynCatNo,normal)->op.doExpand;
               if)
           if)
       if)
   if)
#)  

-- ExpandMenuDelete: DescriptorForm --
(#
do
   (for i: 11 repeat
     (theItems[i].ItemNumber,' ',0)->DSMenuItemRename;
     0->theItems[i].synCatNo;
     none ->theItems[i].synCatName[]
   for)
#)  

-- AttributeKindMenuInit: DescriptorForm --
(#
do
   (UserMenu9+1,'Pattern')->Pattern.init;
   (UserMenu9+2,'Part object')->PartObject.init;
   (UserMenu9+3,'Reference to object')->ReferenceToObject.init;
   (UserMenu9+4,'Virtual pattern')->VirtualPattern.init;
   (UserMenu9+5,'Binding of virtual pattern')->BindingOfVirtualPattern.init;
   (UserMenu9+6,'Final binding of virtual pattern')
     ->FinalBindOfVirtPattern.init;
   FinalBindOfVirtPattern.disable
#)  

-- AttributeKindMenuPartObject: DescriptorForm --
(#
   p: ^Page;
   op: ^OADPage;
   theListDiagram: ^op.ListDiagram;
   theNonTerminalNode: ^theListDiagram.NonTerminalNode;
   theSimpleNode: ^theListDiagram.SimpleNode;
   t: ^Text;
   anAST: ^AST
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               (if op.currentFocus[] <> none then
                   (if op.currentFocus.theDiagram <> none then
                       op.currentFocus.theDiagram->theListDiagram[];
                       (if op.currentFocus## <= theListDiagram.NonTerminalNode##
                        then
                           op.currentFocus[]->theNonTerminalNode[];
                           (if
                           'AttributeDeclOpt'
                             ->(theNonTerminalNode.synCatName).equalNCS then
                               (if op.currentFocus.SifEditorInstanceNo <> 0
                                // true then
                                   true->op.private.constructingStaticItem;
                                   '# '->t[];
                                   op.currentFocus.SifEditorInstanceNo
                                     ->t.putint;
                                   ' expandNormal '->t.append;
                                   betaGram.SimpleDecl->t.putint;
                                   t[]->theController.sendSifCommand;
                                   (if theGraphicalInterface.switch[31]
                                    // false then
                                       (if gppProp.UsingExpandMenu
                                        // true then
                                           theexpandmenu.deletemenu;
                                        else
                                           OADPalette.reset;
                                       if);
                                   if)
                               if)
                            else
                               'Selected node does not contain an AttributeDeclOpt!'
                                 ->putline
                           if)
                        else
                           'Selection is not a non terminal node!'->putline
                       if)
                    else
                       'PartObjectHit: theDiagram is NONE'->putline
                   if)
                else
                   'PartObjectHit: CurrentFocus is NONE'->putline
               if)
           if);
       if)
   if)
#)  

-- AttributeKindMenuReferenceToObject: DescriptorForm --
(#
   p: ^Page;
   op: ^OADPage;
   theListDiagram: ^op.ListDiagram;
   theNonTerminalNode: ^theListDiagram.NonTerminalNode;
   theSimpleNode: ^theListDiagram.SimpleNode;
   t: ^Text;
   anAST: ^AST
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               (if op.currentFocus[] <> none then
                   (if op.currentFocus.theDiagram <> none then
                       op.currentFocus.theDiagram->theListDiagram[];
                       (if op.currentFocus## <= theListDiagram.NonTerminalNode##
                        then
                           op.currentFocus[]->theNonTerminalNode[];
                           (if
                           'AttributeDeclOpt'
                             ->(theNonTerminalNode.synCatName).equalNCS then
                               (if op.currentFocus.SifEditorInstanceNo <> 0
                                // true then
                                   true->op.private.constructingDynamicItem;
                                   '# '->t[];
                                   op.currentFocus.SifEditorInstanceNo
                                     ->t.putint;
                                   ' expandNormal '->t.append;
                                   betaGram.SimpleDecl->t.putint;
                                   t[]->theController.sendSifCommand;
                                   (if theGraphicalInterface.switch[31]
                                    // false then
                                       (if gppProp.UsingExpandMenu
                                        // true then
                                           theexpandmenu.deletemenu;
                                        else
                                           OADPalette.reset;
                                       if);
                                   if)
                               if)
                            else
                               'Selected node does not contain an AttributeDeclOpt!'
                                 ->putline
                           if)
                        else
                           'Selection is not a non terminal node!'->putline
                       if)
                    else
                       'PartObjectHit: theDiagram is NONE'->putline
                   if)
                else
                   'PartObjectHit: CurrentFocus is NONE'->putline
               if)
           if);
       if)
   if)
#)  

-- AttributeKindMenuPattern: DescriptorForm --
(#
   p: ^Page;
   op: ^OADPage;
   theListDiagram: ^op.ListDiagram;
   theNonTerminalNode: ^theListDiagram.NonTerminalNode;
   theSimpleNode: ^theListDiagram.SimpleNode;
   t: ^Text;
   anAST: ^AST
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               (if op.currentFocus[] <> none then
                   (if op.currentFocus.theDiagram <> none then
                       op.currentFocus.theDiagram->theListDiagram[];
                       (if op.currentFocus## <= theListDiagram.NonTerminalNode##
                        then
                           op.currentFocus[]->theNonTerminalNode[];
                           (if
                           'AttributeDeclOpt'
                             ->(theNonTerminalNode.synCatName).equalNCS then
                               (if op.currentFocus.SifEditorInstanceNo <> 0
                                // true then
                                   '# '->t[];
                                   op.currentFocus.SifEditorInstanceNo
                                     ->t.putint;
                                   ' expandNormal '->t.append;
                                   betaGram.PatternDecl->t.putint;
                                   t[]->theController.sendSifCommand;
                                   (if theGraphicalInterface.switch[31]
                                    // false then
                                       (if gppProp.UsingExpandMenu
                                        // true then
                                           theexpandmenu.deletemenu;
                                        else
                                           OADPalette.reset;
                                       if);
                                   if)
                               if)
                            else
                               'Selected node does not contain an AttributeDeclOpt!'
                                 ->putline
                           if)
                        else
                           'Selection is not a non terminal node!'->putline
                       if)
                    else
                       'PartObjectHit: theDiagram is NONE'->putline
                   if)
                else
                   'PartObjectHit: CurrentFocus is NONE'->putline
               if)
           if);
       if)
   if)
#)  

-- AttributeKindMenuVirtualPattern: DescriptorForm --
(#
   p: ^Page;
   op: ^OADPage;
   theListDiagram: ^op.ListDiagram;
   theNonTerminalNode: ^theListDiagram.NonTerminalNode;
   theSimpleNode: ^theListDiagram.SimpleNode;
   t: ^Text;
   anAST: ^AST
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               (if op.currentFocus[] <> none then
                   (if op.currentFocus.theDiagram <> none then
                       op.currentFocus.theDiagram->theListDiagram[];
                       (if op.currentFocus## <= theListDiagram.NonTerminalNode##
                        then
                           op.currentFocus[]->theNonTerminalNode[];
                           (if
                           'AttributeDeclOpt'
                             ->(theNonTerminalNode.synCatName).equalNCS then
                               (if op.currentFocus.SifEditorInstanceNo <> 0
                                // true then
                                   '# '->t[];
                                   op.currentFocus.SifEditorInstanceNo
                                     ->t.putint;
                                   ' expandNormal '->t.append;
                                   betaGram.VirtualDecl->t.putint;
                                   t[]->theController.sendSifCommand;
                                   (if theGraphicalInterface.switch[31]
                                    // false then
                                       (if gppProp.UsingExpandMenu
                                        // true then
                                           theexpandmenu.deletemenu;
                                        else
                                           OADPalette.reset;
                                       if);
                                   if)
                               if)
                            else
                               'Selected node does not contain an AttributeDeclOpt!'
                                 ->putline
                           if)
                        else
                           'Selection is not a non terminal node!'->putline
                       if)
                    else
                       'PartObjectHit: theDiagram is NONE'->putline
                   if)
                else
                   'PartObjectHit: CurrentFocus is NONE'->putline
               if)
           if);
       if)
   if)
#)  

-- AttributeKindMenuBindingOfVirtualPattern: DescriptorForm --
(#
   p: ^Page;
   op: ^OADPage;
   theListDiagram: ^op.ListDiagram;
   theNonTerminalNode: ^theListDiagram.NonTerminalNode;
   theSimpleNode: ^theListDiagram.SimpleNode;
   t: ^Text;
   anAST: ^AST
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               (if op.currentFocus[] <> none then
                   (if op.currentFocus.theDiagram <> none then
                       op.currentFocus.theDiagram->theListDiagram[];
                       (if op.currentFocus## <= theListDiagram.NonTerminalNode##
                        then
                           op.currentFocus[]->theNonTerminalNode[];
                           (if
                           'AttributeDeclOpt'
                             ->(theNonTerminalNode.synCatName).equalNCS then
                               (if op.currentFocus.SifEditorInstanceNo <> 0
                                // true then
                                   '# '->t[];
                                   op.currentFocus.SifEditorInstanceNo
                                     ->t.putint;
                                   ' expandNormal '->t.append;
                                   betaGram.BindingDecl->t.putint;
                                   t[]->theController.sendSifCommand;
                                   (if theGraphicalInterface.switch[31]
                                    // false then
                                       (if gppProp.UsingExpandMenu
                                        // true then
                                           theexpandmenu.deletemenu;
                                        else
                                           OADPalette.reset;
                                       if);
                                   if)
                               if)
                            else
                               'Selected node does not contain an AttributeDeclOpt!'
                                 ->putline
                           if)
                        else
                           'Selection is not a non terminal node!'->putline
                       if)
                    else
                       'PartObjectHit: theDiagram is NONE'->putline
                   if)
                else
                   'PartObjectHit: CurrentFocus is NONE'->putline
               if)
           if);
       if)
   if)
#)  

-- AttributeKindMenuFinalBindOfVirtPattern: DescriptorForm --
(#
   p: ^Page;
   op: ^OADPage;
   theListDiagram: ^op.ListDiagram;
   theNonTerminalNode: ^theListDiagram.NonTerminalNode;
   theSimpleNode: ^theListDiagram.SimpleNode;
   t: ^Text;
   anAST: ^AST
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               (if op.currentFocus[] <> none then
                   (if op.currentFocus.theDiagram <> none then
                       op.currentFocus.theDiagram->theListDiagram[];
                       (if op.currentFocus## <= theListDiagram.NonTerminalNode##
                        then
                           op.currentFocus[]->theNonTerminalNode[];
                           (if
                           'AttributeDeclOpt'
                             ->(theNonTerminalNode.synCatName).equalNCS then
                               (if op.currentFocus.SifEditorInstanceNo <> 0
                                // true then
                                   '# '->t[];
                                   op.currentFocus.SifEditorInstanceNo
                                     ->t.putint;
                                   ' expandNormal '->t.append;
                                   betaGram.FinalDecl->t.putint;
                                   t[]->theController.sendSifCommand;
                                   (if theGraphicalInterface.switch[31]
                                    // true then
                                       (if gppProp.UsingExpandMenu
                                        // true then
                                           theexpandmenu.deletemenu;
                                        else
                                           OADPalette.reset;
                                       if);
                                   if)
                               if)
                            else
                               'Selected node does not contain an AttributeDeclOpt!'
                                 ->putline
                           if)
                        else
                           'Selection is not a non terminal node!'->putline
                       if)
                    else
                       'PartObjectHit: theDiagram is NONE'->putline
                   if)
                else
                   'PartObjectHit: CurrentFocus is NONE'->putline
               if)
           if);
       if)
   if)
#)  

-- RelationsMenuDynamicItem: DescriptorForm --
(# p: ^Page; op: ^OADPage; theConnector: ^op.DynamicItemConnector
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               &op.DynamicItemConnector[]->theConnector[];
               theConnector.InteractiveNew;
           if);
       if)
   if)
#)  

-- RelationsMenuDynamicComponent: DescriptorForm --
(# p: ^Page; op: ^OADPage; theConnector: ^op.DynamicComponentConnector
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               &op.DynamicComponentConnector[]->theConnector[];
               theConnector.InteractiveNew;
           if);
       if)
   if)
#)  

-- RelationsMenuStaticItem: DescriptorForm --
(# p: ^Page; op: ^OADPage; theConnector: ^op.StaticItemConnector
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               &op.StaticItemConnector[]->theConnector[];
               theConnector.InteractiveNew;
           if);
       if)
   if)
#)  

-- RelationsMenuStaticComponent: DescriptorForm --
(# p: ^Page; op: ^OADPage; theConnector: ^op.StaticComponentConnector
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               &op.StaticComponentConnector[]->theConnector[];
               theConnector.InteractiveNew;
           if);
       if)
   if)
#)  

-- RelationsMenuGeneralization: DescriptorForm --
(# p: ^Page; op: ^OADPage; theConnector: ^op.GeneralizationConnector
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               &op.GeneralizationConnector[]->theConnector[];
               theConnector.InteractiveNew;
           if);
       if)
   if)
#)  

-- RelationsMenuSpecialization: DescriptorForm --
(# p: ^Page; op: ^OADPage; theConnector: ^op.SpecializationConnector
do
   currentpage->p[];
   (if p[] <> none then
       (if p.struc <= Palette## then
           'CurrentPage is a Palette'->putline;
        else
           (if p## <= ObjectPage## then
               'CurrentPage is an ObjectPage'->putline
            else
               p[]->op[];
               &op.SpecializationConnector[]->theConnector[];
               theConnector.InteractiveNew;
           if);
       if)
   if)
#)  

-- RelationsMenuInit: DescriptorForm --
(#
do
   (UserMenu6+1,'Static reference')->StaticItem.init;
   (UserMenu6+2,'Static component reference')->StaticComponent.init;
   (UserMenu6+3,'Dynamic reference')->DynamicItem.init;
   (* (UserMenu6+6,'Generalization')->Generalization.Init; *)
   (UserMenu6+4,'Dynamic component reference')->DynamicComponent.init;
   (UserMenu6+5,'-')->sep.init;
   (UserMenu6+7,'Specialization')->Specialization.Init;
   sep.disable
#)  

