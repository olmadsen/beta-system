ORIGIN '~beta/mps/astlevel';

--LIB: attributes--

FetchComments:
  (* Adapted from code in prettyprinter *)
  (# currentSubcomment: ^text;
     n: @integer;
     a: ^astinterface.ast;
  enter a[]
  do a.getNextComment->(currentSubcomment[],n);
     (if false then
         'FetchComments: '->screen.puttext; 
         currentSubcomment[] -> screen.puttext;
         ', n='->screen.puttext; n->screen.putint; newline;
     if);
     (if n
      // -2 then (* empty comment *)
      // -1 then (* empty subcomment *)
      // 0 then
         (if currentSubcomment[] <> none then
             INNER FetchComments;
         if)
      // 1 then
         (if currentSubcomment[] <> none then
             INNER FetchComments;
         if);
         loop:
           (# 
           do a.getNextComment->(currentSubcomment[],n);
              (if currentSubcomment[] <> none then
                  INNER FetchComments;
              if);
              (if n = 1 then restart loop if);
           #)         
      // 2 then (* finished *)
         (if currentSubcomment[] <> none then
             INNER FetchComments;
         if)
     if);
  #);
