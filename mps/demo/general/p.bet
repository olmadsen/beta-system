ORIGIN '~beta/mps/v5.2/astlevel';
INCLUDE '~beta/mps/v5.2/findgrammar'
--- program: descriptor ---
(# do #)
--- program: descriptorform ---
(# (* this program demonstrates how to open a fragmentfile.  If the text
    * representation of the file is the newest, the file will be parsed up
    *)
   ast: @astInterface
     (#
     #);
   fg: ^ast.fragmentGroup;
   fragmentName: ^text;
do (* (ast.trace.fragmentOpen,true) -> ast.trace.set;
    * (ast.trace.compactOpen,true) -> ast.trace.set;
    * (ast.trace.onParse,true) -> ast.trace.set;
    * (ast.trace.parser,true) -> ast.trace.set;
    * (ast.trace.getBinding,true) -> ast.trace.set;
    * (ast.trace.getBindingMark,true) -> ast.trace.set;
    *)
   ast.astLevelInit; (* initialize astlevel *)
   (* so we can find the grammars mentioned in
    * ~beta/grammars/v2.2/grammars.text
    *)
   (if NoOfArguments (* the commandline arguments *)
    //2 then
       2 -> arguments -> fragmentName[]
    else
       'Parse what file ? ' -> screen.putText;
       keyBoard.getLine -> fragmentName[]
   if);
   fragmentName[] -> ast.top.open
   (# parseErrors::< (# do 'parse errors!' -> screen.putLine; newline #);
      fatalParseError::<
	(# do
	   'fatal parse error!' -> msg.putText;
	   (if errNo
	    // 1 then 'Error no: 1'->msg.putLine
	    // 2 then 'Error no: 2'->msg.putLine
	    // 3 then 'Error no: 3'->msg.putLine
	    // 4 then 'Error no: 4'->msg.putLine
	    // 5 then 'Error no: 5'->msg.putLine
	    // 6 then 'Error no: 6'->msg.putLine
	    // 7 then 'Error no: 7'->msg.putLine
	    // 8 then 'Error no: 8'->msg.putLine
	    // 9 then 'Error no: 9'->msg.putLine
	    // 10 then 'Error no: 10' ->msg.putLine
	    else
	       'Error no: '->msg.puttext;
	       errNo->msg.putint;
	       msg.newline
	   if)
	#);
      writeAccessError::< (# do 'write acess error'->screen.putLine; newline #);
      writeAccessOnLstFileError::<
	(# do 'write acess error on .lst file'->screen.putLine; newline #);
      startingParsing::< (# do 'starting parsing!' -> screen.putLine #)
   #) -> fg[];
   fragmentName[] -> putText;
   (if fg[]//NONE then
       ' not found!' -> putLine
    else ' opened!' -> putLine
   if);
#)
