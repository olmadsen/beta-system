Changes log for ~beta/mps (The Metaprogramming System)
======================================================

=============================================================================
mps/v5.2

JLK: Fri Jul 18 12:26:24 MET DST 1997

Made yet another optimazation of scanIncludes (lightweight list)

JLK: Fri Jul 18 00:20:00 MET DST 1997

Removed operations 'algradyopen' and 'isreferenced' (old, unused).

Changed scanIncludes to be more effecient.  Now caches the include
list, and the fullname of these.  Implies changes in usages of
scanIncludes.

OLM: 18/06/97:	Changes in astparser for building AST for unexpanded
		nonterminal or slot to fix listZero problem


Removed GetBETAbindings operation (not used)

===============================================================================
	Changes in release 4.0.1
===============================================================================
Sun Jan 19 13:02:24 MET 1997

Corrected exception handling code in astparser.bet such that AST
overflow etc. exceptions are propagated properly to higher levels.

Sat Jan 18 23:29:24 MET 1997

Corrected error in newAstForParser that made it imply index out of
range errors in the case of extendA only allocating exactly what was
needed.

Sat Jan 05 22:20:00 MET 1997: /jlk

Updated astparser.bet such that it now reports syntaxerror on SLOTs like:

<<SLOT xxxfoo4: hhh: dopart>> and <<SLOT:xxxfoo5: dopart>>


Fri Jan 03 24:00:00 MET 1997: /jlk

Divided astBody.bet into two files: astBody.bet and fragBody.bet 
to avoid problems on SNAKE platform.

Tue Nov 26 15:40:55 MET 1996:	/jlk+ess

During the last 1-2 weeks, we have made numerous changes in MPS in
order to remove several bugs related to grammar initialisation, and in
that process, we have streamlined grammar initialisation immensely.

These changes are mostly done without interface changes, but a few
have been necessary.

Most importantly, the applGram.bet fragment have now become OBSOLETE,
and should not be used any more.

Secondly, a new fragment:
grammarinit.bet 
have been introduced.  It implements all functionality needed for
initialising grammars, including the famous beta-grammar :-)

grammarinit.bet defines two new treelevel operations:

grammarinit
and	betagrammarinit.

If you have a ordinary grammar (i.e. a treelevel object), you can
initialise it using:

(location[],name[],error[])->t.grammarinit; 

where location is a text, containing the grammar file containing the
grammar, and name is a text, containing the name of the grammar, and
finally error is a stream onto which possible error messages might be
written.

E.g.:

mylangCFL: @treelevel;
...
('~beta/grammars/mylang/v1.2/mylang','mylang',screen[])
  ->mylangCFL.grammarInit
    (#
       MPSerror::
	 (# do (failure,msg[])->stop #);
       noParserAvailable::
	 (# do (failure,msg[])->stop #)
    #)


If t represents a beta grammar, you should use:

(location[],name[],error[])->t.betagrammarinit; 

instead to be sure, that the beta grammar is initialised properly for
use by all MBS beta-specific tools.

It should be noted, that if you are using grammarTable.find, the
grammar will automatically be initialized using grammarinit, as
described above.

It should be noted, that the exception handling for operations:
grammarTable.find
and 	findgrammar - fragment

have been changed slightly.  Please consult the interface files for
details.

===============================================================================
	Changes in v5.1
===============================================================================

Added trace on top.close and fg.close (trace.topClose and trace.fragmentClose).

Indført error:: (# do true->continue, (..)->theCatcher #) i alle
file.entry.exists, etc. for at fange diverse file fejl (såsom 'stale NFS
handle') under disse operationer.

Fjernet overflødige ::< (rettet til ::).

Rettet i astPrivate.fragmentListDescriptorPrivate.repRestore for at
sikre, at doubleDeclarationForm bliver kaldt ved unpack, selv om der
ikke parses.

Rettet fejl i fragmentgroupparser, der bet|d, at EOF blev opfattet som
legal end-of-string "'".

Rettet fejl i astPrivate.newAstForParser, som kunne give Repetition
index out of range fejl ved for store ast'er.

Rettet i astPrivate.newLexemTextForParser, som ogs} kunne give
Repetition index out of range fejl ved for store ast'er.  Rettelserne
retter m}ske ikke fejlen, men fejlen er meget vanskelig at
reproducere.  Den foretagne rettelse er mere en 'oprensning', som vil
kunne undg} fejl (men m}ske ikke denne :-().

Rettet fejl i newScan, herunder flyttet "predefined:< ..." ud i
interfacet til newscan.

Introduces usual MPS errorhandling in
	fg.saveAs, fg.saveBackup, fg.restoreBackup, fg.realOpen

Removed ...body: from all fragment form names (redundant).

Introduced use of currentDirectory directly from pathhandler.

Introduced simple-if everywhere.

Changed (if 1//1 then ... if) to (# do ... #) everywhere.

Based on basiclib/v1.5.

===============================================================================
		Changes in v4.9.1-v5.0.1
===============================================================================

No changes have been written down :-(

===============================================================================
		Changes in v4.9
===============================================================================

This release have mostly been modified to fix bugs and raise the efficiency of
the MPS operations.

astlevel.bet
============

One new operation have been added: namedClose.  namedClose can be used to close
a fragment, even in the case where you do not have any BETA reference to the
framgent but only know the name of the fragment.

The operation: indexToNode have been augmented with three exception patterns:
grammarGenArrayError, noSymbol and indexOutOfRange.  These exceptions are
raised in responce to the various errors taht can arise when trying to convert
an ast index to an ast reference.

Three net attributes have been added: astFileExtension, ppFileExtension, and
parserFileExtension.  These operations return the file name extensions to be
expected for the three different file types.

===============================================================================
		Changes in v4.8
===============================================================================

astlevel.bet
============

All scanning operations in astlevel (scan, suffixwalk, etc.) have been changed
to conform to the standard naming convention for scanning operations, namely
that the current element during the scan is called 'current'.  In the pre-v4.8
versions of mps, these variables were called thisElm, thisFragment, thisGroup,
or similar.

A virtual: astOverflow is introduced in ast.copy.  It is invoked if the
internal representation of the AST overflow's.

A new attribute: isOpen is introduced in the fragment pattern.  It returns
true, if the fragment have been opened (and not closed yet).

A new attribute: alreadyOpen is introduced in the fragmentGroup pattern.  It
returns true if the local fragment is already open in this fragment group.

A test for empty localPath is inserted in fragmentGroup.open to avoid errors
later in the processing of fragmentGroup.open.

Fragment.bind is changed such that it automatically tryes to setupOrigin, if
origin is not set previous to the invocation of bind, and the fragment is not
found in this fragment.

FragmentGroup.setupOrigin have been moved up the inheritance hierarchy to
fragment.setupOrigin.

In fragmentGroup.open, it is ensured, that parsing is not done when the file
name contain the grammar file-extension (e.g. .bet for BETA source files such
as xx.bet) - except naturally is the .group-file is older that the source file.

In fragmentGroup.fragmentList.open, it is ensured that the name of
fragmentforms is checked non-case-sensitible.

In fragmentGroup.fragmentList.open, the diskRepresentation is now checked, if
the fragment have been closed since last open.  This is done in order to ensure
that changes made by other tools are reflected now.

In general, many places in the files, tests for read or write access have been
inserted to ensure that no runtime errors should occur due to access problems
to files and directories.

In fragmentForm.indexToNode several runtime test have been inserted to avoid
'nasty' runtime errors due to invalid index'es.

treelevel.init now initializes the genRefArray structure such that 'nasty'
errors does not later occur in indexToNode.

defaultGrammarFinder is a new attribute of astIntergace.  It is a virtual
defining the defauld grammar finder installed during initialization of
astInterface.  Further binding this virtual will install your preferred grammar
finder.

GrammarMissing have been augmented with a few attributes to allow for
registrering grammars and for getting access to the fragmentForm containing the
registered grammars.  Registrering of grammars is now automated through
astLevelInit.

The two changes above imply, that you use one of three possible ways to install
grammars:
	(1) create MPS using:
		ast: @astInterface(# defaultGrammarFinder::< findgrammar #)
	    This is the preferred method for v4.8 and later of MPS.
	(2) or the equivalent:
		astInterface
		  (# defaultGrammarFinder::< findgrammar
                  ...
                  #)
	(3) create MPS the 'old' way:
		ast: @astInterface;
	   and then later install your grammarFinder:
		&findgrammar[]->grammarMissing[];
	   and then register the grammars explicitly:
		grammarMissing.registerGrammars;
	   This is available for 'backward compability' with pre-v4.8 usages of
	   MPS.

An options mechanism have been introduced to control the various workings of
MPS.  Currently only one option is defined (more may be added in the futures).
The optione mechanism is in the form of a new attribute: options, on the
astInterface pattern.  Herein one optin is currently defined: forceParse.  If
	true->options.forceParse 
is executed, MPS will force parsing of all fragments being opened hereafter
(that is, fragments not already opened at that time).

findgrammar.bet
===============

notFound is turned into an exception, not a notification.

A new exception: noRegisteredGrammars is introduced to make it possible to
catch problems with no grammars registered.  If no grammars are registered, MPS
has no way to understand the files to be parsed or loaded.

Two new attriibutes are introduced: grammarsPATH and metaGrammarFile.
   grammarPATH is used to specify the location of the grammars files
(containing the list of valid grammars).  By default, this is initialized to
seek for grammars in current directory, ./.MBSgrammars, ~/.MBSgrammars, and the
standard configuration file from the Mjolner BETA System.
   metaGrammarFile is used to specify the location of the meta-grammar file
(containing the grammar definition grammar).

fragmentgroupparser.bet
=======================

The syntax of fragment groups have been relaxed slightly, since the surrounding
[[ and --]] are made optional, if the fragment group is the only group in the
fragment file.

property.bet
============

The interface to most operations in this fragment have been changed such that
the interface uses text-references instead of text-values.
