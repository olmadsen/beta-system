ORIGIN '../notifications';
INCLUDE 'astPrivate';
lib_item 'mps';
-- handleGetHandle: DoPart --
do &handleType[]->h[]; h[]->private.handles.append  

-- handleIgnoreHandle: DoPart --
do h[]->private.handles.at->private.handles.delete  

-- handleActivateHandle: DoPart --
do (if not (h[]->private.handles.has) then h[]->private.handles.append if)  

-- handleSignal: DoPart --
do
   start;
   private.handles.scan (* abstract superpattern *)
     (#
        where:: 
          (# 
          do
             THIS(signal).where and not ((fg[],ff[],node[])->current.ignore)
               ->value
          #);
        
     do current[]->THIS(signal).current[]; INNER signal
     #)  

-- fgPrivate: Descriptor --
(#
   groupSubject: @subject (# observerType:: fragmentGroupObserver #);
   no: @integer;
   
#)  

-- notificationsFragmentGroupAttachObserver: DoPart --
do
   theObserver[]->private.groupSubject.attach;
   THIS(FragmentGroup)[]->theObserver.group[];
   private.no+1->private.no->theObserver.no;
     

-- notificationsFragmentGroupDetachObserver: DoPart --
do theObserver[]->private.groupSubject.detach  

-- fragmentGroupSubjectNotify: DoPart --
do
   before;
   private.groupSubject.notify
     (#  do current[]->THIS(notify).current[]; INNER notify #);
   after  

-- fragmentGroupSubjectNotifyAs: DoPart --
do
   before;
   private.groupSubject.observers.scan
     (# 
     do
        (if current## <= type## then
            current[]->THIS(notifyAs).current[]; INNER notifyAs; 
        if);
        
     #);
   after;
     

-- ffPrivate: Descriptor --
(#
   fragSubject: @subject (# observerType:: fragmentFormObserver #);
   no: @integer;
   
#)  

-- notificationsFragmentFormAttachObserver: DoPart --
do
   theObserver[]->private.fragSubject.attach;
   THIS(FragmentForm)[]->theObserver.frag[];
   private.no+1->private.no->theObserver.no;
     

-- notificationsFragmentFormDetachObserver: DoPart --
do theObserver[]->private.fragSubject.detach  

-- fragmentFormSubjectNotify: DoPart --
do
   before;
   private.fragSubject.notify
     (#  do current[]->THIS(notify).current[]; INNER notify #);
   after  

-- fragmentFormSubjectNotifyAs: DoPart --
do
   before;
   private.fragSubject.observers.scan
     (# 
     do
        (if current## <= type## then
            current[]->THIS(notifyAs).current[]; INNER notifyAs; 
        if);
        
     #);
   after;
     

