ORIGIN '~beta/win32lib/v1.6/ntitypes';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1994-97
 *       All rights reserved.
 *)
MAKE default 'private/external/commctrl_misc.make';
OBJFILE default 'private/$/commctrl_misc.obj';
INCLUDE '~beta/win32lib/v1.6/windowmanagement';
INCLUDE '~beta/win32lib/v1.6/winuserconsts';
INCLUDE '~beta/win32lib/v1.6/errorhandling';
INCLUDE '~beta/sysutils/v1.6/cstring';
-- Lib: Attributes --

SendMessage2: external
  (# hwnd: @integer; 
     uMsg: @integer; 
     wParam: @integer; 
     lParam: ^cStruct; 
     out: @integer; (* LRESULT *)
  enter (hwnd,uMsg,wParam,lParam[])
  do 'SendMessageA' -> callStd;
  exit out
  #);

InitCommonControls: external
  (# 
  do callStd;
  #);

(* makeLparam: external
 *   (# a,b: @integer;
 *      result: @integer;
 *   do callC
 *   exit result
 *   #);
 *)
HINST_COMMCTRL:  (# exit -1 #);
IDB_STD_SMALL_COLOR: (# exit      0 #);

(***** COMMON CONTROL STYLES ************************)
CCS_ADJUSTABLE:   (# exit           0x00000020 #);

(********* COMMON CONTROL STYLES end *****************)

ODT_HEADER:   (# exit 100 #);
ODT_TAB:      (# exit 101 #);
ODT_LISTVIEW: (# exit 102 #);

(* Ranges for control message IDs *)

LVM_FIRST: (# exit 16x1000 #);     (* ListView messages *)
TV_FIRST: (# exit 16x1100 #);      (* TreeView messages *)
HDM_FIRST: (# exit 16x1200 #);     (* Header messages *)

(*==== Generic WM_NOTIFY notification codes ===============================*)

NM_OUTOFMEMORY: (# exit          (NM_FIRST-1) #);
NM_CLICK: (# exit                (NM_FIRST-2) #);
NM_DBLCLK: (# exit               (NM_FIRST-3) #);
NM_RETURN: (# exit               (NM_FIRST-4) #);
NM_RCLICK: (# exit               (NM_FIRST-5) #);
NM_RDBLCLK: (# exit              (NM_FIRST-6) #);
NM_SETFOCUS: (# exit             (NM_FIRST-7) #);
NM_KILLFOCUS: (# exit            (NM_FIRST-8) #);


(*====== WM_NOTIFY codes (NMHDR.code values) ==============================*)

NM_FIRST: (# exit 0 #); (* generic to all controls *)
NM_LAST:  (# exit -99 #);

LVN_FIRST: (# exit -100 #); (* listview *)
LVN_LAST:  (# exit -199 #);

TVN_FIRST: (# exit    -400 #);     (* treeview *)
TVN_LAST: (# exit     -499 #);

TTN_FIRST: (# exit               -520   #);    (* tooltips *)
TTN_LAST: (# exit                -549   #);

(* ====== IMAGE APIS ========================================== *)

CLR_NONE: (# exit 16xFFFFFFFF #);
CLR_DEFAULT: (# exit 16xFF000000 #);

ImageList_Create: external
  (# cx, cy, flags, cInitial, cGrow: @integer;
     theImageList: @integer;
  enter (cx, cy, flags, cInitial, cGrow)
  do callStd
  exit theImageList
  #);

ImageList_Destroy: external
  (# himl: @integer;
     result: @integer; (* BOOL *)
  enter himl
  do callStd;
  exit result
  #);
ImageList_GetImageCount: external
  (# himl: @integer;
     count: @integer;
  enter himl
  do callStd;
  exit count
  #);
ImageList_Add: external
  (# himl, hbmImage, hbmMask: @integer;
     result: @integer;
  enter (himl, hbmImage, hbmMask)
  do callStd
  exit result
  #);
ImageList_ReplaceIcon: external
  (# himl, i, hicon: @integer;
     result: @integer;
  enter (himl, i, hicon)
  do callStd;
  exit result
  #);

ImageList_SetBkColor: external
  (# himl, clrBk: @integer;
     prevClrBk: @integer;
  enter (himl, clrBk)
  do callStd;
  exit prevClrBk
  #);
ImageList_GetBkColor: external
  (# himl: @integer;
     clrBk: @integer;
  enter himl
  do callStd;
  exit clrBk
  #);
ImageList_SetOverlayImage: external
  (# himl, iImage, iOverlay: @integer;
     result: @integer; (* BOOL *)
  enter (himl, iImage, iOverlay)
  do callStd
  exit result
  #);
ImageList_AddIcon:
  (# himl, hicon: @integer;
     result: @integer;
  enter (himl, hicon)
  do (himl, -1, hicon) -> ImageList_ReplaceIcon -> result;
  exit result
  #);

ILD_NORMAL: (# exit         16x0000 #);
ILD_TRANSPARENT: (# exit      16x0001 #);
ILD_MASK: (# exit             16x0010 #);
ILD_IMAGE: (# exit            16x0020 #);
ILD_BLEND25: (# exit          16x0002 #);
ILD_BLEND50: (# exit          16x0004 #);
ILD_OVERLAYMASK: (# exit      16x0F00 #);
                    (* INDEXTOOVERLAYMASK(i)   ((i) << 8) *)

ILD_SELECTED: (# exit             ILD_BLEND50 #);
ILD_FOCUS: (# exit                ILD_BLEND25 #);
ILD_BLEND: (# exit                ILD_BLEND50 #);
CLR_HILIGHT: (# exit              CLR_DEFAULT #);


(* LISTVIEW CONTROL *)
SetView: external
  (# hWnd: @integer;
     newView: @integer;
  enter (hWnd, newView)
  do 'SetView' -> callC;
  #);

LVS_ICON: (# exit 16x0000 #);
LVS_REPORT: (# exit 16x0001 #);
LVS_SMALLICON: (# exit 16x0002 #);
LVS_LIST: (# exit 16x0003 #);
LVS_TYPEMASK: (# exit 16x0003 #);
LVS_SINGLESEL: (# exit 16x0004 #);
LVS_SHOWSELALWAYS: (# exit 16x0008 #);
LVS_SORTASCENDING: (# exit 16x0010 #);
LVS_SORTDESCENDING: (# exit 16x0020 #);
LVS_SHAREIMAGELISTS: (# exit 16x0040 #);
LVS_NOLABELWRAP: (# exit 16x0080 #);
LVS_AUTOARRANGE: (# exit 16x0100 #);
LVS_EDITLABELS: (# exit 16x0200 #);
LVS_NOSCROLL: (# exit 16x2000 #);

LVS_TYPESTYLEMASK: (# exit 16xfc00 #);

LVS_ALIGNTOP: (# exit 16x0000 #);
LVS_ALIGNLEFT: (# exit 16x0800 #);
LVS_ALIGNMASK: (# exit 16x0c00 #);

LVS_OWNERDRAWFIXED: (# exit 16x0400 #);
LVS_NOCOLUMNHEADER: (# exit 16x4000 #);
LVS_NOSORTHEADER: (# exit 16x8000 #);

LVM_GETBKCOLOR: (# exit (LVM_FIRST + 0) #);

(* ListView_GetBkColor(hwnd)  \
 *     (COLORREF)SendMessage((hwnd), LVM_GETBKCOLOR, 0, 0L)
 * 
 * LVM_SETBKCOLOR          (LVM_FIRST + 1)
 * ListView_SetBkColor(hwnd, clrBk) \
 *     (BOOL)SendMessage((hwnd), LVM_SETBKCOLOR, 0, (LPARAM)(COLORREF)(clrBk))
 * 
 * LVM_GETIMAGELIST        (LVM_FIRST + 2)
 * ListView_GetImageList(hwnd, iImageList) \
 *     (HIMAGELIST)SendMessage((hwnd), LVM_GETIMAGELIST, (WPARAM)(INT)(iImageList), 0L)
 * 
 *)

LVSIL_NORMAL: (# exit 0 #);
LVSIL_SMALL: (# exit 1 #);
LVSIL_STATE: (# exit 2 #);

ILC_MASK: (# exit             16x0001 #);
ILC_COLOR: (# exit            16x0000 #);
ILC_COLORDDB: (# exit         16x00FE #);
ILC_COLOR4: (# exit           16x0004 #);
ILC_COLOR8: (# exit           16x0008 #);
ILC_COLOR16: (# exit          16x0010 #);
ILC_COLOR24: (# exit          16x0018 #);
ILC_COLOR32: (# exit          16x0020 #);
ILC_PALETTE: (# exit          16x0800 #);


LVM_SETIMAGELIST: (# exit (LVM_FIRST + 3) #);
ListView_SetImageList:
  (# hwnd, himl, iImageList: @integer;
     result: @integer;
  enter (hwnd, himl, iImageList)
  do (hwnd, LVM_SETIMAGELIST,iImageList,himl)->SendMessage->result;
  exit result
  #);


(* ListView_SetImageList(hwnd, himl, iImageList) \
 *     (HIMAGELIST)(UINT)SendMessage((hwnd), LVM_SETIMAGELIST, (WPARAM)(iImageList), (LPARAM)(UINT)(HIMAGELIST)(himl))
 * 
 * LVM_GETITEMCOUNT        (LVM_FIRST + 4)
 * ListView_GetItemCount(hwnd) \
 *     (int)SendMessage((hwnd), LVM_GETITEMCOUNT, 0, 0L)
 *)
 
LVIF_TEXT: (# exit 16x0001 #);
LVIF_IMAGE: (# exit 16x0002 #);
LVIF_PARAM: (# exit 16x0004 #);
LVIF_STATE: (# exit  16x0008 #);

LVIS_FOCUSED: (# exit 16x0001 #);
LVIS_SELECTED: (# exit 16x0002 #);
LVIS_CUT: (# exit 16x0004 #);
LVIS_DROPHILITED: (# exit 16x0008 #);

LVIS_OVERLAYMASK: (# exit 16x0F00 #);
LVIS_STATEIMAGEMASK: (# exit 16xF000 #);
(*
 * 
 * #define INDEXTOSTATEIMAGEMASK(i) ((i) << 12)
 * 
 * typedef struct _LV_ITEMA
 * {
 *     UINT mask;
 *     int iItem;
 *     int iSubItem;
 *     UINT state;
 *     UINT stateMask;
 *     LPSTR pszText;
 *     int cchTextMax;
 *     int iImage;
 *     LPARAM lParam;
 * } LV_ITEMA;
 *)
LV_ITEMA: cstruct
  (# bytesize::< (# do 36 -> value; #);
     mask: @long (# pos::< (# do 0 -> value; #); #); 
     iItem: @long (# pos::< (# do 4 -> value; #); #); 
     iSubItem: @long (# pos::< (# do 8 -> value; #); #);  
     state: @long (# pos::< (# do 12 -> value; #); #);  
     stateMask: @long (# pos::< (# do 16 -> value; #); #);   
     pszText: @long (# pos::< (# do 20 -> value; #); #);       
     cchTextMax: @long (# pos::< (# do 24 -> value; #); #);
     iImage: @long (# pos::< (# do 28 -> value; #); #);
     lParam: @long (# pos::< (# do 32 -> value; #); #);
  #);
(* typedef struct _LV_ITEMW
 * {
 *     UINT mask;
 *     int iItem;
 *     int iSubItem;
 *     UINT state;
 *     UINT stateMask;
 *     LPWSTR pszText;
 *     int cchTextMax;
 *     int iImage;
 *     LPARAM lParam;
 * } LV_ITEMW;
 * 
 * #ifdef UNICODE
 * #define LV_ITEM    LV_ITEMW
 * #else
 * #define LV_ITEM    LV_ITEMA
 * #endif
 * 
 * #define LPSTR_TEXTCALLBACKW     ((LPWSTR)-1L)
 * #define LPSTR_TEXTCALLBACKA     ((LPSTR)-1L)
 * #ifdef UNICODE
 * #define LPSTR_TEXTCALLBACK      LPSTR_TEXTCALLBACKW
 * #else
 * #define LPSTR_TEXTCALLBACK      LPSTR_TEXTCALLBACKA
 * #endif
 * 
 * #define I_IMAGECALLBACK         (-1)
 *) 

LVM_GETITEMA: (# exit (LVM_FIRST + 5) #);
ListView_GetItem:
  (# hwnd: @integer;
     pitem: ^LV_ITEMA;
     result: @integer;
     temp: @integer;
  enter (hwnd, pitem[]) 
  do LVM_GETITEMA -> temp;
     (hwnd, temp, 0, pitem[]) -> SendMessage2 -> result;
  exit result
  #);


 (* #define LVM_GETITEMA            (LVM_FIRST + 5)
 * #define LVM_GETITEMW            (LVM_FIRST + 75)
 * #ifdef UNICODE
 * #define LVM_GETITEM             LVM_GETITEMW
 * #else
 * #define LVM_GETITEM             LVM_GETITEMA
 * #endif
 * 
 * #define ListView_GetItem(hwnd, pitem) \
 *     (BOOL)SendMessage((hwnd), LVM_GETITEM, 0, (LPARAM)(LV_ITEM FAR*}(pitem))
 * 
 * 
 * #define LVM_SETITEMA            (LVM_FIRST + 6)
 * #define LVM_SETITEMW            (LVM_FIRST + 76)
 * #ifdef UNICODE
 * #define LVM_SETITEM             LVM_SETITEMW
 * #else
 * #define LVM_SETITEM             LVM_SETITEMA
 * #endif
 * 
 * #define ListView_SetItem(hwnd, pitem) \
 *     (BOOL)SendMessage((hwnd), LVM_SETITEM, 0, (LPARAM)(const LV_ITEM FAR*}(pitem))
 * 
  *)

LVM_SETITEM: (# exit LVM_FIRST + 6 #);

ListView_SetItem:
  (# hwnd, pitem: @integer;
     res: @integer;
  enter (hwnd, pitem)
  do (hwnd, LVM_SETITEM, 0, pitem) -> SendMessage -> res;
  exit res
  #);

LVM_INSERTITEM: (# exit LVM_FIRST + 7 #);
ListView_InsertItem:
  (# hwnd: @integer; 
     pitem: ^LV_ITEMA;
     temp_LVM_INSERTITEM: @integer;
     result: @integer;
  enter (hwnd, pitem[])  
  do LVM_INSERTITEM -> temp_LVM_INSERTITEM;
     (hwnd, temp_LVM_INSERTITEM, 0, pitem[])
       -> SendMessage2 -> result;
     
     (if result=-1 then
         'ListView_InsertItem: ' -> screen.putText;
         'Error= ' -> puttext;
         GetLastError -> putint; newline;
     if);
  exit result
  #);

LVM_DELETEITEM: (# exit (LVM_FIRST + 8) #);
ListView_DeleteItem:
  (# hwnd: @integer; (* Handle to the list view control. *)
     iItem: @integer; (* Index of the list view item to delete. *)
     result: @integer; (* Returns TRUE(1) if successful or FALSE(0) 
                        * otherwise. *)
  enter (hwnd, iItem)
  do ((hwnd), LVM_DELETEITEM, iItem, 0) -> SendMessage -> result;
  exit result
  #);

LVM_DELETEALLITEMS: (# exit (LVM_FIRST + 9) #);
ListView_DeleteAllItems:
  (# hwnd: @integer; (* Handle to the list view control. *)
     result: @integer; (* Returns TRUE(1) if successful or FALSE(0) 
                        * otherwise. *)
  enter hwnd
  do (hwnd, LVM_DELETEALLITEMS, 0, 0) -> SendMessage -> result;
  #);


 (* #define LVM_INSERTITEMW         (LVM_FIRST + 77)
 * #ifdef UNICODE
 * #define LVM_INSERTITEM          LVM_INSERTITEMW
 * #else
 * #define LVM_INSERTITEM          LVM_INSERTITEMA
 * #endif
 * #define ListView_InsertItem(hwnd, pitem)   \
 *     (int)SendMessage((hwnd), LVM_INSERTITEM, 0, (LPARAM)(const LV_ITEM FAR*}(pitem))
 * 
 * 
 * #define LVM_DELETEITEM          (LVM_FIRST + 8)
 * #define ListView_DeleteItem(hwnd, i) \
 *     (BOOL)SendMessage((hwnd), LVM_DELETEITEM, (WPARAM)(int)(i), 0L)
 * 
 * 
 * #define LVM_DELETEALLITEMS      (LVM_FIRST + 9)
 * #define ListView_DeleteAllItems(hwnd) \
 *     (BOOL)SendMessage((hwnd), LVM_DELETEALLITEMS, 0, 0L)
 * 
 * 
 * #define LVM_GETCALLBACKMASK     (LVM_FIRST + 10)
 * #define ListView_GetCallbackMask(hwnd) \
 *     (BOOL)SendMessage((hwnd), LVM_GETCALLBACKMASK, 0, 0)
 * 
 * 
 * #define LVM_SETCALLBACKMASK     (LVM_FIRST + 11)
 * #define ListView_SetCallbackMask(hwnd, mask) \
 *     (BOOL)SendMessage((hwnd), LVM_SETCALLBACKMASK, (WPARAM)(UINT)(mask), 0)
 * 
 *) 
 (* #define LVNI_ALL                16x0000
 * #define LVNI_FOCUSED            16x0001
 * #define LVNI_SELECTED           16x0002
 * #define LVNI_CUT                16x0004
 * #define LVNI_DROPHILITED        16x0008
 * 
 * #define LVNI_ABOVE              16x0100
 * #define LVNI_BELOW              16x0200
 * #define LVNI_TOLEFT             16x0400
 * #define LVNI_TORIGHT            16x0800
 * 
  *)
LVNI_ALL: (# exit                 16x0000 #);
LVNI_FOCUSED: (# exit             16x0001 #);
LVNI_SELECTED: (# exit            16x0002 #);
LVNI_CUT: (# exit                 16x0004 #);
LVNI_DROPHILITED: (# exit         16x0008 #);
 
LVNI_ABOVE: (# exit               16x0100 #);
LVNI_BELOW: (# exit               16x0200 #);
LVNI_TOLEFT: (# exit              16x0400 #);
LVNI_TORIGHT: (# exit             16x0800 #);

LVM_GETNEXTITEM: (# exit (LVM_FIRST + 12) #);
ListView_GetNextItem:
  (# hwnd, i, flags: @integer;
     result: @integer;
  enter (hwnd, i, flags) 
  do (hwnd, LVM_GETNEXTITEM, i, flags) -> SendMessage -> result;
  exit result
  #);

(* #define LVM_GETNEXTITEM         (LVM_FIRST + 12)
 * #define ListView_GetNextItem(hwnd, i, flags) \
 *     (int)SendMessage((hwnd), LVM_GETNEXTITEM, (WPARAM)(int)(i), MAKELPARAM((flags), 0))
 * 
 *) 

LVFI_PARAM: (# exit               16x0001 #);
LVFI_STRING: (# exit              16x0002 #);
LVFI_PARTIAL: (# exit             16x0008 #);
LVFI_WRAP: (# exit                16x0020 #);
LVFI_NEARESTXY: (# exit           16x0040 #);

LV_FINDINFOA: cStruct
  (# bytesize::< (# do 24 -> value; #);
     flags: @long (# pos::< (# do 0 -> value; #); #); 
     psz: @long (# pos::< (# do 4 -> value; #); #); ;
     lParam: @long (# pos::< (# do 8 -> value; #); #);
     pt: @
       (# x: @long (# pos::< (# do 12 -> value #); #);
          y: @long (# pos::< (# do 16 -> value #); #);
       enter (x,y)
       exit (x,y)
       #);
     vkDirection: @long (# pos::< (# do 20 -> value; #); #);
  #);

LVM_FINDITEMA: (# exit    (LVM_FIRST + 13) #);

 (* #define LVFI_PARAM              16x0001
 * #define LVFI_STRING             16x0002
 * #define LVFI_PARTIAL            16x0008
 * #define LVFI_WRAP               16x0020
 * #define LVFI_NEARESTXY          16x0040
 * 
 * typedef struct _LV_FINDINFOA
 * {
 *     UINT flags;
 *     LPCSTR psz;
 *     LPARAM lParam;
 *     POINT pt;
 *     UINT vkDirection;
 * } LV_FINDINFOA;
 * 
 * typedef struct _LV_FINDINFOW
 * {
 *     UINT flags;
 *     LPCWSTR psz;
 *     LPARAM lParam;
 *     POINT pt;
 *     UINT vkDirection;
 * } LV_FINDINFOW;
 * 
 * #ifdef UNICODE
 * #define  LV_FINDINFO            LV_FINDINFOW
 * #else
 * #define  LV_FINDINFO            LV_FINDINFOA
 * #endif
 * 
 * #define LVM_FINDITEMA           (LVM_FIRST + 13)
 * #define LVM_FINDITEMW           (LVM_FIRST + 83)
 * #ifdef UNICODE
 * #define  LVM_FINDITEM           LVM_FINDITEMW
 * #else
 * #define  LVM_FINDITEM           LVM_FINDITEMA
 * #endif
  *) 

ListView_FindItem:
  (# hwnd, iStart: @integer; 
     plvfi: ^LV_FINDINFOA;
     result: @integer;
     temp: @integer;
  enter (hwnd, iStart, plvfi[])
  do LVM_FINDITEMA -> temp;
     (hwnd, temp, iStart, plvfi[]) -> SendMessage2 -> result;
  exit result
  #);


 (* #define ListView_FindItem(hwnd, iStart, plvfi) \
 *     (int)SendMessage((hwnd), LVM_FINDITEM, (WPARAM)(int)(iStart), (LPARAM)(const LV_FINDINFO FAR*}(plvfi))
 * 
 * #define LVIR_BOUNDS             0
 * #define LVIR_ICON               1
 * #define LVIR_LABEL              2
 * #define LVIR_SELECTBOUNDS       3
 * 
 * 
 * #define LVM_GETITEMRECT         (LVM_FIRST + 14)
 * #define ListView_GetItemRect(hwnd, i, prc, code) \
 *      (BOOL)SendMessage((hwnd), LVM_GETITEMRECT, (WPARAM)(int)(i), \
 *            ((prc) ? (((RECT FAR *}(prc))->left = (code),(LPARAM)(RECT FAR*}(prc)) : (LPARAM)(RECT FAR*}NULL))
 * 
 * 
 * #define LVM_SETITEMPOSITION     (LVM_FIRST + 15)
 * #define ListView_SetItemPosition(hwndLV, i, x, y) \
 *     (BOOL)SendMessage((hwndLV), LVM_SETITEMPOSITION, (WPARAM)(int)(i), MAKELPARAM((x), (y)))
 * 
 * 
 * #define LVM_GETITEMPOSITION     (LVM_FIRST + 16)
 * #define ListView_GetItemPosition(hwndLV, i, ppt) \
 *     (BOOL)SendMessage((hwndLV), LVM_GETITEMPOSITION, (WPARAM)(int)(i), (LPARAM)(POINT FAR*}(ppt))
 * 
 * 
 * #define LVM_GETSTRINGWIDTHA     (LVM_FIRST + 17)
 * #define LVM_GETSTRINGWIDTHW     (LVM_FIRST + 87)
 * #ifdef UNICODE
 * #define  LVM_GETSTRINGWIDTH     LVM_GETSTRINGWIDTHW
 * #else
 * #define  LVM_GETSTRINGWIDTH     LVM_GETSTRINGWIDTHA
 * #endif
 * 
 * #define ListView_GetStringWidth(hwndLV, psz) \
 *     (int)SendMessage((hwndLV), LVM_GETSTRINGWIDTH, 0, (LPARAM)(LPCTSTR)(psz))
 * 
  *) 

LVHT_NOWHERE: (# exit            16x0001 #);
LVHT_ONITEMICON: (# exit          16x0002 #);
LVHT_ONITEMLABEL: (# exit         16x0004 #);
LVHT_ONITEMSTATEICON: (# exit     16x0008 #);
LVHT_ONITEM: (# value: @integer;
             do (LVHT_ONITEMICON, LVHT_ONITEMLABEL) -> tos'%or' -> value;
                (LVHT_ONITEMSTATEICON,value) -> tos'%or' -> value;
             exit value
             #);
 
LVHT_ABOVE: (# exit               16x0008 #);
LVHT_BELOW: (# exit               16x0010 #);
LVHT_TORIGHT: (# exit             16x0020 #);
LVHT_TOLEFT: (# exit              16x0040 #);

LV_HITTESTINFO: cStruct
  (# bytesize::< (# do 16 -> value; #);
     pt: @
       (# x: @long (# pos::< (# do 0 -> value #); #);
          y: @long (# pos::< (# do 4 -> value #); #);
       enter (x,y)
       exit (x,y)
       #);
     flags: @long (# pos::< (# do 8 -> value; #); #); 
     iItem: @long (# pos::< (# do 12 -> value; #); #); ;
  #);

LVM_HITTEST: (# exit (LVM_FIRST + 18) #);
ListView_HitTest:
  (# hwndLV: @integer;
     pinfo: ^LV_HITTESTINFO;
     result: @integer;
     temp: @integer;
  enter (hwndLV, pinfo[]) 
  do LVM_HITTEST -> temp;
     (hwndLV, temp, 0, pinfo[]) -> SendMessage2 -> result;
  exit result
  #);
 
 
LVM_ENSUREVISIBLE: (# exit (LVM_FIRST + 19) #);
ListView_EnsureVisible:
  (# hwndLV, i, fPartialOK: @integer;
     result: @integer;
  enter (hwndLV, i, fPartialOK)
  do (hwndLV, LVM_ENSUREVISIBLE, i, fPartialOK) -> SendMessage -> result;
  exit result
  #);
 

 (* #define LVHT_NOWHERE            16x0001
 * #define LVHT_ONITEMICON         16x0002
 * #define LVHT_ONITEMLABEL        16x0004
 * #define LVHT_ONITEMSTATEICON    16x0008
 * #define LVHT_ONITEM             (LVHT_ONITEMICON | LVHT_ONITEMLABEL | LVHT_ONITEMSTATEICON)
 * 
 * #define LVHT_ABOVE              16x0008
 * #define LVHT_BELOW              16x0010
 * #define LVHT_TORIGHT            16x0020
 * #define LVHT_TOLEFT             16x0040
 * 
 * typedef struct _LV_HITTESTINFO
 * {
 *     POINT pt;
 *     UINT flags;
 *     int iItem;
 * } LV_HITTESTINFO;
 * 
 * #define LVM_HITTEST             (LVM_FIRST + 18)
 * #define ListView_HitTest(hwndLV, pinfo) \
 *     (int)SendMessage((hwndLV), LVM_HITTEST, 0, (LPARAM)(LV_HITTESTINFO FAR*}(pinfo))
 * 
 * 
 * #define LVM_ENSUREVISIBLE       (LVM_FIRST + 19)
 * #define ListView_EnsureVisible(hwndLV, i, fPartialOK) \
 *     (BOOL)SendMessage((hwndLV), LVM_ENSUREVISIBLE, (WPARAM)(int)(i), MAKELPARAM((fPartialOK), 0))
 * 
 * 
 * #define LVM_SCROLL              (LVM_FIRST + 20)
 * #define ListView_Scroll(hwndLV, dx, dy) \
 *     (BOOL)SendMessage((hwndLV), LVM_SCROLL, (WPARAM)(int)dx, (LPARAM)(int)dy)
 * 
 * 
 * #define LVM_REDRAWITEMS         (LVM_FIRST + 21)
 * #define ListView_RedrawItems(hwndLV, iFirst, iLast) \
 *     (BOOL)SendMessage((hwndLV), LVM_REDRAWITEMS, (WPARAM)(int)iFirst, (LPARAM)(int)iLast)
 * 
 * 
 * #define LVA_DEFAULT             16x0000
 * #define LVA_ALIGNLEFT           16x0001
 * #define LVA_ALIGNTOP            16x0002
 * #define LVA_SNAPTOGRID          16x0005
 * 
 * 
 * #define LVM_ARRANGE             (LVM_FIRST + 22)
 * #define ListView_Arrange(hwndLV, code) \
 *     (BOOL)SendMessage((hwndLV), LVM_ARRANGE, (WPARAM)(UINT)(code), 0L)
 * 
 * 
 * #define LVM_EDITLABELA          (LVM_FIRST + 23)
 * #define LVM_EDITLABELW          (LVM_FIRST + 118)
 * #ifdef UNICODE
 * #define LVM_EDITLABEL           LVM_EDITLABELW
 * #else
 * #define LVM_EDITLABEL           LVM_EDITLABELA
 * #endif
 * 
 * #define ListView_EditLabel(hwndLV, i) \
 *     (HWND)SendMessage((hwndLV), LVM_EDITLABEL, (WPARAM)(int)(i), 0L)
 * 
 * 
 * #define LVM_GETEDITCONTROL      (LVM_FIRST + 24)
 * #define ListView_GetEditControl(hwndLV) \
 *     (HWND)SendMessage((hwndLV), LVM_GETEDITCONTROL, 0, 0L)
 * 
 * 
 * typedef struct _LV_COLUMNA
 * {
 *     UINT mask;
 *     int fmt;
 *     int cx;
 *     LPSTR pszText;
 *     int cchTextMax;
 *     int iSubItem;
  * } LV_COLUMNA;
  *)
LV_COLUMNA: cstruct
  (# bytesize::< (# do 24 -> value; #);
     mask: @long (# pos::< (# do 0 -> value; #); #); 
     fmt: @long (# pos::< (# do 4 -> value; #); #); 
     cx: @long (# pos::< (# do 8 -> value; #); #);  
     pszText: @long (# pos::< (# do 12 -> value; #); #);  
     cchTextMax: @long (# pos::< (# do 16 -> value; #); #);   
     iSubItem: @long (# pos::< (# do 20 -> value; #); #);       
  #);

(* 
 * typedef struct _LV_COLUMNW
 * {
 *     UINT mask;
 *     int fmt;
 *     int cx;
 *     LPWSTR pszText;
 *     int cchTextMax;
 *     int iSubItem;
 * } LV_COLUMNW;
 * 
 * #ifdef UNICODE
 * #define  LV_COLUMN              LV_COLUMNW
 * #else
 * #define  LV_COLUMN              LV_COLUMNA
 * #endif
 * 
 *) 
LVCF_FMT: (# exit                16x0001 #);
LVCF_WIDTH: (# exit              16x0002 #);
LVCF_TEXT: (# exit               16x0004 #);
LVCF_SUBITEM: (# exit            16x0008 #);

LVCFMT_LEFT: (# exit             16x0000 #);
LVCFMT_RIGHT: (# exit            16x0001 #);
LVCFMT_CENTER: (# exit           16x0002 #);
LVCFMT_JUSTIFYMASK: (# exit      16x0003 #);
 
 (* 
 * #define LVM_GETCOLUMNA         (LVM_FIRST + 25)
 * #define LVM_GETCOLUMNW         (LVM_FIRST + 95)
 * #ifdef UNICODE
 * #define  LVM_GETCOLUMN          LVM_GETCOLUMNW
 * #else
 * #define  LVM_GETCOLUMN          LVM_GETCOLUMNA
 * #endif
 * 
 * #define ListView_GetColumn(hwnd, iCol, pcol) \
 *     (BOOL)SendMessage((hwnd), LVM_GETCOLUMN, (WPARAM)(int)(iCol), (LPARAM)(LV_COLUMN FAR*}(pcol))
 * 
 * 
 * #define LVM_SETCOLUMNA          (LVM_FIRST + 26)
 * #define LVM_SETCOLUMNW          (LVM_FIRST + 96)
 * #ifdef UNICODE
 * #define  LVM_SETCOLUMN          LVM_SETCOLUMNW
 * #else
 * #define  LVM_SETCOLUMN          LVM_SETCOLUMNA
 * #endif
 * 
 * #define ListView_SetColumn(hwnd, iCol, pcol) \
 *     (BOOL)SendMessage((hwnd), LVM_SETCOLUMN, (WPARAM)(int)(iCol), (LPARAM)(const LV_COLUMN FAR*}(pcol))
 * 
 * 
 * #define LVM_INSERTCOLUMNA       (LVM_FIRST + 27)
 * #define LVM_INSERTCOLUMNW       (LVM_FIRST + 97)
 * #ifdef UNICODE
 * #   define  LVM_INSERTCOLUMN    LVM_INSERTCOLUMNW
 * #else
 * #   define  LVM_INSERTCOLUMN    LVM_INSERTCOLUMNA
 * #endif
 * 
 * #define ListView_InsertColumn(hwnd, iCol, pcol) \
 *     (int)SendMessage((hwnd), LVM_INSERTCOLUMN, (WPARAM)(int)(iCol), (LPARAM)(const LV_COLUMN FAR*}(pcol))
 *)
LVM_INSERTCOLUMNA: (# exit LVM_FIRST + 27 #);
ListView_InsertColumn:
  (# hWnd: @integer;
     iCol: @integer;
     pcol: ^LV_COLUMNA;
     LVM_INSERTCOLUMN: @integer;
     result: @integer;
  enter (hwnd, iCol, pcol[])
  do LVM_INSERTCOLUMNA -> LVM_INSERTCOLUMN;
     (hwnd, LVM_INSERTCOLUMN, iCol,pcol[]) -> SendMessage2 -> result;
  exit result
  #);

(* 
 * #define LVM_DELETECOLUMN        (LVM_FIRST + 28)
 * #define ListView_DeleteColumn(hwnd, iCol) \
 *     (BOOL)SendMessage((hwnd), LVM_DELETECOLUMN, (WPARAM)(int)(iCol), 0)
 * 
 * 
 * #define LVM_GETCOLUMNWIDTH      (LVM_FIRST + 29)
 * #define ListView_GetColumnWidth(hwnd, iCol) \
 *     (int)SendMessage((hwnd), LVM_GETCOLUMNWIDTH, (WPARAM)(int)(iCol), 0)
 * 
 * 
 * #define LVSCW_AUTOSIZE              -1
 * #define LVSCW_AUTOSIZE_USEHEADER    -2
 * #define LVM_SETCOLUMNWIDTH          (LVM_FIRST + 30)
 * 
 * #define ListView_SetColumnWidth(hwnd, iCol, cx) \
 *     (BOOL)SendMessage((hwnd), LVM_SETCOLUMNWIDTH, (WPARAM)(int)(iCol), MAKELPARAM((cx), 0))
 * 
 * 
 * #define LVM_CREATEDRAGIMAGE     (LVM_FIRST + 33)
 * #define ListView_CreateDragImage(hwnd, i, lpptUpLeft) \
 *     (HIMAGELIST)SendMessage((hwnd), LVM_CREATEDRAGIMAGE, (WPARAM)(int)(i), (LPARAM)(LPPOINT)(lpptUpLeft))
 * 
 * 
 * #define LVM_GETVIEWRECT         (LVM_FIRST + 34)
 * #define ListView_GetViewRect(hwnd, prc) \
 *     (BOOL)SendMessage((hwnd), LVM_GETVIEWRECT, 0, (LPARAM)(RECT FAR*}(prc))
 * 
 * 
 * #define LVM_GETTEXTCOLOR        (LVM_FIRST + 35)
 * #define ListView_GetTextColor(hwnd)  \
 *     (COLORREF)SendMessage((hwnd), LVM_GETTEXTCOLOR, 0, 0L)
 * 
 * 
 * #define LVM_SETTEXTCOLOR        (LVM_FIRST + 36)
 * #define ListView_SetTextColor(hwnd, clrText) \
 *     (BOOL)SendMessage((hwnd), LVM_SETTEXTCOLOR, 0, (LPARAM)(COLORREF)(clrText))
 * 
 * 
 * #define LVM_GETTEXTBKCOLOR      (LVM_FIRST + 37)
 * #define ListView_GetTextBkColor(hwnd)  \
 *     (COLORREF)SendMessage((hwnd), LVM_GETTEXTBKCOLOR, 0, 0L)
 * 
 * 
 * #define LVM_SETTEXTBKCOLOR      (LVM_FIRST + 38)
 * #define ListView_SetTextBkColor(hwnd, clrTextBk) \
 *     (BOOL)SendMessage((hwnd), LVM_SETTEXTBKCOLOR, 0, (LPARAM)(COLORREF)(clrTextBk))
 * 
 * 
 * #define LVM_GETTOPINDEX         (LVM_FIRST + 39)
 * #define ListView_GetTopIndex(hwndLV) \
 *     (int)SendMessage((hwndLV), LVM_GETTOPINDEX, 0, 0)
 * 
 * 
 * #define LVM_GETCOUNTPERPAGE     (LVM_FIRST + 40)
 * #define ListView_GetCountPerPage(hwndLV) \
 *     (int)SendMessage((hwndLV), LVM_GETCOUNTPERPAGE, 0, 0)
 * 
 * 
 * #define LVM_GETORIGIN           (LVM_FIRST + 41)
 * #define ListView_GetOrigin(hwndLV, ppt) \
 *     (BOOL)SendMessage((hwndLV), LVM_GETORIGIN, (WPARAM)0, (LPARAM)(POINT FAR*}(ppt))
 * 
 * 
 * #define LVM_UPDATE              (LVM_FIRST + 42)
 * #define ListView_Update(hwndLV, i) \
 *     (BOOL)SendMessage((hwndLV), LVM_UPDATE, (WPARAM)i, 0L)
 * 
 *) 
LVM_SETITEMSTATE: (# exit (LVM_FIRST + 43) #);
ListView_SetItemState:
  (# _ms_lvi: @LV_ITEMA;     
     lvm_sis: @integer;
     hwndLV, i, data, mask: @integer;
     result: @integer;
  enter (hwndLV, i, data, mask) 
  do mask -> _ms_lvi.stateMask;
     data -> _ms_lvi.state;
     LVM_SETITEMSTATE -> lvm_sis;
     (hwndLV,lvm_sis , i, _ms_lvi[]) -> SendMessage2 -> result;
  exit result
  #);

 (* #define LVM_SETITEMSTATE        (LVM_FIRST + 43)
 * #define ListView_SetItemState(hwndLV, i, data, mask) \
 * { LV_ITEM _ms_lvi;\
 *   _ms_lvi.stateMask = mask;\
 *   _ms_lvi.state = data;\
 *   SendMessage((hwndLV), LVM_SETITEMSTATE, (WPARAM)i, (LPARAM)(LV_ITEM FAR *}&_ms_lvi);\
 * }
 * 
  *) 
LVM_GETITEMSTATE: (# exit (LVM_FIRST + 44) #);
ListView_GetItemState:
  (# hwndLV, i, mask: @integer;
     result: @integer;
  enter (hwndLV, i, mask) 
  do (hwndLV, LVM_GETITEMSTATE, i, mask) -> SendMessage -> result;
  exit result
  #);

(* 
 * #define LVM_GETITEMSTATE        (LVM_FIRST + 44)
 * #define ListView_GetItemState(hwndLV, i, mask) \
 *    (UINT)SendMessage((hwndLV), LVM_GETITEMSTATE, (WPARAM)i, (LPARAM)mask)
 * 
 * 
 * #define LVM_GETITEMTEXTA        (LVM_FIRST + 45)
 * #define LVM_GETITEMTEXTW        (LVM_FIRST + 115)
 * 
 * #ifdef UNICODE
 * #define  LVM_GETITEMTEXT        LVM_GETITEMTEXTW
 * #else
 * #define  LVM_GETITEMTEXT        LVM_GETITEMTEXTA
 * #endif
 * 
 * #define ListView_GetItemText(hwndLV, i, iSubItem_, pszText_, cchTextMax_) \
 * { LV_ITEM _ms_lvi;\
 *   _ms_lvi.iSubItem = iSubItem_;\
 *   _ms_lvi.cchTextMax = cchTextMax_;\
 *   _ms_lvi.pszText = pszText_;\
 *   SendMessage((hwndLV), LVM_GETITEMTEXT, (WPARAM)i, (LPARAM)(LV_ITEM FAR *}&_ms_lvi);\
 * }
 * 
 * 
 * #define LVM_SETITEMTEXTA        (LVM_FIRST + 46)
 * #define LVM_SETITEMTEXTW        (LVM_FIRST + 116)
 * 
 * #ifdef UNICODE
 * #define  LVM_SETITEMTEXT        LVM_SETITEMTEXTW
 * #else
 * #define  LVM_SETITEMTEXT        LVM_SETITEMTEXTA
 * #endif
 * 
 * #define ListView_SetItemText(hwndLV, i, iSubItem_, pszText_) \
 * { LV_ITEM _ms_lvi;\
 *   _ms_lvi.iSubItem = iSubItem_;\
 *   _ms_lvi.pszText = pszText_;\
 *   SendMessage((hwndLV), LVM_SETITEMTEXT, (WPARAM)i, (LPARAM)(LV_ITEM FAR *}&_ms_lvi);\
 * }
 * 
 *) 
LVM_SETITEMTEXTA: (# exit (LVM_FIRST + 46) #);
LVM_SETITEMTEXT: (# exit LVM_SETITEMTEXTA #);
ListView_SetItemText: 
  (# hwndLV: @integer;   (* handle to listview control *)
     lvIndex: @integer;        (* Index of the list view item. *)
     iSubItem: @integer; (* Index of the subitem or zero to set 
                          * the item label. *)
     theText: ^text;
     ms_lvi: ^LV_ITEMA;
     pszText: @cstring;
     result: @integer; (* BOOL *)
     temp_lvm_setitemtexta: @integer;
  enter (hwndLV, lvIndex, iSubItem, theText[]) 
  do &LV_ITEMA[] -> ms_lvi[];
     theText[] -> pszText.set;
     LVM_SETITEMTEXTA -> temp_lvm_setitemtexta;
     iSubItem -> ms_lvi.iSubItem;
     pszText.charPtr -> ms_lvi.pszText;
     (hwndLV, temp_lvm_setitemtexta, lvIndex, ms_lvi[]) 
       -> SendMessage2 -> result;
     pszText.free;
  exit result
  #);

ListView_SetItemText2: 
  (# hwndLV: @integer;   (* handle to listview control *)
     lvIndex: @integer;        (* Index of the list view item. *)
     iSubItem: @integer; (* Index of the subitem or zero to set 
                          * the item label. *)
     ms_lvi: ^LV_ITEMA;
     pszText: @integer;
     result: @integer; (* BOOL *)
     temp_lvm_setitemtexta: @integer;
  enter (hwndLV, lvIndex, iSubItem, pszText) 
  do &LV_ITEMA[] -> ms_lvi[];
     LVM_SETITEMTEXTA -> temp_lvm_setitemtexta;
     iSubItem -> ms_lvi.iSubItem;
     pszText -> ms_lvi.pszText;
     (hwndLV, temp_lvm_setitemtexta, lvIndex, ms_lvi[]) 
       -> SendMessage2 -> result;
  exit result
  #);


LVM_SETITEMCOUNT: (# exit (LVM_FIRST + 47) #);
ListView_SetItemCount: 
  (# hwndLV, cItems: @integer;
  enter (hwndLV, cItems)
  do (hwndLV, LVM_SETITEMCOUNT, cItems, 0) -> SendMessage;
  #);

LVM_SORTITEMS: (# exit (LVM_FIRST + 48) #);
ListView_SortItems:
  (#  hwndLV, pfnCompare, lPrm: @integer;
     result: @integer;
  enter (hwndLV, pfnCompare, lPrm) 
  do (hwndLV, LVM_SORTITEMS,lPrm, pfnCompare)
       -> SendMessage -> result;
  exit result
  #);

 (* #define ListView_SetItemCount(hwndLV, cItems) \
 *   SendMessage((hwndLV), LVM_SETITEMCOUNT, (WPARAM)cItems, 0)
 * 
 * 
 * typedef int (CALLBACK *PFNLVCOMPARE)(LPARAM, LPARAM, LPARAM);
 * 
 * 
 * #define LVM_SORTITEMS           (LVM_FIRST + 48)
 * #define ListView_SortItems(hwndLV, _pfnCompare, _lPrm) \
 *   (BOOL)SendMessage((hwndLV), LVM_SORTITEMS, (WPARAM)(LPARAM)_lPrm, \
 *   (LPARAM)(PFNLVCOMPARE)_pfnCompare)
 * 
 * 
 * #define LVM_SETITEMPOSITION32   (LVM_FIRST + 49)
 * #define ListView_SetItemPosition32(hwndLV, i, x, y) \
 * { POINT ptNewPos = {x,y}; \
 *     SendMessage((hwndLV), LVM_SETITEMPOSITION32, (WPARAM)(int)(i), (LPARAM)&ptNewPos); \
 * }
 * 
 * 
 * #define LVM_GETSELECTEDCOUNT    (LVM_FIRST + 50)
 * #define ListView_GetSelectedCount(hwndLV) \
 *     (UINT)SendMessage((hwndLV), LVM_GETSELECTEDCOUNT, 0, 0L)
 * 
 * 
 * #define LVM_GETITEMSPACING      (LVM_FIRST + 51)
 * #define ListView_GetItemSpacing(hwndLV, fSmall) \
 *         (DWORD)SendMessage((hwndLV), LVM_GETITEMSPACING, fSmall, 0L)
 * 
 * 
 * #define LVM_GETISEARCHSTRINGA   (LVM_FIRST + 52)
 * #define LVM_GETISEARCHSTRINGW   (LVM_FIRST + 117)
 * 
 * #ifdef UNICODE
 * #define LVM_GETISEARCHSTRING   LVM_GETISEARCHSTRINGW
 * #else
 * #define LVM_GETISEARCHSTRING   LVM_GETISEARCHSTRINGA
 * #endif
 * 
 * #define ListView_GetISearchString(hwndLV, lpsz) \
 *         (BOOL)SendMessage((hwndLV), LVM_GETISEARCHSTRING, 0, (LPARAM)(LPTSTR)lpsz)
 * 
  *) 
NM_LISTVIEW: cstruct
  (# bytesize::< (# do 44 -> value; #);
     hdr: @
       (# hwndFrom: @long (# pos:: (# do 0 -> value; #); #);
          idFrom: @long (# pos:: (# do 4 -> value; #); #);
          nCode: @long (# pos:: (# do 8 -> value; #); #); 
       enter (hwndFrom,idFrom,nCode)
       exit (hwndFrom,idFrom,nCode)
       #);
     iItem: @long (# pos:: (# do 12 -> value; #); #); 
     iSubItem: @long (# pos:: (# do 16 -> value; #); #);  
     uNewState: @long (# pos:: (# do 20 -> value; #); #);  
     uOldState: @long (# pos:: (# do 24 -> value; #); #);   
     uChanged: @long (# pos:: (# do 28 -> value; #); #);       
     ptAction: @
       (# x: @long (# pos:: (# do 32 -> value #); #);
          y: @long (# pos:: (# do 36 -> value #); #);
       enter (x,y)
       exit (x,y)
       #);
     lParam: @long (# pos::< (# do 40 -> value; #); #);
  #);

LVN_ITEMCHANGING: (# exit        (LVN_FIRST-0) #);
LVN_ITEMCHANGED: (# exit         (LVN_FIRST-1) #);
LVN_INSERTITEM: (# exit          (LVN_FIRST-2) #);
LVN_DELETEITEM: (# exit          (LVN_FIRST-3) #);
LVN_DELETEALLITEMS: (# exit      (LVN_FIRST-4) #);
LVN_BEGINLABELEDITA: (# exit     (LVN_FIRST-5) #);
LVN_BEGINLABELEDITW: (# exit     (LVN_FIRST-75) #);
LVN_ENDLABELEDITA: (# exit       (LVN_FIRST-6) #);
LVN_ENDLABELEDITW: (# exit       (LVN_FIRST-76) #);
LVN_COLUMNCLICK: (# exit         (LVN_FIRST-8) #);
LVN_BEGINDRAG: (# exit           (LVN_FIRST-9) #);
LVN_BEGINRDRAG: (# exit          (LVN_FIRST-11) #); 

 (* typedef struct _NM_LISTVIEW
 * {
 *     NMHDR   hdr;
 *     int     iItem;
 *     int     iSubItem;
 *     UINT    uNewState;
 *     UINT    uOldState;
 *     UINT    uChanged;
 *     POINT   ptAction;
 *     LPARAM  lParam;
 * } NM_LISTVIEW, FAR *LPNM_LISTVIEW;
 * 
 * 
 * #define LVN_ITEMCHANGING        (LVN_FIRST-0)
 * #define LVN_ITEMCHANGED         (LVN_FIRST-1)
 * #define LVN_INSERTITEM          (LVN_FIRST-2)
 * #define LVN_DELETEITEM          (LVN_FIRST-3)
 * #define LVN_DELETEALLITEMS      (LVN_FIRST-4)
 * #define LVN_BEGINLABELEDITA     (LVN_FIRST-5)
 * #define LVN_BEGINLABELEDITW     (LVN_FIRST-75)
 * #define LVN_ENDLABELEDITA       (LVN_FIRST-6)
 * #define LVN_ENDLABELEDITW       (LVN_FIRST-76)
 * #define LVN_COLUMNCLICK         (LVN_FIRST-8)
 * #define LVN_BEGINDRAG           (LVN_FIRST-9)
 * #define LVN_BEGINRDRAG          (LVN_FIRST-11)
 * 
 * 
 * 
 * #define LVN_GETDISPINFOA        (LVN_FIRST-50)
 * #define LVN_GETDISPINFOW        (LVN_FIRST-77)
 * #define LVN_SETDISPINFOA        (LVN_FIRST-51)
 * #define LVN_SETDISPINFOW        (LVN_FIRST-78)
 * 
 * #ifdef UNICODE
 * #define LVN_BEGINLABELEDIT      LVN_BEGINLABELEDITW
 * #define LVN_ENDLABELEDIT        LVN_ENDLABELEDITW
 * #define LVN_GETDISPINFO         LVN_GETDISPINFOW
 * #define LVN_SETDISPINFO         LVN_SETDISPINFOW
 * #else
 * #define LVN_BEGINLABELEDIT      LVN_BEGINLABELEDITA
 * #define LVN_ENDLABELEDIT        LVN_ENDLABELEDITA
  * #define LVN_GETDISPINFO         LVN_GETDISPINFOA
  *)
LVN_GETDISPINFO: (# exit LVN_FIRST-50 #);

(* #define LVN_SETDISPINFO         LVN_SETDISPINFOA
 * #endif
 * 
 * 
 * 
 * 
 * #define LVIF_DI_SETITEM         16x1000
 * 
 * typedef struct _LV_DISPINFO {
 *     NMHDR hdr;
 *     LV_ITEMA item;
 * } LV_DISPINFOA;
 * 
 * typedef struct _LV_DISPINFOW {
 *     NMHDR hdr;
 *     LV_ITEMW item;
 * } LV_DISPINFOW;
 * 
 * #ifdef UNICODE
 * #define  LV_DISPINFO            LV_DISPINFOW
 * #else
 * #define  LV_DISPINFO            LV_DISPINFOA
 * #endif
 *) 

LV_DISPINFO: CStruct
  (# bytesize::< (# do 48 -> value; #);
     hdr: @
       (# hwndFrom: @long (# pos:: (# do 0 -> value; #); #);
          idFrom: @long (# pos:: (# do 4 -> value; #); #);
          nCode: @long (# pos:: (# do 8 -> value; #); #); 
       enter (hwndFrom,idFrom,nCode)
       exit (hwndFrom,idFrom,nCode)
       #);
     item: @
       (# mask: @long (# pos:: (# do 12 -> value; #); #); 
          iItem: @long (# pos:: (# do 16 -> value; #); #); 
          iSubItem: @long (# pos:: (# do 20 -> value; #); #);  
          state: @long (# pos:: (# do 24 -> value; #); #);  
          stateMask: @long (# pos:: (# do 28 -> value; #); #);   
          pszText: @long (# pos:: (# do 32 -> value; #); #);       
          cchTextMax: @long (# pos:: (# do 36 -> value; #); #);
          iImage: @long (# pos:: (# do 40 -> value; #); #);
          lParam: @long (# pos:: (# do 44 -> value; #); #);
       enter (mask,iItem,iSubItem,state,stateMask,pszText,
          cchTextMax,iImage,lParam)
       exit (mask,iItem,iSubItem,state,stateMask,pszText,
          cchTextMax,iImage,lParam)
       #);
  #);
LVN_KEYDOWN: (# exit (LVN_FIRST-55) #);
 (* 
 * typedef struct _LV_KEYDOWN
 * {
 *     NMHDR hdr;
 *     WORD wVKey;
 *     UINT flags;
 * } LV_KEYDOWN;
 * 
 * #endif
 * 
 *)


(***************************************
 * tree_view control *********
 *)

TVS_HASBUTTONS: (# exit          0x0001 #);
TVS_HASLINES: (# exit            0x0002 #);
TVS_LINESATROOT: (# exit         0x0004 #);
TVS_EDITLABELS: (# exit          0x0008 #);
TVS_DISABLEDRAGDROP: (# exit     0x0010 #);
TVS_SHOWSELALWAYS: (# exit       0x0020 #);

(* typedef struct _TREEITEM FAR* HTREEITEM; *)

TVIF_TEXT: (# exit               0x0001 #);
TVIF_IMAGE: (# exit              0x0002 #);
TVIF_PARAM: (# exit              0x0004 #);
TVIF_STATE: (# exit              0x0008 #);
TVIF_HANDLE: (# exit             0x0010 #);
TVIF_SELECTEDIMAGE: (# exit      0x0020 #);
TVIF_CHILDREN: (# exit           0x0040 #);

TVIS_FOCUSED: (# exit            0x0001 #);
TVIS_SELECTED: (# exit           0x0002 #);
TVIS_CUT: (# exit                0x0004 #);
TVIS_DROPHILITED: (# exit        0x0008 #);
TVIS_BOLD: (# exit               0x0010 #);
TVIS_EXPANDED: (# exit           0x0020 #);
TVIS_EXPANDEDONCE: (# exit       0x0040 #);

TVIS_OVERLAYMASK: (# exit        0x0F00 #);
TVIS_STATEIMAGEMASK: (# exit     0xF000 #);
TVIS_USERMASK: (# exit           0xF000 #);

I_CHILDRENCALLBACK: (# exit   -1 #);
    
TV_ITEM: ExternalRecord
  (# mask: @long (# pos::< (# do 0 -> value; #); #); 
     hItem: @long (# pos::< (# do 4 -> value; #); #);      
     state: @long (# pos::< (# do 8 -> value; #); #);  
     stateMask: @long (# pos::< (# do 12 -> value; #); #);   
     pszText: @long (# pos::< (# do 16 -> value; #); #);       
     cchTextMax: @long (# pos::< (# do 20 -> value; #); #);
     iImage: @long (# pos::< (# do 24 -> value; #); #);
     iSelectedImage: @long (# pos::< (# do 28 -> value; #); #);  
     cChildren: @long (# pos::< (# do 32 -> value; #); #);  
     lParam: @long (# pos::< (# do 36 -> value; #); #);
  #);
sizeOf_TV_ITEM: (# exit 40 #);

TVI_ROOT: (# exit                 0xFFFF0000 #);
TVI_FIRST: (# exit                0xFFFF0001 #);
TVI_LAST: (# exit                 0xFFFF0002 #);
TVI_SORT: (# exit                 0xFFFF0003 #);

TV_INSERTSTRUCT: ExternalRecord
  (# (* bytesize::< (# do 12 -> value; #); *)
     hParent: @long (# pos::< (# do 0 -> value; #); #); (* HTREEITEM *)
     hInsertAfter: @long (# pos::< (# do 4 -> value; #); #); (* HTREEITEM *)
     item: @
       (# mask: @long (# pos::< (# do 8 -> value; #); #); 
          hItem: @long (# pos::< (# do 12 -> value; #); #);      
          state: @long (# pos::< (# do 16 -> value; #); #);  
          stateMask: @long (# pos::< (# do 20 -> value; #); #);   
          pszText: @long (# pos::< (# do 24 -> value; #); #);       
          cchTextMax: @long (# pos::< (# do 28 -> value; #); #);
          iImage: @long (# pos::< (# do 32 -> value; #); #);
          iSelectedImage: @long (# pos::< (# do 36 -> value; #); #);  
          cChildren: @long (# pos::< (# do 40 -> value; #); #);  
          lParam: @long (# pos::< (# do 44 -> value; #); #);
       #);
  #);
sizeOf_TV_INSERTSTRUCT: (# exit 48 #);

TVM_INSERTITEM: (# exit          (TV_FIRST + 0) #);

TreeView_InsertItem:
  (# hwnd: @integer; 
     lpis: @integer; (* ^TV_INSERTSTRUCT; *)
     temp_TVM_INSERTITEM: @integer;
     result: @integer;
  enter (hwnd, lpis)  
  do (hwnd, TVM_INSERTITEM, 0, lpis)
       -> SendMessage -> result;
     
     (if result=0 then
         'TreeView_InsertItem: ' -> screen.putText;
         'Error= ' -> puttext;
         GetLastError -> putint; newline;
     if);
  exit result
  #);

TVM_DELETEITEM: (# exit (TV_FIRST + 1) #);

TreeView_DeleteItem:
  (# hwnd: @integer; (* Handle to the tree view control. *)
     hitem: @integer; (* Index of the tree view item to delete. *)
     result: @integer; (* Returns TRUE(1) if successful or FALSE(0) 
                        * otherwise. *)
  enter (hwnd, hitem)
  do (hwnd, TVM_DELETEITEM, 0, hitem) -> SendMessage -> result;
  exit result
  #);


TreeView_DeleteAllItems:
  (# hwnd: @integer; (* Handle to the list view control. *)
     result: @integer; (* Returns TRUE(1) if successful or FALSE(0) 
                        * otherwise. *)
  enter hwnd
  do (hwnd, TVM_DELETEITEM, 0, TVI_ROOT) -> SendMessage -> result;
  #);


TVM_EXPAND: (# exit              (TV_FIRST + 2) #);

TreeView_Expand: 
  (# hwnd: @integer; (* Handle to the tree view control. *)
     hitem: @integer; (* Index of the tree view item to delete. *)
     theCode: @integer;
     result: @integer;
  enter (hwnd, hitem, theCode)
  do (hwnd, TVM_EXPAND, theCode, hitem) -> SendMessage -> result;
  exit result
  #);

TVM_GETITEM: (# exit              (TV_FIRST + 12) #);
TreeView_GetItem: 
  (# hwnd, pitem: @integer;
     result: @integer;
  enter (hwnd, pitem)
  do (hwnd, TVM_GETITEM, 0, pitem) -> SendMessage -> result;
  exit result
  #);

TVM_SETITEM: (# exit           (TV_FIRST + 13) #);
TreeView_SetItem:
  (# hwnd, pitem: @integer;
     result: @integer;
  enter (hwnd, pitem)
  do (hwnd, TVM_SETITEM, 0, pitem) -> SendMessage -> result;
  exit result
  #);

TVM_GETEDITCONTROL: (# exit       (TV_FIRST + 15) #);

TVE_COLLAPSE: (# exit            0x0001 #);
TVE_EXPAND: (# exit              0x0002 #);
TVE_TOGGLE: (# exit              0x0003 #);
TVE_COLLAPSERESET: (# exit       0x8000 #);

TVM_GETCOUNT: (# exit            (TV_FIRST + 5) #);
TreeView_GetCount:
  (# hwnd,noOfElms: @integer;
  enter hwnd
  do (hwnd, TVM_GETCOUNT, 0, 0) -> SendMessage -> noOfElms;
  exit noOfElms
  #);

TVM_SETIMAGELIST: (# exit        (TV_FIRST + 9) #);

TreeView_SetImageList:
  (# hwnd, himl, iImage: @integer;
     result: @integer;
  enter (hwnd, himl, iImage)
  do (hwnd, TVM_SETIMAGELIST,iImage,himl)->SendMessage->result;
  exit result
  #);

TVM_GETNEXTITEM: (# exit          (TV_FIRST + 10) #);

TreeView_GetNextItem:
  (# hwnd, hitem, theCode: @integer;
     result: @integer;
  enter (hwnd, hitem, theCode)
  do (hwnd, TVM_GETNEXTITEM, theCode, hitem) -> SendMessage -> result;
  exit result
  #);

TVGN_ROOT: (# exit               0x0000 #);
TVGN_NEXT: (# exit               0x0001 #);
TVGN_PREVIOUS: (# exit           0x0002 #);
TVGN_PARENT: (# exit             0x0003 #);
TVGN_CHILD: (# exit              0x0004 #);
TVGN_FIRSTVISIBLE: (# exit       0x0005 #);
TVGN_NEXTVISIBLE: (# exit        0x0006 #);
TVGN_PREVIOUSVISIBLE: (# exit    0x0007 #);
TVGN_DROPHILITE: (# exit         0x0008 #);
TVGN_CARET: (# exit              0x0009 #);

TVM_SELECTITEM: (# exit           (TV_FIRST + 11) #);
TreeView_Select:
  (# hwnd, hitem, theCode: @integer;
     result: @integer;
  enter (hwnd, hitem, theCode) 
  do (hwnd, TVM_SELECTITEM, theCode, hitem) -> SendMessage -> result;
  exit result
  #);
     

NM_TREEVIEW: cstruct
  (# bytesize::< (# do 104 -> value; #);
     hdr: 
       (# hwndFrom: @long (# pos::< (# do 0 -> value; #); #);
          idFrom: @long (# pos::< (# do 4 -> value; #); #);
          nCode: @long (# pos::< (# do 8 -> value; #); #); 
       #); (* NMHDR *)
     action: @long (# pos::< (# do 12 -> value; #); #); (* UINT *)
     itemOld: 
       (# mask: @long (# pos::< (# do 16 -> value; #); #); 
          hItem: @long (# pos::< (# do 20 -> value; #); #);      
          state: @long (# pos::< (# do 24 -> value; #); #);  
          stateMask: @long (# pos::< (# do 28 -> value; #); #);   
          pszText: @long (# pos::< (# do 32 -> value; #); #);       
          cchTextMax: @long (# pos::< (# do 36 -> value; #); #);
          iImage: @long (# pos::< (# do 40 -> value; #); #);
          iSelectedImage: @long (# pos::< (# do 44 -> value; #); #);  
          cChildren: @long (# pos::< (# do 48 -> value; #); #);  
          lParam: @long (# pos::< (# do 52 -> value; #); #);
       #); (* TV_ITEM *)
     itemNew: 
       (# mask: @long (# pos::< (# do 56 -> value; #); #); 
          hItem: @long (# pos::< (# do 60 -> value; #); #);      
          state: @long (# pos::< (# do 64 -> value; #); #);  
          stateMask: @long (# pos::< (# do 68 -> value; #); #);   
          pszText: @long (# pos::< (# do 72 -> value; #); #);       
          cchTextMax: @long (# pos::< (# do 76 -> value; #); #);
          iImage: @long (# pos::< (# do 80 -> value; #); #);
          iSelectedImage: @long (# pos::< (# do 84 -> value; #); #);  
          cChildren: @long (# pos::< (# do 88 -> value; #); #);  
          lParam: @long (# pos::< (# do 92 -> value; #); #);
       #); (* TV_ITEM *)

     ptDrag: @
       (# x: @long (# pos::< (# do 96 -> value #); #);
          y: @long (# pos::< (# do 100 -> value #); #);
       enter (x,y)
       exit (x,y)
       #);
  #);
sizeOf_NM_TREEVIEW: (# exit 104 #);
     

TVN_SELCHANGING: (# exit         (TVN_FIRST-1) #);
TVN_SELCHANGED: (# exit          (TVN_FIRST-2) #);

TVC_UNKNOWN: (# exit              0x0000 #);
TVC_BYMOUSE: (# exit              0x0001 #);
TVC_BYKEYBOARD: (# exit           0x0002 #);

TVN_GETDISPINFO: (# exit        (TVN_FIRST-3) #);
TVN_SETDISPINFO: (# exit         (TVN_FIRST-4) #);

TVIF_DI_SETITEM: (# exit          0x1000 #);

TV_DISPINFO: ExternalRecord
  (# hdr:
       (# hwndFrom: @long (# pos::< (# do 0 -> value; #); #);
          idFrom: @long (# pos::< (# do 4 -> value; #); #);
          nCode: @long (# pos::< (# do 8 -> value; #); #); 
       #); (* NMHDR *)
     item:
       (# mask: @long (# pos::< (# do 12 -> value; #); #); 
          hItem: @long (# pos::< (# do 16 -> value; #); #);      
          state: @long (# pos::< (# do 20 -> value; #); #);  
          stateMask: @long (# pos::< (# do 24 -> value; #); #);   
          pszText: @long (# pos::< (# do 28 -> value; #); #);       
          cchTextMax: @long (# pos::< (# do 32 -> value; #); #);
          iImage: @long (# pos::< (# do 36 -> value; #); #);
          iSelectedImage: @long (# pos::< (# do 40 -> value; #); #);  
          cChildren: @long (# pos::< (# do 44 -> value; #); #);  
          lParam: @long (# pos::< (# do 48 -> value; #); #);
       #); (* TV_ITEM *)
  #);


TVN_ITEMEXPANDING: (# exit      (TVN_FIRST-5) #);
TVN_ITEMEXPANDED: (# exit       (TVN_FIRST-6) #);
TVN_BEGINDRAG: (# exit          (TVN_FIRST-7) #);
TVN_BEGINRDRAG: (# exit         (TVN_FIRST-8) #);
TVN_DELETEITEM: (# exit         (TVN_FIRST-9) #);
TVN_BEGINLABELEDIT: (# exit     (TVN_FIRST-10) #);
TVN_ENDLABELEDIT: (# exit       (TVN_FIRST-11) #);
TVN_KEYDOWN: (# exit             (TVN_FIRST-12) #);

TV_KEYDOWN: ExternalRecord
  (# hdr: 
       (# hwndFrom: @long (# pos::< (# do 0 -> value; #); #);
          idFrom: @long (# pos::< (# do 4 -> value; #); #);
          nCode: @long (# pos::< (# do 8 -> value; #); #); 
       #); (* NMHDR *)
     wVKey: @short(# pos::< (# do 12 -> value; #); #); (* WORD *)
     flags: @long (# pos::< (# do 14 -> value; #); #);  (* UINT *)
  #);

(***************************************
 * **** ToolBar ***********************
 *****************************************)
sizeOf_TBBUTTON: external
  (# size: @integer;
  do callC;
  exit size
  #);
TBSTYLE_BUTTON: (# exit          0x00 #);

TBSTYLE_TOOLTIPS: (# exit       0x0100 #);

TBSTATE_ENABLED: (# exit          0x04 #);


TB_ADDBITMAP: (# exit            (WM_USER + 19) #);

TBADDBITMAP: ExternalRecord
  (# hInst: @long (# pos::< (# do 0 -> value; #); #);
     nID: @long (# pos::< (# do 4 -> value; #); #);
  #);
sizeOf_TBADDBITMAP: (# exit 8 #);

TB_ADDBUTTONS: (# exit          (WM_USER + 20) #);
TB_INSERTBUTTON : (# exit        (WM_USER + 21) #);
TB_AUTOSIZE: (# exit             (WM_USER + 33) #);
TB_ADDSTRING: (# exit           (WM_USER + 28) #);

TB_GETTOOLTIPS: (# exit          (WM_USER + 35) #);

TB_BUTTONSTRUCTSIZE: (# exit      (WM_USER + 30) #);

TTN_NEEDTEXT: (# exit           (TTN_FIRST - 0) #);


TBBUTTON: ExternalRecord
  (# iBitmap: @long (# pos::< (# do 0 -> value; #); #); 
     idCommand: @long (# pos::< (# do 4 -> value; #); #);
     fsState: @byte (# pos::< (# do 8 -> value; #); #);
     fsStyle: @byte (# pos::< (# do 9 -> value; #); #);
     bReserved: @short (# pos::< (# do 10 -> value; #); #);
     dwData: @long (# pos::< (# do 12 -> value; #); #);
     iString: @long (# pos::< (# do 16 -> value; #); #);
  #);

STD_FILENEW: (# exit              6 #);
STD_FILEOPEN: (# exit             7 #);
STD_FILESAVE: (# exit             8 #);
