ORIGIN '~beta/basiclib/v1.5/betaenv';
BODY 'private/ddelibbody';
(*
 * COPYRIGHT
 *       Copyright (C) Mjolner Informatics, 1994-95
 *       All rights reserved.
 *)

-- Lib: attributes -- 
ddelib: 
  (# <<SLOT ddelibLib: attributes>>;
     ddemlhandler:<
       (# ddemlEvent: 
            (# <<SLOT ddemlEventLib: attributes>>;
            do <<SLOT ddemlEventBody: descriptor>>; inner;
            #) (* ddemlEvent *);
          
          ddemlErrorEvent: ddemlEvent
            (# (* hConv: Identifies the conversation associated with the error. This parameter 
                *        is 0 if the error is not associated with a conversation.
                * errorCode: Specifies the error code. 
                *)
               hConv: IntegerValue(# do <<SLOT errorHConvBody: descriptor>>; #);
               errorCode: IntegerValue(# do <<SLOT errorCodeBody: descriptor>>; #);
            do inner;
            #);
          (* onXTYP_ERROR is called when a critical error occurs. *)
          onXTYP_ERROR:< ddemlErrorEvent;
          
          ddemlAdviseEvent: ddemlEvent
            (# fmt: IntegerValue(# do <<SLOT adviseFmtBody: descriptor>>; #);
               hConv: IntegerValue(# do <<SLOT adviseHConvBody: descriptor>>; #);
               hTopic: IntegerValue(# do <<SLOT adviseHTopicBody: descriptor>>; #);
               hData: IntegerValue(# do <<SLOT adviseHDataBody: descriptor>>; #);
               data1: IntegerValue(# do <<SLOT adviseData1Body: descriptor>>; #);
            do inner;
            #);
          
          ddemlAdviseDataEvent: ddemlAdviseEvent
            (# (* fmt: Specifies the format atom of the data sent from the server. (E.g.: CF_TEXT).
                * hConv: Identifies the conversationn.
                * hTopic: Identifies the topic name.
                * hItem: Identifies the item name.
                * hData: Identifies the data associated with the topic name and item name pair. This
                *        parameter is 0 if the client specified the XTYP_NODATA flag when it requested 
                *        the advise loop.
                * data1: Is not used. (I.e. data1 = 0).
                *)
            do inner;
            #);
          
          (* onXTYP_ADVDATA is called on a dde client after having established an advise loop with a dde server.*)
          onXTYP_ADVDATA:< ddemlAdviseEvent;
          
          adviseRequestEvent: ddemlAdviseEvent
            (# (* fmt: Specifies the format in which the data should be submitted to the client.
                * hConv: Identifies the conversationn.
                * hTopic: Identifies the topic name.
                * hItem: Identifies the item name.
                * hData: Is not used. (I.e. hData = 0).
                * data1: Specifies the count of XTYP_ADVREQ transactions that remain to be processed, 
                *        on the same topic, item, and format name set, within the context of the 
                *        current call to the DdePostAdvise function. The count is zero if the current 
                *        XTYP_ADVREQ transaction is the last one.
                *)
            do inner;
            #);
          (* onXTYP_ADVREQ is called on a server after the server calls the DdePostAdvise function. 
           * This event informs the server that an advise transaction is outstanding on the specified
           * topic name and item name pair and that data corresponding to the topic name and item name
           * has changed.
           *)
          onXTYP_ADVREQ:< adviseRequestEvent;
          
          ddemlAdviseStartEvent: ddemlAdviseEvent
            (# (* fmt: Specifies the data format requested by the client.
                * hConv: Identifies the conversationn.
                * hTopic: Identifies the topic name.
                * hItem: Identifies the item name.
                * hData: Is not used. (I.e. hData = 0).
                * data1: Is not used. (I.e. data1 = 0).
                *)
            do inner;
            #);
          (* onXTYP_ADVSTART is called on a dde server when a client specifies XTYP_ADVSTART as the uType
           * parameter of the DdeClientTransaction function. A client uses this transaction to establish 
           * an advise loop with the server.
           *)
          onXTYP_ADVSTART:< ddemlAdviseStartEvent;
          
          ddemlAdviseStopEvent: ddemlAdviseEvent
            (# (* fmt: Specifies the data format associated with the advise loop being ended.
                * hConv: Identifies the conversationn.
                * hTopic: Identifies the topic name.
                * hItem: Identifies the item name.
                * hData: Is not used. (I.e. hData = 0).
                * data1: Is not used. (I.e. data1 = 0).
                *)
            do inner;
            #);
          onXTYP_ADVSTOP:< ddemlAdviseStopEvent;
          
          ddemlActCompleteEvent: ddemlEvent
            (# (* fmt: Specifies the format of the data associated with the completed transaction
                *      (if applicable), or 0 if no data was exchanged during the transaction.
                * hConv: Identifies the conversationn.
                * hTopic: Identifies the topic name involved in the completed transaction.
                * hItem: Identifies the item name involved in the completed transaction.
                * hData: Identifies the data involved in the completed transaction, if applicable.
                *        If the transaction was successfil but involved no data, this parameter will be TRUE.
                *        This parameter will be 0 if the transaction was unsuccessful.
                * data1: Contains the transaction identifier of the completed transaction.
                * data2: Contains any applicable DDE_ status flags.
                *)
               fmt: IntegerValue(# do <<SLOT completeFmtBody: descriptor>>; #);
               hConv: IntegerValue(# do <<SLOT completeHConvBody: descriptor>>; #);
               hTopic: IntegerValue(# do <<SLOT completeHTopicBody: descriptor>>; #);
               hData: IntegerValue(# do <<SLOT completeHDataBody: descriptor>>; #);
               data1: IntegerValue(# do <<SLOT completeData1Body: descriptor>>; #);
               data2: IntegerValue(# do <<SLOT completeData2Body: descriptor>>; #);
            do inner;
            #);
          (* onXTYP_XACT_COMPLETE is call on a dde client when an asynchronous transaction, initiated by 
           * a call to the DdeClientTransaction function, has completed.
           *)
          onXTYP_XACT_COMPLETE:< ddemlActCompleteEvent;
          
          ddemlRequestEvent: ddemlEvent
            (# (* fmt: Specifies the format in which the server should submit data to the the client.
                * hConv: Identifies the conversation.
                * hTopic: Identifies the topic name.
                * hItem: Identifies the item name.
                * hData: Not used.
                * data1: Not used.
                * data2: Not used.
                *)
               answer: ^text;
               fmt: IntegerValue(# do <<SLOT requestFmtBody: descriptor>>; #);
               hConv: IntegerValue(# do <<SLOT requestHConvBody: descriptor>>; #);
               hTopic: IntegerValue(# do <<SLOT requestHTopicBody: descriptor>>; #);
               hItem: IntegerValue(# do <<SLOT requestHItemBody: descriptor>>; #);
               hItem2: @integer; (* handle to the item associated with answer. *)
            do inner;
            exit (answer[], hItem2)
            #);
          onXTYP_REQUEST:< ddemlRequestEvent;
          
          performEvent: ddemlEvent
            (# (* hConv: Identifies the conversationn.
                * hTopic: Identifies the topic name.
                * hData: Identifies the command string.
                *)
               hConv: IntegerValue(# do <<SLOT hConvBody: descriptor>>; #);
               hTopic: IntegerValue(# do <<SLOT hTopicBody: descriptor>>; #);
               hData: IntegerValue(# do <<SLOT hDataBody: descriptor>>; #);
               (* accept tells whether the dde server processes this event.
                * It shoud return 
                * DDE_FACK if it processes the event,
                * DDE_FBUSY if it is too busy to process this event,
                * DDE_FNOTPROCESSED if it does not process this event.
                *)
               accept: @integer;
            do inner;
            exit accept
            #);
          
          registerEvent: ddemlEvent
            (# (* 
                * hBaseName: Identifies the base service name being (un)registered.
                * hHInstSpecName: Identifies the instance-specific service name being 
                * (un)registered.
                *)
               hBaseName: IntegerValue(# do <<SLOT regEventHBaseName: descriptor>> #);
               hInstSpecName: IntegerValue
                 (#  do <<SLOT regEventHInstSpecName: descriptor>> #);
            do inner;
            #);
          onXTYP_REGISTER:< registerEvent;
          onXTYP_UNREGISTER:< registerEvent;
          
          executeEvent: performEvent
            (# 
            do inner;
            #);
          onXTYP_EXECUTE:< executeEvent;
          
          pokeEvent: performEvent
            (# hItem: IntegerValue(# do <<SLOT pokeEventHItem: descriptor>>; #);
            do inner;
            #);
          onXTYP_POKE:< pokeEvent;
          
          connectEvent: ddemlEvent
            (# (* hTopic: Identifies the topic name.
                * hService: Identifies the service name. 
                *)
               hTopic: IntegerValue(# do <<SLOT connectEventHTopic: descriptor>> #);
               hService: IntegerValue(# do <<SLOT connectEventHService: descriptor>> #);
            do inner;
            #);
          onXTYP_CONNECT:< connectEvent;
          
          disconnectEvent: ddemlEvent
            (# hConv: IntegerValue(# do <<SLOT disconnectEventHConv: descriptor>> #); 
            do inner;
            #);
          onXTYP_DISCONNECT:< disconnectEvent;
       #);
     theDdemlHandler: @DdemlHandler;
     uienvApplName:
       (# name: ^text;
       enter (# enter name[] do <<SLOT ddelibsetAppName: descriptor>> #)
       exit (# do <<SLOT ddelibgetAppName: descriptor>> exit name[]  #)
       #);
     uienvHApplName: (# i: @integer; do <<SLOT ddelibhApplName: descriptor>> exit i#);
     hSystemTopic: IntegerValue (# do <<SLOT ddelibhsysTopic: descriptor>> #);
     idInst: (# i: @integer; do <<SLOT ddelibidInst: descriptor>>; exit i #);
     deinstallDdeml: (# do <<SLOT ddelibdeinstallDdeml: descriptor>>; #);
     private: @<<SLOT ddelibPrivateImpl: descriptor>>;
     init: (#  do <<SLOT ddelibInit: descriptor>> #);
  #)
