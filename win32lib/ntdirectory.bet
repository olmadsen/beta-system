ORIGIN '~beta/basiclib/v1.6/directory';
BODY 'private/ntdirectory_body';


(* The BETA interface to disk-entries in a hierarchic file system
 * files, and directories is organised as follows:
 * 
 *   DiskEntry:     Machine independent interface to entries like file and 
 *                  directories on the disk (file 'file.bet').
 *   UnixEntry:     Unix specific specialization of DiskEntry 
 *                  (file 'unixfile.bet').
 *   MacEntry:      Macintosh specific specialization of DiskEntry 
 *                  (file 'macfile.bet').
 *   NtEntry:       Windows NT / Win32 specific specialization of DiskEntry 
 *                  (file 'ntfile.bet').
 * 
 *   File:          Machine independent interface to disk files. Is a 
 *                  specialization of Stream (file 'betaenv.bet'), and contains 
 *                  a DiskEntry (file 'file.bet').
 *   UnixFile:      Unix specific specialization of File, which contains a 
 *                  UnixEntry (file 'unixfile.bet').
 *   MacFile:       Macintosh specific specialization of File, which
 *                  contains a MacEntry (file 'macfile.bet').
 *   NtFile:        Windows NT / Win32 specific specialization of File,
 *                  which contains a NtEntry (file 'ntfile.bet').
 *    
 *   Directory:     Machine independent interface to directories/folders.
 *                  Contains a DiskEntry (file 'directory.bet').
 *   UnixDirectory: Unix specific specialization of Directory, which
 *                  contains a UnixEntry (file 'unixdirectory.bet').
 *   MacDirectory:  Macintosh specific specialization of Directory, which
 *                  contains a MacEntry (file 'macdirectory.bet').
 *   NtDirectory:   Macintosh specific specialization of Directory, which
 *                  contains a MacEntry (file 'macdirectory.bet').
 * 
 * COPYRIGHT
 *       Copyright Mjolner Informatics, 1992-95
 *       All rights reserved.
 *)
(* idx=2 *)
---- INCLUDE 'ntfile'
---- LIB: attributes ----

ntdirectory: directory
  (* BETA interface to disk files in NT *)
  (#
     <<SLOT NtDirectoryLib: attributes>>;
     
     EntryDesc::< NtEntry;
     
     (* idx+ *)
     findEntry: dirFindEntry
       (#
          foundDesc::< NtEntry;
          foundFile::< NtFile;
          foundDir::< NtDirectory;
          (* idx+ *)     
          select: dirselect
            (# whenSocket:<       (# do INNER #);
               whenSymboliclink:< (# do INNER #);
               whenCharSpecial:<  (# do INNER #);
               whenBlockSpecial:< (# do INNER #);
       
               selectImpl::< (* private *)
                 (# <<SLOT NtDirFindDispatch:dopart>> #)
            #);
          do INNER
       #);
     (* idx- *)
     scanEntries: dirScanEntries
       (#
          foundDesc::< NtEntry;
          foundFile::< NtFile;
          foundDir::< NtDirectory;
          (* idx+ *)
          select: dirselect
            (# whenSocket:<       (# do INNER #);
               whenSymboliclink:< (# do INNER #);
               whenCharSpecial:<  (# do INNER #);
               whenBlockSpecial:< (# do INNER #);
          
               selectImpl::< (* private *)
                 (# <<SLOT NtDirScanDispatch:dopart>> #)
            #);
       do INNER
       #);
  (* idx- *) (* idx- *)   
  #)


(* Instead of scanEntries and findEntry being virtual (i.e. virtual prefixes): *)
---- DirectoryLib: attributes ----
dirFindEntry: findEntry(# do INNER #);
dirScanEntries: scanEntries(# do INNER #);

---- DirFindLib: attributes ----
dirSelect: select(##);

---- DirScanLib: attributes ----
dirSelect: select(##);
