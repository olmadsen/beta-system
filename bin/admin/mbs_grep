#!/usr/local/bin/perl5 -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h || ($#ARGV != 0)){
    print "Usage: mbs_grep [-h] pattern\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -n   No effects - only print what would be done\n";
    print "       Runs a case-insensitive search for pattern\n";
    print "       through all source-files in BETALIB\n";
    exit 0;
}

require "dirlist";

$pat = shift @ARGV;
foreach $dir (@Dirs) {
    foreach $curdir (&GetDirsRecursively("$betalib/$dir")) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /CHANGES|\.(bet|c|h|make|text|txt|gram)$/) {
		print "$file\n" if ($verbose);
		open (IN, $file) || die "Unable to open $file: $!";
		$line = 1;
		foreach (<IN>) {
		    if (/$pat/oi) {
			print "$file:$line:$_";
		    }
		    $line++;
		}
		close IN;
	    }
	}
    }
}

