#!/usr/local/bin/perl5 -s
#-*-Perl-*-

require "dirlist";

if ($#ARGV != 0) {
    print "Usage $0 pattern\n";
    print "Runs a case-insensitive search through all source-files\n";
    exit 1;
}

$pat = shift @ARGV;
foreach $dir (@Dirs) {
    foreach $curdir (&GetDirsRecursively("$betalib/$dir")) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /CHANGES|\.(bet|c|make|text|txt|gram)$/) {
		print "$file\n" if ($verbose);
		open (IN, $file) || die "Unable to open $file: $!";
		$line = 1;
		foreach (<IN>) {
		    if (/$pat/oi) {
			print "$file:$line:$_";
		    }
		    $line++;
		}
		close IN;
	    }
	}
    }
}

