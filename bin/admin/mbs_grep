#!/usr/local/bin/perl5 -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h || ($#ARGV != 0)){
    print "Usage: mbs_grep [-h] pattern\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -l   Just list files\n";
    print "          -i   Case sensitive (note inverse of grep option)!!!!!\n";
    print "          -n   No effects - only print what would be done\n";
    print "       Runs a case-insensitive search for pattern\n";
    print "       through all source-files in BETALIB\n";
    exit 0;
}

require "env.perl";

$verbose = $v;

$pat = shift @ARGV;
if (!$i) {
    $pat = "(?i)$pat";
}
foreach $curdir (&GetDirsRecursively("$betalib")) {
    @files = &GetFilesInDirs($curdir);
    foreach $file (@files) {
	if ($file =~ /CHANGES|\.(bet|c|h|make|text|txt|gram)$/) {
	    print "$file\n" if ($verbose);
	    if (open (IN, $file)) {
		$line = 1;
		foreach (<IN>) {
		    if (/$pat/o) {
		        if ($l) {
			    print "$file\n";
			    last;
			} else {
			    print ($file . ":$line" . ":$_");
			}
		    }
		    $line++;
		}
		close IN;
	    } else {
	        perror("Couldn't open '$file'");
	    }
	}
    }
}
