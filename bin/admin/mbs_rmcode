#!/bin/sh

# remove all ..gs and .o and .go files from code directories in release 4.0

#---------- configuration ------------

FILES="*..gs *..s *.o *.go *..db *.job *.so *.gso"
export FILES

DIRS=`dirs4.0`

# add some extra dirs here if required:
DIRS="\
$DIRS"

#---------- don't change below -------

echonl(){
  if [ -f /usr/bin/sun ]; 
  then 
    echo -n "$1"
  else
    echo "$1\c"
  fi
}

if [ $# -eq 0 ]
then
  echo usage: $0 targets
fi

for OBJDIR 
do
  echo   "Ready to remove $FILES from $OBJDIR directories in release 4.0:"
  
  for d in $DIRS
  do
	  echo /users/beta/$d
  done
  
  echo ""
  
  echo   "Are you sure that you want to remove $FILES"
  echonl "in $OBJDIR directories in these directories? (no/yes) "
  read answer
  if [ "$answer" != "yes" ]; then  exit 0; fi
  
  echo ""
  echonl "Really sure? (no/yes) "
  read answer
  if [ "$answer" != "yes" ]; then  exit 0; fi
  
  echo ""
  echonl "Would you like to be prompted for each directory? (yes/no) "
  read answer
  if [ "$answer" = "no" ]
  then
    doprompt=0
  else
    doprompt=1
  fi
  
  cd /users/beta
  
  for d in $DIRS
  do
     if [ "$doprompt" = "1" ]
     then
	  echo ""
	  echo   "Remove $FILES from $OBJDIR directories in"
	  echonl "  /users/beta/$d? (y/n/q) "
	  read answer
	  case "$answer" in
	  "y") ;;
	  "n") continue;;
	  "q") exit;;
	  esac
     else
	  echo "Removing from $OBJDIR directories in /users/beta/$d..."
     fi
  
     find $d -type d -name $OBJDIR -print -exec sh -c 'chmod -f u+w $0 $0/*; cd $0; /bin/rm -f $FILES' '{}' \;
  done

done