#!/usr/local/bin/perl5 -s
#-*-Perl-*-

require "dirlist";

print "Checking that .bet file is present for each .ast(L) file in $RELEASE\n";

$match='\.ast[lL]?$';
    
foreach $dir (@Dirs) {
    # next if (!$CompileFlag{$dir});
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    print "*** Checking $basedir ***\n";
    foreach $curdir (&GetDirsRecursively($basedir)) {
	@files = &GetFilesInDirs($curdir);
	FILE: foreach $file (@files) {
	    if ($file =~ /$match/) {
                foreach $ext ('.bet', '.text', '.gram', '.pgram', '-meta.gram', '.run', '.pretty') {
                  ($srcfile  = $file) =~ s/$match/$ext/g;
	          next FILE if (-f $srcfile);
              }
              $numerrs++;
              print "ERROR#$numerrs: Missing source file for:\n  $file\n";
              push (@errors, $file);
	    }
	}
    }
}

if ($numerrs > 0) {
    print "\n$numerrs errors found\n";
    print "Unlink the following files:\n";
    foreach $file (@errors) {
        next if (! -f $file);
        print "$file? (y/n/q) ";
	$answer = &GetAnswer();
	if ($answer eq "y"){
	    # just go on
	} elsif ($answer eq "n"){
	    next;
	} elsif ($answer eq "q"){
	    exit 0;
	}
        unlink $file or die "$!";
    }
} else {
    print "\nNo errors found\n";
}
1;
