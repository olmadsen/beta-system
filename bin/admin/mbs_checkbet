#!/usr/local/bin/perl5 -s
#-*-Perl-*-

require "dirlist";

print "Checking that .bet file is present for each .ast(L) file in $RELEASE\n";

$match='\.ast[lL]?$';

foreach $dir (@Dirs) {
    next if (!$CompileFlag{$dir});
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    print "*** Checking $basedir ***\n";
    foreach $curdir (&GetDirsRecursively($basedir)) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /$match/) {
              $betfile = $file;
              $betfile =~ s/$match/.bet/g;
              $textfile = $file;
              $textfile =~ s/$match/.text/g;
              $gramfile = $file;
              $gramfile =~ s/$match/.gram/g;
	      if (! (-f $betfile || -f $textfile || -f $gramfile)){
                    $numerrs++;
		    print "ERROR#$numerrs: Missing .bet, .text or .gram file for:\n  $file\n";
	      } 
	    }
	}
    }
}
print "$numerrs errors found\n";
	    
1;
