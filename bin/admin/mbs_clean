#!/usr/local/bin/perl5 -s
#-*-Perl-*-

require "dirlist";

$match='(\~$)|(^\#.*\#$)|(\.lst$)|(\.\.job$)|(\.dump$)|(\.\.gs$)|(\.\.s$)|(\.\.dbc$)|(\.s\.db$)';

if ("$MACHINETYPE" eq "NTI"){
    $match .= '|(\.rr$)|(\.ro$)|(\.pdb$)|(\.ilk$)|(\.rsp$)';
}

print "This script will recursively remove files matching \n  $match\nfrom $RELEASE.\n\n";

print "Are you sure that you want to do this (no/yes) ";

$yes = &GetAnswer();
exit if ($yes ne 'yes');

print "\nWould you like to be prompted for each directory? (yes/no) ";
$doprompt = &GetAnswer();

foreach $dir (@Dirs) {
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    if ($doprompt eq "yes"){
	print  "Recursively remove files matching\n\t$match\n";
	print "  from $basedir? (y/n/q) ";
	$answer = &GetAnswer();
	if ($answer eq "y"){
	    # just go on
	} elsif ($answer eq "n"){
	    next;
	} elsif ($answer eq "q"){
	    exit 0;
	}
    } else {
	print "**** Removing from $basedir ****\n";
    }
    foreach $curdir (&GetDirsRecursively($basedir)) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /$match/) {
		print "$file\n";
		if (!$simulate) {
		    unlink $file || print "Unable to delete file $file\n";
		}
	    }
	}
    }
}
