#!/usr/local/bin/perl5 -s
#-*-Perl-*-

require "dirlist";

print "Checking that .db file is present for each .bet file in $RELEASE\n";

$match="\.bet\$";
    
foreach $dir (@Dirs) 
{
    # next if (!$CompileFlag{$dir});
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    print "*** Checking $basedir ***\n";
    foreach $curdir (&GetDirsRecursively($basedir)) {
	if ($curdir =~ /\/demo\//) {
	    print "  [skipped $curdir]\n" if ($verbose);
	    next;
	}
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    next if (!($file =~ /$match/));
	    if ($file =~ /^$curdir\/(.*)$/) {
		$file = $1;
	    } else {
		print "Cannot find $curdir in $file\n";
	    }
	    foreach $type (@ObjDirs) {
		next if ($type eq "hpux9pa");
		$dir = "$curdir/$type";
		next if (!-d $dir);
		($basefile = "$dir/$file") =~ s/$match//g;
		if (-f "$basefile.$ObjExt{$type}" && !-f "$basefile.db") {
		    $numerrs++;
		    print "ERROR#$numerrs: Missing db file:\n  $basefile.db\n";
		} elsif ($debug) {
		    print "Found !$basefile.$ObjExt{$mach} || $basefile.db\n";
		}
	    }
	}
    }
}

if ($numerrs > 0) {
    print "\n$numerrs errors found.\n";
} else {
    print "\nNo errors found.\n";
}

1;
