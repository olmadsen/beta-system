#!/usr/local/bin/perl

# Script to compile betarun

$betalib = $ENV{"BETALIB"};
$betalib =~ s/\\/\//g;
if ($betalib eq "") { die "\$BETALIB is not set" }
$ENV{"BETALIB"} = $betalib;

$betarun_dir = $betalib . "/betarun-src";

$arch = $^O;
$make = "gmake";
$gnuc = "yes";
$copy = "cp";
$exe = "";

if ($arch =~ /win/i) {
  $copy = "copy";
  $exe = ".exe";
  $arch = "nti_" . $ENV{"MIA_SDK"};
  $arch =~ tr/A-Z/a-z/;
  $runtype = "run";
  if ($arch eq "nti_ms") {
    $gnuc = "no";
  } elsif ($runtype eq "nti_gnu") {
  } else {
    die "\$MIA_SDK is not set";
  }
} elsif ($arch eq "linux") {
  $make = "make";
  $runtype = "run";
} elsif ($arch eq "irix") {
  $arch = "sgi";
  $runtype = "newrun";
  $gnuc = "no";
} elsif ($arch eq "solaris") {
  $arch = "sun4s";
  $runtype = "crun";
} elsif ($arch eq "hpux") {
  $arch = "hpux9pa";
  $runtype = "crun";
} else {
  die "Couldn't recognise $arch as a valid BETA-supported architecture";
}

if ($ARGV[0] =~ /^--?V/ ||
    $ARGV[0] =~ /^--?h/ ||
    $ARGV[0] =~ /^--?u/) {
    print stderr "mbs_mkboot: Move current files to boot area for checking in.\n";
    exit 1;
}

chdir($betalib) || die "Couldn't change directory to BETALIB ($betalib)";

system($copy, "$betalib/bin/$arch/beta$exe", "$betalib/boot/bin/$arch/beta$exe") && die ("beta$exe");
system($copy, "$betalib/bin/$arch/rungen$exe", "$betalib/boot/bin/$arch/rungen$exe")  && die ("rungen$exe")if ($runtype eq "run");
