#!/usr/local/bin/perl5 -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h){
    print "Usage: mbs_unfreeze [-h][-u]\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -n   No effects - only print what would be done\n";
    print "          -u   Use defaults - ask no questions\n";
    print "       Gives write permission for all files in BETALIB\n";
    exit 0;
}

require "dirlist";

if ($MACHINETYPE eq "NTI") { # windows
    $command="attrib -r /s *";
} else { # unix
    $command='chmod -fR u+w .';
}

#--------- don't change below 

if (!$UseDefaults) {
    print "This script will recursively add write-permission for\n";
    print "all files and directories in MBS $RELEASE.\n\n";
    
    print "Are you sure that you want to do this? (no/yes) ";
    
    $yes = &GetAnswer();
    exit if ($yes ne 'yes');
    
    print "\nWould you like to be prompted for each directory? (yes/no) ";
    $doprompt = &GetAnswer();
}

foreach $dir (@Dirs) {
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    if (!$UseDefault && $doprompt eq "yes"){
	print "\nRecursively add write-permission for\n";	
	print "all files and directories in \n";
	print "  $basedir? (y/n/q) ";
	$answer = &GetAnswer();
	if ($answer eq "y"){
	    # just go on
	} elsif ($answer eq "n"){
	    next;
	} elsif ($answer eq "q"){
	    exit 0;
	}
    } else {
	print "**** Changing permissions in $basedir\n";
    }
    print "cd $basedir\n" if ($verbose);
    chdir(&path($basedir)) || die "cannot chdir($basedir)";
    print "$command\n" if ($verbose);
    system "$command";
    exit(1) if ($?);
}
