#!/usr/local/bin/perl5 -s

open(STDERR, ">&STDOUT") || die "Can't dup stdout";
select(STDERR); $| = 1;       # make unbuffered
select(STDOUT); $| = 1;       # make unbuffered

$find = "find . -type d -name CVS -print -prune";
$cvsupdate = "cvs update";

open(LST,"$find|");

$path = "abe";

while ( <LST> ) {
   $line = $_;
   if ( index($line,$path) != 0 ) {
      $path = substr($line,0,length($line)-4);
      if ( ! $l ) { print "==========================================\n"; };
      print "CVS working directory found in: $path\nCVS Tag: ";
      system("sh -c 'cd $path; cat CVS/Tag'");
      if ( ! $l ) { 
         system("sh -c 'cd $path; $cvsupdate'");
      }
   }

}
close LST;
