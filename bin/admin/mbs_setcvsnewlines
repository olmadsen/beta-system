#!/usr/local/bin/perl -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h){
    print "Usage: mbs_setcvsnewlines [-h][-u] [-U|-W] [-l]\n";
    print "          -h   Print this help\n";
    print "          -u   Use defaults - ask no questions\n";
    print "          -U   Change to UNIX newline\n";
    print "          -W   Change to Windows newline\n";
    print "          -l   Change in local directory instead of default BETALIB\n";
    print "       Change newline type in all administration files in all CVS directories in BETALIB\n";
    exit 0;
}

require "env.perl";

$UseDefaults = 1 if ($u);

$newline = "unix" if ($U);
$newline = "windows" if ($W);

if (!defined($newline)){
   print "You must specify either -U or -W\n";
   exit;
}

$basedir = "$betalib";
$basedir = "." if (defined ($l));

print "This script will recursively change all administration files in all CVS directories\nin $basedir to have \U$newline \Lnewlines.\n\n";

print "Do you want to do this? (no/yes) ";

$yes = &GetAnswer();
exit if ($yes ne 'yes');

print "Finding CVS directories ... ";
$debug = 1 if ($verbose);
@dirs = &GetDirsRecursively($basedir);
$debug = 0;
print "done.\n";
foreach $curdir (@dirs) {
    if ($curdir =~ /CVS/) {
	@cvsfiles = <$curdir/*>;
	print "\nChanging:\n" . join ("\n  ", @cvsfiles) if ($verbose);
	if ($W){
	    system "perl $betalib/bin/admin/unix2nt " . join(" ", @cvsfiles);
	} else {
	    system "perl $betalib/bin/admin/nt2unix " . join(" ", @cvsfiles);
	}	    
    }
}
print "\n";
	    
1;
