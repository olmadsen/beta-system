#!/usr/local/bin/perl

$htpasswd = "/usr/local/www/bin/htpasswd";
$pserverpasswd = "/users/beta/.CVSHOME/CVSROOT/passwd";

if ($#ARGV!=0){
   print "Usage: mbs_add_pserver_user username\n";
   exit 1;
}

if (! -e "$htpasswd"){
   print "$htpasswd not found. You must run this on webserver\n";
   exit 1;
}

$user = $ARGV[0];

print "Adding pserver password for user $user.\n";
$passwd = `$htpasswd -n $user`;
if ($? == -1) {
    print "htpasswd failed: $!\n";
    exit 1;
}
$/ = ""; # make chomp remove any trailing newlines
chomp $passwd;

$passwd .= ":beta";

print "adding '$passwd' to '$pserverpasswd'.\n";

open PSERVERPASSWD, ">>$pserverpasswd" || die "Failed to open $pserverpasswd for append: $!\n";
print PSERVERPASSWD "$passwd\n";
close PSERVERPASSWD;
