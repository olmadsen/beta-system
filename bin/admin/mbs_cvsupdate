#!/usr/local/bin/perl5 -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h || ($#ARGV>0)){
    print "Usage: mbs_cvsupdate [-h][-u][-s][-f][-c] [dir]\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -n   No effects - show update status of files\n";
    print "          -u   Use defaults - ask no questions\n";
    print "          -s   Skip check of .bet/.ast consistency after update\n";
    print "          -g   Generate CVS commands on stdout instead of executing\n";
    exit 0;
}

$UseDefaults = 1 if ($u);
$SkipBetCheck = 1 if ($s);
$Generate = 1 if ($g);

if ($Generate){
    print "Generating CVS commands on stdout instead of executing\n";
	$UseDefaults=1;
	$simulate = 1;
}

require "env.perl";

print "This script will do a 'cvs update' of the entire $betalib.\n";
if (!$UseDefaults) {
    print "Are you sure that you want to update the entire BETALIB? (no/yes) ";

    $yes = &GetAnswer();
    exit if ($yes ne 'yes');
}

$basedir = "$betalib";
if (!-d &path("$basedir/CVS")) {
    print "Missing CVS directory in $betalib!  Bailing out! \n";
    exit 1;
}

&Chdir("$basedir");
$oldsimulate = $simulate;
$simulate = 0;
&cvs("-q  update -Pd") unless ($oldsimulate);
&cvs("-qn update -Pd") if     ($oldsimulate);
if ($?) {
    print "CVS command failed - probably due to conflicts.\n";
    print "Look for a line that starts 'C '\n";
    exit(1);
}

$simulate = $oldsimulate;
$UseDefaults=1;
require &path("$betalib/bin/admin/mbs_checkbet") if (!$SkipBetCheck);
