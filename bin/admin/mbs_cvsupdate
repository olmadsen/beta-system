#!/usr/local/bin/perl5 -s
#-*-Perl-*-
require "dirlist";

print "This script will do a 'cvs update' in each directory in $betalib.\n";
print "Are you sure that you want to update in all of these directories? (no/yes) ";

$yes = &GetAnswer();
exit if ($yes ne 'yes');

print "Really sure? ";
$yes = &GetAnswer();
exit if ($yes ne 'yes');

print "\nWould you like to be prompted for each directory? (yes/no) ";
$doprompt = &GetAnswer();

foreach $dir (@Dirs) {
    if ($CvsTags{$dir} =~ /^\%(\S+)/) {
	next if ($1 eq 'IGNORE');
	next if ($1 eq 'NONCVS');
	print "Unknown '%'-tag in CvsTag: \"$1\", skipping $dir\n";
	next;
    }
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    if ($doprompt eq "yes"){
	print  "\nPerform 'cvs update' in \n";
	print "  $basedir? (y/n/q) ";
	$answer = &GetAnswer();
	if ($answer eq "y"){
	    # just go on
	} elsif ($answer eq "n"){
	    next;
	} elsif ($answer eq "q"){
	    exit 0;
	}
    } else {
	print "**** cvs update in $basedir ****\n";
    }
    chdir &path($basedir) or die "Unable to chdir: $!";
    &cvs("-q update") if (!$simulate);
    exit(1) if ($?);
}
