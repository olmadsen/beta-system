#!/bin/sh

#set -x

DIFFFLAGS=

if [ ! -f /usr/bin/sun ]
then
	echo $0: warning: only known to work on Sun\!
	#exit 1
fi

REPOSITORY=`cat CVS/Repository | sed -e "s%${CVSROOT}/%%"`

#echo testing cvscom: REPOSITORY is \"$REPOSITORY\".

echo "Checking for changed files"
files=`cvs -Q diff $* -q | grep "^RCS" | sed -e "s%RCS file: ${CVSROOT}/${REPOSITORY}/\(.*\),v%\1%" | grep -v "^RCS"`

if [ "$files" != "" ]
then
  echo "Diffing and committing"
fi

for f in $files
do
	if [ -z "$DISPLAY" ]; then
	   # pipe through less to allow seing the diff before the editor starts
           cvs -Q diff -qwB $DIFFFLAGS $f | less
        else
           cvs -Q diff -qwB $DIFFFLAGS $f 
        fi
        cvs commit $f
done
