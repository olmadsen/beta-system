#!/usr/local/bin/perl5 -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h){
    print "Usage: mbs_cvscheckupdate [ -h ]\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -n   No effects - only print what would be done\n";
    print "       Checks if cvs update is needed in BETALIB\n";
    exit 0;
}

require "dirlist";

$|=1;

print "Checking if cvs update is needed (by means of cvs -n update)\n  in $betalib.\n";
print "  Notice: Will not check for missing directories!\n";

foreach $dir (@Dirs) {
    if ($CvsTags{$dir} =~ /^\%(\S+)/) {
	next if ($1 eq 'IGNORE');
	next if ($1 eq 'NONCVS');
	print "Unknown '%'-tag in CvsTag: \"$1\", skipping $dir\n";
	next;
    }
    $basedir = "$betalib/$dir";
    next if (!-d &path($basedir));
    if (!-d &path("$basedir/CVS")) {
	print "Missing CVS directory in $dir!  Skipping! \n";
	print "If you want to update $dir, please rename it and restart.\n";
	next;
    }
    print "**** cvs -qn update in $basedir ****\n";
    chdir &path($basedir) or die "Unable to chdir: $!";
    &cvs("-qn update");
    exit(1) if ($?);
}
