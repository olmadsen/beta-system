#!/usr/local/bin/perl5
#-*-Perl-*-

$betalib=$ENV{'BETALIB'} || die "BETALIB must be set!\n";
$betalib =~ s#\\#/#g;
$dirs=require "$betalib/bin/admin/dirlist";

$|=1;

print "checking if cvs update is needed (by means of cvs -n update) in $RELEASE\n";

foreach $dir (split ' ', $dirs) {
    if ($CvsTags{$dir} =~ /^\%(\S+)/) {
	next if ($1 eq 'IGNORE');
	next if ($1 eq 'NONCVS');
	print "Unknown '%'-tag in CvsTag: \"$1\", skipping $dir\n";
	next;
    }
    ($basedir ="$betalib/$dir") =~ s#/$##;
    next if (! -d $basedir);
    print "**** cvs -n update in $basedir ****\n";
    chdir "$basedir" or die "Unable to chdir: $!";
    system("cvs -qn update");
    exit(1) if ($?);
}
