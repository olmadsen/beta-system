#!/usr/local/bin/perl -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h){
    print "Usage: mbs_etags [-h]\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -f   Skip some directories\n";
    print "          -n   No effects - only print what would be done\n";
    print "       Creates Emacs TAGS files for all files in BETALIBn\n";
    exit 0;
}

require "env.perl";

$FastMode = $f;

print "Creating emacs TAGS file $betalib/TAGS.\n";

@TopDirs = &GetDirsInDir($betalib);

foreach $dir (@TopDirs) {
    if ($FastMode && ($dir =~ m/^(doc|CVS|bin|\.\.|\.)$/)){
	print "*** Fastmode: SKIPPED: $dir ***\n";
	next;
    } else {
	print "*** Searching $dir ***\n";
    }

    foreach $curdir (&GetDirsRecursively("$betalib/$dir")) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /CHANGES|\.(bet|c|h|make|text|txt|gram)$/) {
		push @Files, $file;
	    }
	}
    }
}

print "Tagging (be patient) ...";
system("etags -o $betalib/TAGS -l none @Files");
print " done.\n"
