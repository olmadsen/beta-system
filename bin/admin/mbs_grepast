#!/usr/local/bin/perl -s
#-*-Perl-*-

push(@INC, $ENV{'BETALIB'} . "/bin/admin");

if ($h || ($#ARGV != 0)){
    print "Usage: mbs_grepast [ -h ] pattern\n";
    print "          -h   Print this help\n";
    print "          -v   Verbose output\n";
    print "          -n   No effects - only print what would be done\n";
    print "       Runs a case-insensitive search for pattern\n";
    print "       through all binary AST-files in BETALIB\n";
    exit 0;
}

require "dirlist";

$pat = shift @ARGV;
print "Ast files in $RELEASE matching \"$pat\":\n";

foreach $dir (@Dirs) {
    foreach $curdir (&GetDirsRecursively("$betalib/$dir")) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /\.(ast[lL]?)$/) {
		print "$file\n" if ($verbose);
		open (IN, $file) || die "Unable to open $file: $!";
		$n = 1;
		foreach (<IN>) {
		    if (/$pat/oi) {
			print "$file:$n:$_";
		    }
		    $n++;
		}
		close IN;
	    }
	}
    }
}
