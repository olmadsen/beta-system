#!/usr/local/bin/perl5 -s
#-*-Perl-*-

require "dirlist";

if ($#ARGV != 0) {
    print "Usage $0 pattern\n";
    exit 1;
}

$pat = shift @ARGV;
print "Ast files in $RELEASE matching \"$pat\":\n";

foreach $dir (@Dirs) {
    foreach $curdir (&GetDirsRecursively("$betalib/$dir")) {
	@files = &GetFilesInDirs($curdir);
	foreach $file (@files) {
	    if ($file =~ /\.(ast[lL]?)$/) {
		print "$file\n" if ($verbose);
		open (IN, $file) || die "Unable to open $file: $!";
		$n = 1;
		foreach (<IN>) {
		    if (/$pat/oi) {
			print "$file:$n:$_";
		    }
		    $n++;
		}
		close IN;
	    }
	}
    }
}
