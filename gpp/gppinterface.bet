ORIGIN '~beta/designenv/v1.5/designenv';
BODY 'private/diagramattributes'
     'private/menubody'
     'private/OADobjectpagebody'
     'private/objectdiagrambody'
     'private/objectmenubody'
     'private/userdatabody';
INCLUDE '~beta/designenv/v1.5/designenvutils'
        '~beta/mps/v4.9/metagrammarcfl'
        '~beta/betaast/v4.9/betasematt'
        '~beta/betaast/v4.9/gram'
        'indexIDList'
        '~beta/containers/v1.4/list';
-- lib: Attributes --
containerlist: list (# #);
GppInterface: astInterface (* interface to AST *)
  (#
     switch: [100] @boolean;
     (* swithes for GPP, info messages, debugging etc *)
     (* 1  = general debugging
      * 2  = display info messages in info bar
      *)
     trace:
       (# s: @Integer; T: @Text;
       enter s
       do
          (if switch[s]
           // true then
              '%'->screen.put;
              s->screen.putint;
              ': '->screen.puttext;
              INNER ;
              T[]->screen.putline;
          if)
       #);
     updateFragmentForm:<
     (* used in Frejas sifEditorList, when the fragmentform is updated *)
       (# oldff,ff: ^fragmentForm; enter (oldff[],ff[]) do INNER #);
     theDesignInterface: @DesignInterface;
     DesignInterface:< designenv (* interface to OO DesignEnvironment *)
       (#
          IndexIDList: @IndexIDListDesc
            (#
               insert::< 
                 (# do <<SLOT IndexIDListInsert:ObjectDescriptor>> #)
            #);
          onInit::< 
            (#
            (* initialize the application here, e.g. the user menus *)
            do
               DocFileMenu.init;
               (* we like the file menu *)
               INNER ;
               doStartUp;
            #);
          (* special handling of standard application menus *)
          FileMenu::< 
            (#
               iOpen::< 
                 (#
                    hit::<  (# do <<SLOT FileOpen:ObjectDescriptor>> #);
                    init::< 
                      (#
                      do
                      (* toby 7-11-94: In comment for test purposes
                       true
                       ->
                       precall*)
                      #);
                 #);
               iNew::< 
                 (#
                    hit::<  (# do <<SLOT FileNew:ObjectDescriptor>> #);
                    init::< 
                      (#
                      do true->precall
                      #);
                 #);
               iSaveAs::< 
                 (#
                    hit::< 
                      (#
                      do
                         <<SLOT FileSaveAs:ObjectDescriptor>>
                      #)
                 #);
            #);
          OADDocument:< Document (* my special document *)
            (#
               onInit::< 
                 (# do <<SLOT OADDocumentInit:ObjectDescriptor>> #);
               ObjectPage:< Page
                 (#
                    ShowDynamicCreations,showProcedureCalls: @Boolean;
                    onInit::<  (# do <<SLOT onInit:ObjectDescriptor>>; #);
                    ObjectdiagramNode: (* Abstract superclass *) genericnode
                      (#
                         Parentnode: ^DetailedObjectNode;
                         theDecl: ^betaGram.NameDcl;
                         theObjectDescriptor: ^betaGram.ObjectDescriptor;
                         titletext: @Text;
                         oldPosition: @Point;
                         display:<
                           (# drawOnly: @Boolean
                           enter (theDecl[],theObjectDescriptor[],drawOnly)
                           do
                              <<SLOT ObjectDiagramNodeDisplay:ObjectDescriptor>>;
                           #);
                         overview:
                           (#
                           do
                              <<SLOT ObjectDiagramNodeOverview:ObjectDescriptor>>;
                           #);
                         getPage: (# exit THIS(ObjectPage)[] #);
                         onSelect::< 
                           (#
                           do
                              <<SLOT ObjectdiagramNodeOnSelect:ObjectDescriptor>>;
                           #);
                         onDrag::< 
                           (#
                           do
                              <<SLOT ObjectdiagramNodeOnDrag:ObjectDescriptor>>;
                           #)
                      #);
                    AbstractedObjectnode: ObjectdiagramNode
                      (#
                         pagelink: ^ObjectPage;
                         display::< 
                           (#
                           do
                              <<SLOT AbstractedObjectNodeDisplay:ObjectDescriptor>>
                           #);
                         onDoubleclick::< 
                           (#
                           do
                              <<SLOT AbstractedObjectNodeOnDoubleclick:ObjectDescriptor>>;
                           #);
                         detail:<
                           (# detailnode: ^DetailedObjectNode
                           do
                              <<SLOT AbstractedObjectNodeDetail:ObjectDescriptor>>
                           exit detailnode[]
                           #);
                         detailRecursive:<
                           (# detailnode: ^DetailedObjectNode
                           do
                              <<SLOT AbstractedObjectNodeDetailRecursive:ObjectDescriptor>>
                           #)
                      #);
                    DetailedObjectnode: ObjectdiagramNode
                      (#
                         ODNodes: (* List of component objectdiagramnodes *)
                           @containerlist
                           (# element::< ObjectdiagramNode #);
                         regionObject: ^genericnode;
                         startX,startY: @Integer;
                         nextX,nextY: @Integer;
                         column: @Integer;
                         row: @Integer;
                         oldRow: @Integer;
                         ShowSimpleObjects: @boolean;
                         calculateBox:
                           (# x,y,w,h: @Integer
                           do
                              <<SLOT DetailedObjectNodeCalculateBox:ObjectDescriptor>>
                           exit (x,y,w,h,RndRect)
                           #);
                         display::< 
                           (#
                           do
                              <<SLOT DetailedObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         redisplay:<
                           (# theDetailed: ^DetailedObjectNode
                           enter theDetailed[]
                           do
                              <<SLOT DetailedObjectNodeRedisplay:ObjectDescriptor>>
                           #);
                         onDoubleClick::< 
                           (#
                           do
                              <<SLOT DetailedObjectNodeOnDoubleClick:ObjectDescriptor>>
                           #);
                         abstract:<
                           (# node: ^AbstractedObjectNode
                           do
                              <<SLOT DetailedObjectNodeAbstract:ObjectDescriptor>>
                           #);
                         abstractRecursive:<
                           (# node: ^AbstractedObjectNode
                           do
                              <<SLOT DetailedObjectNodeAbstractRecursive:ObjectDescriptor>>
                           #);
                         showSimple:<
                           (#
                           do
                              <<SLOT DetailedObjectNodeShowSimple:ObjectDescriptor>>;
                           #);
                         hideSimple:<
                           (#
                           do
                              <<SLOT DetailedObjectNodeHideSimple:ObjectDescriptor>>;
                           #);
                         compact:<
                           (#
                           do
                              <<SLOT DetailedObjectNodeCompact:ObjectDescriptor>>;
                           #);
                         blowup:<
                           (#
                           do
                              <<SLOT DetailedObjectNodeBlowup:ObjectDescriptor>>;
                           #)
                      #);
                    AbstrOperationObjectnode: AbstractedObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT AbstrOperationObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         detail::< 
                           (#
                           do
                              <<SLOT AbstrOperationObjectNodeDetail:ObjectDescriptor>>
                           #)
                      #);
                    AbstrPartObjectNode: AbstractedObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT AbstrPartObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         detail::< 
                           (#
                           do
                              <<SLOT AbstrPartObjectNodeDetail:ObjectDescriptor>>;
                           #)
                      #);
                    AbstrRepPartObjectNode: AbstrPartObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT AbstrRepPartObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         detail::< 
                           (#
                           do
                              <<SLOT AbstrRepPartObjectNodeDetail:ObjectDescriptor>>;
                           #)
                      #);
                    DetailPartObjectNode: DetailedObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT DetailPartObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         Abstract::< 
                           (#
                           do
                              <<SLOT DetailPartObjectNodeAbstract:ObjectDescriptor>>
                           #)
                      #);
                    DetailRepPartObjectNode: DetailPartObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT DetailRepPartObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         Abstract::< 
                           (#
                           do
                              <<SLOT DetailRepPartObjectNodeAbstract:ObjectDescriptor>>
                           #)
                      #);
                    AbstrDynamicObjectNode: AbstractedObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT AbstrDynamicObjectNodeDisplay:ObjectDescriptor>>;
                           #);
                         detail::< 
                           (#
                           do
                              <<SLOT AbstrDynamicObjectNodeDetail:ObjectDescriptor>>;
                           #)
                      #);
                    DetailDynamicObjectNode: DetailedObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT DetailDynamicObjectNodeDisplay:ObjectDescriptor>>
                           #);
                         Abstract::< 
                           (#
                           do
                              <<SLOT DetailDynamicObjectNodeAbstract:ObjectDescriptor>>
                           #)
                      #);
                    DetailOperationObjectNode: DetailedObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT DetailOperationObjectNodeDisplay:ObjectDescriptor>>
                           #);
                         Abstract::< 
                           (#
                           do
                              <<SLOT DetailOperationObjectNodeAbstract:ObjectDescriptor>>
                           #)
                      #);
                    AbstrPartComponentNode: AbstrPartObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT AbstrPartComponentNodeDisplay:ObjectDescriptor>>
                           #);
                         detail::< 
                           (#
                           do
                              <<SLOT AbstrPartComponentNodeDetail:ObjectDescriptor>>
                           #)
                      #);
                    AbstrDynamicComponentNode: AbstrDynamicObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT AbstrDynamicComponentNodeDisplay:ObjectDescriptor>>
                           #);
                         detail::< 
                           (#
                           do
                              <<SLOT AbstrDynamicComponentNodeDetail:ObjectDescriptor>>
                           #)
                      #);
                    DetailPartComponentNode: DetailPartObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT DetailPartComponentNodeDisplay:ObjectDescriptor>>;
                           #);
                         Abstract::< 
                           (#
                           do
                              <<SLOT DetailPartComponentNodeAbstract:ObjectDescriptor>>
                           #)
                      #);
                    DetailDynamicComponentNode: DetailDynamicObjectNode
                      (#
                         display::< 
                           (#
                           do
                              <<SLOT DetailDynamicComponentNodeDisplay:ObjectDescriptor>>;
                           #);
                         Abstract::< 
                           (#
                           do
                              <<SLOT DetailDynamicComponentNodeAbstract:ObjectDescriptor>>
                           #)
                      #);
                    newConnector:
                      (# node1,node2: ^ObjectdiagramNode
                      enter (node1[],node2[])
                      do <<SLOT newConnector:ObjectDescriptor>>;
                      #);
                    newDynConnector:
                      (#
                         node1,node2:
                           ^ObjectdiagramNode
                      enter (node1[],node2[])
                      do <<SLOT newDynConnector:ObjectDescriptor>>;
                      #);
                    changedFocus:<
                      (# anAST: ^AST
                      enter anAST[]
                      do INNER
                      #);
                    Activate::< 
                      (#
                      do
                         <<SLOT Activate:ObjectDescriptor>>;
                      #)
                 #);
               ObjectPrivate: @<<SLOT ObjectPrivate:ObjectDescriptor>>
               (*kja&toby 1.9.94kja&toby 1.9.94*) ;
               OADObjectPage:< Page
                 (#
                    onInit::< 
                      (# do <<SLOT OADObjectPageInit:ObjectDescriptor>> #);
                    ObjectNode: RndRectNode
                      (#
                         onInit::< 
                           (# innerBox: ^DesignObject;
                           do <<SLOT ObjectNodeInit:ObjectDescriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (# do Cursor.roundedbox->curs #)
                           #);
                      #);
                    PassiveObject: ObjectNode
                      (#
                         onInit::< 
                           (#
                           do <<SLOT PassiveObjectInit:ObjectDescriptor>>
                           #)
                      #);
                    MultipleObject: ObjectNode
                      (#
                         onInit::< 
                           (#
                           do <<SLOT MultipleObjectInit:ObjectDescriptor>>
                           #)
                      #);
                    ConcurrentObject: ObjectNode
                      (#
                         onInit::< 
                           (#
                           do <<SLOT ConcurrentObjectInit:ObjectDescriptor>>
                           #)
                      #);
                    InteractionRelation: Connector
                      (#
                         onInit::< 
                           (#
                           do <<SLOT InteractionRelationInit:ObjectDescriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (# do Cursor.connector->curs #)
                           #);
                      #);
                    TwoWayInteractionRelation: Connector
                      (#
                         onInit::< 
                           (#
                           do
                              <<SLOT TwoWayInteractionRelationInit:ObjectDescriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (# do Cursor.connector->curs #)
                           #);
                      #);
                    DistributedInteractionRelation: Connector
                      (#
                         onInit::< 
                           (#
                           do
                              <<SLOT DistributedInteractionRelationInit:ObjectDescriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (# do Cursor.connector->curs #)
                           #);
                      #);
                    TwoWayDistributedInteractionRelation: Connector
                      (#
                         onInit::< 
                           (#
                           do
                              <<SLOT TwoWayDistributedInteractionRelationInit:ObjectDescriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (# do Cursor.connector->curs #)
                           #);
                      #);
                    PatternNode: RectNode
                      (#
                         onInit::< 
                           (#
                           do <<SLOT PatternNodeInit:ObjectDescriptor>>
                           #)
                      #);
                    PatternPattern:
                     PatternNode
                      (#
                         onInit::< 
                           (#
                           do <<SLOT PatternPatternInit:ObjectDescriptor>>
                           #)
                      #);
                    VirtualPattern:
                     PatternNode
                      (#
                         onInit::< 
                           (#
                           do <<SLOT VirtualPatternInit:ObjectDescriptor>>
                           #)
                      #);
                 #);
               OADPage:< Page
                 (#
                    onInit::< 
                      (#
                      do
                         <<SLOT OADPageOnInit:ObjectDescriptor>>;
                         INNER
                      #);
                    <<SLOT OADPageLib:AttributeDecl>>;
                    myNode: Node
                      (#
                         initialisingSaved:
                           @Boolean
                         (*toby 7-11-94:
                          If initialisingSaved=true then we are reestablishing
                          saved diagram. onInit does not have to do all
                          the usual work!*) ;
                         ASTReferenceUserData: ReferenceUserData
                           (#
                              theFrag: @FragReferenceUserData
                                (# Type::< FragmentForm #);
                              WriteUserData::< 
                                (# theAST: ^AST
                                do
                                   <<SLOT WriteASTReferenceUserData:ObjectDescriptor>>;
                                #);
                              ReadUserData::< 
                                (#
                                   ASTIndex: @integer;
                                   theFragmentForm: ^FragmentForm
                                do
                                   <<SLOT ReadASTReferenceUserData:ObjectDescriptor>>;
                                #);
                              Init::< 
                                (#
                                do
                                   <<SLOT InitASTReferenceUserData:ObjectDescriptor>>;
                                #)
                           #)
                           (*toby 1-11-94:
                            Specialization of ReferenceUserData handling
                            persistent references to AST nodes*)
                           ;
                         PointUserData: UserData
                           (#
                              thePoint: @Point;
                              x,y: @IntegerUserData;
                              WriteUserData::< 
                                (# ok: @Boolean
                                enter thePoint
                                do
                                   <<SLOT WritePointUserData:ObjectDescriptor>>;
                                #);
                              ReadUserData::< 
                                (# ok: @Boolean
                                do
                                   <<SLOT ReadPointUserData:ObjectDescriptor>>;
                                exit thePoint
                                #);
                              Init::< 
                                (#
                                do
                                   <<SLOT InitPointUserData:ObjectDescriptor>>;
                                #)
                           #)
                           (*toby 28-11-94:
                            Handles persistent point attributes.*)
                           ;
                         DiagramReferenceUserData: ReferenceUserData
                           (#
                              WriteUserData::< 
                                (# theDiagram: ^Diagram; IDData: @integer
                                do
                                   <<SLOT WriteDiagramReferenceUserData:ObjectDescriptor>>;
                                #);
                              ReadUserData::< 
                                (#
                                   IDData: @Integer;
                                   theNode: ^PatternDiagramNode
                                do
                                   <<SLOT ReadDiagramReferenceUserData:ObjectDescriptor>>;
                                #);
                              Init::< 
                                (#
                                do
                                   <<SLOT InitDiagramReferenceUserData:ObjectDescriptor>>;
                                #)
                           #);
                         FragReferenceUserData: ReferenceUserData
                           (#
                              theFragName: @ReferenceUserData
                                (# Type::< Text #);
                              theGroupName: @ReferenceUserData
                                (# Type::< Text #);
                              WriteUserData::< 
                                (#
                                do
                                   <<SLOT WriteFragReferenceUserData:ObjectDescriptor>>;
                                #);
                              ReadUserData::< 
                                (#
                                do
                                   <<SLOT ReadFragReferenceUserData:ObjectDescriptor>>;
                                #);
                              Init::< 
                                (#
                                do
                                   <<SLOT InitFragReferenceUserData:ObjectDescriptor>>;
                                #)
                           #);
                         LocalNodesUDAttributes: @integerUserData
                           (#
                              init::< 
                                (#
                                do
                                   LocalNodesUserDataEnd->attributeID;
                                   true->specialData
                                #)
                           #)
                           (*toby 1-12-94: special part of UD field for LocalNodes*)
                           ;
                         oldLocalNodesUDAttributes: @integerUserData
                           (#
                              init::< 
                                (#
                                do
                                   LocalNodesUserDataEnd-1->attributeID;
                                   true->specialData
                                #)
                           #)
                           (*toby: onInit saved number of localNodes is stored here*)
                           ;
                         LocalNodesReferenceUserData: ReferenceUserData
                           (#
                              InitLocalNode:<
                                (#
                                do <<SLOT InitLocalNode:ObjectDescriptor>>
                                #)
                           #);
                         ;
                         decomposDiagramsUDAttributes: @integerUserData
                           (#
                              init::< 
                                (#
                                do
                                   decomposDiagramsUserDataEnd->attributeID;
                                   true->specialData
                                #)
                           #)
                           (*toby 1-12-94: special part of UD field for decomposDiagrams*)
                           ;
                         oldDecomposDiagramsUDAttributes: @integerUserData
                           (#
                              init::< 
                                (#
                                do
                                   decomposDiagramsUserDataEnd-1->attributeID;
                                   true->specialData
                                #)
                           #)
                           (*toby: onInit saved number of decomposDiagrams is stored here*)
                           ;
                         decomposDiagramsReferenceUserData: ReferenceUserData
                           (#
                              InitDecomposDiagram:<
                                (#
                                do
                                   <<SLOT InitDecomposDiagram:ObjectDescriptor>>
                                #)
                           #);
                         onInit::< 
                           (#
                           do <<SLOT myNodeOnInit:ObjectDescriptor>>;
                           #)
                      #)
                      (*toby: node defining general user data patterns used in gpp*)
                      ;
                    myGenericNode: myNode
                      (#
                         New::<  (# enter shape do INNER #);
                         InteractiveNew::<  (# enter shape do INNER #)
                      #);
                    myRectNode: myNode
                      (# New::<  (# do Rectangle->shape; INNER #)
                      #);
                    myEllipseNode: myNode
                      (# New::<  (# do Ellipse->shape; INNER #) #);
                    PatternDiagramNode: myGenericNode
                      (#
                      (* abstract superpattern for all nodes in the diagrams *)
                         defaultShape: @IntegerUserData;
                         theMarkNode: @ReferenceUserData
                           (# Type::< MarkNode
                           #)
                           (*the MarkNode of this PatternDiagramNode - if any. *)
                           ;
                         theDiagram: @DiagramReferenceUserData
                           (# Type::< Diagram #);
                         (* the diagram this nodes belongs to *)
                         (* pattern diagrams *)
                         abstract:< Object;
                         detail:< Object;
                         abstractedFromDiagramBelow:< Object;
                         astIndex: @IntegerUserData;
                         getAstNode:<
                           (# anAST: ^AST; do INNER ; exit anAST[] #);
                         onInit::< 
                           (#
                           do
                              <<SLOT PatternDiagramNodeOnInit:ObjectDescriptor>>;
                              INNER ;
                              <<SLOT PatternDiagramNodeOnInitAfter:ObjectDescriptor>>
                           #);
                         Display:<
                           (#
                           do
                              Rectangle->defaultShape;
                              INNER ;
                              (if astIndex <> 0
                               // true then
                                  (astIndex,ID)->IndexIDList.insert;
                               else
                                  'PatternDiagramNode: ASTINDEX is 0'->putline;
                              if);
                           #);
                         Redisplay:< (# do INNER ; #);
                         ConcludeDisplay:<
                           (#
                              dist: @Point; (* distance to adjust the node *)
                           enter dist
                           do INNER
                           #);
                         MakeAnchor:< Object;
                         GetGroup:<
                         (* return the FragmentGroup this node belongs to *)
                           (# fg: ^FragmentGroup; do INNER exit fg[] #);
                         GetFragment:<
                         (* return the Fragment this node belongs to *)
                           (# f: ^Fragment; do INNER exit f[] #);
                         SifEditorInstanceNo:<
                         (* In case SIF is open: sets or returns the fragment editor no
                          * the AST of this node is displayed on in SIF
                          *)
                           (# no: @Integer;
                           enter no
                           do INNER
                           exit no
                           #);
                         thisDiagram:<
                           (# theDiagram: ^Diagram
                           do INNER
                           exit theDiagram[]
                           #)
                      #);
                    PatternDiagrams:
                      @<<SLOT PatternDiagrams:ObjectDescriptor>>;
                    nextX,nextY: @integer;
                    CalculateNextCenter: (* for the next diagram on this page *)
                      (# theCenter: @Point;
                      do <<SLOT CalculateNextCenter:ObjectDescriptor>>;
                      exit
                      theCenter
                      #);
                    UpdateNextFree:
                      (# theCenter: @Point; x,y: @Integer;
                      enter (theCenter,(x,y))
                      do <<SLOT UpdateNextFree:ObjectDescriptor>>;
                      #);
                    Diagram:
                    (* superclass for all diagrams used by the prettyprinter *)
                      (#
                         theParentNode:
                           (#
                           enter titleNode.UDtheParentNode
                           exit titleNode.UDtheParentNode
                           #)
                           (*toby 1-11-94:
                            Redirect to persistent version of theParentNode*)
                           ;
                         theFragmentNode:
                           (#
                           enter titleNode.UDtheFragmentNode
                           exit titleNode.UDtheFragmentNode
                           #)
                           (*toby 8-11-94:
                            redirect to persistent version of theFragmentNode*)
                           ;
                         (* the Node from which THIS(Diagram) is generated *)
                         (* the toplevel fragmentnode THIS(AbstractNode) is
                          * generated from *)
                         titleText: @Text;
                         title:< PatternDiagramNode
                           (#
                              UDtheParentNode: @ReferenceUserData
                                (# Type::< PatternDiagramNode
                                #)
                                (*toby 1-11-94:
                                 Persistent version of theParentNode*)
                                ;
                              UDtheFragmentNode: @ReferenceUserData
                                (# Type::< PatternDiagramNode
                                #)
                                (*toby 8-11-94:
                                 Persistent version of theFragmentNode*)
                                ;
                              thePrefixConn: @ReferenceUserData
                                (# Type::< Connector
                                #)
                                (*toby: the connector to prefix if any*)
                                ;
                              interactiveNew::< 
                                (#
                                   w,h: @Integer;
                                   cursorFormat::< 
                                     (# do Cursor.box->curs #);
                                enter (w,h)
                                do
                                   <<SLOT TitleInteractiveNew:ObjectDescriptor>>;
                                   INNER
                                #);
                              onInit::< 
                                (#
                                do <<SLOT TitleOnInit:ObjectDescriptor>>
                                #);
                              onSelect::< 
                                (#
                                do
                                   <<SLOT TitleOnSelect:ObjectDescriptor>>
                                #);
                              thisDiagram::< 
                                (# do THIS(Diagram)[]->theDiagram[] #);
                           #);
                         titleNode: @Title;
                         InsertDiagramNode:<
                         (* insert a new node into a diagram.
                          * used when inserting new list elements
                          *)
                           (#
                              pos: @Integer;
                              anAST: ^ast;
                              theNode: ^PatternDiagramNode;
                           enter (pos,anAST[])
                           do INNER ;
                           exit theNode[]
                           #);
                         UpdateDiagramNode:< (* update existing node *)
                           (# oldAST,newAST: ^ast;
                           enter (oldAST[],newAST[])
                           do INNER ;
                           #);
                         DeleteDiagramNode:<
                         (* delete the node and update the list *)
                           (# d: ^PatternDiagramNode; deleteNode: @Boolean;
                           enter (d[],deleteNode)
                           do INNER
                           #);
                         ReplaceDiagramNode:<
                         (* remove old and insert new at same pos *)
                           (#
                              d: ^PatternDiagramNode;
                              newAST: ^ast;
                              newNode: ^PatternDiagramNode;
                           enter (d[],newAST[])
                           do INNER
                           exit newNode[]
                           #);
                         new:< Object;
                         updateAstFromDisk:<
                           (#
                              oldff,newff: ^fragmentForm;
                              theObject: ^PatternDiagramNode;
                           enter (oldff[],theObject[])
                           do INNER
                           exit newff[]
                           #);
                      #);
                    ListDiagram: Diagram
                    (* to display OADDiagrams i.e. 
                     * Pattern, Fragment, and Object diagrams *)
                      (#
                         <<SLOT DiagramLib:AttributeDecl>>;
                         detailPage:
                           (#
                           enter
                           titleNode.
                             UDdetailPage
                           exit titleNode.UDdetailPage
                           #)
                           (*toby 8-11-94:
                            Redirect to persistent version of detailPage*)
                           ;
                         (* defines all node types used in Diagrams *)
                         (* the Page where the declared attributes of theDiagram goes *)
                         NoOfRefConnectors:
                           (#
                           enter TitleNode.UDNoOfRefConnectors
                           exit TitleNode.UDNoOfRefConnectors
                           #);
                         LocalNodesDesc: containerlist
                           (#
                              element::< PatternDiagramNode;
                              abstractAll: scan
                              (* abstracts detailed attributes on other pages *)
                                (#
                                do
                                   <<SLOT LocalNodesAbstractAll:ObjectDescriptor>>
                                #);
                           #);
                         (* list of all nodes placed in THIS(ListDiagram) *)
                         localNodes: ^LocalNodesDesc;
                         new::< 
                           (#
                           do &LocalNodesDesc[]->localNodes[]; INNER
                           #);
                         InsertDiagramNode::< 
                           (#
                           do <<SLOT InsertDiagramNode:ObjectDescriptor>>
                           #);
                         DeleteDiagramNode::< 
                           (#
                           do <<SLOT DeleteDiagramNode:ObjectDescriptor>>
                           #);
                         ReplaceDiagramNode::< 
                           (#
                           do <<SLOT ReplaceDiagramNode:ObjectDescriptor>>
                           #);
                         UpdateDiagramNode::< 
                           (#
                           do <<SLOT UpdateDiagramNode:ObjectDescriptor>>;
                           #);
                         title::<
                         (* this is the parent of all local nodes *) 
                           (#
                              UDdetailPage: @ReferenceUserData
                                (#
                                   Type::< Page
                                   (*Qualification should be OADPage, but not
                                    possible since OADPage is virtual itself.*)
                                #)
                                (*toby 8-11-94:
                                 Persistent version of detailPage*)
                                ;
                              UDNoOfRefConnectors: @IntegerUserData;
                              PatternDiagNodeReference:
                               LocalNodesReferenceUserData
                                (# Type::< PatternDiagramNode #);
                              onInit::< 
                                (#
                                   x,y,h,w: @Integer;
                                   (* the geometry of THIS(Title) *)
                                do
                                   <<SLOT ListDiagramOnInit:ObjectDescriptor>>;
                                   INNER
                                     ;
                                   (* make the containing patterns *)
                                #);
                              onRemove::< 
                                (#
                                do
                                   <<SLOT ListDiagramOnRemove:ObjectDescriptor>>;
                                   INNER
                                #);
                              onDoubleClick::<
                              (* abstract detailed attributes on other pages *)
                               
                                (#
                                do
                                   <<SLOT ListDiagramOnDoubleClick:ObjectDescriptor>>;
                                   INNER
                                #);
                              abstract::<
                              (* abstract the title => abstract all attributes *)
                              
                                (#
                                do
                                   <<SLOT ListDiagramAbstract:ObjectDescriptor>>;
                                   INNER
                                #);
                              detail::<
                              (* detail the title => detail all attributes *) 
                                (#
                                do
                                   <<SLOT ListDiagramDetail:ObjectDescriptor>>;
                                   INNER
                                #);
                              GetFragment::< 
                                (#
                                do <<SLOT titleGetFragment:ObjectDescriptor>>;
                                #);
                           #);
                         remakingDiagram: @Boolean;
                         updateAstFromDisk::< 
                           (#
                           do
                              <<SLOT ListDiagramUpdateAstFromDisk:ObjectDescriptor>>;
                              INNER
                           #);
                      #);
                    <<SLOT PropertyDiagramLib:AttributeDecl>>;
                    <<SLOT CompositionDiagramLib:AttributeDecl>>;
                    OADDiagram: ListDiagram
                      (#
                         theDescriptor:
                           (#
                           enter titleNode.UDtheDescriptor
                           exit titleNode.UDtheDescriptor
                           #)
                           (*toby 1-11-94:
                            Redirect to persistent version of theDescriptor*)
                           ;
                         New::< 
                           (#
                           do INNER ; <<SLOT OADDiagramNew:ObjectDescriptor>>
                           #);
                         DisplayDeclarations:<
                           (#
                              startPos: @Point;
                              theAttributes: ^betaGram.attributes;
                           enter startPos
                           do
                              INNER ;
                              (* setup theAttributes *)
                              <<SLOT OADDisplayDeclarations:ObjectDescriptor>>;
                           #);
                         Display:<
                           (# theCenter: @Point; titleshape: @Integer;
                           enter titleshape
                           do <<SLOT OADDisplay:ObjectDescriptor>>;
                           #);
                         title::< 
                           (#
                              UDtheDescriptor: @ASTReferenceUserData
                                (# Type::< betaGram.ObjectDescriptor
                                #)
                                (*toby 1-11-94:
                                 Persistent version of theDescriptor*)
                                ;
                              onRemove::< (* callback from delete *) 
                                (#
                                do
                                   <<SLOT OADDiagramOnRemove:ObjectDescriptor>>;
                                   INNER ;
                                #);
                              onInit::< 
                                (#
                                do
                                   <<SLOT OADDiagramOnInit:ObjectDescriptor>>;
                                   INNER
                                #);
                           #);
                      #);
                    FragmentDiagram: ListDiagram
                    (* Display all fragments of the Group *)
                      (#
                         fullname:
                           (#
                           enter TitleNode.UDfullname
                           exit TitleNode.UDfullname
                           #);
                         (* of the group it displays *)
                         theGroup:
                           (#
                           enter TitleNode.UDtheGroup
                           exit TitleNode.UDtheGroup
                           #)
                           (*toby 28-11-94: redirect to persistent version*)
                           ;
                         New::< 
                           (# x,y: @Integer;
                           enter theGroup
                           do <<SLOT FragmentDiagramNew:ObjectDescriptor>>;
                           #);
                         title::< 
                           (#
                              UDfullname: @ReferenceUserData
                                (# Type::< Text #);
                              (*toby 28-11-94: persistent version of theGroup*)
                              UDtheGroup: @ReferenceUserData
                                (#
                                   Type::< FragmentGroup;
                                   ReadUserData::< 
                                     (#
                                     do
                                        <<SLOT ReadFragGroupReferenceUserData:ObjectDescriptor>>;
                                     #)
                                #);
                              onInit::< 
                                (#
                                do
                                   <<SLOT FragmentDiagramTitleInit:ObjectDescriptor>>;
                                #)
                           #);
                      #);
                    PatternDiagram: OADDiagram
                      (#
                         DisplayDeclarations::<
                         (* called from Display to actually display *) 
                           (# do INNER #);
                         (* the declarations in subnodes *)
                         Display::< (* call to display THIS(PatternDiagram) *) 
                           (# do INNER #);
                         title::< 
                           (#
                              onInit::< 
                                (#
                                do
                                   <<SLOT PatternDiagramOnInit:ObjectDescriptor>>;
                                   INNER ;
                                #);
                              onRemove::< 
                                (#
                                do
                                (* <<SLOT PatternDiagramOnRemove: descriptor>>; *)
                                INNER ;
                                #);
                              getASTNode::<
                              (* return the ASTnode THIS(title) is generated from *)
                               (# do theDescriptor->anAST[]; INNER #);
                           #);
                         new::< (* call to create THIS(PatternDiagram) *) 
                           (# anAST: ^AST; titleshape: @Integer;
                           enter (anAST[],titletext,titleshape)
                           do INNER ;
                           #);
                      #);
                    PatternAttDiagram: PatternDiagram
                      (#
                      (* Special PatternDiagram, to cope with a AttributeList FORM *)
                         theAST:
                           (#
                           enter titleNode.UDtheAST
                           exit titleNode.UDtheAST
                           #)
                           (*toby 25-11-94: redirect to persistent version.*)
                           ;
                         DisplayDeclarations::< 
                           (#
                           do
                              <<SLOT PatternAttDiagramDisplayDeclarations:ObjectDescriptor>>;
                           #);
                         New::< 
                           (#
                           do <<SLOT PatternAttDiagramNew:ObjectDescriptor>>;
                           #);
                         title::< 
                           (#
                              UDtheAST: @ASTReferenceUserData
                                (# Type::< AST
                                #)
                                (*toby 25-11-94: persistent version of theAST.*)
                                ;
                              onInit::< 
                                (#
                                do
                                   <<SLOT PatternAttDiagramOnInit:ObjectDescriptor>>
                                #)
                           #);
                      #);
                    PatternDeclDiagram: PatternDiagram
                      (#
                      (* PatternDiagram dealing with ObjectDescriptor FORM and 
                       * ObjectDescriptors in general
                       *)
                         thePrefix:
                           (#
                           enter titleNode.UDthePrefix
                           exit titleNode.UDthePrefix
                           #)
                           (*toby 25-11-94: Redirect to persistent version.*)
                           ;
                         DisplayDeclarations::< 
                           (#
                           do
                              <<SLOT PatternDeclDiagramDisplayDeclarations:ObjectDescriptor>>
                           #);
                         Display::< 
                           (#
                           do
                              <<SLOT PatternDeclDiagramDisplay:ObjectDescriptor>>;
                              INNER ;
                           #);
                         DisplayPrefix:
                           (#
                           do
                              <<SLOT PatternDiagramDisplayPrefix:ObjectDescriptor>>
                           #);
                         title::< 
                           (#
                              UDthePrefix: @ASTReferenceUserData
                                (# Type::< betaGram.ObjectDescriptor
                                #)
                                (*toby 25-11-94: Persistent version of thePrefix*)
                                ;
                              onInit::< 
                                (#
                                do
                                   <<SLOT PatternDeclDiagramOnInit:ObjectDescriptor>>
                                #);
                           #);
                         New::< 
                           (#
                           do <<SLOT PatternDeclDiagramNew:ObjectDescriptor>>
                           #);
                      #);
                    PatternClassificationDiagram: PatternDeclDiagram
                      (#
                      (* draw this pattern diagram without locals, find my prefix, 
                       * and traverse the FORM AST to find all patterns inheriting
                       * from this pattern
                       *)
                         Display::< 
                           (#
                           do
                              <<SLOT PatternClassificationDiagramDisplay:ObjectDescriptor>>;
                           #);
                         title::< 
                           (#
                              onInit::< 
                                (#
                                do
                                   <<SLOT PatternClassificationDiagramOnInit:ObjectDescriptor>>
                                #)
                           #);
                      #);
                    PatternNonTerminalDiagram: PatternDiagram
                      (#
                         theDesc:
                           (#
                           enter titleNode.UDtheDesc
                           exit titleNode.UdtheDesc
                           #)
                           (*toby 25-11-94: redirect to persistent version*)
                           ;
                         DisplayDeclarations::< 
                           (#
                           do
                              <<SLOT PatternNonTerminalDisplayDeclarations:ObjectDescriptor>>
                           #);
                         New::< 
                           (#
                           do
                              <<SLOT PatternNonTerminalDiagramNew:ObjectDescriptor>>
                           #);
                         title::< 
                           (#
                              UDtheDesc: @ASTReferenceUserData
                                (# Type::< AST
                                #)
                                (*toby 25-11-94: persistent version of theDesc*)
                                ;
                              onInit::< 
                                (#
                                do
                                   <<SLOT PatternNonTerminalDiagramOnInit:ObjectDescriptor>>;
                                #)
                           #);
                      #);
                    MarkNode: myEllipseNode
                      (#
                         thePatternDiagramNode: @ReferenceUserData
                           (# Type::< PatternDiagramNode
                           #)
                           (* the node to attach this mark *)
                           ;
                         theNode: ^PatternDiagramNode;
                         display:<
                           (# pos: @Point
                           enter theNode[]
                           do
                              INNER ;
                              (* calculate position *)
                              <<SLOT MarkNodeDisplay:ObjectDescriptor>>;
                           #);
                         activate:< Object;
                         (* like opens a comment or follows a link *)
                         deactivate:< Object;
                         initialisingSaved: @Boolean;
                         (* like closes a comment *)
                         onInit::< 
                           (#
                           do
                              <<SLOT MarkNodeOnInit:ObjectDescriptor>>;
                              INNER ;
                           #);
                         onDoubleClick::<  (# do INNER #);
                      #);
                    CommentNode: myRectNode (* to display the comment *)
                      (#
                         initialisingSaved: @Boolean;
                         onInit::< 
                           (#
                           do
                              <<SLOT CommentNodeOnInit:ObjectDescriptor>>;
                              INNER
                           #);
                         onRemove::<
                           (# do INNER #);
                         deactivate:< (# do INNER #);
                      #);
                    ObjectRefConnector:Connector
                      (#
                         onInit::<
                           (# node1,node2: ^node
                           do
                              THIS(ObjectRefConnector).getEnds
                                ->(node1[],node2[])
                           #)
                      #);
                    currentFocus: ^PatternDiagramNode;
                    open:< Object;
                    save:< Object;
                    changedFocus:<
                      (# oldObject,newObject: ^PatternDiagramNode;
                      enter (oldObject[],newObject[])
                      do INNER ; newObject[]->CurrentFocus[];
                      #);
                    lexemExpand:<
                      (#
                         theObject: ^PatternDiagramNode;
                         lexemIndex: @Integer;
                         theName: ^Text;
                      enter (theObject[],lexemIndex,theName[])
                      do INNER
                      #);
                    StartCreatePrefix:<
                      (# prefix,object: ^AST;
                      do <<SLOT StartCreatePrefix:ObjectDescriptor>>;
                      #);
                    PrefixExpand:<
                      (#
                         thePrefix,
                           theDesc: ^PatternDiagramNode;
                      enter (thePrefix[],theDesc[])
                      do INNER ;
                      #);
                    undo:< Object;
                    cut:<
                      (# theObject: ^PatternDiagramNode;
                      enter theObject[]
                      do INNER
                      #);
                    copy:<
                      (# theObject: ^PatternDiagramNode;
                      enter theObject[]
                      do INNER
                      #);
                    paste:<
                      (# theObject: ^PatternDiagramNode;
                      enter theObject[]
                      do INNER
                      #);
                    insertBefore:< Object;
                    insertAfter:< Object;
                    updateASTfromDisk:
                      (#
                         oldff,newff: ^fragmentForm;
                         oldIndex: @integer;
                         status: @boolean;
                         theObject: ^PatternDiagramNode;
                      enter (oldff[],oldIndex)
                      do <<SLOT updateASTfromDisk:ObjectDescriptor>>
                      exit status
                      #);
                    newFragment:<
                      (#
                         ff:
                           ^fragmentForm;
                         status: @Boolean;
                      enter ff[]
                      do INNER ; <<SLOT newFragment:ObjectDescriptor>>;
                      exit status
                      #);
                    astReplaced:<
                    (* we must do a new prettyprint from oldIndex using the new sub-ast
                     * with new index.
                     * Currently implemented using the diskrepresentation
                     *)
                      (#
                         ff: ^fragmentForm;
                         oldIndex,newIndex: @Integer;
                         status: @Boolean;
                      enter (ff[],oldIndex,newIndex)
                      do INNER ; <<SLOT astReplaced:ObjectDescriptor>>
                      exit status
                      #);
                    listElementInserted:<
                      (#
                         ff:
                           ^fragmentForm;
                         fatherIndex,
                           position: @Integer;
                      enter (ff[],fatherIndex,position)
                      do
                         INNER ;
                         <<SLOT listElementInserted:ObjectDescriptor>>;
                      #);
                    listElementsDeleted:<
                    (* changeSpec:
                     * <fatherIndex> <position> <length> <oldElements>
                     *  <oldElements> ::= { <elementIndex> } i    (i = <length>)
                     *)
                      (# ff: ^fragmentForm; changeSpec: ^text;
                      enter (ff[],changeSpec[])
                      do
                         INNER ;
                         <<SLOT listElementsDeleted:ObjectDescriptor>>;
                      #);
                    listElementsReplaced:<
                    (* changeSpec:
                     * <fatherIndex> <position> <length> <oldElement> <newLength> 
                     * <oldElement> ::= { <elementIndex> } i    (i = <length>)
                     *)
                      (# ff: ^fragmentForm; changeSpec: ^text;
                      enter (ff[],changeSpec[])
                      do
                         INNER ;
                         <<SLOT listElementsReplaced:ObjectDescriptor>>;
                      #);
                    getDexterAnchors:<
                      (# editorID: @Integer;
                      enter editorID
                      do INNER ;
                      #);
                    makeAnchors:<
                    (* mark all nodes corresponding the ASTindexes in indexList
                     *)
                      (# indexList: @Text;
                      enter indexList
                      do INNER ; <<SLOT makeAnchors:ObjectDescriptor>>
                      #);
                    ScanDiagrams:
                    (* scan diagrams on this page with at least type theDiagramType *)
                      (# theDiagramType: ##Diagram; current: ^Diagram;
                      enter theDiagramType##
                      do <<SLOT ScanDiagrams:ObjectDescriptor>>
                      #);
                    (* if true scroll new objects into view*)
                    doScrollIntoView: @Boolean;
                    PageCallBacks::< 
                      (#
                         MakeDesignObject::< 
                           (#
                           do
                              <<SLOT OADPageMakeDesignObject:ObjectDescriptor>>;
                           #);
                         MakeLocalNodes:
                           (# theListDiagram: ^ListDiagram
                           enter theListDiagram[]
                           do <<SLOT MakeLocalNodes:ObjectDescriptor>>;
                           #);
                         MakeMarkNode:
                           (#
                              theListDiagram: ^ListDiagram;
                              ID: @Integer
                           enter (theListDiagram[],ID)
                           do <<SLOT MakeMarkNode:ObjectDescriptor>>;
                           #);
                         MakeCommentNode:
                           (# theListDiagram: ^ListDiagram; ID: @Integer
                           enter (theListDiagram[],ID)
                           do <<SLOT MakeCommentNode:ObjectDescriptor>>;
                           #);
                         MakeConn:
                           (#
                              theListDiagram: ^ListDiagram;
                              ID: @Integer
                           enter (theListDiagram[],ID)
                           do <<SLOT MakeConn:ObjectDescriptor>>;
                           #)
                      #);
                    onReadDiagram::< 
                      (#
                      do
                         <<SLOT onReadDiagram:ObjectDescriptor>>;
                      #);
                    UDPrivate: @<<SLOT UDPagePrivate:ObjectDescriptor>>;
                 #);
               LocalNodesUserDataStart:
                 (# exit 5000 #);
               LocalNodesUserDataEnd:
                 (# exit 6000 #);
               decomposDiagramsUserDataStart: (# exit 7000 #);
               decomposDiagramsUserDataEnd: (# exit 8000 #);
               updateUserDataIDs::< 
                 (#
                 do <<SLOT OADDocumentUpdateUserDataIDs:ObjectDescriptor>>;
                 #);
               ObjectMenu:
               (*kja&toby 1.9.94*) @UserMenu
                 (#
                    sep1: @Item;
                    sep2: @Item;
                    sep3: @Item;
                    sep4: @Item;
                    sep5: @Item;
                    sep6: @Item;
                    ShowObjectdiagram: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuShowObjectdiagram:ObjectDescriptor>>;
                           #)
                      #);
                    LocalIncludeScan: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuLocalIncludeScan:ObjectDescriptor>>;
                           #)
                      #);
                    GlobalIncludeScan: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuGlobalIncludeScan:ObjectDescriptor>>;
                           #)
                      #);
                    GlobalConfirmedScan: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuGlobalConfirmedScan:ObjectDescriptor>>;
                           #)
                      #);
                    Abstract: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuAbstract:ObjectDescriptor>>
                           #)
                      #);
                    AbstractRec:
                      @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuAbstractRec:ObjectDescriptor>>
                           #)
                      #);
                    Detail:
                      @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuDetail:ObjectDescriptor>>
                           #)
                      #);
                    DetailRec: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuDetailRec:ObjectDescriptor>>
                           #)
                      #);
                    DetailOnDiffPage: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuDetailOnDiffPage:ObjectDescriptor>>;
                           #)
                      #);
                    Overview: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuOverview:ObjectDescriptor>>;
                           #)
                      #);
                    ToggleDynamicCreations: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuToggleDynamicCreations:ObjectDescriptor>>;
                           #)
                      #);
                    ToggleProcedureCalls: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuToggleProcedureCalls:ObjectDescriptor>>;
                           #)
                      #);
                    ShowSimpleObjects: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuShowSimpleObjects:ObjectDescriptor>>;
                           #)
                      #);
                    HideSimpleObjects: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuHideSimpleObjects:ObjectDescriptor>>;
                           #)
                      #);
                    Compact: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuCompact:ObjectDescriptor>>;
                           #)
                      #);
                    Blowup: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuBlowup:ObjectDescriptor>>;
                           #)
                      #);
                    DumpProcedurecalls: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuDumpProcedurecalls:ObjectDescriptor>>;
                           #)
                      #);
                    DumpDynamicGenerations: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ObjectMenuDumpDynamicGenerations:ObjectDescriptor>>;
                           #)
                      #);
                    PrintNodeID: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuPrintNodeID:ObjectDescriptor>>;
                           #)
                      #);
                    DumpAst: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ObjectMenuDumpAst:ObjectDescriptor>>;
                           #)
                      #);
                    init::< 
                      (#
                      do
                         <<SLOT ObjectMenuInit:ObjectDescriptor>>;
                      #)
                 #);
               (* end page *)
               (* user defined menus: document dependent *)
               DisplayMenu: @UserMenu
                 (#
                    DetailItem: @Item
                      (#
                         hit::< 
                           (# do <<SLOT DetailHit:ObjectDescriptor>> #)
                      #);
                    AbstractItem: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT AbstractHit:ObjectDescriptor>>
                           #)
                      #);
                    sep: @item;
                    classificationItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT classificationHit:ObjectDescriptor>>
                           #)
                      #);
                    sep1: @Item;
                    nestedCompositionItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT nestedCompositionHit:ObjectDescriptor>>
                           #)
                      #);
                    nestedwholePartItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT nestedwholePartHit:ObjectDescriptor>>
                           #)
                      #);
                    nestedreferenceItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT nestedreferenceHit:ObjectDescriptor>>
                           #)
                      #);
                    nestedblockStructureItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT nestedblockStructureHit:ObjectDescriptor>>
                           #)
                      #);
                    sep2: @Item;
                    treeCompositionItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT treeCompositionHit:ObjectDescriptor>>
                           #)
                      #);
                    treewholePartItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT treewholePartHit:ObjectDescriptor>>
                           #)
                      #);
                    treereferenceItem:
                      @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT treereferenceHit:ObjectDescriptor>>
                           #)
                      #);
                    treeblockStructureItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT treeblockStructureHit:ObjectDescriptor>>
                           #)
                      #);
                    sep3: @Item;
                    combinedItem:
                      @Item
                      (#
                         hit::< 
                           (# do <<SLOT CombinedHit:ObjectDescriptor>> #)
                      #);
                    init::< 
                      (#
                      do
                         <<SLOT DisplayMenuInit:ObjectDescriptor>>
                      #);
                 #);
               pageMenu: @UserMenu
                 (#
                    sep1: @Item;
                    RefreshItem: @Item
                      (#
                         hit::< 
                           (# do <<SLOT RefreshItem:ObjectDescriptor>> #)
                      #);
                    ReduceItem: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT ReduceItem:ObjectDescriptor>>
                           #)
                      #);
                    BlowupItem: @Item
                      (#
                         hit::< 
                           (# do <<SLOT BlowupItem:ObjectDescriptor>> #)
                      #);
                    AttributesItem: @Item
                      (#
                         hit::< 
                           (#
                           do
                              <<SLOT AttributesItem:ObjectDescriptor>>
                           #)
                      #);
                    ShowGroupWindowItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ShowGroupWindowItem:ObjectDescriptor>>
                           #)
                      #);
                    init::< 
                      (#
                      do
                         <<SLOT PageMenuInit:ObjectDescriptor>>
                      #);
                 #);
               OptionsMenu: @OptionsMenuDesc;
               OptionsMenuDesc:< UserMenu
                 (#
                    sep1,sep2,sep3: @Item;
                    CompositionWithMarkItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT CompositionWithMarkHit:ObjectDescriptor>>
                           #)
                      #);
                    OnSamePageItem: @Item
                      (#
                         hit::< 
                           (# do <<SLOT OnSamePageHit:ObjectDescriptor>> #)
                      #);
                    hierPresItem: @Item
                      (#
                         hit::< 
                           (# do <<SLOT HierPresHit:ObjectDescriptor>> #)
                      #);
                    SimpleCheck:
                      @<<SLOT SimpleCheckDisplay:ObjectDescriptor>>;
                    SimpleAsNameAndTypeItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT SimpleAsNameAndTypeHit:ObjectDescriptor>>
                           #)
                      #);
                    SimpleAsNameItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT SimpleAsNameHit:ObjectDescriptor>>
                           #)
                      #);
                    SimpleAsTypeItem:
                      @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT SimpleAsTypeHit:ObjectDescriptor>>
                           #)
                      #);
                    SimpleAsTypeAndKindItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT SimpleAsTypeAndKindHit:ObjectDescriptor>>
                           #)
                      #);
                    DebugItemDesc:< Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT DebugItem:ObjectDescriptor>>; INNER
                           #)
                      #);
                    DebugItem:
                      @DebugItemDesc;
                    CheckCheckMarks:<
                      (#
                      do
                         <<SLOT OptionsMenuCheckMarks:ObjectDescriptor>>;
                         INNER
                      #);
                    init::< 
                      (#
                      do
                         <<SLOT OptionsMenuInit:ObjectDescriptor>>
                      #);
                 #);
               MarkMenu: @MarkMenuDesc;
               MarkMenuDesc:< UserMenu
                 (#
                    NewCommentItem: @Item
                      (#
                         hit::< 
                           (# do <<SLOT NewCommentHit:ObjectDescriptor>> #)
                      #);
                    ShowCommentItem: @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT ShowCommentHit:ObjectDescriptor>>
                           #)
                      #);
                    HideCommentItem:
                      @Item
                      (#
                         hit::< 
                           (#
                           do <<SLOT HideCommentHit:ObjectDescriptor>>
                           #)
                      #);
                    init::< 
                      (#
                      do
                         <<SLOT MarkMenuInit:ObjectDescriptor>>
                      #);
                    CheckCheckMarks:
                      (#
                      do <<SLOT MarkMenuCheckMarks:ObjectDescriptor>>
                      #);
                 #);
               theGroupPage:
                 ^OADPage;
               theWorkPage: ^OADPage;
               theObjectPage: (*kja&toby 19-1-94*) ^ObjectPage;
               OGppProp: (*kja&toby 28-1-94*)
                 @<<SLOT objectGppProperties:ObjectDescriptor>>;
               gppProp: @<<SLOT gppProperties:ObjectDescriptor>>;
            #);
          (* end document *)
          GppAlert: DSUIUserAckMessage
            (# #);
          removeExtension:
            (# name: @Text;
            enter name
            do
               <<SLOT removeExtension:ObjectDescriptor>>;
            exit name
            #);
          doStartup: (# do <<SLOT doStartup:ObjectDescriptor>> #);
          activatedFromSif:<
          (* called if I was activated from SIF editor *)
            (# port,host: ^Text; enter (port[],host[]) do INNER ; #);
          dexterOn:< Object;
          isChecked:
            (# fg: ^FragmentGroup; b: @Boolean;
            enter fg[]
            do
               'doneCheck'
                 ->fg.prop.getProp
                   (#
                      doprop::< 
                        (#
                        do (if getConst // 0 then else true->b if)
                        #)
                   #);
            exit b
            #);
          GetGroupName: (* ask user for a groupfilename *)
            (# do <<SLOT GetGroupName:ObjectDescriptor>> #);
          openFragmentGroup:
          (* open the group and scan it for properties and fragments
           * and display it on a new page
           *)
            (# name: @Text; fg: ^FragmentGroup;
            enter name
            do <<SLOT OpenFragmentGroup:ObjectDescriptor>>;
            exit fg[]
            #);
          openFragmentForm:
          (* open the group and form
           *)
            (# name: @Text; editorID: @Integer; ff: ^fragmentForm;
            enter (name,editorID)
            do <<SLOT OpenFragmentForm:ObjectDescriptor>>;
            exit ff[]
            #);
          theOADDocument:
            ^OADDocument;
       do (* designenv *) INNER ;
       #);
     (* AST interface *)
     betaGram: @beta;
     (* the MPS interface to the BETA grammar/ASTs *)
     gram: @grammar;
     (* all grammar symbols defined in grammar *)
     metaGram: @metagrammar;
  do
     <<SLOT InitGPP:ObjectDescriptor>>;
     INNER ;
     theDesignInterface;
     (* execute the prettyprinter *)
  #)  

