ORIGIN '~beta/designenv/v1.5/designenv';
BODY 'private/diagramattributes'
     'private/menubody'
     'private/OADobjectpagebody'
     'private/objectdiagrambody'
     'private/objectmenubody'
     'private/userdatabody';
INCLUDE '~beta/designenv/v1.5/designenvutils'
        '~beta/mps/v4.9/metagrammarcfl'
        '~beta/betaast/v4.9/betasematt'
        '~beta/betaast/v4.9/gram'
        '~beta/containers/v1.4/list'
        'indexIDList'
        '~beta/pretty/v4.9/pplib';
-- lib: Attributes --
containerlist: list (#  #);
GppInterface: astInterface (* interface to AST *)
  (#
     switch: [100] @boolean;
     (* swithes for GPP, info messages, debugging etc *)
     (* 1  = general debugging
      * 2  = display info messages in info bar
      *)
     trace:
       (# s: @Integer; T: @Text; 
       enter s
       do
          (if switch[s]
           // true then
              '%'->screen.put;
              s->screen.putint;
              ': '->screen.puttext;
              INNER ;
              T[]->screen.putline;
              
          if)
       #);
     updateFragmentForm:<
     (* used in Frejas sifEditorList, when the fragmentform is updated *)
       (# oldff,ff: ^fragmentForm;  enter (oldff[],ff[]) do INNER #);
     sendSifCommand:< (# t: ^Text enter t[] do INNER #);
     theDesignInterface: @DesignInterface;
     DesignInterface:< designenv (* interface to OO DesignEnvironment *)
       (#
          IndexIDList: @IndexIDListDesc
            (# insert::<  (#  do <<SLOT IndexIDListInsert:Descriptor>> #)
            #);
          onInit::< 
            (# 
            do INNER ; doStartUp; 
            #);
          (* special handling of standard application menus *)
          FileMenu::< 
            (#
               iOpen::< 
                 (#
                    hit::<  (#  do <<SLOT FileOpen:Descriptor>> #);
                    init::< 
                      (# 
                      do
                      (* toby 7-11-94: In comment for test purposes
                       true
                       ->
                       precall*) 
                      #);
                    
                 #);
               iNew::< 
                 (#
                    hit::<  (#  do <<SLOT FileNew:Descriptor>> #);
                    init::< 
                      (#  do true->precall #);
                    
                 #);
               iSaveAs::< 
                 (#
                    hit::< 
                      (# 
                      do
                         <<SLOT FileSaveAs:Descriptor>>
                      #)
                 #);
               iSave::< 
                 (# hit::<  (#  do <<SLOT FileSave:Descriptor>> #) #);
               sep1: @item;
               iBetaOpen: @item
                 (#
                    hit::< 
                      (# 
                      do
                         <<SLOT FileMenuBetaOpen:Descriptor>>;
                         
                      #)
                 #);
               init::<  (#  do <<SLOT GppFileMenuInit:Descriptor>>;  #);
               
            #);
          theFileMenu: @FileMenuDesc;
          FileMenuDesc:< UserMenu
            (#
               NewBETAProgramDesc:< item
                 (#
                    hit::< 
                      (#  do INNER #)
                 #);
               NewBETALibraryDesc:< item
                 (#
                    hit::< 
                      (#  do INNER #)
                 #);
               NewBETAProgram:
                 @NewBETAProgramDesc;
               NewBETALibrary: @NewBETALibraryDesc;
               Open: @item
                 (#
                    hit::<  (#  do <<SLOT theFileMenuOpen:Descriptor>>;  #)
                 #);
               Close: @item (# hit::<  (#  do  #) #);
               Save: @item
                 (# hit::<  (#  do <<SLOT theFileMenuSave:Descriptor>> #)
                 #);
               SaveAs: @item
                 (#
                    hit::< 
                      (# 
                      do
                         <<SLOT theFileMenuSaveAs:Descriptor>>
                      #)
                 #);
               Revert: @item (# hit::<  (#  do  #) #);
               PageSetup: @item
                 (#
                    hit::<  (#  do menuID.fileMenu.prSet->DSUIMenuExecute #)
                 #);
               Print: @item
                 (#
                    hit::< 
                      (#  do menuID.fileMenu.prPage->DSUIMenuExecute #)
                 #);
               Preferences: @item
                 (#
                    hit::<  (#  do menuID.fileMenu.prefs->DSUIMenuExecute #)
                 #);
               LoadText: @item
                 (#
                    hit::< 
                      (#  do menuID.fileMenu.loadText->DSUIMenuExecute #)
                 #);
               SaveText: @item
                 (#
                    hit::< 
                      (#  do menuID.fileMenu.saveText->DSUIMenuExecute #)
                 #);
               About: @item (# hit::<  (#  do  #) #);
               Help: @item (# hit::<  (#  do  #) #);
               QuitDesc:< item (# hit::<  (#  do INNER #) #);
               Quit: @QuitDesc;
               sep1,sep2,sep3: @item;
               init::<  (#  do <<SLOT theFileMenuInit:Descriptor>> #)
            #);
          DSFileOpenDiagram: external
            (#
               ok: @Boolean;
               fileNameP: @integer;
               
            enter (fileNameP)
            do 'DSFile_OpenDiagram'->callC; 
            exit ok
            #);
          GppFileNameDialog:
            (#
               message,label,filename: @Text
            enter (message,label)
            do
               <<SLOT GppFileNameDialog:Descriptor>>
            exit filename
            #);
          SaveLists: (#  do <<SLOT SaveLists:Descriptor>>;  #);
          OADDocument:< Document
          (* my special document *)
            (#
               onInit::<  (#  do <<SLOT OADDocumentInit:Descriptor>> #);
               ObjectPage:< Page
                 (#
                    ShowDynamicCreations,
                      showProcedureCalls: @Boolean;
                    onInit::<  (#  do <<SLOT onInit:Descriptor>>;  #);
                    ObjectdiagramNode:
                    (* Abstract superclass *) genericnode
                      (#
                         Parentnode: ^DetailedObjectNode;
                         theDecl: ^betaGram.NameDcl;
                         theObjectDescriptor: ^betaGram.ObjectDescriptor;
                         titletext: @Text;
                         oldPosition: @Point;
                         display:<
                           (# drawOnly: @Boolean
                           enter (theDecl[],theObjectDescriptor[],drawOnly)
                           do <<SLOT ObjectDiagramNodeDisplay:Descriptor>>; 
                           #);
                         overview:
                           (# 
                           do
                              <<SLOT ObjectDiagramNodeOverview:Descriptor>>;
                              
                           #);
                         getPage: (#  exit THIS(ObjectPage)[] #);
                         onSelect::< 
                           (# 
                           do <<SLOT ObjectdiagramNodeOnSelect:Descriptor>>; 
                           #);
                         onDrag::<
                          
                           (# 
                           do <<SLOT ObjectdiagramNodeOnDrag:Descriptor>>; 
                           #)
                      #);
                    AbstractedObjectnode: ObjectdiagramNode
                      (#
                         pagelink: ^ObjectPage;
                         display::< 
                           (# 
                           do <<SLOT AbstractedObjectNodeDisplay:Descriptor>>
                           #);
                         onDoubleclick::< 
                           (# 
                           do
                              <<SLOT AbstractedObjectNodeOnDoubleclick:Descriptor>>;
                              
                           #);
                         detail:<
                           (# detailnode: ^DetailedObjectNode
                           do <<SLOT AbstractedObjectNodeDetail:Descriptor>>
                           exit
                           detailnode[]
                           #);
                         detailRecursive:<
                           (# detailnode: ^DetailedObjectNode
                           do
                              <<SLOT AbstractedObjectNodeDetailRecursive:Descriptor>>
                           #)
                      #);
                    DetailedObjectnode: ObjectdiagramNode
                      (#
                         ODNodes: (* List of component objectdiagramnodes *)
                           @containerlist
                           (# element::< ObjectdiagramNode #);
                         regionObject: ^genericnode;
                         startX,startY: @Integer;
                         nextX,nextY: @Integer;
                         column: @Integer;
                         row: @Integer;
                         oldRow: @Integer;
                         ShowSimpleObjects: @boolean;
                         calculateBox:
                           (# x,y,w,h: @Integer
                           do
                              <<SLOT DetailedObjectNodeCalculateBox:Descriptor>>
                           exit (x,y,w,h,RndRect)
                           #);
                         display::< 
                           (# 
                           do <<SLOT DetailedObjectNodeDisplay:Descriptor>>; 
                           #);
                         redisplay:<
                           (# theDetailed: ^DetailedObjectNode
                           enter theDetailed[]
                           do <<SLOT DetailedObjectNodeRedisplay:Descriptor>>
                           #);
                         onDoubleClick::< 
                           (# 
                           do
                              <<SLOT DetailedObjectNodeOnDoubleClick:Descriptor>>
                           #);
                         abstract:<
                           (# node: ^AbstractedObjectNode
                           do <<SLOT DetailedObjectNodeAbstract:Descriptor>>
                           #);
                         abstractRecursive:<
                           (# node: ^AbstractedObjectNode
                           do
                              <<SLOT DetailedObjectNodeAbstractRecursive:Descriptor>>
                           #);
                         showSimple:<
                           (# 
                           do
                              <<SLOT DetailedObjectNodeShowSimple:Descriptor>>; 
                           #);
                         hideSimple:<
                           (# 
                           do
                              <<SLOT DetailedObjectNodeHideSimple:Descriptor>>; 
                           #);
                         compact:<
                           (# 
                           do <<SLOT DetailedObjectNodeCompact:Descriptor>>; 
                           #);
                         blowup:<
                           (# 
                           do
                              <<SLOT DetailedObjectNodeBlowup:Descriptor>>;
                              
                           #)
                      #);
                    AbstrOperationObjectnode: AbstractedObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT AbstrOperationObjectNodeDisplay:Descriptor>>;
                              
                           #);
                         detail::< 
                           (# 
                           do
                              <<SLOT AbstrOperationObjectNodeDetail:Descriptor>>
                           #)
                      #);
                    AbstrPartObjectNode: AbstractedObjectNode
                      (#
                         display::< 
                           (# 
                           do <<SLOT AbstrPartObjectNodeDisplay:Descriptor>>; 
                           #);
                         detail::< 
                           (# 
                           do <<SLOT AbstrPartObjectNodeDetail:Descriptor>>; 
                           #)
                      #);
                    AbstrRepPartObjectNode: AbstrPartObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT AbstrRepPartObjectNodeDisplay:Descriptor>>;
                              
                           #);
                         detail::< 
                           (# 
                           do
                              <<SLOT AbstrRepPartObjectNodeDetail:Descriptor>>; 
                           #)
                      #);
                    DetailPartObjectNode: DetailedObjectNode
                      (#
                         display::< 
                           (# 
                           do <<SLOT DetailPartObjectNodeDisplay:Descriptor>>; 
                           #);
                         Abstract::< 
                           (# 
                           do <<SLOT DetailPartObjectNodeAbstract:Descriptor>>
                           #)
                      #);
                    DetailRepPartObjectNode: DetailPartObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT DetailRepPartObjectNodeDisplay:Descriptor>>;
                              
                           #);
                         Abstract::< 
                           (# 
                           do
                              <<SLOT DetailRepPartObjectNodeAbstract:Descriptor>>
                           #)
                      #);
                    AbstrDynamicObjectNode: AbstractedObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT AbstrDynamicObjectNodeDisplay:Descriptor>>;
                              
                           #);
                         detail::< 
                           (# 
                           do
                              <<SLOT AbstrDynamicObjectNodeDetail:Descriptor>>; 
                           #)
                      #);
                    DetailDynamicObjectNode: DetailedObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT DetailDynamicObjectNodeDisplay:Descriptor>>
                           #);
                         Abstract::< 
                           (# 
                           do
                              <<SLOT DetailDynamicObjectNodeAbstract:Descriptor>>
                           #)
                      #);
                    DetailOperationObjectNode: DetailedObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT DetailOperationObjectNodeDisplay:Descriptor>>
                           #);
                         Abstract::< 
                           (# 
                           do
                              <<SLOT DetailOperationObjectNodeAbstract:Descriptor>>
                           #)
                      #);
                    AbstrPartComponentNode: AbstrPartObjectNode
                      (#
                         display::< 
                           (# 
                           do <<SLOT AbstrPartComponentNodeDisplay:Descriptor>>
                           #);
                         detail::< 
                           (# 
                           do <<SLOT AbstrPartComponentNodeDetail:Descriptor>>
                           #)
                      #);
                    AbstrDynamicComponentNode: AbstrDynamicObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT AbstrDynamicComponentNodeDisplay:Descriptor>>
                           #);
                         detail::< 
                           (# 
                           do
                              <<SLOT AbstrDynamicComponentNodeDetail:Descriptor>>
                           #)
                      #);
                    DetailPartComponentNode: DetailPartObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT DetailPartComponentNodeDisplay:Descriptor>>;
                              
                           #);
                         Abstract::< 
                           (# 
                           do
                              <<SLOT DetailPartComponentNodeAbstract:Descriptor>>
                           #)
                      #);
                    DetailDynamicComponentNode: DetailDynamicObjectNode
                      (#
                         display::< 
                           (# 
                           do
                              <<SLOT DetailDynamicComponentNodeDisplay:Descriptor>>;
                              
                           #);
                         Abstract::< 
                           (# 
                           do
                              <<SLOT DetailDynamicComponentNodeAbstract:Descriptor>>
                           #)
                      #);
                    newConnector:
                      (# node1,node2: ^ObjectdiagramNode
                      enter (node1[],node2[])
                      do <<SLOT newConnector:Descriptor>>; 
                      #);
                    newDynConnector:
                      (#
                         node1,node2:
                           ^ObjectdiagramNode
                      enter (node1[],node2[])
                      do <<SLOT newDynConnector:Descriptor>>; 
                      #);
                    changedFocus:<
                      (# anAST: ^AST
                      enter anAST[]
                      do INNER
                      #);
                    Activate::< 
                      (# 
                      do
                         <<SLOT Activate:Descriptor>>;
                         
                      #)
                 #);
               ObjectPrivate: @<<SLOT ObjectPrivate:Descriptor>>
               (*kja&toby 1.9.94kja&toby 1.9.94*) ;
               OADObjectPage:< Page
                 (#
                    onInit::< 
                      (#  do <<SLOT OADObjectPageInit:Descriptor>> #);
                    ObjectNode:
                     RndRectNode
                      (#
                         onInit::< 
                           (# innerBox: ^DesignObject; 
                           do <<SLOT ObjectNodeInit:Descriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::<
                                (#  do Cursor.roundedbox->curs #)
                           #);
                         
                      #);
                    PassiveObject: ObjectNode
                      (#
                         onInit::< 
                           (#  do <<SLOT PassiveObjectInit:Descriptor>> #)
                      #);
                    MultipleObject:
                     ObjectNode
                      (#
                         onInit::< 
                           (#  do <<SLOT MultipleObjectInit:Descriptor>> #)
                      #);
                    ConcurrentObject:
                     ObjectNode
                      (#
                         onInit::< 
                           (# 
                           do <<SLOT ConcurrentObjectInit:Descriptor>>
                           #)
                      #);
                    InteractionRelation:
                     Connector
                      (#
                         onInit::< 
                           (# 
                           do <<SLOT InteractionRelationInit:Descriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (#  do Cursor.connector->curs #)
                           #);
                         
                      #);
                    TwoWayInteractionRelation: Connector
                      (#
                         onInit::< 
                           (# 
                           do <<SLOT TwoWayInteractionRelationInit:Descriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (#  do Cursor.connector->curs #)
                           #);
                         
                      #);
                    DistributedInteractionRelation: Connector
                      (#
                         onInit::< 
                           (# 
                           do
                              <<SLOT DistributedInteractionRelationInit:Descriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (#  do Cursor.connector->curs #)
                           #);
                         
                      #);
                    TwoWayDistributedInteractionRelation: Connector
                      (#
                         onInit::< 
                           (# 
                           do
                              <<SLOT TwoWayDistributedInteractionRelationInit:Descriptor>>
                           #);
                         interactiveNew::< 
                           (#
                              cursorFormat::< 
                                (#  do Cursor.connector->curs #)
                           #);
                         
                      #);
                    PatternNode: RectNode
                      (#
                         onInit::< 
                           (#  do <<SLOT PatternNodeInit:Descriptor>> #)
                      #);
                    PatternPattern:
                     PatternNode
                      (#
                         onInit::< 
                           (#  do <<SLOT PatternPatternInit:Descriptor>> #)
                      #);
                    VirtualPattern:
                     PatternNode
                      (#
                         onInit::< 
                           (#  do <<SLOT VirtualPatternInit:Descriptor>> #)
                      #);
                    
                 #);
               OADPage:< Page
                 (#
                    onInit::< 
                      (# 
                      do
                         <<SLOT OADPageOnInit:Descriptor>>;
                         INNER
                      #);
                    <<SLOT OADPageLib:Attributes>>;
                    myNode: Node
                      (#
                         initialisingSaved:
                           @Boolean
                         (*toby 7-11-94:
                          If initialisingSaved=true then we are reestablishing
                          saved diagram. onInit does not have to do all
                          the usual work!*) ;
                         ASTReferenceUserData: ReferenceUserData
                           (#
                              WriteUserData::< 
                                (# theAST: ^AST
                                do
                                   <<SLOT WriteASTReferenceUserData:Descriptor>>;
                                   
                                #);
                              ReadUserData::< 
                                (#
                                   ASTIndex: @integer;
                                   theFragmentForm: ^FragmentForm
                                do
                                   <<SLOT ReadASTReferenceUserData:Descriptor>>;
                                   
                                #);
                              Init::< 
                                (# 
                                do
                                   <<SLOT InitASTReferenceUserData:Descriptor>>;
                                   
                                #)
                           #);
                         PointUserData: UserData
                           (#
                              thePoint: @Point;
                              x,y: @IntegerUserData;
                              WriteUserData::< 
                                (# ok: @Boolean
                                enter thePoint
                                do <<SLOT WritePointUserData:Descriptor>>; 
                                #);
                              ReadUserData::< 
                                (# ok: @Boolean
                                do <<SLOT ReadPointUserData:Descriptor>>; 
                                exit
                                thePoint
                                #);
                              Init::< 
                                (# 
                                do <<SLOT InitPointUserData:Descriptor>>; 
                                #)
                           #);
                         DiagramReferenceUserData: ReferenceUserData
                           (#
                              WriteUserData::< 
                                (# theDiagram: ^Diagram; IDData: @integer
                                do
                                   <<SLOT WriteDiagramReferenceUserData:Descriptor>>;
                                   
                                #);
                              ReadUserData::< 
                                (#
                                   IDData: @Integer;
                                   theNode: ^PatternDiagramNode
                                do
                                   <<SLOT ReadDiagramReferenceUserData:Descriptor>>;
                                   
                                #);
                              Init::< 
                                (# 
                                do
                                   <<SLOT InitDiagramReferenceUserData:Descriptor>>;
                                   
                                #)
                           #);
                         FragReferenceUserData: ReferenceUserData
                           (#
                              theFragName: @ReferenceUserData
                                (# Type::< Text #);
                              theGroupName: @ReferenceUserData
                                (# Type::< Text #);
                              WriteUserData::< 
                                (# 
                                do
                                   <<SLOT WriteFragReferenceUserData:Descriptor>>;
                                   
                                #);
                              ReadUserData::< 
                                (# 
                                do
                                   <<SLOT ReadFragReferenceUserData:Descriptor>>;
                                   
                                #);
                              Init::< 
                                (# 
                                do
                                   <<SLOT InitFragReferenceUserData:Descriptor>>;
                                   
                                #)
                           #);
                         LocalNodesUDAttributes: @integerUserData
                           (#
                              init::< 
                                (# 
                                do
                                   LocalNodesUserDataEnd->attributeID;
                                   true->specialData
                                #)
                           #);
                         oldLocalNodesUDAttributes: @integerUserData
                           (#
                              init::< 
                                (# 
                                do
                                   LocalNodesUserDataEnd-1->attributeID;
                                   true->specialData
                                #)
                           #);
                         LocalNodesReferenceUserData: ReferenceUserData
                           (#
                              InitLocalNode:<
                                (#  do <<SLOT InitLocalNode:Descriptor>> #)
                           #);
                         ;
                         decomposDiagramsUDAttributes: @integerUserData
                           (#
                              init::< 
                                (# 
                                do
                                   decomposDiagramsUserDataEnd->attributeID;
                                   true->specialData
                                #)
                           #);
                         oldDecomposDiagramsUDAttributes: @integerUserData
                           (#
                              init::< 
                                (# 
                                do
                                   decomposDiagramsUserDataEnd-1->attributeID;
                                   true->specialData
                                #)
                           #);
                         decomposDiagramsReferenceUserData: ReferenceUserData
                           (#
                              InitDecomposDiagram:<
                                (# 
                                do <<SLOT InitDecomposDiagram:Descriptor>>
                                #)
                           #);
                         onInit::< 
                           (# 
                           do
                              <<SLOT myNodeOnInit:Descriptor>>;
                              
                           #)
                      #);
                    myGenericNode: myNode
                      (#
                         New::<  (#  enter shape do INNER #);
                         InteractiveNew::<  (#  enter shape do INNER #)
                      #);
                    myRectNode: myNode
                      (# New::<  (#  do Rectangle->shape; INNER #)
                      #);
                    myEllipseNode: myNode
                      (# New::<  (#  do Ellipse->shape; INNER #) #);
                    PatternDiagramNode: myGenericNode
                      (#
                         defaultShape: @IntegerUserData;
                         theMarkNode: @ReferenceUserData
                           (# Type::< MarkNode #);
                         theDiagram: @DiagramReferenceUserData
                           (# Type::< Diagram #);
                         abstract:< Object;
                         detail:< Object;
                         abstractedFromDiagramBelow:< Object;
                         astIndex: @IntegerUserData;
                         getAstNode:<
                           (# anAST: ^AST;  do INNER ;  exit anAST[] #);
                         onInit::< 
                           (# 
                           do
                              <<SLOT PatternDiagramNodeOnInit:Descriptor>>;
                              INNER
                                ;
                              <<SLOT PatternDiagramNodeOnInitAfter:Descriptor>>
                           #);
                         Display:<
                           (# 
                           do
                              Rectangle->defaultShape;
                              INNER ;
                              (if astIndex <> 0
                               // true then
                                  (astIndex,ID)->IndexIDList.insert; 
                               else
                                  'PatternDiagramNode: ASTINDEX is 0'->putline; 
                              if);
                              
                           #);
                         Redisplay:< (#  do INNER ;  #);
                         ConcludeDisplay:<
                           (#
                              dist: @Point; (* distance to adjust the node *) 
                           enter dist
                           do INNER
                           #);
                         MakeAnchor:< Object;
                         GetGroup:<
                         (* return the FragmentGroup this node belongs to *)
                           (# fg: ^FragmentGroup;  do INNER exit fg[] #);
                         GetFragment:<
                         (* return the Fragment this node belongs to *)
                           (# f: ^Fragment;  do INNER exit f[] #);
                         SifEditorInstanceNo:<
                         (* In case SIF is open: sets or returns the fragment editor no
                          * the AST of this node is displayed on in SIF
                          *)
                           (# no: @Integer; 
                           enter no
                           do INNER
                           exit no
                           #);
                         thisDiagram:<
                           (# theDiagram: ^Diagram
                           do INNER
                           exit theDiagram[]
                           #);
                         dump:<
                           (# 
                           do
                              <<SLOT PatternDiagramNodeDump:Descriptor>>;
                              INNER
                           #)
                      #);
                    ASTtoNode:
                      (#
                         anAST: ^ast;
                         theNode:
                           ^PatternDiagramNode
                      enter anAST[]
                      do <<SLOT ASTToNode:Descriptor>>; 
                      exit theNode[]
                      #);
                    ASTtoNodeListUpdate:
                      (#
                         oldAST,newAST: ^ast;
                         theNode:
                           ^PatternDiagramNode
                      enter (oldAST[],newAST[])
                      do <<SLOT ASTToNodeListUpdate:Descriptor>>; 
                      exit theNode[]
                      #);
                    PatternDiagrams:
                      @<<SLOT PatternDiagrams:Descriptor>>;
                    nextX,nextY: @integer;
                    CalculateNextCenter: (* for the next diagram on this page *)
                      (# theCenter: @Point; 
                      do <<SLOT CalculateNextCenter:Descriptor>>; 
                      exit theCenter
                      #);
                    UpdateNextFree:
                      (#
                         theCenter:
                           @Point;
                         x,y: @Integer;
                         
                      enter (theCenter,(x,y))
                      do <<SLOT UpdateNextFree:Descriptor>>; 
                      #);
                    Diagram:
                    (* superclass for all diagrams used by the prettyprinter *)
                      (#
                         theParentNode:
                           (# 
                           enter titleNode.UDtheParentNode
                           exit titleNode.UDtheParentNode
                           #);
                         theFragmentNode:
                           (# 
                           enter titleNode.UDtheFragmentNode
                           exit titleNode.UDtheFragmentNode
                           #);
                         titleText: @Text;
                         title:< PatternDiagramNode
                           (#
                              UDtheParentNode: @ReferenceUserData
                                (# Type::< PatternDiagramNode #);
                              UDtheFragmentNode: @ReferenceUserData
                                (# Type::< PatternDiagramNode #);
                              thePrefixConn: @ReferenceUserData
                                (# Type::< Connector #);
                              interactiveNew::< 
                                (#
                                   w,h: @Integer;
                                   cursorFormat::< 
                                     (#  do Cursor.box->curs #);
                                   
                                enter (w,h)
                                do
                                   <<SLOT TitleInteractiveNew:Descriptor>>;
                                   INNER
                                #);
                              onInit::< 
                                (# 
                                do
                                   <<SLOT TitleOnInit:Descriptor>>
                                #);
                              onSelect::< 
                                (#  do <<SLOT TitleOnSelect:Descriptor>> #);
                              thisDiagram::< 
                                (#  do THIS(Diagram)[]->theDiagram[] #);
                              DesignText::< 
                                (#
                                   ModeOn::< 
                                     (# 
                                     do <<SLOT TitleTextModeOn:Descriptor>>
                                     #);
                                   ModeOff::<
                                    
                                     (# 
                                     do <<SLOT TitleTextModeOff:Descriptor>>
                                     #);
                                   
                                #);
                              SifEditorInstanceNo::< 
                                (# 
                                do <<SLOT TitleSifEditorInstance:Descriptor>>; 
                                #);
                              
                           #);
                         titleNode: @Title;
                         InsertDiagramNode:<
                         (* insert a new node into a diagram.
                          * used when inserting new list elements
                          *)
                           (#
                              pos: @Integer;
                              anAST: ^ast;
                              theNode: ^PatternDiagramNode;
                              
                           enter (pos,anAST[])
                           do INNER ; 
                           exit theNode[]
                           #);
                         UpdateDiagramNode:< (* update existing node *)
                           (# oldAST,newAST: ^ast; 
                           enter (oldAST[],newAST[])
                           do INNER ; 
                           #);
                         DeleteDiagramNode:<
                         (* delete the node and update the list *)
                           (# d: ^PatternDiagramNode; deleteNode: @Boolean; 
                           enter (d[],deleteNode)
                           do INNER
                           #);
                         ReplaceDiagramNode:<
                         (* remove old and insert new at same pos *)
                           (#
                              d: ^PatternDiagramNode;
                              newAST: ^ast;
                              newNode: ^PatternDiagramNode;
                              
                           enter (d[],newAST[])
                           do INNER
                           exit newNode[]
                           #);
                         new:< Object;
                         updateAstFromDisk:<
                           (#
                              oldff,newff: ^fragmentForm;
                              theObject: ^PatternDiagramNode;
                              
                           enter (oldff[],theObject[])
                           do INNER
                           exit newff[]
                           #);
                         
                      #);
                    ListDiagram: Diagram
                    (* to display OADDiagrams i.e. 
                     * Pattern, Fragment, and Object diagrams *)
                      (#
                         <<SLOT DiagramLib:Attributes>>;
                         detailPage:
                           (# 
                           enter
                           titleNode.UDdetailPage
                           exit
                           titleNode.UDdetailPage
                           #);
                         NoOfRefConnectors:
                           (# 
                           enter TitleNode.UDNoOfRefConnectors
                           exit TitleNode.UDNoOfRefConnectors
                           #);
                         MaxHeight:
                           (# 
                           enter TitleNode.UDMaxHeight
                           exit TitleNode.UDMaxHeight
                           #);
                         MaxWidth:
                           (# 
                           enter TitleNode.UDMaxWidth
                           exit TitleNode.UDMaxWidth
                           #);
                         updateMaxWH:
                           (# w,h: @integer
                           enter (w,h)
                           do <<SLOT updateMaxWH:Descriptor>>; 
                           #);
                         LocalNodesDesc:
                          containerlist
                           (#
                              element::< PatternDiagramNode;
                              emptyContainerError::< 
                                (#  do true->continue #);
                              abstractAll: scan
                              (* abstracts detailed attributes on other pages *)
                                (# 
                                do <<SLOT LocalNodesAbstractAll:Descriptor>>
                                #);
                              adjustSizes:
                                (# 
                                do <<SLOT LocalNodesAdjustSizes:Descriptor>>; 
                                #);
                              
                           #);
                         localNodes: ^LocalNodesDesc;
                         new::< 
                           (# 
                           do &LocalNodesDesc[]->localNodes[]; INNER
                           #);
                         InsertDiagramNode::< 
                           (#  do <<SLOT InsertDiagramNode:Descriptor>> #);
                         DeleteDiagramNode::< 
                           (#  do <<SLOT DeleteDiagramNode:Descriptor>> #);
                         ReplaceDiagramNode::< 
                           (#  do <<SLOT ReplaceDiagramNode:Descriptor>> #);
                         UpdateDiagramNode::< 
                           (# 
                           do <<SLOT UpdateDiagramNode:Descriptor>>; 
                           #);
                         title::<
                         (* this is the parent of all local nodes *) 
                           (#
                              UDdetailPage: @ReferenceUserData
                                (#
                                   Type::< Page
                                   (*Qualification should be OADPage, but not
                                    possible since OADPage is virtual itself.*)
                                #);
                              UDNoOfRefConnectors: @IntegerUserData;
                              UDMaxHeight: @IntegerUserData;
                              UDMaxWidth: @IntegerUserData;
                              PatternDiagNodeReference:
                               LocalNodesReferenceUserData
                                (# Type::< PatternDiagramNode #);
                              resetLocalNodesUD:
                                (# 
                                do <<SLOT resetLocalNodesUD:Descriptor>>; 
                                #);
                              onInit::< 
                                (#
                                   x,y,h,w:
                                     @Integer;
                                   (* the geometry of THIS(Title) *)
                                   
                                do
                                   <<SLOT ListDiagramOnInit:Descriptor>>;
                                   INNER ;
                                   (* make the containing patterns *)
                                   
                                #);
                              onRemove::< 
                                (# 
                                do
                                   <<SLOT ListDiagramOnRemove:Descriptor>>;
                                   INNER
                                #);
                              onDoubleClick::<
                              (* abstract detailed attributes on other pages *)
                               
                                (# 
                                do
                                   <<SLOT ListDiagramOnDoubleClick:Descriptor>>;
                                   INNER
                                #);
                              abstract::<
                              (* abstract the title => abstract all attributes *)
                              
                                (# 
                                do
                                   <<SLOT ListDiagramAbstract:Descriptor>>;
                                   INNER
                                #);
                              detail::<
                              (* detail the title => detail all attributes *) 
                                (# 
                                do
                                   <<SLOT ListDiagramDetail:Descriptor>>;
                                   INNER
                                #);
                              GetFragment::< 
                                (# 
                                do <<SLOT titleGetFragment:Descriptor>>; 
                                #);
                              
                           #);
                         remakingDiagram: @Boolean;
                         updateAstFromDisk::< 
                           (# 
                           do
                              <<SLOT ListDiagramUpdateAstFromDisk:Descriptor>>;
                              INNER
                           #);
                         
                      #);
                    <<SLOT PropertyDiagramLib:Attributes>>;
                    <<SLOT CompositionDiagramLib:Attributes>>;
                    OADDiagram: ListDiagram
                      (#
                         theDescriptor:
                           (# 
                           enter titleNode.UDtheDescriptor
                           exit titleNode.UDtheDescriptor
                           #);
                         New::< 
                           (# 
                           do INNER ; <<SLOT OADDiagramNew:Descriptor>>
                           #);
                         DisplayDeclarations:<
                           (#
                              startPos: @Point;
                              theAttributes: ^betaGram.attributes;
                              
                           enter startPos
                           do
                              INNER ;
                              (* setup theAttributes *)
                              <<SLOT OADDisplayDeclarations:Descriptor>>;
                              
                           #);
                         Display:<
                           (# theCenter: @Point; titleshape: @Integer; 
                           enter titleshape
                           do <<SLOT OADDisplay:Descriptor>>; 
                           #);
                         title::< 
                           (#
                              UDtheDescriptor: @ASTReferenceUserData
                                (# Type::< betaGram.ObjectDescriptor #);
                              onRemove::< (* callback from delete *) 
                                (# 
                                do
                                   <<SLOT OADDiagramOnRemove:Descriptor>>;
                                   INNER
                                     ;
                                   
                                #);
                              onInit::< 
                                (# 
                                do
                                   <<SLOT OADDiagramOnInit:Descriptor>>;
                                   INNER
                                #);
                              dump::< 
                                (# 
                                do <<SLOT OADDiagramDump:Descriptor>>; INNER
                                #);
                              
                           #);
                         
                      #);
                    FragmentDiagram: ListDiagram
                    (* Display all fragments of the Group *)
                      (#
                         fullname:
                           (# 
                           enter TitleNode.UDfullname
                           exit TitleNode.UDfullname
                           #);
                         theGroup:
                           (# 
                           enter TitleNode.UDtheGroup
                           exit TitleNode.UDtheGroup
                           #);
                         New::< 
                           (# x,y: @Integer; 
                           enter theGroup
                           do <<SLOT FragmentDiagramNew:Descriptor>>; 
                           #);
                         title::< 
                           (#
                              UDfullname:
                                @ReferenceUserData (# Type::< Text #);
                              (*toby 28-11-94: persistent version of theGroup*)
                              UDtheGroup: @ReferenceUserData
                                (#
                                   Type::< FragmentGroup;
                                   ReadUserData::< 
                                     (# 
                                     do
                                        <<SLOT ReadFragGroupReferenceUserData:Descriptor>>;
                                        
                                     #)
                                #);
                              onInit::< 
                                (# 
                                do
                                   <<SLOT FragmentDiagramTitleInit:Descriptor>>;
                                   
                                #)
                           #);
                         
                      #);
                    PatternDiagram: OADDiagram
                      (#
                         DisplayDeclarations::<
                         (* called from Display to actually display *) 
                           (#  do INNER #);
                         Display::< (* call to display THIS(PatternDiagram) *) 
                           (#  do INNER #);
                         title::< 
                           (#
                              onInit::< 
                                (# 
                                do
                                   <<SLOT PatternDiagramOnInit:Descriptor>>;
                                   INNER
                                     ;
                                   
                                #);
                              onRemove::< 
                                (# 
                                do
                                (* <<SLOT PatternDiagramOnRemove: descriptor>>; *)
                                INNER ; 
                                #);
                              getASTNode::<
                              (* return the ASTnode THIS(title) is generated from *)
                               (#  do theDescriptor->anAST[]; INNER #);
                              
                           #);
                         new::< (* call to create THIS(PatternDiagram) *) 
                           (# anAST: ^AST; titleshape: @Integer; 
                           enter (anAST[],titletext,titleshape)
                           do INNER ; 
                           #);
                         
                      #);
                    PatternAttDiagram: PatternDiagram
                      (#
                         theAST:
                           (# 
                           enter titleNode.UDtheAST
                           exit titleNode.UDtheAST
                           #);
                         DisplayDeclarations::< 
                           (# 
                           do
                              <<SLOT PatternAttDiagramDisplayDeclarations:Descriptor>>;
                              
                           #);
                         New::< 
                           (# 
                           do <<SLOT PatternAttDiagramNew:Descriptor>>; 
                           #);
                         title::< 
                           (#
                              UDtheAST:
                                @ASTReferenceUserData (# Type::< AST #);
                              onInit::< 
                                (# 
                                do <<SLOT PatternAttDiagramOnInit:Descriptor>>
                                #);
                              dump::< 
                                (# 
                                do
                                   <<SLOT PatternAttDiagramDump:Descriptor>>;
                                   INNER
                                #)
                           #);
                         
                      #);
                    PatternDeclDiagram: PatternDiagram
                      (#
                         thePrefix:
                           (# 
                           enter titleNode.UDthePrefix
                           exit titleNode.UDthePrefix
                           #);
                         DisplayDeclarations::< 
                           (# 
                           do
                              <<SLOT PatternDeclDiagramDisplayDeclarations:Descriptor>>
                           #);
                         Display::< 
                           (# 
                           do
                              <<SLOT PatternDeclDiagramDisplay:Descriptor>>;
                              INNER
                                ;
                              
                           #);
                         DisplayPrefix:
                           (# 
                           do <<SLOT PatternDiagramDisplayPrefix:Descriptor>>
                           #);
                         title::<
                          
                           (#
                              UDthePrefix: @ASTReferenceUserData
                                (# Type::< betaGram.ObjectDescriptor #);
                              onInit::< 
                                (# 
                                do <<SLOT PatternDeclDiagramOnInit:Descriptor>>
                                #);
                              dump::< 
                                (# 
                                do
                                   <<SLOT PatternDeclDiagramDump:Descriptor>>;
                                   INNER
                                #);
                              
                           #);
                         New::< 
                           (# 
                           do <<SLOT PatternDeclDiagramNew:Descriptor>>
                           #);
                         
                      #);
                    PatternClassificationDiagram: PatternDeclDiagram
                      (#
                         Display::< 
                           (# 
                           do
                              <<SLOT PatternClassificationDiagramDisplay:Descriptor>>;
                              
                           #);
                         title::< 
                           (#
                              onInit::< 
                                (# 
                                do
                                   <<SLOT PatternClassificationDiagramOnInit:Descriptor>>
                                #)
                           #);
                         
                      #);
                    PatternNonTerminalDiagram: PatternDiagram
                      (#
                         theDesc:
                           (# 
                           enter titleNode.UDtheDesc
                           exit titleNode.UdtheDesc
                           #);
                         DisplayDeclarations::< 
                           (# 
                           do
                              <<SLOT PatternNonTerminalDisplayDeclarations:Descriptor>>
                           #);
                         New::< 
                           (# 
                           do <<SLOT PatternNonTerminalDiagramNew:Descriptor>>
                           #);
                         title::< 
                           (#
                              UDtheDesc: @ASTReferenceUserData
                                (# Type::< AST #);
                              onInit::< 
                                (# 
                                do
                                   <<SLOT PatternNonTerminalDiagramOnInit:Descriptor>>;
                                   
                                #)
                           #);
                         
                      #);
                    MarkNode: myEllipseNode
                      (#
                         thePatternDiagramNode: @ReferenceUserData
                           (# Type::< PatternDiagramNode #);
                         theNode: ^PatternDiagramNode;
                         display:<
                           (# pos: @Point
                           enter theNode[]
                           do
                              INNER ;
                              (* calculate position *)
                              <<SLOT MarkNodeDisplay:Descriptor>>;
                              
                           #);
                         activate:< Object;
                         deactivate:< Object;
                         initialisingSaved: @Boolean;
                         onInit::< 
                           (# 
                           do <<SLOT MarkNodeOnInit:Descriptor>>; INNER ; 
                           #);
                         onDoubleClick::< 
                           (# 
                           do INNER
                           #);
                         
                      #);
                    CommentNode: myRectNode
                    (* to display the comment *)
                      (#
                         initialisingSaved: @Boolean;
                         onInit::< 
                           (# 
                           do <<SLOT CommentNodeOnInit:Descriptor>>; INNER
                           #);
                         onRemove::< 
                           (# 
                           do INNER
                           #);
                         deactivate:<
                           (# 
                           do INNER
                           #);
                         
                      #);
                    DeletableConnector:
                     Connector
                      (#
                         initialisingSaved: @Boolean;
                         onDelete:< (#  do INNER #);
                         onReattach:<
                           (#
                              theNew: ^DesignObject;
                              whichEnd: @Boolean;
                              ok: @Boolean
                           enter (theNew[],whichEnd)
                           do true->ok; INNER
                           exit ok
                           #);
                         getOtherEnd:
                           (# Start,OtherEnd: ^IDObject
                           enter Start[]
                           do
                              <<SLOT DeletableConnectorGetOtherEnd:Descriptor>>;
                              
                           exit OtherEnd[]
                           #)
                      #);
                    DynamicItemConnector: DeletableConnector
                      (#
                         onInit::< 
                           (# node1,node2: ^node
                           do <<SLOT DynamicItemConnectorOnInit:Descriptor>>; 
                           #);
                         onDelete::< 
                           (# 
                           do
                              <<SLOT DynamicItemConnectorOnDelete:Descriptor>>; 
                           #);
                         onReattach::< 
                           (# 
                           do
                              <<SLOT DynamicItemConnectorOnReattach:Descriptor>>;
                              
                           #)
                      #);
                    DynamicComponentConnector: DeletableConnector
                      (#
                         onInit::< 
                           (# node1,node2: ^node
                           do
                              <<SLOT DynamicComponentConnectorOnInit:Descriptor>>;
                              
                           #);
                         onDelete::< 
                           (# 
                           do
                              <<SLOT DynamicComponentConnectorOnDelete:Descriptor>>;
                              
                           #);
                         onReattach::< 
                           (# 
                           do
                              <<SLOT DynamicComponentConnectorOnReattach:Descriptor>>;
                              
                           #)
                      #);
                    currentFocus: ^PatternDiagramNode;
                    open:< Object;
                    save:< Object;
                    changedFocus:<
                      (#
                         oldObject,newObject: ^PatternDiagramNode;
                         OKtoChange: @boolean
                      enter (oldObject[],newObject[])
                      do <<SLOT gppChangedFocus:Descriptor>>; 
                      #);
                    theTextBefore,
                      parseableText: @text;
                    onGoingTextediting: @boolean;
                    onGoingTitleEditing: @Boolean;
                    declarationTextChanged:<
                      (#
                         theObject: ^PatternDiagramNode;
                         index: @integer;
                         theParseText: ^text;
                         
                      enter (theObject[],index,theParseText[])
                      do INNER ; 
                      #);
                    openFormInSif:<
                      (# ff: ^fragmentForm; fn: ^PatternDiagramNode
                      enter (ff[],fn[])
                      do INNER
                      #);
                    lexemExpand:<
                      (#
                         theObject: ^PatternDiagramNode;
                         lexemIndex: @Integer;
                         theName: ^Text;
                         
                      enter (theObject[],lexemIndex,theName[])
                      do INNER
                      #);
                    StartCreatePrefix:<
                      (# prefix,object: ^AST; 
                      do <<SLOT StartCreatePrefix:Descriptor>>; 
                      #);
                    PrefixExpand:<
                      (#
                         thePrefix,theDesc:
                           ^PatternDiagramNode;
                         
                      enter (thePrefix[],theDesc[])
                      do INNER ; 
                      #);
                    undo:< Object;
                    cut:<
                      (# theObject: ^PatternDiagramNode; 
                      enter theObject[]
                      do INNER
                      #);
                    copy:<
                      (# theObject: ^PatternDiagramNode; 
                      enter theObject[]
                      do INNER
                      #);
                    paste:<
                      (# theObject: ^PatternDiagramNode; 
                      enter theObject[]
                      do INNER
                      #);
                    insertBefore:< Object;
                    insertAfter:< Object;
                    updateASTfromDisk:
                      (#
                         oldff,newff: ^fragmentForm;
                         oldIndex: @integer;
                         status: @boolean;
                         theObject: ^PatternDiagramNode;
                         
                      enter (oldff[],oldIndex)
                      do <<SLOT updateASTfromDisk:Descriptor>>
                      exit status
                      #);
                    newFragment:<
                      (#
                         ff:
                           ^fragmentForm;
                         status: @Boolean;
                         
                      enter ff[]
                      do
                         INNER ;
                         <<SLOT newFragment:Descriptor>>;
                         
                      exit status
                      #);
                    astReplaced:<
                    (* we must do a new prettyprint from oldIndex using the new sub-ast
                     * with new index.
                     * Currently implemented using the diskrepresentation
                     *)
                      (#
                         ff: ^fragmentForm;
                         oldIndex,newIndex: @Integer;
                         status: @Boolean;
                         
                      enter (ff[],oldIndex,newIndex)
                      do INNER ; <<SLOT astReplaced:Descriptor>>
                      exit status
                      #);
                    listElementInserted:<
                      (#
                         ff: ^fragmentForm;
                         fatherIndex,position:
                           @Integer;
                         
                      enter (ff[],fatherIndex,position)
                      do INNER ; <<SLOT listElementInserted:Descriptor>>; 
                      #);
                    listElementsDeleted:<
                    (* changeSpec:
                     * <fatherIndex> <position> <length> <oldElements>
                     *  <oldElements> ::= { <elementIndex> } i    (i = <length>)
                     *)
                      (# ff: ^fragmentForm; changeSpec: ^text; 
                      enter (ff[],changeSpec[])
                      do INNER ; <<SLOT listElementsDeleted:Descriptor>>; 
                      #);
                    listElementsReplaced:<
                    (* changeSpec:
                     * <fatherIndex> <position> <length> <oldElement> <newLength> 
                     * <oldElement> ::= { <elementIndex> } i    (i = <length>)
                     *)
                      (# ff: ^fragmentForm; changeSpec: ^text; 
                      enter (ff[],changeSpec[])
                      do INNER ; <<SLOT listElementsReplaced:Descriptor>>; 
                      #);
                    getDexterAnchors:<
                      (#
                         editorID:
                           @Integer;
                         
                      enter editorID
                      do INNER ; 
                      #);
                    makeAnchors:<
                    (* mark all nodes corresponding the ASTindexes in indexList
                     *)
                      (# indexList: @Text; 
                      enter indexList
                      do INNER ; <<SLOT makeAnchors:Descriptor>>
                      #);
                    ScanDiagrams:
                    (* scan diagrams on this page with at least type theDiagramType *)
                      (# theDiagramType: ##Diagram; current: ^Diagram; 
                      enter theDiagramType##
                      do <<SLOT ScanDiagrams:Descriptor>>
                      #);
                    doScrollIntoView: @Boolean;
                    PageCallBacks::< 
                      (#
                         MakeDesignObject::< 
                           (# 
                           do
                              <<SLOT OADPageMakeDesignObject:Descriptor>>;
                              
                           #);
                         MakeLocalNodes:
                           (# theListDiagram: ^ListDiagram
                           enter theListDiagram[]
                           do <<SLOT MakeLocalNodes:Descriptor>>; 
                           #);
                         MakeMarkNode:
                           (#
                              theListDiagram:
                                ^ListDiagram;
                              ID: @Integer
                           enter (theListDiagram[],ID)
                           do <<SLOT MakeMarkNode:Descriptor>>; 
                           #);
                         MakeCommentNode:
                           (#
                              theListDiagram:
                                ^ListDiagram;
                              ID: @Integer
                           enter (theListDiagram[],ID)
                           do <<SLOT MakeCommentNode:Descriptor>>; 
                           #);
                         MakeConn:
                           (#
                              theListDiagram:
                                ^ListDiagram;
                              ID: @Integer
                           enter (theListDiagram[],ID)
                           do <<SLOT MakeConn:Descriptor>>; 
                           #)
                      #);
                    onReadDiagram::< 
                      (# 
                      do
                         <<SLOT onReadDiagram:Descriptor>>;
                         
                      #);
                    UDPrivate: @<<SLOT UDPagePrivate:Descriptor>>;
                    
                 #);
               LocalNodesUserDataStart:
                 (#  exit 5000 #);
               LocalNodesUserDataEnd:
                 (#  exit 6000 #);
               decomposDiagramsUserDataStart:
                 (#  exit 7000 #);
               decomposDiagramsUserDataEnd:
                 (#  exit 8000 #);
               updateUserDataIDs::< 
                 (# 
                 do
                    <<SLOT OADDocumentUpdateUserDataIDs:Descriptor>>;
                    
                 #);
               ObjectMenu: (*kja&toby 1.9.94*) @UserMenu
                 (#
                    sep1: @Item;
                    sep2: @Item;
                    sep3: @Item;
                    sep4: @Item;
                    sep5: @Item;
                    sep6: @Item;
                    ShowObjectdiagram: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuShowObjectdiagram:Descriptor>>; 
                           #)
                      #);
                    LocalIncludeScan: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuLocalIncludeScan:Descriptor>>; 
                           #)
                      #);
                    GlobalIncludeScan: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuGlobalIncludeScan:Descriptor>>; 
                           #)
                      #);
                    GlobalConfirmedScan: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuGlobalConfirmedScan:Descriptor>>;
                              
                           #)
                      #);
                    Abstract: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ObjectMenuAbstract:Descriptor>> #)
                      #);
                    AbstractRec: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuAbstractRec:Descriptor>>
                           #)
                      #);
                    Detail: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ObjectMenuDetail:Descriptor>> #)
                      #);
                    DetailRec: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuDetailRec:Descriptor>>
                           #)
                      #);
                    DetailOnDiffPage: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuDetailOnDiffPage:Descriptor>>; 
                           #)
                      #);
                    Overview: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuOverview:Descriptor>>; 
                           #)
                      #);
                    ToggleDynamicCreations: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuToggleDynamicCreations:Descriptor>>;
                              
                           #)
                      #);
                    ToggleProcedureCalls: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuToggleProcedureCalls:Descriptor>>;
                              
                           #)
                      #);
                    ShowSimpleObjects: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuShowSimpleObjects:Descriptor>>; 
                           #)
                      #);
                    HideSimpleObjects: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuHideSimpleObjects:Descriptor>>; 
                           #)
                      #);
                    Compact: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ObjectMenuCompact:Descriptor>>;  #)
                      #);
                    Blowup: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ObjectMenuBlowup:Descriptor>>;  #)
                      #);
                    DumpProcedurecalls:
                      @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuDumpProcedurecalls:Descriptor>>; 
                           #)
                      #);
                    DumpDynamicGenerations: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT ObjectMenuDumpDynamicGenerations:Descriptor>>;
                              
                           #)
                      #);
                    PrintNodeID: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT ObjectMenuPrintNodeID:Descriptor>>; 
                           #)
                      #);
                    DumpAst: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ObjectMenuDumpAst:Descriptor>>;  #)
                      #);
                    init::<  (#  do <<SLOT ObjectMenuInit:Descriptor>>;  #)
                 #);
               DisplayMenuDesc:< UserMenu
                 (#
                    DetailItem: @Item
                      (# hit::<  (#  do <<SLOT DetailHit:Descriptor>> #)
                      #);
                    AbstractItem: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT AbstractHit:Descriptor>>
                           #)
                      #);
                    DumpNodeItem: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT DisplayMenuDumpNodeItem:Descriptor>>; 
                           #)
                      #);
                    TraceItemDesc:<
                     Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT DisplayMenuTraceItem:Descriptor>>; INNER
                           #)
                      #);
                    TraceItem: @TraceItemDesc;
                    TraceUserDataItem: @Item
                      (#
                         hit::< 
                           (#  do (not userDataVerbose)->userDataVerbose #)
                      #);
                    TraceCallbacksItem: @Item
                      (#
                         hit::< 
                           (#  do (not callbackVerbose)->callbackVerbose #)
                      #);
                    SaveTestItem: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT saveTestItem:Descriptor>>;  #)
                      #);
                    sep: @item;
                    classificationItem: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT classificationHit:Descriptor>>
                           #)
                      #);
                    sep1: @Item;
                    nestedCompositionItem: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT nestedCompositionHit:Descriptor>>
                           #)
                      #);
                    nestedwholePartItem:
                      @Item
                      (#
                         hit::< 
                           (#  do <<SLOT nestedwholePartHit:Descriptor>> #)
                      #);
                    nestedreferenceItem:
                      @Item
                      (#
                         hit::< 
                           (#  do <<SLOT nestedreferenceHit:Descriptor>> #)
                      #);
                    nestedblockStructureItem: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT nestedblockStructureHit:Descriptor>>
                           #)
                      #);
                    sep2: @Item;
                    treeCompositionItem: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT treeCompositionHit:Descriptor>> #)
                      #);
                    treewholePartItem:
                      @Item
                      (#
                         hit::< 
                           (#  do <<SLOT treewholePartHit:Descriptor>> #)
                      #);
                    treereferenceItem:
                      @Item
                      (#
                         hit::< 
                           (#  do <<SLOT treereferenceHit:Descriptor>> #)
                      #);
                    treeblockStructureItem:
                      @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT treeblockStructureHit:Descriptor>>
                           #)
                      #);
                    sep3: @Item;
                    combinedItem:
                      @Item
                      (# hit::<  (#  do <<SLOT CombinedHit:Descriptor>> #)
                      #);
                    init::<  (#  do <<SLOT DisplayMenuInit:Descriptor>> #);
                    
                 #);
               DisplayMenu: @DisplayMenuDesc;
               pageMenu: @UserMenu
                 (#
                    sep1: @Item;
                    RefreshItem: @Item
                      (# hit::<  (#  do <<SLOT RefreshItem:Descriptor>> #)
                      #);
                    ReduceItem: @Item
                      (# hit::<  (#  do <<SLOT ReduceItem:Descriptor>> #)
                      #);
                    BlowupItem: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT BlowupItem:Descriptor>>
                           #)
                      #);
                    AttributesItem: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT AttributesItem:Descriptor>> #)
                      #);
                    ShowGroupWindowItem:
                      @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ShowGroupWindowItem:Descriptor>> #)
                      #);
                    init::<  (#  do <<SLOT PageMenuInit:Descriptor>> #);
                    
                 #);
               OptionsMenu: @OptionsMenuDesc;
               OptionsMenuDesc:< UserMenu
                 (#
                    sep1,sep2,sep3: @Item;
                    CompositionWithMarkItem:
                      @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT CompositionWithMarkHit:Descriptor>>
                           #)
                      #);
                    OnSamePageItem:
                      @Item
                      (#
                         hit::<  (#  do <<SLOT OnSamePageHit:Descriptor>> #)
                      #);
                    hierPresItem: @Item
                      (# hit::<  (#  do <<SLOT HierPresHit:Descriptor>> #)
                      #);
                    SimpleCheck: @<<SLOT SimpleCheckDisplay:Descriptor>>;
                    SimpleAsNameAndTypeItem: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT SimpleAsNameAndTypeHit:Descriptor>>
                           #)
                      #);
                    SimpleAsNameItem:
                      @Item
                      (#
                         hit::< 
                           (#  do <<SLOT SimpleAsNameHit:Descriptor>> #)
                      #);
                    SimpleAsTypeItem: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT SimpleAsTypeHit:Descriptor>>
                           #)
                      #);
                    SimpleAsTypeAndKindItem: @Item
                      (#
                         hit::< 
                           (# 
                           do <<SLOT SimpleAsTypeAndKindHit:Descriptor>>
                           #)
                      #);
                    DebugItemDesc:<
                     Item
                      (#
                         hit::< 
                           (#  do <<SLOT DebugItem:Descriptor>>; INNER #)
                      #);
                    DebugItem: @DebugItemDesc;
                    CheckCheckMarks:<
                      (# 
                      do
                         <<SLOT OptionsMenuCheckMarks:Descriptor>>;
                         INNER
                      #);
                    init::<  (#  do <<SLOT OptionsMenuInit:Descriptor>> #);
                    
                 #);
               MarkMenu: @MarkMenuDesc;
               MarkMenuDesc:< UserMenu
                 (#
                    NewCommentItem: @Item
                      (#
                         hit::<  (#  do <<SLOT NewCommentHit:Descriptor>> #)
                      #);
                    ShowCommentItem: @Item
                      (#
                         hit::< 
                           (#  do <<SLOT ShowCommentHit:Descriptor>> #)
                      #);
                    HideCommentItem: @Item
                      (#
                         hit::< 
                           (# 
                           do
                              <<SLOT HideCommentHit:Descriptor>>
                           #)
                      #);
                    init::<  (#  do <<SLOT MarkMenuInit:Descriptor>> #);
                    CheckCheckMarks:
                      (# 
                      do
                         <<SLOT MarkMenuCheckMarks:Descriptor>>
                      #);
                    
                 #);
               theGroupPage: ^OADPage;
               theWorkPage: ^OADPage;
               theObjectPage: (*kja&toby 19-1-94*) ^ObjectPage;
               OGppProp: (*kja&toby 28-1-94*)
                 @<<SLOT objectGppProperties:Descriptor>>;
               gppProp: @<<SLOT gppProperties:Descriptor>>;
               
            #);
          (* end document *)
          GppAlert: DSUIUserAckMessage
            (#  #);
          GppPromptForText:
            (#
               message,defaultText: ^text;
               confirm:<
                 (# theText: ^text
                 enter theText[]
                 do INNER
                 #);
               cancel:< object
            enter (message[],defaultText[])
            do
               <<SLOT GppPromptForText:Descriptor>>;
               
            #);
          getExtension:
            (# name: @Text; extension: ^Text
            enter name
            do <<SLOT getExtension:Descriptor>>; 
            exit extension[]
            #);
          removeExtension:
            (# name: @Text; 
            enter name
            do
               <<SLOT removeExtension:Descriptor>>;
               
            exit name
            #);
          doStartup: (#  do <<SLOT doStartup:Descriptor>> #);
          activatedFromSif:<
          (* called if I was activated from SIF editor *)
            (# port,host: ^Text;  enter (port[],host[]) do INNER ;  #);
          dexterOn:< Object;
          isChecked:
            (# fg: ^FragmentGroup; b: @Boolean; 
            enter fg[]
            do
               'doneCheck'
                 ->fg.prop.getProp
                   (#
                      doprop::< 
                        (# 
                        do (if getConst // 0 then  else true->b if)
                        #)
                   #);
               
            exit b
            #);
          GetGroupName: (* ask user for a groupfilename *)
            (#  do <<SLOT GetGroupName:Descriptor>> #);
          openFragmentGroup:
          (* open the group and scan it for properties and fragments
           * and display it on a new page
           *)
            (# name: @Text; fg: ^FragmentGroup; 
            enter name
            do <<SLOT OpenFragmentGroup:Descriptor>>; 
            exit fg[]
            #);
          openFragmentForm:
          (* open the group and form
           *)
            (# name: @Text; editorID: @Integer; ff: ^fragmentForm; 
            enter (name,editorID)
            do <<SLOT OpenFragmentForm:Descriptor>>; 
            exit ff[]
            #);
          autosave:
            (# 
            do
               <<SLOT autosave:Descriptor>>;
               
            #);
          theOADDocument: ^OADDocument;
          CurrentDiagramName: ^Text;
          
       do (* designenv *) INNER ; 
       #);
     (* AST interface *)
     betaGram: @beta;
     (* the MPS interface to the BETA grammar/ASTs *)
     gram: @grammar;
     (* all grammar symbols defined in grammar *)
     metaGram: @metagrammar;
     
  do <<SLOT InitGPP:Descriptor>>; INNER ; theDesignInterface; 
  #)  

