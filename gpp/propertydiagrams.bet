ORIGIN 'gppinterface';
INCLUDE 'prettyprintersetup'
        'private/userdataprivate';
BODY 'private/propertynodebody';
-- PropertyDiagramLib: Attributes --
SimplePropertyDiagram: OADDiagram
  (#
     pos: (#  enter titleNode.UDpos exit titleNode.UDpos #);
     theGroup: (#  enter TitleNode.UDtheGroup exit TitleNode.UDtheGroup #);
     realOpen: (#  enter titleNode.UDrealOpen exit titleNode.UDrealOpen #);
     detailed: (#  enter titleNode.UDdetailed exit titleNode.UDdetailed #);
     proptype: (#  enter titleNode.UDproptype exit titleNode.UDproptype #);
     ScanProperties:
       (#
          doThis:
            (# nodeText,fullname: ^Text; 
            enter (nodeText[],fullname[])
            do INNER ; 
            #);
          thisOrigin:< doThis;
          thisInclude:< doThis;
          thisBody:< doThis;
          thisOther:< doThis;
          
       do <<SLOT SimplePropertyDiagramScanProperties:Descriptor>>; 
       #);
     SurroundBox:
      GenericNode
       (#
          onInit::< 
            (# 
            do
               UDPrivate.UDSurroundBox->UserDataInit;
               titleNode[]->CreateRegion;
               
            #);
          
       #);
     theSurroundBox:
       (#  enter titleNode.UDSurroundBox exit titleNode.UDSurroundBox #);
     title::< 
       (#
          UDfullname: @ReferenceUserData (# Type::< Text #);
          UDpos: @PointUserData (*toby 25-11-94: persistent version of pos*) ;
          UDtheGroup: @FragReferenceUserData
            (# Type::< mps.FragmentGroup #);
          UDrealOpen: @BooleanUserData
          (*toby 28-11-94: persistent version of realOpen*) ;
          UDdetailed: @BooleanUserData
          (* toby 28-11-94: persistent version of detailed*) ;
          UDproptype: @IntegerUserData
          (*toby 28-11-94: persistent version of proptype*) ;
          UDSurroundBox: @ReferenceUserData (# type::< SurroundBox #);
          onInit::< 
            (# 
            do
               UDPrivate.UDSimplePropertyDiagram->UserDataInit;
               UDfullname.Init;
               UDpos.Init;
               UDtheGroup.Init;
               UDrealOpen.Init;
               UDdetailed.Init;
               UDproptype.Init;
               UDSurroundBox.init;
               INNER ;
               (if not initialisingSaved then titleText->theText.set if);
               
            #);
          onDoubleClick::< 
            (# 
            do
               (if switch[20] then
                   (if detailed
                    // true then abstract;  // false then detail; 
                   if);
                   false->proceed;
                   INNER
                else
                   'Property diagrams are currently disabled'->alertUser
               if)
            #);
          abstract::< 
            (# 
            do
               (if detailed
                // true then
                   <<SLOT SimplePropertyTitleAbstract:Descriptor>>;
                   false
                     ->detailed;
                   INNER
               if);
               
            #);
          detail::< 
            (#
               doneInInner:
                 @Boolean;
               
            do
               INNER ;
               (if doneInINNER
                // false then
                   <<SLOT SimplePropertyTitleDetail:Descriptor>>; INNER ; 
               if);
               
            #);
          
       #);
     DisplayPropertyFiles:
       (#
          mainProperty:
            ^SimplePropertyDiagram;
          thePage: ^OADPage;
          
       enter (mainProperty[],thePage[])
       do <<SLOT DisplayPropertyFiles:Descriptor>>; 
       #);
     PropertyNode: PatternDiagramNode
       (#
          type:<
            (# t: @Integer
            do INNER
            exit t
            #);
          fullname: @ReferenceUserData
            (# Type::< Text #);
          display:<
            (# nodeText: @Text; 
            enter (nodeText,fullName)
            do
               <<SLOT PropertyNodeDisplay:Descriptor>>;
               INNER ;
               
            #);
          onInit::< 
            (#  do <<SLOT PropertyNodeOnInit:Descriptor>>; INNER #);
          
       #);
     ActivePropertyNode: PropertyNode
     (* we can open this node *)
       (#
          expanded: @BooleanUserData;
          detailPage: @ReferenceUserData (# Type::< Page #);
          onInit::< 
            (# 
            do
               UDPrivate.UDActivePropertyNode->UserDataInit;
               expanded.Init;
               detailPage.init;
               gppProp.AbstractedStyle->theText.style;
               false->BorderVisible;
               INNER ;
               
            #);
          onDoubleClick::< 
            (#  do <<SLOT ActivePropertyDoubleClick:Descriptor>>;  #);
          
       #);
     originProp:
       (#  exit 1 #);
     includeProp:
       (#  exit 2 #);
     bodyProp: (#  exit 3 #);
     OriginPropertyNode:
      ActivePropertyNode
       (#
          type::<  (#  do originProp->t #);
          onInit::< 
            (#  do UDPrivate.UDOriginPropertyNode->UserDataInit; INNER #)
       #);
     IncludePropertyNode: ActivePropertyNode
       (#
          type::<  (#  do includeProp->t #);
          onInit::< 
            (#  do UDPrivate.UDIncludePropertyNode->UserDataInit; INNER #)
       #);
     BodyPropertyNode: ActivePropertyNode
       (#
          type::<  (#  do bodyProp->t #);
          onInit::< 
            (#  do UDPrivate.UDBodyPropertyNode->UserDataInit; INNER #)
       #);
     PassivePropertyNode: PropertyNode
       (#
          onInit::< 
            (# 
            do
               UDPrivate.UDPassivePropertyNode->UserDataInit;
               textStyle.plaintext->theText.style;
               false->BorderVisible;
               INNER ;
               
            #);
          
       #);
     redisplay:< (#  <<SLOT SimplePropertyDiagramRedisplay:DoPart>> #);
     new::< 
       (# singleProp: @Boolean; 
       enter
       (theGroup,singleProp)
       do
          <<SLOT SimplePropertyDiagramNew:Descriptor>>;
          
       #);
     
  #);
PropertyDiagram: SimplePropertyDiagram
  (#
     title::< 
       (#
          onInit::< 
            (# 
            do
               UDPrivate.UDPropertyDiagram->UserDataInit;
               10->theText.size;
               textJust.leftJustification->theText.just;
               false->BorderVisible;
               
            #);
          detail::< 
            (# 
            do
               true->doneInInner;
               <<SLOT PropertyTitleDetail:Descriptor>>;
               INNER
            #);
          
       #);
     new::< 
       (# 
       do
          <<SLOT PropertyDiagramNew:Descriptor>>;
          INNER
       #);
     
  #);
  

