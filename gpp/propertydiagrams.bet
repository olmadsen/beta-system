ORIGIN 'gppinterface';
BODY 'private/propertynodebody';
INCLUDE 'prettyprintersetup'
        'private/userdataprivate';
-- PropertyDiagramLib: Attributes --
SimplePropertyDiagram: OADDiagram
  (#
     fullname:
       (#
       enter titleNode.UDfullname
       exit titleNode.UDfullname
       #)
       (*toby 25-11-94: redirect to persistent version*)
       ;
     pos:
       (#
       enter titleNode.UDpos
       exit titleNode.UDpos
       #)
       (*toby 25-11-94: redirect to persistent version*)
       ;
     theGroup:
       (#
       enter TitleNode.UDtheGroup
       exit TitleNode.UDtheGroup
       #)
       (*toby 28-11-94: redirect to persistent version*)
       ;
     realOpen:
       (#
       enter titleNode.UDrealOpen
       exit titleNode.UDrealOpen
       #)
       (*toby 28-11-94: redirect to persistent version*)
       ;
     detailed:
       (#
       enter titleNode.UDdetailed
       exit titleNode.UDdetailed
       #)
       (*toby 28-11-94: redirect to persistent version*)
       ;
     proptype:
       (#
       enter titleNode.UDproptype
       exit titleNode.UDproptype
       #)
       (* toby 28-11-94: redirect to persistent version*)
       ;
     ScanProperties:
       (#
          doThis:
            (# nodeText,fullname: ^Text;
            enter (nodeText[],fullname[])
            do INNER ;
            #);
          thisOrigin:< doThis;
          thisInclude:< doThis;
          thisBody:< doThis;
          thisOther:< doThis;
       do <<SLOT ScanProperties:ObjectDescriptor>>;
       #);
     (* GetAllBindings:
      *       theGroup.getBinding
      *        (#
      *           markRelatedFragments::< 
      *             (# G: ^FragmentGroup
      *             do
      *                <<SLOT markRelatedFragments:ObjectDescriptor>>;
      *             #);
      *        #);
      * 
      *)
     surroundBox: @GenericNode
       (# onInit::<  (# do titleNode[]->CreateRegion; #); #);
     title::< 
       (#
          UDfullname: @ReferenceUserData
            (# Type::< Text
            #)
            (*toby 25-11-94: persistent version of fullname*)
            ;
          UDpos: @PointUserData (*toby 25-11-94: persistent version of pos*) ;
          (*toby 28-11-94: persistent version of theGroup*)
          UDtheGroup: @ReferenceUserData
            (#
               Type::< FragmentGroup;
               ReadUserData::< 
                 (# error: ^Text
                 do <<SLOT ReadFragReferenceUserData:ObjectDescriptor>>;
                 #)
            #);
          UDrealOpen:
            @BooleanUserData (*toby 28-11-94: persistent version of realOpen*) ;
          UDdetailed: @BooleanUserData
          (* toby 28-11-94: persistent version of detailed*) ;
          UDproptype: @IntegerUserData
          (*toby 28-11-94: persistent version of proptype*) ;
          onInit::< 
            (#
            do
               UDPrivate.UDSimplePropertyDiagram->UserDataInit;
               UDfullname.Init;
               UDpos.Init;
               UDtheGroup.Init;
               UDrealOpen.Init;
               UDdetailed.Init;
               UDproptype.Init;
               INNER ;
               (if not initialisingSaved then titleText->theText.set if);
            #);
          onDoubleClick::< 
            (#
            do
               (if detailed
                // true then abstract; // false then detail;
               if);
               false->proceed;
               INNER
            #);
          abstract::< 
            (#
            do
               (if detailed
                // true then
                   <<SLOT SimplePropertyTitleAbstract:ObjectDescriptor>>;
                   false
                     ->
                       detailed;
                   INNER
               if);
            #);
          detail::< 
            (# doneInInner: @Boolean;
            do
               INNER ;
               (if doneInINNER
                // false then
                   <<SLOT SimplePropertyTitleDetail:ObjectDescriptor>>;
                   INNER ;
               if);
            #);
       #);
     DisplayPropertyFiles:
       (#
          mainProperty:
            ^SimplePropertyDiagram;
          thePage: ^OADPage;
       enter (mainProperty[],thePage[])
       do <<SLOT DisplayPropertyFiles:ObjectDescriptor>>;
       #);
     PropertyNode:
      PatternDiagramNode
       (#
          type:< (# t: @Integer do INNER exit t #);
          fullname: @ReferenceUserData (# Type::< Text #);
          display:<
            (# nodeText: @Text;
            enter (nodeText,fullName)
            do <<SLOT PropertyNodeDisplay:ObjectDescriptor>>; INNER ;
            #);
          onInit::< 
            (#
            do
               <<SLOT PropertyNodeOnInit:ObjectDescriptor>>;
               INNER
            #);
       #);
     ActivePropertyNode: PropertyNode (* we can open this node *)
       (#
          expanded: @BooleanUserData;
          detailPage: @ReferenceUserData
            (# Type::< Page
            #)
            (*Qualification should be OADPage, but not
             possible since OADPage is virtual itself.*)
            ;
          onInit::< 
            (#
            do
               UDPrivate.UDActivePropertyNode->UserDataInit;
               expanded.Init;
               detailPage.init;
               gppProp.AbstractedStyle->theText.style;
               false->BorderVisible;
               INNER ;
            #);
          onDoubleClick::< 
            (# do <<SLOT ActivePropertyDoubleClick:ObjectDescriptor>>; #);
       #);
     originProp: (# exit 1 #);
     includeProp: (# exit 2 #);
     bodyProp: (# exit 3 #);
     OriginPropertyNode: ActivePropertyNode
       (#
          type::<  (# do originProp->t #);
          onInit::< 
            (# do UDPrivate.UDOriginPropertyNode->UserDataInit; INNER #)
       #);
     IncludePropertyNode: ActivePropertyNode
       (#
          type::<  (# do includeProp->t #);
          onInit::< 
            (# do UDPrivate.UDIncludePropertyNode->UserDataInit; INNER #)
       #);
     BodyPropertyNode: ActivePropertyNode
       (#
          type::<  (# do bodyProp->t #);
          onInit::< 
            (# do UDPrivate.UDBodyPropertyNode->UserDataInit; INNER #)
       #);
     PassivePropertyNode: PropertyNode
       (#
          onInit::< 
            (#
            do
               UDPrivate.UDPassivePropertyNode->UserDataInit;
               plaintext->theText.style;
               false->BorderVisible;
               INNER ;
            #);
       #);
     new::< 
       (# singleProp: @Boolean;
       enter (theGroup,singleProp,fullname)
       do <<SLOT SimplePropertyDiagramNew:ObjectDescriptor>>;
       #);
  #);
PropertyDiagram:
 SimplePropertyDiagram
  (#
     title::< 
       (#
          onInit::< 
            (#
            do
               UDPrivate.UDPropertyDiagram->UserDataInit;
               10->theText.size;
               LeftJustification->theText.Just;
               false->BorderVisible;
            #);
          detail::< 
            (#
            do
               true->doneInInner;
               <<SLOT PropertyTitleDetail:ObjectDescriptor>>;
               INNER
            #);
       #);
     new::< 
       (# do <<SLOT PropertyDiagramNew:ObjectDescriptor>>; INNER #);
  #);  

