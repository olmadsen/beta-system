ORIGIN 'diagramattributes';
-- CommentNodeDisplay: Descriptor --
(# x,y,w,h: @Integer; 
do
   theNode.geometry->(x,y,w,h);
   x+w div 2->pos.x;
   y->pos.y;
   (*(if gppProp.CompositionDType > gppProp.CompositionNested
    // false then
    y->pos.y; 
    // true then
    y-h div 2->pos.y; 
    if);*)
   
#)  

-- CommentMarkOnInit: Descriptor --
(# 
do
   UDPrivate.UDCommentMark->UserDataInit;
   open.Init;
   theComment.Init;
   theCommentNode.Init;
   theConn.Init;
   22->FillType;
   (* make gray *)
   (*'c' -> theText.set;*)
   
#)  

-- CommentMarkOnRemove: Descriptor --
(# 
do (if open and (theCommentNode <> none ) // true then deactivate if); 
#)  

-- CommentMarkDoubleClick: Descriptor --
(# 
do
(*false->proceed;
 'CommentMarkDoubleClick'->screen.putLine; 
 (if open
 //false then activate;
 //true then deactivate;
 if);
 * *) 
#)  

-- CommentMarkSelect: Descriptor --
(# 
do (*'CommentMarkSelect'->screen.putLine; *) (*   activate;*)
   (if open // false then activate // true then deactivate if); 
#)  

-- CommentMarkActivate: Descriptor --
(# x,y,w,h: @Integer; theComment: ^MyCommentNode; 
do
   (if open
    // false then
       &MyCommentNode[]->theComment[];
       THIS(CommentMark)[]->theComment.theMarkNode;
       geometry->(x,y,w,h);
       (x+(w div 2)+100+20,y+65,200,130)->theComment.New;
       theComment[]->theCommentNode;
       true->open;
       
   if);
   
#)  

-- CommentMarkDeactivate: Descriptor --
(# 
do
   (if open
    // true then
       (theCommentNode).delete;
       none ->theCommentNode;
       none ->theConn;
       false->open;
       
   if);
   
#)  

-- MyCommentNodeOnInit: Descriptor --
(#
   x,y,w,h,a,b: @Integer;
   box: ^RectNode;
   con: ^PrefixConnector;
   t: ^Text;
   polyNode1,polyNode2: ^PolygonNode;
   poly1,poly2: [4] @Integer;
   
do
   UDPrivate.UDMyCommentNode->UserDataInit;
   theMarkNode.Init;
   1->LineThickNess;
   (* white *)
   20->FillType;
   10->theText.size;
   Helvetica->theText.font;
   (if not initialisingSaved then
       ((theMarkNode).theComment).gettext->t[];
       t->theText.set;
       leftJustification->theText.just;
       FitToText;
       theMarkNode->CreateRegion;
       &RectNode[]->box[];
       (* make connector *)
       geometry->(x,y,w,h);
       x-(w div 2)->a;
       (*upperLeftX*)
       y-(h div 2)->b;
       (*upperLeftY*)
       (* invisible triangle *)
       (*a+6->poly1[1]; b->poly1[2];
        a->poly1[3]; b+6->poly1[4];
        &PolygonNode[]->polyNode1[];    
        (a, b+6,a, b,poly1)->polyNode1.new;
        false->polyNode1.borderVisible;
        false->polyNode1.selectable;
        this(commentNode)[] ->  polyNode1.CreateRegion;*)
       (* visible triangle *)
       (*a+6->poly2[1]; b+6->poly2[2];
        a->poly2[3]; b+6->poly2[4];
        &PolygonNode[]->polyNode2[];   
        (a,b+6,a+6,b,poly2)->polyNode2.new;
        false->polyNode2.selectable;
        this(commentNode)[]->polyNode2.CreateRegion;*)
       (x-(w div 2)+1,y-(h div 2)+1,1,1)->box.new;
       false->box.BorderVisible;
       false->box.selectable;
       THIS(MyCommentNode)[]->box.CreateRegion;
       &PrefixConnector[]->con[];
       (box[],theMarkNode)->con.new;
       con[]->(theMarkNode).theConn;
       (*true -> theMarkNode.open;*)
       
   if)
#)  

-- CommentNodeOnRemove: Descriptor --
(#  #)  

-- CommentNodeDeactivate: Descriptor --
(# 
do (if theMarkNode <> none // true then (theMarkNode).deactivate if); 
#)  

-- AnchorMarkDisplay: Descriptor --
(# x,y,w,h: @Integer; 
do (thePatternDiagramNode).geometry->(x,y,w,h); x-w div 2->pos.x; y->pos.y; 
#)  

-- AnchorMarkOnInit: Descriptor --
(# 
do
   UDPrivate.UDAnchorMark->UserDataInit;
   23->FillType;
   (* make gray *)
   (*'a' -> theText.set;*)
   
#)  

-- AnchorMarkDoubleClick: Descriptor --
(#  do 'AnchorMarkDoubleClick'->screen.putline;  #)  

-- AnchorMarkActivate: Descriptor --
(# x,y,w,h: @Integer; 
do (* hilite the achor in some way *)
   THIS(AnchorMark)[]->CurrentObject;
   (* select *)
   geometry->(x,y,w,h);
   (*(x,y,w*2,h*2) -> geometry; no no!! *)
   1->FillType;
   
#)  

-- AnchorMarkDeactivate: Descriptor --
(# x,y,w,h: @Integer; 
do (* unhilite the achor in some way *)
   geometry->(x,y,w,h);
   (*(x,y,w div 2,h div 2) -> geometry; no no!!*)
   23->FillType;
   (* make gray *)
   
#)  

