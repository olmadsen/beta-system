ORIGIN '../gppinterface';
-- WriteASTReferenceUserData: DescriptorForm --
(#
do
   (if dataType## <= AST## then
       dataElement[]->theAST[];
       theAST.frag[]->theFrag;
       (Id,attributeId,@@ theAST.index,4)->UDWriteType->ok;
       (if ok then
           (if userDataVerbose then
               'Write AST data succeed (index): '->puttext;
               theAST.index->putint;
               'for id: '->puttext;
               id->putint;
               newline
           if)
        else
           (if userDataVerbose then 'Write AST data fail'->putline if)
       if)
   if);
   INNER
#)  

-- ReadASTReferenceUserData: DescriptorForm --
(#
do
     (# anAST: ^AST
     do
        (if dataType## <= AST## then
            (Id,attributeId,@@ ASTIndex)->UDReadType->ok;
            (if ok then
                (if userDataVerbose then
                    'Read AST data succeed (index): '->puttext;
                    ASTIndex->putint;
                    'for id: '->puttext;
                    id->putint;
                    newline
                if);
                theFrag->theFragmentForm[];
                (if theFragmentForm[] <> none then
                    ASTIndex->theFragmentForm.indexToNode->anAST[];
                    (if userDataVerbose then
                        'indexToNode ok (index): '->puttext;
                        anAST.index->putint;
                        newline
                    if);
                    anAST[]->dataElement[]
                if)
             else
                (if userDataVerbose then 'Read AST data fail'->putline if)
            if)
        if);
        INNER
     #)
#)  

-- WritePointUserData: DescriptorForm --
(# do thePoint->(x,y) #)  

-- ReadPointUserData: DescriptorForm --
(# do (x,y)->thePoint #)  

-- InitPointUserData: DescriptorForm --
(# do x.Init; y.Init #)  

-- ReadFragReferenceUserData: DescriptorForm --
(#
   theFrag: ^FragmentForm;
   fg: ^FragmentGroup;
   error: ^Stream;
   theDiagram: ^Diagram;
   thisPatternDiagramNode: ^PatternDiagramNode
do
   (if dataType## <= FragmentForm## then
       (if dataElement[] = none then
           (theGroupName,error[])->top.open->fg[];
           (if fg[] <> none then
               (theFragName,error[])->fg.open->theFrag[]->dataElement[];
               (if theFrag[] <> none then
                   THIS(myNode)[]->thisPatternDiagramNode[];
                   thisPatternDiagramNode.theDiagram->theDiagram[];
                   (theFrag[],theDiagram.theFragmentNode)
                     ->theGroupPage.openFormInSif;
                   (if userDataVerbose then
                       'Read fragmentform user data succeed: '->puttext;
                       fg.fullname->puttext;
                       '-'->puttext;
                       theFrag.name->putline
                   if)
                else
                   (if userDataVerbose then
                       'Read fragmentform user data fail: '->puttext;
                       theGroupName->puttext;
                       '-'->puttext;
                       theFragName->putline
                   if)
               if)
            else
               (if userDataVerbose then
                   'Read fragmentform user data: open group fail!'->putline
               if)
           if)
        else
           dataElement[]->theFrag[];
           (if userDataVerbose then
               'Read fragmentform <> none: '->puttext; theFrag.name->putline
           if)
       if)
   if)
#)  

-- ReadDiagramReferenceUserData: DescriptorForm --
(#
do
   (if dataType## <= Diagram## then
       (Id,attributeId,@@ IDdata)->UDReadType->ok;
       (if ok then
           (if userDataVerbose then
               'Read Diagram reference data for id: '->puttext;
               id->putint;
               ' with attributeId: '->puttext;
               attributeId->putint;
               ' succeed: '->puttext;
               IDdata->putint;
               newline
           if);
           IDdata->theObjectList.find->theNode[];
           theNode.thisDiagram->dataElement[]
        else
           (if userDataVerbose then
               'Read Diagram reference data for id: '->puttext;
               id->putint;
               ' with attributeId: '->puttext;
               attributeId->putint;
               ' fail'->putline
           if)
       if)
   if)
#)  

-- WriteDiagramReferenceUserData: DescriptorForm --
(#
do
   (if dataType## <= Diagram## then
       dataElement[]->theDiagram[];
       theDiagram.titleNode.ID->IDData;
       (ID,attributeID,@@ IDData,4)->UDWriteType->ok;
       (if ok then
           (if userDataVerbose then
               'Write Diagram reference data for id: '->puttext;
               id->putint;
               ' with attributeId: '->puttext;
               attributeId->putint;
               ' succeed:'->puttext;
               IDData->putint;
               newline
           if)
        else
           (if userDataVerbose then
               'Write Diagram reference data for id: '->puttext;
               id->putint;
               ' with attributeId: '->puttext;
               attributeId->putint;
               ' fail'->putline
           if)
       if)
   if)
#)  

-- InitDiagramReferenceUserData: DescriptorForm --
(#
do
   (if dataType## <= Diagram## then
       IDUserDataAttributes+1->IDUserDataAttributes->attributeId;
       (if userDataVerbose then
           'Initialising Diagram reference user data for id: '->puttext;
           id->putint;
           ' ;attributeID: '->puttext;
           attributeID->putint;
           newline
       if);
       true->attrIDalreadyInit
   if)
#)  

-- WriteFragReferenceUserData: DescriptorForm --
(# theFrag: ^FragmentForm; theGroup: ^FragmentGroup
do
   (if dataType## <= FragmentForm## then
       dataElement[]->theFrag[];
       theFrag.name->theFragName;
       theFrag.Father->theGroup[];
       theGroup.fullname->theGroupName
   if)
#)  

-- ReadFragGroupReferenceUserData: DescriptorForm --
(# error: ^Text
do
   (if dataElement[] = none then
       (fullname,error[])->top.open->dataElement[]
   if)
#)  

-- InitFragReferenceUserData: DescriptorForm --
(# do theFragName.Init; theGroupName.Init #)  

-- InitASTReferenceUserData: DescriptorForm --
(# do theFrag.Init #)  

-- InitLocalNode: DescriptorForm --
(#
do
   &Type[]->DataType[];
   LocalNodesUDAttributes+1->LocalNodesUDAttributes->attributeId;
   (if userDataVerbose then
       'Initialising element in localNodes list for id='->puttext;
       id->putint;
       ' ;attributeID: '->puttext;
       attributeID->putint;
       newline
   if);
   (if dataElement[] <> none then
       (if userDataVerbose then
           'dataElement was none. Writing user data!'->putline
       if);
       dataElement[]->WriteUserData
   if);
   INNER InitLocalNode
#)  

-- InitDecomposDiagram: DescriptorForm --
(#
do
   &Type[]->DataType[];
   DecomposDiagramsUDAttributes+1->DecomposDiagramsUDAttributes->attributeId;
   (if userDataVerbose then
       'Initialising element in decomposDiagrams list for id='->puttext;
       id->putint;
       ' ;attributeID: '->puttext;
       attributeID->putint;
       newline
   if);
   (if dataElement[] <> none then
       (if userDataVerbose then
           'dataElement was none. Writing user data!'->putline
       if);
       dataElement[]->WriteUserData
   if);
   INNER InitDecomposDiagram
#)  

-- OADDocumentUpdateUserDataIDs: DescriptorForm --
(#
   oldLocalNodesUDAttributes,oldDecomposDiagramsUDAttributes: @integer;
   ok: @Boolean
do
   LocalNodesUserDataStart->rangeStart;
   LocalNodesUserDataEnd->rangeEnd;
   (myCurrent.Id,LocalNodesUserDataEnd-1,@@ oldLocalNodesUDAttributes)
     ->UDReadType->ok;
   (LocalNodesUserDataStart,oldLocalNodesUDAttributes,myCurrent.ID)->update;
   decomposDiagramsUserDataStart->rangeStart;
   decomposDiagramsUserDataEnd->rangeEnd;
   (myCurrent.Id,LocalNodesUserDataEnd-1,@@ oldDecomposDiagramsUDAttributes)
     ->UDReadType->ok;
   (decomposDiagramsUserDataStart,oldDecomposDiagramsUDAttributes,myCurrent.ID)
     ->update
#)  

