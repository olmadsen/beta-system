ORIGIN '../gppinterface';
INCLUDE '../prettyprintersetup'
        'diagramattributes'
        '~beta/designenv/v1.5/private/userdatabody'
        '~beta/designenv/v1.5/private/designlist'
        '~beta/designenv/v1.5/private/designobjectbody';
-- theFileMenuOpen: Descriptor --
(#
   filename: @Text;
   count: @ShortRef;
   list: @IntegerRef;
   pages,nodes,conns,regions: [0] @Integer;
   thePage: ^theDocument.Page;
   theOADPage: ^theOADDocument.OADPage;
   theObject: ^thePage.DesignObject;
   theConnID: @integer;
   name,fname: @Text;
   help,ext: ^Text
do
   (if callbackVerbose // true then 'CallBackOpenItem'->putline if);
   'Select a .bet, '->help[];
   astFileExtension->help.putText;
   ' or .diag file'->help.putText;
   help->DSFileNameDialog->name;
   (if name.length > 0
    // true then
       name->getExtension->ext[];
       (if ('.bet'->ext.equal) or (astFileExtension->ext.equal) then
           name->removeExtension->name;
           (if currentDiagramName[] = none then
               name.copy->currentDiagramName[];
               '.diag'->currentDiagramName.append;
               
           if);
           (if (*switch[1]*) true then
               'Opening: '->puttext; name[]->putline; 
           if);
           name->openFragmentGroup
        else
           (if '.diag'->ext.equal then
               name->checkAutoSaveFile;
               name->removeExtension->fname;
               '.freja'->fname.append;
               fname
                 ->scanASTfiles
                   (# 
                   do
                      currentGroupName[]->putline;
                      currentModTime->putint;
                      newline
                   #);
               (if name->checkDiagFile then
                   name[]->currentDiagramName[];
                   'Loading '->puttext;
                   name[]->putline;
                   (@@ name.T[1])->DSFileOpenDiagram;
                   &OADDocument[]->theDocument[]->theOADDocument[];
                   theDocument.onInit;
                   (count[],list[])->DSStrGetPageList;
                   (count,list)->GetIntList->pages;
                   (if pages.range > 0 then
                       (for i: pages.range repeat
                         (if i = 1 then
                             &theOADDocument.OADPage[]->thePage[]
                               ->theOADDocument.theGroupPage[];
                             
                          else
                             &theOADDocument.OADPage[]->thePage[]
                               ->theOADDocument.theWorkPage[];
                             
                         if)
                         (* toby 24-11-94: VERY temporary hack (i hope)!!*)
                         ;
                         pages[i]->thePage.onInit;
                         true->thePage.PageCallBack.specialNode;
                         thePage.onReadDiagram;
                         
                       for);
                       theOADDocument.theWorkPage[]->theDocument.CurrentPage;
                       theOADDocument.updateUserDataIDs;
                       loop
                         (#
                            i: @integer;
                            while::< 
                              (# 
                              do (i+2 <= IndexIDList.impl.range)->value
                              #)
                         do
                            i+2->i;
                            (if IndexIDList.impl[i] <> 0 then
                                (if userDataVerbose then
                                    'IndexIDList: updating '->puttext;
                                    indexidlist.impl[i]->putint
                                if);
                                IndexIDList.impl[i]
                                  ->theOADDocument.UserDataIDMap.getID
                                  ->IndexIDList.impl[i];
                                (if userDataVerbose then
                                    ' to '->puttext;
                                    indexidlist.impl[i]->putint;
                                    newline
                                if)
                            if)
                         #);
                       theOADDocument.theWorkPage.PatternDiagrams.theList.scan
                         (#
                            theListDiagram:
                              ^theOADDocument.theWorkPage.ListDiagram
                         do
                            current.e[]->theListDiagram[];
                            theListDiagram[]
                              ->
                                theOADDocument.theWorkPage.PageCallBack.
                                  MakeLocalNodes;
                            theListDiagram.titleNode.thePrefixConn.getID
                              ->theConnID;
                            (if theConnID <> 0 then
                                (theListDiagram[],theConnID)
                                  ->
                                    theOADDocument.theWorkPage.PageCallBack.
                                      MakeConn
                            if)
                         #);
                       theOADDocument.theGroupPage.PatternDiagrams.theList.scan
                         (#
                            theListDiagram:
                              ^theOADDocument.theGroupPage.ListDiagram
                         do
                            current.e[]->theListDiagram[];
                            theListDiagram[]
                              ->
                                theOADDocument.theGroupPage.PageCallBack.
                                  MakeLocalNodes;
                            theListDiagram.titleNode.thePrefixConn.getID
                              ->theConnID;
                            (if theConnID <> 0 then
                                (theListDiagram[],theConnID)
                                  ->
                                    theOADDocument.theGroupPage.PageCallBack.
                                      MakeConn
                            if)
                         #);
                       theOADDocument.theWorkPage.PatternDiagrams.theList.scan
                         (#
                            theListDiagram:
                              ^theOADDocument.theWorkPage.ListDiagram;
                            thisOADDiagram:
                              ^theOADDocument.theWorkPage.OADDiagram;
                            thisFragmentDiagram:
                              ^theOADDocument.theWorkPage.FragmentDiagram;
                            theDummyDesc: ^betaGram.ObjectDescriptor;
                            thisPatternAttDiagram:
                              ^theOADDocument.theWorkPage.PatternAttDiagram;
                            theDummyAST: ^AST
                         do
                            current.e[]->theListDiagram[];
                            (if current.e.struc <=
                            theOADDocument.theWorkPage.OADDiagram##
                             // true then
                                current.e[]->thisOADDiagram[];
                                thisOADDiagram.titlenode.theText.get
                                  ->thisOADDiagram.titleText;
                                (if thisOADDiagram.theDescriptor <> none then
                                    thisOADDiagram.theDescriptor
                                      ->theDummyDesc[];
                                    theDummyDesc.index->current.index;
                                    (if thisOADDiagram## <=
                                    theOADDocument.theWorkPage.
                                      PatternAttDiagram## then
                                        thisOADDiagram[]
                                          ->thisPatternAttDiagram[];
                                        thisPatternAttDiagram.theAST
                                          ->theDummyAST[];
                                        theDummyAST.index->current.index
                                    if)
                                if);
                                
                            if);
                            (if current.e.struc <=
                            theOADDocument.theWorkPage.FragmentDiagram## then
                                current.e[]->thisFragmentDiagram[];
                                thisFragmentDiagram.titlenode.theText.get
                                  ->thisFragmentDiagram.titleText
                            if)
                         #);
                       theOADDocument.theGroupPage.PatternDiagrams.theList.scan
                         (#
                            theListDiagram:
                              ^theOADDocument.theGroupPage.ListDiagram;
                            thisOADDiagram:
                              ^theOADDocument.theGroupPage.OADDiagram;
                            thisFragmentDiagram:
                              ^theOADDocument.theGroupPage.FragmentDiagram;
                            theDummyDesc: ^betaGram.ObjectDescriptor;
                            thisPatternAttDiagram:
                              ^theOADDocument.theGroupPage.PatternAttDiagram;
                            theDummyAST: ^AST
                         do
                            current.e[]->theListDiagram[];
                            (if current.e.struc <=
                            theOADDocument.theGroupPage.OADDiagram##
                             // true then
                                current.e[]->thisOADDiagram[];
                                thisOADDiagram.titlenode.theText.get
                                  ->thisOADDiagram.titleText;
                                (if thisOADDiagram.theDescriptor <> none then
                                    thisOADDiagram.theDescriptor
                                      ->theDummyDesc[];
                                    theDummyDesc.index->current.index;
                                    (if thisOADDiagram## <=
                                    theOADDocument.theGroupPage.
                                      PatternAttDiagram## then
                                        thisOADDiagram[]
                                          ->thisPatternAttDiagram[];
                                        thisPatternAttDiagram.theAST
                                          ->theDummyAST[];
                                        theDummyAST.index->current.index
                                    if)
                                if);
                                
                            if);
                            (if current.e.struc <=
                            theOADDocument.theGroupPage.FragmentDiagram## then
                                current.e[]->thisFragmentDiagram[];
                                thisFragmentDiagram.titlenode.theText.get
                                  ->thisFragmentDiagram.titleText
                            if)
                         #)
                    else
                       'The selected .diag file does not have the right file format!'
                         ->DSUIUserAckMessage
                   if)
               if)
            else
               'Please select a .bet, .ast or .diag file!'->GppAlert
           if)
       if);
       
   if)
#)  

-- theFileMenuSave: Descriptor --
(#
   name: @Text;
   dummyFilter: ##external;
   pageList: ^ObjectList;
   filename: @Text;
   cancelled: ^integerRef;
   prompt: @text;
   count: @ShortRef;
   list: @IntegerRef;
   f: @file;
   diagFile,tildeDiagFile: @file
do
   (if CurrentDiagramName[] <> none then
       currentDiagramName[]->diagFile.name;
       '~'->currentDiagramName.copyAppend->tildeDiagFile.name;
       (if switch[17] then
           'Freja theFileMenuSave:'->putLine;
           diagFile.name->putLine;
           tildeDiagFile.name->putLine
       if);
       (if diagFile.entry.exists then
           'mv .diag .diag~'->putLine; tildeDiagFile.name->diagFile.entry.rename
       if);
       (if currentDiagramName[] <> none then
           currentDiagramName->removeExtension->fileName;
           '.freja'->fileName.Append;
           '#'->fileName.copyAppend->f.name;
           'rm .freja#'->putLine;
           (if f.entry.exists then f.delete if)
        else
           'No currentDiagramName?'->putline
       if);
       SaveLists;
       (count[],list[])->DSStrGetPageList;
       &integerRef[]->cancelled[];
       ' '->prompt.puttext;
       (@@ CurrentDiagramName.T[1],false,cancelled[],true,count,list,
        dummyFilter##,prompt)->DSFileSavePagesAsDiagram;
       (if doQuit then
           '#0saveAndQuit'->sendSifCommand
        else
           '#0save '->sendSifCommand
       if);
       '#'->currentDiagramName.copyAppend->f.name;
       (if f.entry.exists then 'rm .diag#'->putLine; f.delete if)
    else
       SaveAs.hit
   if)
#)  

-- theFileMenuSaveAs: Descriptor --
(#
   name: @Text;
   ext: ^Text;
   dummyFilter: ##external;
   pageList: ^ObjectList;
   filename: @Text;
   cancelled: ^integerRef;
   prompt: @text;
   count: @ShortRef;
   list: @IntegerRef;
   f: @file
do
   ('Save Current Diagram As:','Save')->GppFileNameDialog->name;
   (if name.length > 0
    // true then
       name->getExtension->ext[];
       (if '.diag'->ext.equal then
           name[]->CurrentDiagramName[];
           (if currentDiagramName[] <> none then
               currentDiagramName->removeExtension->fileName;
               '.freja'->fileName.Append;
               (*fileName[]->makeFrejaFile;*)
               '#'->fileName.copyAppend->f.name;
               (if f.entry.exists then f.delete if)
            else
               'No currentDiagramName?'->putline
           if);
           SaveLists;
           (count[],list[])->DSStrGetPageList;
           &integerRef[]->cancelled[];
           ' '->prompt.puttext;
           (@@ name.T[1],false,cancelled[],true,count,list,dummyFilter##,prompt)
             ->DSFileSavePagesAsDiagram;
           (if doQuit then
               '#0saveAndQuit'->sendSifCommand
            else
               '#0save '->sendSifCommand
           if);
           '#'->currentDiagramName.copyAppend->f.name;
           'rm .diag#'->putLine;
           (if f.entry.exists then f.delete if)
        else
           'Extension must be .diag for saved diagrams!'->GppAlert
       if);
       
   if)
#)  

-- theFileMenuInit: Descriptor --
(# 
do
   (UserMenu3+1,'New BETA Program')->NewBetaProgram.init;
   (UserMenu3+2,'New BETA Library')->NewBetaLibrary.init;
   (UserMenu3+3,'Open...')->Open.init;
   (UserMenu3+4,'-')->sep1.init;
   (UserMenu3+5,'Close')->Close.init;
   (UserMenu3+6,'Save')->Save.init;
   (UserMenu3+7,'Save As...')->SaveAs.init;
   (UserMenu3+8,'Revert')->Revert.init;
   (UserMenu3+9,'-')->sep2.init;
   (UserMenu3+10,'Page Setup...')->PageSetup.init;
   (UserMenu3+11,'Print...')->Print.init;
   (UserMenu3+12,'Preferences...')->Preferences.init;
   (UserMenu3+13,'Load Text...')->LoadText.init;
   (UserMenu3+14,'Save Text...')->SaveText.init;
   (UserMenu3+15,'About')->About.init;
   (UserMenu3+16,'Help')->Help.init;
   (UserMenu3+17,'-')->sep3.init;
   (UserMenu3+18,'Quit')->Quit.init;
   sep1.disable;
   sep2.disable;
   sep3.disable;
   Close.disable;
   About.disable;
   Help.disable;
   Revert.disable
#)  

-- DetailHit: Descriptor --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   
do
   CurrentPage->thePage[];
   (if thePage[] <> none
    // true then
       thePage.CurrentObject->theObject[];
       (if theObject[] <> none
        // true then
           (if theObject.struc <= thePage.PatternDiagramNode##
            // true then theObject[]->theNode[]; theNode.detail
            else
               'Selection is not a DiagramNode'->GppAlert; 
           if);
           
        else
           'No Selection'->GppAlert; 
       if)
   if);
   
#)  

-- AbstractHit: Descriptor --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   theNode: ^thePage.PatternDiagramNode;
   
do
   CurrentPage->thePage[];
   (if thePage[] <> none
    // true then
       thePage.CurrentObject->theObject[];
       (if theObject[] <> none
        // true then
           (if theObject.struc <= thePage.PatternDiagramNode##
            // true then theObject[]->theNode[]; theNode.abstract; 
            else
               'Selection is not a DiagramNode'->GppAlert; 
           if);
           
        else
           'No Selection'->GppAlert; 
       if)
   if);
   
#)  

-- ViewMenuDumpNodeItem: Descriptor --
(#
   thePage: ^OADPage;
   theObject: ^thePage.DesignObject;
   thePatternDiagramNode: ^thePage.PatternDiagramNode;
   theAssocNode: ^thePage.AssociationNode
do
   CurrentPage->thePage[];
   (if thePage[] <> none
    // true then
       thePage.CurrentObject->theObject[];
       (if theObject[] <> none then
           (if theObject## <= thePage.PatternDiagramNode## then
               theObject[]->thePatternDiagramNode[]; thePatternDiagramNode.dump
            else
               (if theObject## <= thePage.AssociationNode## then
                   theObject[]->theAssocNode[]; theAssocNode.dump
                else
                   theObject.ID->putint; newline
               if)
           if);
           
       if)
   if)
#)  

-- DumpInheritanceItem: Descriptor --
(#  do theWorkPage.patternDiagrams.InheritanceList.dump #)  

-- DumpAssociationItem: Descriptor --
(#  do theWorkPage.patternDiagrams.AssociationList.dump #)  

-- DumpDynReferenceItem: Descriptor --
(#  do theWorkPage.patternDiagrams.DynReferenceList.dump #)  

-- DumpIndexIDListItem: Descriptor --
(#  do newline; 'IndexIDList: '->putline; IndexIDList.dump #)  

-- ViewMenuTraceItem: Descriptor --
(# 
do
   not switch[10]->switch[10]->switch[11]->switch[12]->switch[1]->switch[2]
     ->switch[20]->switch[21]->switch[22]->switch[23]->switch[30]->switch[17]
#)
(*
 -- classificationHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 false->gppProp.ShowLocals;
 theNode.detail;
 true->gppProp.ShowLocals;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- nestedCompositionHit: Descriptor --
 [* The traditional way; name and all attributes *]
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionNested->gppProp.CompositionDType;
 gppProp.CompositionAll->gppProp.CompositionWith;
 theNode.detail
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- nestedwholePartHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionNested->gppProp.CompositionDType;
 gppProp.CompositionPartWhole->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- nestedReferenceHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionNested->gppProp.CompositionDType;
 gppProp.CompositionReference->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- nestedblockStructureHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionNested->gppProp.CompositionDType;
 gppProp.CompositionBlock->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- treeCompositionHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionTree->gppProp.CompositionDType;
 gppProp.CompositionAll->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- treewholePartHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionTree->gppProp.CompositionDType;
 gppProp.CompositionPartWhole->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- treeReferenceHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionTree->gppProp.CompositionDType;
 gppProp.CompositionReference->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- treeblockStructureHit: Descriptor --
 (#
 thePage: ^OADPage;
 theObject: ^thePage.DesignObject;
 theNode: ^thePage.PatternDiagramNode;
 
 do
 CurrentPage->thePage[];
 (if thePage[] <> none
 // true then
 thePage.CurrentObject->theObject[];
 (if theObject[] <> none
 // true then
 (if theObject.struc <= thePage.PatternDiagramNode##
 // true then
 theObject[]->theNode[];
 gppProp.CompositionTree->gppProp.CompositionDType;
 gppProp.CompositionBlock->gppProp.CompositionWith;
 theNode.detail;
 
 else
 'Selection is not a DiagramNode'->GppAlert; 
 if);
 
 else
 'No Selection'->GppAlert; 
 if)
 if);
 
 #)  
 
 -- CombinedHit: Descriptor --
 (# [* display inheritance diagram with composition boxes around *] 
 do 'Combined Not yet implemented'->gppAlert; 
 #)  
 
 -- HierPresHit: Descriptor --
 (# 
 do
 not gppProp.SimpleHierarchyPresentation->gppProp.SimpleHierarchyPresentation
 ->check
 #)  
 *)  

-- ViewMenuInit: Descriptor --
(# 
do
   (UserMenu4+1,'Detail')->DetailItem.init;
   (UserMenu4+2,'Abstract')->AbstractItem.init;
   (UserMenu4+3,'-')->sep1.init;
   (UserMenu4+4,'Name And Type  (X:@P)')->SimpleAsNameAndTypeItem.init;
   (UserMenu4+5,'Name  (X)')->SimpleAsNameItem.init;
   (UserMenu4+6,'Type  (:P)')->SimpleAsTypeItem.init;
   (UserMenu4+7,'Name And Kind  (X:@)')->SimpleAsNameAndKindItem.init;
   (UserMenu4+8,'-')->sep.init;
   (UserMenu4+9,'References')->ReferencesItem.init;
   (UserMenu4+10,'Specializations')->SpecializationsItem.init;
   (UserMenu4+11,'Associations')->AssociationsItem.init;
   (UserMenu4+12,'-')->sep2.init;
   (UserMenu4+13,'Text Attributes')->TextAttributesItem.init;
   (UserMenu4+14,'-')->sep3.init;
   (UserMenu4+15,'Dump node')->DumpNodeItem.init;
   (UserMenu4+16,'Debug on/off')->TraceItem.init;
   (UserMenu4+17,'User data trace on/off')->TraceUserDataItem.init;
   (UserMenu4+18,'Callback trace on/off')->TraceCallbacksItem.init;
   (UserMenu4+19,'Dump inheritance list')->DumpInheritanceListItem.init;
   (UserMenu4+20,'Dump association list')->DumpAssociationListItem.init;
   (UserMenu4+21,'Dump dynamic reference list')->DumpDynReferenceListItem.init;
   (UserMenu4+22,'Communication trace on/off')->TraceCommunicationItem.init;
   (UserMenu4+23,'Dump indexIDList')->DumpIndexIDListItem.init;
   INNER init;
   (*  (UserMenu4+3,'-')->sep.init;
    (UserMenu4+4,'Classification')->classificationItem.init;
    (UserMenu4+5,'-')->sep1.init;
    (UserMenu4+6,'Nested Composition')->nestedCompositionItem.init;
    (UserMenu4+7,'Whole/Part')->nestedwholePartItem.init;
    (UserMenu4+8,'Reference')->nestedreferenceItem.init;
    (UserMenu4+9,'BlockStructure')->nestedblockStructureItem.init;
    (UserMenu4+10,'-')->sep2.init;
    (UserMenu4+11,'Tree Composition')->treeCompositionItem.init;
    (UserMenu4+12,'Whole/Part')->treewholePartItem.init;
    (UserMenu4+13,'Reference')->treereferenceItem.init;
    (UserMenu4+14,'BlockStructure')->treeblockStructureItem.init;
    (UserMenu4+15,'-')->sep3.init;
    (UserMenu4+16,'Classification & Composition')->combinedItem.init;
    combinedItem.disable; *)
   
#)  

-- SimpleCheckDisplay: Descriptor --
(# 
do
   false->SimpleAsNameAndTypeItem.Check;
   false->SimpleAsNameItem.Check;
   false->SimpleAsTypeItem.Check;
   false->SimpleAsNameAndKindItem.Check;
   theWorkPage.patternDiagrams.theList.Scan
     (#
        thisListDiagram: ^theWorkPage.ListDiagram;
        theDiagramNode: ^thisListDiagram.DiagramNode;
        theNames: ^betaGram.Names
     do
        current.e[]->thisListDiagram[];
        thisListDiagram.localNodes.scan
          (# 
          do
             (if not (current## = thisListDiagram.PatternNode##) then
                 (if current## <= thisListDiagram.DiagramNode## then
                     current[]->theDiagramNode[];
                     (theDiagramNode.theDeclaration).getSon1->theNames[];
                     (theDiagramNode.theDeclaration,theNames.getSon1)
                       ->theDiagramNode.Redisplay
                 if)
             if)
          #);
        thisListDiagram.localNodes.adjustSizes
     #);
   
#)  

-- SimpleAsNameAndTypeHit: Descriptor --
(# 
do gppProp.AsNameAndType->gppProp.SimpleDeclDisplay; SimpleCheck; true->Check; 
#)  

-- SimpleAsNameHit: Descriptor --
(# 
do gppProp.AsName->gppProp.SimpleDeclDisplay; SimpleCheck; true->Check
#)  

-- SimpleAsTypeHit: Descriptor --
(# 
do gppProp.AsType->gppProp.SimpleDeclDisplay; SimpleCheck; true->Check
#)  

-- SimpleAsNameAndKindHit: Descriptor --
(# 
do gppProp.AsNameAndKind->gppProp.SimpleDeclDisplay; SimpleCheck; true->Check
#)  

-- ReferencesItemHit: Descriptor --
(#
   p: ^Page;
   oadP: ^OADPage;
   connectors: ^ObjectList;
   theConn: ^oadP.deletableConnector
do
   currentPage->p[];
   (if p## <= OADPage## then
       p[]->oadP[];
       (not gppProp.references)->gppProp.references->check;
       oadP.GetConnectors->connectors[];
       (if connectors[] <> none then
           connectors.scan
             (# 
             do
                (if (current## <= oadP.dynamicItemConnector##) or
                (current## <= oadP.dynamicComponentConnector##) then
                    current[]->theConn[];
                    (if gppProp.references then
                        true->theConn.BorderVisible
                     else
                        false->theConn.BorderVisible
                    if);
                    theConn.redraw
                if)
             #)
       if)
    else
       'Current page is not an OAD Page'->putline
   if)
#)  

-- SpecializationItemHit: Descriptor --
(#
   p: ^Page;
   oadP: ^OADPage;
   connectors: ^ObjectList;
   theConn: ^oadP.deletableConnector;
   n1,n2: ^oadP.DesignObject;
   thePatternDiagramNode,theOtherPatternDiagramNode: ^oadP.PatternDiagramNode;
   theListDiagram,theOtherListDiagram: ^oadP.Listdiagram
do
   currentPage->p[];
   (if p## <= OADPage## then
       p[]->oadP[];
       (not gppProp.specializations)->gppProp.specializations->check;
       oadP.GetConnectors->connectors[];
       (if connectors[] <> none then
           connectors.scan
             (# 
             do
                (if current## <= oadP.deletableConnector## then
                    current[]->theConn[];
                    true->theConn.getEnds->(n1[],n2[]);
                    (if (n1## <= oadP.PatternDiagramNode##) and
                    (n2## <= oadP.PatternDiagramNode##) then
                        n1[]->thePatternDiagramNode[];
                        n2[]->theOtherPatternDiagramNode[];
                        thePatternDiagramNode.theDiagram->theListDiagram[];
                        theOtherPatternDiagramNode.theDiagram
                          ->theOtherListDiagram[];
                        (if (theConn## <= theListDiagram.PrefixConnector##) or
                        (theConn## <= theOtherListDiagram.PrefixConnector##)
                         then
                            (if gppProp.specializations then
                                true->theConn.BorderVisible
                             else
                                false->theConn.BorderVisible
                            if)
                        if)
                    if)
                if)
             #)
       if)
    else
       'Current page is not an OAD Page'->putline
   if)
#)  

-- AssociationsItemHit: Descriptor --
(#
   p: ^Page;
   oadP: ^OADPage;
   connectors: ^ObjectList;
   theConn,theOtherConn: ^oadP.deletableConnector;
   n1,n2: ^oadP.DesignObject;
   t: @text
do
   currentPage->p[];
   (if p## <= OADPage## then
       p[]->oadP[];
       (not gppProp.associations)->gppProp.associations->check;
       oadP.GetConnectors->connectors[];
       (if connectors[] <> none then
           connectors.scan
             (# theAssociationNode: ^oadP.AssociationNode
             do
                (if current## <= oadP.deletableConnector## then
                    current[]->theConn[];
                    true->theConn.getEnds->(n1[],n2[]);
                    (if n1## <= oadP.AssociationNode## then
                        n1[]->theAssociationNode[]
                     else
                        (if n2## <= oadP.AssociationNode## then
                            n2[]->theAssociationNode[]
                         else
                            none ->theAssociationNode[]
                        if)
                    if);
                    (if theAssociationNode[] <> none then
                        (if theConn[] = theAssociationNode.c1 then
                            theAssociationNode.c2->theOtherConn[]
                         else
                            theAssociationNode.c1->theOtherConn[]
                        if);
                        (if gppProp.associations then
                            theConn.invisibleText->theConn.theText.set;
                            true->theConn.BorderVisible;
                            true->theAssociationNode.BorderVisible;
                            theOtherConn.invisibleText
                              ->theOtherConn.theText.set;
                            true->theOtherConn.BorderVisible
                         else
                            theConn.theText.get->t;
                            (if not (''->t.equal) then
                                t->theConn.invisibleText
                            if);
                            theConn.theText.clear;
                            false->theConn.BorderVisible;
                            false->theAssociationNode.BorderVisible;
                            theOtherConn.theText.get->t;
                            (if not (''->t.equal) then
                                t->theOtherConn.invisibleText
                            if);
                            theOtherConn.theText.clear;
                            false->theOtherConn.BorderVisible
                        if)
                    if)
                if)
             #)
       if)
    else
       'Current page is not an OAD Page'->putline
   if)
#)  

-- TextAttributesItemHit: Descriptor --
(#  do menuID.textMenu.textAttr->DSUIMenuExecute #)  

-- RefreshItem: Descriptor --
(#  do (menuID.pageMenu,menuID.pageMenu.Cleanup)->CallOAMenu #)  

-- ReduceItem: Descriptor --
(#  do (menuID.pageMenu,menuID.pageMenu.reduce)->CallOAMenu #)  

-- BlowupItem: Descriptor --
(#  do (menuID.pageMenu,menuID.pageMenu.blowup)->CallOAMenu #)  

-- AttributesItem: Descriptor --
(# 
do (menuID.pageMenu,menuID.pageMenu.changeFatts)->CallOAMenu
#)
(* -- NewCommentHit: Descriptor --
 * (#  #)  
 * 
 * -- ShowCommentHit: Descriptor --
 * (#
 *    thePage: ^OADPage;
 *    theObject: ^thePage.DesignObject;
 *    theNode: ^thePage.MarkNode;
 *    
 * do
 *    CurrentPage->thePage[];
 *    thePage.CurrentObject->theObject[];
 *    (if theObject[] <> none
 *     // true then
 *        (if theObject.struc <= thePage.MarkNode##
 *         // true then theObject[]->theNode[]; theNode.activate; 
 *        if);
 *        
 *    if);
 *    
 * #)  
 * 
 * -- HideCommentHit: Descriptor --
 * (#
 *    thePage: ^OADPage;
 *    theObject: ^thePage.DesignObject;
 *    theNode: ^thePage.MarkNode;
 *    
 * do
 *    CurrentPage->thePage[];
 *    thePage.CurrentObject->theObject[];
 *    (if theObject[] <> none
 *     // true then
 *        (if theObject.struc <= thePage.MarkNode##
 *         // true then theObject[]->theNode[]; theNode.deactivate; 
 *        if);
 *        
 *    if);
 *    
 * #)  
 * 
 * 
 *)  

-- ShowGroupWindowItem: Descriptor --
(# 
do
   true->theGroupPage.visible;
   theGroupPage.currentObject
     ->theGroupPage.currentObject (#  do true->autoPan #);
   
#)  

-- PageMenuInit: Descriptor --
(# 
do
   (UserMenu7+1,'Refresh')->RefreshItem.init;
   (UserMenu7+2,'Reduce')->ReduceItem.init;
   (UserMenu7+3,'BlowUp')->BlowupItem.init;
   (UserMenu7+4,'Attributes...')->AttributesItem.init;
   (UserMenu7+5,'-')->sep1.init;
   sep1.disable;
   (UserMenu7+6,'Show GroupWindow')->ShowGroupWindowItem.init;
   
#)
(*
 -- OptionsMenuInit: Descriptor --
 (# 
 do [*(UserMenu3+1,'Composition Marks') -> CompositionWithMarkItem.init;*]
 (UserMenu3+1,'Detailing On Same Page')->OnSamePageItem.init;
 (UserMenu3+2,'Simple Hierarchy Presentation')->hierPresItem.init;
 (UserMenu3+3,'-')->sep1.init;
 (UserMenu3+4,'Name And Type')->SimpleAsNameAndTypeItem.init;
 (UserMenu3+5,'Name')->SimpleAsNameItem.init;
 (UserMenu3+6,'Type')->SimpleAsTypeItem.init;
 (UserMenu3+7,'Type And Kind')->SimpleAsNameAndKindItem.init;
 (UserMenu3+8,'-')->sep2.init;
 [*(UserMenu3+12,'Debug') -> DebugItem.init;
 (UserMenu3+12,'-') -> sep3.init;*]
 INNER Init;
 CompositionWithMarkItem.disable;
 sep1.disable;
 sep2.disable;
 [*sep3.disable;*]
 
 #)  
 
 -- OptionsMenuCheckMarks: Descriptor --
 (# 
 do
 gppProp.DetailedOnSamePage->OnSamePageItem.Check;
 (if gppProp.CompositionDType > gppProp.CompositionNested
 // true then true->CompositionWithMarkItem.Check; 
 else
 false->CompositionWithMarkItem.Check; 
 if);
 true->SimpleAsNameAndTypeItem.Check;
 false->gppProp.SimpleHierarchyPresentation->hierPresItem.check;
 
 #)  
 
 -- DebugItem: Descriptor --
 (# 
 do
 not switch[1]->switch[1]->Check;
 [* and set checkmark *]
 (if switch[1]
 // true then
 'debugging ON!'->screen.putline;
 true->verbose->callbackverbose->objectverbose;
 
 else
 'debugging OFF!'->screen.putline;
 false->verbose->callbackverbose->objectverbose;
 
 if);
 
 #)  
 
 -- MarkMenuInit: Descriptor --
 (# 
 do
 (UserMenu6+1,'New Comment')->NewCommentItem.init;
 NewCommentItem.disable;
 (UserMenu6+2,'Show Comment')->ShowCommentItem.init;
 (UserMenu6+3,'Hide Comment')->HideCommentItem.init;
 INNER Init;
 
 #)  
 
 -- MarkMenuCheckMarks: Descriptor --
 (#  #)  
 *)  

