ORIGIN 'diagramattributes';
-- SlotNodeDisplay: Descriptor --
(# t: ^Text; indexText: @text; 
do
(* pos is bottom left of previous box:
 *  calculate center of this box
 *)
   (unExp).index->astIndex;
   (pos.x+(gppProp.width+1) div 2,pos.y+(gppProp.height+1) div 2,gppProp.width,
    gppProp.height,defaultshape)->new;
   false->moveable;
   (* wo don't like these Nodes to be moved alone *)
   false->sizeable;
   titleNode[]->CreateRegion;
   (mps[],(unExp).frag[],unExp,indextext[],none (*streamName[]*) ,80,0,false
    (*abstractPresentation*) ,false (*showSemanticErrors*) ,false
    (*includeComments*) ,false,false,false,false,'',false (*onlyProperties*) ,
    false,false (*
                 test*) )->ppFragment;
   (1,indexText.length-3)->indexText.sub->t[];
   (*  (if aSlotDesc[]
    // none then '<<no name>>'->t[]; 
    else
    aSlotDesc.name->t[]; 
    if);
    (if aSlotDesc.category
    // betaGram.AttributesForm then
    
    // betaGram.Attributes then
    ': AttributeDecl'->t.puttext; 
    // betaGram.ObjectDescriptor then
    ': ObjectDescriptor'->t.puttext; 
    else
    ': Other category: '->t.puttext; aSlotDesc.category->t.putint; 
    if);*)
   THIS(SlotNode)[]->localNodes.append;
   INNER display;
   gppProp.fontSize->theText.size;
   t->theText.set;
   THIS(SlotNode)[]->updateMaxWH;
   (if THIS(ListDiagram)## <= FragmentDiagram## then
       
    else
       (if not gppProp.showAttributes then
           theText.get->t;
           (if not (''->t.equal) then t[]->invisibleText if);
           theText.clear;
           false->BorderVisible;
           false->selectable
       if)
   if);
   
#)  

-- SlotNodeOnDoubleClick: DoPart --
do INNER ;   

-- SlotNodeAbstract: DoPart --
do INNER ;   

-- SlotNodeDetail: DoPart --
do INNER ;   

-- SlotNodeOnSelect: DoPart --
do
   (patterndiagrams.oldSelection[],THIS(SlotNode)[])->changedFocus;
   THIS(SlotNode)[]->patterndiagrams.oldSelection[];
   disableEditName  

-- SlotNodeGetGroup: DoPart --
do
   (if (theDiagram).theFragmentNode <> none
    // true then
         (# fd: ^FragmentDiagram; theDummyFragNode: ^PatternDiagramNode
         do
            (theDiagram).theFragmentNode->theDummyFragNode[];
            theDummyFragNode.theDiagram->fd[];
            fd.theGroup->fg[];
            
         #);
       
    else
       'DiagramNode: GetGroup: no FragmentNode'->screen.putline
   if);
     

-- SlotNodeGetFragment: DoPart --
do
   (if (theDiagram).theFragmentNode <> none
    // true then
         (# fn: ^FragmentNode; 
         do (theDiagram).theFragmentNode->fn[]; fn.theFragment->f[]; 
         #);
       
    else
       'DiagramNode: GetFragment: no FragmentNode'->screen.putline
   if);
     

-- SlotNodeTheSifEditor: DoPart --
do
   (if (theDiagram).theFragmentNode <> none then
       (if se[] = none then
             (# fn: ^FragmentNode; 
             do
                (theDiagram).theFragmentNode->fn[];
                fn.SifEditorInstance[]->se[];
                
             #);
           
        else
             (# fn: ^FragmentNode; 
             do
                (theDiagram).theFragmentNode->fn[];
                se[]->fn.SifEditorInstance[];
                
             #);
           
       if);
       
    else
       'DiagramNode: theSifEditor: no FragmentNode'->screen.putline
   if);
     

-- SlotNodeDump: DoPart --
do
   'SlotNode'->nodetype[];
   '********unExp********'->putline;
   (if unExp <> none then (unExp).dump; newline else 'is NONE!'->putline if)  

-- SlotNodeOnInit: DoPart --
do
   UDPrivate.UDSlotNode->UserDataInit;
   unExp.init;
   (if initialisingSaved then
       gppProp.SimpleAttribute->attributeType;
       THIS(SlotNode)[]->attributes.append;
       textJust.leftJustification->theText.just
   if);
   INNER  

