January 23, 2002, Kim Falk Jørgensen
incooporated the tabs patch for windows.

M guienv/controls.bet

. inserted an automaticTarget booleanvalue.

M guienv/guienv.bet

. window.addTaget
 
M guienv/private/winnt/controls_ntibody.bet

. inside GUIENVeditTextonKeyDown, inserted if statement to prevent the
tabs inserted 

M guienv/private/winnt/guienv_ntibody.bet
. inside GUIENVwindowitemMethodsdispatchMessage: Descriptor
  inserted check if tab is pressed.

M guienv/private/winnt/guienv_ntiprivate.bet

. converted file to Mjolner pretty print.
. insered empty GUIENVwindowAddTarget:DoPart.

**********************************************************************
January 23, 2002, Kim Falk Jørgensen

M controls.bet
M /guienv/private/winnt/controls_ntibody.bet
M /guienv/private/winnt/guienv_ntibody.bet
M /guienv/private/winnt/guienv_ntiprivate.bet

. converted file to Mjolner pretty print.

**********************************************************************
January 23, 2002, Kim Falk Jørgensen

M private/X11/guienv_unixbody.bet

. converted file to Mjolner pretty print.
. insered empty GUIENVwindowAddTarget:DoPart.


**********************************************************************
January 22, 2002, Kim Falk Jørgensen

M guienv.bet

. converted file to Mjolner pretty print.

**********************************************************************
December 04, 2001, Kim Falk Jørgensen

M private/fields_ntibody.bet

. Removed som putlines.

**********************************************************************
November 29, 2001, Kim Falk Jørgensen

M private/fields_ntibody.bet

scrollerlib:

.adjustScrollValue: inside if-imperativs the scrollbar visibility bools are set, used in privateViewsize.
.privateViewSize: checks if the scrollbar i visible, if so then it subtracts the size of it from the view size.

GUIEVNscrollerprivate:

.added horisontalScrollbarVisible,verticalScrollbarVisible booleans 
 to the GUIENVscollerprivate.

This correction is used to make the scroller look nicer
**********************************************************************
October 16, 2001, Mads Brogger Enevoldsen

M private/winnt/guienv_ntibody.bet

. If not the shiftkey is pushed, the key is converted to lowercase.

**********************************************************************
October 11, 2001, Mads Brogger Enevoldsen

M guienv.bet
M private/winnt/guienv_ntiprivate.bet

. in guienv - added false -> done to make it listen to new keyevents.
  And in guienv_ntiprivate added a false -> done to make it listen to 
  other events.

**********************************************************************
Wed Aug 22 14:02:46 MEST 2001 / datpete

M guienv.bet
M private/X11/guienv_unixbody.bet
M private/macintosh/guienv_macbody2.bet
M private/winnt/guienv_ntibody.bet

Der var ingen hånd-cursor i guienv, så denne har jeg tilføjet
i mit eget spor, og implementeret på X11.
På windows er der ikke en standard cursor svarende til dette (ligesom
der heller ikke er til plus-cursoeren. Vi bør nok linke en resource
fil med disse på guienv programmer, men er der noget med at der er et
problem med at man ikke kan linke to resource filer på sit program på
windows? Så går det jo ikke, da f.eks. mjolner/webwise linker sin egen
resource fil på. I givet fald skal vi have løst problemet!!
På windows wil cursors.hand pt blot give standard arrow cursor.

På mac har jeg efter aftale med Michael lavet load af en bruger
defineret resource, som han har lovet at tilføje i den globale
resource fil.


**********************************************************************
August 21, 2001, Mads Brogger Enevoldsen

M private/winnt/guienv_ntibody.bet

Changed the KeysToVk to make it recognize specKey.LEFT / RIGHT / UP / DOWN

**********************************************************************
August 16, 2001, Martin Elmer Jorgensen

M private/X11/guienv_unixbody.bet

Removed a debug putline in keyToMotifVK (in motifMenuLib: Attributes)

**********************************************************************
August 15, 2001, Mads Brogger Enevoldsen

M guienv.bet
M private/winnt/guienv_ntibody.bet

Now possible to use more than one modifier on shortcuts in menuitems.

Implemented on UNIX and Windows.


**********************************************************************
August 15, 2001, Martin Elmer Jorgensen

M keys.bet
M private/keysbody.bet
M private/X11/guienv_unixbody.bet

R private/X11/keys_unixbody.bet
R private/macintosh/keys_macbody.bet
R private/winnt/keys_ntibody.bet

Removed the function platformkeytotext since such a function exists
already in private/winnt/guienv_ntibodyb.bet. Added a similar one in 
private/X11/guienv_unixbody.bet.

**********************************************************************
August 15, 2001, Martin Elmer Jorgensen

A private/keysbody.bet
A private/X11/keys_unixbody.bet
A private/macintosh/keys_macbody.bet
A private/winnt/keys_ntibody.bet

M keys.bet
M private/X11/guienv_unixbody.bet

Added a platform dependent function platformKeyToText to support
differences in special key definitions across platforms.

**********************************************************************
August 2, 2001, Lennert Sloth

M toolbar.bet
M private/toolbarBody.bet
M private/X11/toolbar_unixBody.bet
M private/macintosh/toolbar_macBody.bet
M private/winnt/toolbar_win32Body.bet:
- added ToolBarButtonSeparator and Toolbar.addSeparator.
**********************************************************************

June 28, 2001, Kim Falk.


Inserted check for control modifier in :

M guienv/fields.bet
M guienv/private/X11/fields_unixbody.bet	
M guienv/utils/auxcontrols.bet

**********************************************************************
July 27, 2001, Soren Smidt Hansen

M private/X11/figureitems_unixbody.bet

Changed update to true->update for line and rect in order to get a 
correct update when dragging figureitems.

**********************************************************************
July 5, 2001, Mads B. Enevoldsen

M private/winnt/guienv_ntibody.bet
M private/winnt/guienv_ntiprivate.bet
M utils/private/winnt/textfieldadds_ntibody.bet

Added a global keydownaction to handle events globally before or after 
any other handling of the event. 
Implemented on windows.

**********************************************************************
July 5, 2001, Mads B. Enevoldsen

M guienv.bet
M keys.bet
M private/X11/guienv_unixbody.bet
M private/X11/guienv_unixprivate.bet
M private/winnt/guienv_ntibody.bet

Added a global keydownaction to handle events globally before or after 
any other handling of the event. 
Implemented on UNIX.

In Keys.bet, added a check for smaller characters in the keyToText 
(also correxted in guienv_ntibody.bet).

**********************************************************************
May 20, 2001, Lennert Sloth.


M preliminary/toolbar/toolbar.bet
M preliminary/toolbar/private/winnt/toolbar_win32Body.bet:
- further bound fitToContents

M private/winnt/stddialogs_ntibody.bet:
- GUIENVdialog: doPart, now checks for both (current.type=windowTypes.palette) 
  and current.private.windowFloating.

**********************************************************************
Fri Mar 23 12:35:38 MET 2001, Michael Lassen

M guienv.bet
M private/X11/guienv_unixbody.bet

Added a global onKeyDown event that are called before the normal
dispatching of events to allow special handling og key-board
shortcuts.

Implemented on UNIX.


**********************************************************************
March 20, 2001, Lennert Sloth.

M stddialogs.bet:
- Added defaultExt to fileDialog. The file dialog append this extension 
to the file name if the user fails to type an extension. The string should 
not contain a period (.). 
M private/winnt/stddialogs_ntibody.bet
M private/winnt/external/stdfiledlg.c:
- Implemented use of defaultExt on Win32.

**********************************************************************
Thu Feb 22 16:34:02  2001

M guienvall.bet
M guienvsystemenv.bet
M private/controlsbody.bet
M private/figureitemsbody.bet
M private/graphicsbody.bet
M private/linkedlist.bet
M private/scrolllistsbody.bet
M private/X11/deviceinfo.bet
M private/X11/guienvattributes.bet
M private/X11/guienvattributesbody.bet
M private/X11/motifstuff.bet
M private/X11/selectioncallback.bet
M private/X11/selectioncallbackbody.bet
M private/winnt/selectioncallback.bet
M private/winnt/selectioncallbackbody.bet
M utils/dialogfield.bet
M utils/private/dialogfieldbody.bet


Removed usage of old fragment syntax.

**********************************************************************
Mon Jan 22 18:10:33  2001, Michael Lassen

Completed cleanup of OpenGL on X11

M private/X11/openGL_X11body.bet

**********************************************************************
Mon Jan 22 16:37:42  2001, Michael Lassen

Clean up of OpenGL on windows

apu:openGL>cvs -nq update
M openGL.bet
R openGLBlib.bet
R openGLUlib.bet
R openGLWlib.bet
R openGLXlib.bet
R openGLlib.bet
M demo/OGLtest.bet
M demo/ball.bet
M demo/stars.bet
M private/openGLbody.bet
R private/external/betaopengl.c
M private/winnt/openGL_ntibody.bet

**********************************************************************
Wed Jan 17 20:54:15 MET 2001, Michael Lassen

Removed picture.pict, picture.bmp, picture.xpm
Added picture.png


**********************************************************************
Wed Jan 17 20:28:47 MET 2001, Michael Lassen

X11

Removed libpng and zlib from external

**********************************************************************
Sat Jan  6 17:28:07 MET 2001, Michael Lassen

X11 stuff:
---------

M scrolllists.bet
M private/X11/scrolllists_unixbody.bet

  - Fixed bug in deleteLast, that were deleting the next-to-last instead.
**********************************************************************

January 3, 2000, Lennert Sloth.

Win32 stuff:
------------
M private/winnt/stddialogs_ntibody.bet
M private/winnt/windowbody.bet:
- Reversed the change made on December 18, because windows from other 
applications could no longer be brought in front of the dialog. 

**********************************************************************
Dec 18, 2000, Lennert Sloth.

Win32 stuff:
------------
M preliminary/treeView/treeView.bet
M preliminary/treeView/private/winnt/treeView_win32Body.bet:
- Added inplaceEditLabel. 

M private/winnt/fields_ntibody.bet:
- setTextFieldMargins never did anything. 

M private/winnt/stddialogs_ntibody.bet:
- In noteUserBody and alertUserBody MB_TASKMODAL has been replaced 
  by MB_SYSTEMMODAL to make sure that the dialogs are shown in front
  of other windows.

M private/winnt/windowbody.bet:
- In GUIENVshowWindow HWND_TOP has been replaced by HWND_TOPMOST to 
  make sure that the dialogs are shown in front of other windows.


**********************************************************************
Dec 18, 2000, Peter Andersen.

Lowlevel fixes for linux: External parameters are evaluated from
right to left, which means that external calles in which @@ or
CStruct[] is used MUST NOT involve allocations BEFORE (linux)
or AFTER (non-linux UNIX) these address-operators.

FILES:

M private/X11/graphics_unixbody.bet
M private/X11/guienv_unixbody.bet
M private/X11/guienv_unixprivate.bet
M private/X11/guienvattributes.bet
M private/X11/guienvattributesbody.bet

**********************************************************************
March 30, 2000: Michael Lassen

Implemented onMouseUp on figureitems.



**********************************************************************
March 30, 2000: Michael Lassen

Addition  in the X11 implmentation:

FILE: guienv_unixbody.bet

  - Implemented onMouseEnter/ onMouseLeave by adding eventhandlers
    for EnterNotify/ LeaveNotify

**********************************************************************
Juli 1, 1998: Michael Lassen

Change in the X11 implementation:

FILE: guienv_unixbody.bet
      guienv_unixprivate.bet

  - Free the previous color when a new background color is set.

**********************************************************************
May 13, 1998

Change in the X11 implmentation:

FILE: guienv_unixbody.bet
      - window.open changed to show the window as a modal dialog
       if type = windowTypes.dialog

**********************************************************************
March 27, 1998: Lennert Sloth
Changes in the win32 implementation:

FILE: controls_nitbody.bet
      - iconbutton.onRefresh called drawPixmap with windowId instead 
        of hdc.

FILE: graphics_ntibody.bet
      - just fixed the name of the first parameter in the drawBitmap
        operation.

FILE: stddialogs_ntibody.bet
      - Now use the MB_SETFOREGROUND flag when creating alertUser and
        noteUser dialogs.

**********************************************************************
March 12, 1998: Lennert Sloth
Changes in the win32 implementation:

FILE: graphics_ntibody.bet + loadbitmapfile.c
      - drawRaster now use the correct hdc.

FILE: stddialogs_ntibody.bet
      - If owner is none in a message dialog we now try to use the
        active window. This makes it possible to bring to dialog window
        to the front by clicking in the owner window.

FILE: windowbody.bet
      - Dialog windows now get the active window as owner (if possible).
        This makes it possible to bring to dialog window
        to the front by clicking in the owner window.


**********************************************************************
March 8, 1998: Michael Lassen

Changes in the Macintosh implementation:

FILE: guienv_macbody.bet
 
      - Fixed handling of the defaultButton - the return event
        was sent to the window-target.
        
      - Fixed handling of Palette windows with an active 
	    text field.

**********************************************************************
March 2, 1998: Lennert Sloth
Changes in the win32 implementation:

FILE: guienv_ntibody.bet + guienv_ntiprivate.bet
      - Before creating a new font it is now checked if a font with the
        same characteristics has already been created.
        guienv_ntiprivate.bet: textStyleLib, equal.
        guienv_ntibody.bet: GUIENVtextStyleCreate.

**********************************************************************
February 25, 1998: Lennert Sloth

Changes in the win32 implementation:

FILE: graphics_ntibody.bet
      - New implementation of drawRect. The combination of a stipple
        and transferModes.copy or transferModes.xorBlend is now possible.

      - The use of WS_CLIPCHILDREN (se below, January 30) makes it necessary
        to allocate a DC differently when overrideChildren is true.

FILE: guienv_ntibody.bet
      - Fixed theTimerProc to work with guienvSystemEnv.
      - FitToContents now calls inner.

**********************************************************************
February 19, 1998: Michael Lassen

Change in the Macintosh implementation:

FILES: graphics_macbody.bet
	   guienv_macbody2.bet
	   guienv_macprivate.bet
	   pixmapbody.bet
	   
	- Added support of icon resources in pixmap.
	

**********************************************************************
January 31, 1998: Michael Lassen

Changes in the X11 implementation:

FILE: guienv_unixbody.bet
	- Fixed a bug in localToGlobal. The Menubar was
          not taken in to account. Now the coordinates
          a translated wrt the contents area of the window.


**********************************************************************
January 30, 1998: Lennert Sloth

Changes in the win32 implementation:

FILE: fields_ntibody.bet
      - Fixed problem in GUIENVtextFieldonKeyDown. 
        onBeforeChange was both called for WM_CHAR and WM_KEYDOWN.
        Now it is only called for WM_CHAR.

      - onBeforeChange is now called in GUIENVtextFieldSetContents
        and GUIENVtextFieldInsert.

      - processScroll in scrollerLib. Fixed problem with scrolling when
        the thumb was dragged (i.e. info.wParam.loWord = SB_THUMBPOSITION).

FILE: graphics_ntibody.bet
      - drawRect. If pen.stipple[] is NONE the rect is drawn with 
        pen.foregroundColor and pen.size. Otherwise pen.stipple is
        used, the width and height of the border are always one logical unit.

FILE: guienv_ntibody.bet
      - Fixed BasicEvent.controlKey and basicEvent.shiftKey.
      - Minor things concerning checking the Windows version.
      - Fixed windowItemExitBackgroundColor.
      - Now use WS_CLIPCHILDREN in CreateWindowEx.
      - canvasOpen: has added: true -> this(windowItem).private.updateOnResize;

FILE: guienv_ntiprivate.bet
      - Fixed bug in ref counting in the colors table.

FILE: scrolllists_ntibody.bet
     - Now has borderStyles.shadowIn as default, and is can't be changed (As on X).

FILE: windowbody.bet
      - Added GUIENVwindowbackgroundcolor.


**********************************************************************
January 25, 1998: Michael Lassen

Changes in the macintosh implementation:

FILES: controls_macbody.bet
	   guienv_macbody.bet
	   guienv_macbody2.bet
	   guienv_macprivate.bet

Simplified the menu implementation to ensure the the menubar always
are updated correctly. Whenever the menubar needs to be updated, a
menubarUpdateFlag is set. On idle the menubar is cleared and rebuild
when the flag is set. 

**********************************************************************
January 25, 1998: Michael Lassen

Changes in the macintosh implementation:

FILE: private/macintosh/graphics_macbody.bet

	o An banal error in fillArc is fixed.
	

FILE: private/macintosh/guienv_macbody.bet
      private/macintosh/pixmapbody.bet
	 
	o The BUILD directives changed because of
	  chared library support.
	  
FILE: private/macintosh/guienv_macbody.bet
	  private/macintosh/guienv_macbody2.bet
	  private/macintosh/guienv_macprivate.bet
	  
	o the event handler now uses the EventRecord
	  defined in maclib, instead of a handcoded
	  version.
	  
	o Implementation of window.backGroundColor added.
	
    o minor cosmetic changes

	o Changed the behavior of target (GUIENVwindowSetTarget).
	  Before: an invisible windowitem was not allowed to
	  be target. Now it is allowed. Sif required the change.
	
**********************************************************************
January 23, 1998: Michael Lassen

INTERFACE CHANGE.

A background color property is added to window:

          backgroundColor:
            (* Sets backgroundcolor of this window *)
            (# theColor: @color
            enter theColor
			do ...
            #);



	
**********************************************************************
January 16, 1998: Michael Lassen

X11: When the width or height of a windowitem is set to 0 it is
changed to 1 to avoid X error. Normally it should be regarded as an
error, so maybe some kind of warning should printed to the console
or an exception should be raised.

**********************************************************************
January 12, 1998: Michael Lassen

Added a call to XClearArea in onFrameChanged in the X11 implementation

**********************************************************************
January 12, 1998: Michael Lassen

Commitet the (cosmetic) changes made while generating the Lidkjalv
reference manual.


**********************************************************************
October 13, 1997: Lennert Sloth

guienv/v1.6/private/winnt and guienv/v1.6/private/winnt/external.

- drawseparatorbody.bet: Deleting the pens did not work because they 
  were still selected into the dc.

- guienv_ntibody.bet: Needed two new pen attributes to fix the separator
  problem.

- figureitems_ntibody.bet: "Set" operations now update the figureItems.

- graphics_ntibody.bet: 
    pen.stipple is only used for the Windows pen if 
    pen.foregroundColor is black pen. It is not possible to set the foreground
    color of a pixmap.

- pixmapbody.bet
  BITMAPINFOHEADER_EXT now has a field for the memory object, and the memory
  object is freed in dispose.

- guienv_ntiprivate.bet:
    Pixmap now have a handle to its memory object.
    System pixmaps are now disposed when guienv terminates.


- loadbitmapfile.h and loadbitmapfile.c
  The handle to the memory object is now also returned.



**********************************************************************
September 25, 1997: Michael Lassen

The interface of the Timer pattern in GUIenv.bet has been changed: The
"repeating" virtual has been renamed to "once" and the semantics of
this attribute has been reversed. If once is bound to TRUE, the timer
will not repeat. This means that a timer is repeating by default.

NOTE: The timer was also repeating by default before because the value
of "repeating" was ignored by the implementation.

**********************************************************************
Sept. 22, 1997: JLK
-------------------

- Corrected textstyle.widthOfText to return the width of the longest
line, in tha case of more than one line in text.
- Corrected errep in positioning prompls in the case where father<>NONE.

August 8, 1997: Lennert Sloth
**********************************************************************
   Changes for Win32.
   ------------------
- pixmapbody.bet: Now adds the path to the executable to pathManager.

- The objects that need to be redrawn on frame changed, are now redrawn
  (updateOnResize);

- Fixed problem with closing windows in window.open.

- Added disableDefaultEventHandling, is used by Frigg.

**********************************************************************
August 4, 1997: Lennert Sloth

  Changes for Win32.
  ------------------
- New fragment private/winnt/paletteFunctions.bet
  Can be used if applications need their own color palette.
  If a palette is crated guienv_ntibody.bet now handles WM_PALETTECHANGED
  and WM_QUERYNEWPALETTE. WindowItem.onRefresh also checks for a custom 
  palette.

- The color scale is now the same as Mac and X11: 0 -  65536.

- onValueChanged is now called for scrollbars. (guienv_ntibody.bet, 
  controls_ntibody.bet)

- processCommand now use info.lParam to test if we got a notification code
  or we got a menu/accelerator message.

- iconButton now has a 3D border, shadowOut if not pressed, shadowIn if 
  pressed. It cannot be changed.

- onStateChanged is now called in radioButton and checkBox.

- radiobutton does not toggle any longer - it will stay on if it is
  already on when clicked - this is proper radiobutton behaviour.

- fields_ntibody.bet: 
  textField.eventHandler.onMouse: only if buttonState=1 the event is handled
  via. a notification to the parent.

- graphics_ntibody.bet: Now only creates a new pen if the pen attributes has
  changed since last drawing operation; updatePen, createSimplePen, 
  createAdvancedPen (Before the order in which you set the pen attributes
  mattered). 
  Implemented overrideChildren which should be used instead of 
  utils/graphicsAdds/clipChildren.

- windowbody.bet: 
  - If you have an applicationMenubar and no windowMenubar, the size of the
    window was wrong.
  - window.resizeable has been implemented.

- graphicsadds_ntibody.bet:
  clipChildren: Forgot to do:
  (getGraphicsHdc,TRANSPARENT) -> SetBkMode;
  (getGraphicsHdc,TA_BASELINE+TA_LEFT+TA_UPDATECP) -> SetTextAlign;

- guienvadds_ntibody.bet:
  Added pushButton, toggleButton, editText to windowItem.preferredSize.


**********************************************************************
Mon Jul 21: Michael Lassen

- Removed some x interfacing (is defined in Xt)

- Fixed some boolean / integer warnings

- Removed raster.bet (pixmap is now defined in guienv.bet)


**********************************************************************
Sat Jul 19: Michael Lassen

Made a crude implementation of default button (Motif).


**********************************************************************
Fri Jul 18: Michael Lassen

Changed some Integers to Booleans to avoid Boolean <-> Integer
assignment warnings.

**********************************************************************
Fri Jul 18: Michael Lassen

A new version of the compiler har introduced some semantic errors in
guienv_unixbody, due to some declarations that had the same
name. Fixed by removing "INCLUDE 'xevents'" in guienv_unixprivate and
renaming defineRect in rubberband to defineRect1.



**********************************************************************
Thu Jul 17: Michael Lassen

Changed interface of windowItem.backgroundColor from theColor[] to theColor

******************************************************************************
Sunday, July 13, 1997: Michael Lassen

Updated the windows implementation to reflect the above change...

******************************************************************************
Sunday, July 13, 1997 Michael Lassen


Updated the unix-implementation to reflect the above change...

******************************************************************************
Sunday, July 13, 1997 Michael Lassen


Changed descriptor slots in guienv to dopart slots, and updated the mac
implementation.

******************************************************************************
Thu Jul 10  1997: Michael Lassen:

Fixed some errors on the unix platform:

  - onStateChanged is now called in radioButton and checkBox.

  - radiobutton does not toggle any longer - it will stay on if it is
    already on when clicked - this is proper radiobutton behaviour.

  - scrollbar.value does no longer crash.

  - optionButton.onCurrentItemChanged is now called.

  - An empty window is opened if the application does not open any
    windows, bu has a global menubar - this will allow the menubar to
    be accessible.

  - moved the timer into GUIenv, renames:

       timer.activate => timer.start

       timer.pause => timer.stop


******************************************************************************
Saturday Jun 28: Michael lassen

Fixed a problem with using pixmap as a stipple. A stipple must have
depth 1. If the pixmap has depth > 1, a 1 depth copy is made.

Files: private/X11/graphics_unixbody.bet
       private/X11/guienv_unixprivate.bet 
       private/X11/pixmapbody.bet


******************************************************************************
Friday June 6 1997: Michael Lassen

- Added type:< integerValue to window, type can be normal, dialog or palette

******************************************************************************
Friday June 6 1997: Michael Lassen

- Added backgroundColor to windowItem

******************************************************************************
Thu Jun  5 12:54:37 MET DST 1997

- Fixed the pixmap pathmanger to make it work on windows

******************************************************************************
Monday June 3 1997: Michael Lassen


- Started to change the macintosh implementation to reflect the
  change mentioned below (removal of raster hierarchy). 


******************************************************************************
Monday June 2 1997: Michael Lassen

- Removed the hierarchy in raster.bet

    raster
      bitmap
      pixmap
      grayMap
      compressPixmap

  And moved the pixmap pattern into guienv. Pixmap is implemented in
    private/<platform>/pixmapbody.bet

- Moved utils/private/X11/external/xpm/ into private/X11/external

- Renamed bitmap.readFromX11File to pixmap.read. The read procedure
  guesses the type of the file by looking at it. On unix, read
  searches a number of directories to find the requested file.


******************************************************************************
Friday May 30 1997: Michael Lassen

Remvoved the following features from GUIenv because they were not
implemented:

 - SharedWindow
 - windowItem.print
 - onIdle

******************************************************************************
Friday May 30 1997: Michael Lassen

Removed the windowItem.layout, getLayout, putLayout patterns. They
were not implemented on any platform. 

This is part a clean up of GUIenv where all un-implemented features
will be either implmented or removed.


******************************************************************************
Thursday May 29 1997: Michael Lassen

Merged r4.0.3 onto head and solved conflicts. 

******************************************************************************
Thu May 29  1997: Michael Lassen

Changes in the Macintosh implementation:


o Added a further binding of onVisibleChanged in  Canvas.
  Canvas now sends onVisibleChanged to its visible children.

o Added a further binding of onVisibleChanged in Scrolllist, to 
  hide the toolbox scrollist  by turning drawing on and off 
  (LSetDrawingMode).

o Added assertOpen to all methods in windowItem  (and descendants), 
  so the notOpened exception is called.
	
o Made small fixes to the implementation of optionButton

o Implemented onMouseUp

o Fixed onMouseDown in scrolllist to not call onMouseUp when the click
  occurs in the scrollbar.
  
o Made an overall update fix by testing for "viewable" instead of "visible".

    windowItem.viewable = windowItem.visible AND windowItem.father.viewable
	
o Fixed som scrolling logic bugs in "scroller"

o Implemented the Region pattern in "graphmath"

o Implemented the figureItems

o Changed some dangerous uses of the  @@ operation.

o Moved some toolbox interfacing from guienv to maclib.

o Other small now forgotten fixes.


******************************************************************************
Thu May 29  1997: Michael Lassen

Change in Unix implementation:

The resource popupEnabled are set to False. Normally, it is not
possible to have a popupmenu in both a canvas and one of its
children. When popupEnabled is False, this is possible.

******************************************************************************
Mon Apr 7 1997: Michael Lassen

The changes made in the r4_0_1a_correction_branch is merged into the
main trunk.

******************************************************************************

   The following changes are made in v1.4, r4.0.2.

******************************************************************************
Marts 15, 1997: Michael Lassen

Changes in Unix implementation:

o Changed a problem with the use of shortint in external calls to Xlib
  and Xt: The arguments  was treated as signed shorts by Xlib and
  Xt, but unsigned short by BETA. The fix looks like this:

       x -> uShort2Short -> x;

     uShort2Short:
       (# value: @integer;
       enter value
       do  (if value > 32768 then
              value - 65536 -> value;
           if);
       exit value
       #);

******************************************************************************



1) Introduced use of BUILD instead of MAKE+OBJFILE in implementation

2) transfermode changed to constants instead of objects.

3) In case of 'Cannot open display' in X implementation,
   the program now stops with normal error code instead of 
   failure error code.

******************************************************************************

   The following changes are made in v1.4, r4.0.1.


******************************************************************************

********************************
January 29, 1997: Lennert Sloth

1) guienv_nti.c: 
  - updateAccelTable, deleteAccel: No longer calls CreateAcceleratorTable with
    empty accel list.
  - New function: getOsMajorVersionId.

2) scrolllists.bet: 
   - scrollListDelete: Initial values of "min" and "upper" was wrong.

3) controls_ntibody.bet: 
   Now delegates font changes to the dropDown list.
   - optionbutton.open: 
	(dropDownListID,WM_SETFONT,theTextStyle.textStyleID,1) -> SendMessage;

   - GUIENVoptionButtonOnStyleChanged:
        (dropDownListID,WM_SETFONT,theTextStyle.textStyleID,1) ->SendMessage;


4) guienv_ntibody.bet: 
   - Now detects if too much text is entered into a textfield.
     (if type=EN_MAXTEXT then
   - processWM_CTLCOLORBTN and processWM_CTLCOLORSTATIC are
     new in GUIENVwindowItemMethodsdispatchMessage. They see to that
     the background color of controls are the same as their canvas.


5) guienv_ntibody.bet
   - Interface to getOsMajorVersionId.

6) graphics_ntibody.bet: 
   - Now use penstyle: PS_INSIDEFRAME. 
   - Deleted getOsVersionId. It was also in guienv_ntiprivate.bet

7) fields_ntibody.bet: 
   - Removed processScroll.


8) stddialogs_ntibody.bet: On win32 you cannot set "label". Before
   label was used to set the default filename. This has been
   corrected. "fileName" is now used for that.



********************************
January 28, 1997: Peter Andersen

Renamed files with long file names:

demo/windowWithStandardMenubar.bet
	-> demo/windowWithStdMenubar.bet
private/winnt/optionbutton_ntiprivate.bet
	-> private/winnt/optionbutton_nti.bet
utils/private/X11/movabletextfieldX11body.bet
	-> utils/private/X11/movabletextfield_X11.bet
utils/private/macintosh/movabletextfield_macbody.bet
	-> utils/private/macintosh/movabletextfield_mac.bet
utils/private/winnt/movabletextfield_ntibody.bet
	-> utils/private/winnt/movabletextfield_nti.bet


******************************************************************************
January 25, 1997: Michael Lassen


Unix Implementation:

   o Implemented textField.defaultFont. 
     File:

       ./private/X11/fields_unixbody.bet

******************************************************************************
January 23, 1997: Michael Lassen


Added support for color icons.

New files:

   interface: 

      ./utils/iconname.bet: Adds the operation ``iconname'' to
                            iconButton. This operation reads a pixmap
                            file and uses the pixmap as the icon.

   implementation:

      ./utils/private/iconnamebody.bet
      ./utils/private/X11/iconname_x11body.bet
      ./utils/private/winnt/iconname_ntibody.bet
      ./utils/private/macintosh/iconname_macbody.bet

    external code:

      ./utils/private/external/xpm/*.h *.c Makefile


******************************************************************************
January 22, 1997: Michael Lassen

Unix implementation:

  o The implementation of raster and graphics are extended to make it
    possible to use color pixmaps and not just black and white
    bitmaps. This is done in a way that will *not* interfere with
    existing GUIenv applications. This is accomplished by adding a
    boolean ``newstyle'' to the (unix) private part of raster. The
    ``drawraster'' calls XCopyArea instead of XCopyPlane if
    ``newstyle'' is true.

    Files:
       private/X11/raster_unixbody.bet
       private/X11/graphics_unixbody.bet 

******************************************************************************
January 20, 1997: Michael Lassen

Unix implementation:

  o The use of @@ made safe: All allocations in conjunction with the
    @@ construct and external procedures are eliminated. The affected
    files are:

       ./private/X11/scrolllists_unixbody.bet
       ./private/X11/fields_unixbody.bet

  o The error handler is changed to differentiate between xlib errors
    and xlib fatal error. In the latter case the stack is not dumped
    so as to avoid a stack dump when people choose ``destroy'' in the
    window menu. Files:

       ./private/X11/error.bet
       ./private/X11/errorbody.bet


******************************************************************************
December 19, 1996: Michael Lassen

A correction is made in the unix implementation:

  o The "textField.selection.scrollIntoView" did not always ensure the
    the entire selection was visible in the window. This is changed.

******************************************************************************
December 18, 1996: Michael Lassen

An enhancement is made in the unix implementation: the Xt and Xlib
errors are now catched in a BETA exception and the stack is
dumped. This is useful if the application is started in "sync" mode.

Two new files are added in private/X11:

   error.bet
   errorbody.bet

They are copied almost verbatim from the Bifrosts "errorhandler" code.


******************************************************************************
December 18, 1996: Michael Lassen

An error is fixed in the unix implementation:

  o It was not possible to set and get the textstyle used in the 
    textScrollList, this error is fixed.

******************************************************************************
December 17, 1996: Michael Lassen

A number of errors related to the unix implementation is fixed:

   o The segmentation fault in the "drag" routine is fixed by moving
     an allocation outside of the enter list to an X routine with '@@'
     parameters:

       (display (* allocation *), @@x, ...) -> XQueryPointer;
   
   o A 16 bit wrap error is fixed.


******************************************************************************

December 14, 1996: OLM

A number of minor errors, such as changing absolute references like
	~beta/v1.4.1/guienv/
to relative references.
*****************************************************************************
November, 21, 1996: OLM

In controls_macbody.bet pattern toFuncPtr
	 ##external was changed to ##actionProc
A compiler error will otherwise imply that a Pascal callBack is 
transferred as a C callBack.
*****************************************************************************
November, 8 1996: Michael Lassen

Macintosh implementation:

A reference to MACGlobalToLocal in 
       utils/private/macintosh/track_macbody.bet
is changed to GlobalToLocal to avoid link problems on powermac.

******************************************************************************
November, 7 1996: Michael Lassen

Macintosh implementation:

Some changes are made in the macintosh implementation to correct an
index error that occurred in calls like ``(@@txt.T[1], ...) ->''. A
test is now inserted to check for txt.T.range = 0. The changed files
are in the private/macintosh directory, they are:

     controls_macbody.bet
     fields_macbody.bet
     graphics_macbody.bet
     guienv_macbody2.bet
     guienv_macprivate.bet
     scrolllists_macbody.bet


******************************************************************************
November, 4 1996: Michael Lassen

Version v1.4.1 is created as a merge between v1.3.2 and v1.4, where
v1.3.2 is a special macintosh version for release 3.0.

The changes from  v1.4 to v1.4.1 is:

   o There is not made any significant changes in the interface files.
     Some virtual bindings are added in controls.bet, this changes
     nothing for users of GUIenv.

   o Some macintosh specific bodies are added in the directory
     ``private/macintosh''.

   o mac, ppc and ppcmac MDBODY entries are added in the body files in
     ``private''.


******************************************************************************


   The following changes are made in v1.4 and earlier.

******************************************************************************
August, 9 1996: Lennert Sloth
1) private/winnt/graphics_ntibody.bet
   a) The drawing operations did not take figureItems (i.e. windowItems that are not win32
      windows) into account. This is done now by initializing private.windowID and 
      private.translateX and private.translateY in GUIENVgraphicsBody and then using these
      in all drawing operations, just as in guienv_unixbody.bet

2) private/winnt/guienv_ntibody.bet
   a) GUIENVcanvasOnRefresh: Now only calls onRefresh on figureItems if
      they are visible.

3) private/winnt/guienv_ntiprivate.bet
   a) Because case in fragment names now matters on Win32,
      INCLUDE '~beta/containers/v1.5/hashtable'; 
      was changed to:
      INCLUDE '~beta/containers/v1.5/hashTable';

4) demo/TutorialDemos/textEditorFull.bet
   a) Crashed if you clicked cancel in the file dialog and if you tried to save
      without first having opened a file.

******************************************************************************
June, 28 1996: Lennert Sloth
1) private/winnt/guienv_ntibody.bet 
   
   a) Just removed a debug printout from processDrawItem.

******************************************************************************
June, 27 1996: Lennert Sloth
1) private/winnt/guienv_ntibody.bet 
   
   a) win32Menuitem: create and updateMenuItem:
      No longer just prepends the menuItem name with a '&' to make a 
      Mnemonics. The control is now left to the programmer.
      Removed: '&' -> name.prepend;
      See also 3) private/winnt/win32menubarbody.bet below.

   b) processMouseDown in GUIENVwindowItemMethodsdispatchMessage
      Removed: interfaceObjectID -> SetCapture;
      Somethings stops working under Win95 if we do capture the mouse here.
      These problems has not been observed under Win NT.

   c) processMouseUp in GUIENVwindowItemMethodsdispatchMessage.
      - As we no longer capture the mouse in processMouseDown we should 
        no longer release it here.
      - - 'or doubleClickPossible ' has been removed from condition in 'if'
        statement, and (if doubleClickPossible then
                           0 -> this(guienv).private.lastCaptureID;
                       if);
        has been added to the body of 
        '(if ( (0 < pt.h) and (pt.h < w) and (0 < pt.v) and (pt.v < h) ) then'

   d) The clipboard:
      New implementation of:
       TextToClipboard, TextFromClipboard, GUIENVclipBoardSetText and
       GUIENVclipBoardGetText.
      See also 5) private/winnt/external/guienv_nti.c a) below.

   e) GUIENVStandardWindowProc:
      New implementation. All messages are now allow to slip through.
      This is to make it possible to define new windowitems that must handle
      new messages without having to modify the GUIENVStandardWindowProc.


2) private/winnt/stddialogs_ntibody.bet
 
   a) The changes listed under b) and c) above under guienv_ntibody.bet  
      makes it necessary to clear 
      this(guienv).private.lastCaptureID whenever guienv uses a window that
      is not controled by itself, e.g. when using standard dialogs. Therefor
      "0 -> this(guienv).private.lastCaptureID;" has been added to 
      "GUIENVdialog: doPart" in stddialogs_ntibody.bet.

3) private/winnt/win32menubarbody.bet

   a) GUIENVwin32Menubarappend and GUIENVwin32Menubarinsert
      As for menuItems, no longer just prepends the menuItem name with a 
      '&' to make a Mnemonics. The control is now left to the programmer.
      Removed: '&' -> name.prepend;

4) private/winnt/guienv_ntiprivate.bet

   a) GUIENVPrivate:
      Added  isMCIWndClassReg: @boolean;. Used to support movies.

5) private/winnt/external/guienv_nti.c

   a) New implementation of TextFromClipboard.

6) private/winnt/externa/stdfiledlg.c + private/winnt/stddialogs_ntibody.bet
   
   a) New implementation of stdopenfiledlg and stdsavefiledlg in stdfiledlg.c.
      Now all strings are malloc'd, copied and freed. The result should be freed from
      BETA.
      These changes are reflected in private/winnt/stddialogs_ntibody.bet.

7) private/winnt/fields_ntibody.bet

   a) GUIENVtextFieldPtToPos:
      Translated pos TO local, it must be FROM local.
      Made an operation "translateFromLocal" to do this. 
      GUIENVtextFieldSelectionStart and GUIENVtextFieldSelectionEnd now also use this
      instead of a local copy.


June, 14 1996: Lennert Sloth

1) private/winnt/guienv_ntibody.bet
   
   a) GUIENVDoPart: Added call of onStartApplication.

   b) registerUienvClass in GUIENVdoSetUp:
      - Deleted makeIntResource.
      - Added: 
            0 -> theClass.cbClsExtra;
            0 -> theClass.cbWndExtra;
      - Added:
            cstr.free;

   c) GUIENVdoSetUp:
      - Now only allocates 28 bytes for the message.

   d) GUIENVupdateRect:
      Deleted:
       - hRgn: @integer;
       - (* hRgn -> DeleteObject; *)
       - (* this(guienv).private.damaged[] -> value[]; *) 

   e) textStyleLib: attributes:
      - useTextStyle: Now allocates 56 bytes for infoPtr.

   f) GUIENVterminateBody now just do:
      0 -> PostQuitMessage;

   g) GUIENVstandardFileMenuOpen: 
      Fixed bug: saveMenuItem and saveAsMenuItem was mixed up.
      Before saveMenuItem and saveAsMenuItem were mixed:
      saveMenuitem.open;
      'Save as...' -> saveAsMenuitem.name;
      saveAsMenuitem[] -> append;

      Now:
      saveMenuitem.open;
      'Save' -> saveMenuitem.name;
      saveMenuitem[] -> append;

      saveAsMenuitem.open;
      'Save as...' -> saveAsMenuitem.name;
      saveAsMenuitem[] -> append;

   h) GUIENVwindowitemSetFrame: has been simplified and it is more informative
      in case of errors.

   i) In GUIENVwindowitemCreate: 
      Added: defaultStyle: @integer; 
      and the window styles are now "or'ed" instead of just added.
   
2) private/winnt/guienv_ntiprivate.bet
   
   a) In processOneEvent if continue=0 the we call:
      cleanUp;
      Stop;

   b) cleanUp no longer close windows. 

   c) A linked list 'win32Menubars' has been added in order to Destroy
      win32Menubars when we cleanup.
      menus.cleanUp now calls win32Menubars.cleanUp, 
      and GUIENVwin32Menubaropen appends to the list 
      and GUIENVwin32MenubarClose deletes from the list.

3) private/winnt/fields_ntibody.bet
  
   a) GUIENVtextFieldonKeyDown:
      Now checks if the textfield is still open after INNER:
      (if this(textField).isOpen then ..
      This is necessary because if the textfield is closed in INNER we
      must NOT call the default windowProc.

   b) There is now allocated 56 bytes for the pointer used in the two 
      calls to GetTextMetrics.

   c) TextEditGetRange: Deleted some old code that was just a comment.

   d) GUIENVtextFieldPosToPt: New implementation.

   e) GUIENVtextFieldPtToPos: New implementation.


4) private/winnt/graphics_ntibody.bet

   a) GUIENVgraphicsFillRect: New implementation.

   b) GUIENVgraphicsDrawText: New implementation. The code concerned
      with SetBkMode and SetTextAlign has been moved to
      GUIENVgraphicsBody. See c) below.
 
 
   c) GUIENVgraphicsBody:
      - Deleted: hBrush: @integer; It was not used.
      - Added: 
        prevBkMode: @integer; 
        windowID: @integer;   

        this(windowItem).interfaceObjectID -> windowID;
        Uses windowID instead of this(windowItem).interfaceObjectID.

        (private.hdc,TRANSPARENT) -> SetBkMode -> prevBkMode; 
        (if prevBkMode=0 then
           'SetBkMode failed.' -> screen.putLine;
        if);
        (private.hdc,TA_BASELINE+TA_LEFT+TA_UPDATECP) -> SetTextAlign;


        (private.hdc,prevBkMode) -> SetBkMode;

   

5) private/winnt/windowbody.bet
   a) processActivate and windowCreate:
      If activation in processActivate is false we now do: 
        this(window).interfaceObjectID -> lastActiveWindowID;
      and this code has been removed from windowCreate.

   b) GUIENVwindowClose: 
      - We no longer do:
        (if this(guienv).private.windows.empty then
           0 -> PostQuitMessage;
        if);
      - Deleted some old code that was just a comment.

   c) GUIENVwindowShowModal:
      windowFrame -> frame; has been moved to after the call to show.

   d) GUIENVwindowBringToFront now checks if the window already is in the 
      front by calling GetForegroundWindow.

   e) theEventHandler.onRefresh now gets called on windows.
      processRefresh in GUIENVwindowMethodsdispatchMessage now calls
      theEventHandler.onRefresh and sets update region.


6) private/winnt/win32menubarbody.bet

   a) GUIENVwin32Menubaropen:
      Added:
      this(win32Menubar)[]->this(guienv).private.win32Menubars.append;

   b) GUIENVwin32MenubarClose: 
      Added:
      this(win32Menubar)[]->this(guienv).private.win32Menubars.delete;

7) private/winnt/controls_ntibody.bet

   a) preferredSize in optionButtonLib 
       - (if l.length>0 then
             widthOfLabel + 2 -> widthOfLabel;
         if);
       - now checks if private.optionButtonPopupMenu is none.
       - Adds 2 instead of 18 to prefW.
       - And the calculation of prefH has changed.
      

   b) updateDropDownList in optionButtonLib
      - Deleted: 
        (* this(optionButton).buttonStyle -> theTextStyle[]; *)
      - Added :
        (if l.length>0 then widthOfLabel+2 -> widthOfLabel; if);
        and do not add 2 to widthOfLabel in call to MoveWindow.
   
   c) GUIENVoptionButtonOnLabelChanged, 
      GUIENVoptionButtonOnStyleChanged, and
      GUIENVoptionButtonOpen:
      - Added: (if l.length>0 then widthOfLabel+2 -> widthOfLabel; if);
      - Changed:
        (dropDownListID,widthOfLabel+2,0,100,100,1)->MoveWindow->result;
        to:
        (dropDownListID,widthOfLabel,0,100,100,1)->MoveWindow->result;

   d) GUIENVbuttonSetLabel: Now checks if theLabel is NONE.

   e) editTextLib: attributes:
      setEditTextMargins: Has changed the top and left margin from (1,1) to
                          (2,2) and (2,2) to (3,3).

   f) GUIENVeditTextCreate: Now uses "tos'%or'" instead of just "+" to create
      windowItemStyle.

   g) GUIENVeditTextSetStyle: Removed: 'EdittextSetStyle' -> putline;.

   h) GUIENVradioButtonPrivate, GUIENVRadioButtonOpen, GUIENVRadioButtonClose:
      Has added: theMouseUpAction and theKeyDownAction.
      They are appended in open and deleted in close.
      This is to get the same behavior as on Motif. However, this must be 
      changed in the next version, because this behavior is wrong.
      On windows the windowItemStyle should simply be BS_AUTORADIOBUTTON and
      the actions are not needed.

   i) GUIENVstaticTextOnRefresh: Now calls inner before drawing the label.

   j) GUIENViconButtonOnRefresh:
      Changed: this(windowItem).interfaceObjectID -> windowID;
      to: interfaceObjectID -> windowID;

   k) GUIENViconbuttonOnHiliteChanged:
      Now use windowID instead of interfaceObjectID.

8) private/winnt/scrolllist_ntibody.bet
 
   a) GUIENVselectionDeselect. 
      It was not possible to deselect the first 
      element because of "(if ( (theItem>1)". This has been changed to 
      "(if ( (theItem>0)".

   b) GUIENVselectionSelectItem. 
      The extend parameter was not used. The 
      selection was always extended. This has been fixed.

   c) scrollListLib. Has added LBN_DBLCLK to handleNotification in order to
      call onSelect on doubleClicks.

   d) GUIENVscrollListCreate:
      Now uses tos'%or' to create the window style and has added the
      LBS_NOTIFY listbox style to get notifications when the selection 
      changes.

9) utils/private/winnt/loadraster_ntibody.bet
   
   a) GUIENVloadRaster:
      name.copyPrepend -> (name.copy).Prepend

   b) Removed: RESOURCE nti 'utils.rc';
-----------------------------------------------------------------------

June, 11 1996: Jorgen Lindskov Knudsen

Installed new utils/pane.bet and utils/private/panebody.bet

   - extended to allow zooming/unzooming of the individual pane
     members (zooming implies that the pane member takes over the
     entire pane area.
   - extented to enable explicit specifivation of the fatherFrame.

Changed utils/private/X11/guienvadds_unixbody.bet

   - Fixed a bug in windowItemDrawShadows which used platform specific
     shadow styles.

Changed utils/private/groupbody.bet

   - Fixed a bug in groupOnRefresh using a integer constant (5) as
     borderStyle.

------------------------------------------------------------
June, 10 1996: Henry Michael Lassen

Changed private/X11/guienv_unixbody.bet

   - Fixed a bug in windowItem.show/hide that caused a crash, when
     called on a figureItem

------------------------------------------------------------
May, 31 1996: Henry Michael Lassen

Changed private/X11/deviceinfo.bet:

       - Uses objectPool.scan instead of objectPool.get to work around
         a bug in objectPool.get.

------------------------------------------------------------
May, 23 1996: JLK

Changed implementation of prompts:
	- Corrected error in 'father' settings for the buttons - was
	  visible on Linux and HPUX9MC (buttons were not displayed in the
	  prompt itself in some cases)
	- Made prompts react to <cr> as OK, and <esc> as CANCEL.
	- Protected the implementation against multiple invocations of the ok,
	  etc. virtuals in the case of double-click,etc. on the buttons.
	- Changed the default positioning in the case of father[]=NONE to be
	  center of the screen (previous version used mouseposition, resulting
	  in 'chasing' of multiple dialogs.

------------------------------------------------------------
   6/2 96. Henry Michael Lassen

There are a number of modifications in the motif implementation:

* Changes in graphics_unixbody

   - drawRaster is modified to call XCopyArea instead of XCopyPlane,
     this means that the depth of the pixmap must be the same as the
     screen, therefore readFromX11File is changed in raster_unixbody.

     The clipmask is used, if there is any (Xpm format only).

* Changes in raster_unixbody

   - readFromX11File is modified to read the bitmap into a pixmap with
     the same depth as the screen.

* Changes in fields_unixbody

   - To avoid segmentation fault the result of all 

        XmValue -> getPointerResource

     calls are checked.

------------------------------------------------------------



