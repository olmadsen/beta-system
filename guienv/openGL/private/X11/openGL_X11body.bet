ORIGIN '../openGLbody';
INCLUDE '~beta/opengl/glx';
INCLUDE '~beta/guienv/private/X11/guienv_unixprivate';


--openGLglBSwapBuffers:descriptor--
(# 
do
   (openGLprivate.GLdisplay,openGLprivate.GLwindow)->glXSwapBuffers;
#)

--- openGLareaprivate:descriptor ---
(#                
   args:@arglist;
   fatherwidget:@integer;
   glXWidget:@integer;
   GLdisplay:@integer;
   GLwindow:@integer;
   GLvisual:@integer;
   GLcontext:@integer;
   options:[2]@integer;
#)

--- openGLarealib:attributes ---
openGLWidgetClass:external
  (# widget:@integer;
  exit widget
  #);
GLwNvisualInfo:IntegerObject
  (# do 'visualInfo'->charReptoCString -> value #);
GLwNInstallColormap:IntegerObject
  (# do 'installColormap'->charReptoCString -> value #);
GLwNallocateOtherColors:IntegerObject
  (# do 'allocateOtherColors'->charReptoCString -> value #);
GLwNallocateBackground:IntegerObject
  (# do 'allocateBackground'->charReptoCString -> value #);

--- openGLareaPostCreatedoPart:dopart ---
do
   
--- openGLareaCreateDoPart:doPart ---
do
   father.widgetID->openGLprivate.fatherwidget;
   openGLprivate.fatherwidget->XtDisplay->openGLprivate.GLdisplay;
   3->openGLprivate.options.new;
   GLX_DOUBLEBUFFER->openGLprivate.options[1];
   GLX_RGBA->openGLprivate.options[2];
   0->openGLprivate.options[3];
   (* choose openGL capable visual with depthbuffer *)
   (openGLprivate.GLdisplay,openGLprivate.GLdisplay->XDefaultScreen,@@openGLprivate.options[1])
     ->glXChooseVisual->openGLprivate.GLvisual;
   'Visual: '->puttext;openGLprivate.GLvisual->putint;newline;
   (if openGLprivate.GLvisual=0 then
       'No appropriate visual found!'->putline;
       stop;
    else
       true->Doublebuffer;
   if);
   (openGLprivate.GLdisplay,openGLprivate.GLvisual,0,GL_TRUE)
     ->glXCreateContext->openGLprivate.GLcontext;
   'Context: '->puttext;openGLprivate.GLcontext->putint;newline;
   (if openGLprivate.GLcontext=0 then
       'Error creating openGL context!'->putline;
       stop;
   if);
   
   (1,GLwNvisualInfo,openGLprivate.GLvisual)->openGLprivate.args.set;
   (2,GLwNallocateOtherColors,1)->openGLprivate.args.set;
   (3,GLwNallocateBackground,0)->openGLprivate.args.set; 
   ('glxarea',openGLWidgetClass,openGLprivate.fatherwidget,openGLprivate.args[],3)
     ->XtCreateManagedWidget->openGLprivate.glXwidget->widgetID;
   'Widget: '->puttext;openGLprivate.glXWidget->putint;newline;
   
   
   openGLprivate.glXWidget->XtWindow->openGLprivate.GLwindow;
   'GLwindow: '->puttext;openGLprivate.GLwindow->putint;newline;
   
   (openGLprivate.GLdisplay,openGLprivate.GLwindow,openGLprivate.GLcontext)->glXMakeCurrent;
   'Widget creation finished.'->putline;

