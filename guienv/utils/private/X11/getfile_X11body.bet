ORIGIN '../getfilebody';

INCLUDE '~beta/unixlib/v1.6/unixinterface';
INCLUDE '~beta/basiclib/v1.6/file';
INCLUDE '~beta/sysutils/v1.6/cstring';

-- GUIENVgetFile: doPart --
do (# theFileBrowserWindow: @fileBrowserWindow
        (# fileBrowserType::
             (# filter::
                  (# anEntry: @diskEntry;
                     itsExt: ^text;
                  do (if ext[] = none then
                         true -> value;
                      else
                         (if 'NONE' -> ext.equal then
                             name[] -> anEntry.path;
                             anEntry.path.name.extension -> itsExt[];
                             (if true 
                              // 'bet' -> itsExt.equal
                              // 'ast' -> itsExt.equal
                              // 'astL' -> itsExt.equal
                              // 'res' -> itsExt.equal then
                                 false -> value
                              else
                                 true -> value
                             if);
                          else
                             name[] -> anEntry.path;
                             anEntry.path.name.extension -> itsExt[];
                             ext[] -> itsExt.equal -> value;
                         if);
                     if);
                  #);
                fileSelected::
                  (# 
                  do name.copy -> this(getFile).name[];
                     theFileBrowserWindow.close;
                  #);
                userCancel::
                  (#
                  do theFileBrowserWindow.close;
                  #);
             #);
           open::
             (# cStr: @cString;
             do 'File browser' -> title;
                getCurrentDir -> theFileBrowser.theDirectory;
                hide;
             #);
        #);
   do 
      theFileBrowserWindow.open;
      theFileBrowserWindow.showModal;
   #);
