ORIGIN '../fieldsaddsbody';

INCLUDE '../../../private/winnt/guienv_ntiprivate';
INCLUDE '../../../private/winnt/raster_ntiprivate';
INCLUDE '~beta/win32lib/v1.6/errorhandling';

-- bitmapFieldLib: attributes --
bitmapFieldBitmap:
  (#
  enter private.bitmapFieldBitmap[]
  exit private.bitmapFieldBitmap[]
  #);

zoomBitmap: external
  (# hwnd: @integer;
     hBitmap: @integer;
     xSrcPos, ySrcPos, xDestPos, yDestPos: @integer;
     scale: @integer;
     result: @integer;
  enter (hwnd, hBitmap, xSrcPos, ySrcPos, xDestPos, yDestPos, scale)
  do 'zoomBitmap' -> callC;
  exit result
  #);

-- GUIENVbitmapFieldOnRefresh: descriptor --
(# 
   drawBitmap: external
     (# hwnd: @integer;
        hBitmap: @integer;
        xSrcPos, ySrcPos, xDestPos, yDestPos: @integer;
        result: @integer;
     enter (hwnd, hBitmap, xSrcPos, ySrcPos, xDestPos, yDestPos)
     do 'drawBitmap' -> callC;
     exit result
     #);
   
   result: @integer;
   
   imageWidth,imageHeight: @integer;
   hdc, hbr: @integer; 
   width,height: @integer;
   doReleaseHdc: @boolean;
   bkColor,textColor: @integer;
do 'bitmapFieldOnRefresh' -> putline;
   (if (windowItemDevice=0) then
       interfaceObjectID -> GetDC -> hdc;
       true -> doReleaseHdc;
    else windowItemDevice -> hdc;
   if);
   (if (private.bitmapFieldBitmap[]<>none) then
       (if not private.bitmapFieldBitmap.isIcon then
           (this(bitmapField).interfaceObjectID,
           private.bitmapFieldBitmap.handleToBitmap,0,0,0,0,2)
             -> zoomBitmap -> result; 
       if);
       (if (result=0) then
           'bitmapField.onRefresh: drawBitmap failed. Errorcode: ' -> puttext;
           GetLastError -> putint; newline;
       if);
   if);
   (if doReleaseHdc then 
       (this(windowItem).interfaceObjectID,hdc) -> ReleaseDC;
   if);
   inner onRefresh;
#)

-- GUIENVbitmapFieldOnHiliteChanged: descriptor --
(# 
do
#)

-- GUIENVbitmapFieldSetContents: doPart --
do theBitmap[] -> bitmapFieldBitmap;
   theEventHandler.onBitmapChanged;
   
   
-- GUIENVbitmapFieldGetContents: doPart --
do bitmapFieldBitmap -> theBitmap[];
   
-- GUIENVbitmapFieldCreate: doPart --
do uienvStandardWindowClass -> windowItemClass;
   isStandardClass  -> windowItemClassStatus;
   inner create;
   
-- GUIENVbitmapFieldOpen: doPart --
do inner open;
   
-- GUIENVbitmapFieldClose: doPart --
do inner close;
   
-- GUIENVbitmapFieldPrivate: descriptor --
(# bitmapFieldBitmap: ^bitmap;
#)
