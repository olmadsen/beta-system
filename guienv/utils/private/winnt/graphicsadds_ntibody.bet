ORIGIN '../graphicsaddsbody';
INCLUDE '../../../private/winnt/graphics_ntibody';
INCLUDE '~beta/win32lib/v1.6/mousecursorsupport';

-- lib: attributes --
(* WINGDIAPI int  WINAPI ExtSelectClipRgn(HDC, HRGN, int); *)
ExtSelectClipRgn: external
  (# hdc, hrgn, mode: @integer;
     complexity: @integer;
  enter (hdc, hrgn, mode)
  do 'ExtSelectClipRgn' -> callStd;
  exit complexity
  #);
RGN_COPY: (# do exit 5 #);

DI_NORMAL: (# exit 0x0003 #);

DrawIconEx: external
  (# hdc,                (* HDC, handle to device context *)
     xLeft,              (* int, x-coordinate of upper left corner *)
     yTop,               (* int, y-coordinate of upper left corner *)
     hIcon,              (* HICON, handle to icon to draw *)
     cxWidth,            (* int, width of the icon *)
     cyWidth,            (* int, height of the icon *)
     istepIfAniCur,      (* UINT, index of frame in animated cursor *)
     hbrFlickerFreeDraw, (* HBRUSH, handle to background brush *)
     diFlags: @integer;  (* UINT, icon-drawing flags *)
     result: @integer;
  enter (hdc,xLeft,yTop,hIcon,cxWidth,cyWidth,istepIfAniCur,
     hbrFlickerFreeDraw,diFlags)
  do callStd;
  exit result
  #);

-- graphicsIsInClip: doPart --
do
   
-- graphicsSetClipChildren: doPart --
do (# 
   do (if doClipByChildren then
       else
           
          (private.windowID,getGraphicsHdc) -> ReleaseDC;
          private.windowID -> GetDC -> setGraphicsHdc; 
          (if getGraphicsHdc=0 then
              'GetDCEx failed. Error: ' -> puttext;
              GetLastError -> putint; newline;
          if);
          (if private.penBrush<>0 then
              (getGraphicsHdc, private.penBrush) -> SelectObject;
          if);
          (if private.currentHPen<>0 then
              (getGraphicsHdc, private.currentHPen) -> SelectObject;
           if); 
          (if private.graphicsPenMode<>0 then
              (getGraphicsHdc, private.graphicsPenMode) -> SetROP2;
          if);
          (getGraphicsHdc,TRANSPARENT) -> SetBkMode;
          (getGraphicsHdc,TA_BASELINE+TA_LEFT+TA_UPDATECP) -> SetTextAlign;
      if);
   #)
   
-- graphicsSetClipRectangle: doPart --
do (# hRgn: @integer;
   do (r.left,r.top,r.right,r.bottom) -> CreateRectRgn -> hRgn;
      (if hRgn=0 then
          '**WARNING: CreateRectRgn failed in SetClipRectangl.' -> putline;
       else
          (if ((private.hdc,hRgn) -> SelectClipRgn)=0 then 
              '**WARNING: SelectClipRgn failed in SetClipRectangle.' 
                -> putline;
          if);
          hRgn -> DeleteObject;
      if);
   #);
   
-- GUIENVGraphicsdrawRectangle: doPart --
do r -> drawRect;   

-- graphicsDrawIcon: doPart --
do (getGraphicsHdc,h,v,r.private.handleToPixmap,
   0,0,0,0,DI_NORMAL) -> DrawIconEx;
   
