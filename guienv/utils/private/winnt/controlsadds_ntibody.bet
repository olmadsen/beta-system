ORIGIN '../../controlsadds';

INCLUDE '../../../private/winnt/guienv_ntiprivate';
INCLUDE '../../../private/winnt/guienvattributes';
INCLUDE '../../guienvadds';
INCLUDE '../../../graphics';
INCLUDE '../../../private/winnt/graphics_ntibody';
INCLUDE '../../../guienvactions';
INCLUDE '~beta/win32lib/v1.6/systemmetrics';

-- optionButton2Lib: attributes --

optionButtonPopupMenu:
  (#
  enter private.optionButtonPopupMenu[]
  exit private.optionButtonPopupMenu[]
  #);
   
preferredSize:
  (# prefW, prefH: @integer;
     l: ^text; theTextStyle: ^textStyle;
     heightOfLabel,widthOfLabel: @integer;
     itemH, noOfItems: @integer;
     widthOfItem,maxWidthOfItem: @integer;
  do 
  exit (prefW,prefH)
  #);

updateDropDownList:
  (# prefW,prefH: @integer;
     l: ^text; 
     heightOfLabel,widthOfLabel: @integer;
     theTextStyle: ^textStyle;
     widthOfItem,maxWidthOfItem: @integer;
     itemH,noOfItems: @integer;
  do 
  #);

-- GUIENVoptionButton2OnLabelChanged: descriptor --
(# l: ^text; 
   heightOfLabel,widthOfLabel: @integer;
   theTextStyle: ^textStyle;
   labelH: @integer;
   r: ^rectangle;
   result: @integer;
do 
   inner onLabelChanged;
#)
-- GUIENVoptionButton2OnStyleChanged: descriptor --
(# l: ^text; 
   heightOfLabel,widthOfLabel: @integer;
   theTextStyle: ^textStyle;
   labelH: @integer;
   r:  ^rectangle;
   result: @integer;
do label -> l[];
   style -> theTextStyle[];
   inner onStyleChanged;
#)
-- GUIENVoptionButton2SetCurItem: descriptor --
assertOpen
(# location::(# do 'optionButton2.SetCurItem'->t[] #);
do 
#)

-- GUIENVoptionButton2GetCurItem: descriptor --
assertOpen
(# location::(# do 'optionButton2.GetCutItem'->t[] #);
do 
#)

-- GUIENVoptionButton2SetPopupMenu: descriptor --
assertOpen
(# location::(# do 'optionButton2.SetPopupMenu'->t[] #);
   result,inx: @integer;
   menuItemId: @integer;
   noOfItems: @integer;
do (if (popupMenu[]<>optionButtonPopupMenu) then
       (if (optionButtonPopupMenu<>none) then
           private.optionButtonPopupMenu.delete;
           none -> optionButtonPopupMenu;
       if);
       
       (if (popupMenu[]<>none) then
           popupMenu[] -> optionButtonPopupMenu;
       if);
       theEventHandler.onPopUpMenuChanged;
   if);
#)

-- GUIENVoptionButton2GetPopupMenu: descriptor --
assertOpen
(# location::(# do 'optionButton2.GetPopupMenu'->t[] #);
do optionButtonPopupMenu -> popupMenu[];
#)

-- GUIENVoptionButton2Create: descriptor --
(# 
do (* WS_BORDER -> windowItemStyle;   *)
   (* WS_BORDER + windowItemStyle -> windowItemStyle; *)
   uienvStandardWindowClass -> windowItemClass;
   isStandardClass  -> windowItemClassStatus;
   true -> border.visible;
   borderStyles.shadowOut -> border.style;

   inner create;
#)

-- GUIENVoptionButton2Open: descriptor --
(# translate:
     (# h,v: @integer;
        ntpPtr: @integer
     enter (h,v)
     do (h,v) -> makeNtPointPtr -> ntpPtr;
        (interfaceObjectID,ntpPtr) -> ClientToScreen;
        ntpPtr -> getPointFromNtPointPtr -> (h,v);
        ntpPtr -> free;
     exit (h,v)
     #);
   getBounds:
     (# theNtRectPtr: @integer;
        r: ^rectangle;
        ID: @integer;
     enter ID
     do 16 -> malloc -> theNtRectPtr;
        (ID,theNtRectPtr) -> GetClientRect;
        &rectangle[] -> r[];
        theNtRectPtr -> getRectFromNtRectPtr -> r;
        r.topLeft -> translate -> r.topLeft;
        r.bottomRight -> translate -> r.bottomRight;
        theNtRectPtr -> free;
     exit r[]
     #);
   l: ^text; 
   heightOfLabel,widthOfLabel,labelH: @integer;
   theTextStyle: ^textStyle;
   style: @integer;
   class,name: @text;
   ID,hInstance: @integer;
   r: ^rectangle;
   result: @integer;
   width, height: @integer;
   
do SM_CYMENU -> GetSystemMetrics -> private.deltaH;
   private.deltaH div 2 -> private.deltaH;
   
   
   (* father[] -> private.theButton.open; 
    private.theButton.bringToFront;
    this(optionButton2).bringBack;
    'Label' -> private.theButton.label;
    *)
   
    inner open;
   
   'label: ' -> puttext; label -> putline;
   (* size -> private.theButton.size;
   position -> private.theButton.position;
   
   'position: ' -> puttext; position -> putpoint; newline;
    'size: ' -> puttext; size -> putpoint; newline;
    *)
   
   private.theRefreshAction[] -> this(optionButton2).appendAction;   
   private.theMouseDownAction[] -> this(optionButton2).appendAction;  
#)

-- GUIENVoptionButton2Close: descriptor --
(#
do inner close;
#)

-- GUIENVoptionButton2private: descriptor --
(# deltaH: @integer;
   aOptionButton2: ^optionButton2;
   theButton: @staticText
     (# eventHandler::
          (# onMouseDown::
               (# w,h: @integer;
               do 'theButton.onMouseDown' -> putline;
                  (if optionButtonPopupMenu[]<>NONE then
                      position -> (w,h);
                      h - deltaH -> h;
                      (1,(10,h),theButton[])
                        -> optionButtonPopupMenu.popup;
                   else
                      'optionButtonPopupMenu is none' -> putline;
                  if);
               #);
          #);
        open::
          (# create::
               (# 
               do WS_BORDER + SS_CENTER + windowItemStyle -> windowItemStyle;
               #);
          do 'Label' -> label;
             (50,16) -> size;
             'theButton.open' -> putline;
          #);
     #);
   optionButtonPopupMenu: ^menu;
   
   
   
   theRefreshAction: @this(optionButton2).refreshAction
     (# 
     do doRefresh;
     #);
   
   theMouseDownAction: @this(optionButton2).mouseDownAction
     (# w,h: @integer;
     do (if optionButtonPopupMenu[]<>NONE then
            position -> (w,h);
            h - deltaH -> h;
            (1,(10,h),this(optionButton2)[])
              -> optionButtonPopupMenu.popup;
         else
            'optionButtonPopupMenu is none' -> putline;
        if);
     #);
   
   doRefresh:
     (# w,h: @integer;
        x,y: @integer;
     do size -> (w,h);
        position -> (x,y);
        (x div 2) - 4  -> x;
        
        graphics
        (# 
        do (2,x) -> moveTo;
           this(optionButton2).style -> style;
           (* (255,255,255) -> pen.backgroundColor; *)
           (private.hdc,COLOR_HIGHLIGHT -> GetSysColor) -> SetBkColor;
           label -> drawText;
           ((w-24,8), (w-8,h-8)) -> drawRect; 
           ((w-22,10), (w-10,h-10)) -> fillRect; 
        #);
     #);
#)

