ORIGIN '~beta/uienv/v1.1.8/private/uienvbody';
BODY 'uienv_macbody'
[[
-- Include 'eventsstuff'
-- Include 'quickdrawstuff'
-- Include '~beta/containers/v1.3.1/list'
-- uienvLib: attributes --

currentEvent:
	(#
	exit private.event[]
	#);
currentLocalPosition:
	(#
	enter private.currentLocalPosition
	exit private.currentLocalPosition
	#);
cursorRegion:
	(#
	enter private.cursorRegion
	exit private.cursorRegion
	#);
modalState:
	(#
	enter private.modalState
	exit private.modalState
	#);
lastMenuID:
	(#
	enter private.lastMenuID
	exit private.lastMenuID
	#);
appleMenu:
	(#
	enter private.appleMenu
	exit private.appleMenu
	#);
utilityPort:
	(#
	enter private.utilityPort
	exit private.utilityPort
	#);
doubleClickPossible:
	(#
	enter private.doubleClickPossible
	exit private.doubleClickPossible
	#);
lastClickTime:
	(#
	enter private.lastClickTime
	exit private.lastClickTime
	#);
lastClickPosition:
	(#
	enter private.lastClickPosition
	exit private.lastClickPosition
	#);
hitWindow:
	(#
	enter private.hitWindow[]
	exit private.hitWindow[]
	#);
globalMacMenubar:
	(#
	exit private.globalMacMenubar[]
	#);
(* activeWindow:
	(#
	enter private.activeWindow[]
	exit private.activeWindow[]
	#);
	*)
activeWindow:
	(# theWindow: ^window;
	do <<SLOT UIENVactiveWindow: descriptor>>
	exit theWindow[]
	#);
modeless: (# exit 1 #);
applicationModal: (# exit 2 #);
systemModal: (# exit 3 #);

saveRestoreFocus:
	(#
	do <<SLOT UIENVsaveRestoreFocus: descriptor>>;
	#);
makeMacRect:
	(#	r: ^rectangle;
		mr: ^macRect;
	enter r[]
	do &macRect[] -> mr[];
		(mr.R, 0, r.top)    -> TOS'%inxPutShort';
		(mr.R, 2, r.left)   -> TOS'%inxPutShort';
		(mr.R, 4, r.bottom) -> TOS'%inxPutShort';
		(mr.R, 6, r.right)  -> TOS'%inxPutShort'
	exit mr[]
	#);
makeMacPoly:
	(#	points: [0] ^point;
		macPoly: @integer;
	enter points[]
	do withUtilityPort
			(#
			do OpenPoly -> macPoly;
				points[1] -> MoveTo;
				(for inx: points.range - 1 repeat
					points[inx + 1] -> LineTo;
				for);
				points[1] -> LineTo;
				ClosePoly;
			#);
	exit macPoly
	#);
withUtilityPort:
	(#	currentPort: @longInt;
	do currentPort[] -> GetPort;
		utilityPort -> SetPort;
		inner;
		currentPort -> SetPort;
	#);
savePenState:
	(# penState: [18] @char;
	do @@penState -> GetPenState;
		inner;
		@@penState -> SetPenState;
	#);
macMenuBar:
	(#	menus: @list
			(# element::< menu;
			#);
		append:
			(# theMenu: ^menu;
			enter theMenu[]
			do <<SLOT UIENVmacMenuBarappend: descriptor>>;
			#);
		delete:
			(# theMenu: ^menu;
			enter theMenu[]
			do <<SLOT UIENVmacMenuBardelete: descriptor>>;
			#);
		member: booleanValue
			(# theMenu: ^menu;
			enter theMenu[]
			do <<SLOT UIENVmacMenuBarmember: descriptor>>;
			#);
		findByName:
			(# name: ^text;
				theMenu: ^menu;
			enter name[]
			do <<SLOT UIENVmacMenuBarFindByName: descriptor>>;
			exit theMenu[]
			#);
		findByID:
			(# ID: @integer;
				theMenu: ^menu;
			enter ID
			do <<SLOT UIENVmacMenuBarFindByID: descriptor>>;
			exit theMenu[]
			#);
		init:
			(# do <<SLOT UIENVmacMenuBarInit: descriptor>>; #);
		update:
			(# do <<SLOT UIENVmacMenuBarUpdate: descriptor>>; #);
		needsUpdate: @boolean;
	#);
-- UIenvPrivate: descriptor --
(# done: @boolean; (* True when the eventloop should terminate *)
	cursorRegion: @integer;
	event: @eventRecord;
	currentLocalPosition: @point;
	modalState: @integer;
	activeWindow: ^window;
	windows: @list
		(# element::< window;
			findBywindowPointer:
				(# e: ^element;
					windowPointer: @integer;
				enter windowPointer
				do <<SLOT UIENVwindowsFindBywindowPointer: descriptor>>;
				exit e[]
				#);
			remove:
				(# e: ^element;
				enter e[]
				do e[] -> at -> delete;
				#);
		#);
	menus: @list
		(# element::< menu;
			findByID:
				(# ID: @integer;
					e: ^element;
				enter ID
				do	l: scan
						(#
						do (if current.private.menuID//ID then
								current[] -> e[];
							if);
						#);
				exit e[]
				#);
			remove:
				(# e: ^element;
				enter e[]
				do e[] -> at -> delete;
				#);
		#);
	theMenubar: ^menubar;
	globalMacMenubar: @macMenuBar;
	lastMenuID: @integer;
	appleMenu: @integer;
	utilityPort: @integer;
	hitWindow: ^window;
	doubleClickPossible: @boolean;
	lastClickTime: @integer;
	lastClickPosition: @point;
#)

-- windowLib: attributes --
windowPointer:
	(#
	enter private.windowPointer
	exit private.windowPointer
	#);
theMaxSize:
	(#
	enter private.theMaxSize
	exit private.theMaxSize
	#);
theMinSize:
	(#
	enter private.theMinSize
	exit private.theMinSize
	#);
windowTarget:
	(#
	enter private.windowTarget[]
	exit private.windowTarget[]
	#);
windowContents:
	(#
	enter private.windowContents[]
	exit private.windowContents[]
	#);
hitWindowitem:
	(#
	enter private.hitWindowitem[]
	exit private.hitWindowitem[]
	#);
windowDefaultButton:
	(#
	enter private.windowDefaultButton[]
	exit private.windowDefaultButton[]
	#);
useTextStyle:
	(# style: ^textStyle;
	enter style[]
	do <<SLOT UIENVwindowUseTextStyle: descriptor>>
	#);
windowActive:
	(#
	enter private.windowActive
	exit private.windowActive
	#);
windowVisible:
	(#
	enter private.windowVisible
	exit private.windowVisible
	#);
windowMenuBar:
	(#
	enter private.windowMenuBar[]
	exit private.windowMenuBar[]
	#);
-- UIENVwindowPrivate: descriptor --
(# windowPointer: @integer;
	theMaxSize: @point;
	theMinSize: @point;
	windowActive: @boolean;
	windowVisible: @boolean;
	windowTarget: ^windowItem;
	windowContents: @canvas
		(# eventHandler::<
				(# onMouseDown::<
						(#
						do this(window).theEventHandler.onMouseDown;
						#);
				#);
		#);
	hitWindowitem: ^windowItem;
	windowDefaultButton: ^windowItem;
	windowMenuBar: ^menuBar;
#)

-- menuLib: attributes --
menuID:
	(#
	enter private.menuID
	exit private.menuID
	#);
handle:
	(#
	enter private.handle
	exit private.handle
	#);
menuEnabled:
	(#
	enter private.menuEnabled
	exit private.menuEnabled
	#);
owner:
	(#
	enter private.owner[]
	exit private.owner[]
	#);

-- UIENVmenuPrivate: descriptor --
(# menuID: @integer;
	handle: @integer;
	name: @text;
	menuEnabled: @boolean;
	owner: ^menubar;
	menuitems: @list
		(# element::< menuitem;
			findByNumber:
				(# number: @integer;
					e: ^element;
				enter number
				do l: scan
						(#
						do	(if current.private.number//number then
								current[] -> e[];
								leave l;
							if);
						#);
				exit e[]
				#);
		#);
#)

-- menuItemLib: attributes --
number:
	(#
	enter private.number
	exit private.number
	#);
menuitemIsSeparator:
	(#
	enter private.menuitemIsSeparator
	exit private.menuitemIsSeparator
	#);

-- UIENVmenuitemPrivate: descriptor --
(# number: @integer;
	name: @text;
	key,mark: @char;
	subMenu: ^menu;
	face: @integer;
	checked: @boolean;
	menuitemIsSeparator: @boolean;
#)

-- windowitemLib: attributes --
origin:
	(#
	enter private.origin
	exit private.origin
	#);
clip:
	(#
	enter private.clip
	exit private.clip
	#);
visibleFlag:
	(#
	enter private.visibleFlag
	exit private.visibleFlag
	#);
enabledFlag:
	(#
	enter private.enabledFlag
	exit private.enabledFlag
	#);
hiliteFlag:
	(#
	enter private.hiliteFlag
	exit private.hiliteFlag
	#);
automaticUpdate:
	(#
	enter private.automaticUpdate
	exit private.automaticUpdate
	#);
updateOnResize:
	(#
	enter private.updateOnResize
	exit private.updateOnResize
	#);
windowItemFrame:
	(#
	enter private.windowItemFrame
	exit private.windowItemFrame
	#);
updateMaybe:
	(#
	do (if automaticUpdate then update if);
	#);
calculateFocus:
	(#
	do <<SLOT UIENVwindowItemCalculateFocus: descriptor>>;
	#);
focus:
	(#
	do <<SLOT UIENVwindowitemFocus: descriptor>>;
	#);
focusZero:
	(#
	do <<SLOT UIENVwindowitemFocusZero: descriptor>>;
	#);
	
hit: booleanValue
	(# pt: @point;
	enter pt
	do <<SLOT UIENVWindowItemHit: descriptor>>
	#);
hitMethod: booleanValue
	(#	pt: @point;
	enter pt
	do inner;
	#);
defaultHitMethod: hitMethod
	(#
	do <<SLOT UIENVwindowItemDefaultHitMethod: descriptor>>;
	#);

handleCursor: booleanValue
	(#	pt: @point;
	enter pt
	do <<SLOT UIENVwindowItemHandleCursor: descriptor>>;
	#);
handleCursorMethod: booleanValue
	(#	pt: @point;
	enter pt
	do inner;
	#);
defaultHandleCursorMethod: handleCursorMethod
	(#
	do <<SLOT UIENVwindowItemdefaultHandleCursorMethod: descriptor>>;
	#);
	
methods:
	(#	hit:< hitMethod;
		focusChanged:< object;
		handleCursor:< handleCursorMethod;
	#);
windowitemMethods:
	(#
	enter private.theMethods[]
	exit private.theMethods[]
	#);
windowItemCursor:
	(#
	enter private.windowItemCursor[]
	exit private.windowItemCursor[]
	#);
withMethods:
	(# theMethods: ^methods;
	do windowitemMethods -> theMethods[];
		inner;
	#);
-- UIENVwindowitemPrivate: descriptor --
(# origin: @point;
	clip: @rectangle;
	windowItemFrame: @rectangle;
	visibleFlag,enabledFlag,hiliteFlag,
	automaticUpdate,updateOnResize: @boolean;
	theMethods: ^methods;
	windowItemCursor: ^cursor;
#)

-- canvasLib: attributes --
canvasFocusChangedMethod:
	(#
	do <<SLOT UIENVcanvasFocusChanged: descriptor>>
	#);
canvasHandleCursorMethod: handleCursorMethod
	(#
	do <<SLOT UIENVcanvasHandleCursorMethod: descriptor>>
	#);
canvasMethods: methods
	(#	hit::< defaultHitMethod;
		focusChanged::< canvasFocusChangedMethod;
		handleCursor::< canvasHandleCursorMethod;
	#);

-- UIENVcanvasPrivate: descriptor --
(# children: @list
		(# element::< windowItem;
			remove:
				(# e: ^element;
				enter e[]
				do e[] -> at -> delete;
				#);
			findHitObject:
				(# pt: @point;
					e: ^element;
				enter pt
				do l: scanReverse
						(# where::<
								(#
								do (if (current.enabledFlag and current.visibleFlag) then
										pt -> current.hit -> value;
									else
										false -> value;
									if);
								#);
						do current[] -> e[];
							leave l;
						#);
				exit e[]
				#);
		#);
	selection: @list
     (# 
        element::< windowitem;
     #);
#)

-- textStyleLib: attributes --
familyID:
	(#
	enter private.familyID
	exit private.familyID
	#);
textStyleSize:
	(#
	enter private.textStyleSize
	exit private.textStyleSize
	#);
textStyleFace:
	(#
	enter private.textStyleFace
	exit private.textStyleFace
	#);
textStyleAttributes:
	(#
	enter (familyID,textStyleSize,textStyleFace)
	exit (familyID,textStyleSize,textStyleFace)
	#);
getInfo:
	(# info: ^FontInfo;
	do &FontInfo[] -> info[];
		withTextStyle
			(#
			do info[] -> GetFontInfo;
			#);
	exit info[]
	#);
withTextStyle:
	(#
	do <<SLOT UIENVTextStyleWithTextStyle: descriptor>>
	#);
-- UIENVtextStylePrivate: descriptor --
(# familyID,textStyleSize,textStyleFace: @integer;
#)
--]]
