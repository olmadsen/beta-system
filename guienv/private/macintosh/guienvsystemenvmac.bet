ORIGIN '~beta/basiclib/private/basicsystemenv_mac';
INCLUDE '~beta/guienv/private/macintosh/guienv_macprivate';

-- installKeyboard: Descriptor --
(# 
do 
#)  

---BasicScheduler:descriptor---
sysHead
(# attachNext:
     (# result: @integer;
        realres: @Real; res: @Integer;
        oldTheActive: ^|sysHead;
     do (if theActive[] =NONE then
            NONE -> oldTheActive[]
         else
            (* We are about to reenter attNext. It is therefore 
             * necessary to remove theActive from the active queue
             * to ensure that it is not reattached before we are done
             * with this idle call. *)
            theActive[] -> oldTheActive[];
            theActive.ce[] -> private.active.delete;
        if);
        
        private.attNext -> realres;
        (if oldTheActive[]<>NONE then
           (* 0 -> attNext.value; *)
            oldTheActive.ce[] -> private.active.append;
            oldTheActive[] -> theActive[];
            NONE->oldTheActive[];
        if);
	 	(* private.mdpriv.check; *)
     #);
do initBeforeScheduler;
   setWindowEnv;
   (if theWindowEnv[] = NONE then
        'Error: theWindowEnv is NONE' -> putLine;
   		'       theWindowEnv should refer to an instance of GUIenv' -> putLine;
		newLine;
		'Your program should look like this:' -> putLine;
		newLine;
		'systemenv' -> putLine;
		'  (# GUI: @GUienv (# do ... #);' -> putLine;
		'     setWindowEnv:: (# do GUI[] -> theWindowEnv[] #);' -> putLine;
		'   #)' -> putLine;
		
	else
		(if NOT (theWindowEnv## <= GUIenv##) then
			'theWindowEnv is not a specialization of GUIenv!' -> putText;
			'theWindowEnv should refer to an instance of GUIenv' -> putLine;
			newLine;
			'Your program should look like this:' -> putLine;
			newLine;
			'systemenv' -> putLine;
			'  (# GUI: @GUienv (# do ... #);' -> putLine;
			'     setWindowEnv:: (# do GUI[] -> theWindowEnv[] #);' -> putLine;
			'   #)' -> putLine;
		else
			theWindowEnv[] -> QUA
				(# as:: GUIenv;
				do (* Hook into the GUIenv eventhandler. *)
					&attachNext[] -> thisObj.private.eventHook[];
				#);
			theWindowEnv;
		if);
	if);
#)

--- forksecond:descriptor ---
(# #)

--- pioEnsure:descriptor ---
(##)

--- pioPrivate:descriptor ---
(#

#)
