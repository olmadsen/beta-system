ORIGIN 'widget'
[[
-- Include 'guienvattributes'
-- Include 'guienv_unixprivate'
-- GUIENVLib: attributes --
milliSecsToTicks:
  (# millisecs: @integer;
     ticks: @integer;
  enter millisecs
  do (millisecs * 3) div 50 -> ticks;
  exit ticks
  #);
(*readMouseEventInfo:
  (# theXButtonEvent: @XButtonEvent;
     mask: @integer;
  enter theXButtonEvent
  do theXButtonEvent.time -> private.time;
     private.time -> milliSecsToTicks -> private.when;
     (theXButtonEvent.x,theXButtonEvent.y) -> private.localPosition;
     (theXButtonEvent.x_root,theXButtonEvent.y_root) -> private.globalPosition;
     theXButtonEvent.state -> mask;
     (((mask,shiftMask) -> tos'%and') = shiftMask) -> private.shiftKey;
     (((mask,controlMask) -> tos'%and') = controlMask) -> private.controlKey;
     (((mask,mod1Mask) -> tos'%and') = mod1Mask) -> private.metaKey;
  #);
readMouseInfo:
  (# theXEvent: @XAnyEvent;
     info: ^mouseInfo;
  enter theXEvent
  do private.time -> milliSecsToTicks -> private.when;
     theXEvent.window -> mouse.getMouseInfo -> info[];
     info.local -> private.localPosition;
     info.global -> private.globalPosition;
     info.shiftKey -> private.shiftKey;
     info.controlKey -> private.controlKey;
     info.altKey -> private.altKey;
     info.metaKey -> private.metaKey;
     info.button -> private.buttonState;
  #);
readDoubleClickInfo:
  (# theXButtonEvent: @XButtonEvent;
     pt: @point;
  enter theXButtonEvent
  do (if theXButtonEvent.type
      //XButtonRelease then
         private.lastDoubleClick -> private.doubleClick;
      //XButtonPress then
         false -> private.doubleClick;
         (if private.buttonState//private.lastButton then
             (if (private.when - private.lastButtonPress) < 20 then
                 private.globalPosition -> pt;
                 private.lastButtonPosition -> pt.subTract;
                 (if (pt.h*pt.h + pt.v*pt.v) < 10 then
                     true -> private.doubleClick;
                 if);
             if);
         if);
         private.when -> private.lastButtonPress;
         private.buttonState -> private.lastButton;
         private.globalPosition -> private.lastButtonPosition;
         private.doubleClick -> private.lastDoubleClick;
     if);
  #);
readKeyEventInfo:
  (# 
     keyPressXEvent: @XKeyEvent;
  enter keyPressXEvent
  do keyPressXEvent.translate ->  private.ch;
  #);
getEventData:
  (# theXEvent: @XAnyEvent;
     theXKeyEvent: @XKeyEvent;
     theXButtonEvent: @XButtonEvent;
  enter theXEvent
  do (if theXEvent.type
      //XButtonRelease
      //XButtonPress 
      //XKeyPress then
         theXEvent -> readMouseEventInfo;
         (if theXEvent.type//XKeyPress then
             theXEvent -> theXKeyEvent;
             theXKeyEvent.state -> whatButton -> private.buttonState;
          else
             theXEvent -> theXButtonEvent;
             theXButtonEvent.button -> private.buttonState;
         if);
      else
         theXEvent -> readMouseInfo;
     if);
     (if theXEvent.type
      //XButtonRelease
      //XButtonPress then
         theXEvent ->  readDoubleClickInfo;
      //XKeyPress then
         theXEvent -> readKeyEventInfo;
     if);
  #);
*)
-- GUIENVinterfaceObjectSetWidgetID: doPart --
do ID -> private.widgetID;
   
-- GUIENVinterfaceObjectGetWidgetID: doPart --
do private.widgetID -> ID;
   
-- GUIENVwidgetCreate: descriptor --
(# args: @argList;
do (name,class,father,args[],0) -> XtCreateWidget -> widgetID;
   (* 'Created widget: ID = ' -> putText;
    *    widgetID -> putInt;
    *    ' name = ' -> putText;
    *    name[] -> putLine;
    *)
#)

-- GUIENVwidgetCreateManaged: descriptor --
(# args: @argList;
do (name,class,father,args[],0) -> XtCreateManagedWidget -> widgetID;
   (* 'Created widget: ID = ' -> putText;
    *    widgetID -> putInt;
    *    ' name = ' -> putText;
    *    name[] -> putLine;
    *)
#)

-- GUIENVwidgetCreateArgs: descriptor --
(#
do (name,class,father,args[],numArgs) -> XtCreateWidget -> widgetID;
   (* 'Created widget: ID = ' -> putText;
    *    widgetID -> putInt;
    *    ' name = ' -> putText;
    *    name[] -> putLine;
    *)
#)

-- GUIENVwidgetCreateManagedArgs: descriptor --
(#
do (name,class,father,args[],numArgs) -> XtCreateManagedWidget -> widgetID;
   (* 'Created widget: ID = ' -> putText;
    *    widgetID -> putInt;
    *    ' name = ' -> putText;
    *    name[] -> putLine;
    *)
#)

-- GUIENVwidgetSetIntegerResource: descriptor --
(# args: @argList;
do (1,name,value) -> args.set;
   (widgetID,args[],1) -> XtSetValues;
#)
-- GUIENVwidgetSetBooleanResource: descriptor --
(# args: @argList;
do (if value then
       (1,name,1) -> args.set;
    else
       (1,name,0) -> args.set;
   if);
   (widgetID,args[],1) -> XtSetValues;
#)
-- GUIENVwidgetGetIntegerResource: descriptor --
(# args: @argList; set: @args.set; wid: @integer;
do WidgetID->wid;
   (1,name,@@value) -> set;
   (wid,args[],1) -> XtGetValues;
#)
-- GUIENVwidgetGetShortResource: descriptor --
(# args: @argList; set: @args.set; wid: @integer;
do WidgetID->wid;
   (1,name,@@value) -> set;
   (wid,args[],1) -> XtGetValues;
#)
-- GUIENVwidgetGetCharResource: descriptor --
(# args: @argList; set: @args.set; wid: @integer;
do WidgetID->wid;
   (1,name,@@value) -> set;
   (wid,args[],1) -> XtGetValues;
#)
-- SetCharResource: doPart --
do 
   
-- GUIENVwidgetGetBooleanResource: descriptor --
(# args: @argList; set: @args.set; wid: @integer;
do WidgetID->wid;
   (1,name,@@value) -> set;
   (wid,args[],1) -> XtGetValues;
#)

-- GUIENVwidgetSetStringResource: descriptor --
(# str: @cstring;
   args: @argList;
do value[] -> str.set;
   (1,name,str) -> args.set;
   (widgetID,args[],1) -> XtSetValues;
   str.free;
#)
-- GUIENVwidgetGetStringResource: descriptor --
(# stringAddress, w: @integer;
   args: @argList;
do &text[] -> value[];
   widgetID->w;
   (1,name,@@stringAddress) -> args.set;
   (w,args[],1) -> XtGetValues;
   stringAddress -> cStringToCharRep -> value;
   (* Do NOT free stringAddress - is a pointer into widget *)
#)


-- GUIENVwidgetGetStringResourceCopy: descriptor --
(# stringAddress, w: @integer;
   args: @argList;
do &text[] -> value[];
   widgetID->w;
   (1,name,@@stringAddress) -> args.set;
   (w,args[],1) -> XtGetValues;
   stringAddress -> cStringToCharRep -> value;
   stringAddress -> XtFree; 
#)

-- GUIENVwidgetSetMotifStringResource: descriptor --
(# mstr: @motifString;
   args: @argList;
do value[] -> mstr.setText;
   (1,name,mstr) -> args.set;
   (widgetID,args[],1) -> XtSetValues;
   mstr.destroy;
#)

-- GUIENVwidgetGetMotifStringResource: descriptor --
(# mstr: @motifString;
   args: @argList;
   (*w, dummy: @integer;*)
do (*widgetID->w;*)
   (1, name, 0 (*@@dummy*) ) -> args.set;
   (WidgetID,args[],1) -> XtGetValues;
   1 -> args.get -> mstr;
   mstr.getText -> value[];
   mstr.destroy;
#)
-- GUIENVwidgetGetPointerResource: descriptor --
(# (*w: @integer;*)
   args: @argList;
do (*widgetID->w;*)
   (1,name,@@value) -> args.set;
   (WidgetID,args[],1) -> XtGetValues;
#)


--]]
