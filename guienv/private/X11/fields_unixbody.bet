ORIGIN '../fieldsbody';

INCLUDE 'widget';
INCLUDE 'guienvattributes';
INCLUDE 'motifstuff';
INCLUDE 'guienv_unixprivate';
INCLUDE '~beta/sysutils/v1.4/objinterface';
INCLUDE 'callbacks';

[[
-- textFieldLib: attributes --
getselection: external
  (# w: @integer;
     leftP, rightP: @integer;
     result: @boolean;
  enter (w,leftP,rightP)
  exit result
  #);

handleTextFieldValueChanged: motifCallbackSelector
  (#
  do theEventHandler.onTextChanged;
  #);
textFieldValueChangedProcessor: callbackProcessor
  (# 
  do &handleTextFieldValueChanged[] -> cb[];
  #);

handleTextFieldBeforeChange: textCallbackSelector
  (# allow: @boolean;
     position: @integer;
     length: @integer;
     textBlock: @XmTextBlockRec;
  do startPos -> position;
     textP -> this(guienv).private.textP;
     (if startPos//endPos then
         textP -> textBlock;
         textBlock.length -> length;
      else
         startPos - endPos -> length;
     if);
     (position,length) -> theEventHandler.onBeforeChange -> allow;
     allow -> doit;
  #);
textFielVerifyProcessor: callbackProcessor
  (#
  do &handleTextFieldBeforeChange[] -> cb[];
  #);

-- GUIENVtextFieldBeforeChangeTheText: doPart --
do (# textBlock: @XmTextBlockRec;
      textAddress: @integer;
      textLength: @integer;
      memcpy: external
        (# dstAddress, srcAddress, size: @integer;
        enter (dstAddress, srcAddress, size)
        #);
   do this(guienv).private.textP -> textBlock;
      textBlock.length -> textLength;
      (if textLength > 0 then
          textBlock.ptr -> textAddress;
          &text[] -> value[];
          textLength -> value.T.new;
          (@@value.T[1], textAddress, textLength) -> memcpy;
          textLength -> value.lgth -> value.pos;
       else
          none -> value[];
      if);
   #);
-- GUIENVmovieFieldSetContents: descriptor --
(#
do
#)

-- GUIENVmovieFieldGetContents: descriptor --
(#
do
#)

-- GUIENVmovieFieldSetScaleToFit: descriptor --
(#
do
#)

-- GUIENVmovieFieldGetScaleToFit: descriptor --
(#
do
#)

-- GUIENVmovieFieldCreate: descriptor --
(#
do
#)

-- GUIENVmovieFieldOpen: descriptor --
(#
do inner open;
#)

-- GUIENVmovieFieldClose: descriptor --
(#
do inner close;
#)

-- GUIENVmovieFieldPrivate: descriptor --
(#

#)

-- GUIENVtextFieldDoPaste: descriptor --
(#
do widgetID -> XmTextPaste;
#)

-- GUIENVtextFieldDoCopy: descriptor --
(#
do (widgetID,0) -> XmTextCopy;
#)

-- GUIENVtextFieldDoCut: descriptor --
(#
do (widgetID,0) -> XmTextCut;
#)

-- GUIENVtextFieldDoClear: descriptor --
(# XmTextClearSelection: external
     (# widget, time: @integer;
     enter (widget, time)
     #);
do (widgetID,0) -> XmTextCut;
#)

-- GUIENVtextFieldSetContents: descriptor --
assertOpen
(#
do (XmNvalue,theText[]) -> setStringResource;
#)

-- GUIENVtextFieldGetContents: descriptor --
assertOpen
(# t: ^text;
do  XmNvalue -> getStringResource -> t[];
   &styledText[] -> theText[];
   t -> theText;
#)

-- GUIENVtextFieldGetChar: descriptor --
assertOpen
(# charPtr: @integer;
do XmNvalue -> getPointerResource -> charPtr;
   charPtr + pos -> TOS'%adrGetByte' -> ch;
   charPtr -> XtFree;
#)

-- GUIENVtextFieldLength: descriptor --
assertOpen
(# charPtr: @integer;
do XmNvalue -> getPointerResource -> charPtr;
   charPtr -> strlen -> value;
   charPtr -> XtFree;
#)

-- GUIENVtextFieldScanText: descriptor --
assertOpen
(# amount: @integer;
   charPtr: @integer;
   lastPosition: @Integer;
do (if Start//End then
    else
       XmNvalue -> getPointerResource -> charPtr;
       charPtr -> strlen -> lastPosition;
       (if (end>lastPosition)//true then lastPosition -> end if);
       (if (start<0)//true then 0 -> start; if);
       (if (start>end)//true 
           then 
           -1 -> amount;
           start - 1 -> start;
           end - 1 -> end;
        else 
           1 -> amount 
       if);
       
       loop:
         (if (start<>end)//true then
             charPtr + start -> TOS'%adrGetByte' -> ch;
             inner scanText;
             start + amount -> start;
             restart loop
         if);
       charPtr -> XtFree;
   if);
#)
-- GUIENVtextFieldPosToPt: descriptor --
assertOpen
(# x,y: @integerRef;
   status: @boolean;
do (widgetID,pos,x,y) -> XmTextPosToXY -> status;
   (if status//true then
       x.shortValue -> pt.h;
       y.shortValue -> pt.v;
    else
       (-1,-1) -> pt;
   if);
#)

-- GUIENVtextFieldPtToPos: descriptor --
assertOpen
(#
do (widgetID,pt.h,pt.v) -> XmTextXYtoPos -> pos;
#)

-- GUIENVtextFieldSelectionStart: descriptor --
assertOpen
(# left,right: @integer;
   result: @boolean;
do (widgetID,@@left,@@right) -> getselection -> result;
   (if result//true then
       left -> value;
    else
      XmNcursorPosition -> getPointerResource -> value;
   if);
#)

-- GUIENVtextFieldSelectionEnd: descriptor --
assertOpen
(# left,right: @integer;
   result: @boolean;
do (widgetID,@@left,@@right) -> getselection -> result;
   (if result//true then
       right -> value;
    else
       XmNcursorPosition -> getPointerResource -> value;
   if);
#)

-- GUIENVtextFieldSelectionContents: descriptor --
assertOpen
(# str: @cstring;
do widgetID -> XmTextGetSelection -> str;
   str.get -> theText[];
   str.free;
   theText.T.range -> theText.pos -> theText.lgth;
#)

-- GUIENVtextFieldSelectionScrollIntoView: descriptor --
assertOpen
(#
do (* (XmNtopCharacter,start) -> setIntegerResource; *)
#)

-- GUIENVtextFieldSelectionSet: descriptor --
assertOpen
(# timeStamp: @integer;
do (* lastTimeStamp -> timeStamp; *)
   (widgetID,theStart,theEnd,timeStamp) -> XmTextSetSelection;
#)

-- GUIENVtextFieldSetDefaultStyle: descriptor --
assertOpen
(# 
do (* getTextStyleResource -> style[]; *)
#)

-- GUIENVtextFieldGetDefaultStyle: descriptor --
assertOpen
(# 
do (* style[] -> setTextStyleResource; *)
#)

-- GUIENVtextFieldIsOneStyle: descriptor --
(#
do
#)

-- GUIENVtextFieldSetOneSize: descriptor --
(#
do
#)

-- GUIENVtextFieldSetOneFont: descriptor --
(#
do
#)

-- GUIENVtextFieldSetOneFace: descriptor --
(#
do
#)

-- GUIENVtextFieldSetOneStyle: descriptor --
(#
do
#)

-- GUIENVtextFieldScanTextWithStyle: descriptor --
(#
do
#)

-- GUIENVtextFieldSetMargin: descriptor --
assertOpen
(#
do (XmNmarginWidth,leftMargin) -> setIntegerResource;
   (XmNmarginHeight,topMargin) -> setIntegerResource;
#)

-- GUIENVtextFieldGetMargin: descriptor --
assertOpen
(#
do XmNmarginWidth -> getPointerResource -> leftMargin;
   XmNmarginHeight -> getPointerResource -> topMargin;
#)

-- GUIENVtextFieldInsert: descriptor --
assertOpen
(# pos: @integer;
   XmTextInsert: external
     (# widget, position: @integer;
        charP: @integer;
     enter (widget, position, charP)
     #);
   cstr: @cString;
   left,right: @integer;
   result: @boolean;
do (widgetID,@@left,@@right) -> getselection -> result;
   (if result//true then
       left -> pos;
    else
      XmNcursorPosition -> getPointerResource -> pos;
   if);
   theText[] -> cstr.set;
   (widgetID,pos,cstr) -> XmTextInsert;
   cstr.free;
#)

-- GUIENVtextFieldDelete: descriptor --
assertOpen
(#
do widgetID -> XmTextRemove;
#)

-- GUIENVtextFieldCreate: descriptor --

(# 
do inner create;
   (if widgetID//0 then
       (xmTextWidgetClass,father.widgetID) -> createSimple;
       (XmNeditMode,XmMULTI_LINE_EDIT) -> setIntegerResource;
       (XmNhighlightThickness,0) -> setIntegerResource;
       (XmNautoShowCursorPosition,true) ->  setIntegerResource;
       (XmNverifyBell, false) -> setIntegerResource;
   if);
#)

-- GUIENVtextFieldOpen: descriptor --
(#
do (textFieldValueChangedProcessor##, XmNvalueChangedCallback) -> addCallbackProcessor;
   (textFielVerifyProcessor##, XmNModifyVerifyCallback) -> addCallbackProcessor;
   inner open;
#)

-- GUIENVtextFieldClose: descriptor --
(#
do inner close;
#)

-- GUIENVtextfieldonframechanged: descriptor --
(#
do inner onFrameChanged;
#)

-- GUIENVtextfieldonrefresh: descriptor --
(#
do inner onRefresh;
#)


-- GUIENVtextfieldonidle: descriptor --
(#
do inner onIdle;
#)

-- GUIENVtextfieldonmouseup: descriptor --
(#
do inner onMouseUp;
#)

-- GUIENVtextfieldondisabletarget: descriptor --
(#
do inner onDisableTarget;
#)

-- GUIENVtextfieldonmousedown: descriptor --
(#
do inner onMouseDown;
#)

-- GUIENVtextfieldonkeydown: descriptor --
(#
do inner onKeyDown;
#)

-- GUIENVtextfieldonenabletarget: descriptor --
(#
do inner onEnableTarget;
#)


-- GUIENVtextFieldPrivate: descriptor --
(#
#)

-- GUIENVabstractScrollerScroll: descriptor --
(#
do inner Scroll;
#)

-- GUIENVabstractScrollerCreate: descriptor --
(#
do inner create;
#)

-- GUIENVabstractScrollerOpen: descriptor --
(#
do this(abstractScroller)[] -> contents.open;
   inner open;
#)

-- GUIENVabstractScrollerClose: descriptor --
(#
do inner close;
#)

-- GUIENVabstractScrollerPrivate: descriptor --
(#
   
#)


-- GUIENVtextEditorScroll: descriptor --
(#
do inner scroll;
#)

-- GUIENVtextEditorCreate: descriptor --

(# args: @argList;
   textFieldWidget: @integer;
do inner create;
   (if widgetID//0 then
       (1,XmNeditMode,XmMULTI_LINE_EDIT) -> args.set;
       (father.widgetID,'',args[],1) -> XmCreateScrolledText -> textFieldWidget;
       textFieldWidget -> XtManageChild;
       textFieldWidget -> XtParent -> widgetID;
       textFieldWidget -> contents.widgetID;
   if)
#)

-- GUIENVtextEditorOpen: descriptor --
(#
do 
  inner open;
#)

-- GUIENVtextEditorClose: descriptor --
(#
do inner close;
#)

-- GUIENVtexteditorprivate: descriptor --
(#
#)

-- GUIENVscrollerScroll: descriptor --
(#
do inner scroll;
#)

-- GUIENVscrollerCreate: descriptor --

(# args: @argList;
   name: ^text;
do inner create;
   (if widgetID//0 then
       this(scroller)[] -> getPatternName -> name[];
       (1,XmNscrollingPolicy,XmAUTOMATIC) -> args.set;
       (2,XmNscrollbarDisplayPolicy,XmSTATIC) -> args.set;
       (* (3,XmNvisualPolicy,XmVARIABLE) -> args.set; *)
       (name,xmScrolledWindowWidgetClass,father.widgetID,args[],2) 
         -> XtCreateManagedWidget -> widgetID;
      
   if);
#)

-- GUIENVscrollerOpen: descriptor --

(#
do (1000,1000) -> contents.size;
   (XmNworkWindow,contents.widgetID) -> setIntegerResource;
   inner open;
#)

-- GUIENVscrollerClose: descriptor --
(#
do inner close;
#)

-- GUIENVscrollerOnFrameChanged: descriptor --
(#
do inner onFrameChanged;
#)

-- GUIENVscrollerPrivate: descriptor --
(# 
#)

-- GUIENVputmovieFieldLayout: doPart --
do

-- GUIENVgetmovieFieldLayout: doPart --
do

-- GUIENVtextFieldputLayout: doPart --
do

-- GUIENVtextFieldgetLayout: doPart --
do

-- GUIENVabstractScrollerputLayout: doPart --
do

-- GUIENVabstractScrollergetLayout: doPart --
do

-- GUIENVtextEditorputLayout: doPart --
do

-- GUIENVtextEditorgetLayout: doPart --
do

-- GUIENVscrollerputLayout: doPart --
do

-- GUIENVscrollergetLayout: doPart --
do


--]]
