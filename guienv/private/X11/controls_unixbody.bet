ORIGIN '../controlsbody';

INCLUDE 'motifstuff';
INCLUDE 'widget';
INCLUDE 'guienvattributes';
INCLUDE 'guienv_unixprivate';
INCLUDE '~beta/sysutils/v1.4/objinterface';
INCLUDE '../../graphics';
INCLUDE 'graphics_unixbody';
INCLUDE 'callbacks';

[[
-- GUIENVcontrolCreate: descriptor --
(#
do inner create;
#)

-- GUIENVcontrolOpen: descriptor --
(#
do inner open;
#)

-- GUIENVcontrolClose: descriptor --
(# 
do inner close;
#)

-- GUIENVcontrolPrivate: descriptor --
(#
#)

-- scrollbarLib: attributes --

handlePageIncrement: motifCallbackSelector
  (#
  do theEventHandler.onPageDown;
  #);
pageIncrementProcessor: callbackProcessor
  (# 
  do &handlePageIncrement[] -> cb[];
  #);

handlePageDecrement: motifCallbackSelector
  (#
  do theEventHandler.onPageUp;
  #);
pageDecrementProcessor: callbackProcessor
  (# 
  do &handlePageDecrement[] -> cb[];
  #);

handleIncrement: motifCallbackSelector
  (#
  do theEventHandler.onButtonDown;
  #);
incrementProcessor: callbackProcessor
  (# 
  do &handleIncrement[] -> cb[];
  #);

handleDecrement: motifCallbackSelector
  (#
  do theEventHandler.onButtonUp;
  #);
decrementProcessor: callbackProcessor
  (# 
  do &handleDecrement[] -> cb[];
  #);

handleValueChanged: motifCallbackSelector
  (# 
  do theEventHandler.onThumbMoved;
  #);
valueChangedProcessor: callbackProcessor
  (#
  do &handleValueChanged[] -> cb[];
  #);

-- GUIENVscrollbarSetPageScrollAmount: descriptor --
assertOpen
(# 
do (XmNpageIncrement,value) -> setIntegerResource;
   theEventHandler.onPageScrollAmountChanged;
#)

-- GUIENVscrollbarGetPageScrollAmount: descriptor --
assertOpen
(# 
do XmNpageIncrement -> getIntegerResource -> value;
#)

-- GUIENVscrollbarSetScrollAmount: descriptor --
assertOpen
(#
do (XmNincrement,value) -> setIntegerResource;
   theEventHandler.onScrollAmountChanged;
#)

-- GUIENVscrollbarGetScrollAmount: descriptor --
assertOpen
(#
do XmNincrement -> getIntegerResource -> value;
#)

-- GUIENVscrollbarSetMaxValue: descriptor --
assertOpen
(#
do (XmNmaximum,value) -> setIntegerResource;
   theEventHandler.onMaxValueChanged;
#)

-- GUIENVscrollbarGetMaxValue: descriptor --
assertOpen
(#
do XmNmaximum -> getIntegerResource -> value;
#)

-- GUIENVscrollbarSetValue: descriptor --
assertOpen
(#
do (XmNvalue,pos) -> setIntegerResource;
   theEventHandler.onValueChanged;
#)

-- GUIENVscrollbarGetValue: descriptor --
assertOpen
(#
do XmNvalue -> getIntegerResource -> value;
#)

-- GUIENVscrollbarSetLength: descriptor --
assertOpen
(# width,height: @integer;
do size -> (width,height);
   (if vertical
       then
       (width,theLength) -> size;
    else
       (theLength,height) -> size;
   if);
#)

-- GUIENVscrollbarGetLength: descriptor --
assertOpen
(# width,height: @integer;
do size -> (width,height);
   (if vertical then
       height -> theLength;
    else
       width -> theLength;
   if);
#)

-- GUIENVscrollbarCreate: descriptor --

(# orientation: @integer;
do inner create;
   (if widgetID//0 then
       (xmScrollbarWidgetClass,father.widgetID) -> createSimple;
       (if vertical then
           XmVertical -> orientation;
        else
           XmHorizontal -> orientation;
       if);
       (XmNorientation,orientation) -> setIntegerResource;
       (pageIncrementProcessor##, XmNpageIncrementCallBack) -> addCallbackProcessor;
       (pageDecrementProcessor##, XmNpageDecrementCallBack) -> addCallbackProcessor;
       (incrementProcessor##, XmNincrementCallBack) -> addCallbackProcessor;
       (decrementProcessor##, XmNDecrementCallBack) -> addCallbackProcessor;
       (valueChangedProcessor##, XmNvalueChangedCallback) -> addCallbackProcessor;
       (XmNhighLightThickness,0) -> setIntegerResource;
   if);
#)

-- GUIENVscrollbarOpen: descriptor --
(#
do inner open;
#)

-- GUIENVscrollbarClose: descriptor --
(#
do inner close;
#)

-- GUIENVscrollbarpagedown:  descriptor --
(#
do inner pageDown;
#)

-- GUIENVscrollbarPageUp: descriptor --
(# 
do inner pageUp;
#)

-- GUIENVscrollbarButtonUp: descriptor --
(# 
do inner buttonUp;
#)

-- GUIENVthumbMoved: descriptor --
(#
do inner thumbMoved; 
#)

-- GUIENVscrollbarondeactivate: descriptor --
(#
do inner onDeactivate; 
#)

-- GUIENVscrollbaronframechanged: descriptor --
(#
do inner onFrameChanged; 
#)

-- GUIENVscrollbaronrefresh: descriptor --
(#
do inner onRefresh; 
#)

-- GUIENVscrollbaronmousedown: descriptor --
(#
do inner onMouseDown; 
#)

-- GUIENVscrollbaronactivate: descriptor --
(#
do inner onActivate; 
#)

-- GUIENVscrollbarbuttondown: descriptor --
(#
do inner buttonDown; 
#)


-- GUIENVscrollbarPrivate: descriptor --
(#
   
#)

-- GUIENVbuttonSetLabel: descriptor --
assertOpen
(#
do (XmNlabelString,theLabel[]) -> setMotifStringResource;
   theEventHandler.onLabelChanged;
#)

-- GUIENVbuttonGetLabel: descriptor --
assertOpen
(#
do XmNlabelString -> getMotifStringResource -> theLabel[];
#)

-- GUIENVbuttonSetStyle: descriptor --
assertOpen
(#
do (XmNfontList,theStyle.createFontList) -> setIntegerResource;   
   theEventHandler.onStyleChanged;
#)

-- GUIENVbuttonGetStyle: descriptor --
assertOpen
(# 
do &textStyle[] -> theStyle[];
   XmNfontList -> getIntegerResource -> theStyle.initWithFontList;
   (* getTextStyleResource -> theStyle[]; *)
#)

-- GUIENVbuttonCreate: descriptor --
(#
do inner create;
   (if widgetID//0 then
       (xbButtonWidgetClass,father.widgetID) -> createSimple;
   if);
#)

-- GUIENVbuttonOpen: descriptor --
(#
do this(button)[] -> getPatternName -> label;
   inner open;
#)

-- GUIENVbuttonClose: descriptor --
(# 
do inner close;
#)

-- GUIENVbuttonOnFrameChanged: descriptor --
(# 
do inner onFrameChanged;
#)

-- GUIENVbuttonOnRefresh: descriptor --
(# 
do inner onRefresh;
#)

-- GUIENVButtonOnMouseDown: descriptor --
(# 
do inner onMouseDown;
#)

-- GUIENVbuttonPrivate: descriptor --
(#

#)

-- pushButtonLib: attributes --

handlePushButtonActivate: motifCallbackSelector
  (#
  do theEventHandler.onMouseUp;
  #);
pushbuttonActivateProcessor: callbackProcessor
  (# 
  do &handlePushButtonActivate[] -> cb[];
  #);


-- GUIENVpushButtonCreate: descriptor --

(# 
do inner create;
   (if widgetID//0 then
       (xmPushButtonWidgetClass,father.widgetID) -> createSimple;
       (XmNrecomputeSize,false) -> setIntegerResource;
       (XmNtraversalOn,false) -> setIntegerResource;
       (XmNhighLightThickness,0) -> setIntegerResource;
   if);
#)

-- GUIENVpushButtonOpen: descriptor --
(# XtRemoveEventHandler: external
     (# w: @integer;
        eventMask: @integer;
        nonmaskable: @integer;
        callBackAddress: @integer;     
        data: @integer
     enter (w,eventMask,nonmaskable,callBackAddress,data)
     do callC
     #);
   ID: @integer;
   thisWindowItem: ^windowItem;
   
do this(pushButton)[] -> thisWindowItem[];
   widgetID -> ID;
   (ID,
   XButtonReleaseMask, false,
   thisWindowItem.private.mouseUpProcessorAddress, 0) -> XtRemoveEventHandler;
   (pushbuttonActivateProcessor##, XmNactivateCallBack) -> addCallbackProcessor;
    inner open;
#)

-- GUIENVpushButtonClose: descriptor --
(#
do inner close;
#)

-- GUIENVpushButtonPrivate: descriptor --
(#
#)

-- GUIENVstaticTextCreate: descriptor --

(#
do inner create;
   (if widgetID//0 then
       (xmLabelWidgetClass,father.widgetID) -> createSimple;
       (XmNhighLightThickness,0) -> setIntegerResource;
       (XmNalignment, XmALIGNMENT_BEGINNING) -> setIntegerResource;
   if);
#)

-- GUIENVstaticTextOpen: descriptor --
(#
do inner open;
#)

-- GUIENVstaticTextClose: descriptor --
(# 
do inner close;
#)

-- GUIENVstaticTextOnRefresh: descriptor --
(# 
do inner onRefresh;
#)

-- GUIENVstaticTextPrivate: descriptor --
(#

#)

-- iconButtonLib: attributes --
XbNshowLabel: integerValue (# do 'showLabel' ->charReptoCString -> value #);
-- GUIENViconButtonSetShowLabel: descriptor --
assertOpen
(#
do (XbNshowLabel,doShow) -> setIntegerResource;
   theEventHandler.onShowLabelChanged;
#)

-- GUIENViconButtonGetShowLabel: descriptor --
assertOpen
(#
do XbNshowLabel -> getIntegerResource -> doShow;
#)

-- GUIENViconButtonSetIcon: descriptor --
assertOpen
(#
do theIcon[] -> private.theIcon[];
   theEventHandler.onIconChanged;
   update;
#)

-- GUIENViconButtonGetIcon: descriptor --
assertOpen
(#
do private.theIcon[] -> theIcon[];
#)


-- GUIENViconButtonCreate: descriptor --

(#
do inner create;
   (if widgetID//0 then
       (xbIconButtonWidgetClass,father.widgetID) -> createSimple;
   if);
#)

-- GUIENViconButtonOpen: descriptor --
(#
do inner open;
#)

-- GUIENViconButtonClose: descriptor --
(# 
do inner close;
#)

-- GUIENViconButtonOnRefresh: descriptor --
(# calcImageBounds:
     (# 
     do (if showLabel//true then
            theLabel[] -> theStyle.widthOfText -> textWidth;
            theStyle.lineHeight -> textHeight;
         else
            0 -> textWidth;
            0 -> textHeight;
        if);
        (if private.theIcon[]<>none//true then
            private.theIcon.width -> iconWidth;
            private.theIcon.height -> iconHeight;
         else
            0 -> iconWidth;
            0 -> iconHeight;
        if);
        (textHeight+iconHeight) -> imageHeight;
        (textWidth,iconWidth) -> max -> imageWidth;
     #);
   calcImageAnchors:
     (# width,height: @integer;
     do size -> (width,height);
        (width - iconWidth) div 2 -> iconAnchor.h;
        (height - imageHeight) div 2 -> iconAnchor.v;
        (width - textWidth) div 2 -> textAnchor.h;
        iconAnchor.v + iconHeight + theStyle.ascent -> textAnchor.v;
     #);
   theStyle: ^textStyle;
   theLabel: ^text;
   imageWidth,imageHeight,textWidth,textHeight,iconWidth,iconHeight: @integer;
   iconAnchor,textAnchor: @point;
do style -> theStyle[];
   label -> theLabel[];
   calcImageBounds;
   calcImageAnchors;
   graphics
   (# f: @rectangle;
   do (if this(iconButton).private.theIcon[]<>none//true then
          (this(iconButton).private.theIcon[],(0,0),iconAnchor,iconWidth,iconHeight) -> drawRaster;
          (if hilite//true then
              ((0,0),size) -> f;
              f.bottom - 1 -> f.bottom;
              f.right - 1 -> f.right;
              f -> drawRect;
              (1,1) -> f.inset;
              f -> drawRect;
          if);
      if);
      (if showLabel//true then
          textAnchor -> moveTo;
          theStyle[] -> style;
          theLabel[] -> drawText;
      if);
   #);
   inner onRefresh;
#)

-- GUIENViconbuttonOnHiliteChanged: descriptor --

(# 
do graphics
   (# f: @rectangle;
      backgroundColor: @integer;
   do (if hilite//true then
       else
          XtNbackGround -> getIntegerResource -> backgroundColor;
          (private.display,private.gc,backgroundColor) -> XSetForeGround;
      if);
      ((0,0),size) -> f;
      f.bottom - 1 -> f.bottom;
      f.right - 1 -> f.right;
      f -> drawRect;
      (1,1) -> f.inset;
      f -> drawRect;
   #);
   inner onHiliteChanged;
#)

-- GUIENViconButtonPrivate: descriptor --
(#
   theIcon: ^raster;
#)

-- GUIENVoptionButtonSetCurItem: descriptor --
assertOpen
(# theItem: ^interfaceObject;
do (if private.motifPopupmenu[]<>none then
       itemNo -> private.motifPopupmenu.getItemByNumber -> theItem[];
       (if theItem[]<>None then
           (XmNmenuHistory,theItem.widgetID) -> setIntegerResource;
       if);
   if);
#)

-- GUIENVoptionButtonGetCurItem: descriptor --
assertOpen
(# 
do (if private.motifPopupmenu[]<>none then
       XmNmenuHistory -> getIntegerResource  
         -> private.motifPopupmenu.getNumberOfWidget -> itemNo;
   if);
#)

-- GUIENVoptionButtonSetPopupMenu: descriptor --
assertOpen
(# theMotifmenu: ^motifMenu;
do (if popupMenu[]<>private.popupMenu[]//true then
       (if private.popupMenu[]<>none//true then
           private.motifPopupmenu.close;
           none -> private.motifPopupmenu[];
           none -> private.popupMenu[];
       if);
       (if popupMenu[]<>none//true then
           popupMenu[] -> private.popupMenu[];
           &motifMenu[] -> theMotifmenu[] -> private.motifPopupmenu[];
           this(optionButton)[] -> theMotifmenu.owner[];
           popupMenu[] -> theMotifmenu.theMenu[];
           theMotifMenu.open;
           (XmNsubmenuId,theMotifMenu.widgetID) -> setIntegerResource;
       if);
   if);
   (*  (if popupMenu[]<>private.popupMenu[]//true then
    *        (if private.popupMenu[]<>none//true then
    *            private.popupMenu.destroyMenu;
    *            none -> private.popupMenu[];
    *        if);
    *        popupMenu[] -> private.popupMenu[];
    *        (if popupMenu[]<>none//true then
    *            widgetID -> popupMenu.buildMenu;
    *            (XmNsubmenuId,popupMenu.widgetID) -> setIntegerResource;
    *        if);
    *    if);
    *)
#)

-- GUIENVoptionButtonGetPopupMenu: descriptor --
assertOpen
(#
do private.popupMenu[] -> popupMenu[];
#)

-- GUIENVoptionButtonCreate: descriptor --

(# defaultMenu: ^menu;
   defaultMenuType: menu
     (# 
        defaultItem: @menuItem
          (# 
          #);
        open::<
          (# 
          do 
             defaultItem.open;
             defaultItem[] -> append;
          #);
     #);
   args: @argList;
   mstr: @motifString;
do inner create;
   (if widgetID//0 then
       (* &defaultMenuType[] -> defaultMenu[];
        *        defaultMenu.open;
        *        'Options' -> defaultMenu.name;
        *        father.widgetID -> defaultMenu.buildMenu;
        *        (1,XmNsubMenuId,defaultMenu.widgetID) -> args.set;
        *        'Options:' -> mstr.setText;
        *        (2,XmNlabelString,mstr) -> args.set;
        *        (father.widgetID,'optionButton',args[],2) -> XmCreateOptionMenu -> widgetID;
        *        widgetID -> XtManageChild;
        *        '...done' -> putLine;
        *)
       (# 
          optionsSubMenuId,optionId: @integer;
          
       do (father.widgetID,'OptionsSubMenu',args[],0) -> XmCreatePulldownMenu -> optionsSubMenuId;
          (optionsSubMenuId,'Option',args[],0) -> XmCreatePushbutton -> optionId;
          optionId -> XtManageChild;
          'Options:' -> mstr.setText;
          (1,XmNLabelString,mstr) -> args.set;
          (2,XmNsubMenuId,optionsSubMenuId) -> args.set;
          (father.widgetID,'optionButton',args[],2) -> XmCreateOptionMenu -> widgetID;
          widgetID -> XtManageChild;
       #);
   if);
#)

-- GUIENVoptionButtonOpen: descriptor --
(#
do inner open;
#)

-- GUIENVoptionButtonClose: descriptor --
(#
do inner close;
   none -> popupMenu;
#)

-- GUIENVoptionButtononstylechanged: descriptor --
(#
do inner onStyleChanged;
#)

-- GUIENVoptionButtononlabelchanged: descriptor --
(#
do inner onLabelChanged;
#)

-- GUIENVoptionButtonprivate: descriptor --
(# popupMenu: ^menu;
   motifPopupmenu: ^motifMenu;
#)

-- GUIENVtoggleButtonSetState: descriptor --
assertOpen
(#
do (XmNset,theState) -> setIntegerResource;
   theEventHandler.onStateChanged;
#)

-- GUIENVtoggleButtonGetState: descriptor --
assertOpen
(#
do XmNset -> getIntegerResource -> theState;
#)

-- GUIENVtoggleButtonCreate: descriptor --

(#
do inner create;
   (if widgetID//0 then
       (xbToggleButtonWidgetClass,father.widgetID) -> createSimple;
   if);
#)

-- GUIENVtoggleButtonOpen: descriptor --
(#
do inner open;
#)

-- GUIENVtoggleButtonClose: descriptor --
(#
do inner close;
#)

-- GUIENVtoggleButtonPrivate: descriptor --
(#
#)

-- GUIENVradioButtonCreate: descriptor --
(#
do inner create;
   (if widgetID//0 then
       (xmToggleButtonWidgetClass,father.widgetID) -> createSimple;
       (XmNindicatorType,XmONE_OF_MANY) -> setIntegerResource;
       (XmNhighLightThickness,0) -> setIntegerResource;
   if);
#)

-- GUIENVRadioButtonOpen: descriptor --
(#
do inner open
#)

-- GUIENVRadioButtonClose: descriptor --
(#
do inner close;
#)

-- GUIENVradioButtonPrivate: descriptor --
(#
   
#)

-- GUIENVcheckBoxCreate: descriptor --
(#
do inner create;
   (if widgetID//0 then
       (xmToggleButtonWidgetClass,father.widgetID) -> createSimple;
       (XmNhighLightThickness,0) -> setIntegerResource;
       (XmNalignment, XmALIGNMENT_BEGINNING) -> setIntegerResource;
   if);
#)

-- GUIENVcheckBoxOpen: descriptor --
(#
do inner open;
#)

-- GUIENVcheckBoxClose: descriptor --
(#
do inner close;
#)

-- GUIENVcheckBoxPrivate: descriptor --
(#

#)

-- GUIENVeditTextOnRefresh: descriptor --
(#
do inner onRefresh;
#)

-- GUIENVEditTextOnEnableTarget: descriptor --
(#
do inner onEnableTarget;
#)

-- GUIENVeditTextOnMouseDown: descriptor --
(#
do inner onMouseDown;
#)

-- GUIENVeditTextOnFrameChanged: descriptor --
(#
do inner onFrameChanged;
#)

-- GUIENVedittextonkeydown: descriptor --
(#
do inner onKeyDown;
#)


-- GUIENVedittextondisabletarget: descriptor --
(#
do inner onDisableTarget;
#)


-- GUIENVeditTextSetStyle: descriptor --
assertOpen
(# 
do (XmNfontList,txStyle.createFontList) -> setIntegerResource;
#)

-- GUIENVeditTextGetStyle: descriptor --
assertOpen
(# 
do &textStyle[] -> txStyle[];
   XmNfontList -> getIntegerResource -> txStyle.initWithFontList;
#)

-- GUIENVeditTextSetContents: descriptor --
assertOpen
(#
do (XmNvalue,str[]) -> setStringResource;
#)

-- GUIENVeditTextGetContents: descriptor --
assertOpen
(#
do XmNvalue -> getStringResource -> str[];
#)

-- GUIENVeditTextCreate: descriptor --

(#
do inner create;
   (if widgetID//0 then
       (xmTextWidgetClass,father.widgetID) -> createSimple;
       (XmNhighlightThickness,0) -> setIntegerResource;
       (* (XmNresizeHeight,false) -> setIntegerResource;
       (XmNresizeWidth,false) -> setIntegerResource; *)
       (* (XmNtraversalOn,false) -> setIntegerResource; *)
   if);
#)

-- GUIENVeditTextOpen: descriptor --
(#
do inner open;
#)

-- GUIENVeditTextClose: descriptor --
(#
do inner close;
#)

-- GUIENVeditTextPrivate: descriptor --
(#
#)

-- GUIENVsetDefaultButton: descriptor --
(#
do 
#)

-- GUIENVgetDefaultButton: descriptor --
(#
do
#)
-- GUIENVcontrolputLayout: doPart --
do

-- GUIENVcontrolgetLayout: doPart --
do

-- GUIENVscrollbarputLayout: doPart --
do

-- GUIENVscrollbargetLayout: doPart --
do

-- GUIENVbuttonputLayout: doPart --
do

-- GUIENVbuttongetLayout: doPart --
do

-- GUIENVpushButtonputLayout: doPart --
do

-- GUIENVpushButtongetLayout: doPart --
do

-- GUIENVstaticTextputLayout: doPart --
do

-- GUIENVstaticTextgetLayout: doPart --
do

-- GUIENViconButtonputLayout: doPart --
do

-- GUIENViconButtongetLayout: doPart --
do

-- GUIENVoptionButtonputLayout: doPart --
do
   
-- GUIENVoptionButtongetLayout: doPart --
do

-- GUIENVtoggleButtonputLayout: doPart --
do

-- GUIENVtoggleButtongetLayout: doPart --
do

-- GUIENVradioButtonputLayout: doPart --
do

-- GUIENVradioButtongetLayout: doPart --
do

-- GUIENVcheckBoxputLayout: doPart --
do

-- GUIENVcheckBoxgetLayout: doPart --
do

-- GUIENVeditTextputLayout: doPart --
do

-- GUIENVeditTextgetLayout: doPart --
do


--]]
