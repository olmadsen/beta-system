ORIGIN '../cdplayerbody';

-- cdPlayerLib: attributes --

CsParam: data
      (# addrFormat: @ shortInt;
         a1,address: @shortInt;
	     stopAddress: @shortInt;
	     playMode: @shortInt
	   #);
		
CSPauseParam: data
      (# pause: @integer;
	     filler: @integer;
	   #);
		
   TRACKADDR: (#exit 2 #);
   STEREO: (#exit 9 #);
   INPROGRESs: (#exit 0 #);
   AEJECT: (#exit 7 #);
   APLAY: (#exit 104#);
   APAUSE: (#exit 105 #);
   ASTOP: (#exit 106 #);

OpenDriver: external
     (# device: [1]@char; adr,osErr: @integer
	 enter(device,adr)
	 do callPAscal
	 exit osErr
	 #);
   Control: external
      (* extern pascal OSErr Control
       *  (short refNum, short csCode, const void *csParamPtr);
       *)
     (# refNum,csCode: @shortInt; csParamPtr,osErr: @integer
     enter(refNum,csCode,csParamPtr)
     do CallPascal
    exit osErr
     #);
	 
initialize:
	(# osErr: @integer
	do (if not private.initialized then
			('.AppleCD',@@private.ioDRefNum) -> OpenDriver -> osErr;
			true -> private.initialized;
		if);
	#);
	
-- cdPlayerIsCDPresent: doPart --
do initialize;
	

-- cdPlayerStart: doPart --
do initialize;
	(# csP: @CsParam;
   do  TRACKADDR -> csP.addrFormat;
	    track -> csP.address;
	    0 -> csP.stopAddress;
	    STEREO -> csP.playMode;
	    (private.ioDRefNum,APLAY,@@csP) -> Control;
   #);
	  
-- cdStop: doPart --
do initialize;
   (# csP: @CsParam;
	do (private.ioDRefNum,ASTOP,@@csP) -> Control;
	#);

-- cdPause: doPart --
do initialize;
	(#  csP: @CSPauseParam;
	do 1 -> csP.pause;
		(private.ioDRefNum,APAUSE,@@csP) -> Control;
	#);
-- cdPlayerResume: doPart --
do initialize;
	(#  csP: @CSPauseParam;
	do 0 -> csP.pause;
		(private.ioDRefNum,APAUSE,@@csP) -> Control;
	#);
	
-- cdPlayerSetPosition: doPart --
do initialize;

-- cdPlayerGetPosition: doPart --
do initialize;

-- cdPlayerNumberOfTracks: doPart --
do initialize;

-- cdPlayerPrivate: descriptor --
(# ioDRefNum: @shortInt;
	initialized: @boolean;
#)

