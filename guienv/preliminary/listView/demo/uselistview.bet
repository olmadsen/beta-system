ORIGIN  '~beta/guienv/guienv';
INCLUDE 
'~beta/guienv/private/winnt/guienv_ntiprivate'
'~beta/guienv/controls'
'~beta/bifrost/ColorNames'
'~beta/guienv/preliminary/listView/listView'
'~beta/guienv/preliminary/resources/pixmaps';

RESOURCE nti 'listview.rc'; 

(* LINKOPT nti 'comctl32.lib'; *)

-- program: descriptor --
guienv
(# theWindow: @window
     (# menubarType::<
          (# fileMenu: @menu
               (# smallIconItem: @menuitem
                    (# eventHandler:: 
                         (# onSelect::
                              (# 
                              do theCanvas.theListView.viewStyles.smallIcon 
                                   -> theCanvas.theListView.layOutStyle;
                              #) 
                         #);
                       open::< (# do 'Small Icons' -> name #);
                    #);
                  largeIconItem: @menuitem
                    (# eventHandler:: 
                         (# onSelect::
                              (# 
                              do theCanvas.theListView.viewStyles.largeIcon 
                                   -> theCanvas.theListView.layOutStyle;
                              #) 
                         #);
                       open::< (# do 'Large Icons' -> name #);
                    #);
                  reportItem: @menuitem
                    (# eventHandler:: 
                         (# onSelect::
                              (# 
                              do theCanvas.theListView.viewStyles.report 
                                   -> theCanvas.theListView.layOutStyle;
                              #) 
                         #);
                       open::< (# do 'Report' -> name #);
                    #);
                  listItem: @menuitem
                    (# eventHandler:: 
                         (# onSelect::
                              (# 
                              do theCanvas.theListView.viewStyles.list 
                                   -> theCanvas.theListView.layOutStyle;
                              #) 
                         #);
                       open::< (# do 'List' -> name #);
                    #);
                  
                  selectionItem: @menuitem
                    (# eventHandler::
                         (# onSelect::
                              (# 
                              do theCanvas.scanSelection;
                              #);
                         #);
                       open::
                         (# do 'Scan Selection' -> name #);
                    #);
                  
                  deselectItem: @menuitem
                    (# eventHandler::
                         (# onSelect::
                              (# 
                              do theCanvas.clearSelection;
                              #);
                         #);
                       open::
                         (# do 'Clear Selection' -> name #);
                    #);
                  
                  deleteItem: @menuitem
                    (# eventHandler::
                         (# onSelect::
                              (# 
                              do theCanvas.deleteCurItem;
                              #);
                         #);
                       open::
                         (# do 'Delete cur sel.' -> name #);
                    #);
                  
                  clearListItem: @menuitem
                    (# eventHandler::
                         (# onSelect::
                              (# 
                              do theCanvas.clearList;
                              #);
                         #);
                       open::
                         (# do 'Clear List' -> name #);
                    #);
                  
                  scanListItem: @menuitem
                    (# eventHandler::
                         (# onSelect::
                              (# 
                              do theCanvas.scanList;
                              #);
                         #);
                       open::
                         (# do 'Scan List' -> name #);
                    #);
                  
                  reopenItem: @menuitem
                    (# eventHandler::
                         (# onSelect:: (# do theCanvas.reopenListview; #) #);
                       open::< (# do 'Reopen ListView' -> name #);
                    #);
                  
                  changeNameItem: @menuitem
                    (# eventHandler::
                         (# onSelect:: (# do theCanvas.changeName; #) #);
                       open::< (# do 'Change Name' -> name #);
                    #);
                  
                  sortItem: @menuitem
                    (# eventHandler::
                         (# onSelect:: (# do theCanvas.sort; #) #);
                       open::< (# do 'Sort' -> name #);
                    #);

                  quitItem: @menuitem
                    (# eventHandler::
                         (# onSelect:: (# do Terminate #) #);
                       open::< (# do 'Quit' -> name #);
                    #);
                  open::<
                    (#
                    do 'File' -> name;
                       smallIconItem.open; smallIconItem[] ->append;
                       largeIconItem.open; largeIconItem[] ->append;
                       reportItem.open; reportItem[] ->append;
                       listItem.open; listItem[] ->append;
                       selectionItem.open; selectionItem[] -> append;
                       deselectItem.open; deselectItem[] -> append;
                       deleteItem.open; deleteItem[] -> append;
                       clearListItem.open; clearListItem[] -> append;
                       scanListItem.open; scanListItem[] -> append;
                       reopenItem.open; reopenItem[] -> append;
                       changeNameItem.open; changeNameItem[] -> append;
                       sortItem.open; sortItem[] -> append;
                       quitItem.open; quitItem[] -> append;
                    #);
               #);
             open::< (# do fileMenu.open; fileMenu[] -> append #);
          #);
        theCanvas: @canvas
          (# scanSelection:
               (# 
               do theListView.selection.scan
                  (# 
                  do 'current.name = ' -> screen.putText;
                     current.name -> screen.putLine;
                  #);
               #);
             
             clearSelection:
               (# 
               do theListView.selection.clear;
               #);
             
             deleteCurItem:
               (# 
               do (theListView.selection.first).delete;
               #);
             
             clearList:
               (# 
               do theListView.clear;
               #);
             
             scanList:
               (# 
               do theListView.scan
                  (# 
                  do current.name -> screen.putline;
                  #);
               #);
             
             reopenListview:
               (# w,h: @integer;
               do theListView.close;
                  theListView.open;
                  
               #);
             
             changeName:
               (# 
               do 'Hello' -> theListView.item1.name;
                  'I item1 sub2222222222222' -> theListView.item1.addSubText;
                  theListView.update;
               #);
             
             sort:
               (# 
               do (* 1 -> theListView.sort *)
               #);
             
              theListView: @listView
               (# 
                   multipleSelection::
                     (# do true -> value; #);
                   
                   onCustumDraw::
                     (# 
                     do (* (if subItem=0 then
                         *                             &textStyle[] -> itemTextStyle[];
                         *                             'Arial' -> itemTextStyle.name;
                         *                             10 -> itemTextStyle.size;
                         *                             textFaces.italic -> itemTextStyle.face;
                         *                             
                         *                             (CDRF_CHANGEDEFAULT,itemTextStyle[],colorRed[],colorWhite[])
                         *                               -> 
                         *                             (action, theTextStyle[],textColor[],textBgColor[]);
                         *                         if);
                         *)
                     #);
                   
                   cInfo1,cInfo2,cInfo3: @columnInfo;
                   iconHandles: [4]@integer;
                   smallIcon_view:: trueObject; 
                   icon_view:: trueObject; 
                   report_view:: trueObject; 
                   
                   icon1,icon2: @pixmap;
                   
                   myListItem: listItem
                     (# onSelect::
                          (# 
                          do 'onSelect. name = ' -> screen.putText;
                             name -> putline;
                          #);
                        
                        onDoubleClick::
                          (# 
                          do 'onDoubleClick. name = ' -> screen.putText;
                             name -> putline;
                          #);
                        
                        onRMouseUp::
                          (# 
                          do 'onRMouseUp. name = ' -> screen.putText;
                             name -> putline;
                          #);
                        
                        eventHandler::
                          (# onMouseDown::
                               (# do 'listItem.onMousedown' -> putline; #);
                             onMouseUp::
                               (# do 'listItem.onMouseUp' -> putline; #);
                          #);
                     #);
                   
                   item1: @myListItem
                     (# 
                        open::
                          (# 
                          do 'One' -> name;
                             1 -> type;
                             'H item1 sub1' -> addSubText;
                             (* 'I item1 sub2' -> addSubText; *)
                             icon1[] -> icon;
                          #);
                        
                     #);
                   item2: @myListItem
                     (# 
                        open::
                          (# 
                          do 'Two' -> name;
                             1 -> type;
                             'F item2 sub1' -> addSubText;
                             'J item2 sub24444444' -> addSubText;
                             icon1[] -> icon;
                          #);
                        
                     #);
                   item3: @myListItem
                     (# 
                        open::
                          (# 
                          do 'Three' -> name;
                             2 -> type;
                             'D item3 sub1' -> addSubText;
                             'K item3 sub2666666666666666' -> addSubText;
                             icon2[] -> icon;
                          #);
                        
                     #);
                   item4: @myListItem
                     (# 
                        open::
                          (# 
                          do 'Four' -> name;
                             2 -> type;
                             'A item4 sub1' -> addSubText;
                             'L item4 sub2' -> addSubText;
                             icon2[] -> icon;
                          #);
                     #);
                   open::
                     (# 
                     do 
                        ('APP_ICON',0) -> icon1.loadIconResource;
                        ('BELLEVUE',0) -> icon2.loadIconResource;
                        
                        (0,0) -> position;
                        (200,200) -> size; 
                        theCanvas.size -> size;
                        true -> bindRight; 
                        true -> bindBottom;
                        
                        'Header1' -> cInfo1.title[];
                        75 -> cInfo1.width;
                        
                        'Header2' -> cInfo2.title[];
                        55 -> cInfo2.width;

                        'Header3' -> cInfo3.title[];
                        55 -> cInfo3.width;
                        cInfo1[] -> addColumn;
                        cInfo2[] -> addColumn;
                        cInfo3[] -> addColumn;
                        
                        
                        item1[] -> addListItem;
                        item2[] -> addListItem;
                        item3[] -> addListItem;
                        item4[] -> addListItem;
                        
                        item1.select;
                        item2.select;
                     #);
                   
                   close::
                     (# 
                     do item1.close; item2.close; item3.close; item4.close;
                     #);
                   
                   eventHandler::
                     (# 
                        onMouseDown::
                          (# 
                          do 'listView.onMouseDown: buttonState = ' -> screen.putText;
                             buttonState -> putint; newline;
                          #);
                        onMouseUp::
                          (# 
                          do 'listView.onMouseUP: buttonState = ' -> screen.putText;
                             buttonState -> putint; newline;
                             
                             (if selection.first<>NONE then
                                 'selection.first.name = ' -> screen.puttext;
                                 (selection.first).name -> putline; 
                             if);
                             
                             selection.scan
                             (# 
                             do 'current.name = ' -> screen.putText;
                                current.name -> screen.putLine;
                             #);
                          #);
                     #);
                #);
              
             
             itemTextStyle: ^textStyle;
             colorRed,colorWhite: @color;
              open::<
                (# w,h: @integer;
                do 
                   &textStyle[] -> itemTextStyle[];
                   'Arial' -> itemTextStyle.name;
                   10 -> itemTextStyle.size;
                   textFaces.bold -> itemTextStyle.face;
                   
                   red -> colorRed; green -> colorWhite;
                   
                   (0,0) -> position;
                   theWindow.size -> size;
                   theCanvas[] -> theListView.open; 
                   theListView[] -> target;
                   true -> bindRight;
                   true -> bindBottom;
                   
                   'theListView.size: ' -> puttext;
                  theListView.size -> (w,h);
                  w -> putint; ', ' -> puttext; h -> putint; newline;
                #);
           #);
        open:: 
          (# do (150,400) -> size; theCanvas.open; #);
        eventHandler::
          (# 
             onAboutToClose::
               (# 
               do terminate;
               #);
             
             onActivate::
               (# 
               do theCanvas.theListView[] -> target;
               #);
          #);
     #)
do theWindow.open;
#)
