ORIGIN '~beta/basiclib/basicsystemenv';
INCLUDE '~beta/process/protocols/smtpstream';
----systemLib:attributes---
sendMail:
  (# smtp: @smtpStream;

     send:
       (# server,to,subject,msg,m: ^text
       enter(server[],to[],subject[],msg[]) 
       do server[] -> smtp.server;
          '-----HELLO result:'->screen.putline;
          'daimi.au.dk.dk'->smtp.hello->screen.putline;

         (* '-----VRFY result:'->screen.putline;
          'olm' -> smtp.verify -> screen.putline;
          '-----HELP result:'->screen.putline;
          smtp.help->screen.puttext;
          
          '-----HELP VRFY result:'->screen.putline;
          'VRFY'->smtp.help->screen.putline;*)
          
          '-----NOOP:'->screen.putline;
          smtp.noop;
          
          'Send: ' -> putline;
          subject[] -> putline;
          '<olm@alexandra.dk>'->smtp.mail;
          to[]-> smtp.recipient;
          'Subject: ' -> m[];
          subject[] -> m.putline;
          'To: ' -> m.puttext;
          to[] -> m.putline;
          'CC: ' -> m.append;
          'olm@daimi.au.dk' -> m.putline;
          m.newline;
          msg[] -> m.append;
          m.newline;
          m[] -> screen.putline;
          m[] -> smtp.data
       #);
  #)
