origin '~beta/basiclib/betaenv';
include '~beta/containers/list'
---lib:attributes---
mailFolder:
  (# name: ^text;
     subs: @list
       (# element::
            (# M: ^mailFolder #);
          add:
            (# N: ^text; E: ^element
            enter N[]
            do L:
                 (#
                 do scan
                    (#
                    do (if current.M.name[] -> N.equal then
                           current[] -> E[];
                           leave L
                    if)#);
                    &element[] -> E[];
                    &mailFolder[] -> E.M[];
                    E.M.init;
                    N[] -> E.M.name[];
                    E[] -> append
                 #)
            exit E[]
            #)
       #);
     addSub:
       (# N: ^text;
          pos: @integer;
          E: ^subs.element;
       enter N[]
       do L:
            N.scanAll
            (# 
            do pos+1->pos;
               (if ch = dirChar then
                   leave L
               if)
            #);
          (if pos < N.length then
              (* add subfolder *)
              (1,pos-1) -> N.sub -> subs.add -> E[]; 
              (pos+1,N.length) -> N.sub -> E.M.addSub
           else
              (* add leaf *)
              (1,pos-1) -> N.sub -> subs.add -> E[]; 
          if)
       #);
     scan:
       (# current: ^text;
       do name[] -> current[];
          inner;
          subs.scan(# 
                   do &current.M.scan(#do current[] -> this(scan).current[];
                                       inner scan
                                    #)
                   #)
       #);
     doScan:
       (#
       do
       #);
     dirChar: @char;
     init:< (# do '/' -> dirChar #)
  #)
     
