ORIGIN '~beta/basiclib/systemenv';
INCLUDE 'shelllib';
INCLUDE 'exec';
INCLUDE 'parseCmd'

---program:descriptor---
SystemEnv
(# env: @Environment;
   path: ^text;
   cwd: @text;
   first: ^text;
   T,cmd,args: ^text
do '/users/olm/beta/expm' -> cwd;
   
   cwd[] -> env.init;
   
   (*env.prompt;
    env.workingDirectory.print;
    env.prompt;   
    env.workingDirectory.list;
    env.prompt;
    'compiler' -> env.changeDirectory;
    env.prompt;   
    'PSDEMO' ->  env.changeDirectory;
    env.prompt;
    env.workingDirectory.print;
    env.prompt;
    env.workingDirectory.list;
    env.prompt;
    ('/bin/ls','-l') -> execReadText -> first[];
    first[]->screen.putText;
    *)
   env.prompt;
   cmdLoop:
     (if not keyboard.eos then
         keyBoard.getLine -> T[];
         (if T.length > 0 then
             env.count + 1 -> env.count;
             T[] -> env.addToHistory;
             T[] -> parseCmd -> (cmd[],args[]);
             (if true
              // 'ls' -> cmd.equal then
                 env.workingDirectory.list
              // 'pwd' -> cmd.equal then
                 env.workingDirectory.print
              // 'cd' -> cmd.equal then
                 args[] ->  env.changeDirectory;
              // 'history' -> cmd.equal then
                 env.printHistory
              // 'exit' -> cmd.equal 
                 (*// ascii.eot -> cmd.equal*) then
                 leave cmdLoop
              else
                 cmd[] -> env.thePath.find -> cmd[];
                 (if cmd[] <> none then
                     (cmd[],args[]) -> execReadText -> first[];
                     first[]->screen.putText;
                  else
                     'No such command in path' -> puttext
                 if)
             if);
         if);
         env.prompt;
         restart cmdLoop
     if)
#)




