ORIGIN 'mactypes';
INCLUDE 'macdirectory'
-- Lib: Attributes --
(* resource IDs and item offsets of pre-7.0 dialogs *)
putDlgID: (# exit - 3999 #);
putSave: (# exit 1 #);
putCancel: (# exit 2 #);
putEject: (# exit 5 #);
putDrive: (# exit 6 #);
putName: (# exit 7 #);
getDlgID: (# exit - 4000 #);
getOpen: (# exit 1 #);
getCancel: (# exit 3 #);
getEject: (# exit 5 #);
getDrive: (# exit 6 #);
getNmList: (# exit 7 #);
getScroll: (# exit 8 #);
(* resource IDs and item offsets of 7.0 dialogs *)
sfPutDialogID: (# exit - 6043 #);
sfGetDialogID: (# exit - 6042 #);
sfItemOpenButton: (# exit 1 #);
sfItemCancelButton: (# exit 2 #);
sfItemBalloonHelp: (# exit 3 #);
sfItemVolumeUser: (# exit 4 #);
sfItemEjectButton: (# exit 5 #);
sfItemDesktopButton: (# exit 6 #);
sfItemFileListUser: (# exit 7 #);
sfItemPopUpMenuUser: (# exit 8 #);
sfItemDividerLinePict: (# exit 9 #);
sfItemFileNameTextEdit: (# exit 10 #);
sfItemPromptStaticText: (# exit 11 #);
sfItemNewFolderUser: (# exit 12 #);
(* pseudo-item hits for use in DlgHook *)
sfHookFirstCall: (# exit - 1 #);
sfHookCharOffset: (# exit 4096 #);
sfHookNullEvent: (# exit 100 #);
sfHookRebuildList: (# exit 101 #);
sfHookFolderPopUp: (# exit 102 #);
sfHookOpenFolder: (# exit 103 #);
(* the following are only in system 7.0+ *)
sfHookOpenAlias: (# exit 104 #);
sfHookGoToDesktop: (# exit 105 #);
sfHookGoToAliasTarget: (# exit 106 #);
sfHookGoToParent: (# exit 107 #);
sfHookGoToNextDrive: (# exit 108 #);
sfHookGoToPrevDrive: (# exit 109 #);
sfHookChangeSelection: (# exit 110 #);
sfHookSetActiveOffset: (# exit 200 #);
sfHookLastCall: (# exit - 2 #);
(* the refcon field of the dialog record during a
 modalfilter or dialoghook contains one of the following *)
sfMainDialogRefCon: (# exit 'stdf' #);
sfNewFolderDialogRefCon: (# exit 'nfdr' #);
sfReplaceDialogRefCon: (# exit 'rplc' #);
sfStatWarnDialogRefCon: (# exit 'stat' #);
sfLockWarnDialogRefCon: (# exit 'lock' #);
sfErrorDialogRefCon: (# exit 'err ' #);
SFReply: CStruct (* Pre sys 7 *)
  (# ByteSize::< (# do 80->Value #);
     good: Byte (# Pos::< (# do 0->Value;  #);  #);
     copy: Byte (# Pos::< (# do 1->Value;  #);  #);
     ftype: Long (# Pos::< (# do 2->Value;  #);  #);
     vRefNum: Short (# Pos::< (# do 6->Value;  #);  #);
     version: Short (# Pos::< (# do 8->Value;  #);  #);
     fname:
       (# name: @Text; length: @Integer
       do
          (R,10)->tos'%inxGetByte '->length;
            (# t: [length] @Char
            do (for i: length repeat (R,10+i)->tos'%inxGetByte '->t[i] for); t->name; 
            #);
          
       exit name
       #);
     directoryName: (* converts vRefNum to a full pathName *)
       (# a: [200] @Integer; d: [1] @Char; VolRef: @Integer; 
       do vRefNum->VolRef; (VolRef,@@ a[1])->pathNameFromWD->pToC->d; 
       exit d
       #);
     
  #);
SFTypeList: CStruct
  (# ByteSize::< (# do 16->Value; INNER ;  #);
     setType: (# typeNo,what: @Integer enter (typeNo,what) do what->R[typeNo] #);
     
  #);
StandardFileReply: CStruct (* Sys 7 *)
  (# ByteSize::< (# do 88->Value #);
     sfGood: Byte (# Pos::< (# do 0->Value;  #);  #);
     sfReplacing: Byte (# Pos::< (# do 1->Value;  #);  #);
     sfType: Long (# Pos::< (# do 2->Value;  #);  #);
     specVRefNum: signedShort (# Pos::< (# do 6->Value;  #);  #);
     specParId: Long (# Pos::< (# do 8->Value;  #);  #);
     nameStart: (# exit 12 #);
     getSpecName:
       (# name: ^Text; length,cur,last: @Integer; 
       do
          &Text[]->name[];
          name.clear;
          nameStart->getByte->length;
          (if length < 1
           // true then length->putInt; ' Length!'->putLine; exception (* ugly *)
          if);
          nameStart+1->cur;
          nameStart+length->last;
          aLoop: cycle
            (# do cur->getByte->name.put; (if cur // last then leave aLoop;  if); cur+1->cur; 
            #);
          
       exit name[]
       #);
     directoryName: (* converts ParID to a full pathName *)
       (# a: [200] @Integer; t: ^Text; ID,volRef: @Integer; 
       do
          specVRefNum->volRef;
          specParId->ID;
          &Text[]->t[];
          (ID,volRef,@@ a[1])->pathNameFromDirID->pToC->t;
          
       exit t[]
       #);
     (* no need for a putSpecName, since FSMakeFSSpec is always used for this. *)
     sfScript: Short (# Pos::< (# do 76->Value;  #);  #);
     sfFlags: Short (# Pos::< (# do 78->Value;  #);  #);
     sfIsFolder: Byte (# Pos::< (# do 80->Value;  #);  #);
     sfIsVolume: Byte (# Pos::< (# do 81->Value;  #);  #);
     sfReserved1: Long (# Pos::< (# do 82->Value;  #);  #);
     sfReserved2: Short (# Pos::< (# do 86->Value;  #);  #);
     
  #);
SFGetfile: External
  (# where,fileFilter,dlgHook: @Integer;
     prompt: [1] @Char;
     numTypes: @ShortInt;
     typeList: ^SFTypeList;
     reply: ^SFReply;
     
  enter (where,prompt,fileFilter,numTypes,typeList[],dlghook,reply[])
  do '{$3F3C,$0002,$A9EA} '->PascalTrap; 
  #);
SFPGetfile: External
  (# where,fileFilter,dlgHook,filterProc: @Integer;
     prompt: [1] @Char;
     numTypes,dlgId: @ShortInt;
     typeList: ^SFTypeList;
     reply: ^SFReply;
     
  enter (where,prompt,fileFilter,numTypes,typeList[],dlghook,reply[],dlgId,filterProc)
  do '{$3F3C,$0004,$A9EA} '->PascalTrap; 
  #);
SFPutfile: External
  (# where,dlgHook: @Integer; prompt,origName: [1] @Char; reply: ^SFReply; 
  enter (where,prompt,origName,dlghook,reply[])
  do '{$3F3C,$0001,$A9EA} '->PascalTrap; 
  #);
SFPPutfile: External
  (# where,dlgHook,filterProc: @Integer;
     prompt,origName: [1] @Char;
     reply: ^SFReply;
     dlgId: @ShortInt;
     
  enter (where,prompt,origName,dlghook,reply[],dlgId,filterProc)
  do '{$3F3C,$0003,$A9EA} '->PascalTrap; 
  #);
CustomGetFile: External
  (# fileFilter,where,activateProc,callBackPtr: @Integer;
     numTypes,dlgID: @ShortInt;
     typeList: ^SFTypeList;
     reply: ^CStruct;
     
  enter (fileFilter,numTypes,typeList[],reply[],dlgID,where,activateProc,callBackPtr)
  do '{$3F3C,$0008,$A9EA}'->PascalTrap; 
  #);
CustomPutFile: External
  (# promp,defaultName: [1] @Char;
     reply: ^CStruct;
     dlgID: @ShortInt;
     where,dlgHook,filterProc,activeList,activateProc,callBackPtr: @Integer;
     
  enter
  (promp,defaultName,reply[],dlgID,where,dlgHook,filterProc,activeList,activateProc,callBackPtr)
  do '{$3F3C,$0007,$A9EA}'->PascalTrap; 
  #);
StandardGetFile: External
  (# fileFilter: @Integer; numTypes: @ShortInt; typeList: ^SFTypeList; reply: ^CStruct; 
  enter (fileFilter,numTypes,typeList[],reply[])
  do '{$3F3C,$0006,$A9EA}'->PascalTrap; 
  #);
StandardPutFile: External
  (# promp,defaultName: [1] @Char; reply: ^CStruct; 
  enter (promp,defaultName,reply[])
  do '{$3F3C,$0005,$A9EA}'->PascalTrap; 
  #);
  

