ORIGIN 'mactypes';



BUILD
macosx  '$$/FSpCompat.o' 'external/FSpCompat.c' '$CC -D$$ -c -o $0 $1'
default ':$$/FSpCompat.obj' ':external/FSpCompat.c' 'mrc -proto strict -shared_lib_export on -o $0 $1';

BUILD 
macosx '$$/FullPath.o' 'external/FullPath.c' '$CC -D$$ -c -o $0 $1'
default ':$$/FullPath.obj' ':external/FullPath.c' 'mrc -proto strict -shared_lib_export on -o $0 $1';

INCLUDE
'files'
'memory';
-- lib: attributes --

(*
 * Interface to the morefiles package from apple.
 *
 * NOTE: Not all routines are interfaced.
 *)
 

							   
FSpGetFullPath: External
	(# spec: ^FSSpec;
		fullPathLength: ^shortRef;
		fullPath: ^longInt; (* Pointer to a handle that will be allocated by FSpGetFullPath *)
		err: @integer;
	enter (spec[], fullPathLength[], fullPath[])
	do callPascal;
	exit err
	#);
	

convertToFullPath:
	(# spec: ^FSSpec;
		path: ^text;
		
		pathHandle: @longInt;
		length: @shortRef;
		lgth: @integer;
		err: @integer;
	enter spec[]
	do (spec[], length[], pathHandle[]) -> FSpGetFullPath -> err;
		(if (err = 0) then
			&text[] -> path[];
			length -> path.T.new;
			length -> lgth;
			((%getLongAt(pathHandle)), @@path.T[1], lgth) -> BlockMove;
			(* Above line tos_converted from: (pathHandle -> TOS'%adrGetLong', @@path.T[1], lgth) -> BlockMove; *)
			length -> path.lgth -> path.pos;
			pathHandle -> DisposeHandle;
		if);
	exit path[]
	#);
