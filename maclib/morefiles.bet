ORIGIN 'mactypes';

BUILD default ':$$/FSpCompat.obj' ':external/FSpCompat.c' 'mrc -proto strict -o $0 $1';
BUILD default ':$$/FullPath.obj' ':external/FullPath.c' 'mrc -proto strict -o $0 $1';

INCLUDE 	'files'
			'memory';
-- lib: attributes --

(*
 * Interface to the morefiles package from apple.
 *
 * NOTE: Not all routines are interfaced.
 *)
 

							   
FSpGetFullPath: External
	(# spec: ^FSSpec;
		fullPathLength: ^shortRef;
		fullPath: ^longInt; (* Pointer to a handle that will be allocated by FSpGetFullPath *)
		err: @integer;
	enter (spec[], fullPathLength[], fullPath[])
	do callPascal;
	exit err
	#);
	

convertToFullPath:
	(# spec: ^FSSpec;
		path: ^text;
		
		pathHandle: @longInt;
		length: @shortRef;
		lgth: @integer;
		err: @integer;
	enter spec[]
	do (spec[], length[], pathHandle[]) -> FSpGetFullPath -> err;
		(if (err = 0) then
			&text[] -> path[];
			length -> path.T.new;
			length -> lgth;
			(pathHandle -> TOS'%adrGetLong', @@path.T[1], lgth) -> BlockMove;
			length -> path.lgth -> path.pos;
			pathHandle -> DisposeHandle;
		if);
	exit path[]
	#);
