ORIGIN 'designobjectbody';
-- pagebodyCVSINFO: Descriptor --
(# 
do '$Id: pagebody.bet,v 1.13 1999-08-27 07:49:19 toby Exp $'->msg.putLine
#)  

-- InitPage: Descriptor --
(# (* x,y,h,w: @Integer; *) 
do
   (if UI.Verbose then 'InitPage:descriptor called!'->putLine if);
   (* DesignObject##->DesignObjectDesc##; revisit *)
   THIS(Page)[]->theObjectList.insert;
   THIS(Page)[]->CurrentPage;
   nextPageNo->PageNo;
   ID->UI.getAPage->theWindow[];
   (* THIS(page) is current page now *)
   (* geometry->(x,y,w,h); {* revisit *} *)
   (* revisit *)
   
#)  

-- PostInitpage: Descriptor --
(# 
do (if UI.Verbose then 'PostInitpage:descriptor called!'->putLine if); 
#)  

-- onMouseDown: DoPart --
do INNER ;   

-- NewPage: Descriptor --
(# bi: ^UI.IDBifrost; aPage: ^UI.bifrostPage; io: ^integerObject
do
   (if UI.Verbose then 'NewPage:descriptor called!'->putLine if);
   (* initialize a new bifrostPage *)
   &UI.bifrostPage[]->aPage[];
   aPage.open;
   (* initialize an IDBifrost *)
   &UI.IDBifrost[]->bi[];
   (aPage[],aPage.theMainPicture[],UI.bifrostObjectList.newID)->bi.init;
   (* finish initialisation of the bifrostPage *)
   bi.id->aPage.theMainPicture.ID;
   bi.id->onInit;
   (* Add this page to UI.pagelist *)
   &integerObject[]->io[];
   bi.id->io;
   io[]->UI.pageList.insert
#)  

-- PositionNewPage: Descriptor --
(# 
do (if UI.verbose then 'PositionNewPage:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- InvisibleNewPage: Descriptor --
(# bi: ^UI.IDBifrost; aPage: ^UI.bifrostPage; io: ^integerObject
do
   (if UI.Verbose then 'InvisibleNewPage:descriptor called!'->putLine if);
   (* initialize a new bifrostPage without showing it on the screen *)
   &UI.bifrostPage[]->aPage[];
   aPage.open
     (#  do false->aPage.visible; aPage.hide #);
   (* initialize an IDBifrost *)
   &UI.IDBifrost[]->bi[];
   (aPage[],aPage.theMainPicture[],UI.bifrostObjectList.newID)->bi.init;
   (* finish initialisation of the bifrostPage *)
   bi.id->aPage.theMainPicture.ID;
   bi.id->onInit;
   (* Add this page to UI.pagelist *)
   &integerObject[]->io[];
   bi.id->io;
   io[]->UI.pageList.insert
#)  

-- CleanUpPage: Descriptor --
(# 
do (if UI.verbose then 'CleanUpPage:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- ScrollPage: Descriptor --
(# 
do (if UI.verbose then 'ScrollPage:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- ClosePage: Descriptor --
(#  do (if UI.verbose then 'ClosePage:descriptor called, but not implemented yet!'->putLine; if);  #)  

-- PageActivateBody: Descriptor --
(# 
do (if UI.verbose then 'PageActivateBody:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- PageDeactivateBody: Descriptor --
(# 
do (if UI.verbose then 'PageDeactivateBody:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- RedrawPage: Descriptor --
(# (* Wonder if this really is necessary most of the time - revisit *) 
do
   (if UI.Verbose then
       'RedrawPage:descriptor called, but not implemented yet!'->putLine
   if)
#)  
-- showAllDesignPictures: doPart --
do
   (if UI.currentBifrostPage[] <> none then
    (&UI.currentBifrostPage.showAllDesignPictures[]).open;
if) 

-- pageZoomDopart:doPart --
do
   (if UI.verbose then
       'designenv/pagebody.bet: pageZoomDopart Called'->putline
   if);
   (x,y) -> (ID -> UI.getApage).zoom;

-- SetVisible: Descriptor --
(# 
do
   (if UI.Verbose then 'SetVisible:descriptor called!'->putLine if);
   ID
     ->UI.getApage
       (# 
       do (if v then thePage.show else thePage.hide if); v->thePage.visible
       #)
#)  

-- GetVisible: Descriptor --
(# 
do
   (if UI.verbose then 'GetVisible:descriptor called!'->putLine if);
   ID->UI.getApage (#  do thePage.visible->v #)
#)  

-- SetPageTitle: Descriptor --
(# 
do
   (if UI.verbose then 'SetPageTitle:descriptor called!'->putLine if);
   ID->UI.getApage (#  do t[]->thePage.title #)
#)  

-- GetPageTitle: Descriptor --
(# 
do
   (if UI.verbose then 'GetPageTitle:descriptor called!'->putLine if);
   ID->UI.getApage (#  do t.clear; thePage.title->t.putText #)
#)  

-- SetPageNo: Descriptor --
(# 
do
   (if UI.verbose then 'SetPageNo:descriptor called!'->putLine if);
   ID->UI.getApage (#  do no->thePage.pageno #)
#)  

-- GetPageNo: Descriptor --
(# 
do
   (if UI.verbose then 'GetPageNo:descriptor called!'->putLine if);
   ID->UI.getApage (#  do thePage.pageno->no #)
#)  

-- SetBorder: Descriptor --
(# 
do
   (if UI.Verbose then 'SetBorder:descriptor called!'->putLine if);
   (* revisit - can be called before theMainPicture.init *)
   ID
     ->UI.getApage
       (# 
       do
          (if thePage.bordervis then
              (if not b then
                  thePage.border[]->thePage.theMainPicture.delete; 
              if)
           else
              (if b then thePage.border[]->thePage.theMainPicture.add;  if)
          if);
          b->thePage.bordervis;
          
       #)
#)  

-- GetBorder: Descriptor --
(# 
do
   (if UI.Verbose then 'GetBorder:descriptor called!'->putLine if);
   ID->UI.getApage (#  do thePage.bordervis->b #)
#)  

-- IsOpen: Descriptor --
(#  do (if UI.verbose then 'IsOpen:descriptor called, but not implemented yet!'->putLine; if);  #)  

-- Coarsen: Descriptor --
(#  do (if UI.verbose then 'Coarsen:descriptor called, but not implemented yet!'->putLine; if);  #)  

-- GetDesignObject: Descriptor --
(# thePage: ^UI.bifrostPage; myObject: ^thePage.designObject
do
   (if UI.extremelyVerbose then
       'GetDesignObject:descriptor called! (%d)\n'
         ->putFormat (#  do ID->d #)
   if);
   THIS(page).ID->UI.getApage->thePage[];
   thePage.designSelection->myObject[];
   (if myObject[]
    // none then
       (if UI.extremelyVerbose then
           'getDesignObject: designSelection is NONE'->putLine
       if)
    else
       myObject.getMyObject
         (#  do theObject[]->THIS(currentObject).theObject[] #)
   if)
#)  

-- SetDesignObject: Descriptor --
(# 
do
   (if UI.verbose then
       '%d: SetDesignObject:descriptor called! (%d)\n'
         ->putFormat (#  do theObject.ID->d; ID->d #)
   if);
   theObject.designAttributes.lookup
     (# myObject: ^thePage.designObject
     do
        (if thePage.designSelection <> none then
            (thePage.designSelection).unHilite
        if);
        UI.bifrostObjectList.rep[theObject.ID].IO[]->myObject[];
        myObject.hilite;
        myObject[]->thePage.designSelection
     #)
#)  

-- SetObjectAutoPan: Descriptor --
(# 
do
   (if theObject[] <> none then
       (if UI.extremelyVerbose then
           '%d: SetObjectAutoPan:descriptor called! (%d)\n'
             ->putFormat (#  do theObject.ID->d; ID->d #)
       if);
       autoPan->theObject.designAttributes.setAutoPan;
       (if autoPan then theObject.designAttributes.autoPan if)
    else
       (if UI.extremelyVerbose then
           'SetObjectAutoPan:descriptor called! (%d) Reference is NONE.\n'
             ->putFormat (#  do ID->d #)
       if)
   if)
#)  

-- GetDesignGroup: Descriptor --
(# 
do
   (if UI.verbose then
       '%d: GetDesignGroup:descriptor called!\n'->putFormat (#  do ID->d #)
   if);
   UI.bifrostObjectList.rep[ID].page.designGroup->theObjectList.nodeIDsToList
     ->theList[]
#)  

-- SetDesignGroup: Descriptor --
(# 
do (if UI.verbose then 'SetDesignGroup:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- GetNodes: Descriptor --
(# ol: [0] @integer
do
   (if UI.verbose then
       '%d: GetNodes:descriptor called!\n'->putFormat (#  do ID->d #)
   if);
   ID->UI.getApage (#  do thePage.getNodes->ol #);
   ol->theObjectList.nodeIDsToList->theNodes[]
#)  

-- PageGetConnectors: Descriptor --
(# ol: [0] @integer; dobj: ^designObject
do
   (if UI.verbose then
       '%d: PageGetConnectors:descriptor called!\n'
         ->putFormat (#  do ID->d #)
   if);
   ID->UI.getApage (#  do thePage.getConnectors->ol #);
   ol->theObjectList.nodeIDsToList->theList[]
#)  

-- GetInternalConnectors: Descriptor --
(# 
do
   (if UI.verbose then 'GetInternalConnectors:descriptor called, but not implemented yet!'->putLine; if);
   
#)  

-- PageGetParent: Descriptor --
(# 
do (if UI.verbose then 'PageGetParent:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- PageAttachToNode: Descriptor --
(# 
do (if UI.verbose then 'PageAttachToNode:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- MakeDesignObject: Descriptor --
(# po: ^designObject
do
   (if UI.verbose then
       '%d: MakeDesignObject:descriptor called!\n'
         ->putFormat (#  do ID->d #)
   if);
   ID
     ->UI.lookupDesignPicture
       (# 
       do
          (if true
           // theObject## <= thePage.designConn## then
              &DesignConnector[]->THIS(MakeDesignObject).theObject[]
           // theObject## <= thePage.designRect## then
              &DesignRect[]->THIS(MakeDesignObject).theObject[]
           // theObject## <= thePage.designEllipse## then
              &DesignEllipse[]->THIS(MakeDesignObject).theObject[]
           // theObject## <= thePage.designPoly## then
              &DesignPolygon[]->THIS(MakeDesignObject).theObject[]
           // theObject## <= thePage.designLabel## then
              &DesignLabel[]->THIS(MakeDesignObject).theObject[]; 
           else
              '%d: MakeDesignObject: unknown type!\n'
                ->putFormat (#  do ID->d #)
          if)
       #);
   INNER MakeDesignObject;
   (if theObject[] <> none then
       ID->theObject.onInit;
       (if theObject.isRegion then
           ID
             ->UI.lookupDesignPicture
               (# 
               do theObject.load_prevPicture.ID->theObjectList.find->po[]
               #);
           (if UI.verbose then
               'load region: %d is region of %d\n'
                 ->putFormat (#  do theObject.ID->d; po.ID->d #);
               
           if);
           (* onInitRegion is called in v3.1 *)
           theObject.onInitRegion;
           
       if);
       theObject.getRegionIDs->makeObjectsFromList
   if)
#)  

-- MakeObjectsFromList: DoPart --
do (for j: list.range repeat list[j]->makeDesignObject for)  

-- MakeDescObject: DoPart --
do 'MakeDescObject:dopart called, but not implemented yet!'->putLine; INNER ;   

-- MakeCoarse: DoPart --
do 'MakeCoarse:dopart called, but not implemented yet!'->putLine; INNER ;   

-- PageGetCenter: Descriptor --
(# 
do (if UI.verbose then 'PageGetCenter:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- PageSetCenter: Descriptor --
(# 
do (if UI.verbose then 'PageSetCenter:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- PageSetGeometry: Descriptor --
(# 
do (if UI.verbose then 'PageSetGeometry:descriptor called, but not implemented yet!'->putLine; if); 
#)  

-- PageGetGeometry: Descriptor --
(# 
do
   (if UI.verbose then
       (if UI.verbose then 'PageGetGeometry:descriptor called, but not implemented yet!'->putLine; if); 
   if)
#)  

-- PageReadDiagram: Descriptor --
(# 
do
   (if UI.verbose then
       '%d: PageReadDiagram:descriptor called!\n'->putFormat (#  do ID->d #)
   if);
   ID
     ->UI.lookupDesignPicture
       (# 
       do
          thePage.theMainPicture.scanGOsReverse
            (# dn: ^thePage.designNode
            do
               (if go## <= thePage.designNode## then
                   go[]->dn[]; dn.ID->pageCallBack.makeDesignObject
               if)
            #);
          thePage.theMainPicture.scanGOsReverse
            (# dc: ^thePage.designConn
            do
               (if go## <= thePage.designConn## then
                   go[]->dc[]; dc.ID->pageCallBack.makeDesignObject
               if)
            #)
       #);
   (if UI.verbose then
       '%d: before INNER onReadDiagram\n'->putFormat (#  do ID->d #)
   if);
   INNER onReadDiagram;
   (if UI.verbose then
       '%d: after INNER onReadDiagram\n'->putFormat (#  do ID->d #)
   if)
#)  

-- PaletteInit: Descriptor --
(# 
do (if UI.verbose then 'PaletteInit:descriptor called, but not implemented yet!'->putLine; if); 
#)  

