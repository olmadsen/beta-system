ORIGIN 'designobjectbody';
LIB_ITEM 'designenv';
-- menubodyCVSINFO: Descriptor --
(# 
do '$Id: menubody.bet,v 1.17 2001-09-13 12:00:50 elmer Exp $'->msg.putLine
#)  

-- CheckDesignOAMenus: Descriptor --
(* INNER is called elsewhere *) (* called from document onInit *)
  (# 
  do
     (if UI.menuVerbose then
         ': menubody-CheckDesignOAMenus called but not implemented yet!\n'
           ->putText
     if)
  #)
  (*********** MENU BAR *********)  

-- MenuBarInsert: Descriptor --
(# 
do
   (if UI.menuVerbose then
       '%d: menubody-MenuBarInsert called!\n'
         ->putFormat (#  do THIS(insert).e.ID->d #)
   if);
   e.insert;
   INNER insert
#)  

-- MenuBarDelete: Descriptor --
(# 
do
   (if not att.internal then
       (if UI.menuVerbose then
           '%d: menubody-MenuBarDelete called!\n'
             ->putFormat (#  do THIS(remove).e.ID->d #)
       if);
       e.delete;
       INNER remove
   if)
#)
(*********** BASIC MENU *********)  

-- MenuEnable: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-MenuEnable called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER  

-- MenuDisable: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-MenuDisable called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER  

-- MenuSeperator: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-MenuSeperator called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if)  

-- basicMenuInsertBefore: DoPart --
(* no INNER *)
do
   (if UI.menuVerbose then
       '%d: menubody-UserMenuInsertBefore called!\n'
	 ->putFormat (#  do ID->d #)
   if);
   (if ID <> 0 then
       true->menuBar.att.internal;
       THIS(basicMenu)[]->menuBar.remove;
       false->menuBar.att.internal;
       (THIS(basicMenu)[],beforeMenuID->menuBar.findMenu->menuBar.at)
	 ->menuBar.insertBefore;
       (if UI.currentBifrostPage[] <> none then
	   (UI.currentBifrostPage.theMenuBar).checkMenuBar
       if)
   if)

(*********** BASIC MENU ITEM *********)
-- BasicItemExecute: DoPart --
do INNER execute  

-- MenuItemEnable: DoPart --
do (* basicItem.enable *)
   (if UI.menuVerbose then
       '%d: menubody-MenuItemEnable called!\n'->putFormat (#  do ID->d #)
   if);
   (if not doNotEnable then false->att.disabled if);
   INNER (* should be called *)  

-- MenuItemDisable: DoPart --
do (* basicItem.disable *)
   (if UI.menuVerbose then
       '%d: menubody-MenuItemDisable called!\n'->putFormat (#  do ID->d #)
   if);
   true->att.disabled;
   INNER (* should be called *)  

-- MenuItemCheck: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-MenuItemCheck called!\n'->putFormat (#  do ID->d #)
   if);
   checked->att.menuItem.checked;
   INNER (*********** DESIGN MENU *********)  

-- DesignMenuInsertItem: Descriptor --
(# 
do
   (if UI.menuVerbose then
       '%d: menubody-DesignMenuInsertItem called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER insert
#)  

-- DesignMenuDeleteItem: Descriptor --
(# 
do
   (if UI.menuVerbose then
       '%d: menubody-DesignMenuDeleteItem called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER delete
#)  

-- DesignMenuItemRename: Descriptor --
(# 
do
   (if UI.menuVerbose then
       '%d: menubody-DesignMenuItemRename called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER rename
#)  

-- DesignMenuInsert: Descriptor --
(# 
do
   (if UI.menuVerbose then
       '%d: menubody-DesignMenuInsert called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   
#)  

-- DesignMenuDelete: Descriptor --
(# 
do
   (if UI.menuVerbose then
       '%d: menubody-DesignMenuDelete called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   (*    ItemList.scan(# do current.delete #);
    *    ItemList.clear;
    *)
   
#)
(*********** USER MENU *********)  

-- UserMenuItemIsDisabled: DoPart --
(* no INNER *)
do
   (if UI.menuVerbose then
       '%d: menubody-UserMenuItemIsDisabled called!\n'
         ->putFormat (#  do ID->d #)
   if);
   att.disabled->value (* no INNER *)  

-- UserMenuInsertItem: DoPart --
do
     (# nm: ^text; cch: (* controlchar *) @char
     do
        (if UI.menuVerbose then
            '%d: menubody-UserMenuInsertItem called! (%s)\n'
              ->putFormat (#  do ID->d; name[]->s #)
        if);
        att.name.clear;
        name[]->att.name.putText;
        (if att.menuItem[] <> none then
            (if UI.warnDanger then
                'menubody-userMenuInsertItem called twice'->putLine
            if)
         else
            (if '-'->name.equal then
                &THIS(userMenu).att.menu.separator[]->att.menuItem[];
                att.menuItem.open
             else
                &att.menuItemType[]->att.menuItem[];
                att.menuItem.open;
                0->name.pos;
                
                (* Try the old hack with backslash-key at beginning of name *)
                (if name.peek
                 // '\\' then
                    name.get;
                    (* shortcut will be Ctrl+<cch> *)
                    name.get->cch;
                    &text[]->nm[];
                    name.getLine->nm.putText;
                    nm[]->att.menuItem.name;
                    cch->att.menuItem.key;
                 else
                    (if THIS(item).shortcut.isActive then
                        (shortcut.key, shortcut.shift,
                        shortcut.ctrl, shortcut.alt) -> att.menuItem.specialKey;
                    if);
                    name[]->att.menuItem.name
                if)
            if);
            att.menuItem[]->THIS(userMenu).att.menu.append;
            (if att.submenu[]<>NONE then
                (if not att.submenuIsOpen then
                    att.submenu.open;
                    true->att.submenuIsOpen
                if);
                att.submenu[]->att.menuitem.submenu;
            if);
            INNER insert
        if);
        
     #)  

-- UserMenuDeleteItem: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-UserMenuDeleteItem called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER  

-- UserMenuItemRename: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-UserMenuItemRename called! (%s)\n'
         ->putFormat (#  do ID->d; name[]->s #)
   if);
   att.name.clear;
   name[]->att.name.putText;
   name[]->att.menuItem.name;
   INNER rename  

-- UserMenuIsDisabled: DoPart --
do (* no INNER *)
   (if UI.menuVerbose then
       '%d: menubody-UserMenuIsDisabled called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if)  

-- UserMenuInsert: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-UserMenuInsert called! (%s)\n'
         ->putFormat (#  do ID->d; name[]->s #)
   if);
   (if att.menu[] <> none then
       (if UI.warnDanger then
           'menubody-userMenuInsert called twice'->putLine
       if)
    else
       att.name.clear;
       name[]->att.name.putText;
       &att.menuType[]->att.menu[];
       att.menu.open;
       name[]->att.menu.name;
       
   if);
   INNER  

-- UserMenuDelete: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-UserMenuDelete called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER (*********** FILE MENU *********)  

-- NewItem: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-NewItem called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- OpenItem: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-OpenItem called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- CloseItem: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-CloseItem called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- pageSetupExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-pageSetupExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- preferencesExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-preferencesExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- loadTextExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-loadTextExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- saveTextExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-saveTextExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- LoadPageItem: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-LoadPageItem called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- InitFileMenu: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     420001->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitFileMenu called, but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if);
     (if att.menu[] <> none then
         (failureTrace,'menubody-InitFileMenu called twice')->stop
     if);
     att.name.clear;
     'File'->att.name.putText;
     &att.menuType[]->att.menu[];
     att.menu.open;
     att.name[]->att.menu.name;
     
  #)
  (*********** EDIT MENU *********)  

-- undoExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-undoExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- cutExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-cutExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- copyExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-copyExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- pasteExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-pasteExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- PasteItem: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-PasteItem called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- clearExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-clearExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- selectExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-selectExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- showExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-showExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- statusExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-statusExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- InitEditMenu: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     3->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitEditMenu called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if);
     (if att.menu[] <> none then
         (failureTrace,'menubody-InitEditMenu called twice')->stop
     if);
     att.name.clear;
     'Edit'->att.name.putText;
     &att.menuType[]->att.menu[];
     att.menu.open;
     att.name[]->att.menu.name;
     
  #)
  (*********** CREATE MENU *********)  

-- InitCreateMenu: Descriptor --
(* INNER is called elsewhere *)
  (#
     graphicsMenu: @att.menuType;
     menuItemType: graphicsMenu.menuItem
       (#
          eventHandler::< 
            (# onStatus::  (#  do not disabled->value #) #);
          open::< 
            (#  do INNER ; THIS(menuItemType)[]->graphicsMenu.append #);
          disabled: @boolean;
          
       #);
     connItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.graphicsConn #) #);
          open::<  (#  do 'Connector'->name #)
       #);
     rectItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.graphicsRect #) #);
          open::<  (#  do 'Rectangle'->name #)
       #);
     RndRectItem: @menuItemType
       (#
          eventHandler::< 
            (# onSelect::  (#  do UI.graphicsRndRect #) #);
          open::<  (#  do 'Rounded rectangle'->name #)
       #);
     ellipseItem: @menuItemType
       (#
          eventHandler::< 
            (# onSelect::  (#  do UI.graphicsEllipse #) #);
          open::<  (#  do 'Ellipse'->name #)
       #);
     wedgeItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.graphicsWedge #) #);
          open::<  (#  do 'Wedge'->name #)
       #);
     polyItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.graphicsPoly #) #);
          open::<  (#  do 'Polygon'->name #)
       #);
     lineItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.graphicsLine #) #);
          open::<  (#  do 'Line'->name #)
       #);
     labelItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.graphicsLabel #) #);
          open::<  (#  do 'Label'->name #)
       #);
     pictureItem: @menuItemType
       (#
          eventHandler::< 
            (# onSelect::  (#  do UI.graphicsPicture #) #);
          open::<  (#  do 'Picture'->name #)
       #)
  do
     4->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitCreateMenu!\n'->putFormat (#  do ID->d #)
     if);
     (if att.menu[] <> none then
         (failureTrace,'menubody-InitCreateMenu called twice')->stop
     if);
     att.name.clear;
     'Graphics'->att.name.putText;
     graphicsMenu[]->att.menu[];
     att.menu.open;
     att.name[]->att.menu.name;
     connItem.open;
     rectItem.open;
     RndRectItem.open;
     ellipseItem.open;
     polyItem.open;
     labelItem.open
  #)
  (*********** MAKEUP MENU *********)  

-- InitMakeUpMenu: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     5->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitMakeUpMenu called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)
  (*********** PAGE MENU *********)  

-- blowUpExecute: DoPart --
do (* no INNER *)
   (if UI.menuVerbose then
       '%d: menubody-blowUpExecute called!\n'->putFormat (#  do ID->d #)
   if);
   (if UI.currentBifrostPage[] <> none then UI.currentBifrostPage.blowup if)  

-- reduceExecute: DoPart --
do (* no INNER *)
   (if UI.menuVerbose then
       '%d: menubody-reduceExecute called!\n'->putFormat (#  do ID->d #)
   if);
   (if UI.currentBifrostPage[] <> none then UI.currentBifrostPage.reduce if)  

-- NewPageItem: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-NewPageItem called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- closePageExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-closePageExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- changeFattsExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-changeFattsExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- strTreeExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-strTreeExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- cleanUpExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-cleanUpExecute called!\n'->putFormat (#  do ID->d #)
   if);
   (if UI.currentBifrostPage[] <> none then
       UI.currentBifrostPage.cleanUp
   if);
   INNER execute  

-- InitPageMenu: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     420005->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitPageMenu called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if);
     (if att.menu[] <> none then
         (failureTrace,'menubody-InitPageMenu called twice')->stop
     if);
     att.name.clear;
     'Page'->att.name.putText;
     &att.menuType[]->att.menu[];
     att.menu.open;
     att.name[]->att.menu.name;
     
  #)
  (*********** GROUP MENU *********)  

-- CoarsenItemHit: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     (if UI.menuVerbose then
         '%d: menubody-CoarsenItemHit called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)  

-- InitGroupMenu: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     420006->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitGroupMenu called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)
  (*********** TEXT MENU *********)  

-- textAttrExecute: DoPart --
do
   (if UI.menuVerbose then
       '%d: menubody-textAttrExecute called but not implemented yet!\n'
         ->putFormat (#  do ID->d #)
   if);
   INNER execute  

-- InitTextMenu: Descriptor --
(* INNER is called elsewhere *)
  (# 
  do
     420007->ID;
     (* revisit *)
     (if UI.menuVerbose then
         '%d: menubody-InitTextMenu called but not implemented yet!\n'
           ->putFormat (#  do ID->d #)
     if)
  #)
  (*********** ALIGN MENU *********)  

-- InitAlignMenu: Descriptor --
(* INNER is called elsewhere *)
  (#
     alignMenu: @att.menuType;
     menuItemType: alignMenu.menuItem
       (#
          eventHandler::< 
            (# onStatus::  (#  do not disabled->value #) #);
          open::< 
            (#  do INNER ; THIS(menuItemType)[]->alignMenu.append #);
          disabled: @boolean;
          
       #);
     leftItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.alignLeft #) #);
          open::<  (#  do 'Left side'->name #)
       #);
     rightItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.alignRight #) #);
          open::<  (#  do 'Right side'->name #)
       #);
     topItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.alignTop #) #);
          open::<  (#  do 'Top edge'->name #)
       #);
     bottomItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.alignBottom #) #);
          open::<  (#  do 'Bottom edge'->name #)
       #);
     verticalItem: @menuItemType
       (#
          eventHandler::< 
            (# onSelect::  (#  do UI.alignHorizontal #) #);
          open::<  (#  do 'Horizontal center'->name #)
       #);
     horizontalItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.alignVertical #) #);
          open::<  (#  do 'Vertical center'->name #)
       #);
     spacingItem: @menuItemType
       (#
          eventHandler::<  (# onSelect::  (#  do UI.alignSpacing #) #);
          open::<  (#  do 'Spacing...'->name #)
       #)
  do
     9->ID;
     (if UI.menuVerbose then
         '%d: menubody-InitAlignMenu called!\n'->putFormat (#  do ID->d #)
     if);
     (if att.menu[] <> none then
         (failureTrace,'menubody-InitAlignMenu called twice')->stop
     if);
     att.name.clear;
     'Align'->att.name.putText;
     alignMenu[]->att.menu[];
     att.menu.open;
     att.name[]->att.menu.name;
     leftItem.open;
     rightItem.open;
     topItem.open;
     bottomItem.open;
     verticalItem.open;
     horizontalItem.open;
     spacingItem.open
  #)  

-- updateMenuBar: DoPart --
do
   not b->att.dontUpdate;
   (if b then
       (if UI.currentBifrostPage[] <> none then
           (UI.currentBifrostPage.theMenuBar).checkMenuBar
       if)
   if)

-- menuBarPrivateAtt: Descriptor --
(# dontUpdate: @boolean; internal: @boolean;  #)  

-- menuListInsert: DoPart --
do e[]->append; INNER  

-- menuListRemove: DoPart --
do e[]->at->delete; INNER  

-- menuListFindMenu: DoPart --
do find (# predicate::<  (#  do (current.id = id)->value #) #)->m[]  

-- basicMenuItemInit: DoPart --
do
   (if (itemNumber->itemList.findItem) <> none then
       itemNumber->itemList.findItem->itemList.at->itemList.delete
   if);
   THIS(BasicItem)[]->ItemList.append;
   True->PreCall;
   True->proceed;
   INNER  

-- basicMenuItemInsert: DoPart --
do INNER  

-- basicMenuItemDelete: DoPart --
do INNER  

-- basicMenuItemListFindPredicate: DoPart --
do (current.itemNumber = itemNo)->value  

-- basicMenuInit: DoPart --
do
   (if (ID->menuBar.findMenu) <> none then
       ID->menuBar.findMenu->menuBar.remove
   if);
   INNER ;
   THIS(BasicMenu)[]->MenuBar.Insert  

-- basicMenuInsert: DoPart --
do INNER  

-- basicMenuDelete: DoPart --
do INNER  

-- UserMenuItemInit: DoPart --
do INNER  

-- UserMenuInit: DoPart --
do INNER  

-- attachGuienvMenu: DoPart --
do
     (# m: ^UI.theGui.menu
     do
        theMenu[]->m[];
        att.name.clear;
        m.name->att.name.putText;
        m[]->att.menu[]
     #)  

-- attachSubMenu: DoPart --
do
   theMenu[]->att.submenu[]
   
-- bifrostMenuDontUpdate: doPart --
do
   menuBar.att.dontUpdate -> value
