ORIGIN '~beta/basiclib/betaenv';

BODY 'private/treelevelbody';
BODY 'private/astbody';


-- lib: attributes --

AstInterface:
  (# <<SLOT AstInterfaceLib: attributes>>;
     
     AST:
       (# <<SLOT ASTLib: attributes>>;
          kind: @int8u;
          status: @int8u;
          symbol: @int16u;
          gram: ^TreeLevel;
          com: ^Comment;
          son: ^AST;
          next: ^AST;
          dump:<
            (# level: @integer;
               output: ^stream;
            enter (level, output[])
            <<SLOT ASTDump: doPart>>
            #);
       #);
     
     Expanded: AST
       (# dump::<
            (# <<SLOT ExpandedDump: doPart>> #);
       #);
     Cons: Expanded
       (# dump::<
            (# <<SLOT ConsDump: doPart>> #);
       #);
     List: Expanded
       (# dump::<
            (# <<SLOT ListDump: doPart>> #);
       #);
     
     UnExpanded: AST
       (# value: ^text;
          dump::<
            (# <<SLOT UnExpandedDump: doPart>> #);
       #);
     Optional: UnExpanded
       (# dump::<
            (# <<SLOT OptionalDump: doPart>> #);
       #);
     SlotDesc: AST
       (# dump::<
            (# <<SLOT SlotDescDump: doPart>> #);
       #);
     
     
     Lexem: AST
       (# dump::<
            (# <<SLOT LexemDump: doPart>> #);
       #);
     LexemText: Lexem
       (# value: ^Text; 
          dump::<
            (# <<SLOT LexemTextDump: doPart>> #);
       #);
     NameDecl: LexemText
       (# dump::<
            (# <<SLOT NameDeclDump: doPart>> #);
       #);
     NameAppl: LexemText
       (# dump::<
            (# <<SLOT NameApplDump: doPart>> #);		
       #);
     String: LexemText
       (# dump::<
            (# <<SLOT StringDump: doPart>> #);	
       #);
     Comment: LexemText
       (# position: @integer;
          breaks: @integer;
          dump::<
            (# <<SLOT CommentDump: doPart>> #);	
       #);
     Const: LexemText
       (# dump::<
            (# <<SLOT ConstDump: doPart>> #);	
       #);
     
     kinds: @
       (# interior: (#  exit 1 #);
          unExpanded: (#  exit 2 #);
          optional: (#  exit 3 #);
          nameAppl: (#  exit 4 #);
          nameDecl: (#  exit 5 #);
          string: (#  exit 6 #);
          const: (#  exit 7 #);
          comment: (#  exit 8 #);
          slotDesc: (#  exit 9 #);
          list: (#  exit 117 #);
          cons: (#  exit 118 #);
       #);
     
     TreeLevel:
       (# <<SLOT TreeLevelLib: attributes>>;
          
          init:<
            (# tableFileName: ^Text;
            enter tableFileName[]
            <<SLOT TreeLevelInit: doPart>> 
            #);
          
          symbolToAst:
            (# symbol: @int16;
               theAst: ^AST;
            enter symbol
            <<SLOT TreeLevelSymbolToAst: doPart>>
            exit theAst[]
            #);
          symbolToName:
            (# symbol: @int16;
               name: ^text;
            enter symbol
            <<SLOT TreeLevelSymbolToName: doPart>>
            exit name[]
            #);
          
          newUnExpanded:
            (# symbol: @int16;
               theAst: ^UnExpanded;
            enter symbol
            <<SLOT TreeLevelNewUnexpanded: doPart>>
            exit theAst[]
            #);
          pretty:
            (# node: ^AST;
               output: ^Stream;
            enter (node[], output[])
            <<SLOT TreeLevelPretty: doPart>>
            #);
          
          parser: @
            (# <<SLOT parserLib: attributes>>;
               init:
                 (# tableFileName: ^text;
                 enter tableFileName[]
                 <<SLOT parserInit: doPart>> 
                 #);
               parse:
                 (# goal: @integer;
                    input: ^Stream;
                    root: ^AST;
                 enter (goal, input[])
                 <<SLOT parserParse: doPart>>
                 exit root[]
                 #);
               trace: @boolean;
               private: @<<SLOT parserPrivate: descriptor>>;
            #);
          kindArray: [0] @int8u;
          roomArray: [0] @int8u;
          sonArray: [0] @int8u;
          nodeClassArray: [0] @int8u;
          genRefArray: [0] ##AST;
       #);
  #);
