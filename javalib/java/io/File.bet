ORIGIN '~beta/basiclib/betaenv';
INCLUDE '../lang/String';
INCLUDE 'FileFilter';
INCLUDE 'FilenameFilter';
INCLUDE '../net/URI';
INCLUDE '../net/URL';

(*BUILD jvm 'jvm/beta/FileHelper.class' 'FileHelper.java' 'javac -classpath jvm -d jvm $1';*)

--LIB: attributes--

(* Java File class.  See
 * http://java.sun.com/j2se/1.4.1/docs/api/java/io/File.html*)
JavaFile: ExternalClass
  (#   
     (* Constructors - currently not possible to overload *)
     _init:
       (# pathname: ^String;
       enter pathname[]
       #);  
     
     
     (* Methods *)

     canRead: proc
       (* Tests whether the application can read the file denoted
        * by this abstract pathname
        *)
       (# result: @boolean;
       exit result
       #);
     canWrite: proc
       (* Tests whether the application can modify to the file
        * denoted by this abstract pathname
        *)
       (# result: @boolean;
       exit result
       #);
     compareTo_File: proc
       (* Compares two abstract pathnames lexicographically *)
       (# pathname: ^JavaFile;
          result: @int32;
       enter (pathname[])
       do 'compareTo' -> procname;
       exit result
       #);
     compareTo_O: proc
       (* Compares this abstract pathname to another object *)
       (# o: ^Object;
          result: @int32;
       enter (o[])
       do 'compareTo' -> procname;
       exit result
       #);
     createNewFile: proc
       (* Atomically creates a new, empty file named by this
        * abstract pathname if and only if a file with this name
        * does not yet exist
        *)
       (# result: @boolean;
       exit result
       #);
     delete: proc
       (* Deletes the file or directory denoted by this abstract
        * pathname
        *)
       (# result: @boolean;
       exit result
       #);
     deleteOnExit: proc
       (* Requests that the file or directory denoted by this
        * abstract pathname be deleted when the virtual machine
        * terminates
        *)
       (# 
       #);
     equals: proc
       (* Tests this abstract pathname for equality with the given
        * object
        *)
       (# obj: ^Object;
          result: @boolean;
       enter (obj[])
       exit result
       #);
     exists: proc
       (* Tests whether the file denoted by this abstract pathname
        * exists
        *)
       (# result: @boolean;
       exit result
       #);
     getAbsoluteFile: proc
       (* Returns the absolute form of this abstract pathname *)
       (# result: ^JavaFile;
       exit result[]
       #);
     getAbsolutePath: proc
       (* Returns the absolute pathname string of this abstract
        * pathname
        *)
       (# result: ^String;
       exit result[]
       #);
     getCanonicalFile: proc
       (* Returns the canonical form of this abstract pathname *)
       (# result: ^JavaFile;
       exit result[]
       #);
     getCanonicalPath: proc
       (* Returns the canonical pathname string of this abstract
        * pathname
        *)
       (# result: ^String;
       exit result[]
       #);
     getName: proc
       (* Returns the name of the file or directory denoted by
        * this abstract pathname
        *)
       (# result: ^String;
       exit result[]
       #);
     getParent: proc
       (* Returns the pathname string of this abstract pathname's
        * parent, or null if this pathname does not name a parent
        * directory
        *)
       (# result: ^String;
       exit result[]
       #);
     getParentFile: proc
       (* Returns the abstract pathname of this abstract
        * pathname's parent, or null if this pathname does not
        * name a parent directory
        *)
       (# result: ^JavaFile;
       exit result[]
       #);
     getPath: proc
       (* Converts this abstract pathname into a pathname string *)
       (# result: ^String;
       exit result[]
       #);
     hashCode: proc
       (* Computes a hash code for this abstract pathname *)
       (# result: @int32;
       exit result
       #);
     isAbsolute: proc
       (* Tests whether this abstract pathname is absolute *)
       (# result: @boolean;
       exit result
       #);
     isDirectory: proc
       (* Tests whether the file denoted by this abstract pathname
        * is a directory
        *)
       (# result: @boolean;
       exit result
       #);
     isFile: proc
       (* Tests whether the file denoted by this abstract pathname
        * is a normal file
        *)
       (# result: @boolean;
       exit result
       #);
     isHidden: proc
       (* Tests whether the file named by this abstract pathname
        * is a hidden file
        *)
       (# result: @boolean;
       exit result
       #);
     lastModified: proc
       (* Returns the time that the file denoted by this abstract
        * pathname was last modified
        *)
       (# result: @int64 (* long *);
       exit result
       #);
     length: proc
       (* Returns the length of the file denoted by this abstract
        * pathname
        *)
       (# result: @int64 (* long *);
       exit result
       #);
     list_V: proc
       (* Returns an array of strings naming the files and
        * directories in the directory denoted by this abstract
        * pathname
        *)
       (# result: [0]^String;
       exit result
       #);
     list_FilenameFilter: proc
       (* Returns an array of strings naming the files and
        * directories in the directory denoted by this abstract
        * pathname that satisfy the specified filter
        *)
       (# filter: ^FilenameFilter;
          result: [0]^String;
       enter (filter[])
       exit result
       #);
     listFiles_V: proc
       (* Returns an array of abstract pathnames denoting the
        * files in the directory denoted by this abstract pathname
        *)
       (# result: [0]^JavaFile;
       do 'listFiles' -> procname;
       exit result
       #);
     listFiles_FileFilter: proc
       (* Returns an array of abstract pathnames denoting the
        * files and directories in the directory denoted by this
        * abstract pathname that satisfy the specified filter.
        *)
       (# filter: ^FileFilter;
          result: [0]^JavaFile;
       enter (filter[])
       do 'listFiles' -> procname;
       exit result
       #);
     listFiles_FilenameFilter: proc
       (* Returns an array of abstract pathnames denoting the
        * files and directories in the directory denoted by this
        * abstract pathname that satisfy the specified filter.
        *)
       (# filter: ^FilenameFilter;
          result: [0]^JavaFile
       enter (filter[])
       do 'listFiles' -> procname;
       exit result
       #);
     mkdir: proc
       (* Creates the directory named by this abstract pathname *)
       (# result: @boolean;
       exit result
       #);
     mkdirs: proc
       (* Creates the directory named by this abstract pathname,
        * including any necessary but nonexistent parent
        * directories
        *)
       (# result: @boolean;
       exit result
       #);
     renameTo: proc
       (* Renames the file denoted by this abstract pathname *)
       (# dest: ^JavaFile;
          result: @boolean;
       enter (dest[])
       exit result
       #);
     setLastModified: proc
       (* Sets the last-modified time of the file or directory
        * named by this abstract pathname
        *)
       (# time: @int64 (* long *);
          result: @boolean;
       enter time
       exit result
       #);
     setReadOnly: proc
       (* Marks the file or directory named by this abstract
        * pathname so that only read operations are allowed
        *)
       (# result: @boolean;
       exit result
       #);
     toString: proc
       (* Returns the pathname string of this abstract pathname *)
       (# result: ^String;
       exit result[]
       #);
     toURI: proc
       (* Constructs a file: URI that represents this abstract
        * pathname
        *)
       (# result: ^URI;
       exit result[]
       #);
     toURL: proc
       (* Converts this abstract pathname into a file: URL *)
       (# result: ^URL;
       exit result[]
       #);

  do 'java/io/File' -> className;
  #);

(* Static methods from class File *)

File_createTempFile_StringString: external
  (* Creates an empty file in the default temporary-file
   * directory, using the given prefix and suffix to generate
   * its name
   *)
  (# prefix, suffix: ^String;
     result: ^JavaFile;
  enter (prefix[], suffix[])
  do 'static java/io/File/createTempFile(Ljava/lang/String;Ljava/lang/String;)Ljava/io/File;' -> callC
  exit result[]
  #);
File_createTempFile_StringStringFile: external
  (* Creates a new empty file in the specified directory,
   * using the given prefix and suffix strings to generate its
   * name
   *)
  (# prefix, suffix: ^String;
     directory: ^JavaFile;
     result: ^JavaFile;
  enter (prefix[], suffix[], directory[])
  do 'static java/io/File/createTempFile(Ljava/lang/String;Ljava/lang/String;Ljava/io/File;)Ljava/io/File;' -> callC
  exit result[]
  #);

(* {*FIXME: cannot return array from external*}
 * 
 * File_listRoots: external
 *   {* List the available filesystem roots *}
 *   (# result: [0]^JavaFile;
 *   do 'static java/io/File/listRoots()[Ljava/io/File;' -> callC
 *   exit result
 *   #);
 *)
