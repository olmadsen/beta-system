ORIGIN '~beta/basiclib/v1.6/betaenv';
INCLUDE '~beta/unixlib/v1.6/dlfcn';
INCLUDE '~beta/basiclib/v1.6/numberio';

--PROGRAM: descriptor--
(# self, libX, address: @integer;
do 'Getting handle to current process ... ' -> puttext;
   (0, RTLD_NOW) -> dlopen_integer -> self;
   (if self=0 then
       '\ndlopen failed: ' -> puttext; 
       dlerror->putline;
       stop;
    else
       'done' -> putline;
   if);
   'Finding address of M1PROGRAM.'->putline;
   (self, 'M1PROGRAM') -> dlsym -> address;
   'The address of M1PROGRAM is: 0x' -> puttext;
   address -> puthex; newline;
   'Type <RETURN> to continue' ->puttext;
   getline;
   
   'Dynamically linking in libX.so ... ' -> puttext;
   (* Notice: path not needed! *)
   ('libX.so', RTLD_LAZY) -> dlopen -> libX;
   (if libX=0 then
       '\ndlopen failed: ' -> puttext; 
       dlerror->putline;
       stop;
    else
       'done' -> putline;
   if); 
   'Finding address of XSetWindowBorder'->putline;
   (libX, 'XSetWindowBorder') -> dlsym -> address;
   'The address of XSetWindowBorder is: 0x' -> puttext;
   address -> puthex; newline;
   'Type <RETURN> to continue' ->puttext;
   getline;
#)
